;/*FB_PKG_DELIM*/

__d("WAWebFetchQuickPromotionsQuery_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="7364334306986866"}),null);
__d("WAWebFetchQuickPromotionsQuery.graphql",["WAWebFetchQuickPromotionsQuery_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{defaultValue:null,kind:"LocalArgument",name:"nux_ids"},{defaultValue:null,kind:"LocalArgument",name:"trigger_context"}],c=[{kind:"Literal",name:"include_holdouts",value:!0},{kind:"Literal",name:"supports_client_side_filters",value:!0},{kind:"Variable",name:"surface_nux_ids",variableName:"nux_ids"},{kind:"Variable",name:"trigger_context",variableName:"trigger_context"}],d={alias:null,args:null,kind:"ScalarField",name:"surface_nux_id",storageKey:null},e={alias:null,args:null,kind:"ScalarField",name:"client_ttl_seconds",storageKey:null},f={alias:null,args:null,kind:"ScalarField",name:"priority",storageKey:null},g={alias:null,args:null,kind:"ScalarField",name:"is_holdout",storageKey:null},h={alias:null,args:null,kind:"ScalarField",name:"log_eligibility_waterfall",storageKey:null},i={alias:null,args:null,kind:"ScalarField",name:"start",storageKey:null},j={alias:null,args:null,kind:"ScalarField",name:"end",storageKey:null},k={alias:null,args:null,kind:"ScalarField",name:"promotion_id",storageKey:null},l={alias:null,args:null,kind:"ScalarField",name:"is_server_force_pass",storageKey:null},m={alias:null,args:null,kind:"ScalarField",name:"ab_prop_name",storageKey:null},n={alias:null,args:null,kind:"ScalarField",name:"surface_delay_in_seconds",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"encrypted_logging_data",storageKey:null},p=[{alias:null,args:null,kind:"ScalarField",name:"text",storageKey:null}],q=[{kind:"InlineDataFragmentSpread",name:"WAWebFetchQuickPromotionsQuery_QPText",selections:p,args:null,argumentDefinitions:[]}],r={alias:null,args:null,concreteType:"TextWithEntities",kind:"LinkedField",name:"title",plural:!1,selections:q,storageKey:null},s={alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null},t=[{alias:null,args:null,kind:"ScalarField",name:"jpeg_thumbnail",storageKey:null}],u={alias:null,args:null,concreteType:"WAQPMediaDetails",kind:"LinkedField",name:"wa_light_mode_media_details",plural:!1,selections:t,storageKey:null};t={alias:null,args:null,concreteType:"WAQPMediaDetails",kind:"LinkedField",name:"wa_dark_mode_media_details",plural:!1,selections:t,storageKey:null};var v={alias:null,args:null,kind:"ScalarField",name:"accessibility_text_for_image",storageKey:null},w={alias:null,args:null,kind:"ScalarField",name:"is_dismissible",storageKey:null},x={alias:null,args:null,concreteType:"QPContentAttributeDescriptor",kind:"LinkedField",name:"content_attributes",plural:!1,selections:[{alias:null,args:null,concreteType:"WhatsappQPColors",kind:"LinkedField",name:"wa_banner_background_color",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"light_mode_highlight_color",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"dark_mode_highlight_color",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"light_mode_background_color",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"dark_mode_background_color",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"wa_primary_cta_alternative_url",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"wa_eligible_duration_after_impression_in_seconds",storageKey:null}],storageKey:null},y={alias:null,args:null,kind:"ScalarField",name:"value",storageKey:null},z={alias:null,args:null,concreteType:"WAQPContentAttribute",kind:"LinkedField",name:"wa_qp_content_attributes_do_not_use",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},y],storageKey:null},A={alias:null,args:null,kind:"ScalarField",name:"clause_type",storageKey:null};y=[{alias:null,args:null,kind:"ScalarField",name:"filter_name",storageKey:null},{alias:null,args:null,concreteType:"QPFilterParameter",kind:"LinkedField",name:"parameters",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"key",storageKey:null},y],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"passes_if_client_not_supported",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"filter_result",storageKey:null}];var B={kind:"InlineDataFragmentSpread",name:"WAWebFetchQuickPromotionsQuery_QPWAFilterClause",selections:[A,{alias:null,args:null,concreteType:"QuickPromotionFlattenedFilter",kind:"LinkedField",name:"filters",plural:!0,selections:[{kind:"InlineDataFragmentSpread",name:"WAWebFetchQuickPromotionsQuery_QPWAFilter",selections:y,args:null,argumentDefinitions:[]}],storageKey:null}],args:null,argumentDefinitions:[]},C={alias:null,args:null,concreteType:"QPUserInteractionInfo",kind:"LinkedField",name:"user_interaction_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"impression_max_instances",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"impression_count_for_user",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"dismiss_max_instances",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"dismiss_click_count_for_user",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"primary_click_max_instances",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"primary_click_count_for_user",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"secondary_click_count_for_user",storageKey:null}],storageKey:null},D={alias:null,args:null,concreteType:"TextWithEntities",kind:"LinkedField",name:"title",plural:!1,selections:p,storageKey:null},E={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null};y={alias:null,args:null,concreteType:"QuickPromotionFlattenedFilter",kind:"LinkedField",name:"filters",plural:!0,selections:y,storageKey:null};return{fragment:{argumentDefinitions:a,kind:"Fragment",metadata:null,name:"WAWebFetchQuickPromotionsQuery",selections:[{alias:null,args:c,concreteType:"QuickPromotionBatchFetchSurface",kind:"LinkedField",name:"quick_promotion_batch_fetch_root",plural:!0,selections:[d,{alias:null,args:null,concreteType:"QuickPromotionSurfaceEligiblePromotionsConnection",kind:"LinkedField",name:"eligible_promotions",plural:!1,selections:[{alias:null,args:null,concreteType:"QuickPromotionSurfaceEligiblePromotionsEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{kind:"RequiredField",field:e,action:"LOG",path:"quick_promotion_batch_fetch_root.eligible_promotions.edges.client_ttl_seconds"},{kind:"RequiredField",field:f,action:"LOG",path:"quick_promotion_batch_fetch_root.eligible_promotions.edges.priority"},{kind:"RequiredField",field:g,action:"LOG",path:"quick_promotion_batch_fetch_root.eligible_promotions.edges.is_holdout"},{kind:"RequiredField",field:h,action:"LOG",path:"quick_promotion_batch_fetch_root.eligible_promotions.edges.log_eligibility_waterfall"},{kind:"RequiredField",field:{alias:null,args:null,concreteType:"TimeRange",kind:"LinkedField",name:"time_range",plural:!1,selections:[{kind:"RequiredField",field:i,action:"LOG",path:"quick_promotion_batch_fetch_root.eligible_promotions.edges.time_range.start"},{kind:"RequiredField",field:j,action:"LOG",path:"quick_promotion_batch_fetch_root.eligible_promotions.edges.time_range.end"}],storageKey:null},action:"LOG",path:"quick_promotion_batch_fetch_root.eligible_promotions.edges.time_range"},{alias:null,args:null,concreteType:"QuickPromotion",kind:"LinkedField",name:"node",plural:!1,selections:[{kind:"InlineDataFragmentSpread",name:"WAWebFetchQuickPromotionsQuery_QuickPromotion",selections:[k,l,m,n,o,{alias:null,args:null,concreteType:"QuickPromotionCreative",kind:"LinkedField",name:"creatives",plural:!0,selections:[{kind:"InlineDataFragmentSpread",name:"WAWebFetchQuickPromotionsQuery_QPCreative",selections:[r,{alias:null,args:null,concreteType:"TextWithEntities",kind:"LinkedField",name:"content",plural:!1,selections:q,storageKey:null},{alias:null,args:null,concreteType:"QuickPromotionAction",kind:"LinkedField",name:"primary_action",plural:!1,selections:[{kind:"InlineDataFragmentSpread",name:"WAWebFetchQuickPromotionsQuery_QPAction",selections:[r,s],args:null,argumentDefinitions:[]}],storageKey:null},u,t,v,w],args:null,argumentDefinitions:[]}],storageKey:null},x,z,{alias:null,args:null,concreteType:"QuickPromotionFlattenedFilterClause",kind:"LinkedField",name:"contextual_filters_for_wa_do_not_use",plural:!1,selections:[B,{alias:null,args:null,concreteType:"QuickPromotionFlattenedFilterClause",kind:"LinkedField",name:"clauses",plural:!0,selections:[B,{alias:null,args:null,concreteType:"QuickPromotionFlattenedFilterClause",kind:"LinkedField",name:"clauses",plural:!0,selections:[B,{alias:null,args:null,concreteType:"QuickPromotionFlattenedFilterClause",kind:"LinkedField",name:"clauses",plural:!0,selections:[B],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},C],args:null,argumentDefinitions:[]}],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:a,kind:"Operation",name:"WAWebFetchQuickPromotionsQuery",selections:[{alias:null,args:c,concreteType:"QuickPromotionBatchFetchSurface",kind:"LinkedField",name:"quick_promotion_batch_fetch_root",plural:!0,selections:[d,{alias:null,args:null,concreteType:"QuickPromotionSurfaceEligiblePromotionsConnection",kind:"LinkedField",name:"eligible_promotions",plural:!1,selections:[{alias:null,args:null,concreteType:"QuickPromotionSurfaceEligiblePromotionsEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[e,f,g,h,{alias:null,args:null,concreteType:"TimeRange",kind:"LinkedField",name:"time_range",plural:!1,selections:[i,j],storageKey:null},{alias:null,args:null,concreteType:"QuickPromotion",kind:"LinkedField",name:"node",plural:!1,selections:[k,l,m,n,o,{alias:null,args:null,concreteType:"QuickPromotionCreative",kind:"LinkedField",name:"creatives",plural:!0,selections:[D,{alias:null,args:null,concreteType:"TextWithEntities",kind:"LinkedField",name:"content",plural:!1,selections:p,storageKey:null},{alias:null,args:null,concreteType:"QuickPromotionAction",kind:"LinkedField",name:"primary_action",plural:!1,selections:[D,s],storageKey:null},u,t,v,w,E],storageKey:null},x,z,{alias:null,args:null,concreteType:"QuickPromotionFlattenedFilterClause",kind:"LinkedField",name:"contextual_filters_for_wa_do_not_use",plural:!1,selections:[A,y,{alias:null,args:null,concreteType:"QuickPromotionFlattenedFilterClause",kind:"LinkedField",name:"clauses",plural:!0,selections:[A,y,{alias:null,args:null,concreteType:"QuickPromotionFlattenedFilterClause",kind:"LinkedField",name:"clauses",plural:!0,selections:[A,y,{alias:null,args:null,concreteType:"QuickPromotionFlattenedFilterClause",kind:"LinkedField",name:"clauses",plural:!0,selections:[A,y],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},C,E],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}]},params:{id:b("WAWebFetchQuickPromotionsQuery_facebookRelayOperation"),metadata:{},name:"WAWebFetchQuickPromotionsQuery",operationKind:"query",text:null}}}();e.exports=a}),null);
__d("WAWebFetchQuickPromotionsQuery_QPAction.graphql",[],(function(a,b,c,d,e,f){"use strict";a={kind:"InlineDataFragment",name:"WAWebFetchQuickPromotionsQuery_QPAction"};e.exports=a}),null);
__d("WAWebFetchQuickPromotionsQuery_QPCreative.graphql",[],(function(a,b,c,d,e,f){"use strict";a={kind:"InlineDataFragment",name:"WAWebFetchQuickPromotionsQuery_QPCreative"};e.exports=a}),null);
__d("WAWebFetchQuickPromotionsQuery_QPText.graphql",[],(function(a,b,c,d,e,f){"use strict";a={kind:"InlineDataFragment",name:"WAWebFetchQuickPromotionsQuery_QPText"};e.exports=a}),null);
__d("WAWebFetchQuickPromotionsQuery_QPWAFilter.graphql",[],(function(a,b,c,d,e,f){"use strict";a={kind:"InlineDataFragment",name:"WAWebFetchQuickPromotionsQuery_QPWAFilter"};e.exports=a}),null);
__d("WAWebFetchQuickPromotionsQuery_QPWAFilterClause.graphql",[],(function(a,b,c,d,e,f){"use strict";a={kind:"InlineDataFragment",name:"WAWebFetchQuickPromotionsQuery_QPWAFilterClause"};e.exports=a}),null);
__d("WAWebFetchQuickPromotionsQuery_QuickPromotion.graphql",[],(function(a,b,c,d,e,f){"use strict";a={kind:"InlineDataFragment",name:"WAWebFetchQuickPromotionsQuery_QuickPromotion"};e.exports=a}),null);
__d("WAWebQuickPromotionActionMutation_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="6907502319358470"}),null);
__d("WAWebQuickPromotionActionMutation.graphql",["WAWebQuickPromotionActionMutation_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{defaultValue:null,kind:"LocalArgument",name:"input"}],c=[{alias:null,args:[{kind:"Variable",name:"data",variableName:"input"}],concreteType:"WaQuickPromotionLogEventResponsePayload",kind:"LinkedField",name:"wa_quick_promotion_log_event",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"client_mutation_id",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:a,kind:"Fragment",metadata:null,name:"WAWebQuickPromotionActionMutation",selections:c,type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:a,kind:"Operation",name:"WAWebQuickPromotionActionMutation",selections:c},params:{id:b("WAWebQuickPromotionActionMutation_facebookRelayOperation"),metadata:{},name:"WAWebQuickPromotionActionMutation",operationKind:"mutation",text:null}}}();e.exports=a}),null);
__d("WAWebMexUpdateTextStatusJobMutation.graphql",[],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{defaultValue:null,kind:"LocalArgument",name:"input"}],b=[{alias:null,args:[{kind:"Variable",name:"text_status_input",variableName:"input"}],concreteType:"XWA2TextStatusMutationResponse",kind:"LinkedField",name:"xwa2_update_text_status",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"result",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:a,kind:"Fragment",metadata:null,name:"WAWebMexUpdateTextStatusJobMutation",selections:b,type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:a,kind:"Operation",name:"WAWebMexUpdateTextStatusJobMutation",selections:b},params:{id:"6995196977195668",metadata:{},name:"WAWebMexUpdateTextStatusJobMutation",operationKind:"mutation",text:null}}}();e.exports=a}),null);
__d("WAWebMexFetchSubgroupSuggestionsJobQuery.graphql",[],(function(a,b,c,d,e,f){"use strict";a=function(){var a={defaultValue:null,kind:"LocalArgument",name:"group_id"},b={defaultValue:null,kind:"LocalArgument",name:"query_context"},c={defaultValue:null,kind:"LocalArgument",name:"sub_group_hint_id"},d=[{fields:[{kind:"Variable",name:"group_id",variableName:"group_id"},{kind:"Variable",name:"query_context",variableName:"query_context"},{kind:"Variable",name:"sub_group_hint",variableName:"sub_group_hint_id"}],kind:"ObjectValue",name:"group_input"}],e={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},f={alias:null,args:null,kind:"ScalarField",name:"value",storageKey:null},g=[f],h={alias:null,args:null,concreteType:"XWA2GroupSubject",kind:"LinkedField",name:"subject",plural:!1,selections:g,storageKey:null},i={alias:null,args:null,concreteType:"XWA2User",kind:"LinkedField",name:"creator",plural:!1,selections:[e],storageKey:null},j={alias:null,args:null,kind:"ScalarField",name:"creation_time",storageKey:null},k={alias:null,args:null,kind:"ScalarField",name:"total_participants_count",storageKey:null},l={alias:null,args:null,kind:"ScalarField",name:"is_existing_group",storageKey:null};return{fragment:{argumentDefinitions:[a,b,c],kind:"Fragment",metadata:null,name:"WAWebMexFetchSubgroupSuggestionsJobQuery",selections:[{alias:null,args:d,concreteType:null,kind:"LinkedField",name:"xwa2_group_query_by_id",plural:!1,selections:[e,{kind:"InlineFragment",selections:[{alias:null,args:null,concreteType:"XWA2CommunitySubGroupSuggestionConnection",kind:"LinkedField",name:"sub_group_suggestions",plural:!1,selections:[{alias:null,args:null,concreteType:"XWA2CommunitySubGroupSuggestionEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"XWA2CommunitySubGroupSuggestion",kind:"LinkedField",name:"node",plural:!1,selections:[e,h,{alias:null,args:null,concreteType:"XWA2GroupDescription",kind:"LinkedField",name:"description",plural:!1,selections:g,storageKey:null},i,j,k,l],storageKey:null}],storageKey:null}],storageKey:null}],type:"XWA2CommunityGroup",abstractKey:null}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[a,c,b],kind:"Operation",name:"WAWebMexFetchSubgroupSuggestionsJobQuery",selections:[{alias:null,args:d,concreteType:null,kind:"LinkedField",name:"xwa2_group_query_by_id",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null},e,{kind:"InlineFragment",selections:[{alias:null,args:null,concreteType:"XWA2CommunitySubGroupSuggestionConnection",kind:"LinkedField",name:"sub_group_suggestions",plural:!1,selections:[{alias:null,args:null,concreteType:"XWA2CommunitySubGroupSuggestionEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"XWA2CommunitySubGroupSuggestion",kind:"LinkedField",name:"node",plural:!1,selections:[e,h,{alias:null,args:null,concreteType:"XWA2GroupDescription",kind:"LinkedField",name:"description",plural:!1,selections:[f,e],storageKey:null},i,j,k,l],storageKey:null}],storageKey:null}],storageKey:null}],type:"XWA2CommunityGroup",abstractKey:null}],storageKey:null}]},params:{id:"7476606999039338",metadata:{},name:"WAWebMexFetchSubgroupSuggestionsJobQuery",operationKind:"query",text:null}}}();e.exports=a}),null);
__d("WAWebMexSetUsernameJobMutation.graphql",[],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{defaultValue:null,kind:"LocalArgument",name:"input"}],b=[{alias:null,args:[{kind:"Variable",name:"username",variableName:"input"}],concreteType:"XWA2UsernameSetMutationResponse",kind:"LinkedField",name:"xwa2_username_set",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"result",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:a,kind:"Fragment",metadata:null,name:"WAWebMexSetUsernameJobMutation",selections:b,type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:a,kind:"Operation",name:"WAWebMexSetUsernameJobMutation",selections:b},params:{id:"7510494352333877",metadata:{},name:"WAWebMexSetUsernameJobMutation",operationKind:"mutation",text:null}}}();e.exports=a}),null);
__d("WACryptoAesGcm",["WABinary","WACryptoDependencies","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a,c,e,f,g){var j;return b("regeneratorRuntime").async(function(k){while(1)switch(k.prev=k.next){case 0:g===void 0&&(g=16);j={name:"AES-GCM",iv:i(c),tagLength:g*8};f!=null&&(j.additionalData=i(f));k.t0=d("WACryptoDependencies").getCrypto().subtle;k.t1=j;k.next=7;return b("regeneratorRuntime").awrap(h(a));case 7:k.t2=k.sent;k.t3=e;return k.abrupt("return",k.t0.encrypt.call(k.t0,k.t1,k.t2,k.t3));case 10:case"end":return k.stop()}},null,this)}function c(a,c,e,f,g){var j;return b("regeneratorRuntime").async(function(k){while(1)switch(k.prev=k.next){case 0:g===void 0&&(g=16);j={name:"AES-GCM",iv:i(c),tagLength:g*8};f!=null&&(j.additionalData=i(f));k.t0=d("WACryptoDependencies").getCrypto().subtle;k.t1=j;k.next=7;return b("regeneratorRuntime").awrap(h(a));case 7:k.t2=k.sent;k.t3=e;return k.abrupt("return",k.t0.decrypt.call(k.t0,k.t1,k.t2,k.t3));case 10:case"end":return k.stop()}},null,this)}function h(a){return d("WACryptoDependencies").getCrypto().subtle.importKey("raw",a,"AES-GCM",!1,["encrypt","decrypt"])}function i(a){if(a instanceof Uint8Array)return a;if(typeof a==="string"){var b=new(d("WABinary").Binary)();b.writeString(a);return b.readByteArray()}return new Uint8Array(a)}g.gcmEncrypt=a;g.gcmDecrypt=c}),98);
__d("WAUseCaseSecret",["$InternalEnum","WABinary","WACryptoHkdf"],(function(a,b,c,d,e,f,g){"use strict";c=b("$InternalEnum")({POLL_VOTE:"Poll Vote",ENC_REACTION:"Enc Reaction",ENC_COMMENT:"Enc Comment",REPORT_TOKEN:"Report Token",EVENT_RESPONSE:"Event Response",EVENT_EDIT_ENCRYPTED:"Event Edit"});var h=32;function a(a){var b=a.messageSecret,c=a.stanzaId,e=a.parentMsgOriginalSender,f=a.modificationSender;a=a.modificationType;c=d("WABinary").Binary.build(c,e,f,a).readBuffer();return d("WACryptoHkdf").extractAndExpand(b instanceof ArrayBuffer?new Uint8Array(b):b,c,h)}g.UseCaseSecretModificationType=c;g.createUseCaseSecret=a}),98);
__d("WAWebWamEnumMediaType",[],(function(a,b,c,d,e,f){a=Object.freeze({NONE:1,PHOTO:2,VIDEO:3,AUDIO:4,PTT:5,LOCATION:6,CONTACT:7,DOCUMENT:8,URL:9,CALL:10,GIF:11,FUTURE:12,CONTACT_ARRAY:13,LIVE_LOCATION:14,PROFILE_PIC:15,STICKER:16,HSM:17,PRODUCT_IMAGE:18,TEMPLATE:19,MD_APP_STATE:20,MD_HISTORY_SYNC:21,CATALOG_LINK:22,PRODUCT_LINK:23,ORDER:24,LIST:25,LIST_REPLY:26,BUTTON_MESSAGE:27,BUTTON_RESPONSE_MESSAGE:28,PRODUCT_LIST:29,BUTTON_NFM:30,VIEW_ONCE_IMAGE:31,VIEW_ONCE_VIDEO:32,SHOP_STOREFRONT:33,REACTION:34,INTERACTIVE_NFM:35,INTERACTIVE_RESPONSE_NFM:36,POLL_CREATE:37,POLL_VOTE:38,TEXT:39,KEEP:40,UNKEEP:41,INVISIBLE_HELLO:42,MEDIA_EXPRESS_NOTIFY:43,UNDECRYPTED_MEDIA:44,UNDECRYPTED_TEXT:45,UNDECRYPTED_PAY:46,UNDECRYPTED_POLL:47,UNDECRYPTED_REACTION:48,UNDECRYPTED_MEDIA_NOTIFY:49,VIEW_ONCE_AUDIO:50,SCHEDULED_CALL_CREATE:51,SCHEDULED_CALL_CANCEL:52,PUSH_TO_VIDEO:53,PIN_IN_CHAT:54,INTERACTIVE_CAROUSEL:55,COMMENT:56,EPHEMERAL_SYNC_RESPONSE:57,EVENT_CREATE:58,EVENT_RESPOND:59,LOTTIE_STICKER:60,INTERACTIVE_PRODUCT_CAROUSEL:61,INTERACTIVE_PRODUCT:62});f.MEDIA_TYPE=a}),66);
__d("WAWebWamEnumMessageSecretAllowedType",[],(function(a,b,c,d,e,f){a=Object.freeze({MESSAGE_POLL:0});f.MESSAGE_SECRET_ALLOWED_TYPE=a}),66);
__d("WAWebWamEnumMessageSecretErrorType",[],(function(a,b,c,d,e,f){a=Object.freeze({MISSING_MESSAGE_SECRET:0,WRONG_LENGTH:1,ENCRYPTION_ERROR:2,DECRYPTION_ERROR:3});f.MESSAGE_SECRET_ERROR_TYPE=a}),66);
__d("WAWebMessageSecretErrorsWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumMediaType","WAWebWamEnumMessageSecretAllowedType","WAWebWamEnumMessageSecretErrorType"],(function(a,b,c,d,e,f,g){a=d("WAWebWamCodegenUtils").defineEvents({MessageSecretErrors:[3686,{messageMediaType:[3,d("WAWebWamEnumMediaType").MEDIA_TYPE],messageSecretAllowedList:[1,d("WAWebWamEnumMessageSecretAllowedType").MESSAGE_SECRET_ALLOWED_TYPE],messageSecretError:[2,d("WAWebWamEnumMessageSecretErrorType").MESSAGE_SECRET_ERROR_TYPE]},[1,1,1],"regular"]});g.MessageSecretErrorsWamEvent=a}),98);
__d("WAWebAddOnEncryption",["WACryptoAesGcm","WANullthrows","WAUseCaseSecret","WAWebMessageSecretErrorsWamEvent","WAWebProtobufsE2E.pb","WAWebWamEnumMediaType","WAWebWamEnumMessageSecretErrorType","WAWebWidToJid","asyncToGeneratorRuntime","encodeProtobuf"],(function(a,b,c,d,e,f,g){function h(a){switch(a){case"reaction":return{spec:d("WAWebProtobufsE2E.pb").Message$ReactionMessageSpec,usecase:d("WAUseCaseSecret").UseCaseSecretModificationType.ENC_REACTION};case"poll_vote":return{spec:d("WAWebProtobufsE2E.pb").Message$PollVoteMessageSpec,usecase:d("WAUseCaseSecret").UseCaseSecretModificationType.POLL_VOTE};case"comment":return{spec:d("WAWebProtobufsE2E.pb").MessageSpec,usecase:d("WAUseCaseSecret").UseCaseSecretModificationType.ENC_COMMENT};case"event_response":return{spec:d("WAWebProtobufsE2E.pb").Message$EventResponseMessageSpec,usecase:d("WAUseCaseSecret").UseCaseSecretModificationType.EVENT_RESPONSE};case"event_edit_encrypted":return{spec:d("WAWebProtobufsE2E.pb").Message$EventMessageSpec,usecase:d("WAUseCaseSecret").UseCaseSecretModificationType.EVENT_EDIT_ENCRYPTED}}}function i(a,b){switch(a){case"poll_vote":case"event_response":return b.stanzaId+"\0"+b.addOnSenderJid;default:return}}function j(a){switch(a){case"poll_vote":return d("WAWebWamEnumMediaType").MEDIA_TYPE.POLL_VOTE;case"reaction":return d("WAWebWamEnumMediaType").MEDIA_TYPE.REACTION;case"event_response":return d("WAWebWamEnumMediaType").MEDIA_TYPE.EVENT_RESPOND;default:return d("WAWebWamEnumMediaType").MEDIA_TYPE.NONE}}function a(a,b){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){try{var e=b.messageSecret,f=b.iv,g=b.stanzaId,k=b.originalMessageSender;b=b.addOnSender;b=d("WAWebWidToJid").widToUserJid(b);var l=c("WANullthrows")(h(a.type)),m=l.spec;l=l.usecase;e=(yield d("WAUseCaseSecret").createUseCaseSecret({messageSecret:e,stanzaId:g,parentMsgOriginalSender:d("WAWebWidToJid").widToUserJid(k),modificationSender:b,modificationType:l}));k=d("encodeProtobuf").encodeProtobuf(m,a.encode).readBuffer();l=(yield d("WACryptoAesGcm").gcmEncrypt(e,f,k,i(a.type,{stanzaId:g,addOnSenderJid:b})));return l}catch(b){new(d("WAWebMessageSecretErrorsWamEvent").MessageSecretErrorsWamEvent)({messageSecretError:d("WAWebWamEnumMessageSecretErrorType").MESSAGE_SECRET_ERROR_TYPE.ENCRYPTION_ERROR,messageMediaType:j(a.type)}).commit();throw b}});return k.apply(this,arguments)}function e(a,b){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){try{var e=b.messageSecret,f=b.iv,g=b.stanzaId,k=b.originalMessageSender;b=b.addOnSender;b=d("WAWebWidToJid").widToUserJid(b);var l=c("WANullthrows")(h(a.type));l=l.usecase;e=(yield d("WAUseCaseSecret").createUseCaseSecret({messageSecret:e,stanzaId:g,parentMsgOriginalSender:d("WAWebWidToJid").widToUserJid(k),modificationSender:b,modificationType:l}));k=(yield d("WACryptoAesGcm").gcmDecrypt(e,f,a.encryptedAddOn,i(a.type,{stanzaId:g,addOnSenderJid:b})));return k}catch(b){new(d("WAWebMessageSecretErrorsWamEvent").MessageSecretErrorsWamEvent)({messageSecretError:d("WAWebWamEnumMessageSecretErrorType").MESSAGE_SECRET_ERROR_TYPE.DECRYPTION_ERROR,messageMediaType:j(a.type)}).commit();throw b}});return l.apply(this,arguments)}g.getAddOnMessageSpec=h;g.getAdditionalAuthenticatedData=i;g.getMessageMediaType=j;g.encryptAddOn=a;g.decryptAddOn=e}),98);
__d("WAWebAddonConstants",["$InternalEnum"],(function(a,b,c,d,e,f){a=b("$InternalEnum").Mirrored(["Unified","Pin","Comment","PollVote","Reaction","EventResponse","None"]);c=b("$InternalEnum").Mirrored(["OnlineReceive","HistorySync","Send"]);f.AddonTableMode=a;f.AddonProcessMode=c}),66);
__d("WAWebAddonCreateMsgProcessor",[],(function(a,b,c,d,e,f){function a(a){return a}function b(a){return a}f.createAddonMsgProcessor=a;f.createAddonMsgProcessorWithRevokes=b}),66);
__d("WAWebAddonInfraError",["$InternalEnum","WACustomError"],(function(a,b,c,d,e,f,g){a=b("$InternalEnum")({UnexpectedError:"unexpected_error",NotSupportedFeature:"not_supported_feature",NotSupportedMsgType:"not_supported_msg_type",UnexpectedMsgType:"unexpected_msg_type",InvalidParentMsgKey:"invalid_parent_msg_key",MissingParentMsg:"missing_parent_msg"});c=function(a){babelHelpers.inheritsLoose(b,a);function b(b,c){b="errorCode: "+String(b);c!=null&&(b+=" comment: "+c);return a.call(this,b)||this}return b}(d("WACustomError").customError("AddonInfraError"));g.AddonInfraErrorCode=a;g.AddonInfraError=c}),98);
__d("WAWebApiHydrateWidsUtil",["WAWebWidFactory","WAWebWidJsonReviver"],(function(a,b,c,d,e,f,g){function h(a){if(Array.isArray(a))return a.map(function(b,a){return h(d("WAWebWidJsonReviver").widReviver(a,b,d("WAWebWidFactory").isWidlike,d("WAWebWidFactory").createWidFromWidLike))});else if(a&&typeof a==="object"){var b=Object.keys(a);for(var c=0;c<b.length;c++){var e=b[c];a[e]=h(d("WAWebWidJsonReviver").widReviver(e,a[e],d("WAWebWidFactory").isWidlike,d("WAWebWidFactory").createWidFromWidLike))}return a}return a}g.hydrateWids=h}),98);
__d("WAWebDBMessageUtils",["$InternalEnum","WAWebVcardParsingUtils"],(function(a,b,c,d,e,f){var g=b("$InternalEnum")({IncomingChatMessage:"1",Outgoing:"2",SystemMessage:"3"});function h(a){a=a.toString(16);return(a.length-1).toString(16)+a}function i(a){return parseInt(a.substring(1),16)}function a(a){return a.toString()+"_/"}function c(a){return a.toString()+"_g"}function d(a,b){b=h(b);return a+"_"+b+"_m"}function e(a){a=a.split("_")[1];return i(a)}function j(a,b,c,d){c?c=g.SystemMessage:!b?c=g.Outgoing:c=g.IncomingChatMessage;return a+"_"+c+"_"+(d!=null?h(d):"")}function k(a){var c=[];if(a.type==="vcard")c=[a.body];else if(a.type==="multi_vcard")c=a.vcardList.map(function(a){return a.vcard});else return;a=b("WAWebVcardParsingUtils");var d=a.parseVcard,e=a.vcardWids;return c.filter(Boolean).reduce(function(a,b){b=e(d(b));return a.concat(b.map(function(a){return a.toString()}))},[])}f.MessagePropertyType=g;f.undoOrderPreservingHex=i;f.beginningOfChat=a;f.endOfChat=c;f.craftInternalId=d;f.getInChatMsgId=e;f.craftMessageRangeIndex=j;f.getVcardWids=k}),66);
__d("WAWebDBMsgOpaqueDataKeys",[],(function(a,b,c,d,e,f){b=["body","caption","paymentAmount1000","futureproofBuffer","messageSecret","clientUrl","loc","lng","lat","isLive","canonicalUrl","matchedText","title","description","pollName","pollSelectableOptionsCount","isSentCagPollCreation","pollUpdateParentKey","encPollVote","senderTimestampMs","targetMessageKey","encIv","encPayload","eventName","isEventCanceled","eventDescription","eventJoinLink","eventStartTime","eventLocation"];c=["targetMessageKey","pollUpdateParentKey"];var g={targetMessageKey:"encReactionTargetMessageKey",encIv:"encReactionEncIv",encPayload:"encReactionEncPayload",encReactionTargetMessageKey:"targetMessageKey",encReactionEncIv:"encIv",encReactionEncPayload:"encPayload"};function a(a,b){return a==="reaction_enc"?g[b]:b}f.MSG_OPAQUE_DATA_KEYS=b;f.MsgKeyFieldsInOpaqueData=c;f.getKey=a}),66);
__d("WAWebPollsDbUtils",["invariant","WANullthrows"],(function(a,b,c,d,e,f,g,h){function a(a){return a==null?void 0:a.slice().sort(function(a,b){return a.localId-b.localId}).map(function(a,b){var c=a.localId;a=a.name;c===b||h(0,59784);return{name:a}})}function b(a){return a==null?void 0:a.map(function(a,b){a=a.name;return{name:c("WANullthrows")(a),localId:b}})}g.compressPollOptions=a;g.expandPollOptions=b}),98);
__d("WAWebDBMessageSerialization",["invariant","WAJids","WAWebApiHydrateWidsUtil","WAWebDBMessageUtils","WAWebDBMsgOpaqueDataKeys","WAWebMsgKey","WAWebMsgType","WAWebPollsDbUtils","WAWebProtobufsMdStorageMsgRowOpaqueData.pb","WAWebWid","WAWebWidFactory","WAWebWidToJid","decodeProtobuf","encodeProtobuf"],(function(a,b,c,d,e,f,g,h){var i=1e9,j=new Set(Object.values(d("WAWebMsgType").MSG_TYPE)),k=["id","parentMsgId","protocolMessageKey","paymentRequestMessageKey","keptMessageKey","pollUpdateParentKey","kicKey","latestEditMsgKey","targetMessageKey","pinParentKey","reactionParentKey"];function a(a,b){var e,f=babelHelpers["extends"]({},a);a.quotedMsg&&(f.quotedMsg=babelHelpers["extends"]({},a.quotedMsg));((e=a.quotedMsg)==null?void 0:e.paymentNoteMsg)&&(f.quotedMsg.paymentNoteMsg=babelHelpers["extends"]({},a.quotedMsg.paymentNoteMsg));a.paymentNoteMsg&&(f.paymentNoteMsg=babelHelpers["extends"]({},a.paymentNoteMsg));a.paymentBackground&&(f.paymentBackground=babelHelpers["extends"]({},a.paymentBackground));a.groupMentions&&(f.groupMentions=a.groupMentions.map(function(a){return{groupSubject:a.groupSubject,groupJid:d("WAWebWidFactory").createWidFromWidLike(a.groupJid)}}));f.star=f.isStarred!==void 0;f.isMdHistoryMsg=f.rowId<i;f.internalId!=null&&(((e=f.to)==null?void 0:e.server)==="newsletter"||((a=f.from)==null?void 0:a.endsWith("@newsletter")))&&(f.serverId=d("WAWebDBMessageUtils").getInChatMsgId(f.internalId));delete f.internalId;delete f.isStarred;delete f.count;delete f.hasLink;delete f.isMediaMsg;delete f.isDocMsg;delete f.isCarouselMsg;delete f.expiredTimestamp;delete f.pendingReadReceipt;m(f);d("WAWebApiHydrateWidsUtil").hydrateWids(f);k.forEach(function(a){f[a]!=null&&(f[a]=c("WAWebMsgKey").from(f[a]))});((e=f.quotedMsg)==null?void 0:e.id)!=null&&(f.quotedMsg.id=c("WAWebMsgKey").from(f.quotedMsg.id));f.messageSecret!=null&&(f.messageSecret=new Uint8Array(f.messageSecret));f.botMessageSecret!=null&&(f.botMessageSecret=new Uint8Array(f.botMessageSecret));a=l(f);e=a[0];var g=a[1];a=a[2];f.futureproofType=e;f.futureproofSubtype=g;f.subtype=(e=a)!=null?e:void 0;f.carouselCardsParsed!=null&&(f.carouselCardsParsed=f.carouselCardsParsed.map(function(a){return babelHelpers["extends"]({},a,{id:a.id instanceof c("WAWebMsgKey")?a.id:new(c("WAWebMsgKey"))(a.id),parentMsgId:a.parentMsgId instanceof c("WAWebMsgKey")?a.parentMsgId:new(c("WAWebMsgKey"))(a.parentMsgId)})}));f.self!=null&&(f.local=f.self==="out",delete f.self);b==null?void 0:b(f);return f}function l(a){var b=a.futureproofType,c=a.futureproofSubtype,e=a.subtype;if(a.type===d("WAWebMsgType").MSG_TYPE.UNKNOWN&&a.futureproofType==null&&a.subtype!=null){switch(a.subtype){case"poll_update":b=d("WAWebMsgType").MSG_TYPE.POLL_UPDATE;c="poll_vote";break;case"message_edit":b=d("WAWebMsgType").MSG_TYPE.PROTOCOL;c="message_edit";break;case"phone":case"phone_only_feature":break;default:j.has(a.subtype)||h(0,67194),b=a.subtype}a.type===d("WAWebMsgType").MSG_TYPE.UNKNOWN&&b!=null&&(e=void 0)}a.type===d("WAWebMsgType").MSG_TYPE.POLL_UPDATE&&e==null&&(e="poll_vote");return[b,c,e]}function m(a){var b=d("decodeProtobuf").decodeProtobuf(d("WAWebProtobufsMdStorageMsgRowOpaqueData.pb").MsgRowOpaqueDataSpec,a.msgRowOpaqueData);if(b.currentMsg){if(b.currentMsg.paymentNoteMsgBody&&a.paymentNoteMsg){var e;a.paymentNoteMsg.body=(e=b.currentMsg)==null?void 0:e.paymentNoteMsgBody}d("WAWebDBMsgOpaqueDataKeys").MSG_OPAQUE_DATA_KEYS.forEach(function(c){var e;a[c]=(e=b.currentMsg)==null?void 0:e[d("WAWebDBMsgOpaqueDataKeys").getKey(a.type,c)]});a.pollOptions=d("WAWebPollsDbUtils").expandPollOptions((e=b.currentMsg)==null?void 0:e.pollOptions);e=(e=b.currentMsg)==null?void 0:e.originalSelfAuthor;e!=null&&c("WAWebWid").isWid(e)&&(a.originalSelfAuthor=d("WAWebWidFactory").createWid(e))}if(a.quotedMsg&&b.quotedMsg){b.quotedMsg.paymentNoteMsgBody&&(a.quotedMsg.paymentNoteMsg.body=b.quotedMsg.paymentNoteMsgBody);d("WAWebDBMsgOpaqueDataKeys").MSG_OPAQUE_DATA_KEYS.forEach(function(c){var e;a.quotedMsg[c]=(e=b.quotedMsg)==null?void 0:e[d("WAWebDBMsgOpaqueDataKeys").getKey(a.type,c)]});a.quotedMsg.pollOptions=d("WAWebPollsDbUtils").expandPollOptions((e=b.quotedMsg)==null?void 0:e.pollOptions)}}function b(a){var b,c=babelHelpers["extends"]({},a);a.quotedMsg&&(c.quotedMsg=babelHelpers["extends"]({},a.quotedMsg));((b=a.quotedMsg)==null?void 0:b.paymentNoteMsg)&&(c.quotedMsg.paymentNoteMsg=babelHelpers["extends"]({},a.quotedMsg.paymentNoteMsg));a.paymentNoteMsg&&(c.paymentNoteMsg=babelHelpers["extends"]({},a.paymentNoteMsg));a.from&&(c.from=a.from.toString());k.forEach(function(a){c[a]!=null&&(c[a]=c[a].toString())});delete c.notifyName;delete c.isNewMsg;delete c.clearMedia;delete c.multicast;delete c.urlNumber;delete c.urlText;delete c.linkPreview;delete c.star;delete c.forwardedFromWeb;n(c);return c}function n(a){var b,c={currentMsg:{},quotedMsg:{}};if((b=a.paymentNoteMsg)==null?void 0:b.body){c.currentMsg.paymentNoteMsgBody=a.paymentNoteMsg.body;(b=a.paymentNoteMsg)==null?void 0:delete b.body}((b=a.quotedMsg)==null?void 0:(b=b.paymentNoteMsg)==null?void 0:b.body)&&(c.quotedMsg.paymentNoteMsgBody=a.quotedMsg.paymentNoteMsg.body,delete a.quotedMsg.paymentNoteMsg.body);d("WAWebDBMsgOpaqueDataKeys").MSG_OPAQUE_DATA_KEYS.forEach(function(b){c.currentMsg[d("WAWebDBMsgOpaqueDataKeys").getKey(a.type,b)]=a[b],delete a[b]});a.originalSelfAuthor&&(c.currentMsg.originalSelfAuthor=d("WAJids").extractUserJid(d("WAWebWidToJid").widToDeviceJid(a.originalSelfAuthor)),delete a.originalSelfAuthor);c.currentMsg.pollOptions=d("WAWebPollsDbUtils").compressPollOptions(a.pollOptions);delete a.pollOptions;a.quotedMsg&&(d("WAWebDBMsgOpaqueDataKeys").MSG_OPAQUE_DATA_KEYS.forEach(function(b){c.quotedMsg[b]=a.quotedMsg[b],delete a.quotedMsg[b]}),c.quotedMsg.pollOptions=d("WAWebPollsDbUtils").compressPollOptions(a.quotedMsg.pollOptions),delete a.quotedMsg.pollOptions);b=d("encodeProtobuf").encodeProtobuf(d("WAWebProtobufsMdStorageMsgRowOpaqueData.pb").MsgRowOpaqueDataSpec,c);a.msgRowOpaqueData=b.readBuffer()}g.messageFromDbRow=a;g.movFieldFromOpaqueDataBackToMsg=m;g.dbRowFromMessage=b;g.movEncFieldToOpaqueData=n}),98);
__d("WAWebBackendJobs.flow",["$InternalEnum"],(function(a,b,c,d,e,f){c=(a=b("$InternalEnum"))({Skmsg:"skmsg",Pkmsg:"pkmsg",Msg:"msg",Msmsg:"msmsg"});d=a({CTWA:"ctwa",USERNAME:"username"});e=a({Image:"image",Video:"video",Ptv:"ptv",Audio:"audio",Ptt:"ptt",Location:"location",VCard:"vcard",Document:"document",Url:"url",Call:"call",Gif:"gif",Future:"future",ContactArray:"contact_array",LiveLocation:"livelocation",ProfilePic:"profile_pic",Sticker:"sticker",Hsm:"hsm",ProductImage:"product_image",Template:"template",MdAppState:"md_app_state",MdHistorySync:"md_history_sync",List:"list",ListResponse:"list_response",Button:"button",ButtonResponse:"button_response",Order:"order",Product:"product",NativeFlowResponse:"native_flow_response"});b=a({Hide:"hide",Show:"show"});f.CiphertextType=c;f.LidOriginType=d;f.EncMediaType=e;f.DecryptFailType=b}),66);
__d("WAWebCommunityGatingUtils",["WAWebABProps","WAWebGroupType","WAWebMobilePlatforms"],(function(a,b,c,d,e,f,g){function h(){return d("WAWebMobilePlatforms").isSMB()?d("WAWebABProps").getABPropConfigValue("parent_group_view_enabled_for_smb_on_web"):d("WAWebABProps").getABPropConfigValue("parent_group_view_enabled")}function a(){return d("WAWebMobilePlatforms").isSMB()&&d("WAWebABProps").getABPropConfigValue("parent_group_view_enabled_for_smb_on_web")}function b(){return d("WAWebMobilePlatforms").isSMB()?d("WAWebABProps").getABPropConfigValue("parent_group_create_enabled_for_smb_on_web"):!0}function c(){return d("WAWebABProps").getABPropConfigValue("parent_group_link_limit")+1}function e(){return d("WAWebABProps").getABPropConfigValue("parent_group_link_limit_community_creation")+1}function f(){return h()&&d("WAWebABProps").getABPropConfigValue("community_admin_promotion_one_time_prompt")}function i(){return d("WAWebABProps").getABPropConfigValue("parent_group_create_privacy")}function j(){return d("WAWebABProps").getABPropConfigValue("parent_group_subgroup_filter")}function k(){return d("WAWebABProps").getABPropConfigValue("community_reporting_ui_upsell_exit")}function l(){return d("WAWebABProps").getABPropConfigValue("group_mentions_in_subgroups")}function m(){return d("WAWebABProps").getABPropConfigValue("parent_group_allow_member_added_groups_m1")}function n(){return d("WAWebABProps").getABPropConfigValue("parent_group_allow_member_added_groups_m2")}function o(a){return a==null?!1:(a.groupType===d("WAWebGroupType").GroupType.LINKED_SUBGROUP||a.groupType===d("WAWebGroupType").GroupType.LINKED_GENERAL_GROUP)&&a.getParentGroupChat()!=null&&h()}function p(){return d("WAWebABProps").getABPropConfigValue("community_subgroup_switcher_entrypoint_enabled")}function q(){return d("WAWebABProps").getABPropConfigValue("community_shorter_group_creation_enabled")}function r(){return d("WAWebABProps").getABPropConfigValue("parent_group_announcement_comments_history_sync_receiver_enabled")}function s(){return d("WAWebABProps").getABPropConfigValue("parent_group_announcement_comments_enabled")}function t(){return d("WAWebABProps").getABPropConfigValue("parent_group_announcement_comments_receiver_enabled")}function u(){return d("WAWebABProps").getABPropConfigValue("web_comments_receive_ui_enabled")}function v(){return d("WAWebABProps").getABPropConfigValue("web_comments_send_ui_enabled")}function w(){return d("WAWebABProps").getABPropConfigValue("parent_group_announcement_comments_participant_limit")}function x(){return d("WAWebABProps").getABPropConfigValue("parent_group_announcement_comment_subscription_enabled")}function y(){return d("WAWebABProps").getABPropConfigValue("community_general_chat_UI_enabled")}function z(){return d("WAWebABProps").getABPropConfigValue("community_general_chat_create_enabled")}function A(){return d("WAWebABProps").getABPropConfigValue("parent_group_allow_member_suggest_existing_m3_receiver")}function B(){return d("WAWebABProps").getABPropConfigValue("parent_group_allow_member_suggest_existing_m3_sender")}function C(){return d("WAWebABProps").getABPropConfigValue("community_history_receive")}g.communitiesEnabled=h;g.communitiesEnabledSmb=a;g.communitiesCreationEnabled=b;g.getParentGroupLinkLimit=c;g.getParentGroupLinkLimitCommunityCreation=e;g.communityAdminPromotionOneTimePromptEnabled=f;g.communityCreatePrivacyEnabled=i;g.subgroupFilterEnabled=j;g.reportCommunityExitUpsellEnabled=k;g.groupMentionsInSubgroupsEnabled=l;g.memberAddedGroupsM1Enabled=m;g.memberSuggestedGroupsEnabled=n;g.shouldShowNewSubgroupIdentity=o;g.communitySubgroupSwitcherEntrypointEnabled=p;g.communityShortGroupCreationEnabled=q;g.isCommentMessageHistorySyncReceiverEnabled=r;g.isCommentMessagesEnabled=s;g.isCommentMessageReceiverEnabled=t;g.isCommentReceiveUIEnabled=u;g.isCommentSenderUIEnabled=v;g.commentMessageParticipantLimit=w;g.isCommentMessageSubscriptionEnabled=x;g.communityGeneralChatUIEnabled=y;g.communityGeneralChatCreateEnabled=z;g.memberSuggestedGroupsM3ReceiverEnabled=A;g.memberSuggestedGroupsM3SenderEnabled=B;g.communityHistoryReceiveEnabled=C}),98);
__d("WAWebSpecialEmojisWithSkinTones",[],(function(a,b,c,d,e,f){a={"\ud83e\udd1d\ud83c\udffb":"\ud83e\udd1d","\ud83e\udd1d\ud83c\udffc":"\ud83e\udd1d","\ud83e\udd1d\ud83c\udffd":"\ud83e\udd1d","\ud83e\udd1d\ud83c\udffe":"\ud83e\udd1d","\ud83e\udd1d\ud83c\udfff":"\ud83e\udd1d","\ud83d\udc6f\ud83c\udffb":"\ud83d\udc6f","\ud83d\udc6f\ud83c\udffc":"\ud83d\udc6f","\ud83d\udc6f\ud83c\udffd":"\ud83d\udc6f","\ud83d\udc6f\ud83c\udffe":"\ud83d\udc6f","\ud83d\udc6f\ud83c\udfff":"\ud83d\udc6f","\ud83d\udc6f\ud83c\udffb\u200d\u2642":"\ud83d\udc6f\u200d\u2642","\ud83d\udc6f\ud83c\udffc\u200d\u2642":"\ud83d\udc6f\u200d\u2642","\ud83d\udc6f\ud83c\udffd\u200d\u2642":"\ud83d\udc6f\u200d\u2642","\ud83d\udc6f\ud83c\udffe\u200d\u2642":"\ud83d\udc6f\u200d\u2642","\ud83d\udc6f\ud83c\udfff\u200d\u2642":"\ud83d\udc6f\u200d\u2642"};f["default"]=a}),66);
__d("WAWebConvertToTextWithoutSpecialEmojis",["WAWebEmojiCompile","WAWebSpecialEmojisWithSkinTones"],(function(a,b,c,d,e,f,g){var h=null;function a(a){if(!h){var b=c("WAWebEmojiCompile")(Object.keys(c("WAWebSpecialEmojisWithSkinTones")));h=new RegExp("("+b+")","g")}h.lastIndex=0;return a.replace(h,function(a){return c("WAWebSpecialEmojisWithSkinTones")[a]})}g.convertToTextWithoutSpecialEmojis=a}),98);
__d("WAWebHandleMsgCommon",["WACustomError"],(function(a,b,c,d,e,f,g){a={text:"text",media:"media",pay:"pay",poll:"poll",reaction:"reaction",event:"event"};b={ctwa:"ctwa",username:"username"};c={pn:"pn",lid:"lid"};e={creation:"creation",vote:"vote"};f={creation:"creation",response:"response",edit:"edit"};var h={high:"high",low:"low",unknown:"unknown"},i="peer";d=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}return b}(d("WACustomError").customError("HSMMismatchError"));var j={send:"send",request:"request",futureproof:"futureproof","request-decline":"request-decline","request-cancel":"request-cancel",invite:"invite"},k="biz_source";g.STANZA_MSG_TYPES=a;g.STANZA_MSG_ORIGIN=b;g.STANZA_MSG_ADDRESSING_MODE=c;g.POLL_TYPES=e;g.EVENT_TYPES=f;g.MSG_VERIFIED_LEVEL=h;g.CATEGORY_PEER=i;g.HsmMismatchError=d;g.PAY_NODE_TYPES=j;g.BIZ_SOURCE_ATTR=k}),98);
__d("WAWebInteractiveMessageType",["$InternalEnum"],(function(a,b,c,d,e,f){a=b("$InternalEnum")({NATIVE_FLOW:"native_flow",SHOPS_STOREFRONT:"shops_storefront",CAROUSEL:"carousel"});c=a;f["default"]=c}),66);
__d("WAWebInteractiveResponseMessageType",["$InternalEnum"],(function(a,b,c,d,e,f){a=b("$InternalEnum")({NATIVE_FLOW:"native_flow"});c=a;f["default"]=c}),66);
__d("WAWebIsCagGroupCache",[],(function(a,b,c,d,e,f){a=function(){function a(){this.$1=new Set()}var b=a.prototype;b.add=function(a){this.$1.add(a.toString())};b.remove=function(a){this.$1["delete"](a.toString())};b.isCag=function(a){return this.$1.has(a.toString())};b.clear=function(){this.$1.clear()};return a}();b=new a();c=b;f["default"]=c}),66);
__d("WAWebE2EProtoUtils",["invariant","$InternalEnum","WABase64","WALogger","WALongInt","WANullthrows","WATypeUtils","WAWebABProps","WAWebApiContact","WAWebBackendJobs.flow","WAWebBizCoexGatingUtils","WAWebBizGatingUtils","WAWebCommunityGatingUtils","WAWebConvertToTextWithoutSpecialEmojis","WAWebEphemeralityTypes","WAWebHandleMsgCommon","WAWebInteractiveMessageType","WAWebInteractiveMessagesNativeFlowName","WAWebInteractiveResponseMessageType","WAWebIsCagGroupCache","WAWebJidUtils","WAWebMobilePlatforms","WAWebMsgKey","WAWebMsgType","WAWebProtobufsE2E.pb","WAWebUserPrefsMeUser","WAWebWid","WAWebWidFactory","err"],(function(a,b,c,d,e,f,g,h){function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["url(deprecatedMms3Url) missing from msg type ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["fileEncSha256 missing from msg type ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["fileSha256 missing from msg type ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["directPath missing from msg type ",""]);l=function(){return a};return a}function m(a){if(a.ephemeralMessage){var b=a.ephemeralMessage.message;return b?m(b):d("WAWebHandleMsgCommon").STANZA_MSG_TYPES.text}if(a.groupMentionedMessage){b=a.groupMentionedMessage.message;return b?m(b):d("WAWebHandleMsgCommon").STANZA_MSG_TYPES.text}if(a.botInvokeMessage){b=a.botInvokeMessage.message;return b?m(b):d("WAWebHandleMsgCommon").STANZA_MSG_TYPES.text}if(a.deviceSentMessage){b=a.deviceSentMessage.message;return b?m(b):d("WAWebHandleMsgCommon").STANZA_MSG_TYPES.text}if(a.reactionMessage||a.encReactionMessage)return d("WAWebHandleMsgCommon").STANZA_MSG_TYPES.reaction;if(a.eventMessage||a.encEventResponseMessage||((b=a.secretEncryptedMessage)==null?void 0:b.secretEncType)===d("WAWebProtobufsE2E.pb").Message$SecretEncryptedMessage$SecretEncType.EVENT_EDIT)return d("WAWebHandleMsgCommon").STANZA_MSG_TYPES.event;if(a.pollCreationMessage||a.pollCreationMessageV2||a.pollCreationMessageV3||a.pollUpdateMessage)return d("WAWebHandleMsgCommon").STANZA_MSG_TYPES.poll;if(((b=a.extendedTextMessage)==null?void 0:b.canonicalUrl)!=null&&a.extendedTextMessage.canonicalUrl.trim()!=="")return d("WAWebHandleMsgCommon").STANZA_MSG_TYPES.media;return Boolean(a.conversation)||a.extendedTextMessage||a.templateButtonReplyMessage||a.protocolMessage||a.interactiveMessage||a.keepInChatMessage||a.requestPhoneNumberMessage||a.editedMessage||a.pinInChatMessage||a.encCommentMessage||a.newsletterAdminInviteMessage?d("WAWebHandleMsgCommon").STANZA_MSG_TYPES.text:d("WAWebHandleMsgCommon").STANZA_MSG_TYPES.media}function a(a){if(a.pollCreationMessage!=null||a.pollCreationMessageV2!=null||a.pollCreationMessageV3!=null)return d("WAWebHandleMsgCommon").POLL_TYPES.creation;return((a=a.pollUpdateMessage)==null?void 0:a.vote)!=null?d("WAWebHandleMsgCommon").POLL_TYPES.vote:null}function e(a){if(a.eventMessage!=null)return d("WAWebHandleMsgCommon").EVENT_TYPES.creation;if(a.encEventResponseMessage!=null)return d("WAWebHandleMsgCommon").EVENT_TYPES.response;return((a=a.secretEncryptedMessage)==null?void 0:a.secretEncType)===d("WAWebProtobufsE2E.pb").Message$SecretEncryptedMessage$SecretEncType.EVENT_EDIT?d("WAWebHandleMsgCommon").EVENT_TYPES.edit:null}function f(a){if(d("WAWebCommunityGatingUtils").isCommentMessagesEnabled()&&a.type===d("WAWebMsgType").MSG_TYPE.COMMENT){var b;b=(b=a.targetMessageKey)==null?void 0:b.id;a=(a=a.targetMessageKey)==null?void 0:a.participant;if(b!=null&&a!=null){a=d("WAWebApiContact").getCurrentLid(a);if(a!=null)return{threadMsgId:b,threadMsgSenderLid:a}}}return{threadMsgId:null,threadMsgSenderLid:null}}function n(a){var b;return a.reactionMessage!=null||a.encReactionMessage!=null||((b=a.pollUpdateMessage)==null?void 0:b.vote)!=null||a.keepInChatMessage!=null||a.editedMessage!=null||a.pinInChatMessage!=null||a.protocolMessage!=null&&a.protocolMessage.type===d("WAWebProtobufsE2E.pb").Message$ProtocolMessage$Type.EPHEMERAL_SYNC_RESPONSE||((b=a.botInvokeMessage)==null?void 0:(b=b.message)==null?void 0:(b=b.protocolMessage)==null?void 0:b.type)===d("WAWebProtobufsE2E.pb").Message$ProtocolMessage$Type.REQUEST_WELCOME_MESSAGE||((b=a.protocolMessage)==null?void 0:b.type)===d("WAWebProtobufsE2E.pb").Message$ProtocolMessage$Type.REQUEST_WELCOME_MESSAGE||a.encEventResponseMessage!=null||((b=a.secretEncryptedMessage)==null?void 0:b.secretEncType)===d("WAWebProtobufsE2E.pb").Message$SecretEncryptedMessage$SecretEncType.EVENT_EDIT?d("WAWebBackendJobs.flow").DecryptFailType.Hide:d("WAWebBackendJobs.flow").DecryptFailType.Show}function o(a,b){var e=a.fromMe,f=a.id,g=a.participant;a=a.remoteJid;g=(g=g)!=null?g:b==null?void 0:b.toString();e!=null&&a!=null&&f!=null||h(0,56276);b=g!=null&&d("WAWebWidFactory").isWidlike(g)?d("WAWebWidFactory").createWid(g):void 0;g=d("WAWebWidFactory").createWid(a);(g.isGroup()||g.isBroadcast())&&e&&(b=d("WAWebUserPrefsMeUser").getMaybeMeUser());return new(c("WAWebMsgKey"))({fromMe:e,id:f,participant:b,remote:d("WAWebWidFactory").createWid(a)})}function p(a){var b;return{fromMe:a.fromMe,id:a.id,participant:a.fromMe?void 0:(b=a.participant)==null?void 0:b.toString({legacy:!0}),remoteJid:a.remote.toString({legacy:!0})}}function q(a){return{paymentStatus:a.status,paymentTxnStatus:a.txnStatus,paymentCurrency:a.currency||"",paymentAmount1000:c("WANullthrows")(d("WALongInt").maybeNumberOrThrowIfTooLarge(a.amount1000)),paymentMessageReceiverJid:d("WAWebWidFactory").createWid(c("WANullthrows")(a.receiverJid)),paymentExpiryTimestamp:d("WALongInt").maybeNumberOrThrowIfTooLarge(a.expiryTimestamp),paymentTransactionTimestamp:c("WANullthrows")(d("WALongInt").maybeNumberOrThrowIfTooLarge(a.transactionTimestamp))}}function r(a){var b,c=["XUS","XDX","USDP"];b=(a==null?void 0:(b=a.primaryAmount)==null?void 0:b.currencyCode)||(a==null?void 0:a.currency);return c.includes(b==null?void 0:b.toUpperCase())?!0:!1}function s(a,b){return a.remote.isGroup()&&!((a=a.participant)==null?void 0:a.equals(d("WAWebUserPrefsMeUser").getMeUser()))&&!b.equals(d("WAWebUserPrefsMeUser").getMeUser())?!1:!0}function t(a,b){return a!=null||(b==null?void 0:b.nativeFlowName)!=null?!d("WAWebBizGatingUtils").nativeFlowMessagesEnabled()?!1:u(a,b):!0}function u(a,b){return(a!=null||(b==null?void 0:b.nativeFlowName)!=null)&&(b==null?void 0:b.nativeFlowName)!=null?a!=null&&c("WAWebInteractiveMessagesNativeFlowName").cast(b.nativeFlowName)===a:!0}function v(a){return a===c("WAWebInteractiveMessagesNativeFlowName").ORDER_DETAILS||a===c("WAWebInteractiveMessagesNativeFlowName").ORDER_STATUS||a===c("WAWebInteractiveMessagesNativeFlowName").PAYMENT_STATUS||a===c("WAWebInteractiveMessagesNativeFlowName").PAYMENT_METHOD}function w(a){var b;if(((b=a.interactiveMessage)==null?void 0:(b=b.nativeFlowMessage)==null?void 0:(b=b.buttons)==null?void 0:b.length)===1)return $(a.interactiveMessage.nativeFlowMessage.buttons[0].name);if(((b=a.buttonsMessage)==null?void 0:(b=b.buttons)==null?void 0:b.length)===1){return $((b=a.buttonsMessage.buttons[0].nativeFlowInfo)==null?void 0:b.name)}}var x=["novi_login","novi_report_transaction","novi_hub","novi_view_code","novi_view_transaction","novi_view_bank_detail","novi_view_card_detail","wa_payment_transaction_details","wa_payment_learn_more","wa_payment_fbpin_reset"];function y(a){return a.some(function(a){return a.nativeFlowInfo&&x.includes(a.nativeFlowInfo.name)||x.includes(a.buttonId)})}function z(a){switch(a){case c("WAWebInteractiveMessageType").NATIVE_FLOW:return d("WAWebBizGatingUtils").interactiveNativeFlowMessagesEnabled();case c("WAWebInteractiveMessageType").SHOPS_STOREFRONT:return d("WAWebBizGatingUtils").shopsInteractiveMessageEnabled();case c("WAWebInteractiveMessageType").CAROUSEL:return d("WAWebBizGatingUtils").carouselsEnabled()}}function A(a){switch(a){case c("WAWebInteractiveMessageType").NATIVE_FLOW:return"nativeFlowMessage";case c("WAWebInteractiveMessageType").SHOPS_STOREFRONT:return"shopStorefrontMessage";case c("WAWebInteractiveMessageType").CAROUSEL:return"carouselMessage"}}function B(a){for(var b=c("WAWebInteractiveMessageType").members(),d=Array.isArray(b),e=0,b=d?b:b[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f;if(d){if(e>=b.length)break;f=b[e++]}else{e=b.next();if(e.done)break;f=e.value}f=f;if(A(f)in a)return f}return null}function C(a,b){b=b==null?void 0:b.messageVersion;if(b==null||a==null)return!1;switch(a){case c("WAWebInteractiveMessageType").NATIVE_FLOW:return b<=1;case c("WAWebInteractiveMessageType").SHOPS_STOREFRONT:return b<=1;case c("WAWebInteractiveMessageType").CAROUSEL:return b<=1}}function D(a){switch(a){case c("WAWebInteractiveResponseMessageType").NATIVE_FLOW:return"nativeFlowResponseMessage"}}function E(a){for(var b=c("WAWebInteractiveResponseMessageType").members(),d=Array.isArray(b),e=0,b=d?b:b[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f;if(d){if(e>=b.length)break;f=b[e++]}else{e=b.next();if(e.done)break;f=e.value}f=f;if(D(f)in a)return f}return null}function F(a){switch(a){case c("WAWebInteractiveResponseMessageType").NATIVE_FLOW:return d("WAWebBizGatingUtils").interactiveNativeFlowResponseMessagesEnabled()}}function G(a,b,d){switch(a){case c("WAWebInteractiveResponseMessageType").NATIVE_FLOW:b=c("WANullthrows")(b.nativeFlowResponseMessage);var e=c("WANullthrows")(c("WAWebInteractiveMessagesNativeFlowName").cast(b.name)),f=c("WANullthrows")(b.version);if(f>1||!u(e,d))throw c("err")("Invalid message");return{name:e,version:f,type:a,paramsJson:c("WANullthrows")(b.paramsJson)}}}function H(a){return a.reactionMessage!=null?!1:!0}function I(a){return a!=null&&c("WAWebWid").isWid(a)?d("WAWebWidFactory").createWid(a):a}function J(a){if(a==null)return;c("WAWebWid").isWid(a)||h(0,64887);return d("WAWebWidFactory").createWid(a)}var K=b("$InternalEnum").Mirrored(["Addon","Message"]);function L(a,b){if(!a)throw c("err")("getMsgKey: no message key is defined for protocol message");var d=a.id;if(d==null||d==="")throw c("err")("getMsgKey: no message id is defined for protocol message");return P(d,a,b)}function M(a,b,c){if(a==null)return;var d=a.id;if(d==null)return;return P(d,a,b,c)}function N(a,b){if(a==null)return;var c=a.id;if(c==null)return;return P(c,a,b,K.Addon)}function O(a,b){if(a==null)return;var c=a.id;if(c==null)return;return P(c,a,b,K.Message)}function P(a,b,e,f){var g,h,i;if(!(e==null?void 0:(g=e.id)==null?void 0:g.fromMe)){g=e.id.remote;var j=c("WAWebIsCagGroupCache").isCag(g);if(b.fromMe===!0){h=!1;i=e.author;if(j&&((j=i)==null?void 0:j.isLid())&&f!==K.Addon){j=d("WAWebApiContact").getPhoneNumber(e.author);j!=null&&(i=j)}}else{j=I(b.participant);!(j instanceof c("WAWebWid"))?h=!0:(h=d("WAWebUserPrefsMeUser").isMeAccount(j),(!g.isUser()||j.isBot())&&(h?i=j.isLid()?d("WAWebUserPrefsMeUser").getMeLidUser():d("WAWebUserPrefsMeUser").getMeUser():i=j))}}else{h=Boolean(b.fromMe);g=I(b.remoteJid);if(b.fromMe===!0){if(g instanceof c("WAWebWid")&&!g.isUser()){j=c("WAWebIsCagGroupCache").isCag(g);j=j&&f!==K.Addon;j=j||!((f=e.author)==null?void 0:f.isLid())?d("WAWebUserPrefsMeUser").getMeUser():d("WAWebUserPrefsMeUser").getMeLidUser();i=j}}else i=I(b.participant)}e.type===d("WAWebMsgType").MSG_TYPE.REACTION&&g!=null&&(g instanceof c("WAWebWid")&&g.isBroadcast()&&!g.isStatusV3()||d("WAWebJidUtils").interpretAndValidateJid(g.toString()).jidType==="broadcast")&&(g=I(b.participant),i=void 0);return new(c("WAWebMsgKey"))({id:a,fromMe:h,remote:g,participant:i})}function Q(a){return a==null||a===""||d("WAWebMobilePlatforms").getMobilePlatform()===d("WAWebMobilePlatforms").PLATFORMS.ANDROID?a:d("WAWebConvertToTextWithoutSpecialEmojis").convertToTextWithoutSpecialEmojis(a)}function R(a){var b={fromMe:a.fromMe,id:a.id},c=S(a.remote);a=S(a.participant);d("WATypeUtils").isString(c)&&(b.remoteJid=c);d("WATypeUtils").isString(a)&&(b.participant=a);return b}function S(a){if(a instanceof c("WAWebWid"))return a.toString({legacy:!0});else if(d("WATypeUtils").isString(a))return a.replace(/@c.us$/,"@s.whatsapp.net");return void 0}function T(a){return a!=null&&a!==""?d("WABase64").decodeB64(a):void 0}function U(a){var b=S(a.to);a={fromMe:!0,id:a.id.id};d("WATypeUtils").isString(b)&&(a.remoteJid=b);return a}function V(a,b,c){if(Boolean(b.viewOnce))return;b.directPath==null&&b.staticUrl==null&&d("WALogger").LOG(l(),a).sendLogs("outgoing-"+a+"-message-missing-direct-path");b.fileSha256==null&&d("WALogger").LOG(k(),a).sendLogs("outgoing-"+a+"-message-missing-file-sha");!c&&b.fileEncSha256==null&&d("WALogger").LOG(j(),a).sendLogs("outgoing-"+a+"-message-missing-file-enc-sha");b.url==null&&b.staticUrl==null&&!c&&d("WALogger").LOG(i(),a).sendLogs("outgoing-"+a+"-message-missing-mms3-url")}function W(a,b,c){var e,f,g;switch(a){case d("WAWebEphemeralityTypes").DisappearingModeInitiator.ChangedInChat:e=d("WAWebProtobufsE2E.pb").DisappearingMode$Initiator.CHANGED_IN_CHAT;break;case d("WAWebEphemeralityTypes").DisappearingModeInitiator.InitiatedByMe:e=d("WAWebProtobufsE2E.pb").DisappearingMode$Initiator.INITIATED_BY_ME;break;case d("WAWebEphemeralityTypes").DisappearingModeInitiator.InitiatedByOther:e=d("WAWebProtobufsE2E.pb").DisappearingMode$Initiator.INITIATED_BY_OTHER;break;case d("WAWebEphemeralityTypes").DisappearingModeInitiator.BizUpgradeFbHosting:e=d("WAWebProtobufsE2E.pb").DisappearingMode$Initiator.INITIATED_BY_OTHER;break}if(d("WAWebABProps").getABPropConfigValue("dm_initiator_trigger")){if(b)switch(b){case d("WAWebEphemeralityTypes").DisappearingModeTrigger.ChatSettings:f=d("WAWebProtobufsE2E.pb").DisappearingMode$Trigger.CHAT_SETTING;break;case d("WAWebEphemeralityTypes").DisappearingModeTrigger.AccountSettings:f=d("WAWebProtobufsE2E.pb").DisappearingMode$Trigger.ACCOUNT_SETTING;break;case d("WAWebEphemeralityTypes").DisappearingModeTrigger.BulkChange:f=d("WAWebProtobufsE2E.pb").DisappearingMode$Trigger.BULK_CHANGE;break;case d("WAWebEphemeralityTypes").DisappearingModeTrigger.Unknown:f=d("WAWebProtobufsE2E.pb").DisappearingMode$Trigger.UNKNOWN;break;case d("WAWebEphemeralityTypes").DisappearingModeTrigger.BizSupportFbHosting:f=d("WAWebProtobufsE2E.pb").DisappearingMode$Trigger.UNKNOWN;break}c!=null&&(g=c)}return{initiator:e,trigger:f,initiatedByMe:g}}function X(a,b){if(a.from==null)return;a=d("WAWebUserPrefsMeUser").isMeAccount(a.from);if(b.initiator==null)return;switch(b.initiator){case d("WAWebProtobufsE2E.pb").DisappearingMode$Initiator.CHANGED_IN_CHAT:return d("WAWebEphemeralityTypes").DisappearingModeInitiator.ChangedInChat;case d("WAWebProtobufsE2E.pb").DisappearingMode$Initiator.INITIATED_BY_ME:return a?d("WAWebEphemeralityTypes").DisappearingModeInitiator.InitiatedByMe:d("WAWebEphemeralityTypes").DisappearingModeInitiator.InitiatedByOther;case d("WAWebProtobufsE2E.pb").DisappearingMode$Initiator.INITIATED_BY_OTHER:case d("WAWebProtobufsE2E.pb").DisappearingMode$Initiator.BIZ_UPGRADE_FB_HOSTING:return a?d("WAWebEphemeralityTypes").DisappearingModeInitiator.InitiatedByOther:d("WAWebEphemeralityTypes").DisappearingModeInitiator.InitiatedByMe}}function Y(a,b){if(!d("WAWebABProps").getABPropConfigValue("dm_initiator_trigger"))return;a=d("WAWebUserPrefsMeUser").isMeAccount(a.from);var c=b.initiator,e=b.trigger,f=b.initiatedByMe;if(e!=null&&d("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()&&e===d("WAWebProtobufsE2E.pb").DisappearingMode$Trigger.BIZ_SUPPORTS_FB_HOSTING)return{disappearingModeTrigger:Z(e),initiatedByMe:a?f:!f};if(e!=null&&f!=null)return{disappearingModeTrigger:Z(e),initiatedByMe:a?f:!f};if(b.initiator==null)return;if(c!=null)switch(c){case d("WAWebProtobufsE2E.pb").DisappearingMode$Initiator.CHANGED_IN_CHAT:return{disappearingModeTrigger:d("WAWebEphemeralityTypes").DisappearingModeTrigger.ChatSettings};case d("WAWebProtobufsE2E.pb").DisappearingMode$Initiator.INITIATED_BY_ME:return{disappearingModeTrigger:d("WAWebEphemeralityTypes").DisappearingModeTrigger.AccountSettings,initiatedByMe:a};case d("WAWebProtobufsE2E.pb").DisappearingMode$Initiator.BIZ_UPGRADE_FB_HOSTING:case d("WAWebProtobufsE2E.pb").DisappearingMode$Initiator.INITIATED_BY_OTHER:return{disappearingModeTrigger:d("WAWebEphemeralityTypes").DisappearingModeTrigger.AccountSettings,initiatedByMe:!a}}}function Z(a){switch(a){case d("WAWebProtobufsE2E.pb").DisappearingMode$Trigger.CHAT_SETTING:return d("WAWebEphemeralityTypes").DisappearingModeTrigger.ChatSettings;case d("WAWebProtobufsE2E.pb").DisappearingMode$Trigger.ACCOUNT_SETTING:return d("WAWebEphemeralityTypes").DisappearingModeTrigger.AccountSettings;case d("WAWebProtobufsE2E.pb").DisappearingMode$Trigger.BULK_CHANGE:return d("WAWebEphemeralityTypes").DisappearingModeTrigger.BulkChange;case d("WAWebProtobufsE2E.pb").DisappearingMode$Trigger.BIZ_SUPPORTS_FB_HOSTING:return d("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()?d("WAWebEphemeralityTypes").DisappearingModeTrigger.BizSupportFbHosting:d("WAWebEphemeralityTypes").DisappearingModeTrigger.Unknown;case d("WAWebProtobufsE2E.pb").DisappearingMode$Trigger.UNKNOWN:return d("WAWebEphemeralityTypes").DisappearingModeTrigger.Unknown}}function $(a){switch(a){case"review_and_pay":return c("WAWebInteractiveMessagesNativeFlowName").ORDER_DETAILS;case"review_order":return c("WAWebInteractiveMessagesNativeFlowName").ORDER_STATUS;case"payment_status":return c("WAWebInteractiveMessagesNativeFlowName").PAYMENT_STATUS;case"payment_method":return c("WAWebInteractiveMessagesNativeFlowName").PAYMENT_METHOD;case"open_webview":return c("WAWebInteractiveMessagesNativeFlowName").MESSAGE_WITH_LINK;case"message_with_link_status":return c("WAWebInteractiveMessagesNativeFlowName").MESSAGE_WITH_LINK_STATUS;case"cta_url":return c("WAWebInteractiveMessagesNativeFlowName").CTA_URL;case"cta_call":return c("WAWebInteractiveMessagesNativeFlowName").CTA_CALL;case"quick_reply":return c("WAWebInteractiveMessagesNativeFlowName").QUICK_REPLY;case"cta_catalog":return c("WAWebInteractiveMessagesNativeFlowName").CTA_CATALOG}}b=function(a){return a};g.typeAttributeFromProtobuf=m;g.pollTypeAttributeFromProtobuf=a;g.eventTypeAttributeFromProtobuf=e;g.extractCommentTargetIdAndSenderLid=f;g.decryptFailAttributeFromProtobuf=n;g.protobufToMsgKey=o;g.msgKeyToProtobuf=p;g.parseMsgPaymentInfo=q;g.hasUnsupportedCurrency=r;g.isEitherSenderOrReceiverOfPaymentMessage=s;g.shouldParseNFM=t;g.isValidNativeFlowName=u;g.isOrderNativeFlow=v;g.getBizNativeFlowName=w;g.hasUnsupportedButtons=y;g.isInteractiveMessageTypeEnabled=z;g.getInteractiveMessageFieldNameForType=A;g.getInteractiveMessageTypeForProto=B;g.isSupportedInteractiveMessageVersion=C;g.getInteractiveResponseMessageFieldNameForType=D;g.getInteractiveResponseMessageTypeForProto=E;g.isInteractiveResponseMessageTypeEnabled=F;g.getInteractiveResponsePayload=G;g.isQuotedSupported=H;g.decodeJid=I;g.strictDecodeJid=J;g.TranslateMsgKeyType=K;g.getMsgKey=L;g.getOptionalMsgKey=M;g.translateAddonMessageKeyToLocalReference=N;g.translateRegularMessageKeyToLocalReference=O;g.translateKeyToLocalReference=P;g.convertToTextWithoutSpecialEmojis=Q;g.encodeKey=R;g.encodeJid=S;g.encodeBytes=T;g.createMessageKey=U;g.validateOutgoingRequiredMediaProperties=V;g.disappearingModeInitiatorToProto=W;g.protoToDisappearingModeInitiator=X;g.protoToDisappearingMode=Y;g.getNativeFlowNameByButtonName=$;g.getMutableMessageProtobuf=b}),98);
__d("WAWebMsgKeyUtils",["WAWebE2EProtoUtils","WAWebIsCagGroupCache","WAWebUserPrefsMeUser"],(function(a,b,c,d,e,f,g){function a(a){return a.fromMe&&d("WAWebUserPrefsMeUser").isMeAccount(a.remote)}function h(a,b){if(a===d("WAWebE2EProtoUtils").TranslateMsgKeyType.Addon){a=c("WAWebIsCagGroupCache").isCag(b);return a?d("WAWebUserPrefsMeUser").getMeLidUser():d("WAWebUserPrefsMeUser").getMeUser()}return d("WAWebUserPrefsMeUser").getMeUser()}function b(a,b){var c=a.remote;b=h(b,c);var d=a.fromMe?b:c;b=a.fromMe?c:b;c=c.isGroup()?a.participant:void 0;return{from:d,to:b,author:c}}g.isNoteToSelf=a;g.msgKeyToTargetInfo=b}),98);
__d("WAWebDBCommentMessageSerialization",["WANullthrows","WAWebDBMessageSerialization","WAWebE2EProtoUtils","WAWebMsgGetters","WAWebMsgKey","WAWebMsgKeyUtils","WAWebMsgType","WAWebWidFactory"],(function(a,b,c,d,e,f,g){function a(a){a=babelHelpers["extends"]({},a);d("WAWebDBMessageSerialization").movEncFieldToOpaqueData(a);return babelHelpers["extends"]({},a,{msgKey:a.id.toString(),parentMsgKey:a.parentMsgKey.toString(),sender:a.sender.toString()})}function b(a){var b;return{msgKey:a.id.toString(),sender:a.revokeSender.toString(),parentMsgKey:a.parentMsgKey.toString(),t:d("WAWebMsgGetters").getT(a),ack:(b=d("WAWebMsgGetters").getAck(a))!=null?b:void 0,read:a.read,isOverwrittenByRevoke:!0,subtype:a.subtype,revokeTimestamp:a.revokeTimestamp,protocolMessageKey:(b=a.protocolMessageKey)==null?void 0:b.toString()}}function e(a){var b=c("WAWebMsgKey").from(a.msgKey),e=c("WAWebMsgKey").from(a.parentMsgKey);e=babelHelpers["extends"]({id:b,parentMsgKey:e,ack:a.ack,t:a.t},d("WAWebMsgKeyUtils").msgKeyToTargetInfo(b,d("WAWebE2EProtoUtils").TranslateMsgKeyType.Addon));if(a.isOverwrittenByRevoke===!0){return babelHelpers["extends"]({},e,{type:d("WAWebMsgType").MSG_TYPE.REVOKED,kind:d("WAWebMsgType").MsgKind.RevokedAddon,subtype:c("WANullthrows")(a.subtype),revokeSender:d("WAWebWidFactory").createUserWid(a.sender),revokeTimestamp:(b=a.revokeTimestamp)!=null?b:void 0,protocolMessageKey:a.protocolMessageKey!=null?c("WAWebMsgKey").from(a.protocolMessageKey):void 0})}b=babelHelpers["extends"]({},a);d("WAWebDBMessageSerialization").movFieldFromOpaqueDataBackToMsg(b);return babelHelpers["extends"]({},e,{type:d("WAWebMsgType").MSG_TYPE.COMMENT,kind:d("WAWebMsgType").MsgKind.CommentDecrypted,from:d("WAWebWidFactory").createUserWid(b.sender),body:b.body,sender:d("WAWebWidFactory").createUserWid(b.sender),read:(e=a.read)!=null?e:!1})}g.dbRowFromCommentMessage=a;g.dbRowFromRevokedMsgData=b;g.commentMessageFromDbRow=e}),98);
__d("WAWebAddonCommentTableMode",["WAWebAddonConstants","WAWebAddonInfraError","WAWebCommentSchema","WAWebDBCommentMessageSerialization","WAWebMsgType","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){a={mode:d("WAWebAddonConstants").AddonTableMode.Comment,bulkUpsert:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.map(function(a){if(a.kind===d("WAWebMsgType").MsgKind.CommentDecrypted)return d("WAWebDBCommentMessageSerialization").dbRowFromCommentMessage(a);if(a.kind===d("WAWebMsgType").MsgKind.RevokedAddon)return d("WAWebDBCommentMessageSerialization").dbRowFromRevokedMsgData(a);throw new(d("WAWebAddonInfraError").AddonInfraError)(d("WAWebAddonInfraError").AddonInfraErrorCode.UnexpectedMsgType)});yield d("WAWebCommentSchema").getTable().bulkCreateOrReplace(a)});function c(b){return a.apply(this,arguments)}return c}(),bulkGetByParentAndSender:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){throw new(d("WAWebAddonInfraError").AddonInfraError)(d("WAWebAddonInfraError").AddonInfraErrorCode.NotSupportedFeature)});function c(){return a.apply(this,arguments)}return c}(),bulkGetByMsgKey:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=(yield d("WAWebCommentSchema").getTable().bulkGet(a.map(function(a){return a.toString()}),b));return a.map(function(a){return a==null?a:d("WAWebDBCommentMessageSerialization").commentMessageFromDbRow(a)})});function c(b,c){return a.apply(this,arguments)}return c}(),bulkGetByParentMsgKey:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){throw new(d("WAWebAddonInfraError").AddonInfraError)(d("WAWebAddonInfraError").AddonInfraErrorCode.NotSupportedFeature)});function c(){return a.apply(this,arguments)}return c}(),bulkGetByChatWid:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){throw new(d("WAWebAddonInfraError").AddonInfraError)(d("WAWebAddonInfraError").AddonInfraErrorCode.NotSupportedFeature)});function c(){return a.apply(this,arguments)}return c}(),bulkRemoveByMsgKey:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){return d("WAWebCommentSchema").getTable().bulkRemove(a.map(function(a){return a.toString()}))});function c(b){return a.apply(this,arguments)}return c}(),getByMsgKey:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("WAWebCommentSchema").getTable().get(a.toString()));return a==null?null:d("WAWebDBCommentMessageSerialization").commentMessageFromDbRow(a)});function c(b){return a.apply(this,arguments)}return c}(),updateAck:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){yield d("WAWebCommentSchema").getTable().merge(a.id.toString(),{ack:b})});function c(b,c){return a.apply(this,arguments)}return c}(),markAsRead:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("WAWebCommentSchema").getTable().merge(a.toString(),{read:!0})});function c(b){return a.apply(this,arguments)}return c}(),getTableSize:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){return d("WAWebCommentSchema").getTable().count()});function c(){return a.apply(this,arguments)}return c}()};g.commentTableMode=a}),98);
__d("WAWebEventResponseDBSerialization",["WANullthrows","WAWebE2EProtoUtils","WAWebMsgGetters","WAWebMsgKey","WAWebMsgKeyUtils","WAWebMsgType","WAWebProtobufsE2E.pb","WAWebUserPrefsMeUser","err"],(function(a,b,c,d,e,f,g){function h(a){a=d("WAWebProtobufsE2E.pb").Message$EventResponseMessage$EventResponseType.cast(new Uint8Array(a)[0]);if(a==null)throw c("err")("Value contained in array buffer is not a valid event response");return a}function i(a){var b=new ArrayBuffer(1);b=new Uint8Array(b);b[0]=a;return b.buffer}function a(a){var b=c("WANullthrows")(d("WAWebMsgGetters").getSender(a));return{msgKey:a.id.toString(),parentMsgKey:a.parentMsgKey.toString(),eventResponse:i(a.eventResponse),senderTimestampMs:a.senderTimestampMs,sender:b.toString(),t:a.t,ack:a.ack,read:d("WAWebUserPrefsMeUser").isMeAccount(b)||a.read}}function b(a){var b=c("WAWebMsgKey").from(a.msgKey);return babelHelpers["extends"]({id:b},d("WAWebMsgKeyUtils").msgKeyToTargetInfo(b,d("WAWebE2EProtoUtils").TranslateMsgKeyType.Addon),{type:d("WAWebMsgType").MSG_TYPE.EVENT_RESPONSE,kind:d("WAWebMsgType").MsgKind.EventResponseDecrypted,ack:a.ack,t:a.t,eventResponse:h(a.eventResponse),parentMsgKey:c("WAWebMsgKey").from(a.parentMsgKey),senderTimestampMs:a.senderTimestampMs,read:(b=a.read)!=null?b:!1})}g.decodeEventResponseFromDBRow=h;g.encodeEventResponseForDB=i;g.dbRowFromEventResponseMessage=a;g.eventResponseMessageFromDBRow=b}),98);
__d("WAWebAddonEventResponseTableMode",["WANullthrows","WAWebAddonConstants","WAWebAddonInfraError","WAWebEventResponseDBSerialization","WAWebEventResponsesSchema","WAWebMsgGetters","WAWebMsgType","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h={mode:d("WAWebAddonConstants").AddonTableMode.EventResponse,bulkUpsert:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("WAWebEventResponsesSchema").getTable().bulkCreateOrReplace(a.map(function(a){if(a.kind!==d("WAWebMsgType").MsgKind.EventResponseDecrypted)throw new(d("WAWebAddonInfraError").AddonInfraError)(d("WAWebAddonInfraError").AddonInfraErrorCode.NotSupportedMsgType);return d("WAWebEventResponseDBSerialization").dbRowFromEventResponseMessage(a)}))});function c(b){return a.apply(this,arguments)}return c}(),bulkGetByParentAndSender:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("WAWebEventResponsesSchema").getTable().anyOf(["parentMsgKey","sender"],a.map(function(a){return[a[0].toString(),a[1].toString()]})));return a.map(function(a){return d("WAWebEventResponseDBSerialization").eventResponseMessageFromDBRow(a)})});function c(b){return a.apply(this,arguments)}return c}(),bulkGetByMsgKey:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){throw new(d("WAWebAddonInfraError").AddonInfraError)(d("WAWebAddonInfraError").AddonInfraErrorCode.NotSupportedFeature)});function c(){return a.apply(this,arguments)}return c}(),bulkGetByParentMsgKey:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){throw new(d("WAWebAddonInfraError").AddonInfraError)(d("WAWebAddonInfraError").AddonInfraErrorCode.NotSupportedFeature)});function c(){return a.apply(this,arguments)}return c}(),bulkGetByChatWid:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){throw new(d("WAWebAddonInfraError").AddonInfraError)(d("WAWebAddonInfraError").AddonInfraErrorCode.NotSupportedFeature)});function c(){return a.apply(this,arguments)}return c}(),bulkRemoveByMsgKey:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){throw new(d("WAWebAddonInfraError").AddonInfraError)(d("WAWebAddonInfraError").AddonInfraErrorCode.NotSupportedFeature)});function c(){return a.apply(this,arguments)}return c}(),getByMsgKey:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(a=(yield d("WAWebEventResponsesSchema").getTable().equals(["msgKey"],a.toString())))==null?void 0:a[0];return a==null?a:d("WAWebEventResponseDBSerialization").eventResponseMessageFromDBRow(a)});function c(b){return a.apply(this,arguments)}return c}(),updateAck:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e;if(a.kind===d("WAWebMsgType").MsgKind.EventResponseEncrypted)e=a.targetMessageKey;else if(a.kind===d("WAWebMsgType").MsgKind.EventResponseDecrypted)e=a.parentMsgKey;else throw new(d("WAWebAddonInfraError").AddonInfraError)(d("WAWebAddonInfraError").AddonInfraErrorCode.NotSupportedMsgType);yield d("WAWebEventResponsesSchema").getTable().merge([e.toString(),c("WANullthrows")(d("WAWebMsgGetters").getSender(a)).toString()],{ack:b})});function e(b,c){return a.apply(this,arguments)}return e}(),markAsRead:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield h.getByMsgKey(a));if(a!=null)return h.bulkUpsert([babelHelpers["extends"]({},a,{read:!0})])});function c(b){return a.apply(this,arguments)}return c}(),getTableSize:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){return d("WAWebEventResponsesSchema").getTable().count()});function c(){return a.apply(this,arguments)}return c}()};g.eventResponseTableMode=h}),98);
__d("WAWebCastToPinInChatMsg",["invariant","WAWebMsgType"],(function(a,b,c,d,e,f,g,h){function i(a){return a.type===d("WAWebMsgType").MSG_TYPE.PIN_MESSAGE?a:null}function a(a){a=i(a);a!=null||h(0,76405);return a}g.castToPinInChatMsgData=i;g.assertPinInChatMsgData=a}),98);
__d("WAWebPinMsgConstants",["$InternalEnum"],(function(a,b,c,d,e,f){a={INVALID:0,PIN:1,UNPIN:2};c=b("$InternalEnum").Mirrored(["FiveSeconds","FifteenSeconds","OneMinute","OneDay","SevenDays","ThirtyDays"]);f.PIN_STATE=a;f.PinExpiryDurationOption=c}),66);
__d("WAWebPinMsgGatingUtils",["WAWebABProps"],(function(a,b,c,d,e,f,g){function a(){return d("WAWebABProps").getABPropConfigValue("pinned_messages_m1_receiver")}function b(){return d("WAWebABProps").getABPropConfigValue("pinned_messages_m1_sender")}function h(){return d("WAWebABProps").getABPropConfigValue("pinned_messages_m2")}function c(){return h()?d("WAWebABProps").getABPropConfigValue("pinned_messages_m2_pin_max"):1}g.isPinnedMessagesM1ReceiverEnabled=a;g.isPinnedMessagesM1SenderEnabled=b;g.isPinnedMessagesM2Enabled=h;g.getMaxPins=c}),98);
__d("WAWebPinsDbSerialization",["WANullthrows","WAWebE2EProtoUtils","WAWebMsgGetters","WAWebMsgKey","WAWebMsgKeyUtils","WAWebMsgType","WAWebProtobufsE2E.pb","WAWebWidFactory"],(function(a,b,c,d,e,f,g){function a(a){return babelHelpers["extends"]({},a,{msgKey:a.msgKey.toString(),parentMsgKey:a.parentMsgKey.toString(),chatId:a.chatId.toString(),sender:a.sender.toString()})}function b(a){return babelHelpers["extends"]({},a,{msgKey:c("WAWebMsgKey").fromString(a.msgKey),parentMsgKey:c("WAWebMsgKey").fromString(a.parentMsgKey),chatId:d("WAWebWidFactory").toChatWid(d("WAWebWidFactory").createWid(a.chatId)),sender:d("WAWebWidFactory").createUserWid(a.sender)})}function e(a){var b=d("WAWebWidFactory").toUserWid(c("WANullthrows")(d("WAWebMsgGetters").getSender(a))).toString();return{msgKey:a.id.toString(),ack:a.ack,t:a.t,read:a.read,parentMsgKey:a.pinParentKey.toString(),senderTimestampMs:a.pinSenderTimestampMs,chatId:a.id.remote.toString(),sender:b,pinType:a.pinMessageType,pinExpiryDuration:a.pinExpiryDuration}}function f(a){var b=c("WAWebMsgKey").fromString(a.msgKey);b=d("WAWebMsgKeyUtils").msgKeyToTargetInfo(b,d("WAWebE2EProtoUtils").TranslateMsgKeyType.Addon);var e=b.from,f=b.to;b=b.author;return{id:c("WAWebMsgKey").fromString(a.msgKey),from:e,to:f,author:b,type:d("WAWebMsgType").MSG_TYPE.PIN_MESSAGE,kind:d("WAWebMsgType").MsgKind.PinInChat,ack:a.ack,t:a.t,read:a.read,pinSenderTimestampMs:a.senderTimestampMs,pinParentKey:c("WAWebMsgKey").fromString(a.parentMsgKey),pinMessageType:(e=d("WAWebProtobufsE2E.pb").Message$PinInChatMessage$Type.cast(a.pinType))!=null?e:d("WAWebProtobufsE2E.pb").Message$PinInChatMessage$Type.UNKNOWN_TYPE,pinExpiryDuration:a.pinExpiryDuration}}g.serializePinInChat=a;g.deserializePinInChat=b;g.serializePinInChatMsgData=e;g.deserializePinInChatMsgData=f}),98);
__d("WAWebDBCRUDOperationsPinInChat",["Promise","WAArrayGroupBy","WALogger","WAWebModelStorageUtils","WAWebPinInChatSchema","WAWebPinMsgConstants","WAWebPinMsgGatingUtils","WAWebPinsDbSerialization","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["storePinInChatMsgBulk: ",""]);i=function(){return a};return a}function j(a,c){var e=new Map();c.forEach(function(a){var b=a.parentMsgKey;b=b;var c=e.get(b);(!c||(c==null?void 0:c.senderTimestampMs)<=a.senderTimestampMs)&&e.set(b,a)});return d("WAWebModelStorageUtils").getStorage().lock(["pinned-messages"],function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){b=b[0];var c=(yield b.anyOf(["chatId"],[a.toString()]));c.forEach(function(a){var b=a.parentMsgKey,c=e.get(b);c&&(c.senderTimestampMs<=a.senderTimestampMs&&e["delete"](b))});var f=new Map(c.map(function(a){return[a.parentMsgKey,a]}));e.forEach(function(a,b){f.set(b,a)});c=Array.from(f.values());c=c.filter(function(a){return a.pinType===d("WAWebPinMsgConstants").PIN_STATE.PIN}).sort(function(a,b){return b.senderTimestampMs-a.senderTimestampMs}).slice(d("WAWebPinMsgGatingUtils").getMaxPins());c.forEach(function(a){e.set(a.parentMsgKey,babelHelpers["extends"]({},a,{pinType:d("WAWebPinMsgConstants").PIN_STATE.UNPIN}))});c=Array.from(e.values());yield b.bulkCreateOrReplace(c);return c});return function(a){return c.apply(this,arguments)}}())}function a(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("WAWebPinInChatSchema").getTable().get(a.toString()));return a==null?null:d("WAWebPinsDbSerialization").deserializePinInChat(a)});return k.apply(this,arguments)}function c(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("WAWebPinInChatSchema").getTable().equals(["chatId"],a.toString()));return a.map(d("WAWebPinsDbSerialization").deserializePinInChat)});return l.apply(this,arguments)}function e(a){return d("WAWebModelStorageUtils").getStorage().lock(["pinned-messages"],function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){b=b[0];yield b.bulkRemove(a)});return function(a){return c.apply(this,arguments)}}())}function f(a){a=a.map(d("WAWebPinsDbSerialization").serializePinInChat);var c="pinInChat received: "+a.map(function(a){return a.msgKey.toString()+" to "+a.parentMsgKey}).toString()+";";d("WALogger").DEV(i(),c);c=d("WAArrayGroupBy").groupBy(a,function(a){return a.chatId});return(h||(h=b("Promise"))).all(c.map(function(a){var b=a[0];a=a[1];return j(d("WAWebWidFactory").createWid(b),a)})).then(function(a){var b;return(b=Array.prototype).concat.apply(b,a)})}g.createOrUpdatePinInChat=j;g.getPinInChatByParentKey=a;g.getPinInChatByChatId=c;g.removePinInChatByParentMsgKeys=e;g.storePinInChatMsgBulk=f}),98);
__d("WAWebAddonPinTableMode",["WAWebAddonConstants","WAWebAddonInfraError","WAWebCastToPinInChatMsg","WAWebDBCRUDOperationsPinInChat","WAWebPinInChatSchema","WAWebPinsDbSerialization","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h={mode:d("WAWebAddonConstants").AddonTableMode.Pin,bulkUpsert:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.map(function(a){return d("WAWebPinsDbSerialization").serializePinInChatMsgData(d("WAWebCastToPinInChatMsg").assertPinInChatMsgData(a))});yield d("WAWebDBCRUDOperationsPinInChat").createOrUpdatePinInChat(a[0].id.remote,b)});function c(b){return a.apply(this,arguments)}return c}(),bulkGetByParentAndSender:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){throw new(d("WAWebAddonInfraError").AddonInfraError)(d("WAWebAddonInfraError").AddonInfraErrorCode.UnexpectedError)});function c(){return a.apply(this,arguments)}return c}(),bulkGetByMsgKey:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){throw new(d("WAWebAddonInfraError").AddonInfraError)(d("WAWebAddonInfraError").AddonInfraErrorCode.UnexpectedError)});function c(){return a.apply(this,arguments)}return c}(),bulkGetByParentMsgKey:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){throw new(d("WAWebAddonInfraError").AddonInfraError)(d("WAWebAddonInfraError").AddonInfraErrorCode.NotSupportedFeature)});function c(){return a.apply(this,arguments)}return c}(),bulkGetByChatWid:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){throw new(d("WAWebAddonInfraError").AddonInfraError)(d("WAWebAddonInfraError").AddonInfraErrorCode.NotSupportedFeature)});function c(){return a.apply(this,arguments)}return c}(),bulkRemoveByMsgKey:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){throw new(d("WAWebAddonInfraError").AddonInfraError)(d("WAWebAddonInfraError").AddonInfraErrorCode.UnexpectedError)});function c(){return a.apply(this,arguments)}return c}(),getByMsgKey:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("WAWebPinInChatSchema").getTable().equals(["msgKey"],a.toString()))[0];return a==null?a:d("WAWebPinsDbSerialization").deserializePinInChatMsgData(a)});function c(b){return a.apply(this,arguments)}return c}(),updateAck:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=d("WAWebPinsDbSerialization").serializePinInChatMsgData(d("WAWebCastToPinInChatMsg").assertPinInChatMsgData(a));yield d("WAWebPinInChatSchema").getTable().merge(a.parentMsgKey,{ack:b})});function c(b,c){return a.apply(this,arguments)}return c}(),markAsRead:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield h.getByMsgKey(a));if(a!=null)return h.bulkUpsert([babelHelpers["extends"]({},a,{read:!0})])});function c(b){return a.apply(this,arguments)}return c}(),getTableSize:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){return d("WAWebPinInChatSchema").getTable().count()});function c(){return a.apply(this,arguments)}return c}()};g.pinTableMode=h}),98);
__d("WAWebLidGroupsGatingUtils",["WAWebABProps"],(function(a,b,c,d,e,f,g){function a(){return d("WAWebABProps").getABPropConfigValue("web_lid_groups_allow_reference_by_alternative_jid")}g.allowReferenceByAltJid=a}),98);
__d("WAWebMaxPerGroup",[],(function(a,b,c,d,e,f){function a(a,b,c){var d=new Map();for(var a=a,e=Array.isArray(a),f=0,a=e?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var g;if(e){if(f>=a.length)break;g=a[f++]}else{f=a.next();if(f.done)break;g=f.value}g=g;var h=c(g),i=d.get(h);(i==null||b(g)>=b(i))&&d.set(h,g)}return Array.from(d.values())}f.maxPerGroup=a}),66);
__d("WAWebPollsDbSerialization",["WAWebMsgKey","WAWebWidFactory"],(function(a,b,c,d,e,f,g){function a(a){var b={msgKey:a.msgKey.toString(),parentMsgKey:a.parentMsgKey.toString(),selectedOptionLocalIds:new Uint8Array(a.selectedOptionLocalIds).buffer,senderTimestampMs:a.senderTimestampMs,sender:a.sender.toString(),read:a.read};a.t!=null&&(b.t=a.t);a.ack!=null&&(b.ack=a.ack);return b}function b(a){return{msgKey:c("WAWebMsgKey").fromString(a.msgKey),parentMsgKey:c("WAWebMsgKey").fromString(a.parentMsgKey),selectedOptionLocalIds:Array.from(new Uint8Array(a.selectedOptionLocalIds)),senderTimestampMs:a.senderTimestampMs,t:a.t,sender:d("WAWebWidFactory").createUserWid(a.sender),ack:a.ack,read:(a=a.read)!=null?a:!0}}g.dbRowFromVote=a;g.voteFromDbRow=b}),98);
__d("WAWebLidMigrationUtils",["WAWebApiContact","WAWebE2EProtoUtils","WAWebMsgKey","WAWebUserPrefsMeUser","WAWebWidFactory"],(function(a,b,c,d,e,f,g){function a(a,b){return b.map(a?i:h)}function h(a){return a.isLid()?d("WAWebApiContact").getPhoneNumber(a):a}function i(a){return a.isLid()?a:d("WAWebApiContact").getCurrentLid(a)}function b(a){return(a=d("WAWebApiContact").getAlternateUserWid(d("WAWebWidFactory").createWid(a)))==null?void 0:a.toString()}function e(a,b){if(a!=null&&b!=null&&a.isLid()!==b.isLid()){var c=d("WAWebApiContact").getAlternateUserWid(a);if(c!=null)return[c,b];c=d("WAWebApiContact").getAlternateUserWid(b);if(c!=null)return[a,c]}return[a,b]}function f(a){var b=a.participant!=null?d("WAWebApiContact").getAlternateUserWid(a.participant):null;if(b==null)return;return new(c("WAWebMsgKey"))({fromMe:a.fromMe,remote:a.remote,id:a.id,participant:b})}function j(a,b){var c=a.id.isLid(),e=a.isCAG;a=a.isGroup&&Boolean((a=a.groupMetadata)==null?void 0:a.isLidAddressingMode);switch(b){case d("WAWebE2EProtoUtils").TranslateMsgKeyType.Addon:return c||e||a?d("WAWebUserPrefsMeUser").getMeLidUser():d("WAWebUserPrefsMeUser").assertGetMeUser();case d("WAWebE2EProtoUtils").TranslateMsgKeyType.Message:return e?a?d("WAWebUserPrefsMeUser").getMeLidUser():d("WAWebUserPrefsMeUser").assertGetMeUser():c||a?d("WAWebUserPrefsMeUser").getMeLidUser():d("WAWebUserPrefsMeUser").assertGetMeUser()}}g.normalizeWidsToAddressingMode=a;g.normalizeWidToPn=h;g.normalizeWidToLid=i;g.getAlternateJid=b;g.normalizeUserWidsToLidOrPn=e;g.getAlternateMsgKey=f;g.getMeUserLidOrJidForChat=j}),98);
__d("WAWebPollsGetVoteKey",["WAWebLidMigrationUtils","WAWebWidFactory"],(function(a,b,c,d,e,f,g){function a(a){var b=a.parentMsgKey;a=a.sender;a=d("WAWebWidFactory").createWidFromWidLike(a);return String(b)+"|"+String(d("WAWebLidMigrationUtils").normalizeWidToLid(a))+"|"+String(d("WAWebLidMigrationUtils").normalizeWidToPn(a))}g.getVoteKey=a}),98);
__d("WAWebDBPollsUpsertVotes",["WAWebApiContact","WAWebLidGroupsGatingUtils","WAWebMaxPerGroup","WAWebModelStorageUtils","WAWebPollsDbSerialization","WAWebPollsGetVoteKey","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a){var c=d("WAWebMaxPerGroup").maxPerGroup(a,function(a){return a.senderTimestampMs},d("WAWebPollsGetVoteKey").getVoteKey);return d("WAWebModelStorageUtils").getStorage().lock(["poll-votes"],function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a[0];var b=(yield a.anyOf(["parentMsgKey","sender"],h(c))),e=new Map();for(b of b)e.set(d("WAWebPollsGetVoteKey").getVoteKey(b),b);b=[];var f=[],g=[];for(var i of c){var j=e.get(d("WAWebPollsGetVoteKey").getVoteKey(i));if(j!=null){if(j.senderTimestampMs>i.senderTimestampMs){b.push(d("WAWebPollsDbSerialization").voteFromDbRow(j));continue}String(i.sender)!==String(j.sender)&&g.push(j)}var k=i.selectedOptionLocalIds.length===0;j=(j=j==null?void 0:j.read)!=null?j:!1;k=!k&&j&&i.read!==j?babelHelpers["extends"]({},i,{read:!0}):i;b.push(k);f.push(d("WAWebPollsDbSerialization").dbRowFromVote(k))}g.length>0&&(yield a.bulkRemove(f.map(function(a){return[a.parentMsgKey,a.sender]})));f.length>0&&(yield a.bulkCreateOrReplace(f));return b});return function(b){return a.apply(this,arguments)}}())}function h(a){var b=[];for(a of a){var c=a.parentMsgKey,e=a.sender;b.push([c.toString(),e.toString()]);if(d("WAWebLidGroupsGatingUtils").allowReferenceByAltJid()){e=d("WAWebApiContact").getAlternateUserWid(e);e!=null&&b.push([c.toString(),e.toString()])}}return b}g.upsertVotesDb=a}),98);
__d("WAWebPollsVoteDataUtils",["WANullthrows","WAWebE2EProtoUtils","WAWebMsgGetters","WAWebMsgKeyUtils","WAWebMsgType","WAWebUserPrefsMeUser","WAWebWidFactory"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WAWebMsgKeyUtils").msgKeyToTargetInfo(a.msgKey,d("WAWebE2EProtoUtils").TranslateMsgKeyType.Addon),c=b.from,e=b.to;b=b.author;return{id:a.msgKey,to:e,from:c,author:b,type:d("WAWebMsgType").MSG_TYPE.POLL_UPDATE,kind:d("WAWebMsgType").MsgKind.PollVoteDecrypted,pollUpdateParentKey:a.parentMsgKey,selectedOptionLocalIds:a.selectedOptionLocalIds,senderTimestampMs:a.senderTimestampMs,t:(e=a.t)!=null?e:void 0,ack:(c=a.ack)!=null?c:void 0,read:(b=a.read)!=null?b:!1}}function b(a){return{msgKey:a.id,parentMsgKey:a.pollUpdateParentKey,selectedOptionLocalIds:a.selectedOptionLocalIds,senderTimestampMs:a.senderTimestampMs,t:d("WAWebMsgGetters").getT(a),sender:d("WAWebWidFactory").toUserWid(c("WANullthrows")(d("WAWebMsgGetters").getSender(a))),ack:d("WAWebMsgGetters").getAck(a),read:d("WAWebUserPrefsMeUser").isMeAccount(a.from)||a.read}}g.voteDataToPollVoteMsgData=a;g.pollVoteMsgDataToVoteData=b}),98);
__d("WAWebAddonPollVoteTableMode",["WANullthrows","WAWebAddonConstants","WAWebAddonInfraError","WAWebDBPollsUpsertVotes","WAWebMsgType","WAWebPollsDbSerialization","WAWebPollsVoteDataUtils","WAWebPollsVotesSchema","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h={mode:d("WAWebAddonConstants").AddonTableMode.PollVote,bulkUpsert:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.map(function(a){if(a.kind!==d("WAWebMsgType").MsgKind.PollVoteDecrypted)throw new(d("WAWebAddonInfraError").AddonInfraError)(d("WAWebAddonInfraError").AddonInfraErrorCode.NotSupportedMsgType);return d("WAWebPollsVoteDataUtils").pollVoteMsgDataToVoteData(a)});yield d("WAWebDBPollsUpsertVotes").upsertVotesDb(a)});function c(b){return a.apply(this,arguments)}return c}(),bulkGetByParentAndSender:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){throw new(d("WAWebAddonInfraError").AddonInfraError)(d("WAWebAddonInfraError").AddonInfraErrorCode.UnexpectedError)});function c(){return a.apply(this,arguments)}return c}(),bulkGetByMsgKey:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){throw new(d("WAWebAddonInfraError").AddonInfraError)(d("WAWebAddonInfraError").AddonInfraErrorCode.UnexpectedError)});function c(){return a.apply(this,arguments)}return c}(),bulkGetByParentMsgKey:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){throw new(d("WAWebAddonInfraError").AddonInfraError)(d("WAWebAddonInfraError").AddonInfraErrorCode.NotSupportedFeature)});function c(){return a.apply(this,arguments)}return c}(),bulkGetByChatWid:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){throw new(d("WAWebAddonInfraError").AddonInfraError)(d("WAWebAddonInfraError").AddonInfraErrorCode.NotSupportedFeature)});function c(){return a.apply(this,arguments)}return c}(),bulkRemoveByMsgKey:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){throw new(d("WAWebAddonInfraError").AddonInfraError)(d("WAWebAddonInfraError").AddonInfraErrorCode.UnexpectedError)});function c(){return a.apply(this,arguments)}return c}(),getByMsgKey:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("WAWebPollsVotesSchema").getTable().equals(["msgKey"],a.toString()))[0];return a==null?a:d("WAWebPollsVoteDataUtils").voteDataToPollVoteMsgData(d("WAWebPollsDbSerialization").voteFromDbRow(a))});function c(b){return a.apply(this,arguments)}return c}(),updateAck:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(a.kind!==d("WAWebMsgType").MsgKind.PollVoteDecrypted&&a.kind!==d("WAWebMsgType").MsgKind.PollVoteEncrypted)throw new(d("WAWebAddonInfraError").AddonInfraError)(d("WAWebAddonInfraError").AddonInfraErrorCode.NotSupportedMsgType);yield d("WAWebPollsVotesSchema").getTable().merge([a.pollUpdateParentKey.toString(),c("WANullthrows")(a.from).toString()],{ack:b})});function e(b,c){return a.apply(this,arguments)}return e}(),markAsRead:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield h.getByMsgKey(a));if(a!=null)return h.bulkUpsert([babelHelpers["extends"]({},a,{read:!0})])});function c(b){return a.apply(this,arguments)}return c}(),getTableSize:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){return d("WAWebPollsVotesSchema").getTable().count()});function c(){return a.apply(this,arguments)}return c}()};g.pollVoteTableMode=h}),98);
__d("WAWebCastToReactionMsg",["invariant","WAWebMsgType"],(function(a,b,c,d,e,f,g,h){function i(a){return a.type===d("WAWebMsgType").MSG_TYPE.REACTION?a:null}function a(a){a=i(a);a!=null||h(0,73785);return a}function j(a){return a.type===d("WAWebMsgType").MSG_TYPE.REACTION_ENC?a:null}function b(a){a=j(a);a!=null||h(0,73784);return a}g.castToReactionMsgData=i;g.assertReactionMsgData=a;g.castToReactionEncMsgData=j;g.assertReactionEncMsgData=b}),98);
__d("WAWebReactionDataUtils",["WANullthrows","WAWebE2EProtoUtils","WAWebMsgGetters","WAWebMsgKey","WAWebMsgKeyUtils","WAWebMsgType"],(function(a,b,c,d,e,f,g){function a(a){var b=c("WAWebMsgKey").fromString(a.msgKey),e=d("WAWebMsgKeyUtils").msgKeyToTargetInfo(b,d("WAWebE2EProtoUtils").TranslateMsgKeyType.Addon),f=e.from,g=e.to;e=e.author;return{id:b,to:g,from:f,author:e,type:d("WAWebMsgType").MSG_TYPE.REACTION,kind:d("WAWebMsgType").MsgKind.ReactionDecrypted,reactionParentKey:c("WAWebMsgKey").fromString(a.parentMsgKey),reactionText:a.reactionText,reactionTimestamp:a.timestamp,t:(b=a.t)!=null?b:void 0,ack:(g=a.ack)!=null?g:void 0}}function b(a){var b;return{msgKey:a.id.toString(),parentMsgKey:a.reactionParentKey.toString(),senderUserJid:c("WANullthrows")(d("WAWebMsgGetters").getSender(a)).toString(),reactionText:a.reactionText,timestamp:a.reactionTimestamp,t:d("WAWebMsgGetters").getT(a),ack:(b=d("WAWebMsgGetters").getAck(a))!=null?b:void 0,orphan:0,read:a.read}}g.reactionRowToReactionMsgData=a;g.reactionMsgDataToReactionRow=b}),98);
__d("WAWebAddonReactionTableMode",["WANullthrows","WAWebAddonConstants","WAWebAddonInfraError","WAWebCastToReactionMsg","WAWebMsgGetters","WAWebReactionDataUtils","WAWebSchemaReactions","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h={mode:d("WAWebAddonConstants").AddonTableMode.Reaction,bulkUpsert:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.map(function(a){return d("WAWebReactionDataUtils").reactionMsgDataToReactionRow(d("WAWebCastToReactionMsg").assertReactionMsgData(a))});yield d("WAWebSchemaReactions").getReactionsTable().bulkCreateOrReplace(a)});function c(b){return a.apply(this,arguments)}return c}(),bulkGetByParentAndSender:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("WAWebSchemaReactions").getReactionsTable().anyOf(["parentMsgKey","senderUserJid"],a.map(function(a){var b=a[0];a=a[1];return[b.toString(),a.toString()]})));return a.map(d("WAWebReactionDataUtils").reactionRowToReactionMsgData)});function c(b){return a.apply(this,arguments)}return c}(),bulkGetByMsgKey:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){throw new(d("WAWebAddonInfraError").AddonInfraError)(d("WAWebAddonInfraError").AddonInfraErrorCode.UnexpectedError)});function c(){return a.apply(this,arguments)}return c}(),bulkGetByParentMsgKey:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){throw new(d("WAWebAddonInfraError").AddonInfraError)(d("WAWebAddonInfraError").AddonInfraErrorCode.NotSupportedFeature)});function c(){return a.apply(this,arguments)}return c}(),bulkGetByChatWid:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){throw new(d("WAWebAddonInfraError").AddonInfraError)(d("WAWebAddonInfraError").AddonInfraErrorCode.NotSupportedFeature)});function c(){return a.apply(this,arguments)}return c}(),bulkRemoveByMsgKey:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){throw new(d("WAWebAddonInfraError").AddonInfraError)(d("WAWebAddonInfraError").AddonInfraErrorCode.UnexpectedError)});function c(){return a.apply(this,arguments)}return c}(),getByMsgKey:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("WAWebSchemaReactions").getReactionsTable().equals(["msgKey"],a.toString()))[0];return a==null?a:d("WAWebReactionDataUtils").reactionRowToReactionMsgData(a)});function c(b){return a.apply(this,arguments)}return c}(),updateAck:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=d("WAWebCastToReactionMsg").assertReactionMsgData(a);yield d("WAWebSchemaReactions").getReactionsTable().merge([a.reactionParentKey.toString(),c("WANullthrows")(d("WAWebMsgGetters").getSender(a)).toString()],{ack:b})});function e(b,c){return a.apply(this,arguments)}return e}(),markAsRead:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield h.getByMsgKey(a));if(a!=null)return h.bulkUpsert([babelHelpers["extends"]({},a,{read:!0})])});function c(b){return a.apply(this,arguments)}return c}(),getTableSize:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){return d("WAWebSchemaReactions").getReactionsTable().count()});function c(){return a.apply(this,arguments)}return c}()};g.reactionTableMode=h}),98);
__d("WAWebAddonSelectUtils",["WAWebAddonConstants","WAWebAddonInfraError","WAWebMsgType"],(function(a,b,c,d,e,f,g){function a(a){switch(a){case d("WAWebMsgType").MSG_TYPE.PIN_MESSAGE:return d("WAWebAddonConstants").AddonTableMode.Pin;case d("WAWebMsgType").MSG_TYPE.COMMENT:return d("WAWebAddonConstants").AddonTableMode.Comment;case d("WAWebMsgType").MSG_TYPE.POLL_UPDATE:return d("WAWebAddonConstants").AddonTableMode.PollVote;case d("WAWebMsgType").MSG_TYPE.REACTION:return d("WAWebAddonConstants").AddonTableMode.Reaction;case d("WAWebMsgType").MSG_TYPE.EVENT_RESPONSE:return d("WAWebAddonConstants").AddonTableMode.EventResponse;case d("WAWebMsgType").MSG_TYPE.EVENT_EDIT_ENCRYPTED:return d("WAWebAddonConstants").AddonTableMode.None;default:throw new(d("WAWebAddonInfraError").AddonInfraError)(d("WAWebAddonInfraError").AddonInfraErrorCode.NotSupportedMsgType,"received "+a+" msgType")}}g.getTableModeByMsgType=a}),98);
__d("WAWebAddonDBTable",["WAWebAddonCommentTableMode","WAWebAddonConstants","WAWebAddonEventResponseTableMode","WAWebAddonInfraError","WAWebAddonPinTableMode","WAWebAddonPollVoteTableMode","WAWebAddonReactionTableMode","WAWebAddonSelectUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h=function(a){switch(a){case d("WAWebAddonConstants").AddonTableMode.Pin:return d("WAWebAddonPinTableMode").pinTableMode;case d("WAWebAddonConstants").AddonTableMode.PollVote:return d("WAWebAddonPollVoteTableMode").pollVoteTableMode;case d("WAWebAddonConstants").AddonTableMode.Comment:return d("WAWebAddonCommentTableMode").commentTableMode;case d("WAWebAddonConstants").AddonTableMode.Reaction:return d("WAWebAddonReactionTableMode").reactionTableMode;case d("WAWebAddonConstants").AddonTableMode.EventResponse:return d("WAWebAddonEventResponseTableMode").eventResponseTableMode;case d("WAWebAddonConstants").AddonTableMode.None:case d("WAWebAddonConstants").AddonTableMode.Unified:throw new(d("WAWebAddonInfraError").AddonInfraError)(d("WAWebAddonInfraError").AddonInfraErrorCode.UnexpectedError)}},i={bulkUpsert:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(b.length===0)return;return h(a).bulkUpsert(b)});function c(b,c){return a.apply(this,arguments)}return c}(),bulkGetByParentAndSender:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){return b.length===0?[]:h(a).bulkGetByParentAndSender(b)});function c(b,c){return a.apply(this,arguments)}return c}(),bulkGetByMsgKey:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){return h(a).bulkGetByMsgKey(b,c)});function c(b,c,d){return a.apply(this,arguments)}return c}(),bulkGetByParentMsgKey:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){return h(a).bulkGetByParentMsgKey(b)});function c(b,c){return a.apply(this,arguments)}return c}(),bulkGetByChatWid:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){return h(a).bulkGetByChatWid(b)});function c(b,c){return a.apply(this,arguments)}return c}(),bulkRemoveByMsgKey:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(b.length===0)return;return h(a).bulkRemoveByMsgKey(b)});function c(b,c){return a.apply(this,arguments)}return c}(),updateAck:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){return h(a).updateAck(b,c)});function c(b,c,d){return a.apply(this,arguments)}return c}(),getByMsgKey:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){return h(a).getByMsgKey(b)});function c(b,c){return a.apply(this,arguments)}return c}(),getTableSize:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){return h(a).getTableSize()});function c(b){return a.apply(this,arguments)}return c}()};a={bulkGetByParentAndSender:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){return i.bulkGetByParentAndSender(d("WAWebAddonSelectUtils").getTableModeByMsgType(a),b)});function c(b,c){return a.apply(this,arguments)}return c}(),getByMsgKey:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){return i.getByMsgKey(d("WAWebAddonSelectUtils").getTableModeByMsgType(a),b)});function c(b,c){return a.apply(this,arguments)}return c}()};g.addonInternalDBTable=i;g.addonDBTable=a}),98);
__d("WAWebAddonLogUtils",[],(function(a,b,c,d,e,f){function a(a){return a.some(function(a){return a.status==="rejected"})}f.hasSettledWithError=a}),66);
__d("WAWebAddonMarkAsReadUtils",["Promise","WALogger","WAWebAddonDBTable","WAWebAddonLogUtils","WAWebAddonSortUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["processMarkAsRead update failed"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["failed updating UI collection: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["failed updating UI collection: ",""]);k=function(){return a};return a}function l(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=Array.from(d("WAWebAddonSortUtils").groupAddonsByProcessor(a)).map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){return a.processor.updateCollection({add:a.addons,remove:[]})["catch"](function(a){d("WALogger").ERROR(k(),a)})});return function(b){return a.apply(this,arguments)}}());yield (h||(h=b("Promise"))).allSettled(a)});return m.apply(this,arguments)}function n(a){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=Array.from(d("WAWebAddonSortUtils").groupAddonsByTableMode(a)).map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a[0],c=a[1];return d("WAWebAddonDBTable").addonInternalDBTable.bulkUpsert(b,c).then(function(){return l(c)})["catch"](function(a){d("WALogger").LOG(j(),a);throw a})});return function(b){return a.apply(this,arguments)}}());a=(yield (h||(h=b("Promise"))).allSettled(a));d("WAWebAddonLogUtils").hasSettledWithError(a)&&d("WALogger").ERROR(i()).tags("addons","messaging").sendLogs("processMarkAsRead")});return o.apply(this,arguments)}a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.map(function(a){return a.read!=null?babelHelpers["extends"]({},a,{read:!0}):a});yield n(a)});return function(b){return a.apply(this,arguments)}}();g.processMarkAsRead=a}),98);
__d("WAWebAddonPerfUtils",["$InternalEnum","WAQplTypes","WAWebABProps","WAWebAddonConstants","WAWebAddonDBTable","WAWebQplQuickPerformanceLoggerMarkerIds","WAWebQplQuickPerformanceLoggerModule","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h=b("$InternalEnum")({BulkUpsert:"bulk_upsert"}),i=b("$InternalEnum").Mirrored(["Incoming","Outgoing","UI"]);function j(a){if(a<10001)return 1e4;else if(a<30001)return 3e4;else if(a<500001)return 5e4;else if(a<1000001)return 1e5;else if(a<3000001)return 3e5;else if(a<5000001)return 5e5;else if(a<8000001)return 8e5;return 1e6}var k={date:0,values:new Map()};function l(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=k,c=new Date().setHours(0,0,0,0);if(b.date===c){var e=b.values.get(a);if(e==null){var f=j(yield d("WAWebAddonDBTable").addonInternalDBTable.getTableSize(a));b.values.set(a,f);return f}return e}b.date=c;b.values.clear();f=j(yield d("WAWebAddonDBTable").addonInternalDBTable.getTableSize(a));b.values.set(a,f);return f});return m.apply(this,arguments)}function n(a){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){return{string:{request_type:h.getName(a.type),table_mode:d("WAWebAddonConstants").AddonTableMode.getName(a.mode)},"int":{request_size:a.size,table_size:yield l(a.mode)}}});return o.apply(this,arguments)}function p(){return d("WAWebABProps").getABPropConfigValue("addon_infra_enable_perf_logging")}function q(a){return{success:function(){return a==null?void 0:a.end(d("WAQplTypes").QuickLogActionType.SUCCESS)},fail:function(){return a==null?void 0:a.end(d("WAQplTypes").QuickLogActionType.FAIL)}}}function a(a,b){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(!p())return;switch(a){case i.Incoming:a=d("WAWebQplQuickPerformanceLoggerModule").QPL.markerStart(d("WAWebQplQuickPerformanceLoggerMarkerIds").QuickLogMarkerId.ADDON_PROCESS_INCOMING,{annotations:yield n(b)});return q(a);case i.Outgoing:a=d("WAWebQplQuickPerformanceLoggerModule").QPL.markerStart(d("WAWebQplQuickPerformanceLoggerMarkerIds").QuickLogMarkerId.ADDON_PROCESS_OUTGOING,{annotations:yield n(b)});return q(a);case i.UI:a=d("WAWebQplQuickPerformanceLoggerModule").QPL.markerStart(d("WAWebQplQuickPerformanceLoggerMarkerIds").QuickLogMarkerId.ADDON_CHAT_REQUEST,{annotations:yield n(b)});return q(a)}});return r.apply(this,arguments)}g.AnnotationRequestType=h;g.AddonQplMarkerType=i;g.getCachedTableSize=l;g.createAddonQplMarker=a}),98);
__d("WAWebAddonProcessMsgs",["Promise","WALogger","WAWebAddonConstants","WAWebAddonDBTable","WAWebAddonLogUtils","WAWebAddonPerfUtils","WAWebAddonProcessMsgsUtils","WAWebAddonSortUtils","WAWebDBStoreMessageOrphans","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["failed history sync addons processing"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["process addon msg: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["failed incoming addons processing"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[addon-infra]: processed "," orphan(s)"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[addon-infra]: processed "," addon(s) during ",", table mode ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[AddonInfraError] failed saving addons in "," with ","]"]);n=function(){return a};return a}function a(){var b=babelHelpers.taggedTemplateLiteralLoose(["failed saving addons in "," with ",""]);a=function(){return b};return b}function o(a,b,c,d){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,d){var e=c.addons,f=c.processor;c=(yield f.beforeUpsert(e,b,a));e=c.upsert;var g=c.result;d==null?void 0:(b=d.sendPerfReporter)==null?void 0:b.startRenderedStage();yield f.updateCollection({add:g,remove:[]});d==null?void 0:(c=d.sendPerfReporter)==null?void 0:c.postRenderedStage();return{upsertAddons:e,finishUpsert:function(){return f.afterUpsert(g,a)}}});return p.apply(this,arguments)}function q(a,b,c,d,e){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e,f,g){var i=(yield (h||(h=b("Promise"))).all(d("WAWebAddonSortUtils").groupAddonsByProcessor(e).map(function(b){return o(a,f,b,g)})));if(c!==d("WAWebAddonConstants").AddonTableMode.None){var j;j=(j=[]).concat.apply(j,i.map(function(a){a=a.upsertAddons;return a}));if(j.length){var k;g==null?void 0:(k=g.sendPerfReporter)==null?void 0:k.startSavedStage();k=(yield d("WAWebAddonPerfUtils").createAddonQplMarker(a.mode===d("WAWebAddonConstants").AddonProcessMode.Send?d("WAWebAddonPerfUtils").AddonQplMarkerType.Outgoing:d("WAWebAddonPerfUtils").AddonQplMarkerType.Incoming,{mode:c,type:d("WAWebAddonPerfUtils").AnnotationRequestType.BulkUpsert,size:j.length}));try{yield d("WAWebAddonDBTable").addonInternalDBTable.bulkUpsert(c,j),k==null?void 0:k.success()}catch(a){k==null?void 0:k.fail();throw a}g==null?void 0:(j=g.sendPerfReporter)==null?void 0:j.postSavedStage()}}yield h.all(i.map(function(a){a=a.finishUpsert;return a()}));d("WALogger").DEV(m(),e.length,a.mode,d("WAWebAddonConstants").AddonTableMode.getName(c)).devConsole(e)});return r.apply(this,arguments)}function s(a){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.length===0)return;var c=b("WAWebDBStoreMessageOrphans");c=c.storeMessageOrphans;yield c(a,function(a){return d("WAWebAddonProcessMsgsUtils").getAddonParentMsgKey(a)});d("WALogger").DEV(l(),a.length)});return t.apply(this,arguments)}function u(a,b,c,e){return Array.from(d("WAWebAddonSortUtils").groupAddonsByTableMode(b)).map(function(b){var f=b[0];b=b[1];return q(a,f,b,c,e)["catch"](function(a){d("WALogger").LOG(n(),f,a);throw a})})}function c(a,b){return v.apply(this,arguments)}function v(){v=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){if(a.length===0)return;var e={mode:d("WAWebAddonConstants").AddonProcessMode.OnlineReceive};a=(yield d("WAWebAddonProcessMsgsUtils").queryAddonParentMsgs(a));var f=a[0];a=a[1];a=d("WAWebAddonSortUtils").collectValidAndOrphanAddons(a,f);var g=a.validAddons;a=a.orphans;e=u(e,g,f,c);a.length!==0&&e.push(s(a));g=(yield (h||(h=b("Promise"))).allSettled(e));d("WAWebAddonLogUtils").hasSettledWithError(g)&&d("WALogger").ERROR(k()).tags("addons","messaging").sendLogs("processAddonMsgs")});return v.apply(this,arguments)}function e(a,b){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){var e={mode:d("WAWebAddonConstants").AddonProcessMode.Send};try{a=(yield d("WAWebAddonProcessMsgsUtils").queryAddonParentMsgs([a]));var f=a[0];a=a[1];e=u(e,a,f,c);yield (h||(h=b("Promise"))).all(e)}catch(a){d("WALogger").ERROR(j(),a).tags("addons","messaging").sendLogs("sendingAddonMsgs");throw a}});return w.apply(this,arguments)}function f(a){return x.apply(this,arguments)}function x(){x=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.length===0)return;var c={mode:d("WAWebAddonConstants").AddonProcessMode.HistorySync},e=new Map();c=u(c,a,e);a=(yield (h||(h=b("Promise"))).allSettled(c));d("WAWebAddonLogUtils").hasSettledWithError(a)&&d("WALogger").ERROR(i()).tags("addons","messaging").sendLogs("processHistoryAddonMsgs")});return x.apply(this,arguments)}g.processMsgs=c;g.processOutgoingMsg=e;g.processHistoryMsgs=f}),98);
__d("WAWebWamEnumBizCatalogType",[],(function(a,b,c,d,e,f){a=Object.freeze({SHOPS:0,NATIVE:1});f.BIZ_CATALOG_TYPE=a}),66);
__d("WAWebWamEnumBlockReason",[],(function(a,b,c,d,e,f){a=Object.freeze({OTHER:0,NO_LONGER_NEEDED:1,NO_SIGN_UP:2,SPAM:3,OFFENSIVE_MESSAGES:4,OTP_DID_NOT_REQUEST:5});f.BLOCK_REASON=a}),66);
__d("WAWebWamEnumChatMutedType",[],(function(a,b,c,d,e,f){a=Object.freeze({NOT_MUTED:1,MUTED_NO_NOTIFICATIONS:2,MUTED_SILENT_NOTIFICATIONS:3});f.CHAT_MUTED_TYPE=a}),66);
__d("WAWebWamEnumChatOriginsType",[],(function(a,b,c,d,e,f){a=Object.freeze({LID_USERNAME:1,LID_CTWA:2,OTHERS:3});f.CHAT_ORIGINS_TYPE=a}),66);
__d("WAWebWamEnumChatType",[],(function(a,b,c,d,e,f){a=Object.freeze({INDIVIDUAL:1,SMB:2,ENT:3,INTEROP:4});f.CHAT_TYPE=a}),66);
__d("WAWebWamEnumGaStatus",[],(function(a,b,c,d,e,f){a=Object.freeze({NEW:0,RETAINED:1,RESURRECTED:2});f.GA_STATUS=a}),66);
__d("WAWebWamEnumGroupInfoSettingType",[],(function(a,b,c,d,e,f){a=Object.freeze({ADMINS_ONLY:1,ALL_PARTICIPANTS:2});f.GROUP_INFO_SETTING_TYPE=a}),66);
__d("WAWebWamEnumOppositeVisibleIdentificationType",[],(function(a,b,c,d,e,f){a=Object.freeze({PHONE_NUMBER:1,SAVED_CONTACT_NAME:2,USERNAME:3,MASKED_PHONE_NUMBER:4,VERIFIED_BUSINESS_NAME:5,PLACEHOLDER:6,PUSHNAME:7});f.OPPOSITE_VISIBLE_IDENTIFICATION_TYPE=a}),66);
__d("WAWebChatMessageCountsWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumBizCatalogType","WAWebWamEnumBlockReason","WAWebWamEnumChatMutedType","WAWebWamEnumChatOriginsType","WAWebWamEnumChatType","WAWebWamEnumDisappearingChatInitiatorType","WAWebWamEnumEphemeralityInitiatorType","WAWebWamEnumEphemeralityTriggerActionType","WAWebWamEnumGaStatus","WAWebWamEnumGroupInfoSettingType","WAWebWamEnumOppositeVisibleIdentificationType","WAWebWamEnumTypeOfGroupEnum"],(function(a,b,c,d,e,f,g){b=(a=d("WAWebWamCodegenUtils")).defineEvents({ChatMessageCounts:[1644,{audioMessagesReceived:[149,a.TYPES.INTEGER],audioMessagesSent:[150,a.TYPES.INTEGER],awayMsgsSent:[56,a.TYPES.INTEGER],bizCatalogType:[60,d("WAWebWamEnumBizCatalogType").BIZ_CATALOG_TYPE],bizConversationDepth:[65,a.TYPES.INTEGER],blockReason:[33,d("WAWebWamEnumBlockReason").BLOCK_REASON],broadcastMsgsReceived:[30,a.TYPES.INTEGER],broadcastMsgsSent:[29,a.TYPES.INTEGER],callOffersReceived:[27,a.TYPES.INTEGER],callOffersSent:[26,a.TYPES.INTEGER],callsResultBusy:[70,a.TYPES.INTEGER],callsResultCancelled:[71,a.TYPES.INTEGER],callsResultConnected:[72,a.TYPES.INTEGER],callsResultError:[78,a.TYPES.INTEGER],callsResultMissed:[73,a.TYPES.INTEGER],callsResultRejected:[74,a.TYPES.INTEGER],canEditDmSettings:[88,a.TYPES.BOOLEAN],cartViews:[86,a.TYPES.INTEGER],chatEphemeralityDuration:[15,a.TYPES.INTEGER],chatMuted:[8,d("WAWebWamEnumChatMutedType").CHAT_MUTED_TYPE],chatOrigins:[179,d("WAWebWamEnumChatOriginsType").CHAT_ORIGINS_TYPE],chatOverflowClicks:[79,a.TYPES.INTEGER],chatTypeInd:[2,d("WAWebWamEnumChatType").CHAT_TYPE],collectionInquiriesSent:[44,a.TYPES.INTEGER],commandSheetShow:[174,a.TYPES.INTEGER],commentsReceived:[126,a.TYPES.INTEGER],commerceMsgsReceived:[41,a.TYPES.INTEGER],commerceMsgsSent:[40,a.TYPES.INTEGER],disappearingChatInitiator:[59,d("WAWebWamEnumDisappearingChatInitiatorType").DISAPPEARING_CHAT_INITIATOR_TYPE],documentMessagesReceived:[151,a.TYPES.INTEGER],documentMessagesSent:[152,a.TYPES.INTEGER],editedMsgsSent:[100,a.TYPES.INTEGER],entryPointConversionApp:[47,a.TYPES.STRING],entryPointConversionSource:[46,a.TYPES.STRING],ephemeralMessagesReceived:[14,a.TYPES.INTEGER],ephemeralMessagesSent:[13,a.TYPES.INTEGER],ephemeralMessagesUnreadExpired:[69,a.TYPES.INTEGER],ephemeralityInitiator:[109,d("WAWebWamEnumEphemeralityInitiatorType").EPHEMERALITY_INITIATOR_TYPE],ephemeralityTriggerAction:[110,d("WAWebWamEnumEphemeralityTriggerActionType").EPHEMERALITY_TRIGGER_ACTION_TYPE],eventCreationMessagesReceived:[142,a.TYPES.INTEGER],eventCreationMessagesSent:[143,a.TYPES.INTEGER],eventResponseMessagesReceived:[144,a.TYPES.INTEGER],eventResponseMessagesSent:[145,a.TYPES.INTEGER],fbCtaInquiriesSent:[45,a.TYPES.INTEGER],firstResponseTime:[25,a.TYPES.INTEGER],forwardAudioMessagesReceived:[153,a.TYPES.INTEGER],forwardAudioMessagesSent:[154,a.TYPES.INTEGER],forwardDocumentMessagesReceived:[155,a.TYPES.INTEGER],forwardDocumentMessagesSent:[156,a.TYPES.INTEGER],forwardGifMessagesReceived:[157,a.TYPES.INTEGER],forwardGifMessagesSent:[158,a.TYPES.INTEGER],forwardMessagesReceived:[89,a.TYPES.INTEGER],forwardMessagesSent:[90,a.TYPES.INTEGER],forwardPhotoMessagesReceived:[128,a.TYPES.INTEGER],forwardPhotoMessagesSent:[129,a.TYPES.INTEGER],forwardPtvMessagesReceived:[159,a.TYPES.INTEGER],forwardPtvMessagesSent:[160,a.TYPES.INTEGER],forwardStatusReplyMessagesReceived:[161,a.TYPES.INTEGER],forwardStatusReplyMessagesSent:[162,a.TYPES.INTEGER],forwardStickerMessagesReceived:[163,a.TYPES.INTEGER],forwardStickerMessagesSent:[164,a.TYPES.INTEGER],forwardTextMessagesReceived:[130,a.TYPES.INTEGER],forwardTextMessagesSent:[131,a.TYPES.INTEGER],forwardUrlMessagesReceived:[132,a.TYPES.INTEGER],forwardUrlMessagesSent:[133,a.TYPES.INTEGER],forwardVideoMessagesReceived:[165,a.TYPES.INTEGER],forwardVideoMessagesSent:[166,a.TYPES.INTEGER],gaStatus:[22,d("WAWebWamEnumGaStatus").GA_STATUS],gifMessagesReceived:[167,a.TYPES.INTEGER],gifMessagesSent:[168,a.TYPES.INTEGER],greetingMsgsSent:[57,a.TYPES.INTEGER],groupContainsBiz:[75,a.TYPES.BOOLEAN],groupInfoSetting:[87,d("WAWebWamEnumGroupInfoSettingType").GROUP_INFO_SETTING_TYPE],groupMembershipReplies:[51,a.TYPES.INTEGER],groupPrivateReplies:[52,a.TYPES.INTEGER],groupSize:[19,a.TYPES.INTEGER],hasUsername:[180,a.TYPES.BOOLEAN],imagineCommandClick:[175,a.TYPES.INTEGER],imagineMentionClick:[146,a.TYPES.INTEGER],imagineMentionShow:[176,a.TYPES.INTEGER],isAContact:[6,a.TYPES.BOOLEAN],isAGroup:[5,a.TYPES.BOOLEAN],isArchived:[10,a.TYPES.BOOLEAN],isAutoMuted:[108,a.TYPES.BOOLEAN],isBlocked:[32,a.TYPES.BOOLEAN],isCartAddClicked:[36,a.TYPES.BOOLEAN],isCommerceViewed:[35,a.TYPES.BOOLEAN],isCtaOnPdpClicked:[37,a.TYPES.BOOLEAN],isInviteCreatedThread:[106,a.TYPES.BOOLEAN],isLabelled:[54,a.TYPES.BOOLEAN],isMessageYourself:[91,a.TYPES.BOOLEAN],isOppositePartyInitiated:[62,a.TYPES.BOOLEAN],isPinned:[9,a.TYPES.BOOLEAN],isPnhEnabledChat:[92,a.TYPES.BOOLEAN],isUser1pBizBotChat:[141,a.TYPES.BOOLEAN],isUser3pBotChat:[140,a.TYPES.BOOLEAN],isUserAgent:[111,a.TYPES.BOOLEAN],isUserCreatedAgent:[123,a.TYPES.BOOLEAN],isWaPayRegistered:[81,a.TYPES.BOOLEAN],labelledMsgs:[55,a.TYPES.INTEGER],locationsSent:[96,a.TYPES.INTEGER],messagesRead:[127,a.TYPES.INTEGER],messagesReceived:[4,a.TYPES.INTEGER],messagesSent:[3,a.TYPES.INTEGER],messagesStarred:[12,a.TYPES.INTEGER],messagesUnread:[11,a.TYPES.INTEGER],metaAiMentionClick:[147,a.TYPES.INTEGER],metaAiMentionShow:[148,a.TYPES.INTEGER],newThread:[68,a.TYPES.BOOLEAN],odReceived:[82,a.TYPES.INTEGER],oppositeVisibleIdentification:[181,d("WAWebWamEnumOppositeVisibleIdentificationType").OPPOSITE_VISIBLE_IDENTIFICATION_TYPE],ordersSent:[38,a.TYPES.INTEGER],p2mOdNnpTransactionsSent:[83,a.TYPES.INTEGER],p2mOdNpTransactionsSent:[84,a.TYPES.INTEGER],paymentsSent:[39,a.TYPES.INTEGER],pdpInquiriesSent:[42,a.TYPES.INTEGER],pdpViews:[61,a.TYPES.INTEGER],photoMessagesReceived:[134,a.TYPES.INTEGER],photoMessagesSent:[135,a.TYPES.INTEGER],pollCreationMessagesReceived:[115,a.TYPES.INTEGER],pollCreationMessagesSent:[116,a.TYPES.INTEGER],pollUpdateMessagesReceived:[117,a.TYPES.INTEGER],pollUpdateMessagesSent:[118,a.TYPES.INTEGER],profileReplies:[64,a.TYPES.INTEGER],profileViews:[63,a.TYPES.INTEGER],pttMessagesReceived:[119,a.TYPES.INTEGER],pttMessagesSent:[120,a.TYPES.INTEGER],ptvMessagesReceived:[121,a.TYPES.INTEGER],ptvMessagesSent:[122,a.TYPES.INTEGER],quickRepliesSent:[58,a.TYPES.INTEGER],reactionsReceived:[97,a.TYPES.INTEGER],reactionsSent:[98,a.TYPES.INTEGER],receiverDefaultDisappearingDuration:[21,a.TYPES.INTEGER],repliesSent:[80,a.TYPES.INTEGER],requestedPhoneNumber:[93,a.TYPES.BOOLEAN],seenMaskedPhoneNumber:[94,a.TYPES.BOOLEAN],senderDefaultDisappearingDuration:[20,a.TYPES.INTEGER],sharedPhoneNumber:[99,a.TYPES.BOOLEAN],smbMarketingMessagesReactionsSent:[101,a.TYPES.INTEGER],smbMarketingMessagesRepliesSent:[102,a.TYPES.INTEGER],smbMarketingMessagesSpamReports:[103,a.TYPES.INTEGER],smbMarketingMsgsReceived:[104,a.TYPES.INTEGER],smbMarketingMsgsSent:[105,a.TYPES.INTEGER],spamReports:[31,a.TYPES.INTEGER],startTime:[7,a.TYPES.INTEGER],statusReplies:[50,a.TYPES.INTEGER],statusReplyMessagesReceived:[169,a.TYPES.INTEGER],statusViews:[49,a.TYPES.INTEGER],stickerMessagesReceived:[170,a.TYPES.INTEGER],stickerMessagesSent:[171,a.TYPES.INTEGER],storefrontInquiriesSent:[43,a.TYPES.INTEGER],suggestionPromptsClick:[177,a.TYPES.INTEGER],suggestionPromptsShow:[178,a.TYPES.INTEGER],textMessagesReceived:[136,a.TYPES.INTEGER],textMessagesSent:[137,a.TYPES.INTEGER],textMessagesToUserCreatedAgentCnt:[124,a.TYPES.INTEGER],threadDs:[66,a.TYPES.STRING],threadId:[67,a.TYPES.STRING],totalCallDuration:[28,a.TYPES.INTEGER],totalMessageEditsFromAgentCnt:[112,a.TYPES.INTEGER],totalMessageFromAgentCnt:[113,a.TYPES.INTEGER],totalMessageToAgentCnt:[114,a.TYPES.INTEGER],totalMessagesToUserCreatedAgentCnt:[125,a.TYPES.INTEGER],typeOfGroup:[85,d("WAWebWamEnumTypeOfGroupEnum").TYPE_OF_GROUP_ENUM],urlMessagesReceived:[138,a.TYPES.INTEGER],urlMessagesSent:[139,a.TYPES.INTEGER],viaContactlessChats:[107,a.TYPES.BOOLEAN],videoCallsOffered:[76,a.TYPES.INTEGER],videoMessagesReceived:[172,a.TYPES.INTEGER],videoMessagesSent:[173,a.TYPES.INTEGER],viewOnceMessagesOpened:[18,a.TYPES.INTEGER],viewOnceMessagesReceived:[17,a.TYPES.INTEGER],viewOnceMessagesSent:[16,a.TYPES.INTEGER],voiceCallsOffered:[77,a.TYPES.INTEGER]},[1,1,1],"regular"]});g.ChatMessageCountsWamEvent=b}),98);
__d("WAWebApi",[],(function(a,b,c,d,e,f){b={GROUP_INVITE:"GROUP_INVITE",MSG_SEND:"MSG_SEND",INVALID:"INVALID",CATALOG:"CATALOG",PRODUCT:"PRODUCT",PUSH_NOTIFICATION:"PUSH_NOTIFICATION",CREATE_COMMUNITY:"CREATE_COMMUNITY",NEWSLETTER:"NEWSLETTER",AVATAR_STICKERPACK:"AVATAR_STICKERPACK",ADVERTISE:"ADVERTISE",MANAGE_ADS:"MANAGE_ADS",MESSAGE_YOURSELF:"MESSAGE_YOURSELF",BROADCAST:"BROADCAST",EDIT_PROFILE_PICTURE:"EDIT_PROFILE_PICTURE",STATUS:"STATUS"};var g=/^whatsapp:\/\/.*/i;function a(a){return g.test(a)}f.APICmd=b;f.isWAURL=a}),66);
__d("WAWebApiParseUtils",["WAWebBuildConstants"],(function(a,b,c,d,e,f,g){b=function(a){return a.replace(/\/+$/,"")};c=b(d("WAWebBuildConstants").BUILD_URL).replace(/[\/\.]/g,"\\$&");e="((?:/\\w+)*)";f="(?:(?:/\\w+)*)";function a(a){a=a.hostname;return a==="whatsapp.com"||a==="www.whatsapp.com"||a==="wa.me"}g.removeTrailingSlash=b;g.ORIGIN=c;g.OPTIONAL_PATH_PART=e;g.OPTIONAL_NON_CAPTURING_PATH_PART=f;g.isWhatsappHost=a}),98);
__d("WAWebBroadcastApiParse",["$InternalEnum","WAWebApiParseUtils"],(function(a,b,c,d,e,f,g){var h="channels",i="status",j=b("$InternalEnum").Mirrored(["Newsletter","Status"]);function k(a){return a.length===0||a.length===1&&a[0]===""}function a(a){try{a=new URL(a);var b=a.pathname;b=b.split("/");b[0];var c=b[1];b=b.slice(2);if(!d("WAWebApiParseUtils").isWhatsappHost(a))return null;if(!k(b))return null;switch(c){case h:return{feature:j.Newsletter,url:a.href};case i:return{feature:j.Status,url:a.href}}}catch(a){}return null}g.BroadcastFeatureType=j;g.parseBroadcastFeatureLink=a}),98);
__d("WAWebNewsletterApiParse",["$InternalEnum","WAWebApiParseUtils","WAWebChatEntryPoint","WAWebNewsletterGatingUtils"],(function(a,b,c,d,e,f,g){var h=b("$InternalEnum").Mirrored(["Handle","InviteCode","Id"]),i="channel",j="create",k="directory";c=function(a){return a.replace(/\/+$/,"")};var l=new RegExp("^"+d("WAWebApiParseUtils").ORIGIN+d("WAWebApiParseUtils").OPTIONAL_PATH_PART+"/accept/?\\?channel_invite_code=(\\w+)$","i"),m=new RegExp("^whatsapp://("+i+")/(\\w+)/?$","i");function n(a){return a.length===0||a.length===1&&a[0]===""}function o(a){try{var b=new URL(a),c=b.pathname;c=c.split("/");c[0];var e=c[1],f=c[2];c=c.slice(3);if(e===i&&d("WAWebApiParseUtils").isWhatsappHost(b)){if(n(c))switch(f){case j:return{type:"create",url:b.href};case k:return{type:"directory",url:b.href};default:if(f!=null&&f!=="")return{identifier:f,url:b.href,identifierType:h.InviteCode,type:"view",chatEntryPoint:d("WAWebChatEntryPoint").ChatEntryPoint.Link}}if(d("WAWebNewsletterGatingUtils").isNewsletterMessageLinkEnabled()&&f!==j&&f!==k&&(c.length===1||c.length===2&&c[1]==="")){e=parseInt(c[0],10);return babelHelpers["extends"]({identifier:f,url:b.href,identifierType:h.InviteCode,type:"view",chatEntryPoint:d("WAWebChatEntryPoint").ChatEntryPoint.Link},!Number.isNaN(e)&&{serverId:e})}}c=p(l,a);if(c!=null)return c;f=p(m,a);return f!=null?f:null}catch(a){return null}}function p(a,b){a=b.match(a);if(a){var c=a[2];if(c===j)return{type:"create",url:b};return c===k?{type:"directory",url:b}:{identifier:a[2],url:a[1]||"/",identifierType:h.InviteCode,type:"view",chatEntryPoint:d("WAWebChatEntryPoint").ChatEntryPoint.Deeplink}}return null}function a(a){if(a==null)return!1;return a.startsWith("http://")||a.startsWith("https://")?o(a)!=null:o("https://"+a)!=null}g.NewsletterIdentifierType=h;g.removeTrailingSlash=c;g.parseNewsletter=o;g.isNewsletterInviteCode=a}),98);
__d("WAWebApiParse",["WABinary","WAWebABProps","WAWebApi","WAWebApiParseUtils","WAWebBroadcastApiParse","WAWebFaqUrl","WAWebNewsletterApiParse","WAWebPonyfillsUrlSearchParams"],(function(a,b,c,d,e,f,g){var h=new RegExp("^"+(b=d("WAWebApiParseUtils")).ORIGIN+b.OPTIONAL_PATH_PART+"/accept/?\\?code=(\\w+)$","i"),i=/^https?:\/\/chat\.whatsapp\.com\/invite\/(\w+)$/i,j=/^https?:\/\/chat\.whatsapp\.com\/(\w+)$/i,k=/^whatsapp:\/\/chat\/?\?code=(\w+)$/i,l=function(a){var b=a.match(h);if(b)return{code:b[2],url:b[1]||"/"};b=a.match(i);if(b)return{code:b[1]};b=a.match(j);if(b)return{code:b[1]};b=a.match(k);if(b)return{code:b[1]}},m="utm_source",n="utm_campaign",o=["utm_source","utm_campaign","text","phone","data","source","context","icebreaker","source_url","type"];function p(a){return o.find(function(b){return b===a})}var q=32;function r(a){if(!a||typeof a!=="string")return;a=d("WABinary").Binary.build(a);if(a.size()>d("WAWebABProps").getABPropConfigValue("ctwa_data_max_length"))return;return a.readBuffer()}function s(a){var b={};new(c("WAWebPonyfillsUrlSearchParams"))(a).forEach(function(a,c){c=p(c.toLowerCase());if(c==null)return;switch(c){case"data":var e=r(a);if(!e)return;b.conversionTuple==null?b.conversionTuple={conversionData:e}:b.conversionTuple.conversionData=e;break;case"source":e=a;var f=d("WABinary").numUtf8Bytes(e);if(f>q)return;b.conversionTuple==null?b.conversionTuple={conversionSource:e}:b.conversionTuple.conversionSource=e;break;case"source_url":b.ctwaContextLinkData!=null?b.ctwaContextLinkData.sourceUrl=a:b.ctwaContextLinkData={sourceUrl:a};break;case"context":b.ctwaContextLinkData!=null?b.ctwaContextLinkData.context=a:b.ctwaContextLinkData={context:a};break;case"icebreaker":b.ctwaContextLinkData!=null?b.ctwaContextLinkData.icebreaker=a:b.ctwaContextLinkData={icebreaker:a};break;case"utm_campaign":b.utm!=null?b.utm.campaign=a:b.utm={campaign:a};break;case"utm_source":b.utm!=null?b.utm.source=a:b.utm={source:a};break;default:c,b[c]=a}});b.phone!=null&&b.phone!==""&&(b.phone=b.phone.replace(/\D/g,"")+"@c.us",b.ctwaContextLinkData&&(b.ctwaContextLinkData.phone=b.phone));if(b.phone!=null&&b.phone!==""||b.text!=null&&b.text!=="")return b}var t=new RegExp("^"+b.ORIGIN+b.OPTIONAL_PATH_PART+"/send/?\\?(.+)$","i"),u=/^https?:\/\/api\.whatsapp\.com\/send\/?\?(.+)$/i,v=/^whatsapp:\/\/send\/?\?(.*)$/i,w=/^https?:\/\/wa\.me\/?(?:([0-9.]{0,20})|([0-9a-z.]{5,35}))?\/?\??(.+)?$/i;e=/^https?:\/\/wa\.me\/p\/([0-9]{0,20})\/([0-9]{0,20})$/i;f=/^whatsapp:\/\/product\/([0-9]{0,20})\/([0-9]{0,20})$/i;var x=new RegExp("^"+b.ORIGIN+b.OPTIONAL_NON_CAPTURING_PATH_PART+"/product/([0-9]{0,20})/([0-9]{0,20})$","i"),y=new RegExp("^"+b.ORIGIN+b.OPTIONAL_NON_CAPTURING_PATH_PART+"/product/([0-9]{0,20})/([0-9]{0,20})(/?.*)$","i"),z=/^https?:\/\/wa\.me\/p\/([^\/]{0,200})\/([0-9]{0,20})$/i,A=/^whatsapp:\/\/product\/([^\/]{0,200})\/([0-9]{0,20})$/i,B=new RegExp("^"+b.ORIGIN+b.OPTIONAL_NON_CAPTURING_PATH_PART+"/product/([^/]{0,200})/([0-9]{0,20})$","i"),C=/^whatsapp-smb:\/\/advertise\/?(.+)$/i,D=/^whatsapp-smb:\/\/manage-ads\/?$/,E=/^whatsapp:\/\/message_yourself\/?$/i,F=/^https?:\/\/wa\.me\/message_yourself\/?$/i,G=[e,f,z,A],H=[x,B],I=[y],J=[].concat(G,H,I);function K(a,b){for(var c=0;c<b.length;c++){var d=a.match(b[c]);if(d)return d}}e=function(a){return K(a,J)!=null};var L=new RegExp("^"+b.ORIGIN+b.OPTIONAL_NON_CAPTURING_PATH_PART+"/push/","i"),M=/^https?:\/\/wa\.me\/c\/([0-9]{0,20})$/i,N=/^whatsapp:\/\/catalog\/([0-9]{0,20})$/i,O=new RegExp("^"+b.ORIGIN+b.OPTIONAL_NON_CAPTURING_PATH_PART+"/catalog/([0-9]{0,20})?$","i"),P=new RegExp("^"+b.ORIGIN+b.OPTIONAL_NON_CAPTURING_PATH_PART+"/catalog/([0-9]{0,20})(/?.*)?$","i");f=function(a){return[M,N,O,P].some(function(b){return a.match(b)})};function Q(a){var b=a.match(t);if(b){var c=s(b[2]);if(c){c.url=b[1]||"/";return c}}b=a.match(u);if(b)return s(b[1]);b=a.match(v);if(b)return s(b[1]);b=a.match(w);if(b){var d;b[1]?d={phone:b[1]+"@c.us"}:b[2]&&(d={url:a,customURL:b[2]});if(b[3]){c=s(b[3]);c&&(d=babelHelpers["extends"]({},d,c))}return d}}var R=/^https?:\/\/wa\.me\/community\/create\/?(\?(.*))?$/i;function S(a){a=a.match(R);if(a){a=new(c("WAWebPonyfillsUrlSearchParams"))(a[1]).get("entrypoint");return{url:"/",entrypointType:a}}}function T(a){return{catalogOwnerJid:a[1]+"@s.whatsapp.net"}}function U(a){a=new(c("WAWebPonyfillsUrlSearchParams"))(a);var b=a.get(m);a=a.get(n);if(a==null&&b==null)return null;var d={};b!=null&&(d.source=b);a!=null&&(d.campaign=a);return d}function V(a){var b=a.match(M)||a.match(N);if(b)return T(b);b=a.match(O);if(b)return babelHelpers["extends"]({},T(b),{url:"/"});b=a.match(P);if(b){a=U(b[2]);return babelHelpers["extends"]({},T(b),a!=null&&{utm:a},{url:"/"})}}function W(a){return{productId:a[1],businessOwnerJid:a[2]+"@s.whatsapp.net"}}function X(a){var b=K(a,G);if(b)return W(b);b=K(a,H);if(b)return babelHelpers["extends"]({},W(b),{url:"/"});b=K(a,I);if(b){a=U(b[3]);return babelHelpers["extends"]({},W(b),a!=null&&{utm:a},{url:"/"})}}function Y(a){a=a.match(L);if(a)return{url:"/"}}function Z(a){a=new(c("WAWebPonyfillsUrlSearchParams"))(a);var b=a.get("wa_campaign_id");if(b==null||b==="")return;a=a.get("wa_campaign_type");return a==null||a===""?null:{campaignId:b,campaignType:a}}function $(a){a=a.match(C);if(a)return Z(a[1])}var aa=/^https?:\/\/wa\.me\/stickerpack\/meta-avatar$/i,ba=/^https?:\/\/wa\.me\/edit-profile-picture$/i,ca=/^https?:\/\/wa\.me\/status$/i;function da(a){a=a.match(aa);if(a)return{url:d("WAWebFaqUrl").getAvatarFaqUrl()}}function a(a){if(typeof a!=="string")return{resultType:d("WAWebApi").APICmd.INVALID};var b=l(a);if(b)return{resultType:d("WAWebApi").APICmd.GROUP_INVITE,data:b};b=V(a);if(b)return{resultType:d("WAWebApi").APICmd.CATALOG,data:b};b=X(a);if(b)return{resultType:d("WAWebApi").APICmd.PRODUCT,data:b};b=S(a);if(b)return{resultType:d("WAWebApi").APICmd.CREATE_COMMUNITY,data:b};b=da(a);if(b)return{resultType:d("WAWebApi").APICmd.AVATAR_STICKERPACK,data:b};b=d("WAWebBroadcastApiParse").parseBroadcastFeatureLink(a);if(b)return{resultType:d("WAWebApi").APICmd.BROADCAST,data:b};b=d("WAWebNewsletterApiParse").parseNewsletter(a);if(b)return{resultType:d("WAWebApi").APICmd.NEWSLETTER,data:b};if([E,F].some(function(b){return a.match(b)}))return{resultType:d("WAWebApi").APICmd.MESSAGE_YOURSELF};b=Q(a);if(b)return{resultType:d("WAWebApi").APICmd.MSG_SEND,data:b};b=Y(a);if(b)return{resultType:d("WAWebApi").APICmd.PUSH_NOTIFICATION,data:b};b=$(a);if(b!=null)return{resultType:d("WAWebApi").APICmd.ADVERTISE,data:b};if(a.match(D))return{resultType:d("WAWebApi").APICmd.MANAGE_ADS,trigger:"chatListBanner"};if(a.match(ba))return{resultType:d("WAWebApi").APICmd.EDIT_PROFILE_PICTURE};return a.match(ca)?{resultType:d("WAWebApi").APICmd.STATUS}:{resultType:d("WAWebApi").APICmd.INVALID}}g.parseConversionData=r;g.matchProductUrl=e;g.matchCatalogUrl=f;g.parseAPICmd=a}),98);
__d("WAWebBusinessProfileVersioningBridge",["WAWebBizGatingUtils","WAWebServerPropsModel"],(function(a,b,c,d,e,f,g){var h=3,i=4,j=16,k=32,l=64,m=128,n=256;function a(){return o(d("WAWebServerPropsModel").ServerProps.webBizProfileOptions)}function o(a){var b=h|i|j|l|m|k;d("WAWebBizGatingUtils").bizLinkedAccountsEnabled()&&(b|=n);return a&b}g.DIRECT_CONNECTION_FLAG=m;g.getBusinessProfileQueryVersion=a;g.getBusinessProfileQueryVersionWithCustomBizProfileOptions=o}),98);
__d("WAWapDeprecatedSmaxID",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum")({SupportContactForm:3,CtwaGetContext:4,QueryOrder:5,CreateOrder:10,RefreshCart:11,CatalogGetProductList:21,SetCatalogVisibility:23,CommerceSettingsSet:25,CatalogGetSingleCollection:30,CatalogGetCollections:35,CatalogCreateCollection:36,CatalogUpdateCollection:40,CatalogDeleteCollections:43,CatalogAppealCollection:48,BizGetPublicKey:52,MerchantGetComplianceInfo:53,MerchantSetComplianceInfo:54,CatalogVerifyPostcode:70,BtmCustomUrlGet:78,BtmCustomUrlGetUser:79,QuerySubscription:90,UpdateCollectionList:92});c=a;f["default"]=c}),66);
__d("WAWebCommsWapMd",["WALogger","WAWap","WAWapJid","WAWebWid","WAWebWidValidator","err"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["USER_JID: invalid PSA jid"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["DEVICE_JID: invalid PSA jid"]);i=function(){return a};return a}function j(a){return a.server==="lid"?d("WAWapJid").DomainType.LID:d("WAWapJid").DomainType.WHATSAPP}function a(a){if(!(a instanceof c("WAWebWid"))||!a.isUser())throw c("err")("DEVICE_JID: invalid jid type: "+(a instanceof c("WAWebWid")?a.toString():"Not an instance of WID"));if(a.isPSA()){d("WALogger").ERROR(i()).sendLogs("invalid-psa-user-jid");throw c("err")("USER_JID: invalid PSA jid")}return d("WAWapJid").WapJid.createJidU(a.user,j(a),a.device)}function b(a){if(!(a instanceof c("WAWebWid"))||!a.isUser())throw c("err")("USER_JID: invalid jid type: "+(a instanceof c("WAWebWid")?a.toString():"Not an instance of WID"));if(a.isPSA()){d("WALogger").ERROR(h()).sendLogs("invalid-psa-user-jid");throw c("err")("USER_JID: invalid PSA jid")}return d("WAWapJid").WapJid.create(a.user,a.getJidServer())}function e(a){if(!(a instanceof c("WAWebWid"))||!a.isUser()&&!a.isGroup()&&!a.isBroadcast()&&!a.isNewsletter())throw c("err")("CHAT_JID: invalid jid type: "+(a instanceof c("WAWebWid")?a.toString():"Not an instance of WID"));return d("WAWapJid").WapJid.create(a.user,a.getJidServer())}function f(a){if(!(a instanceof c("WAWebWid"))||!a.isGroup())throw c("err")("GROUP_JID: invalid jid type: "+(a instanceof c("WAWebWid")?a.toString():"Not an instance of WID"));return d("WAWapJid").WapJid.create(a.user,d("WAWebWidValidator").Domains.G_US)}function k(a){if(!(a instanceof c("WAWebWid"))||!a.isGroupCall())throw c("err")("GROUP_CALL_JID: invalid jid type: "+(a instanceof c("WAWebWid")?a.toString():"Not an instance of WID"));return d("WAWapJid").WapJid.create(a.user,d("WAWebWidValidator").Domains.CALL)}function l(a){if(!(a instanceof c("WAWebWid")))throw c("err")("JID: invalid jid type: "+(a instanceof c("WAWebWid")?a.toString():"Not an instance of WID"));var b=a.device==null||a.device===0;return!b?d("WAWapJid").WapJid.createJidU(a.user,j(a),a.device):d("WAWapJid").WapJid.create(a.user,a.getJidServer())}var m=function(a){if(!a||!Array.isArray(a)||a.length!==3)throw c("err")("Invalid VOIP xml node");function b(a){if(!a)return null;if(Array.isArray(a)){var e=a[0],f=a[1],g=void 0;f&&Object.keys(f).map(function(a){g||(g={});var b=f[a];if(!b)throw c("err")("Attribute value is null");else if(typeof b==="object"){var e=b.type;if(e===d("WAWapJid").WAP_JID_SUBTYPE.JID||d("WAWapJid").WAP_JID_SUBTYPE.JID_AD||d("WAWapJid").WAP_JID_SUBTYPE.JID_U)b=new(d("WAWapJid").WapJid)(b);else throw c("err")("Invalid attribute value type")}g[a]=b});var h=a[2],i=null;Array.isArray(h)&&h.length>0&&(typeof h[0]==="number"?i=new Uint8Array(h):i=h.map(b).filter(function(a){return a}));h=i;return new(d("WAWap").WapNode)(e,g,h)}return a}return b(a)},n=function(a){function b(a){var c=[];c.push(a.tag);c.push(a.attrs||{});Array.isArray(a.content)&&a.content.filter(function(a){return!Array.isArray(a)})===0?c.push(a.content):Array.isArray(a.content)?c.push(a.content.map(function(a){return b(a)})):a.content!=null?a.content instanceof Uint8Array?c.push(Array.from(a.content)):c.push(a.content):c.push(null);return c}return b(a)};g.DEVICE_JID=a;g.USER_JID=b;g.CHAT_JID=e;g.GROUP_JID=f;g.GROUP_CALL_JID=k;g.JID=l;g.voipXmlToWapNode=m;g.wapNodeToVoipXml=n}),98);
__d("WAWebMerchantComplianceJob",["WADeprecatedSendIq","WADeprecatedWapParser","WAWap","WAWapDeprecatedSmaxID","WAWebBackendErrors","WAWebCommsWapMd","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h=function(a){var b;return{email:(a==null?void 0:(b=a.maybeChild("email"))==null?void 0:b.contentString())||"",landline_number:(a==null?void 0:(b=a.maybeChild("landline_number"))==null?void 0:b.contentString())||"",mobile_number:(a==null?void 0:(b=a.maybeChild("mobile_number"))==null?void 0:b.contentString())||""}},i=new(c("WADeprecatedWapParser"))("merchantComplianceResponse",function(a){a.assertTag("iq");a.assertFromServer();var b=[];a.forEachChildWithTag("merchant_info",function(a){var c,d,e,f;c=((c=a.maybeChild("entity_name"))==null?void 0:c.contentString())||"";d=((d=a.maybeChild("entity_type"))==null?void 0:d.contentString())||"";e=(e=a.maybeChild("entity_type_custom"))==null?void 0:e.contentString();var g=a.attrString("is_registered")==="true",i=a.maybeChild("customer_care_details");a=a.maybeChild("grievance_officer_details");i=babelHelpers["extends"]({},h(i));f=babelHelpers["extends"]({name:(a==null?void 0:(f=a.maybeChild("name"))==null?void 0:f.contentString())||""},h(a));b.push({entity_name:c,entity_type:d,is_registered:g,entity_type_custom:e,customer_care_details:i,grievance_officer_details:f})});return b});function a(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b;b=(b=d("WAWap")).wap("iq",{to:b.S_WHATSAPP_NET,xmlns:"w:biz:merchant_info",id:b.generateId(),type:"get",smax_id:b.SMAX_ID(c("WAWapDeprecatedSmaxID").MerchantGetComplianceInfo)},a.map(function(a){return d("WAWap").wap("merchant_info",{jid:d("WAWebCommsWapMd").USER_JID(a.wid)})}));a=(yield d("WADeprecatedSendIq").deprecatedSendIq(b,i));if(!a.success)throw new(d("WAWebBackendErrors").ServerStatusCodeError)(a.errorCode);else return a.result});return j.apply(this,arguments)}function e(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a===void 0?{}:a;var b=a.entityName,e=a.entityType,f=a.isRegistered;f=f===void 0?!1:f;var g=a.entityTypeCustom,h=a.customerCareDetails;a=a.grievanceOfficerDetails;f=d("WAWap").wap("iq",{to:d("WAWap").S_WHATSAPP_NET,xmlns:"w:biz:merchant_info",id:d("WAWap").generateId(),type:"set",smax_id:d("WAWap").SMAX_ID(c("WAWapDeprecatedSmaxID").MerchantSetComplianceInfo)},d("WAWap").wap("merchant_info",{is_registered:f?"true":"false"},b!==void 0?d("WAWap").wap("entity_name",null,b):null,e!==void 0?d("WAWap").wap("entity_type",null,e):null,g!==void 0?d("WAWap").wap("entity_type_custom",null,g):null,h?d("WAWap").wap("customer_care_details",null,h.email!==void 0?d("WAWap").wap("email",null,h.email):null,h.landlineNumber!==void 0?d("WAWap").wap("landline_number",null,h.landlineNumber):null,h.mobileNumber!==void 0?d("WAWap").wap("mobile_number",null,h.mobileNumber):null):null,a?d("WAWap").wap("grievance_officer_details",null,a.name!==void 0?d("WAWap").wap("name",null,a.name):null,a.email!==void 0?d("WAWap").wap("email",null,a.email):null,a.landlineNumber!==void 0?d("WAWap").wap("landline_number",null,a.landlineNumber):null,a.mobileNumber!==void 0?d("WAWap").wap("mobile_number",null,a.mobileNumber):null):null));b=(yield d("WADeprecatedSendIq").deprecatedSendIq(f,i));if(!b.success)throw new(d("WAWebBackendErrors").ServerStatusCodeError)(b.errorCode);else return b.result});return k.apply(this,arguments)}g.getMerchantCompliance=a;g.setMerchantCompliance=e}),98);
__d("WAWebObjectRemoveUndefinedKeyValues",["lodash"],(function(a,b,c,d,e,f,g){var h=function(a){return a==null};function a(a){return c("lodash").omitBy(a,h)}g["default"]=a}),98);
__d("WAWebCommonParsersParseBusinessProfile",["WAWebBizGatingUtils","WAWebBotTypes","WAWebBusinessProfileTypes","WAWebObjectRemoveUndefinedKeyValues","cr:5664","gkx"],(function(a,b,c,d,e,f,g){function a(a){var e=a.maybeChild("address");e=e?e.contentString():void 0;var f,g=a.maybeChild("description");g&&(f=g.contentString());g=a.maybeChild("email");g=g?g.contentString():void 0;var j=a.maybeChild("latitude");j=j?parseFloat(j.contentString()):void 0;var k=a.maybeChild("longitude");k=k?parseFloat(k.contentString()):void 0;var l=a.maybeChild("vertical"),m;if(l){var n=l.maybeAttrString("canonical");l=l.hasContent()?l.contentString():void 0;m={name:l,canonical:n}}var o=[];a.forEachChildWithTag("website",function(a){o.push(a.contentString())});var p=[];l=a.maybeChild("categories");l&&l.forEachChildWithTag("category",function(a){var b=a.attrString("id");p.push({id:b,localized_display_name:a.contentString()})});var q;n=a.maybeChild("business_hours");if(n){l=n.maybeAttrString("timezone");var r=[];n.forEachChildWithTag("business_hours_config",function(a){r.push({day_of_week:a.attrString("day_of_week"),mode:a.attrString("mode"),open_time:a.hasAttr("open_time")?parseInt(a.attrString("open_time"),10):0,close_time:a.hasAttr("close_time")?parseInt(a.attrString("close_time"),10):0})});q={config:r,timezone:l}}var s;n=a.maybeChild("profile_options");if(n){s={};l=n.maybeChild("commerce_experience");if(l){s.commerce_experience=(l=d("WAWebBusinessProfileTypes").CommerceExperienceTypes.cast(l.contentString()))!=null?l:d("WAWebBusinessProfileTypes").CommerceExperienceTypes.NONE}l=n.maybeChild("cart_enabled");l&&(s.cart_enabled=l.contentString()==="true");l=n.maybeChild("shop_url");l&&(s.shop_url=l.contentString());l=n.maybeChild("commerce_manager_url");l&&(s.commerce_manager_url=l.contentString());l=n.maybeChild("is_banned");l&&(s.is_banned=l.contentString()==="true");l=n.maybeChild("direct_connection");l&&(s.direct_connection=l.contentString()==="true");l=n.maybeChild("is_profile_edit_disabled");l&&(s.is_profile_edit_disabled=l.contentString()==="true")}n=a.maybeChild("direct_connection");var t;if(n){l=n.maybeChild("default_postcode");t={enabled:n.maybeAttrString("enabled")==="true",defaultPostcode:l?{code:l.attrString("code"),locationName:l.attrString("location_name")}:void 0}}n=a.maybeChild("catalog_status");l=n?n.attrString("status"):void 0;n={};var u={},v=!1,w,x=a.maybeChild("linked_accounts");if(x){v=!0;var y=x.maybeChild("fb_page");if(y){var z=y.maybeChild("display_name"),A=y.maybeChild("likes");n={displayName:z==null?void 0:z.contentString(),likes:A==null?void 0:A.contentString(),id:y.maybeAttrString("id")}}z=x.maybeChild("ig_professional");if(z){A=z.maybeChild("ig_handle");y=z.maybeChild("followers");u={handle:A==null?void 0:A.contentString(),followers:y==null?void 0:y.contentString()}}}x=a.maybeChild("cover_photo");z=x?{id:x.attrString("id"),url:new URL(x.contentString())}:void 0;if(d("WAWebBizGatingUtils").isCustomURLViaBizProfileEnabled()){A=a.maybeChild("custom_url");A&&(w=A==null?void 0:A.contentString())}x=d("WAWebBotTypes").BizBotAutomatedType.cast((y=a.maybeChild("automated_type"))==null?void 0:y.contentString());y=d("WAWebBotTypes").BotWelcomeMsgProtocolModeType.cast((A=a.maybeChild("welcome_message_protocol_mode"))==null?void 0:A.contentString());var B;A=a.maybeChild("prompts");A&&(B=h(A));A=(A=a.maybeChild("commands"))==null?void 0:(A=A.maybeChild("description"))==null?void 0:A.contentString();var C;a=a.maybeChild("commands");a&&(C=i(a));!c("gkx")("26258")&&b("cr:5664")&&(b("cr:5664").debugBotConfigs.injectBizBotFields===!0&&(y=d("WAWebBotTypes").BotWelcomeMsgProtocolModeType.BASIC,f="Hello! I'm Midjourney, your personal assistant. I'm here to assist you with anything you might need, from travel information to workout plans, and even caring for your plants. I can even sketch your imagination!",B=[{emoji:"\u2728",text:"Create an alien world!"},{emoji:"\ud83d\udd25",text:"Show a future city!"},{emoji:"\u2728",text:"Fantasy landscape? Generate now!"},{emoji:"\ud83d\udd25",text:"Describe a mythical world filled with magical creatures and let the bot generate an image that brings it to life!"},{emoji:"\u2728",text:"Picture an enchanted forest with towering trees, sparkling fairies, and vibrant flora, and let the bot create an image that captures its magic!"},{emoji:"\ud83d\udd25",text:"Imagine yourself as a time traveler who has just stepped into an ancient civilization. You find yourself surrounded by towering structures and exotic landscapes that are unfamiliar to you. Take a moment to observe the surroundings, notice the intricate details on the buildings and the unique attire worn by the people. Now, let the bot generate an image that captures the essence of this unexplored world, bringing forth a visual representation that transcends time and space!"}],A="Try these commands to get started",C=[{description:"Create images with Midjourney",name:"imagine"},{description:"View and adjust your personal settings",name:"settings"},{description:"Blend images together seamlessly",name:"blend"},{description:"View information about your profile",name:"info"},{description:"Subscribe to the profile for updates",name:"subscribe"}],o.length===0&&(o=["https://meta.com"])));a={address:e,description:f,email:g,latitude:j,longitude:k,vertical:m,website:o,categories:p,business_hours:q,catalog_status:l,profile_options:s,fbPage:n,igProfessional:u,isProfileLinked:v,directConnection:t,cover_photo:z,customUrlPath:w,prompts:B,commands:C,commands_description:A,automated_type:x,welcome_message_protocol_mode:y};return c("WAWebObjectRemoveUndefinedKeyValues")(a)}function h(a){var b=[];a.forEachChildWithTag("prompt",function(a){var c=a.maybeChild("emoji");c=(c=c==null?void 0:c.contentString())!=null?c:"";a=a.maybeChild("text");a=(a=a==null?void 0:a.contentString())!=null?a:"";b.push({emoji:c,text:a})});return b}function i(a){var b=[];a.forEachChildWithTag("command",function(a){var c=a.maybeChild("name");c=(c=c==null?void 0:c.contentString())!=null?c:"";a=a.maybeChild("description");a=(a=a==null?void 0:a.contentString())!=null?a:"";b.push({name:c,description:a})});return b}g["default"]=a}),98);
__d("WAWebJidToWid",["WAWebJidUtils","WAWebWidFactory"],(function(a,b,c,d,e,f,g){function a(a){return d("WAWebWidFactory").createUserWid(a)}function b(a){return d("WAWebWidFactory").toUserWid(d("WAWebWidFactory").createWid(a))}function c(a){return d("WAWebWidFactory").createDeviceWid(a)}function e(a){return d("WAWebWidFactory").toChatWid(d("WAWebWidFactory").createWid(a))}function f(a){return d("WAWebWidFactory").createWid(a)}function h(a){a=d("WAWebJidUtils").extractJidFromJidWithType(a);return d("WAWebWidFactory").createWid(a)}function i(a){return d("WAWebWidFactory").createWid(a)}g.userJidToUserWid=a;g.deviceJidToUserWid=b;g.deviceJidToDeviceWid=c;g.chatJidToChatWid=e;g.groupJidToWid=f;g.jidWithTypeToWid=h;g.newsletterJidToWid=i}),98);
__d("WAWebQueryBusinessProfileJob",["WADeprecatedSendIq","WADeprecatedWapParser","WAWap","WAWebBackendErrors","WAWebCommonParsersParseBusinessProfile","WAWebCommsWapMd","WAWebJidToWid","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h=new(c("WADeprecatedWapParser"))("businessProfileResponse",function(a){a.assertTag("iq");a.assertFromServer();a=a.child("business_profile");var b=[];a.forEachChildWithTag("profile",function(a){var e=d("WAWebJidToWid").jidWithTypeToWid(a.attrJidWithType("jid")),f=a.attrString("tag");a=c("WAWebCommonParsersParseBusinessProfile")(a);Object.keys(a).length?b.push({wid:e,tag:f,profile:a}):b.push({wid:e,tag:f})});return b});function a(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c;c=(c=d("WAWap")).wap("iq",{to:c.S_WHATSAPP_NET,xmlns:"w:biz",id:c.generateId(),type:"get"},c.wap("business_profile",{v:c.INT(b)},a.map(function(a){return d("WAWap").wap("profile",{jid:d("WAWebCommsWapMd").USER_JID(a.wid),tag:a.tag!=null?d("WAWap").INT(a.tag):d("WAWap").DROP_ATTR})})));b=(yield d("WADeprecatedSendIq").deprecatedSendIq(c,h));if(!b.success)throw new(d("WAWebBackendErrors").ServerStatusCodeError)(b.errorCode);else return b.result});return i.apply(this,arguments)}g["default"]=a}),98);
__d("WAWebQueryBusinessProfile",["Promise","WAWebBackendErrors","WAWebBusinessProfileVersioningBridge","WAWebMerchantComplianceJob","WAWebQueryBusinessProfileJob"],(function(a,b,c,d,e,f,g){var h;function a(a,e){var f=d("WAWebBusinessProfileVersioningBridge").getBusinessProfileQueryVersion();e?e=(h||(h=b("Promise"))).all([c("WAWebQueryBusinessProfileJob")(a,f),d("WAWebMerchantComplianceJob").getMerchantCompliance(a)]).then(i):e=c("WAWebQueryBusinessProfileJob")(a,f);return d("WAWebBackendErrors").attachErrorLogger(e,"Query business profile failed")}function i(a){var b=a[0],c=a[1];return b.map(function(a,b){return babelHelpers["extends"]({},a,{profile:babelHelpers["extends"]({},a.profile,{legal_entity_details:c[b]})})})}g.queryBusinessProfile=a;g.mergeBusinessProfileAndCompliance=i}),98);
__d("WAWebChatThreadLoggingUtils",["WABase64","WACryptoHmac","WALogger","WATimeUtils","WAWebApiParse","WAWebBusinessProfileTypes","WAWebEphemeralityTypes","WAWebInteractiveMessagesNativeFlowName","WAWebMsgType","WAWebQueryBusinessProfile","WAWebWamEnumEphemeralityInitiatorType","WAWebWamEnumEphemeralityTriggerActionType","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(['Thread Logging: Failed to query business profile to set "biz_catalog_type"']);h=function(){return a};return a}var i=new TextEncoder(),j=function(a){return i.encode(a).buffer};function k(a,b){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=(yield d("WACryptoHmac").hmacSha256(a,b));return d("WABase64").encodeB64(a)});return l.apply(this,arguments)}function a(a,b,c){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){b=j(b+c);return k(a,b)});return m.apply(this,arguments)}function e(a,b){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){b=j(b);return k(a,b)});return n.apply(this,arguments)}function f(a){return d("WATimeUtils").toDate(d("WATimeUtils").castToUnixTime(a-8*d("WATimeUtils").HOUR_SECONDS)).toISOString().split("T")[0].replace(/-/g,"/")}function o(a,b){var c=b%d("WATimeUtils").DAY_SECONDS;b=b-c;return c>=a?b+a:b-d("WATimeUtils").DAY_SECONDS+a}function p(a,b,c){return o(a,b)>c}function q(a){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b;try{b=(yield d("WAWebQueryBusinessProfile").queryBusinessProfile([{wid:a}]))}catch(a){d("WALogger").ERROR(h()).verbose().devConsole(a).sendLogs("query-business-profile-fail");return null}a=b[0];if(!a)return null;a=(a=a.profile)==null?void 0:(a=a.profile_options)==null?void 0:a.commerce_experience;if(a===d("WAWebBusinessProfileTypes").CommerceExperienceTypes.CATALOG)return"native";else if(a===d("WAWebBusinessProfileTypes").CommerceExperienceTypes.SHOP)return"shop";return null});return r.apply(this,arguments)}function s(a){return[d("WAWebMsgType").MSG_TYPE.KEEP_IN_CHAT].includes(a.type)?!1:!0}function t(a){var b=new Set([d("WAWebMsgType").MSG_TYPE.PRODUCT,d("WAWebMsgType").MSG_TYPE.ORDER,d("WAWebMsgType").MSG_TYPE.LIST]);return b.has(a.type)||b.has((b=a.quotedMsg)==null?void 0:b.type)||!!(a.matchedText!=null&&a.matchedText!==""&&u(a.matchedText))||a.type===d("WAWebMsgType").MSG_TYPE.NATIVE_FLOW&&(a.nativeFlowName===c("WAWebInteractiveMessagesNativeFlowName").ORDER_DETAILS||a.nativeFlowName===c("WAWebInteractiveMessagesNativeFlowName").ORDER_STATUS)}function u(a){return d("WAWebApiParse").matchCatalogUrl(a)||d("WAWebApiParse").matchProductUrl(a)}function v(a){if(a==null)return null;switch(a){case d("WAWebEphemeralityTypes").DisappearingModeTrigger.AccountSettings:return d("WAWebWamEnumEphemeralityTriggerActionType").EPHEMERALITY_TRIGGER_ACTION_TYPE.ACCOUNT_SETTINGS;case d("WAWebEphemeralityTypes").DisappearingModeTrigger.ChatSettings:return d("WAWebWamEnumEphemeralityTriggerActionType").EPHEMERALITY_TRIGGER_ACTION_TYPE.CHAT_SETTINGS;case d("WAWebEphemeralityTypes").DisappearingModeTrigger.BulkChange:return d("WAWebWamEnumEphemeralityTriggerActionType").EPHEMERALITY_TRIGGER_ACTION_TYPE.BULK_CHANGE;default:return null}}function w(a){if(a==null)return null;return a?d("WAWebWamEnumEphemeralityInitiatorType").EPHEMERALITY_INITIATOR_TYPE.INITIATED_BY_ME:d("WAWebWamEnumEphemeralityInitiatorType").EPHEMERALITY_INITIATOR_TYPE.INITIATED_BY_OTHER}g.generateThreadID=a;g.generateThreadIDHMAC=e;g.getThreadDs=f;g.computeStartTs=o;g.shouldUpdateChatEvent=p;g.getBizCatalogType=q;g.shouldIncrementMsgSendAndReceive=s;g.isCommerceMessage=t;g.getWamDisappearingModeTrigger=v;g.getWamDisappearingModeInitiatedByMe=w}),98);
__d("WAWebChatThreadLoggingEventUploader",["Promise","WALogger","WANullthrows","WATimeUtils","WAWebABProps","WAWebBotGating","WAWebBotTypes","WAWebChatMessageCountsWamEvent","WAWebChatThreadLoggingBoolFlagFields","WAWebChatThreadLoggingCountFields","WAWebChatThreadLoggingUtils","WAWebGroupType","WAWebWamEnumChatMutedType","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["uploadEvents: uploaded "," events but only deleted "," (they should be the same!)"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["chat_thread_logging: error uploading events: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["ChatThreadLoggingBatchEventUploader: secret not in store!"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["ChatThreadLoggingBatchEventUploader: offset not in store!"]);l=function(){return a};return a}a=function(){function a(a,b){this.eventStore=b,this.metadataStore=a}var e=a.prototype;e.uploadEvents=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e,f=this;e=(e=a==null?void 0:a.purgeAfter)!=null?e:!0;var g=(yield this.metadataStore.getOffset());if(g==null){d("WALogger").WARN(l());return-1}a=(a=a==null?void 0:a.lastStartTs)!=null?a:d("WAWebChatThreadLoggingUtils").computeStartTs(g,d("WATimeUtils").unixTime()-d("WATimeUtils").DAY_SECONDS);if(this.secret==null){g=(yield this.metadataStore.getSecret());if(g==null){d("WALogger").WARN(k());return-1}this.secret=g}g=(yield this.eventStore.getBeforeInclusive(a));try{yield (h||(h=b("Promise"))).all(g.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=d("WAWebChatThreadLoggingUtils").getThreadDs(a.startTs),e=a.contactInfo,g=new(d("WAWebChatMessageCountsWamEvent").ChatMessageCountsWamEvent)({messagesSent:a.msgsSent,messagesReceived:a.msgsReceived,viewOnceMessagesSent:a.viewOnceMsgsSent,viewOnceMessagesReceived:a.viewOnceMsgsReceived,viewOnceMessagesOpened:a.viewOnceMessagesOpened,threadDs:b,threadId:yield d("WAWebChatThreadLoggingUtils").generateThreadID(c("WANullthrows")(f.secret),a.chatId,b),isAGroup:a.contactInfo.isAGroup,groupSize:e.isAGroup?e.groupSize:void 0,isAContact:e.isAGroup?void 0:e.isAContact,isArchived:a.isArchived,isPinned:a.isPinned,messagesStarred:a.messagesStarred,messagesRead:a.msgsRead,messagesUnread:a.messagesUnread,chatMuted:a.isMuted?d("WAWebWamEnumChatMutedType").CHAT_MUTED_TYPE.MUTED_NO_NOTIFICATIONS:d("WAWebWamEnumChatMutedType").CHAT_MUTED_TYPE.NOT_MUTED,callOffersSent:a.callOffersSent,callOffersReceived:a.callOffersReceived,totalCallDuration:a.totalCallDuration,typeOfGroup:a.contactInfo.groupType!=null?d("WAWebGroupType").groupTypeToWamEnum(a.contactInfo.groupType):void 0,isPnhEnabledChat:a.isPnhEnabledChat,reactionsSent:a.reactionsSent,reactionsReceived:a.reactionsReceived,isMessageYourself:a.isMessageYourself,forwardMessagesSent:a.forwardMessagesSent,forwardMessagesReceived:a.forwardMessagesReceived,editedMsgsSent:a.editedMsgsSent,totalMessageToAgentCnt:a.botMessagesSent,totalMessageFromAgentCnt:a.botMessagesReceived,totalMessageEditsFromAgentCnt:a.botMessagesEdited,isUserAgent:a.isUserAgent});d("WAWebABProps").getABPropConfigValue("dm_initiator_trigger")&&(a.ephemeralityTriggerAction!=null&&(g.ephemeralityTriggerAction=a.ephemeralityTriggerAction),a.ephemeralityInitiator!=null&&(g.ephemeralityInitiator=a.ephemeralityInitiator));d("WAWebChatThreadLoggingCountFields").COUNT_FIELD_NAMES.forEach(function(b){g[b]=a[b]});d("WAWebChatThreadLoggingBoolFlagFields").FLAG_FIELD_NAMES.forEach(function(b){g[b]=a[b]});e.isAGroup||(d("WAWebBotGating").isBizBot3pEnabled()&&(g.isUser3pBotChat=e.automatedType===d("WAWebBotTypes").BizBotAutomatedType.FULL_3P),d("WAWebBotGating").isBizBot1pEnabled()&&(g.isUser1pBizBotChat=e.automatedType===d("WAWebBotTypes").BizBotAutomatedType.PARTIAL_1P));g.commit()});return function(b){return a.apply(this,arguments)}}()))}catch(a){d("WALogger").ERROR(j(),a.toString()).sendLogs("thread-logging-upload-failure")}if(e){e=(yield this.eventStore.deleteBeforeInclusive(a));e!==g.length&&d("WALogger").ERROR(i(),g.length,e)}yield this.metadataStore.setLastUploadedStartTs(a);return g.length});function e(b){return a.apply(this,arguments)}return e}();return a}();g.ChatThreadLoggingEventUploaderImpl=a}),98);
__d("WAWebChatThreadLoggingLocalstorageMetadataHandler",["Promise","WABase64","WAWebUserPrefsMultiDevice","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;a=function(){function a(){}var c=a.prototype;c.setOffset=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("WAWebUserPrefsMultiDevice").setChatThreadLoggingOffset(a);return!0});function c(b){return a.apply(this,arguments)}return c}();c.getOffset=function(){return(h||(h=b("Promise"))).resolve(d("WAWebUserPrefsMultiDevice").getChatThreadLoggingOffset())};c.setSecret=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("WAWebUserPrefsMultiDevice").setChatThreadLoggingSecretB64(d("WABase64").encodeB64(a));return!0});function c(b){return a.apply(this,arguments)}return c}();c.getSecret=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WAWebUserPrefsMultiDevice").getChatThreadLoggingSecretB64());return a==null?null:d("WABase64").decodeB64(a)});function c(){return a.apply(this,arguments)}return c}();c.setLastUploadedStartTs=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("WAWebUserPrefsMultiDevice").setChatThreadLoggingLastUploadedStartTs(a);return!0});function c(b){return a.apply(this,arguments)}return c}();c.getLastUploadedStartTs=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WAWebUserPrefsMultiDevice").getChatThreadLoggingLastUploadedStartTs());return(a=a)!=null?a:0});function c(){return a.apply(this,arguments)}return c}();return a}();g.ChatThreadLoggingMetadataLocalStorage=a}),98);
__d("WAWebChatThreadLogging",["Promise","WALogger","WATimeUtils","WAWebABProps","WAWebChatThreadLoggingEventStore","WAWebChatThreadLoggingEventUploader","WAWebChatThreadLoggingLocalstorageMetadataHandler","WAWebChatThreadLoggingUtils","WAWebUserPrefsMultiDevice","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[ctwa] labels: cannot generate getChatThreadIDHMAC because secret is unset"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["chat_thread_logging: cannot generate getChatThreadID because secret is unset."]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["chat_thread_logging: cannot get user secret from the thread logging metadata store"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["chat_thread_logging: uploaded "," events"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["chat_thread_logging: attempting to upload but secret is unset."]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["chat_thread_logging: attempting to upload but offset is unset."]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["chat_thread_logging: uploading events"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["chat_thread_logging: setting offset"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["chat thread logging initialized"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["chat_thread_logging: will upload in "," seconds."]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["chat_thread_logging: error handling activities"]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["chat_thread_logging: handling "," message(s)"]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["chat_thread_logging: setting thread_id_user_secret"]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["getChatThreadLoggingState: init incomplete!"]);v=function(){return a};return a}var w=null;function x(){w==null&&d("WALogger").ERROR(v());return w}function a(a){return y.apply(this,arguments)}function y(){y=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a===void 0&&(a=!0);a=a&&d("WAWebABProps").getABPropConfigValue("message_count_logging_md_enabled");(yield d("WAWebUserPrefsMultiDevice").getChatThreadLoggingLastUploadedStartTs())==null&&(yield d("WAWebUserPrefsMultiDevice").setChatThreadLoggingLastUploadedStartTs(0));var c=new(d("WAWebChatThreadLoggingLocalstorageMetadataHandler").ChatThreadLoggingMetadataLocalStorage)(),e=a?new(d("WAWebChatThreadLoggingEventStore").ChatThreadLoggingEventStoreImpl)(c):{handleMessages:function(){return(h||(h=b("Promise"))).resolve()},getEvent:function(){return(h||(h=b("Promise"))).resolve()},getBeforeInclusive:function(){return(h||(h=b("Promise"))).resolve([])},deleteBeforeInclusive:function(){return(h||(h=b("Promise"))).resolve(0)}};a=a?new(d("WAWebChatThreadLoggingEventUploader").ChatThreadLoggingEventUploaderImpl)(c,e):{uploadEvents:function(){return(h||(h=b("Promise"))).resolve(0)}};var f=(yield c.getOffset());f!=null&&D(f);w={metadataStore:c,eventStore:e,eventUploader:a};d("WALogger").LOG(q())});return y.apply(this,arguments)}function e(a){return z.apply(this,arguments)}function z(){z=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b;d("WALogger").LOG(p());b=(b=(yield (b=x())==null?void 0:b.metadataStore.setOffset(a)))!=null?b:!1;b&&D(a);return b});return z.apply(this,arguments)}function f(a){var c;d("WALogger").LOG(u());return(c=(c=x())==null?void 0:c.metadataStore.setSecret(a))!=null?c:(h||(h=b("Promise"))).resolve(!1)}function A(a){var b;d("WALogger").LOG(t(),a.length).devConsole({activities:a});(b=x())==null?void 0:b.eventStore.handleMessages(a)["catch"](function(a){d("WALogger").ERROR(s())})}function B(a){return C.apply(this,arguments)}function C(){C=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b;d("WALogger").DEV(o());b=(yield (b=x())==null?void 0:b.metadataStore.getOffset());if(b==null){d("WALogger").ERROR(n());return}b=(yield (b=x())==null?void 0:b.metadataStore.getSecret());if(b==null){d("WALogger").ERROR(m());return}b=(yield (b=x())==null?void 0:b.eventUploader.uploadEvents(a));d("WALogger").DEV(l(),b)});return C.apply(this,arguments)}function D(a){var c=d("WATimeUtils").unixTime(),e=c-c%86400;e=e+a;e=e-c;e<0&&(e+=d("WATimeUtils").DAY_SECONDS);d("WALogger").DEV(r(),e);self.setTimeout(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b;yield (b=x())==null?void 0:b.eventUploader.uploadEvents();D(a)}),e*1e3)}function E(){if(!c("gkx")("26258"))return x()}function F(){return G.apply(this,arguments)}function G(){G=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield x());a=(yield a==null?void 0:a.metadataStore.getSecret());if(a==null){d("WALogger").WARN(k()).sendLogs("ctl-secret-unset");return null}return a});return G.apply(this,arguments)}function H(a,b){return I.apply(this,arguments)}function I(){I=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=(yield F());if(c==null){d("WALogger").WARN(j());return void 0}b=d("WAWebChatThreadLoggingUtils").getThreadDs((b=b)!=null?b:d("WATimeUtils").unixTime());return d("WAWebChatThreadLoggingUtils").generateThreadID(c,a,b)});return I.apply(this,arguments)}function J(a){return K.apply(this,arguments)}function K(){K=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield F());if(b==null){d("WALogger").WARN(i()).sendLogs("ctwa-labels-thread-id-hmac-error");return null}return d("WAWebChatThreadLoggingUtils").generateThreadIDHMAC(b,a)});return K.apply(this,arguments)}g.initChatThreadLogging=a;g.setThreadDsTimeframeOffset=e;g.setThreadIdUserSecret=f;g.handleActivitiesForChatThreadLogging=A;g.uploadChatThreadLoggingEvents=B;g.getChatThreadLoggingStateDebug=E;g.getChatThreadID=H;g.getChatThreadIDHMAC=J}),98);
__d("WAWebApiChatThreadLoggingPendingEvents",["WAPromiseQueue","WAWebChatThreadLoggingBoolFlagFields","WAWebChatThreadLoggingCountFields","WAWebSchemaChatThreadLoggingPendingEvents","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h=Object.freeze({msgsSent:0,msgsReceived:0,msgsRead:0,viewOnceMsgsSent:0,viewOnceMsgsReceived:0,viewOnceMessagesOpened:0,callOffersSent:0,callOffersReceived:0,totalCallDuration:0,commerceMsgsSent:0,commerceMsgsReceived:0,pdpInquiriesSent:0,reactionsSent:0,reactionsReceived:0,forwardMessagesSent:0,forwardMessagesReceived:0,editedMsgsSent:0,botMessagesSent:0,botMessagesReceived:0,botMessagesEdited:0}),i=Object.freeze(babelHelpers["extends"]({},d("WAWebChatThreadLoggingCountFields").COUNT_FIELDS,d("WAWebChatThreadLoggingBoolFlagFields").FLAG_FIELDS,h)),j=new(d("WAPromiseQueue").PromiseQueue)();function a(a){return j.enqueue(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=(yield d("WAWebSchemaChatThreadLoggingPendingEvents").getChatThreadLoggingPendingEventsTable().bulkGet(a.map(function(a){var b=a.chatId;a=a.startTs;return[b,a]})));b=b.map(function(b,c){var e=a[c],f=k(e.chatId,e.startTs,b);d("WAWebChatThreadLoggingCountFields").COUNT_FIELD_NAMES.forEach(function(a){f[a]+=e[a]});d("WAWebChatThreadLoggingBoolFlagFields").FLAG_FIELD_NAMES.forEach(function(a){f[a]=e[a]});f.msgsSent+=e.addMsgsSent;f.msgsReceived+=e.addMsgsReceived;f.msgsRead+=e.addMsgsRead;f.viewOnceMsgsSent+=e.addViewOnceMsgsSent;f.viewOnceMsgsReceived+=e.addViewOnceMsgsReceived;f.viewOnceMessagesOpened+=e.addViewOnceMsgsOpened;f.callOffersSent+=e.addCallOffersSent;f.callOffersReceived+=e.addCallOffersReceived;f.totalCallDuration+=e.addTotalCallDuration;f.commerceMsgsSent+=e.addCommerceMsgsSent;f.commerceMsgsReceived+=e.addCommerceMsgsReceived;f.pdpInquiriesSent+=e.addPdpInquiriesSent;f.reactionsSent+=e.addReactionsSent;f.reactionsReceived+=e.addReactionsReceived;f.forwardMessagesSent+=e.addForwardMessagesSent;f.forwardMessagesReceived+=e.addForwardMessagesReceived;f.editedMsgsSent+=e.addEditedMsgsSent;f.botMessagesSent+=e.addBotMessagesSent;f.botMessagesReceived+=e.addBotMessagesReceived;f.botMessagesEdited+=e.addBotMessagesEdited;return f});return d("WAWebSchemaChatThreadLoggingPendingEvents").getChatThreadLoggingPendingEventsTable().bulkCreateOrReplace(b)}))}function k(a,b,c){if(c==null)return babelHelpers["extends"]({chatId:a,startTs:b},i);d("WAWebChatThreadLoggingBoolFlagFields").FLAG_FIELD_NAMES.forEach(function(a){c[a]==null&&(c[a]=i[a])});d("WAWebChatThreadLoggingCountFields").COUNT_FIELD_NAMES.forEach(function(a){c[a]==null&&(c[a]=i[a])});Object.keys(h).forEach(function(a){c[a]==null&&(c[a]=i[a])});return c}function c(a,b){return d("WAWebSchemaChatThreadLoggingPendingEvents").getChatThreadLoggingPendingEventsTable().get([a,b])}function e(a){return d("WAWebSchemaChatThreadLoggingPendingEvents").getChatThreadLoggingPendingEventsTable().lessThan(["startTs"],a,{inclusive:!0})}function f(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("WAWebSchemaChatThreadLoggingPendingEvents").getChatThreadLoggingPendingEventsTable().bulkDeleteRange(["startTs"],0,a+1));return a});return l.apply(this,arguments)}g.createOrUpdateChatEvents=a;g.getChatEvent=c;g.getBeforeInclusive=e;g.deleteBeforeInclusive=f}),98);
__d("WAWebDBBulkGetIsContactABusiness",["WAWebSchemaVerifiedBusinessName"],(function(a,b,c,d,e,f,g){function a(a){return d("WAWebSchemaVerifiedBusinessName").getVerifiedBusinessNameTable().bulkGet(a.map(function(a){return(a=a==null?void 0:a.user)!=null?a:""})).then(function(a){return a.map(function(a){return a!=null})})}g.bulkGetIsContactABusiness=a}),98);
__d("WAWebDBGetStarredMessagesForChat",["Promise","WAWebDBMessageSerialization","WAWebDBMessageUtils","WAWebSchemaMessage"],(function(a,b,c,d,e,f,g){var h;function a(a,c,e){return(h||(h=b("Promise"))).resolve().then(function(){if(e!=null)return d("WAWebSchemaMessage").getMessageTable().get(e.toString())}).then(function(b){b=b==null?[d("WAWebDBMessageUtils").endOfChat(a),Infinity]:[b.internalId,b.isStarred];var e=[d("WAWebDBMessageUtils").beginningOfChat(a),0];return d("WAWebSchemaMessage").getMessageTable().between(["internalId","isStarred"],e,b,{lowerInclusive:!1,upperInclusive:!1,reverse:!0,limit:c}).then(function(a){return a.map(function(a){return d("WAWebDBMessageSerialization").messageFromDbRow(a)})})})}g.getStarredMessagesForChat=a}),98);
__d("WABatcher",["Promise","WAErr","WAResolvable"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,d){var e=a.delayMs,f=a.maxSize,g=null;function i(a){g&&g.args===a&&(g=null);return d(a)}var j=function(){if(g==null)return(h||(h=b("Promise"))).resolve();var a=g;g=null;clearTimeout(a.timer);a.run();return a.batchPromise};a=function(a){if(g)g.args.push(a);else{var d,k=[a];a=new(h||(h=b("Promise")))(function(a){d=function(){return void a(k)}}).then(i);var l=d;g={args:k,batchPromise:a,run:l,timer:setTimeout(l,e)}}if(g==null)throw c("WAErr")("activeBatch should not be null here");a=g;l=a.args;a=a.batchPromise;var m=l.length-1;f!=null&&l.length>=f&&j();return a.then(function(a){return a[m]})};return{accept:a,runActiveBatch:j}}function a(a,b){var c=i(a,b);return function(a){return c.accept(a)}}function e(a){var e=[],f=new(d("WAResolvable").Resolvable)(),g=function(c){if(e.length===0)return(h||(h=b("Promise"))).resolve(new Map());var g=e,i=f;e=[];f=new(d("WAResolvable").Resolvable)();return(h||(h=b("Promise"))).resolve(a(g,c)).then(function(a){i.resolve(a);return a})},i=function(a){e.push(a);return f.promise.then(function(b){b=b.get(a);if(b==null)throw c("WAErr")("This should not happen because we just added it to the batch");return b})};return{accept:i,runActiveBatch:g}}g.createSimpleBatcher=i;g.batch=a;g.createBatcher=e}),98);
__d("WAWebDBGroupsGroupMetadata",["Promise","WABatcher","WALogger","WAWebModelStorageUtils","WAWebSchemaGroupMetadata","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["persistGroupMetadataBatched: persisting "," records"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["persistGroupMetadataBatched: aggregating "," changes"]);j=function(){return a};return a}function a(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=a.groupInfos;yield d("WAWebModelStorageUtils").getStorage().lock(["group-metadata"],function(){var d=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){b=b[0];var d=(yield b.bulkGet(c.map(function(a){return a.id.toString()})));a=c.map(function(a,b){var c;b=d[b];var e={subject:a.subject,subjectTime:a.subjectTime||0},f={announce:a.announce,a_v_id:a.a_v_id||0};c={desc:a.desc,descId:a.descId,descOwner:(c=a.descOwner)==null?void 0:c.toString(),descTime:a.descTime||0};if(b){var g=b.subjectTime||0,h=b.a_v_id||0,i=b.descTime||0;g>e.subjectTime&&(e={subject:b.subject,subjectTime:g});h>f.a_v_id&&(f={announce:b.announce,a_v_id:h});i>c.descTime&&(c={desc:b.desc,descId:b.descId,descOwner:b.descOwner,descTime:i})}return babelHelpers["extends"]({id:a.id.toString(),creation:a.creation,owner:(g=a.owner)==null?void 0:g.toString(),restrict:a.restrict,noFrequentlyForwarded:a.noFrequentlyForwarded,ephemeralDuration:a.ephemeralDuration||0,membershipApprovalMode:a.membershipApprovalMode,memberAddMode:a.memberAddMode,growthLockExpiration:a.growthLockExpiration,growthLockType:a.growthLockType,size:a.size||0,support:(h=a.support)!=null?h:!1,suspended:(i=a.suspended)!=null?i:!1,terminated:(g=a.terminated)!=null?g:!1,parentGroup:(h=a.parentGroup)==null?void 0:h.toString(),isParentGroup:a.isParentGroup,isParentGroupClosed:a.isParentGroupClosed,defaultSubgroup:a.defaultSubgroup,generalSubgroup:a.generalSubgroup,lastActivityTimestamp:(i=b==null?void 0:b.lastActivityTimestamp)!=null?i:0,lastSeenActivityTimestamp:(g=b==null?void 0:b.lastSeenActivityTimestamp)!=null?g:0,incognito:a.incognito,isLidAddressingMode:a.isLidAddressingMode,reportToAdminMode:(h=a.reportToAdminMode)!=null?h:!1,lastReportToAdminTimestamp:b==null?void 0:b.lastReportToAdminTimestamp,allowNonAdminSubGroupCreation:a.allowNonAdminSubGroupCreation,generalChatAutoAddDisabled:a.generalChatAutoAddDisabled},e,c,f)});return b.bulkCreateOrMerge(a)});return function(a){return d.apply(this,arguments)}}())});return k.apply(this,arguments)}function c(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.groupWid;var b=(yield d("WAWebSchemaGroupMetadata").getGroupMetadataTable().get(String(a)));return!b?null:{id:a,owner:b.owner==null?null:d("WAWebWidFactory").createWid(b.owner),creation:b.creation,desc:(a=b.desc)!=null?a:void 0,descId:(a=b.descId)!=null?a:void 0,descOwner:b.descOwner==null?null:d("WAWebWidFactory").createWid(b.descOwner),descTime:(a=b.descTime)!=null?a:void 0,restrict:b.restrict||!1,announce:b.announce||!1,noFrequentlyForwarded:b.noFrequentlyForwarded||!1,ephemeralDuration:b.ephemeralDuration||0,membershipApprovalMode:(a=b.membershipApprovalMode)!=null?a:!1,memberAddMode:b.memberAddMode,subject:b.subject,support:b.support===!0,lastActivityTimestamp:(a=b.lastActivityTimestamp)!=null?a:0,lastSeenActivityTimestamp:(a=b.lastSeenActivityTimestamp)!=null?a:0,lastReportToAdminTimestamp:(a=b.lastReportToAdminTimestamp)!=null?a:null,incognito:b.incognito,isLidAddressingMode:b.isLidAddressingMode,allowNonAdminSubGroupCreation:(a=b.allowNonAdminSubGroupCreation)!=null?a:!1,generalChatAutoAddDisabled:(a=b.generalChatAutoAddDisabled)!=null?a:!1}});return l.apply(this,arguments)}var m=function(){var a=3e3;return d("WABatcher").batch({delayMs:a},function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WALogger").DEV(j(),a.length);b=b();d("WALogger").DEV(i(),b.length);yield d("WAWebSchemaGroupMetadata").getGroupMetadataTable().bulkCreateOrMerge(b);return a.map(function(a){return void 0});function b(){return Array.from(a.reduce(function(a,b){var c;a.set(b.id,babelHelpers["extends"]({},(c=a.get(b.id))!=null?c:{},b));return a},new Map()).values())}});return function(b){return a.apply(this,arguments)}}())}();function e(a,b,c){c===void 0&&(c=!1);return c?m(babelHelpers["extends"]({id:a.toString()},b)):d("WAWebSchemaGroupMetadata").getGroupMetadataTable().createOrMerge(a.toString(),babelHelpers["extends"]({id:a.toString()},b))}function f(a){return d("WAWebSchemaGroupMetadata").getGroupMetadataTable().get(a.toString())}function n(a){return a.length===0?(h||(h=b("Promise"))).resolve([]):d("WAWebSchemaGroupMetadata").getGroupMetadataTable().bulkGet(a.map(function(a){return a==null?"":a.toString()}))}g.updateGroupMetadataTable=a;g.getGroupMetadataUNSAFE=c;g.persistGroupMetadata=e;g.getGroupMetadata=f;g.bulkGetGroupMetadata=n}),98);
__d("WAWebChatThreadLoggingEventStore",["Promise","WALogger","WAShiftTimer","WAWebApiChat","WAWebApiChatThreadLoggingPendingEvents","WAWebApiContact","WAWebBotTypes","WAWebChatThreadLoggingBoolFlagFields","WAWebChatThreadLoggingCountFields","WAWebChatThreadLoggingUtils","WAWebDBBulkGetIsContactABusiness","WAWebDBGetStarredMessagesForChat","WAWebDBGroupsGroupMetadata","WAWebGroupType","WAWebSchemaBusinessProfile","WAWebSchemaParticipant","WAWebUserPrefsMeUser","WAWebWid","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["ChatThreadLoggingEventStoreImpl: flushing cache with "," updates"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Passed event store info type not valid: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["ChatThreadLoggingEventStoreImpl: lastUploadedStartTs=",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["ChatThreadLoggingEventStoreImpl: handleMessages: offset unset."]);l=function(){return a};return a}var m=5;a=function(){function a(a,b){var c=this;this.metadataStore=a;this.$1=new Map();this.$2=(a=b)!=null?a:m;this.$3=new(d("WAShiftTimer").ShiftTimer)(function(){c.$4()})}var e=a.prototype;e.handleMessages=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=this,c=(yield this.metadataStore.getOffset());if(c==null){d("WALogger").LOG(l());return}var e=(yield this.metadataStore.getLastUploadedStartTs());d("WALogger").LOG(k(),e);a.forEach(function(a){var f;if(!d("WAWebChatThreadLoggingUtils").shouldUpdateChatEvent(c,a.ts,e))return;var g=d("WAWebChatThreadLoggingUtils").computeStartTs(c,a.ts),h=a.chatId.toString({legacy:!0}),i=h+"_"+String(g),k=b.$1.get(i);f=(f=k)!=null?f:babelHelpers["extends"]({},d("WAWebChatThreadLoggingCountFields").COUNT_FIELDS,d("WAWebChatThreadLoggingBoolFlagFields").FLAG_FIELDS,{startTs:g,chatId:h,addMsgsSent:0,addMsgsReceived:0,addMsgsRead:0,addViewOnceMsgsSent:0,addViewOnceMsgsReceived:0,addViewOnceMsgsOpened:0,addCallOffersSent:0,addCallOffersReceived:0,addTotalCallDuration:0,addCommerceMsgsSent:0,addCommerceMsgsReceived:0,addPdpInquiriesSent:0,addReactionsSent:0,addReactionsReceived:0,addForwardMessagesSent:0,addForwardMessagesReceived:0,addEditedMsgsSent:0,addBotMessagesSent:0,addBotMessagesReceived:0,addBotMessagesEdited:0});k==null&&b.$1.set(i,f);g=d("WAWebChatThreadLoggingCountFields").toMaybeCountActionType(a.activityType);h=d("WAWebChatThreadLoggingBoolFlagFields").toMaybeBoolFlagActionType(a.activityType);if(g!=null)f[g]+=1;else if(h!=null)f[h]=a.boolValue===void 0?!0:a.boolValue;else switch(a.activityType){case"msgSend":f.addMsgsSent+=1;a.isViewOnce&&(f.addViewOnceMsgsSent+=1);a.isCommerceMessage===!0&&(f.addCommerceMsgsSent+=1);a.isPdpInquiry===!0&&(f.addPdpInquiriesSent+=1);a.isReply&&(f.repliesSent+=1);a.isReaction&&(f.addReactionsSent+=1);a.isForwarded&&(f.addForwardMessagesSent+=1);a.isEdit&&(f.addEditedMsgsSent+=1);a.isBot&&(f.addBotMessagesSent+=1);break;case"msgReceive":f.addMsgsReceived+=1;a.isViewOnce&&(f.addViewOnceMsgsReceived+=1);a.isCommerceMessage===!0&&(f.addCommerceMsgsReceived+=1);a.isReaction&&(f.addReactionsReceived+=1);a.isForwarded&&(f.addForwardMessagesReceived+=1);a.isBot&&(a.isEdit?f.addBotMessagesEdited+=1:f.addBotMessagesReceived+=1);break;case"msgRead":f.addMsgsRead+=a.readCount;break;case"viewOnceOpen":f.addViewOnceMsgsOpened+=1;break;case"voipCall":a.outgoing?f.addCallOffersSent+=1:f.addCallOffersReceived+=1;f.addTotalCallDuration+=a.durationInSeconds;break;default:d("WALogger").WARN(j(),a.activityType)}});yield this.$5()});function c(b){return a.apply(this,arguments)}return c}();e.$5=function(){this.$3.onOrBefore(this.$2*1e3)};e.$4=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=Array.from(this.$1.values());d("WALogger").DEV(i(),a.length).devConsole({updates:a});this.$1.clear();yield d("WAWebApiChatThreadLoggingPendingEvents").createOrUpdateChatEvents(a)});function c(){return a.apply(this,arguments)}return c}();e.$6=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=d("WAWebApiChat").bulkGetChats(a.map(function(a){return d("WAWebWidFactory").createWid(a.chatId)})),f=e.then(function(a){return q(a)}),g=e.then(function(a){return r(a)}),i=e.then(function(a){return s(a)}),j=e.then(function(a){return u(a)});t=e.then(t);e=(yield (h||(h=b("Promise"))).all([e,f,g,i,t,j]));var k=e[0],l=e[1],m=e[2],n=e[3],o=e[4],p=e[5];return h.all(a.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e,f,g,h,i,j=k[b],q=c("WAWebWid").isGroup(a.chatId),r=n[b];e=d("WAWebBotTypes").BizBotAutomatedType.cast((e=p[b])==null?void 0:e.automatedType);f=q?{isAGroup:q,groupSize:(f=(f=o[b])==null?void 0:(f=f.participants)==null?void 0:f.length)!=null?f:1,groupType:r==null?d("WAWebGroupType").GroupType.DEFAULT:d("WAWebGroupType").getGroupTypeFromGroupMetadata(r)}:{isAGroup:q,isAContact:yield d("WAWebApiContact").isAddressBookContact(a.chatId),automatedType:e};q=d("WAWebWidFactory").createWid(a.chatId);e=((e=j==null?void 0:j.pin)!=null?e:0)>0;g=(g=j==null?void 0:j.archive)!=null?g:!1;var s=l[b];h=(h=j==null?void 0:j.unreadCount)!=null?h:0;i=((i=j==null?void 0:j.muteExpiration)!=null?i:0)!==0;b=m[b]?yield d("WAWebChatThreadLoggingUtils").getBizCatalogType(q):null;r=c("WAWebWid").isLid(a.chatId)||(r==null?void 0:r.defaultSubgroup)===!0&&(r==null?void 0:r.incognito)===!0;var t=d("WAWebUserPrefsMeUser").isMeAccount(q);q=q.isBot();var u=d("WAWebChatThreadLoggingUtils").getWamDisappearingModeInitiatedByMe(j==null?void 0:j.disappearingModeInitiatedByMe);j=d("WAWebChatThreadLoggingUtils").getWamDisappearingModeTrigger(j==null?void 0:j.disappearingModeTrigger);return babelHelpers["extends"]({},a,{isPinned:e,isArchived:g,contactInfo:f,messagesStarred:s,messagesUnread:h,isMuted:i,bizCatalogType:b,isPnhEnabledChat:r,isMessageYourself:t,isUserAgent:q,ephemeralityInitiator:u,ephemeralityTriggerAction:j})});return function(b,c){return a.apply(this,arguments)}}()));function q(a){return(h||(h=b("Promise"))).all(a.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){return a==null?0:(yield d("WAWebDBGetStarredMessagesForChat").getStarredMessagesForChat(d("WAWebWidFactory").createWid(a.id),Number.MAX_SAFE_INTEGER)).length});return function(b){return a.apply(this,arguments)}}()))}function r(a){return d("WAWebDBBulkGetIsContactABusiness").bulkGetIsContactABusiness(a.map(function(a){return a==null?null:d("WAWebWidFactory").createWid(a.id)}))}function s(a){return d("WAWebDBGroupsGroupMetadata").bulkGetGroupMetadata(a.map(function(a){return a==null?null:d("WAWebWidFactory").createWid(a.id)}))}function t(a){return d("WAWebSchemaParticipant").getParticipantTable().bulkGet(a.map(function(a){return a==null?"":d("WAWebWidFactory").createWid(a.id).toString()}))}function u(a){return d("WAWebSchemaBusinessProfile").getBusinessProfileTable().bulkGet(a.map(function(a){return a==null?"":d("WAWebWidFactory").createWid(a.id).toString()}))}});function e(b){return a.apply(this,arguments)}return e}();e.getEvent=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){this.$1.size>0&&(yield this.$4());a=(yield d("WAWebApiChatThreadLoggingPendingEvents").getChatEvent(a,b));return a==null?null:(yield this.$6([a]))[0]});function c(b,c){return a.apply(this,arguments)}return c}();e.getBeforeInclusive=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){this.$1.size>0&&(yield this.$4());return this.$6(yield d("WAWebApiChatThreadLoggingPendingEvents").getBeforeInclusive(a))});function c(b){return a.apply(this,arguments)}return c}();e.deleteBeforeInclusive=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){this.$1.size>0&&(yield this.$4());return d("WAWebApiChatThreadLoggingPendingEvents").deleteBeforeInclusive(a)});function c(b){return a.apply(this,arguments)}return c}();return a}();g.ChatThreadLoggingEventStoreImpl=a}),98);
__d("WAWebWorkerSafeBackendApi",["WAWebBackendApi"],(function(a,b,c,d,e,f,g){function a(a,b){d("WAWebBackendApi").fireAndForgetInternalDoNotUse("workerSafeEvent",a,b)}function b(a,b){return d("WAWebBackendApi").sendAndReceiveInternalDoNotUse("workerSafeEvent",a,b)}g.workerSafeFireAndForget=a;g.workerSafeSendAndReceive=b}),98);
__d("WAWebDBMsgUtils",["$InternalEnum","WANullthrows","WAWebApiChat","WAWebDBMessageSerialization","WAWebE2EProtoUtils","WAWebMsgKey","WAWebSchemaMessage","WAWebWorkerSafeBackendApi","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h=b("$InternalEnum")({Message:1,MessageEdit:2});function a(a,b){return d("WAWebSchemaMessage").getMessageTable().bulkGet(a).then(function(a){return a.filter(Boolean).map(function(a){return d("WAWebDBMessageSerialization").messageFromDbRow(a,b)})})}function e(a,b){var e=[];a.forEach(function(a){var d=new(c("WAWebMsgKey"))({fromMe:!0,remote:b,id:a});e.push(d.toString());d=new(c("WAWebMsgKey"))({fromMe:!1,remote:b,id:a});e.push(d.toString())});return d("WAWebSchemaMessage").getMessageTable().startsWithAnyOf(["id"],e)}function i(a,b){var e;a instanceof c("WAWebMsgKey")?e=a.toString():e=a;return d("WAWebSchemaMessage").getMessageTable().get(e).then(function(a){return!a?null:d("WAWebDBMessageSerialization").messageFromDbRow(a,b)})}function f(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e=(yield i(a,b));if(e)return e;e=a instanceof c("WAWebMsgKey")?a:c("WAWebMsgKey").from(a);if(e.remote.isUser()){a=(yield d("WAWebApiChat").getMatChat(e.remote));e=new(c("WAWebMsgKey"))({fromMe:e.fromMe,remote:a,id:e.id});d("WAWebWorkerSafeBackendApi").workerSafeFireAndForget("incrementPnhCtwaDailyCount",{chatId:a});return i(e,b)}});return j.apply(this,arguments)}function k(a,b){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(b.length===0)return b;a=b.map(function(a){return d("WAWebE2EProtoUtils").protobufToMsgKey(c("WANullthrows")(a.key)).toString()});var e=(yield d("WAWebSchemaMessage").getMessageTable().bulkGet(a,!1));return b.filter(function(a,b){return e[b]!=null})});return l.apply(this,arguments)}function m(a){return d("WAWebSchemaMessage").getMessageTable().bulkGet(a,!1).then(function(a){return a.map(Boolean)})}g.PendingReadReceiptType=h;g.getMsgsByMsgKey=a;g.getMsgsByMsgIdsAndChatId=e;g.getMsgByMsgKey=i;g.getMsgByMsgKeyMat=f;g.filterReceivedMessagesInRange=k;g.getMsgsExistByMsgKey=m}),98);
__d("WAWebProtobufsMdStorageChatRowOpaqueData.pb",["$InternalEnum","WAProtoConst"],(function(a,b,c,d,e,f,g){a=b("$InternalEnum")({NONE:0,IMAGE:1,VIDEO:2});c={};e={};f={};b={};c.internalSpec={draftMessage:[1,(d=d("WAProtoConst")).TYPES.MESSAGE,e]};e.internalSpec={text:[1,d.TYPES.STRING],omittedUrl:[2,d.TYPES.STRING],ctwaContextLinkData:[3,d.TYPES.MESSAGE,b],ctwaContext:[4,d.TYPES.MESSAGE,f],timestamp:[5,d.TYPES.INT64]};f.internalSpec={conversionSource:[1,d.TYPES.STRING],conversionData:[2,d.TYPES.BYTES],sourceUrl:[3,d.TYPES.STRING],sourceId:[4,d.TYPES.STRING],sourceType:[5,d.TYPES.STRING],title:[6,d.TYPES.STRING],description:[7,d.TYPES.STRING],thumbnail:[8,d.TYPES.STRING],thumbnailUrl:[9,d.TYPES.STRING],mediaType:[10,d.TYPES.ENUM,a],mediaUrl:[11,d.TYPES.STRING],isSuspiciousLink:[12,d.TYPES.BOOL]};b.internalSpec={context:[1,d.TYPES.STRING],sourceUrl:[2,d.TYPES.STRING],icebreaker:[3,d.TYPES.STRING],phone:[4,d.TYPES.STRING]};g.ChatRowOpaqueData$DraftMessage$CtwaContextData$ContextInfoExternalAdReplyInfoMediaType=a;g.ChatRowOpaqueDataSpec=c;g.ChatRowOpaqueData$DraftMessageSpec=e;g.ChatRowOpaqueData$DraftMessage$CtwaContextDataSpec=f;g.ChatRowOpaqueData$DraftMessage$CtwaContextLinkDataSpec=b}),98);
__d("WAWebDBChatSerialization",["WAWebProtobufsMdStorageChatRowOpaqueData.pb","decodeProtobuf","encodeProtobuf"],(function(a,b,c,d,e,f,g){var h=["draftMessage"];function a(a){a=babelHelpers["extends"]({},a);i(a);return a}function i(a){var b=d("decodeProtobuf").decodeProtobuf(d("WAWebProtobufsMdStorageChatRowOpaqueData.pb").ChatRowOpaqueDataSpec,a.chatRowOpaqueData);h.forEach(function(c){(b==null?void 0:b[c])!=null&&(a[c]=b==null?void 0:b[c])})}function b(a){a=babelHelpers["extends"]({},a);j(a);return a}function j(a){var b={};h.forEach(function(c){b[c]=a[c],delete a[c]});var c=d("encodeProtobuf").encodeProtobuf(d("WAWebProtobufsMdStorageChatRowOpaqueData.pb").ChatRowOpaqueDataSpec,b);a.chatRowOpaqueData=c.readBuffer()}g.CHAT_OPAQUE_DATA_KEYS=h;g.deserializeChat=a;g.serializeChat=b}),98);
__d("WAWebPnhGatingUtils",["WAWebABProps"],(function(a,b,c,d,e,f,g){function a(){return d("WAWebABProps").getABPropConfigValue("pnh_split_threads_detection")}g.isMatFullyEnabled=a}),98);
__d("WAWebTrustedContactsUtils",["$InternalEnum","WATimeUtils","WAWebABProps"],(function(a,b,c,d,e,f,g){var h=6*30*24*60*60,i=b("$InternalEnum")({Sender:"sender",Receiver:"receiver"});function j(a){a=a===i.Receiver?"tctoken_duration":"tctoken_duration_sender";return Math.min(d("WAWebABProps").getABPropConfigValue(a),h)}function a(a,b){return a<k(b)}function k(a){var b=a===i.Receiver?"tctoken_num_buckets":"tctoken_num_buckets_sender";b=d("WAWebABProps").getABPropConfigValue(b);a=j(a);var c=Math.floor(d("WATimeUtils").unixTime()/a);c=c-(b-1);return d("WATimeUtils").castToUnixTime(c*a)}function c(a){if(a==null)return!0;var b=d("WAWebABProps").getABPropConfigValue("tctoken_duration_sender"),c=Math.floor(d("WATimeUtils").unixTime()/b);a=Math.floor(a/b);return c>a}g.TcTokenMode=i;g.getTcTokenDuration=j;g.isTokenExpired=a;g.tokenExpirationCutoff=k;g.shouldSendNewToken=c}),98);
__d("WAWebApiChat",["Promise","WALogger","WATimeUtils","WAWeb-dexie","WAWebAck","WAWebApiContact","WAWebBackendApi","WAWebBusinessHSMTypes","WAWebChatThreadLogging","WAWebDBChatSerialization","WAWebDBMsgUtils","WAWebMiscErrors","WAWebModelStorageUtils","WAWebMsgGetters","WAWebMsgType","WAWebPnhGatingUtils","WAWebSchemaChat","WAWebSchemaMessage","WAWebTrustedContactsUtils","WAWebWid","WAWebWidFactory","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["createChatRecord: update chat table failed"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["reduceChatUnreadCount: could not find chat with id ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["removeUnreadMentionChat: could not find chats"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["addUnreadMentionChat: could not find chats"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["markMessageAndChatAsRead: chatId: ",", update acks for "," messages"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["markMessageAndChatAsRead: chatId: ",", update unread to ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["markMessageAndChatAsRead: lastReadRowId: ",", chatId: ",", keepChatUnread: ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["updateMarkChatAsReadSync: could not find chat with id ",""]);p=function(){return a};return a}var q=new Map(),r=function(b){babelHelpers.inheritsLoose(a,b);function a(){var a,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(a=c=b.call.apply(b,[this].concat(e))||this,c.name="CreateChatDuplicateError",a)||babelHelpers.assertThisInitialized(c)}return a}(babelHelpers.wrapNativeSuper(Error));function a(a,b){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){try{yield d("WAWebSchemaChat").getChatTable().create(babelHelpers["extends"]({id:a.toString()},b))}catch(a){if(a instanceof d("WAWebMiscErrors").DbOnLogoutAbort)throw a;d("WALogger").ERROR(i()).verbose().devConsole(a);if(a instanceof c("WAWeb-dexie").ConstraintError)throw new r();throw c("err")("update chat table failed")}d("WAWebPnhGatingUtils").isMatFullyEnabled()&&a.isUser()&&M(a)});return s.apply(this,arguments)}function e(a){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=(yield d("WAWebSchemaChat").getChatTable().get(a.toString(),!1));return e?{unreadCount:e.unreadCount,timestamp:e.t}:(h||(h=b("Promise"))).reject(c("err")("Failed to find row in chat table with id:"+a.toString()))});return t.apply(this,arguments)}function f(a){return d("WAWebModelStorageUtils").getStorage().lock(["chat"],function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){b=b[0];var c=(yield b.get(a));if(c==null){d("WALogger").ERROR(p(),a);return}if(c.unreadCount===-1)return b.createOrMerge(a,{id:a,unreadCount:0,unreadMentionsOfMe:[],unreadMentionCount:0})});return function(a){return c.apply(this,arguments)}}())}function u(a){a=Array.from(a).map(function(a){var b=a[0];a=a[1];return{id:b,chatlistPreview:a,lastReactionPreview:void 0}});return d("WAWebSchemaChat").getChatTable().bulkCreateOrMerge(a)}function v(a){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("WAWebSchemaMessage").getMessageTable().equals(["from","pendingReadReceipt"],[a,d("WAWebDBMsgUtils").PendingReadReceiptType.Message],{shouldDecrypt:!1}));return a.filter(function(a){return a.type!==d("WAWebMsgType").MSG_TYPE.UNKNOWN})});return w.apply(this,arguments)}function x(a,c,e){d("WALogger").DEV(o(),a,c,e);return d("WAWebModelStorageUtils").getStorage().lock(["message","chat"],function(){var f=b("asyncToGeneratorRuntime").asyncToGenerator(function*(f){f[0];f=f[1];var g=(yield v(c)),i=[],j=0,k=[];g.forEach(function(b){b.hsmTag===d("WAWebBusinessHSMTypes").HSM_TAG_TYPE.AUTHENTICATION&&d("WAWebBackendApi").frontendFireAndForget("logOTPMessageReadActions",{msgRow:b});if(a==null||b.rowId!=null&&b.rowId>a){j++;if(d("WAWebMsgGetters").getIsImportantMessage(b)){var c={id:b.id,timestamp:b.t};k.push(c)}return}i.push({id:b.id,ack:Math.max(b.ack,d("WAWebAck").ACK.READ),pendingReadReceipt:null})});g=j===0&&e?-1:j;d("WALogger").DEV(n(),c,g);f=[f.merge(c,{id:c,unreadCount:g,unreadDividerOffset:0,unreadMentionsOfMe:k,unreadMentionCount:0})];i.length>0&&(d("WALogger").DEV(m(),c,i.length),f.push(d("WAWebSchemaMessage").getMessageTable().bulkCreateOrMerge(i).then(function(){return d("WAWebChatThreadLogging").handleActivitiesForChatThreadLogging([{activityType:"msgRead",ts:d("WATimeUtils").unixTime(),chatId:d("WAWebWidFactory").createWid(c),readCount:i.length}])})));yield (h||(h=b("Promise"))).all(f)});return function(a){return f.apply(this,arguments)}}())}function y(a,c){return d("WAWebModelStorageUtils").getStorage().lock(["chat"],function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){b[0];b=Array.from(a.keys());if(b.length===0)return;b=(yield d("WAWebSchemaChat").getChatTable().bulkGet(b));if(!b||b.length===0){d("WALogger").ERROR(l());return}var e=[];b.forEach(function(b){if(b){var d=b.id.toString();b=(b=b.unreadMentionsOfMe)!=null?b:[];var f=a.get(d);f&&(b=b.concat(f));f={id:d,unreadMentionsOfMe:b};if(c){var g;g=(g=c.get(d))!=null?g:0;f={id:d,unreadMentionsOfMe:b,unreadMentionCount:g}}e.push(f)}});return d("WAWebSchemaChat").getChatTable().bulkCreateOrMerge(e)});return function(a){return e.apply(this,arguments)}}())}function z(a){return d("WAWebModelStorageUtils").getStorage().lock(["chat"],function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){b[0];b=Array.from(a.keys());if(b.length===0)return;b=(yield d("WAWebSchemaChat").getChatTable().bulkGet(b));if(!b||b.length===0){d("WALogger").ERROR(k());return}var c=[];b.forEach(function(b){if(b){var d;d=(d=b.unreadMentionsOfMe)!=null?d:[];var e=a.get(b.id.toString());e&&(d=d.filter(function(a){return!e.includes(a.id)}));c.push({id:b.id.toString(),unreadMentionsOfMe:d})}});return d("WAWebSchemaChat").getChatTable().bulkCreateOrMerge(c)});return function(a){return c.apply(this,arguments)}}())}function A(a){return d("WAWebModelStorageUtils").getStorage().lock(["chat"],function(c){c=c[0];var d=Array.from(a.keys());if(d.length===0)return(h||(h=b("Promise"))).resolve();d=d.map(function(b){var c;c=(c=a.get(b))!=null?c:!1;return{id:b,archiveAtMentionViewedInDrawer:c}});return c.bulkCreateOrMerge(d)})}function B(a,c,e){c===void 0&&(c=1);e===void 0&&(e=!0);return d("WAWebModelStorageUtils").getStorage().lock(["chat"],function(){var f=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){b=b[0];var f=(yield b.get(a));if(f==null){d("WALogger").ERROR(j(),a);return}var g=Math.max(f.unreadCount-c,0);f=(f=f.unreadDividerOffset)!=null?f:0;e&&(f+=c);return b.merge(a,{unreadCount:g,unreadDividerOffset:f})});return function(a){return f.apply(this,arguments)}}())}function C(){var a=d("WAWebTrustedContactsUtils").tokenExpirationCutoff(d("WAWebTrustedContactsUtils").TcTokenMode.Receiver);return d("WAWebModelStorageUtils").getStorage().lock(["chat"],function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){b=b[0];var c=(yield b.lessThan(["tcTokenTimestamp"],a));if(!c||c.length===0)return;c=c.map(function(a){return{id:a.id,tcToken:null,tcTokenTimestamp:null}});return b.bulkCreateOrMerge(c)});return function(a){return c.apply(this,arguments)}}())}function D(){var a=d("WAWebTrustedContactsUtils").tokenExpirationCutoff(d("WAWebTrustedContactsUtils").TcTokenMode.Receiver),c=[];return d("WAWebModelStorageUtils").getStorage().lock(["orphan-tc-token"],function(){var d=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){b=b[0];var d=(yield b.all());d.forEach(function(b){var d=b.tcTokenTimestamp;d!=null&&d<a&&c.push(b.chatId)});return b.bulkRemove(c)});return function(a){return d.apply(this,arguments)}}())}function E(a){return d("WAWebSchemaChat").getChatTable().get(a.toString(),!1)}function F(a){return d("WAWebSchemaChat").getChatTable().bulkGet(a.map(function(a){return a.toString()}))}function G(a){return H.apply(this,arguments)}function H(){H=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(!a.isLid()){var b=(yield E(a));if(b!=null)return a;b=d("WAWebApiContact").getCurrentLid(a);if(b!=null){var c=(yield E(b));if(c!=null)return b}return a}c=(yield E(a));if(c!=null&&!c.isDeprecated)return a;b=d("WAWebApiContact").getPhoneNumber(a);if(b!=null){c=(yield E(b));if(c)return b}return a});return H.apply(this,arguments)}function I(a){return J(a)}function J(a){var b=q.get(a.toString());if(b!=null)return b;b=G(a);q.set(a.toString(),b);return b}function K(a){return L.apply(this,arguments)}function L(){L=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=[];a=a.filter(function(a){return a.isUser()});a.map(function(a){var b=q.get(a.toString());b==null&&c.push(a)});var e=d("WAWebApiContact").getAlternateWidBulk(c);Array.from(e.keys()).map(function(a){return c.push(d("WAWebWidFactory").createWidFromWidLike(a))});if(c.length>0){var f=(yield F(c));f.forEach(function(a){if(a!=null){var c;c=(c=e.get(a.id.toString()))!=null?c:a.id.toString();!(a==null?void 0:a.isDeprecated)&&!q.has(c.toString())&&q.set(c.toString(),(h||(h=b("Promise"))).resolve(d("WAWebWidFactory").createWidFromWidLike(a.id)))}})}var g=new Map();a.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield q.get(a.toString()));b!=null?g.set(a,b):g.set(a,a)});return function(b){return a.apply(this,arguments)}}());return g});return L.apply(this,arguments)}function M(a){q.set(a.toString(),(h||(h=b("Promise"))).resolve(a));var c=d("WAWebApiContact").getAlternateUserWid(a);c!=null&&q.set(c.toString(),(h||(h=b("Promise"))).resolve(a))}function N(a){var b=d("WAWebApiContact").getAlternateUserWid(a);b!=null&&q["delete"](b.toString());q["delete"](a.toString())}function O(a){a.filter(function(a){return c("WAWebWid").isUser(a.id)&&!a.isDeprecated}).map(function(a){a=d("WAWebWidFactory").createWid(a.id);(!a.isLid()||q.get(a.toString())==null)&&q.set(a.toString(),(h||(h=b("Promise"))).resolve(a));var c=d("WAWebApiContact").getAlternateUserWid(a);c!=null&&(c.isLid()||q.get(c.toString())==null)&&q.set(c.toString(),(h||(h=b("Promise"))).resolve(a))})}function P(a,b){b?N(a):M(a)}function Q(){q.clear()}function R(){return d("WAWebSchemaChat").getChatTable().all().then(function(a){return a.map(function(a){return d("WAWebDBChatSerialization").deserializeChat(a)})})}g.matChatCache=q;g.CreateChatDuplicateError=r;g.createChatRecord=a;g.getChatMeta=e;g.updateChatForMarkAsReadSync=f;g.bulkUpdateChatLastAddOnPreview=u;g.queryPendingReadReceiptMsgRows=v;g.markMessageAndChatAsRead=x;g.addUnreadMentionChat=y;g.removeUnreadMentionChat=z;g.updateChatArchiveDrawer=A;g.reduceChatUnreadCount=B;g.pruneExpiredTcTokens=C;g.pruneExpiredOrphanTcTokens=D;g.getChatRecord=E;g.bulkGetChats=F;g._getActiveChatWid=G;g.getMatChatIncomingMessage=I;g.getMatChat=J;g.getMatChatBulk=K;g.updateMatCache=M;g.removeMatChatMapping=N;g.populateMatCacheBulk=O;g.updateDeprecatedChatMatCache=P;g.clearMatChatCache=Q;g.getAllChatsDeserialized=R}),98);
__d("WAWebMaybe",[],(function(a,b,c,d,e,f){function a(a,b){if(a!=null)return b(a)}f.ifSome=a}),66);
__d("WAWebAddonQueryUtils",["WAWebDBMsgUtils","WAWebLidGroupsGatingUtils","WAWebLidMigrationUtils","WAWebMaybe","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield d("WAWebDBMsgUtils").getMsgsByMsgKey(a.map(String))),c=new Map(b.map(function(a){return[a.id.toString(),a]}));if(c.size===a.length)return c;if(d("WAWebLidGroupsGatingUtils").allowReferenceByAltJid()){b=a.filter(function(a){return!c.has(a.toString())}).map(d("WAWebLidMigrationUtils").getAlternateMsgKey).filter(Boolean);if(b.length>0){a=(yield d("WAWebDBMsgUtils").getMsgsByMsgKey(b.map(String)));a.forEach(function(a){d("WAWebMaybe").ifSome(d("WAWebLidMigrationUtils").getAlternateMsgKey(a.id),function(b){c.set(b.toString(),a)})})}}return c});return h.apply(this,arguments)}g.getParentMsgsByMsgKey=a}),98);
__d("WAWebAddonProcessMsgsUtils",["Promise","WALogger","WAWebAddonGatingUtils","WAWebAddonInfraError","WAWebAddonPluginProcessor","WAWebAddonQueryUtils","WAWebMsgKey","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["parseHistorySyncMsg: error:",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Addon "," parent key should be an instance of MsgKey instead of ",""]);j=function(){return a};return a}function k(a){var b=d("WAWebAddonPluginProcessor").getAddonProcessor(a.type);b=b.parentKey;b=a[b];if(b instanceof c("WAWebMsgKey"))return b;d("WALogger").ERROR(j(),a.type,typeof b).tags("addons","messaging").sendLogs("getAddonParentMsgKey");throw new(d("WAWebAddonInfraError").AddonInfraError)(d("WAWebAddonInfraError").AddonInfraErrorCode.InvalidParentMsgKey)}function l(a){if(d("WAWebAddonPluginProcessor").hasAddonProcessor(a.type))return a}function m(a,b){var e=d("WAWebAddonPluginProcessor").getAddonProcessor(a.type);e=e.parentKey;var f=a[e];if(f instanceof c("WAWebMsgKey")){var g=b.get(f.toString());if(g!=null&&!f.equals(g.id)){b["delete"](f.toString());b.set(g.id.toString(),g);return babelHelpers["extends"]({},a,(f={},f[e]=g.id,f))}}return a}function a(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield d("WAWebAddonQueryUtils").getParentMsgsByMsgKey(a.map(k)));a=a.map(function(a){return m(a,b)});return[b,a]});return n.apply(this,arguments)}function e(a){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){try{var c=[];for(var e of d("WAWebAddonPluginProcessor").getAddonProcessorsMap().entries()){var f=e[0],g=e[1];d("WAWebAddonGatingUtils").isUnifiedInfraEnabledForType(f)&&c.push(g.convert.fromHistorySyncMsg(a))}f=(yield (h||(h=b("Promise"))).all(c).then(function(a){var b;return(b=[]).concat.apply(b,a)}));return f}catch(a){d("WALogger").WARN(i(),a).tags("addons","messaging").sendLogs("parseHistorySyncMsg");return[]}});return o.apply(this,arguments)}function f(a){var b=[],c=[];for(a of a){var e=a.parsedMsgPayload;if(d("WAWebAddonGatingUtils").isUnifiedInfraEnabledForType(e.type)){e=l(e);e!=null?b.push(e):c.push(a)}else c.push(a)}return{unifiedAddons:b,otherOrphans:c}}g.getAddonParentMsgKey=k;g.castToAddonMsgData=l;g.queryAddonParentMsgs=a;g.parseHistorySyncMsg=e;g.sortAddonOrphans=f}),98);
__d("WAWebAddonRetryRequestUtils",["WALogger","WAWebAck","WAWebAddonDBTable","WAWebAddonSelectUtils","WAWebModelStorageUtils","WAWebMsgType","WAWebSchemaSelfAddonMessageTypeTable","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["msg-retry: can not find addon ","."]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["msg-retry: can not find addon ","."]);i=function(){return a};return a}function j(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){return(yield d("WAWebSchemaSelfAddonMessageTypeTable").getSelfAddonMessageTypeTable().equals(["msgId"],a.id))[0]});return k.apply(this,arguments)}function a(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if((yield j(a.id))==null){a={msgId:a.id.id,msgType:a.type};yield d("WAWebSchemaSelfAddonMessageTypeTable").getSelfAddonMessageTypeTable().createOrReplace(a)}});return l.apply(this,arguments)}function c(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.length===0)return;return d("WAWebModelStorageUtils").getStorage().lock(["self-addon-message-type"],function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){b=b[0];var c=(yield b.anyOf(["msgId"],a.map(function(a){a=a[0];return a.id.id}))),d=a.map(function(a){var b=a[0];a=a[1];return{msgId:a.id.id,msgType:b.type}});yield b.bulkRemove(c.map(function(a){return a.rowId}).filter(Boolean));yield b.bulkCreateOrReplace(d)});return function(a){return c.apply(this,arguments)}}())});return m.apply(this,arguments)}function e(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield j(a));if(b==null)return;var c=d("WAWebAddonSelectUtils").getTableModeByMsgType(b.msgType);c=(yield d("WAWebAddonDBTable").addonInternalDBTable.getByMsgKey(c,a));if(c==null){d("WALogger").WARN(i(),a.toString());return}if(c.type!==d("WAWebMsgType").MSG_TYPE.REVOKED){var e=c.ack;if(e==null||e<d("WAWebAck").ACK.SENT){d("WALogger").WARN(h(),a.toString()).sendLogs("msg-retry");return}}return{msgData:c,selfMsgRow:b}});return n.apply(this,arguments)}g.hasSentAddonMsg=j;g.storeSelfMessageTypeRow=a;g.replaceSelfMessageTypeRows=c;g.getSentAddonMsgRecord=e}),98);
__d("WAWebAddonProcessRevoke",["Promise","WALogger","WAWebAddonConstants","WAWebAddonDBTable","WAWebAddonGatingUtils","WAWebAddonInfraError","WAWebAddonPluginProcessor","WAWebAddonRetryRequestUtils","WAWebE2EProtoUtils","WAWebMsgGetters","WAWebMsgKeyUtils","WAWebMsgType","WAWebUserPrefsMeUser","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["process addon revokes: ",""]);i=function(){return a};return a}var j=function(a,b){if(b.kind!==d("WAWebMsgType").MsgKind.CommentDecrypted)throw new(d("WAWebAddonInfraError").AddonInfraError)(d("WAWebAddonInfraError").AddonInfraErrorCode.NotSupportedMsgType);return babelHelpers["extends"]({id:a.newMsgKey,type:d("WAWebMsgType").MSG_TYPE.REVOKED,kind:d("WAWebMsgType").MsgKind.RevokedAddon,subtype:a.subtype==="admin_revoke"?"admin":"sender",revokeSender:a.sender,revokeTimestamp:(a=a.revokeTimestamp)!=null?a:void 0},d("WAWebMsgKeyUtils").msgKeyToTargetInfo(b.id,d("WAWebE2EProtoUtils").TranslateMsgKeyType.Addon),{protocolMessageKey:b.id,t:d("WAWebMsgGetters").getT(b),parentMsgKey:b.parentMsgKey})};function a(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=[];if(!d("WAWebAddonGatingUtils").isUnifiedInfraEnabledForType(d("WAWebMsgType").MSG_TYPE.COMMENT))return c;try{var e=[],f=[],g=[],k=a.map(function(a){return a.revokeMsgKey});k=(yield d("WAWebAddonDBTable").addonInternalDBTable.bulkGetByMsgKey(d("WAWebAddonConstants").AddonTableMode.Comment,k,!1));k=new Map(k.filter(Boolean).map(function(a){return[a.id.toString(),a]}));for(a of a){var l=k.get(a.revokeMsgKey.toString());if(l==null){c.push(a);continue}var m=j(a,l);e.push(l.id);f.push(m);d("WAWebUserPrefsMeUser").isMeAccount(d("WAWebMsgGetters").getFrom(l))&&g.push([l,m])}yield (h||(h=b("Promise"))).all([d("WAWebAddonDBTable").addonInternalDBTable.bulkRemoveByMsgKey(d("WAWebAddonConstants").AddonTableMode.Comment,e),d("WAWebAddonDBTable").addonInternalDBTable.bulkUpsert(d("WAWebAddonConstants").AddonTableMode.Comment,f),d("WAWebAddonRetryRequestUtils").replaceSelfMessageTypeRows(g)]);l=d("WAWebAddonPluginProcessor").getAddonProcessor(d("WAWebMsgType").MSG_TYPE.COMMENT);yield l.updateCollection({add:f,remove:e});return c}catch(a){d("WALogger").ERROR(i(),a).tags("addons","messaging").sendLogs("processAddonRevokes");throw a}});return k.apply(this,arguments)}g.processRevokeMsgs=a}),98);
__d("WAWebAddonGatingUtils",["WAWebAddonPluginProcessor"],(function(a,b,c,d,e,f,g){function a(a){return d("WAWebAddonPluginProcessor").hasAddonProcessor(a)?d("WAWebAddonPluginProcessor").getAddonProcessor(a).isEnabled():!1}g.isUnifiedInfraEnabledForType=a}),98);
__d("WAWebAddonSortUtils",["WAWebAddonPluginProcessor","WAWebAddonProcessMsgsUtils","WAWebAddonSelectUtils","WAWebMsgType"],(function(a,b,c,d,e,f,g){function a(a,b){var c=[],e=[];for(var a=a,f=Array.isArray(a),g=0,a=f?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var h;if(f){if(g>=a.length)break;h=a[g++]}else{g=a.next();if(g.done)break;h=g.value}h=h;var i=b.get(d("WAWebAddonProcessMsgsUtils").getAddonParentMsgKey(h).toString());i=i==null||i.type===d("WAWebMsgType").MSG_TYPE.UNKNOWN;i?c.push(h):e.push(h)}return{orphans:c,validAddons:e}}function b(a){var b=new Map();for(var a=a,c=Array.isArray(a),e=0,a=c?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f;if(c){if(e>=a.length)break;f=a[e++]}else{e=a.next();if(e.done)break;f=e.value}f=f;var g=d("WAWebAddonSelectUtils").getTableModeByMsgType(f.type);b.has(g)||b.set(g,[]);(g=b.get(g))==null?void 0:g.push(f)}return b}function c(a){var b=new Map();for(var a=a,c=Array.isArray(a),e=0,a=c?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f;if(c){if(e>=a.length)break;f=a[e++]}else{e=a.next();if(e.done)break;f=e.value}f=f;if(!b.has(f.type)){var g=d("WAWebAddonPluginProcessor").getAddonProcessor(f.type);b.set(f.type,{processor:g,addons:[],existingAddons:[]})}(g=b.get(f.type))==null?void 0:g.addons.push(f)}return Array.from(b.values())}g.collectValidAndOrphanAddons=a;g.groupAddonsByTableMode=b;g.groupAddonsByProcessor=c}),98);
__d("WAWebWamEnumMismatchOriginType",[],(function(a,b,c,d,e,f){a=Object.freeze({INCOMING_GROUP_MESSAGE:1,ACK_OUTGOING_MESSAGE:2,GROUP_NOTIFICATION:3,GROUP_PROFILE_PICTURE_NOTIFICATION:4,IQ_RESPONSES:5});f.MISMATCH_ORIGIN_TYPE=a}),66);
__d("WAWebGroupQueryBridgeOneAlreadyInFlightLogger",["WALogger","WAWebABProps","WAWebWamEnumMismatchOriginType","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["lid_migration - ",""]);h=function(){return a};return a}var i=Object.fromEntries(Object.entries(d("WAWebWamEnumMismatchOriginType").MISMATCH_ORIGIN_TYPE).map(function(a){var b=a[0];a=a[1];return[a,b]})),j=function(){function a(){this.$1=new Map()}var b=a.prototype;b.$2=function(a){return(a=this.$1.get(a))!=null?a:0};b.increment=function(a){a=a.toString();var b=this.$2(a)+1;this.$1.set(a,b);return b};b.decrement=function(a){a=a.toString();this.$1.set(a,Math.max(this.$2(a)-1,0))};return a}();function a(a){var c=new j();return function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b,e){if(!d("WAWebABProps").getABPropConfigValue("web_extra_lid_group_logging_attributes"))return a(b);c.increment(b)>1&&d("WALogger").ERROR(h(),i[e]).sendLogs("GroupLidInfra/one_in_flight_group_info_mismatch");try{e=(yield a(b));c.decrement(b);return e}catch(a){c.decrement(b);throw a}});function f(a,b){return e.apply(this,arguments)}return f}()}g.logDuplicateRequestsWrapper=a}),98);
__d("WAWebWamEnumAddressingMode",[],(function(a,b,c,d,e,f){a=Object.freeze({PN:1,LID:2});f.ADDRESSING_MODE=a}),66);
__d("WAWebWamEnumIqResponseType",[],(function(a,b,c,d,e,f){a=Object.freeze({ADD_PARTICIPANT:1,REMOVE_PARTICIPANT:2,PROMOTE_PARTICIPANT:3,DEMOTE_PARTICIPANT:4});f.IQ_RESPONSE_TYPE=a}),66);
__d("WAWebAddressingModeMismatchWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumAddressingMode","WAWebWamEnumIqResponseType","WAWebWamEnumMismatchOriginType"],(function(a,b,c,d,e,f,g){a=d("WAWebWamCodegenUtils").defineEvents({AddressingModeMismatch:[4750,{iqResponse:[1,d("WAWebWamEnumIqResponseType").IQ_RESPONSE_TYPE],localAddressingMode:[2,d("WAWebWamEnumAddressingMode").ADDRESSING_MODE],mismatchOrigin:[6,d("WAWebWamEnumMismatchOriginType").MISMATCH_ORIGIN_TYPE],notificationTag:[3,d("WAWebWamCodegenUtils").TYPES.STRING],serverAddressingMode:[5,d("WAWebWamEnumAddressingMode").ADDRESSING_MODE]},[1,1,1],"regular"]});g.AddressingModeMismatchWamEvent=a}),98);
__d("WAWebWamAddressingModeUtils",["WAWebABProps","WAWebHandleMsgCommon","WAWebWamEnumAddressingMode"],(function(a,b,c,d,e,f,g){"use strict";function h(a){switch(a){case!0:return d("WAWebWamEnumAddressingMode").ADDRESSING_MODE.LID;case!1:return d("WAWebWamEnumAddressingMode").ADDRESSING_MODE.PN}}function a(a){return a===d("WAWebHandleMsgCommon").STANZA_MSG_ADDRESSING_MODE.lid?d("WAWebWamEnumAddressingMode").ADDRESSING_MODE.LID:d("WAWebWamEnumAddressingMode").ADDRESSING_MODE.PN}function b(a){if(!d("WAWebABProps").getABPropConfigValue("web_extra_lid_group_logging_attributes"))return{};return a.isLidAddressingMode==null?{}:{localAddressingMode:h(a.isLidAddressingMode)}}g.getWamAddressingModeFromIsLidBoolean=h;g.getWamAddressingModeFromString=a;g.getAddressingModeMetricsFromGroupMetadata=b}),98);
__d("WAWebWamAddressingModeMismatchReporter",["WAWebABProps","WAWebAddressingModeMismatchWamEvent","WAWebWamAddressingModeUtils","WAWebWamEnumMismatchOriginType"],(function(a,b,c,d,e,f,g){"use strict";function a(a){if(!d("WAWebABProps").getABPropConfigValue("web_extra_lid_group_logging_attributes"))return;new(d("WAWebAddressingModeMismatchWamEvent").AddressingModeMismatchWamEvent)(babelHelpers["extends"]({},a,{localAddressingMode:d("WAWebWamAddressingModeUtils").getWamAddressingModeFromString(a.localAddressingMode),serverAddressingMode:d("WAWebWamAddressingModeUtils").getWamAddressingModeFromString(a.serverAddressingMode)})).commit()}g.MISMATCH_ORIGIN_TYPE=d("WAWebWamEnumMismatchOriginType").MISMATCH_ORIGIN_TYPE;g.logAddressingModeMismatch=a}),98);
__d("WAWebGroupHandleAddressingModeMismatch",["WAWebGroupQueryBridge","WAWebGroupQueryBridgeOneAlreadyInFlightLogger","WAWebWamAddressingModeMismatchReporter","WAWebWamEnumMismatchOriginType"],(function(a,b,c,d,e,f,g){"use strict";var h=d("WAWebGroupQueryBridgeOneAlreadyInFlightLogger").logDuplicateRequestsWrapper(d("WAWebGroupQueryBridge").sendQueryGroup);function a(a,b){b&&d("WAWebWamAddressingModeMismatchReporter").logAddressingModeMismatch(b);return h(a,b.mismatchOrigin)}g.MISMATCH_ORIGIN_TYPE=d("WAWebWamEnumMismatchOriginType").MISMATCH_ORIGIN_TYPE;g.handleAddressingModeMismatch=a}),98);
__d("WAWebGroupQueryBridge",["WALogger","WATypeUtils","WAWebBackendApi","WAWebBackendErrors","WAWebGroupQueryGroupJob","WAWebGroupQueryJob","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Store:GroupMetadata Unexpected server response"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["querying server for groupMetadata of group id ",""]);i=function(){return a};return a}function a(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WALogger").LOG(i(),a.toLogString()).tags("groups");var b=d("WAWebGroupQueryGroupJob").queryGroupJob(a);try{b=(yield b);if(b==null?void 0:b.id){var c;k(a,b.subject);l(a,(c=b.isLidAddressingMode)!=null?c:!1);return{id:b.id,owner:b.owner,creation:b.creation,subject:b.subject,desc:b.desc,descId:b.descId,descOwner:b.descOwner,descTime:b.descTime,restrict:(c=b.restrict)!=null?c:!1,announce:(c=b.announce)!=null?c:!1,noFrequentlyForwarded:(c=b.noFrequentlyForwarded)!=null?c:!1,ephemeralDuration:(c=b.ephemeralDuration)!=null?c:0,membershipApprovalMode:b.membershipApprovalMode,participants:b.participants,support:(c=b.support)!=null?c:!1,suspended:(c=b.suspended)!=null?c:!1,terminated:(c=b.terminated)!=null?c:!1,parentGroup:b.parentGroup,isParentGroup:(c=b.isParentGroup)!=null?c:!1,isParentGroupClosed:(c=b.isParentGroupClosed)!=null?c:!1,defaultSubgroup:(c=b.defaultSubgroup)!=null?c:!1,generalSubgroup:(c=b.generalSubgroup)!=null?c:!1,incognito:(c=b.incognito)!=null?c:!1,isLidAddressingMode:(c=b.isLidAddressingMode)!=null?c:!1,allowNonAdminSubGroupCreation:b.allowNonAdminSubGroupCreation,generalChatAutoAddDisabled:b.generalChatAutoAddDisabled}}d("WALogger").WARN(h()).devConsole(b)}catch(b){if(b instanceof d("WAWebBackendErrors").ServerStatusCodeError&&b.status>=400)return{id:a,stale:!1};throw b}});return j.apply(this,arguments)}function c(a){return d("WAWebGroupQueryJob").queryGroupInvite(a).then(function(a){return babelHelpers["extends"]({status:200},a)})}function k(a,b){d("WATypeUtils").isString(b)&&d("WAWebBackendApi").frontendFireAndForget("updateGroupSubject",{id:a,subject:b})}function l(a,b){d("WAWebBackendApi").frontendFireAndForget("updateGroupAddressingMode",{id:a,isLidAddressingMode:b})}g.sendQueryGroup=a;g.sendQueryGroupInvite=c;g.updateSubject=k}),98);
__d("WAWeb-curve25519-donna",[],(function $module_WAWeb_curve25519_donna(global,require,requireDynamic,requireLazy,module,exports){var e={},aa={},l;for(l in e)e.hasOwnProperty(l)&&(aa[l]=e[l]);e.read=function(a){var b=new XMLHttpRequest;b.open("GET",a,!1);b.send(null);return b.responseText};"undefined"!=typeof arguments&&(e.arguments=arguments);"undefined"!==typeof console?(e.print||(e.print=function(a){}),e.printErr||(e.printErr=function(a){})):e.print||(e.print=function(){});"undefined"===typeof e.setWindowTitle&&(e.setWindowTitle=function(a){document.title=a});function ba(a){eval.call(null,a)}!e.load&&e.read&&(e.load=function(a){ba(e.read(a))});e.print||(e.print=function(){});e.printErr||(e.printErr=e.print);e.arguments||(e.arguments=[]);e.thisProgram||(e.thisProgram="./this.program");e.print=e.print;e.S=e.printErr;e.preRun=[];e.postRun=[];for(l in aa)aa.hasOwnProperty(l)&&(e[l]=aa[l]);var n={cb:function(a){ca=a},Ua:function(){return ca},na:function(){return m},X:function(a){m=a},Aa:function(a){switch(a){case"i1":case"i8":return 1;case"i16":return 2;case"i32":return 4;case"i64":return 8;case"float":return 4;case"double":return 8;default:return"*"===a[a.length-1]?n.H:"i"===a[0]?(a=parseInt(a.substr(1)),assert(0===a%8),a/8):0}},Ta:function(a){return Math.max(n.Aa(a),n.H)},dd:16,Bd:function(a,b){"double"===b||"i64"===b?a&7&&(assert(4===(a&7)),a+=4):assert(0===(a&3));return a},od:function(a,b,c){return c||"i64"!=a&&"double"!=a?a?Math.min(b||(a?n.Ta(a):0),n.H):Math.min(b,8):8},J:function(a,b,c){return c&&c.length?(c.splice||(c=Array.prototype.slice.call(c)),c.splice(0,0,b),e["dynCall_"+a].apply(null,c)):e["dynCall_"+a].call(null,b)},U:[],Ma:function(a){for(var b=0;b<n.U.length;b++)if(!n.U[b])return n.U[b]=a,2*(1+b);throw"Finished up all reserved function pointers. Use a higher value for RESERVED_FUNCTION_POINTERS."},$a:function(a){n.U[(a-2)/2]=null},M:function(a){n.M.ma||(n.M.ma={}),n.M.ma[a]||(n.M.ma[a]=1,e.S(a))},ha:{},rd:function(a,b){assert(b);n.ha[b]||(n.ha[b]={});var c=n.ha[b];c[a]||(c[a]=function(){return n.J(b,a,arguments)});return c[a]},pd:function(){throw"You must build with -s RETAIN_COMPILER_SETTINGS=1 for Runtime.getCompilerSetting or emscripten_get_compiler_setting to work"},W:function(a){var b=m;m=m+a|0;m=m+15&-16;return b},Ia:function(a){var b=p;p=p+a|0;p=p+15&-16;return b},P:function(a){var b=v;v=v+a|0;v=v+15&-16;(a=v>=w)&&(z("Cannot enlarge memory arrays. Either (1) compile with  -s TOTAL_MEMORY=X  with X higher than the current value "+w+", (2) compile with  -s ALLOW_MEMORY_GROWTH=1  which adjusts the size at runtime but prevents some optimizations, (3) set Module.TOTAL_MEMORY to a higher value before the program runs, or if you want malloc to return NULL (0) instead of this abort, compile with  -s ABORTING_MALLOC=0 "),a=!0);return a?(v=b,0):b},ea:function(a,b){return Math.ceil(a/(b?b:16))*(b?b:16)},xd:function(a,b,c){return c?+(a>>>0)+4294967296*+(b>>>0):+(a>>>0)+4294967296*+(b|0)},La:8,H:4,ed:0};e.Runtime=n;n.addFunction=n.Ma;n.removeFunction=n.$a;var A=!1,da,fa,ca;function assert(a,b){a||z("Assertion failed: "+b)}function ga(a){var b=e["_"+a];if(!b)try{b=eval("_"+a)}catch(c){}assert(b,"Cannot call unknown function "+a+" (perhaps LLVM optimizations or closure removed it?)");return b}var ha,ia;(function(){function a(a){a=a.toString().match(d).slice(1);return{arguments:a[0],body:a[1],returnValue:a[2]}}var b={stackSave:function(){n.na()},stackRestore:function(){n.X()},arrayToC:function(a){var b=n.W(a.length);ja(a,b);return b},stringToC:function(a){var b=0;null!==a&&void 0!==a&&0!==a&&(b=n.W((a.length<<2)+1),ka(a,b));return b}},c={string:b.stringToC,array:b.arrayToC};ia=function(a,b,d,f,h){a=ga(a);var q=[],y=0;if(f)for(var B=0;B<f.length;B++){var J=c[d[B]];J?(0===y&&(y=n.na()),q[B]=J(f[B])):q[B]=f[B]}d=a.apply(null,q);"string"===b&&(d=la(d));if(0!==y){if(h&&h.async){EmterpreterAsync.hd.push(function(){n.X(y)});return}n.X(y)}return d};var d=/^function\s*\(([^)]*)\)\s*{\s*([^*]*?)[\s;]*(?:return\s*(.*?)[;\s]*)?}$/,f={},h;for(h in b)b.hasOwnProperty(h)&&(f[h]=a(b[h]));ha=function(b,c,d){d=d||[];var h=ga(b);b=d.every(function(a){return"number"===a});var u="string"!==c;if(u&&b)return h;var q=d.map(function(a,b){return"$"+b});c="(function("+q.join(",")+") {";var y=d.length;if(!b){c+="var stack = "+f.stackSave.body+";";for(var B=0;B<y;B++){var J=q[B],ea=d[B];"number"!==ea&&(ea=f[ea+"ToC"],c+="var "+ea.arguments+" = "+J+";",c+=ea.body+";",c+=J+"="+ea.returnValue+";")}}d=a(function(){return h}).returnValue;c+="var ret = "+d+"("+q.join(",")+");";u||(d=a(function(){return la}).returnValue,c+="ret = "+d+"(ret);");b||(c+=f.stackRestore.body.replace("()","(stack)")+";");return eval(c+"return ret})")}})();e.ccall=ia;e.cwrap=ha;function ma(a,b,c){c=c||"i8";"*"===c.charAt(c.length-1)&&(c="i32");switch(c){case"i1":D[a>>0]=b;break;case"i8":D[a>>0]=b;break;case"i16":E[a>>1]=b;break;case"i32":F[a>>2]=b;break;case"i64":fa=[b>>>0,(da=b,1<=+na(da)?0<da?(oa(+pa(da/4294967296),4294967295)|0)>>>0:~~+qa((da-+(~~da>>>0))/4294967296)>>>0:0)];F[a>>2]=fa[0];F[a+4>>2]=fa[1];break;case"float":ra[a>>2]=b;break;case"double":sa[a>>3]=b;break;default:z("invalid type for setValue: "+c)}}e.setValue=ma;function ta(a,b){b=b||"i8";"*"===b.charAt(b.length-1)&&(b="i32");switch(b){case"i1":return D[a>>0];case"i8":return D[a>>0];case"i16":return E[a>>1];case"i32":return F[a>>2];case"i64":return F[a>>2];case"float":return ra[a>>2];case"double":return sa[a>>3];default:z("invalid type for setValue: "+b)}return null}e.getValue=ta;e.ALLOC_NORMAL=0;e.ALLOC_STACK=1;e.ALLOC_STATIC=2;e.ALLOC_DYNAMIC=3;e.ALLOC_NONE=4;function G(a,b,c,d){var f,h;"number"===typeof a?(f=!0,h=a):(f=!1,h=a.length);var g="string"===typeof b?b:null;c=4==c?d:[ua,n.W,n.Ia,n.P][void 0===c?2:c](Math.max(h,g?1:b.length));if(f){d=c;assert(0==(c&3));for(a=c+(h&-4);d<a;d+=4)F[d>>2]=0;for(a=c+h;d<a;)D[d++>>0]=0;return c}if("i8"===g)return a.subarray||a.slice?H.set(a,c):H.set(new Uint8Array(a),c),c;d=0;for(var k,t;d<h;){var r=a[d];"function"===typeof r&&(r=n.sd(r));f=g||b[d];0===f?d++:("i64"==f&&(f="i32"),ma(c+d,r,f),t!==f&&(k=n.Aa(f),t=f),d+=k)}return c}e.allocate=G;e.getMemory=function(a){return va?"undefined"!==typeof wa&&!wa.C||!xa?n.P(a):ua(a):n.Ia(a)};function la(a,b){if(0===b||!a)return"";for(var c=0,d,f=0;;){d=H[a+f>>0];c|=d;if(0==d&&!b)break;f++;if(b&&f==b)break}b||(b=f);d="";if(128>c){for(;0<b;)c=String.fromCharCode.apply(String,H.subarray(a,a+Math.min(b,1024))),d=d?d+c:c,a+=1024,b-=1024;return d}return e.UTF8ToString(a)}e.Pointer_stringify=la;e.AsciiToString=function(a){for(var b="";;){var c=D[a++>>0];if(!c)return b;b+=String.fromCharCode(c)}};e.stringToAscii=function(a,b){return ya(a,b,!1)};function za(a,b){for(var c,d,f,h,g,k,t="";;){c=a[b++];if(!c)return t;c&128?(d=a[b++]&63,192==(c&224)?t+=String.fromCharCode((c&31)<<6|d):(f=a[b++]&63,224==(c&240)?c=(c&15)<<12|d<<6|f:(h=a[b++]&63,240==(c&248)?c=(c&7)<<18|d<<12|f<<6|h:(g=a[b++]&63,248==(c&252)?c=(c&3)<<24|d<<18|f<<12|h<<6|g:(k=a[b++]&63,c=(c&1)<<30|d<<24|f<<18|h<<12|g<<6|k))),65536>c?t+=String.fromCharCode(c):(c-=65536,t+=String.fromCharCode(55296|c>>10,56320|c&1023)))):t+=String.fromCharCode(c)}}e.UTF8ArrayToString=za;e.UTF8ToString=function(a){return za(H,a)};function Aa(a,b,c,d){if(!(0<d))return 0;var f=c;d=c+d-1;for(var h=0;h<a.length;++h){var g=a.charCodeAt(h);55296<=g&&57343>=g&&(g=65536+((g&1023)<<10)|a.charCodeAt(++h)&1023);if(127>=g){if(c>=d)break;b[c++]=g}else{if(2047>=g){if(c+1>=d)break;b[c++]=192|g>>6}else{if(65535>=g){if(c+2>=d)break;b[c++]=224|g>>12}else{if(2097151>=g){if(c+3>=d)break;b[c++]=240|g>>18}else{if(67108863>=g){if(c+4>=d)break;b[c++]=248|g>>24}else{if(c+5>=d)break;b[c++]=252|g>>30;b[c++]=128|g>>24&63}b[c++]=128|g>>18&63}b[c++]=128|g>>12&63}b[c++]=128|g>>6&63}b[c++]=128|g&63}}b[c]=0;return c-f}e.stringToUTF8Array=Aa;e.stringToUTF8=function(a,b,c){return Aa(a,H,b,c)};function Ba(a){for(var b=0,c=0;c<a.length;++c){var d=a.charCodeAt(c);55296<=d&&57343>=d&&(d=65536+((d&1023)<<10)|a.charCodeAt(++c)&1023);127>=d?++b:b=2047>=d?b+2:65535>=d?b+3:2097151>=d?b+4:67108863>=d?b+5:b+6}return b}e.lengthBytesUTF8=Ba;e.UTF16ToString=function(a){for(var b=0,c="";;){var d=E[a+2*b>>1];if(0==d)return c;++b;c+=String.fromCharCode(d)}};e.stringToUTF16=function(a,b,c){void 0===c&&(c=2147483647);if(2>c)return 0;c-=2;var d=b;c=c<2*a.length?c/2:a.length;for(var f=0;f<c;++f)E[b>>1]=a.charCodeAt(f),b+=2;E[b>>1]=0;return b-d};e.lengthBytesUTF16=function(a){return 2*a.length};e.UTF32ToString=function(a){for(var b=0,c="";;){var d=F[a+4*b>>2];if(0==d)return c;++b;65536<=d?(d=d-65536,c+=String.fromCharCode(55296|d>>10,56320|d&1023)):c+=String.fromCharCode(d)}};e.stringToUTF32=function(a,b,c){void 0===c&&(c=2147483647);if(4>c)return 0;var d=b;c=d+c-4;for(var f=0;f<a.length;++f){var h=a.charCodeAt(f);if(55296<=h&&57343>=h)var g=a.charCodeAt(++f),h=65536+((h&1023)<<10)|g&1023;F[b>>2]=h;b+=4;if(b+4>c)break}F[b>>2]=0;return b-d};e.lengthBytesUTF32=function(a){for(var b=0,c=0;c<a.length;++c){var d=a.charCodeAt(c);55296<=d&&57343>=d&&++c;b+=4}return b};function Ca(a){function b(c,d,f){d=d||Infinity;var h="",g=[],q;if("N"===a[k]){k++;"K"===a[k]&&k++;for(q=[];"E"!==a[k];)if("S"===a[k]){k++;var x=a.indexOf("_",k);q.push(r[a.substring(k,x)||0]||"?");k=x+1}else if("C"===a[k])q.push(q[q.length-1]),k+=2;else{var x=parseInt(a.substr(k)),Q=x.toString().length;if(!x||!Q){k--;break}var Bb=a.substr(k+Q,x);q.push(Bb);r.push(Bb);k+=Q+x}k++;q=q.join("::");d--;if(0===d)return c?[q]:q}else(("K"===a[k]||u&&"L"===a[k])&&k++,x=parseInt(a.substr(k)))&&(Q=x.toString().length,q=a.substr(k+Q,x),k+=Q+x);u=!1;"I"===a[k]?(k++,x=b(!0),Q=b(!0,1,!0),h+=Q[0]+" "+q+"<"+x.join(", ")+">"):h=q;a:for(;k<a.length&&0<d--;)if(q=a[k++],q in t)g.push(t[q]);else switch(q){case"P":g.push(b(!0,1,!0)[0]+"*");break;case"R":g.push(b(!0,1,!0)[0]+"&");break;case"L":k++;x=a.indexOf("E",k)-k;g.push(a.substr(k,x));k+=x+2;break;case"A":x=parseInt(a.substr(k));k+=x.toString().length;if("_"!==a[k])throw"?";k++;g.push(b(!0,1,!0)[0]+" ["+x+"]");break;case"E":break a;default:h+="?"+q;break a}f||1!==g.length||"void"!==g[0]||(g=[]);return c?(h&&g.push(h+"?"),g):h+("("+g.join(", ")+")")}var c=!!e.___cxa_demangle;if(c)try{var d=ua(a.length);ka(a.substr(1),d);var f=ua(4),h=e.___cxa_demangle(d,0,0,f);if(0===ta(f,"i32")&&h)return la(h)}catch(g){}finally{d&&Da(d),f&&Da(f),h&&Da(h)}var k=3,t={v:"void",b:"bool",c:"char",s:"short",i:"int",l:"long",f:"float",d:"double",w:"wchar_t",a:"signed char",h:"unsigned char",t:"unsigned short",j:"unsigned int",m:"unsigned long",x:"long long",y:"unsigned long long",z:"..."},r=[],u=!0,d=a;try{if("Object._main"==a||"_main"==a)return"main()";"number"===typeof a&&(a=la(a));if("_"!==a[0]||"_"!==a[1]||"Z"!==a[2])return a;switch(a[3]){case"n":return"operator new()";case"d":return"operator delete()"}d=b()}catch(q){d+="?"}0<=d.indexOf("?")&&!c&&n.M("warning: a problem occurred in builtin C++ name demangling; build with  -s DEMANGLE_SUPPORT=1  to link in libcxxabi demangling");return d}function Ea(){return Fa().replace(/__Z[\w\d_]+/g,function(a){var b=Ca(a);return a===b?a:a+" ["+b+"]"})}function Fa(){var a=Error();if(!a.stack){try{throw Error(0)}catch(b){a=b}if(!a.stack)return"(no stack trace available)"}return a.stack.toString()}e.stackTrace=function(){return Ea()};function Ga(){var a=v;0<a%4096&&(a+=4096-a%4096);return a}for(var D,H,E,Ha,F,Ia,ra,sa,Ja=0,p=0,va=!1,Ka=0,m=0,La=0,Ma=0,v=0,Na=e.TOTAL_STACK||5242880,w=e.TOTAL_MEMORY||16777216,I=65536;I<w||I<2*Na;)I=16777216>I?2*I:I+16777216;I!==w&&(w=I);assert("undefined"!==typeof Int32Array&&"undefined"!==typeof Float64Array&&!!new Int32Array(1).subarray&&!!new Int32Array(1).set,"JS engine does not provide full typed array support");var buffer;buffer=new ArrayBuffer(w);D=new Int8Array(buffer);E=new Int16Array(buffer);F=new Int32Array(buffer);H=new Uint8Array(buffer);Ha=new Uint16Array(buffer);Ia=new Uint32Array(buffer);ra=new Float32Array(buffer);sa=new Float64Array(buffer);F[0]=255;assert(255===H[0]&&0===H[3],"Typed arrays 2 must be run on a little-endian system");e.HEAP=void 0;e.buffer=buffer;e.HEAP8=D;e.HEAP16=E;e.HEAP32=F;e.HEAPU8=H;e.HEAPU16=Ha;e.HEAPU32=Ia;e.HEAPF32=ra;e.HEAPF64=sa;function Oa(a){for(;0<a.length;){var b=a.shift();if("function"==typeof b)b();else{var c=b.Qa;"number"===typeof c?void 0===b.T?n.J("v",c):n.J("vi",c,[b.T]):c(void 0===b.T?null:b.T)}}}var Pa=[],Qa=[],Ra=[],K=[],Sa=[],xa=!1;function Ta(a){Pa.unshift(a)}e.addOnPreRun=Ta;e.addOnInit=function(a){Qa.unshift(a)};e.addOnPreMain=function(a){Ra.unshift(a)};e.addOnExit=function(a){K.unshift(a)};function Ua(a){Sa.unshift(a)}e.addOnPostRun=Ua;function Va(a,b,c){c=Array(0<c?c:Ba(a)+1);a=Aa(a,c,0,c.length);b&&(c.length=a);return c}e.intArrayFromString=Va;e.intArrayToString=function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];255<d&&(d&=255);b.push(String.fromCharCode(d))}return b.join("")};function ka(a,b,c){a=Va(a,c);for(c=0;c<a.length;)D[b+c>>0]=a[c],c+=1}e.writeStringToMemory=ka;function ja(a,b){for(var c=0;c<a.length;c++)D[b++>>0]=a[c]}e.writeArrayToMemory=ja;function ya(a,b,c){for(var d=0;d<a.length;++d)D[b++>>0]=a.charCodeAt(d);c||(D[b>>0]=0)}e.writeAsciiToMemory=ya;Math.imul&&-5===Math.imul(4294967295,5)||(Math.imul=function(a,b){var c=a&65535,d=b&65535;return c*d+((a>>>16)*d+c*(b>>>16)<<16)|0});Math.td=Math.imul;Math.clz32||(Math.clz32=function(a){a=a>>>0;for(var b=0;32>b;b++)if(a&1<<31-b)return b;return 32});Math.kd=Math.clz32;var na=Math.abs,qa=Math.ceil,pa=Math.floor,oa=Math.min,L=0,Wa=null,Xa=null;function Ya(){L++,e.monitorRunDependencies&&e.monitorRunDependencies(L)}e.addRunDependency=Ya;function Za(){L--;e.monitorRunDependencies&&e.monitorRunDependencies(L);if(0==L&&(null!==Wa&&(clearInterval(Wa),Wa=null),Xa)){var a=Xa;Xa=null;a()}}e.removeRunDependency=Za;e.preloadedImages={};e.preloadedAudios={};Ja=8;p=Ja+1696;Qa.push();G([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,60,0,0,0,0,0,0,0,5,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,2,0,0,0,164,2,0,0,0,4,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,255,255,255,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"i8",4,n.La);var $a=n.ea(G(12,"i8",2),8);assert(0==$a%8);e._bitshift64Ashr=ab;e._i64Subtract=bb;e._i64Add=cb;e._memset=db;function eb(a,b){K.push(function(){n.J("vi",a,[b])}),eb.level=K.length}e._bitshift64Lshr=fb;e._bitshift64Shl=gb;var M={G:1,B:2,Qc:3,Nb:4,F:5,sa:6,gb:7,kc:8,Z:9,ub:10,oa:11,$c:11,Ka:12,Y:13,Gb:14,wc:15,$:16,pa:17,ad:18,ba:19,qa:20,N:21,u:22,fc:23,Ja:24,O:25,Xc:26,Hb:27,sc:28,da:29,Nc:30,Zb:31,Gc:32,Db:33,Kc:34,oc:42,Kb:43,vb:44,Qb:45,Rb:46,Sb:47,Yb:48,Yc:49,ic:50,Pb:51,Ab:35,lc:37,mb:52,pb:53,bd:54,gc:55,qb:56,rb:57,Bb:35,sb:59,uc:60,jc:61,Uc:62,tc:63,pc:64,qc:65,Mc:66,mc:67,jb:68,Rc:69,wb:70,Hc:71,ac:72,Eb:73,ob:74,Bc:76,nb:77,Lc:78,Tb:79,Ub:80,Xb:81,Wb:82,Vb:83,vc:38,ra:39,bc:36,aa:40,Cc:95,Fc:96,zb:104,hc:105,kb:97,Jc:91,zc:88,rc:92,Oc:108,yb:111,hb:98,xb:103,ec:101,cc:100,Vc:110,Ib:112,Jb:113,Mb:115,lb:114,Cb:89,$b:90,Ic:93,Pc:94,ib:99,dc:102,Ob:106,xc:107,Wc:109,Zc:87,Fb:122,Sc:116,Ac:95,nc:123,Lb:84,Dc:75,tb:125,yc:131,Ec:130,Tc:86},hb={0:"Success",1:"Not super-user",2:"No such file or directory",3:"No such process",4:"Interrupted system call",5:"I/O error",6:"No such device or address",7:"Arg list too long",8:"Exec format error",9:"Bad file number",10:"No children",11:"No more processes",12:"Not enough core",13:"Permission denied",14:"Bad address",15:"Block device required",16:"Mount device busy",17:"File exists",18:"Cross-device link",19:"No such device",20:"Not a directory",21:"Is a directory",22:"Invalid argument",23:"Too many open files in system",24:"Too many open files",25:"Not a typewriter",26:"Text file busy",27:"File too large",28:"No space left on device",29:"Illegal seek",30:"Read only file system",31:"Too many links",32:"Broken pipe",33:"Math arg out of domain of func",34:"Math result not representable",35:"File locking deadlock error",36:"File or path name too long",37:"No record locks available",38:"Function not implemented",39:"Directory not empty",40:"Too many symbolic links",42:"No message of desired type",43:"Identifier removed",44:"Channel number out of range",45:"Level 2 not synchronized",46:"Level 3 halted",47:"Level 3 reset",48:"Link number out of range",49:"Protocol driver not attached",50:"No CSI structure available",51:"Level 2 halted",52:"Invalid exchange",53:"Invalid request descriptor",54:"Exchange full",55:"No anode",56:"Invalid request code",57:"Invalid slot",59:"Bad font file fmt",60:"Device not a stream",61:"No data (for no delay io)",62:"Timer expired",63:"Out of streams resources",64:"Machine is not on the network",65:"Package not installed",66:"The object is remote",67:"The link has been severed",68:"Advertise error",69:"Srmount error",70:"Communication error on send",71:"Protocol error",72:"Multihop attempted",73:"Cross mount point (not really error)",74:"Trying to read unreadable message",75:"Value too large for defined data type",76:"Given log. name not unique",77:"f.d. invalid for this operation",78:"Remote address changed",79:"Can   access a needed shared lib",80:"Accessing a corrupted shared lib",81:".lib section in a.out corrupted",82:"Attempting to link in too many libs",83:"Attempting to exec a shared library",84:"Illegal byte sequence",86:"Streams pipe error",87:"Too many users",88:"Socket operation on non-socket",89:"Destination address required",90:"Message too long",91:"Protocol wrong type for socket",92:"Protocol not available",93:"Unknown protocol",94:"Socket type not supported",95:"Not supported",96:"Protocol family not supported",97:"Address family not supported by protocol family",98:"Address already in use",99:"Address not available",100:"Network interface is not configured",101:"Network is unreachable",102:"Connection reset by network",103:"Connection aborted",104:"Connection reset by peer",105:"No buffer space available",106:"Socket is already connected",107:"Socket is not connected",108:"Can't send after socket shutdown",109:"Too many references",110:"Connection timed out",111:"Connection refused",112:"Host is down",113:"Host is unreachable",114:"Socket already connected",115:"Connection already in progress",116:"Stale file handle",122:"Quota exceeded",123:"No medium (in tape drive)",125:"Operation canceled",130:"Previous owner died",131:"State not recoverable"};function ib(a){e.___errno_location&&(F[e.___errno_location()>>2]=a);return a}function jb(a,b){for(var c=0,d=a.length-1;0<=d;d--){var f=a[d];"."===f?a.splice(d,1):".."===f?(a.splice(d,1),c++):c&&(a.splice(d,1),c--)}if(b)for(;c--;c)a.unshift("..");return a}function N(a){var b="/"===a.charAt(0),c="/"===a.substr(-1);(a=jb(a.split("/").filter(function(a){return!!a}),!b).join("/"))||b||(a=".");a&&c&&(a+="/");return(b?"/":"")+a}function kb(a){var b=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(a).slice(1);a=b[0];b=b[1];if(!a&&!b)return".";b&&(b=b.substr(0,b.length-1));return a+b}function lb(a){if("/"===a)return"/";var b=a.lastIndexOf("/");return-1===b?a:a.substr(b+1)}function mb(){for(var a="",b=!1,c=arguments.length-1;-1<=c&&!b;c--){b=0<=c?arguments[c]:"/";if("string"!==typeof b)throw new TypeError("Arguments to path.resolve must be strings");if(!b)return"";a=b+"/"+a;b="/"===b.charAt(0)}a=jb(a.split("/").filter(function(a){return!!a}),!b).join("/");return(b?"/":"")+a||"."}var nb=[];function ob(a,b){nb[a]={input:[],output:[],L:b},pb(a,qb)}var qb={open:function(a){var b=nb[a.g.rdev];if(!b)throw new O(M.ba);a.tty=b;a.seekable=!1},close:function(a){a.tty.L.flush(a.tty)},flush:function(a){a.tty.L.flush(a.tty)},read:function(a,b,c,d){if(!a.tty||!a.tty.L.Ba)throw new O(M.sa);for(var f=0,h=0;h<d;h++){var g;try{g=a.tty.L.Ba(a.tty)}catch(k){throw new O(M.F)}if(void 0===g&&0===f)throw new O(M.oa);if(null===g||void 0===g)break;f++;b[c+h]=g}f&&(a.g.timestamp=Date.now());return f},write:function(a,b,c,d){if(!a.tty||!a.tty.L.ja)throw new O(M.sa);for(var f=0;f<d;f++)try{a.tty.L.ja(a.tty,b[c+f])}catch(h){throw new O(M.F)}d&&(a.g.timestamp=Date.now());return f}},rb={Ba:function(a){if(!a.input.length){var b=null;"undefined"!=typeof window&&"function"==typeof window.prompt?(b=window.prompt("Input: "),null!==b&&(b+="\n")):"function"==typeof readline&&(b=readline(),null!==b&&(b+="\n"));if(!b)return null;a.input=Va(b,!0)}return a.input.shift()},ja:function(a,b){null===b||10===b?(e.print(za(a.output,0)),a.output=[]):0!=b&&a.output.push(b)},flush:function(a){a.output&&0<a.output.length&&(e.print(za(a.output,0)),a.output=[])}},sb={ja:function(a,b){null===b||10===b?(e.printErr(za(a.output,0)),a.output=[]):0!=b&&a.output.push(b)},flush:function(a){a.output&&0<a.output.length&&(e.printErr(za(a.output,0)),a.output=[])}},P={q:null,A:function(){return P.createNode(null,"/",16895,0)},createNode:function(a,b,c,d){if(24576===(c&61440)||4096===(c&61440))throw new O(M.G);P.q||(P.q={dir:{g:{D:P.k.D,p:P.k.p,lookup:P.k.lookup,V:P.k.V,rename:P.k.rename,unlink:P.k.unlink,rmdir:P.k.rmdir,readdir:P.k.readdir,symlink:P.k.symlink},stream:{I:P.n.I}},file:{g:{D:P.k.D,p:P.k.p},stream:{I:P.n.I,read:P.n.read,write:P.n.write,ta:P.n.ta,Ea:P.n.Ea,Ga:P.n.Ga}},link:{g:{D:P.k.D,p:P.k.p,readlink:P.k.readlink},stream:{}},va:{g:{D:P.k.D,p:P.k.p},stream:tb}});c=ub(a,b,c,d);16384===(c.mode&61440)?(c.k=P.q.dir.g,c.n=P.q.dir.stream,c.e={}):32768===(c.mode&61440)?(c.k=P.q.file.g,c.n=P.q.file.stream,c.o=0,c.e=null):40960===(c.mode&61440)?(c.k=P.q.link.g,c.n=P.q.link.stream):8192===(c.mode&61440)&&(c.k=P.q.va.g,c.n=P.q.va.stream);c.timestamp=Date.now();a&&(a.e[b]=c);return c},Sa:function(a){if(a.e&&a.e.subarray){for(var b=[],c=0;c<a.o;++c)b.push(a.e[c]);return b}return a.e},qd:function(a){return a.e?a.e.subarray?a.e.subarray(0,a.o):new Uint8Array(a.e):new Uint8Array},ya:function(a,b){a.e&&a.e.subarray&&b>a.e.length&&(a.e=P.Sa(a),a.o=a.e.length);if(!a.e||a.e.subarray){var c=a.e?a.e.buffer.byteLength:0;c>=b||(b=Math.max(b,c*(1048576>c?2:1.125)|0),0!=c&&(b=Math.max(b,256)),c=a.e,a.e=new Uint8Array(b),0<a.o&&a.e.set(c.subarray(0,a.o),0))}else for(!a.e&&0<b&&(a.e=[]);a.e.length<b;)a.e.push(0)},ab:function(a,b){if(a.o!=b)if(0==b)a.e=null,a.o=0;else{if(!a.e||a.e.subarray){var c=a.e;a.e=new Uint8Array(new ArrayBuffer(b));c&&a.e.set(c.subarray(0,Math.min(b,a.o)))}else if(a.e||(a.e=[]),a.e.length>b)a.e.length=b;else for(;a.e.length<b;)a.e.push(0);a.o=b}},k:{D:function(a){var b={};b.dev=8192===(a.mode&61440)?a.id:1;b.ino=a.id;b.mode=a.mode;b.nlink=1;b.uid=0;b.gid=0;b.rdev=a.rdev;16384===(a.mode&61440)?b.size=4096:32768===(a.mode&61440)?b.size=a.o:40960===(a.mode&61440)?b.size=a.link.length:b.size=0;b.atime=new Date(a.timestamp);b.mtime=new Date(a.timestamp);b.ctime=new Date(a.timestamp);b.Pa=4096;b.blocks=Math.ceil(b.size/b.Pa);return b},p:function(a,b){void 0!==b.mode&&(a.mode=b.mode),void 0!==b.timestamp&&(a.timestamp=b.timestamp),void 0!==b.size&&P.ab(a,b.size)},lookup:function(){throw vb[M.B]},V:function(a,b,c,d){return P.createNode(a,b,c,d)},rename:function(a,b,c){if(16384===(a.mode&61440)){var d;try{d=wb(b,c)}catch(f){}if(d)for(var h in d.e)throw new O(M.ra)}delete a.parent.e[a.name];a.name=c;b.e[c]=a;a.parent=b},unlink:function(a,b){delete a.e[b]},rmdir:function(a,b){var c=wb(a,b),d;for(d in c.e)throw new O(M.ra);delete a.e[b]},readdir:function(a){var b=[".",".."],c;for(c in a.e)a.e.hasOwnProperty(c)&&b.push(c);return b},symlink:function(a,b,c){a=P.createNode(a,b,41471,0);a.link=c;return a},readlink:function(a){if(40960!==(a.mode&61440))throw new O(M.u);return a.link}},n:{read:function(a,b,c,d,f){var h=a.g.e;if(f>=a.g.o)return 0;a=Math.min(a.g.o-f,d);assert(0<=a);if(8<a&&h.subarray)b.set(h.subarray(f,f+a),c);else for(d=0;d<a;d++)b[c+d]=h[f+d];return a},write:function(a,b,c,d,f,h){if(!d)return 0;a=a.g;a.timestamp=Date.now();if(b.subarray&&(!a.e||a.e.subarray)){if(h)return a.e=b.subarray(c,c+d),a.o=d;if(0===a.o&&0===f)return a.e=new Uint8Array(b.subarray(c,c+d)),a.o=d;if(f+d<=a.o)return a.e.set(b.subarray(c,c+d),f),d}P.ya(a,f+d);if(a.e.subarray&&b.subarray)a.e.set(b.subarray(c,c+d),f);else for(h=0;h<d;h++)a.e[f+h]=b[c+h];a.o=Math.max(a.o,f+d);return d},I:function(a,b,c){1===c?b+=a.position:2===c&&32768===(a.g.mode&61440)&&(b+=a.g.o);if(0>b)throw new O(M.u);return b},ta:function(a,b,c){P.ya(a.g,b+c),a.g.o=Math.max(a.g.o,b+c)},Ea:function(a,b,c,d,f,h,g){if(32768!==(a.g.mode&61440))throw new O(M.ba);c=a.g.e;if(g&2||c.buffer!==b&&c.buffer!==b.buffer){(0<f||f+d<a.g.o)&&(c.subarray?c=c.subarray(f,f+d):c=Array.prototype.slice.call(c,f,f+d));a=!0;d=ua(d);if(!d)throw new O(M.Ka);b.set(c,d)}else a=!1,d=c.byteOffset;return{Cd:d,gd:a}},Ga:function(a,b,c,d,f){if(32768!==(a.g.mode&61440))throw new O(M.ba);if(f&2)return 0;P.n.write(a,b,0,d,c,!1);return 0}}};G(1,"i32*",2);G(1,"i32*",2);G(1,"i32*",2);var xb=null,yb=[null],zb=[],Ab=1,R=null,Cb=!0,S={},O=null,vb={};function T(a,b){a=mb("/",a);b=b||{};if(!a)return{path:"",g:null};var c={za:!0,ka:0},d;for(d in c)void 0===b[d]&&(b[d]=c[d]);if(8<b.ka)throw new O(M.aa);var c=jb(a.split("/").filter(function(a){return!!a}),!1),f=xb;d="/";for(var h=0;h<c.length;h++){var g=h===c.length-1;if(g&&b.parent)break;f=wb(f,c[h]);d=N(d+"/"+c[h]);f.R&&(!g||g&&b.za)&&(f=f.R.root);if(!g||b.ga)for(g=0;40960===(f.mode&61440);)if(f=Db(d),d=mb(kb(d),f),f=T(d,{ka:b.ka}).g,40<g++)throw new O(M.aa)}return{path:d,g:f}}function U(a){for(var b;;){if(a===a.parent)return a=a.A.Fa,b?"/"!==a[a.length-1]?a+"/"+b:a+b:a;b=b?a.name+"/"+b:a.name;a=a.parent}}function Eb(a,b){for(var c=0,d=0;d<b.length;d++)c=(c<<5)-c+b.charCodeAt(d)|0;return(a+c>>>0)%R.length}function Fb(a){var b=Eb(a.parent.id,a.name);a.K=R[b];R[b]=a}function wb(a,b){var c;if(c=(c=Gb(a,"x"))?c:a.k.lookup?0:M.Y)throw new O(c,a);for(c=R[Eb(a.id,b)];c;c=c.K){var d=c.name;if(c.parent.id===a.id&&d===b)return c}return a.k.lookup(a,b)}function ub(a,b,c,d){Hb||(Hb=function(a,b,c,d){a||(a=this),this.parent=a,this.A=a.A,this.R=null,this.id=Ab++,this.name=b,this.mode=c,this.k={},this.n={},this.rdev=d},Hb.prototype={},Object.defineProperties(Hb.prototype,{read:{get:function(){return 365===(this.mode&365)},set:function(a){a?this.mode|=365:this.mode&=-366}},write:{get:function(){return 146===(this.mode&146)},set:function(a){a?this.mode|=146:this.mode&=-147}},Xa:{get:function(){return 16384===(this.mode&61440)}},Ca:{get:function(){return 8192===(this.mode&61440)}}}));a=new Hb(a,b,c,d);Fb(a);return a}var Ib={r:0,rs:1052672,"r+":2,w:577,wx:705,xw:705,"w+":578,"wx+":706,"xw+":706,a:1089,ax:1217,xa:1217,"a+":1090,"ax+":1218,"xa+":1218};function Gb(a,b){if(Cb)return 0;if(-1===b.indexOf("r")||a.mode&292){if(-1!==b.indexOf("w")&&!(a.mode&146)||-1!==b.indexOf("x")&&!(a.mode&73))return M.Y}else return M.Y;return 0}function Jb(a,b){try{return wb(a,b),M.pa}catch(c){}return Gb(a,"wx")}function Kb(){var a;a=4096;for(var b=0;b<=a;b++)if(!zb[b])return b;throw new O(M.Ja)}function Lb(a){Mb||(Mb=function(){},Mb.prototype={},Object.defineProperties(Mb.prototype,{object:{get:function(){return this.g},set:function(a){this.g=a}},vd:{get:function(){return 1!==(this.flags&2097155)}},wd:{get:function(){return 0!==(this.flags&2097155)}},ud:{get:function(){return this.flags&1024}}}));var b=new Mb,c;for(c in a)b[c]=a[c];a=b;b=Kb();a.fd=b;return zb[b]=a}var tb={open:function(a){a.n=yb[a.g.rdev].n,a.n.open&&a.n.open(a)},I:function(){throw new O(M.da)}};function pb(a,b){yb[a]={n:b}}function Nb(a,b){var c="/"===b,d=!b,f;if(c&&xb)throw new O(M.$);if(!c&&!d){f=T(b,{za:!1});b=f.path;f=f.g;if(f.R)throw new O(M.$);if(16384!==(f.mode&61440))throw new O(M.qa)}var d={type:a,Ad:{},Fa:b,Ya:[]},h=a.A(d);h.A=d;d.root=h;c?xb=h:f&&(f.R=d,f.A&&f.A.Ya.push(d))}function Ob(a,b,c){var d=T(a,{parent:!0}).g;a=lb(a);if(!a||"."===a||".."===a)throw new O(M.u);var f=Jb(d,a);if(f)throw new O(f);if(!d.k.V)throw new O(M.G);return d.k.V(d,a,b,c)}function Pb(a,b){b=(void 0!==b?b:438)&4095;b|=32768;return Ob(a,b,0)}function V(a,b){b=(void 0!==b?b:511)&1023;b|=16384;return Ob(a,b,0)}function Qb(a,b,c){"undefined"===typeof c&&(c=b,b=438);return Ob(a,b|8192,c)}function Rb(a,b){if(!mb(a))throw new O(M.B);var c=T(b,{parent:!0}).g;if(!c)throw new O(M.B);var d=lb(b),f=Jb(c,d);if(f)throw new O(f);if(!c.k.symlink)throw new O(M.G);return c.k.symlink(c,d,a)}function Db(a){a=T(a).g;if(!a)throw new O(M.B);if(!a.k.readlink)throw new O(M.u);return mb(U(a.parent),a.k.readlink(a))}function Sb(a,b){var c;"string"===typeof a?c=T(a,{ga:!0}).g:c=a;if(!c.k.p)throw new O(M.G);c.k.p(c,{mode:b&4095|c.mode&-4096,timestamp:Date.now()})}function Tb(a,b){var c;if(""===a)throw new O(M.B);var d;if("string"===typeof b){if(d=Ib[b],"undefined"===typeof d)throw Error("Unknown file open mode: "+b)}else d=b;b=d;c=b&64?("undefined"===typeof c?438:c)&4095|32768:0;var f;if("object"===typeof a)f=a;else{a=N(a);try{f=T(a,{ga:!(b&131072)}).g}catch(h){}}d=!1;if(b&64)if(f){if(b&128)throw new O(M.pa)}else f=Ob(a,c,0),d=!0;if(!f)throw new O(M.B);8192===(f.mode&61440)&&(b&=-513);if(b&65536&&16384!==(f.mode&61440))throw new O(M.qa);if(!d&&(f?40960===(f.mode&61440)?c=M.aa:16384===(f.mode&61440)&&(0!==(b&2097155)||b&512)?c=M.N:(c=["r","w","rw"][b&3],b&512&&(c+="w"),c=Gb(f,c)):c=M.B,c))throw new O(c);if(b&512){c=f;var g;"string"===typeof c?g=T(c,{ga:!0}).g:g=c;if(!g.k.p)throw new O(M.G);if(16384===(g.mode&61440))throw new O(M.N);if(32768!==(g.mode&61440))throw new O(M.u);if(c=Gb(g,"w"))throw new O(c);g.k.p(g,{size:0,timestamp:Date.now()})}b&=-641;f=Lb({g:f,path:U(f),flags:b,seekable:!0,position:0,n:f.n,eb:[],error:!1});f.n.open&&f.n.open(f);!e.logReadFiles||b&1||(Ub||(Ub={}),a in Ub||(Ub[a]=1,e.printErr("read file: "+a)));try{S.onOpenFile&&(g=0,1!==(b&2097155)&&(g|=1),0!==(b&2097155)&&(g|=2),S.onOpenFile(a,g))}catch(k){}return f}function Vb(a){a.ia&&(a.ia=null);try{a.n.close&&a.n.close(a)}catch(b){throw b}finally{zb[a.fd]=null}}function Wb(a,b,c){if(!a.seekable||!a.n.I)throw new O(M.da);a.position=a.n.I(a,b,c);a.eb=[]}function Xb(a,b,c,d,f,h){if(0>d||0>f)throw new O(M.u);if(0===(a.flags&2097155))throw new O(M.Z);if(16384===(a.g.mode&61440))throw new O(M.N);if(!a.n.write)throw new O(M.u);a.flags&1024&&Wb(a,0,2);var g=!0;if("undefined"===typeof f)f=a.position,g=!1;else if(!a.seekable)throw new O(M.da);b=a.n.write(a,b,c,d,f,h);g||(a.position+=b);try{a.path&&S.onWriteToFile&&S.onWriteToFile(a.path)}catch(k){}return b}function Yb(){O||(O=function(a,b){this.g=b,this.bb=function(a){this.Q=a;for(var b in M)if(M[b]===a){this.code=b;break}},this.bb(a),this.message=hb[a]},O.prototype=Error(),O.prototype.constructor=O,[M.B].forEach(function(a){vb[a]=new O(a),vb[a].stack="<generic error, no stack>"}))}var Zb;function $b(a,b){var c=0;a&&(c|=365);b&&(c|=146);return c}function ac(a,b,c,d){a=N(("string"===typeof a?a:U(a))+"/"+b);return Pb(a,$b(c,d))}function bc(a,b,c,d,f,h){a=b?N(("string"===typeof a?a:U(a))+"/"+b):a;d=$b(d,f);f=Pb(a,d);if(c){if("string"===typeof c){a=Array(c.length);b=0;for(var g=c.length;b<g;++b)a[b]=c.charCodeAt(b);c=a}Sb(f,d|146);a=Tb(f,"w");Xb(a,c,0,c.length,0,h);Vb(a);Sb(f,d)}return f}function W(a,b,c,d){a=N(("string"===typeof a?a:U(a))+"/"+b);b=$b(!!c,!!d);W.Da||(W.Da=64);var f=W.Da++<<8|0;pb(f,{open:function(a){a.seekable=!1},close:function(){d&&d.buffer&&d.buffer.length&&d(10)},read:function(a,b,d,f){for(var r=0,u=0;u<f;u++){var q;try{q=c()}catch(y){throw new O(M.F)}if(void 0===q&&0===r)throw new O(M.oa);if(null===q||void 0===q)break;r++;b[d+u]=q}r&&(a.g.timestamp=Date.now());return r},write:function(a,b,c,f){for(var r=0;r<f;r++)try{d(b[c+r])}catch(u){throw new O(M.F)}f&&(a.g.timestamp=Date.now());return r}});return Qb(a,b,f)}function cc(a){if(a.Ca||a.Xa||a.link||a.e)return!0;var b=!0;if("undefined"!==typeof XMLHttpRequest)throw Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(e.read)try{a.e=Va(e.read(a.url),!0),a.o=a.e.length}catch(c){b=!1}else throw Error("Cannot load without read() or XMLHttpRequest.");b||ib(M.F);return b}var dc={},Hb,Mb,Ub,ec=0;function X(){ec+=4;return F[ec-4>>2]}function fc(){var a;a=X();a=zb[a];if(!a)throw new O(M.Z);return a}function wa(a){wa.C||(v=Ga(),wa.C=!0,assert(n.P),wa.Ra=n.P,n.P=function(){z("cannot dynamically allocate, sbrk now has control")});var b=v;return 0==a||wa.Ra(a)?b:4294967295}e._memcpy=gc;function hc(a,b){ic=a;jc=b;if(!kc)return 1;if(0==a)Y=function(){setTimeout(lc,b)},mc="timeout";else if(1==a)Y=function(){nc(lc)},mc="rAF";else if(2==a){if(!window.setImmediate){var c=[];window.addEventListener("message",function(a){a.source===window&&"__emcc"===a.data&&(a.stopPropagation(),c.shift()())},!0);window.setImmediate=function(a){c.push(a),window.postMessage("__emcc","*")}}Y=function(){window.setImmediate(lc)};mc="immediate"}return 0}function oc(a,b,c,d,f){e.noExitRuntime=!0;assert(!kc,"emscripten_set_main_loop: there can only be one main loop function at once: call emscripten_cancel_main_loop to cancel the previous one before setting a new one with different parameters.");kc=a;pc=d;var h=qc;lc=function(){if(!A)if(0<rc.length){var b=Date.now(),c=rc.shift();c.Qa(c.T);if(sc){var f=sc,r=0==f%1?f-1:Math.floor(f);sc=c.ld?r:(8*f+(r+.5))/9}tc();setTimeout(lc,0)}else h<qc||(uc=uc+1|0,1==ic&&1<jc&&0!=uc%jc?Y():("timeout"===mc&&e.fa&&(e.S("Looks like you are rendering without using requestAnimationFrame for the main loop. You should use 0 for the frame rate in emscripten_set_main_loop in order to use requestAnimationFrame, as that can greatly improve your frame rates!"),mc=""),vc(function(){"undefined"!==typeof d?n.J("vi",a,[d]):n.J("v",a)}),h<qc||("object"===typeof SDL&&SDL.audio&&SDL.audio.Za&&SDL.audio.Za(),Y())))};f||(b&&0<b?hc(0,1e3/b):hc(1,1),Y());if(c)throw"SimulateInfiniteLoop"}var Y=null,mc="",qc=0,kc=null,pc=0,ic=0,jc=0,uc=0,rc=[];function tc(){if(e.setStatus){var a=e.statusMessage||"Please wait...",b=sc,c=wc.nd;b?b<c?e.setStatus(a+" ("+(c-b)+"/"+c+")"):e.setStatus(a):e.setStatus("")}}function vc(a){if(!(A||e.preMainLoop&&!1===e.preMainLoop())){try{a()}catch(b){if(b instanceof xc)return;b&&"object"===typeof b&&b.stack&&e.S("exception thrown: "+[b,b.stack]);throw b}e.postMainLoop&&e.postMainLoop()}}var wc={},lc,sc,yc=!1,zc=!1,Ac=[];function Bc(){function a(){zc=document.pointerLockElement===c||document.mozPointerLockElement===c||document.webkitPointerLockElement===c||document.msPointerLockElement===c}e.preloadPlugins||(e.preloadPlugins=[]);if(!Cc){Cc=!0;try{Dc=!0}catch(b){Dc=!1,!1}Ec="undefined"!=typeof MozBlobBuilder?MozBlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:Dc?null:!1;Fc="undefined"!=typeof window?window.URL?window.URL:window.webkitURL:void 0;e.Ha||"undefined"!==typeof Fc||(!1,e.Ha=!0);e.preloadPlugins.push({canHandle:function(a){return!e.Ha&&/\.(jpg|jpeg|png|bmp)$/i.test(a)},handle:function(a,b,c,g){var k=null;if(Dc)try{k=new Blob([a],{type:Gc(b)}),k.size!==a.length&&(k=new Blob([new Uint8Array(a).buffer],{type:Gc(b)}))}catch(t){n.M("Blob constructor present but fails: "+t+"; falling back to blob builder")}k||(k=new Ec,k.append(new Uint8Array(a).buffer),k=k.getBlob());var r=Fc.createObjectURL(k),u=new Image;u.onload=function(){assert(u.complete,"Image "+b+" could not be decoded");var g=document.createElement("canvas");g.width=u.width;g.height=u.height;g.getContext("2d").drawImage(u,0,0);e.preloadedImages[b]=g;Fc.revokeObjectURL(r);c&&c(a)};u.onerror=function(){g&&g()};u.src=r}});e.preloadPlugins.push({canHandle:function(a){return!e.zd&&a.substr(-4)in{".ogg":1,".wav":1,".mp3":1}},handle:function(a,b,c,g){function k(g){r||(r=!0,e.preloadedAudios[b]=g,c&&c(a))}function t(){r||(r=!0,e.preloadedAudios[b]=new Audio,g&&g())}var r=!1;if(Dc){try{var u=new Blob([a],{type:Gc(b)})}catch(q){return t()}var u=Fc.createObjectURL(u),y=new Audio;y.addEventListener("canplaythrough",function(){k(y)},!1);y.onerror=function(){if(!r){for(var c="",h=0,g=0,q=0;q<a.length;q++)for(h=h<<8|a[q],g+=8;6<=g;)var t=h>>g-6&63,g=g-6,c=c+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[t];2==g?(c+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(h&3)<<4],c+="=="):4==g&&(c+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(h&15)<<2],c+="=");y.src="data:audio/x-"+b.substr(-3)+";base64,"+c;k(y)}};y.src=u;Hc(function(){k(y)})}else return t()}});var c=e.canvas;c&&(c.la=c.requestPointerLock||c.mozRequestPointerLock||c.webkitRequestPointerLock||c.msRequestPointerLock||function(){},c.wa=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock||document.msExitPointerLock||function(){},c.wa=c.wa.bind(document),document.addEventListener("pointerlockchange",a,!1),document.addEventListener("mozpointerlockchange",a,!1),document.addEventListener("webkitpointerlockchange",a,!1),document.addEventListener("mspointerlockchange",a,!1),e.elementPointerLock&&c.addEventListener("click",function(a){!zc&&c.la&&(c.la(),a.preventDefault())},!1))}}function Ic(a,b,c,d){if(b&&e.fa&&a==e.canvas)return e.fa;var f,h;if(b){h={antialias:!1,alpha:!1};if(d)for(var g in d)h[g]=d[g];(h=GL.createContext(a,h))&&(f=GL.getContext(h).cd);a.style.backgroundColor="black"}else f=a.getContext("2d");if(!f)return null;c&&(b||assert("undefined"===typeof GLctx,"cannot set in module if GLctx is used, but we are a non-GL context that would replace it"),e.fa=f,b&&GL.yd(h),e.Dd=b,Ac.forEach(function(a){a()}),Bc());return f}var Jc=!1,Kc=void 0,Lc=void 0;function Mc(a,b,c){function d(){yc=!1;var a=f.parentNode;(document.webkitFullScreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.mozFullscreenElement||document.fullScreenElement||document.fullscreenElement||document.msFullScreenElement||document.msFullscreenElement||document.webkitCurrentFullScreenElement)===a?(f.ua=document.cancelFullScreen||document.mozCancelFullScreen||document.webkitCancelFullScreen||document.msExitFullscreen||document.exitFullscreen||function(){},f.ua=f.ua.bind(document),Kc&&f.la(),yc=!0,Lc&&Nc()):(a.parentNode.insertBefore(f,a),a.parentNode.removeChild(a),Lc&&Oc());e.onFullScreen&&e.onFullScreen(yc);Pc(f)}Kc=a;Lc=b;Qc=c;"undefined"===typeof Kc&&(Kc=!0);"undefined"===typeof Lc&&(Lc=!1);"undefined"===typeof Qc&&(Qc=null);var f=e.canvas;Jc||(Jc=!0,document.addEventListener("fullscreenchange",d,!1),document.addEventListener("mozfullscreenchange",d,!1),document.addEventListener("webkitfullscreenchange",d,!1),document.addEventListener("MSFullscreenChange",d,!1));var h=document.createElement("div");f.parentNode.insertBefore(h,f);h.appendChild(f);h.C=h.requestFullScreen||h.mozRequestFullScreen||h.msRequestFullscreen||(h.webkitRequestFullScreen?function(){h.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)}:null);c?h.C({Ed:c}):h.C()}var Rc=0;function Sc(a){var b=Date.now();if(0===Rc)Rc=b+1e3/60;else for(;b+2>=Rc;)Rc+=1e3/60;b=Math.max(Rc-b,0);setTimeout(a,b)}function nc(a){"undefined"===typeof window?Sc(a):(window.requestAnimationFrame||(window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||Sc),window.requestAnimationFrame(a))}function Hc(a){e.noExitRuntime=!0,setTimeout(function(){A||a()},1e4)}function Gc(a){return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",bmp:"image/bmp",ogg:"audio/ogg",wav:"audio/wav",mp3:"audio/mpeg"}[a.substr(a.lastIndexOf(".")+1)]}function Tc(a,b,c){var d=new XMLHttpRequest;d.open("GET",a,!0);d.responseType="arraybuffer";d.onload=function(){200==d.status||0==d.status&&d.response?b(d.response):c()};d.onerror=c;d.send(null)}function Uc(a,b,c){Tc(a,function(c){assert(c,'Loading data file "'+a+'" failed (no arrayBuffer).'),b(new Uint8Array(c)),Za()},function(){if(c)c();else throw'Loading data file "'+a+'" failed.'}),Ya()}var Vc=[];function Wc(){var a=e.canvas;Vc.forEach(function(b){b(a.width,a.height)})}function Nc(){if("undefined"!=typeof SDL){var a=Ia[SDL.screen+0*n.H>>2];F[SDL.screen+0*n.H>>2]=a|8388608}Wc()}function Oc(){if("undefined"!=typeof SDL){var a=Ia[SDL.screen+0*n.H>>2];F[SDL.screen+0*n.H>>2]=a&-8388609}Wc()}function Pc(a,b,c){b&&c?(a.fb=b,a.Va=c):(b=a.fb,c=a.Va);var d=b,f=c;e.forcedAspectRatio&&0<e.forcedAspectRatio&&(d/f<e.forcedAspectRatio?d=Math.round(f*e.forcedAspectRatio):f=Math.round(d/e.forcedAspectRatio));if((document.webkitFullScreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.mozFullscreenElement||document.fullScreenElement||document.fullscreenElement||document.msFullScreenElement||document.msFullscreenElement||document.webkitCurrentFullScreenElement)===a.parentNode&&"undefined"!=typeof screen)var h=Math.min(screen.width/d,screen.height/f),d=Math.round(d*h),f=Math.round(f*h);Lc?(a.width!=d&&(a.width=d),a.height!=f&&(a.height=f),"undefined"!=typeof a.style&&(a.style.removeProperty("width"),a.style.removeProperty("height"))):(a.width!=b&&(a.width=b),a.height!=c&&(a.height=c),"undefined"!=typeof a.style&&(d!=b||f!=c?(a.style.setProperty("width",d+"px","important"),a.style.setProperty("height",f+"px","important")):(a.style.removeProperty("width"),a.style.removeProperty("height"))))}var Cc,Dc,Ec,Fc,Qc;Yb();R=Array(4096);Nb(P,"/");V("/tmp");V("/home");V("/home/web_user");(function(){V("/dev");pb(259,{read:function(){return 0},write:function(a,b,f,h){return h}});Qb("/dev/null",259);ob(1280,rb);ob(1536,sb);Qb("/dev/tty",1280);Qb("/dev/tty1",1536);var a;if("undefined"!==typeof crypto){var b=new Uint8Array(1);a=function(){crypto.getRandomValues(b);return b[0]}}else a=function(){return 256*Math.random()|0};W("/dev","random",a);W("/dev","urandom",a);V("/dev/shm");V("/dev/shm/tmp")})();V("/proc");V("/proc/self");V("/proc/self/fd");Nb({A:function(){var a=ub("/proc/self","fd",16895,73);a.k={lookup:function(a,c){var d=zb[+c];if(!d)throw new O(M.Z);var f={parent:null,A:{Fa:"fake"},k:{readlink:function(){return d.path}}};return f.parent=f}};return a}},"/proc/self/fd");Qa.unshift(function(){if(!e.noFSInit&&!Zb){assert(!Zb,"FS.init was previously called. If you want to initialize later with custom parameters, remove any earlier calls (note that one is automatically added to the generated code)");Zb=!0;Yb();e.stdin=e.stdin;e.stdout=e.stdout;e.stderr=e.stderr;e.stdin?W("/dev","stdin",e.stdin):Rb("/dev/tty","/dev/stdin");e.stdout?W("/dev","stdout",null,e.stdout):Rb("/dev/tty","/dev/stdout");e.stderr?W("/dev","stderr",null,e.stderr):Rb("/dev/tty1","/dev/stderr");var a=Tb("/dev/stdin","r");assert(0===a.fd,"invalid handle for stdin ("+a.fd+")");a=Tb("/dev/stdout","w");assert(1===a.fd,"invalid handle for stdout ("+a.fd+")");a=Tb("/dev/stderr","w");assert(2===a.fd,"invalid handle for stderr ("+a.fd+")")}});Ra.push(function(){Cb=!1});K.push(function(){Zb=!1;var a=e._fflush;a&&a(0);for(a=0;a<zb.length;a++){var b=zb[a];b&&Vb(b)}});e.FS_createFolder=function(a,b,c,d){a=N(("string"===typeof a?a:U(a))+"/"+b);return V(a,$b(c,d))};e.FS_createPath=function(a,b){a="string"===typeof a?a:U(a);for(var c=b.split("/").reverse();c.length;){var d=c.pop();if(d){var f=N(a+"/"+d);try{V(f)}catch(h){}a=f}}return f};e.FS_createDataFile=bc;e.FS_createPreloadedFile=function(a,b,c,d,f,h,g,k,t,r){function u(c){function u(c){r&&r(),k||bc(a,b,c,d,f,t),h&&h(),Za()}var J=!1;e.preloadPlugins.forEach(function(a){!J&&a.canHandle(q)&&(a.handle(c,q,u,function(){g&&g(),Za()}),J=!0)});J||u(c)}Bc();var q=b?mb(N(a+"/"+b)):a;Ya();"string"==typeof c?Uc(c,function(a){u(a)},g):u(c)};e.FS_createLazyFile=function(a,b,c,d,f){if("undefined"!==typeof XMLHttpRequest)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";c={Ca:!1,url:c};var h=ac(a,b,d,f);c.e?h.e=c.e:c.url&&(h.e=null,h.url=c.url);Object.defineProperty(h,"usedBytes",{get:function(){return this.e.length}});var g={};Object.keys(h.n).forEach(function(a){var b=h.n[a];g[a]=function(){if(!cc(h))throw new O(M.F);return b.apply(null,arguments)}});g.read=function(a,b,c,d,f){if(!cc(h))throw new O(M.F);a=a.g.e;if(f>=a.length)return 0;d=Math.min(a.length-f,d);assert(0<=d);if(a.slice)for(var g=0;g<d;g++)b[c+g]=a[f+g];else for(g=0;g<d;g++)b[c+g]=a.get(f+g);return d};h.n=g;return h};e.FS_createLink=function(a,b,c){a=N(("string"===typeof a?a:U(a))+"/"+b);return Rb(c,a)};e.FS_createDevice=W;e.FS_unlink=function(a){var b=T(a,{parent:!0}).g,c=lb(a),d=wb(b,c),f;a:{try{f=wb(b,c)}catch(h){f=h.Q;break a}var g=Gb(b,"wx");f=g?g:16384===(f.mode&61440)?M.N:0}if(f)throw f===M.N&&(f=M.G),new O(f);if(!b.k.unlink)throw new O(M.G);if(d.R)throw new O(M.$);try{S.willDeletePath&&S.willDeletePath(a)}catch(k){}b.k.unlink(b,c);b=Eb(d.parent.id,d.name);if(R[b]===d)R[b]=d.K;else for(b=R[b];b;){if(b.K===d){b.K=d.K;break}b=b.K}try{S.onDeletePath&&S.onDeletePath(a)}catch(t){}};Qa.unshift(function(){});K.push(function(){});e.requestFullScreen=function(a,b,c){Mc(a,b,c)};e.requestAnimationFrame=function(a){nc(a)};e.setCanvasSize=function(a,b,c){Pc(e.canvas,a,b),c||Wc()};e.pauseMainLoop=function(){Y=null,qc++};e.resumeMainLoop=function(){qc++;var a=ic,b=jc,c=kc;kc=null;oc(c,0,!1,pc,!0);hc(a,b);Y()};e.getUserMedia=function(){window.C||(window.C=navigator.getUserMedia||navigator.mozGetUserMedia),window.C(void 0)};e.createContext=function(a,b,c,d){return Ic(a,b,c,d)};Ka=m=n.ea(p);va=!0;La=Ka+Na;Ma=v=n.ea(La);assert(Ma<w,"TOTAL_MEMORY not big enough for stack");var Xc=G([8,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,6,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,7,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,6,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0],"i8",3);e.Na={Math:Math,Int8Array:Int8Array,Int16Array:Int16Array,Int32Array:Int32Array,Uint8Array:Uint8Array,Uint16Array:Uint16Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array,NaN:NaN,Infinity:Infinity};e.Oa={abort:z,assert:assert,invoke_ii:function(a,b){try{return e.dynCall_ii(a,b)}catch(c){if("number"!==typeof c&&"longjmp"!==c)throw c;Z.setThrew(1,0)}},invoke_iiii:function(a,b,c,d){try{return e.dynCall_iiii(a,b,c,d)}catch(f){if("number"!==typeof f&&"longjmp"!==f)throw f;Z.setThrew(1,0)}},invoke_vi:function(a,b){try{e.dynCall_vi(a,b)}catch(c){if("number"!==typeof c&&"longjmp"!==c)throw c;Z.setThrew(1,0)}},_pthread_cleanup_pop:function(){assert(eb.level==K.length,"cannot pop if something else added meanwhile!"),K.pop(),eb.level=K.length},___lock:function(){},_emscripten_set_main_loop:oc,_pthread_self:function(){return 0},___syscall6:function(a,b){ec=b;try{var c=fc();Vb(c);return 0}catch(d){return"undefined"!==typeof dc&&d instanceof O||z(d),-d.Q}},_emscripten_set_main_loop_timing:hc,_abort:function(){e.abort()},_sbrk:wa,_time:function(a){var b=Date.now()/1e3|0;a&&(F[a>>2]=b);return b},___setErrNo:ib,_emscripten_memcpy_big:function(a,b,c){H.set(H.subarray(b,b+c),a);return a},___syscall54:function(a,b){ec=b;try{var c=fc(),d=X();switch(d){case 21505:return c.tty?0:-M.O;case 21506:return c.tty?0:-M.O;case 21519:if(!c.tty)return-M.O;var f=X();return F[f>>2]=0;case 21520:return c.tty?-M.u:-M.O;case 21531:f=X();if(!c.n.Wa)throw new O(M.O);return c.n.Wa(c,d,f);default:z("bad ioctl syscall "+d)}}catch(h){return"undefined"!==typeof dc&&h instanceof O||z(h),-h.Q}},___unlock:function(){},___syscall140:function(a,b){ec=b;try{var c=fc(),d=X(),f=X(),h=X(),g=X();assert(0===d);Wb(c,f,g);F[h>>2]=c.position;c.ia&&0===f&&0===g&&(c.ia=null);return 0}catch(k){return"undefined"!==typeof dc&&k instanceof O||z(k),-k.Q}},_pthread_cleanup_push:eb,_sysconf:function(a){switch(a){case 30:return 4096;case 85:return I/4096;case 132:case 133:case 12:case 137:case 138:case 15:case 235:case 16:case 17:case 18:case 19:case 20:case 149:case 13:case 10:case 236:case 153:case 9:case 21:case 22:case 159:case 154:case 14:case 77:case 78:case 139:case 80:case 81:case 82:case 68:case 67:case 164:case 11:case 29:case 47:case 48:case 95:case 52:case 51:case 46:return 200809;case 79:return 0;case 27:case 246:case 127:case 128:case 23:case 24:case 160:case 161:case 181:case 182:case 242:case 183:case 184:case 243:case 244:case 245:case 165:case 178:case 179:case 49:case 50:case 168:case 169:case 175:case 170:case 171:case 172:case 97:case 76:case 32:case 173:case 35:return-1;case 176:case 177:case 7:case 155:case 8:case 157:case 125:case 126:case 92:case 93:case 129:case 130:case 131:case 94:case 91:return 1;case 74:case 60:case 69:case 70:case 4:return 1024;case 31:case 42:case 72:return 32;case 87:case 26:case 33:return 2147483647;case 34:case 1:return 47839;case 38:case 36:return 99;case 43:case 37:return 2048;case 0:return 2097152;case 3:return 65536;case 28:return 32768;case 44:return 32767;case 75:return 16384;case 39:return 1e3;case 89:return 700;case 71:return 256;case 40:return 255;case 2:return 100;case 180:return 64;case 25:return 20;case 5:return 16;case 6:return 6;case 73:return 4;case 84:return"object"===typeof navigator?navigator.hardwareConcurrency||1:1}ib(M.u);return-1},___syscall146:function(a,b){ec=b;try{var c=fc(),d=X(),f;a:{for(var h=X(),g=0,k=0;k<h;k++){var t=Xb(c,D,F[d+8*k>>2],F[d+(8*k+4)>>2],void 0);if(0>t){f=-1;break a}g+=t}f=g}return f}catch(r){return"undefined"!==typeof dc&&r instanceof O||z(r),-r.Q}},STACKTOP:m,STACK_MAX:La,tempDoublePtr:$a,ABORT:A,cttz_i8:Xc};var Z=function(global,env,buffer){var a=new global.Int8Array(buffer),b=new global.Int16Array(buffer),c=new global.Int32Array(buffer),d=new global.Uint8Array(buffer),e=new global.Uint16Array(buffer),f=new global.Uint32Array(buffer),g=new global.Float32Array(buffer),h=new global.Float64Array(buffer),i=env.STACKTOP|0,j=env.STACK_MAX|0,k=env.tempDoublePtr|0,l=env.ABORT|0,m=env.cttz_i8|0,n=0,o=0,p=0,q=0,r=global.NaN,s=global.Infinity,t=0,u=0,v=0,w=0,x=0,y=0,z=0,A=0,B=0,C=0,D=0,E=0,F=0,G=0,H=0,I=0,J=0,K=0,L=0,M=global.Math.floor,N=global.Math.abs,O=global.Math.sqrt,P=global.Math.pow,Q=global.Math.cos,R=global.Math.sin,S=global.Math.tan,T=global.Math.acos,U=global.Math.asin,V=global.Math.atan,W=global.Math.atan2,X=global.Math.exp,Y=global.Math.log,Z=global.Math.ceil,_=global.Math.imul,$=global.Math.min,aa=global.Math.clz32,ba=env.abort,ca=env.assert,da=env.invoke_ii,ea=env.invoke_iiii,fa=env.invoke_vi,ga=env._pthread_cleanup_pop,ha=env.___lock,ia=env._emscripten_set_main_loop,ja=env._pthread_self,ka=env.___syscall6,la=env._emscripten_set_main_loop_timing,ma=env._abort,na=env._sbrk,oa=env._time,pa=env.___setErrNo,qa=env._emscripten_memcpy_big,ra=env.___syscall54,sa=env.___unlock,ta=env.___syscall140,ua=env._pthread_cleanup_push,va=env._sysconf,wa=env.___syscall146,xa=0;function Ba(a){a=a|0;var b=0;b=i;i=i+a|0;i=i+15&-16;return b|0}function Ca(){return i|0}function Da(a){a=a|0,i=a}function Ea(a,b){a=a|0,b=b|0,i=a,j=b}function Fa(a,b){a=a|0,b=b|0,n||(n=a,o=b)}function Ga(b){b=b|0,a[k>>0]=a[b>>0],a[k+1>>0]=a[b+1>>0],a[k+2>>0]=a[b+2>>0],a[k+3>>0]=a[b+3>>0]}function Ha(b){b=b|0,a[k>>0]=a[b>>0],a[k+1>>0]=a[b+1>>0],a[k+2>>0]=a[b+2>>0],a[k+3>>0]=a[b+3>>0],a[k+4>>0]=a[b+4>>0],a[k+5>>0]=a[b+5>>0],a[k+6>>0]=a[b+6>>0],a[k+7>>0]=a[b+7>>0]}function Ia(a){a=a|0,C=a}function Ja(){return C|0}function Ka(b,e,f){b=b|0;e=e|0;f=f|0;var g=0,h=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0,t=0,u=0,v=0,w=0,x=0,y=0,z=0,A=0,B=0,D=0,E=0,F=0,G=0,H=0,I=0,J=0,K=0,L=0,M=0,N=0,O=0,P=0,Q=0,R=0,S=0,T=0,U=0,V=0,W=0,X=0,Y=0,Z=0,$=0,aa=0,ba=0,ca=0,da=0,ea=0,fa=0,ga=0,ha=0,ia=0,ja=0,ka=0,la=0,ma=0,na=0,oa=0,pa=0,qa=0,ra=0,sa=0,ta=0,ua=0,va=0,wa=0,xa=0,ya=0,za=0,Aa=0,Ba=0,Ca=0,Da=0,Ea=0,Fa=0,Ga=0,Ha=0,Ia=0,Ja=0,Ka=0,Oa=0,Pa=0,Qa=0,Ra=0,Sa=0,Ta=0,Ua=0,Va=0,Wa=0,Xa=0,Ya=0,Za=0,_a=0,$a=0,gb=0,hb=0,ib=0,jb=0,kb=0,mb=0,nb=0,ob=0,pb=0,qb=0,rb=0,sb=0,tb=0,ub=0,vb=0,wb=0,xb=0,yb=0,zb=0,Ab=0,Bb=0,Cb=0,Db=0,Eb=0,Fb=0,Gb=0,Hb=0,Ib=0,Jb=0,Kb=0,Lb=0,Mb=0,Nb=0,Ob=0,Pb=0,Qb=0,Rb=0,Sb=0,Tb=0,Ub=0,Vb=0,Wb=0,Xb=0,Yb=0,Zb=0,_b=0,$b=0,ac=0,bc=0,cc=0,dc=0,ec=0,fc=0,gc=0,hc=0,ic=0,jc=0,kc=0,lc=0,mc=0,nc=0,oc=0,pc=0,qc=0,rc=0,sc=0,tc=0,uc=0,vc=0,wc=0,xc=0,yc=0,zc=0,Ac=0,Bc=0,Cc=0,Dc=0,Ec=0,Fc=0,Gc=0,Hc=0;g=i;i=i+2640|0;h=g+2456|0;j=g+2304|0;k=g+2152|0;l=g+2e3|0;m=g+1848|0;n=g+1696|0;o=g+1544|0;p=g+1392|0;q=g+1240|0;r=g+1088|0;s=g+936|0;t=g+784|0;u=g+632|0;v=g+480|0;w=g+328|0;x=g+248|0;y=g+168|0;z=g+80|0;A=g;B=g+2608|0;D=B;E=e;e=D+32|0;do a[D>>0]=a[E>>0]|0,D=D+1|0,E=E+1|0;while((D|0)<(e|0));a[B>>0]=(d[B>>0]|0)&248;F=B+31|0;a[F>>0]=(d[F>>0]|0)&63|64;F=d[f>>0]|0;G=fb(d[f+1>>0]|0|0,0,8)|0;H=C;I=fb(d[f+2>>0]|0|0,0,16)|0;J=H|C;H=d[f+3>>0]|0;K=fb(H|0,0,24)|0;L=x;c[L>>2]=G|F|I|K&50331648;c[L+4>>2]=J;J=fb(d[f+4>>0]|0|0,0,8)|0;L=C;K=fb(d[f+5>>0]|0|0,0,16)|0;I=L|C;L=d[f+6>>0]|0;F=fb(L|0,0,24)|0;G=eb(J|H|K|F|0,I|C|0,2)|0;I=x+8|0;c[I>>2]=G&33554431;c[I+4>>2]=0;I=fb(d[f+7>>0]|0|0,0,8)|0;G=C;F=fb(d[f+8>>0]|0|0,0,16)|0;K=G|C;G=d[f+9>>0]|0;H=fb(G|0,0,24)|0;J=eb(I|L|F|H|0,K|C|0,3)|0;K=x+16|0;c[K>>2]=J&67108863;c[K+4>>2]=0;K=fb(d[f+10>>0]|0|0,0,8)|0;J=C;H=fb(d[f+11>>0]|0|0,0,16)|0;F=J|C;J=d[f+12>>0]|0;L=fb(J|0,0,24)|0;I=eb(K|G|H|L|0,F|C|0,5)|0;F=x+24|0;c[F>>2]=I&33554431;c[F+4>>2]=0;F=fb(d[f+13>>0]|0|0,0,8)|0;I=C;L=fb(d[f+14>>0]|0|0,0,16)|0;H=I|C;I=fb(d[f+15>>0]|0|0,0,24)|0;G=eb(F|J|L|I|0,H|C|0,6)|0;H=x+32|0;c[H>>2]=G&67108863;c[H+4>>2]=0;H=d[f+16>>0]|0;G=fb(d[f+17>>0]|0|0,0,8)|0;I=C;L=fb(d[f+18>>0]|0|0,0,16)|0;J=I|C;I=d[f+19>>0]|0;F=fb(I|0,0,24)|0;K=x+40|0;c[K>>2]=G|H|L|F&16777216;c[K+4>>2]=J;J=fb(d[f+20>>0]|0|0,0,8)|0;K=C;F=fb(d[f+21>>0]|0|0,0,16)|0;L=K|C;K=d[f+22>>0]|0;H=fb(K|0,0,24)|0;G=eb(J|I|F|H|0,L|C|0,1)|0;L=x+48|0;c[L>>2]=G&67108863;c[L+4>>2]=0;L=fb(d[f+23>>0]|0|0,0,8)|0;G=C;H=fb(d[f+24>>0]|0|0,0,16)|0;F=G|C;G=d[f+25>>0]|0;I=fb(G|0,0,24)|0;J=eb(L|K|H|I|0,F|C|0,3)|0;F=x+56|0;c[F>>2]=J&33554431;c[F+4>>2]=0;F=fb(d[f+26>>0]|0|0,0,8)|0;J=C;I=fb(d[f+27>>0]|0|0,0,16)|0;H=J|C;J=d[f+28>>0]|0;K=fb(J|0,0,24)|0;L=eb(F|G|I|K|0,H|C|0,4)|0;H=x+64|0;c[H>>2]=L&67108863;c[H+4>>2]=0;H=fb(d[f+29>>0]|0|0,0,8)|0;L=C;K=fb(d[f+30>>0]|0|0,0,16)|0;I=L|C;L=fb(d[f+31>>0]|0|0,0,24)|0;f=eb(H|J|K|L|0,I|C|0,6)|0;I=x+72|0;c[I>>2]=f&33554431;c[I+4>>2]=0;db(q|0,0,152)|0;I=q;c[I>>2]=1;c[I+4>>2]=0;db(r|0,0,152)|0;I=r;c[I>>2]=1;c[I+4>>2]=0;db(s|0,0,152)|0;db(t|0,0,152)|0;db(u|0,0,152)|0;I=u;c[I>>2]=1;c[I+4>>2]=0;db(v|0,0,152)|0;db(w|0,0,152)|0;I=w;c[I>>2]=1;c[I+4>>2]=0;D=p+80|0;e=D+72|0;do c[D>>2]=0,D=D+4|0;while((D|0)<(e|0));D=p;E=x;e=D+80|0;do c[D>>2]=c[E>>2],D=D+4|0,E=E+4|0;while((D|0)<(e|0));I=l+144|0;f=l+64|0;L=l+136|0;K=l+56|0;J=l+128|0;H=l+48|0;G=l+120|0;F=l+40|0;M=l+112|0;N=l+32|0;O=l+104|0;P=l+24|0;Q=l+96|0;R=l+16|0;S=l+88|0;T=l+8|0;U=l+80|0;V=m+144|0;W=m+64|0;X=m+136|0;Y=m+56|0;Z=m+128|0;$=m+48|0;aa=m+120|0;ba=m+40|0;ca=m+112|0;da=m+32|0;ea=m+104|0;fa=m+24|0;ga=m+96|0;ha=m+16|0;ia=m+88|0;ja=m+8|0;ka=m+80|0;la=l+72|0;ma=m+72|0;na=j+8|0;oa=k+8|0;pa=j+16|0;qa=k+16|0;ra=j+24|0;sa=k+24|0;ta=j+32|0;ua=k+32|0;va=j+40|0;wa=k+40|0;xa=j+48|0;ya=k+48|0;za=j+56|0;Aa=k+56|0;Ba=j+64|0;Ca=k+64|0;Da=j+72|0;Ea=k+72|0;Fa=h+80|0;Ga=h+8|0;Ha=h+16|0;Ia=h+24|0;Ja=h+32|0;Ka=h+40|0;Oa=h+48|0;Pa=h+56|0;Qa=h+64|0;Ra=h+72|0;Sa=0;Ta=p;Ua=t;t=q;Va=u;u=r;Wa=v;v=s;s=w;while(1){w=a[B+(31-Sa)>>0]|0;Xa=0;Ya=Ta;Za=Ua;_a=t;$a=Va;gb=u;hb=Wa;ib=v;jb=s;while(1){kb=w&255;mb=bb(0,0,kb>>>7|0,0)|0;nb=C;ob=0;do pb=gb+(ob<<3)|0,qb=pb,rb=c[qb>>2]|0,sb=c[qb+4>>2]|0,qb=Ya+(ob<<3)|0,tb=qb,ub=c[tb>>2]|0,vb=c[tb+4>>2]|0,tb=(ub^rb)&mb,wb=(vb^sb)&nb,sb=ab(0,tb^rb|0,32)|0,rb=pb,c[rb>>2]=sb,c[rb+4>>2]=C,rb=ab(0,tb^ub|0,32)|0,ub=qb,c[ub>>2]=rb,c[ub+4>>2]=C,ob=ob+1|0;while((ob|0)!=10);xb=0;do ob=ib+(xb<<3)|0,ub=ob,rb=c[ub>>2]|0,qb=c[ub+4>>2]|0,ub=_a+(xb<<3)|0,tb=ub,sb=c[tb>>2]|0,pb=c[tb+4>>2]|0,tb=(sb^rb)&mb,vb=(pb^qb)&nb,qb=ab(0,tb^rb|0,32)|0,rb=ob,c[rb>>2]=qb,c[rb+4>>2]=C,rb=ab(0,tb^sb|0,32)|0,sb=ub,c[sb>>2]=rb,c[sb+4>>2]=C,xb=xb+1|0;while((xb|0)!=10);sb=gb;rb=c[sb>>2]|0;ub=c[sb+4>>2]|0;sb=gb+8|0;tb=sb;qb=c[tb>>2]|0;ob=c[tb+4>>2]|0;tb=gb+16|0;pb=tb;vb=c[pb>>2]|0;wb=c[pb+4>>2]|0;pb=gb+24|0;yb=pb;zb=c[yb>>2]|0;Ab=c[yb+4>>2]|0;yb=gb+32|0;Bb=yb;Cb=c[Bb>>2]|0;Db=c[Bb+4>>2]|0;Bb=gb+40|0;Eb=Bb;Fb=c[Eb>>2]|0;Gb=c[Eb+4>>2]|0;Eb=gb+48|0;Hb=Eb;Ib=c[Hb>>2]|0;Jb=c[Hb+4>>2]|0;Hb=gb+56|0;Kb=Hb;Lb=c[Kb>>2]|0;Mb=c[Kb+4>>2]|0;Kb=gb+64|0;Nb=Kb;Ob=c[Nb>>2]|0;Pb=c[Nb+4>>2]|0;Nb=gb+72|0;Qb=Nb;Rb=c[Qb>>2]|0;Sb=c[Qb+4>>2]|0;Qb=ib;Tb=c[Qb>>2]|0;Ub=c[Qb+4>>2]|0;Qb=cb(Tb|0,Ub|0,rb|0,ub|0)|0;Vb=gb;c[Vb>>2]=Qb;c[Vb+4>>2]=C;Vb=ib+8|0;Qb=Vb;Wb=c[Qb>>2]|0;Xb=c[Qb+4>>2]|0;Qb=cb(Wb|0,Xb|0,qb|0,ob|0)|0;Yb=sb;c[Yb>>2]=Qb;c[Yb+4>>2]=C;Yb=ib+16|0;Qb=Yb;sb=c[Qb>>2]|0;Zb=c[Qb+4>>2]|0;Qb=cb(sb|0,Zb|0,vb|0,wb|0)|0;_b=tb;c[_b>>2]=Qb;c[_b+4>>2]=C;_b=ib+24|0;Qb=_b;tb=c[Qb>>2]|0;$b=c[Qb+4>>2]|0;Qb=cb(tb|0,$b|0,zb|0,Ab|0)|0;ac=pb;c[ac>>2]=Qb;c[ac+4>>2]=C;ac=ib+32|0;Qb=ac;pb=c[Qb>>2]|0;bc=c[Qb+4>>2]|0;Qb=cb(pb|0,bc|0,Cb|0,Db|0)|0;cc=yb;c[cc>>2]=Qb;c[cc+4>>2]=C;cc=ib+40|0;Qb=cc;yb=c[Qb>>2]|0;dc=c[Qb+4>>2]|0;Qb=cb(yb|0,dc|0,Fb|0,Gb|0)|0;ec=Bb;c[ec>>2]=Qb;c[ec+4>>2]=C;ec=ib+48|0;Qb=ec;Bb=c[Qb>>2]|0;fc=c[Qb+4>>2]|0;Qb=cb(Bb|0,fc|0,Ib|0,Jb|0)|0;gc=Eb;c[gc>>2]=Qb;c[gc+4>>2]=C;gc=ib+56|0;Qb=gc;Eb=c[Qb>>2]|0;hc=c[Qb+4>>2]|0;Qb=cb(Eb|0,hc|0,Lb|0,Mb|0)|0;ic=Hb;c[ic>>2]=Qb;c[ic+4>>2]=C;ic=ib+64|0;Qb=ic;Hb=c[Qb>>2]|0;jc=c[Qb+4>>2]|0;Qb=cb(Hb|0,jc|0,Ob|0,Pb|0)|0;kc=Kb;c[kc>>2]=Qb;c[kc+4>>2]=C;kc=ib+72|0;Qb=kc;Kb=c[Qb>>2]|0;lc=c[Qb+4>>2]|0;Qb=cb(Kb|0,lc|0,Rb|0,Sb|0)|0;mc=Nb;c[mc>>2]=Qb;c[mc+4>>2]=C;mc=bb(rb|0,ub|0,Tb|0,Ub|0)|0;Ub=ib;c[Ub>>2]=mc;c[Ub+4>>2]=C;Ub=bb(qb|0,ob|0,Wb|0,Xb|0)|0;Xb=Vb;c[Xb>>2]=Ub;c[Xb+4>>2]=C;Xb=bb(vb|0,wb|0,sb|0,Zb|0)|0;Zb=Yb;c[Zb>>2]=Xb;c[Zb+4>>2]=C;Zb=bb(zb|0,Ab|0,tb|0,$b|0)|0;$b=_b;c[$b>>2]=Zb;c[$b+4>>2]=C;$b=bb(Cb|0,Db|0,pb|0,bc|0)|0;bc=ac;c[bc>>2]=$b;c[bc+4>>2]=C;bc=bb(Fb|0,Gb|0,yb|0,dc|0)|0;dc=cc;c[dc>>2]=bc;c[dc+4>>2]=C;dc=bb(Ib|0,Jb|0,Bb|0,fc|0)|0;fc=ec;c[fc>>2]=dc;c[fc+4>>2]=C;fc=bb(Lb|0,Mb|0,Eb|0,hc|0)|0;hc=gc;c[hc>>2]=fc;c[hc+4>>2]=C;hc=bb(Ob|0,Pb|0,Hb|0,jc|0)|0;jc=ic;c[jc>>2]=hc;c[jc+4>>2]=C;jc=bb(Rb|0,Sb|0,Kb|0,lc|0)|0;lc=kc;c[lc>>2]=jc;c[lc+4>>2]=C;lc=Ya;jc=c[lc>>2]|0;kc=c[lc+4>>2]|0;lc=Ya+8|0;Kb=lc;Sb=c[Kb>>2]|0;Rb=c[Kb+4>>2]|0;Kb=Ya+16|0;hc=Kb;ic=c[hc>>2]|0;Hb=c[hc+4>>2]|0;hc=Ya+24|0;Pb=hc;Ob=c[Pb>>2]|0;fc=c[Pb+4>>2]|0;Pb=Ya+32|0;gc=Pb;Eb=c[gc>>2]|0;Mb=c[gc+4>>2]|0;gc=Ya+40|0;Lb=gc;dc=c[Lb>>2]|0;ec=c[Lb+4>>2]|0;Lb=Ya+48|0;Bb=Lb;Jb=c[Bb>>2]|0;Ib=c[Bb+4>>2]|0;Bb=Ya+56|0;bc=Bb;cc=c[bc>>2]|0;yb=c[bc+4>>2]|0;bc=Ya+64|0;Gb=bc;Fb=c[Gb>>2]|0;$b=c[Gb+4>>2]|0;Gb=Ya+72|0;ac=Gb;pb=c[ac>>2]|0;Db=c[ac+4>>2]|0;ac=_a;Cb=c[ac>>2]|0;Zb=c[ac+4>>2]|0;ac=cb(Cb|0,Zb|0,jc|0,kc|0)|0;_b=Ya;c[_b>>2]=ac;c[_b+4>>2]=C;_b=_a+8|0;ac=_b;tb=c[ac>>2]|0;Ab=c[ac+4>>2]|0;ac=cb(tb|0,Ab|0,Sb|0,Rb|0)|0;zb=lc;c[zb>>2]=ac;c[zb+4>>2]=C;zb=_a+16|0;ac=zb;lc=c[ac>>2]|0;Xb=c[ac+4>>2]|0;ac=cb(lc|0,Xb|0,ic|0,Hb|0)|0;Yb=Kb;c[Yb>>2]=ac;c[Yb+4>>2]=C;Yb=_a+24|0;ac=Yb;Kb=c[ac>>2]|0;sb=c[ac+4>>2]|0;ac=cb(Kb|0,sb|0,Ob|0,fc|0)|0;wb=hc;c[wb>>2]=ac;c[wb+4>>2]=C;wb=_a+32|0;ac=wb;hc=c[ac>>2]|0;vb=c[ac+4>>2]|0;ac=cb(hc|0,vb|0,Eb|0,Mb|0)|0;Ub=Pb;c[Ub>>2]=ac;c[Ub+4>>2]=C;Ub=_a+40|0;ac=Ub;Pb=c[ac>>2]|0;Vb=c[ac+4>>2]|0;ac=cb(Pb|0,Vb|0,dc|0,ec|0)|0;Wb=gc;c[Wb>>2]=ac;c[Wb+4>>2]=C;Wb=_a+48|0;ac=Wb;gc=c[ac>>2]|0;ob=c[ac+4>>2]|0;ac=cb(gc|0,ob|0,Jb|0,Ib|0)|0;qb=Lb;c[qb>>2]=ac;c[qb+4>>2]=C;qb=_a+56|0;ac=qb;Lb=c[ac>>2]|0;mc=c[ac+4>>2]|0;ac=cb(Lb|0,mc|0,cc|0,yb|0)|0;Tb=Bb;c[Tb>>2]=ac;c[Tb+4>>2]=C;Tb=_a+64|0;ac=Tb;Bb=c[ac>>2]|0;ub=c[ac+4>>2]|0;ac=cb(Bb|0,ub|0,Fb|0,$b|0)|0;rb=bc;c[rb>>2]=ac;c[rb+4>>2]=C;rb=_a+72|0;ac=rb;bc=c[ac>>2]|0;Qb=c[ac+4>>2]|0;ac=cb(bc|0,Qb|0,pb|0,Db|0)|0;Nb=Gb;c[Nb>>2]=ac;c[Nb+4>>2]=C;Nb=bb(jc|0,kc|0,Cb|0,Zb|0)|0;Zb=_a;c[Zb>>2]=Nb;c[Zb+4>>2]=C;Zb=bb(Sb|0,Rb|0,tb|0,Ab|0)|0;Ab=_b;c[Ab>>2]=Zb;c[Ab+4>>2]=C;Ab=bb(ic|0,Hb|0,lc|0,Xb|0)|0;Xb=zb;c[Xb>>2]=Ab;c[Xb+4>>2]=C;Xb=bb(Ob|0,fc|0,Kb|0,sb|0)|0;sb=Yb;c[sb>>2]=Xb;c[sb+4>>2]=C;sb=bb(Eb|0,Mb|0,hc|0,vb|0)|0;vb=wb;c[vb>>2]=sb;c[vb+4>>2]=C;vb=bb(dc|0,ec|0,Pb|0,Vb|0)|0;Vb=Ub;c[Vb>>2]=vb;c[Vb+4>>2]=C;Vb=bb(Jb|0,Ib|0,gc|0,ob|0)|0;ob=Wb;c[ob>>2]=Vb;c[ob+4>>2]=C;ob=bb(cc|0,yb|0,Lb|0,mc|0)|0;mc=qb;c[mc>>2]=ob;c[mc+4>>2]=C;mc=bb(Fb|0,$b|0,Bb|0,ub|0)|0;ub=Tb;c[ub>>2]=mc;c[ub+4>>2]=C;ub=bb(pb|0,Db|0,bc|0,Qb|0)|0;Qb=rb;c[Qb>>2]=ub;c[Qb+4>>2]=C;Ma(l,Ya,ib);Ma(m,gb,_a);Qb=I;ub=c[Qb>>2]|0;rb=c[Qb+4>>2]|0;Qb=f;bc=c[Qb>>2]|0;Db=c[Qb+4>>2]|0;Qb=lb(ub|0,rb|0,18,0)|0;pb=C;mc=cb(bc|0,Db|0,ub|0,rb|0)|0;rb=cb(mc|0,C|0,Qb|0,pb|0)|0;pb=f;c[pb>>2]=rb;c[pb+4>>2]=C;pb=L;rb=c[pb>>2]|0;Qb=c[pb+4>>2]|0;pb=K;mc=c[pb>>2]|0;ub=c[pb+4>>2]|0;pb=lb(rb|0,Qb|0,18,0)|0;Db=C;bc=cb(mc|0,ub|0,rb|0,Qb|0)|0;Qb=cb(bc|0,C|0,pb|0,Db|0)|0;Db=K;c[Db>>2]=Qb;c[Db+4>>2]=C;Db=J;Qb=c[Db>>2]|0;pb=c[Db+4>>2]|0;Db=H;bc=c[Db>>2]|0;rb=c[Db+4>>2]|0;Db=lb(Qb|0,pb|0,18,0)|0;ub=C;mc=cb(bc|0,rb|0,Qb|0,pb|0)|0;pb=cb(mc|0,C|0,Db|0,ub|0)|0;ub=H;c[ub>>2]=pb;c[ub+4>>2]=C;ub=G;pb=c[ub>>2]|0;Db=c[ub+4>>2]|0;ub=F;mc=c[ub>>2]|0;Qb=c[ub+4>>2]|0;ub=lb(pb|0,Db|0,18,0)|0;rb=C;bc=cb(mc|0,Qb|0,pb|0,Db|0)|0;Db=cb(bc|0,C|0,ub|0,rb|0)|0;rb=F;c[rb>>2]=Db;c[rb+4>>2]=C;rb=M;Db=c[rb>>2]|0;ub=c[rb+4>>2]|0;rb=N;bc=c[rb>>2]|0;pb=c[rb+4>>2]|0;rb=lb(Db|0,ub|0,18,0)|0;Qb=C;mc=cb(bc|0,pb|0,Db|0,ub|0)|0;ub=cb(mc|0,C|0,rb|0,Qb|0)|0;Qb=N;c[Qb>>2]=ub;c[Qb+4>>2]=C;Qb=O;ub=c[Qb>>2]|0;rb=c[Qb+4>>2]|0;Qb=P;mc=c[Qb>>2]|0;Db=c[Qb+4>>2]|0;Qb=lb(ub|0,rb|0,18,0)|0;pb=C;bc=cb(mc|0,Db|0,ub|0,rb|0)|0;rb=cb(bc|0,C|0,Qb|0,pb|0)|0;pb=P;c[pb>>2]=rb;c[pb+4>>2]=C;pb=Q;rb=c[pb>>2]|0;Qb=c[pb+4>>2]|0;pb=R;bc=c[pb>>2]|0;ub=c[pb+4>>2]|0;pb=lb(rb|0,Qb|0,18,0)|0;Db=C;mc=cb(bc|0,ub|0,rb|0,Qb|0)|0;Qb=cb(mc|0,C|0,pb|0,Db|0)|0;Db=R;c[Db>>2]=Qb;c[Db+4>>2]=C;Db=S;Qb=c[Db>>2]|0;pb=c[Db+4>>2]|0;Db=T;mc=c[Db>>2]|0;rb=c[Db+4>>2]|0;Db=lb(Qb|0,pb|0,18,0)|0;ub=C;bc=cb(mc|0,rb|0,Qb|0,pb|0)|0;pb=cb(bc|0,C|0,Db|0,ub|0)|0;ub=T;c[ub>>2]=pb;c[ub+4>>2]=C;ub=U;pb=c[ub>>2]|0;Db=c[ub+4>>2]|0;ub=l;bc=c[ub>>2]|0;Qb=c[ub+4>>2]|0;ub=lb(pb|0,Db|0,18,0)|0;rb=C;mc=cb(bc|0,Qb|0,pb|0,Db|0)|0;Db=cb(mc|0,C|0,ub|0,rb|0)|0;rb=C;ub=l;c[ub>>2]=Db;c[ub+4>>2]=rb;ub=U;c[ub>>2]=0;c[ub+4>>2]=0;ub=rb;rb=Db;Db=0;do mc=cb(ub>>31>>>6|0,0,rb|0,ub|0)|0,pb=ab(mc|0,C|0,26)|0,mc=C,Qb=fb(pb|0,mc|0,26)|0,bc=bb(rb|0,ub|0,Qb|0,C|0)|0,Qb=l+(Db<<3)|0,c[Qb>>2]=bc,c[Qb+4>>2]=C,Qb=l+((Db|1)<<3)|0,bc=Qb,Tb=cb(pb|0,mc|0,c[bc>>2]|0,c[bc+4>>2]|0)|0,bc=C,mc=cb(bc>>31>>>7|0,0,Tb|0,bc|0)|0,pb=ab(mc|0,C|0,25)|0,mc=C,Bb=fb(pb|0,mc|0,25)|0,$b=bb(Tb|0,bc|0,Bb|0,C|0)|0,Bb=Qb,c[Bb>>2]=$b,c[Bb+4>>2]=C,Db=Db+2|0,Bb=l+(Db<<3)|0,$b=Bb,rb=cb(pb|0,mc|0,c[$b>>2]|0,c[$b+4>>2]|0)|0,ub=C,$b=Bb,c[$b>>2]=rb,c[$b+4>>2]=ub;while(Db>>>0<10);Db=U;ub=c[Db>>2]|0;rb=c[Db+4>>2]|0;Db=l;$b=c[Db>>2]|0;Bb=c[Db+4>>2]|0;Db=lb(ub|0,rb|0,18,0)|0;mc=C;pb=cb($b|0,Bb|0,ub|0,rb|0)|0;rb=cb(pb|0,C|0,Db|0,mc|0)|0;mc=C;Db=U;c[Db>>2]=0;c[Db+4>>2]=0;Db=cb(mc>>31>>>6|0,0,rb|0,mc|0)|0;pb=ab(Db|0,C|0,26)|0;Db=C;ub=fb(pb|0,Db|0,26)|0;Bb=bb(rb|0,mc|0,ub|0,C|0)|0;ub=C;mc=l;c[mc>>2]=Bb;c[mc+4>>2]=ub;mc=T;rb=cb(pb|0,Db|0,c[mc>>2]|0,c[mc+4>>2]|0)|0;mc=C;Db=T;c[Db>>2]=rb;c[Db+4>>2]=mc;Db=V;pb=c[Db>>2]|0;$b=c[Db+4>>2]|0;Db=W;Qb=c[Db>>2]|0;bc=c[Db+4>>2]|0;Db=lb(pb|0,$b|0,18,0)|0;Tb=C;Fb=cb(Qb|0,bc|0,pb|0,$b|0)|0;$b=cb(Fb|0,C|0,Db|0,Tb|0)|0;Tb=W;c[Tb>>2]=$b;c[Tb+4>>2]=C;Tb=X;$b=c[Tb>>2]|0;Db=c[Tb+4>>2]|0;Tb=Y;Fb=c[Tb>>2]|0;pb=c[Tb+4>>2]|0;Tb=lb($b|0,Db|0,18,0)|0;bc=C;Qb=cb(Fb|0,pb|0,$b|0,Db|0)|0;Db=cb(Qb|0,C|0,Tb|0,bc|0)|0;bc=Y;c[bc>>2]=Db;c[bc+4>>2]=C;bc=Z;Db=c[bc>>2]|0;Tb=c[bc+4>>2]|0;bc=$;Qb=c[bc>>2]|0;$b=c[bc+4>>2]|0;bc=lb(Db|0,Tb|0,18,0)|0;pb=C;Fb=cb(Qb|0,$b|0,Db|0,Tb|0)|0;Tb=cb(Fb|0,C|0,bc|0,pb|0)|0;pb=$;c[pb>>2]=Tb;c[pb+4>>2]=C;pb=aa;Tb=c[pb>>2]|0;bc=c[pb+4>>2]|0;pb=ba;Fb=c[pb>>2]|0;Db=c[pb+4>>2]|0;pb=lb(Tb|0,bc|0,18,0)|0;$b=C;Qb=cb(Fb|0,Db|0,Tb|0,bc|0)|0;bc=cb(Qb|0,C|0,pb|0,$b|0)|0;$b=ba;c[$b>>2]=bc;c[$b+4>>2]=C;$b=ca;bc=c[$b>>2]|0;pb=c[$b+4>>2]|0;$b=da;Qb=c[$b>>2]|0;Tb=c[$b+4>>2]|0;$b=lb(bc|0,pb|0,18,0)|0;Db=C;Fb=cb(Qb|0,Tb|0,bc|0,pb|0)|0;pb=cb(Fb|0,C|0,$b|0,Db|0)|0;Db=da;c[Db>>2]=pb;c[Db+4>>2]=C;Db=ea;pb=c[Db>>2]|0;$b=c[Db+4>>2]|0;Db=fa;Fb=c[Db>>2]|0;bc=c[Db+4>>2]|0;Db=lb(pb|0,$b|0,18,0)|0;Tb=C;Qb=cb(Fb|0,bc|0,pb|0,$b|0)|0;$b=cb(Qb|0,C|0,Db|0,Tb|0)|0;Tb=fa;c[Tb>>2]=$b;c[Tb+4>>2]=C;Tb=ga;$b=c[Tb>>2]|0;Db=c[Tb+4>>2]|0;Tb=ha;Qb=c[Tb>>2]|0;pb=c[Tb+4>>2]|0;Tb=lb($b|0,Db|0,18,0)|0;bc=C;Fb=cb(Qb|0,pb|0,$b|0,Db|0)|0;Db=cb(Fb|0,C|0,Tb|0,bc|0)|0;bc=ha;c[bc>>2]=Db;c[bc+4>>2]=C;bc=ia;Db=c[bc>>2]|0;Tb=c[bc+4>>2]|0;bc=ja;Fb=c[bc>>2]|0;$b=c[bc+4>>2]|0;bc=lb(Db|0,Tb|0,18,0)|0;pb=C;Qb=cb(Fb|0,$b|0,Db|0,Tb|0)|0;Tb=cb(Qb|0,C|0,bc|0,pb|0)|0;pb=ja;c[pb>>2]=Tb;c[pb+4>>2]=C;pb=ka;Tb=c[pb>>2]|0;bc=c[pb+4>>2]|0;pb=m;Qb=c[pb>>2]|0;Db=c[pb+4>>2]|0;pb=lb(Tb|0,bc|0,18,0)|0;$b=C;Fb=cb(Qb|0,Db|0,Tb|0,bc|0)|0;bc=cb(Fb|0,C|0,pb|0,$b|0)|0;$b=C;pb=m;c[pb>>2]=bc;c[pb+4>>2]=$b;pb=ka;c[pb>>2]=0;c[pb+4>>2]=0;pb=$b;$b=bc;bc=0;do Fb=cb(pb>>31>>>6|0,0,$b|0,pb|0)|0,Tb=ab(Fb|0,C|0,26)|0,Fb=C,Db=fb(Tb|0,Fb|0,26)|0,Qb=bb($b|0,pb|0,Db|0,C|0)|0,Db=m+(bc<<3)|0,c[Db>>2]=Qb,c[Db+4>>2]=C,Db=m+((bc|1)<<3)|0,Qb=Db,ob=cb(Tb|0,Fb|0,c[Qb>>2]|0,c[Qb+4>>2]|0)|0,Qb=C,Fb=cb(Qb>>31>>>7|0,0,ob|0,Qb|0)|0,Tb=ab(Fb|0,C|0,25)|0,Fb=C,qb=fb(Tb|0,Fb|0,25)|0,Lb=bb(ob|0,Qb|0,qb|0,C|0)|0,qb=Db,c[qb>>2]=Lb,c[qb+4>>2]=C,bc=bc+2|0,qb=m+(bc<<3)|0,Lb=qb,$b=cb(Tb|0,Fb|0,c[Lb>>2]|0,c[Lb+4>>2]|0)|0,pb=C,Lb=qb,c[Lb>>2]=$b,c[Lb+4>>2]=pb;while(bc>>>0<10);bc=ka;pb=c[bc>>2]|0;$b=c[bc+4>>2]|0;bc=m;Lb=c[bc>>2]|0;qb=c[bc+4>>2]|0;bc=lb(pb|0,$b|0,18,0)|0;Fb=C;Tb=cb(Lb|0,qb|0,pb|0,$b|0)|0;$b=cb(Tb|0,C|0,bc|0,Fb|0)|0;Fb=C;bc=ka;c[bc>>2]=0;c[bc+4>>2]=0;bc=cb(Fb>>31>>>6|0,0,$b|0,Fb|0)|0;Tb=ab(bc|0,C|0,26)|0;bc=C;pb=fb(Tb|0,bc|0,26)|0;qb=bb($b|0,Fb|0,pb|0,C|0)|0;pb=C;Fb=ja;$b=cb(Tb|0,bc|0,c[Fb>>2]|0,c[Fb+4>>2]|0)|0;Fb=C;bc=R;Tb=c[bc>>2]|0;Lb=c[bc+4>>2]|0;bc=P;Db=c[bc>>2]|0;Qb=c[bc+4>>2]|0;bc=N;ob=c[bc>>2]|0;yb=c[bc+4>>2]|0;bc=F;cc=c[bc>>2]|0;Vb=c[bc+4>>2]|0;bc=H;Wb=c[bc>>2]|0;gc=c[bc+4>>2]|0;bc=K;Ib=c[bc>>2]|0;Jb=c[bc+4>>2]|0;bc=f;vb=c[bc>>2]|0;Ub=c[bc+4>>2]|0;bc=la;Pb=c[bc>>2]|0;ec=c[bc+4>>2]|0;bc=cb(qb|0,pb|0,Bb|0,ub|0)|0;dc=l;c[dc>>2]=bc;c[dc+4>>2]=C;dc=cb($b|0,Fb|0,rb|0,mc|0)|0;bc=T;c[bc>>2]=dc;c[bc+4>>2]=C;bc=ha;dc=c[bc>>2]|0;sb=c[bc+4>>2]|0;bc=cb(dc|0,sb|0,Tb|0,Lb|0)|0;wb=R;c[wb>>2]=bc;c[wb+4>>2]=C;wb=fa;bc=c[wb>>2]|0;hc=c[wb+4>>2]|0;wb=cb(bc|0,hc|0,Db|0,Qb|0)|0;Mb=P;c[Mb>>2]=wb;c[Mb+4>>2]=C;Mb=da;wb=c[Mb>>2]|0;Eb=c[Mb+4>>2]|0;Mb=cb(wb|0,Eb|0,ob|0,yb|0)|0;Xb=N;c[Xb>>2]=Mb;c[Xb+4>>2]=C;Xb=ba;Mb=c[Xb>>2]|0;Yb=c[Xb+4>>2]|0;Xb=cb(Mb|0,Yb|0,cc|0,Vb|0)|0;Kb=F;c[Kb>>2]=Xb;c[Kb+4>>2]=C;Kb=$;Xb=c[Kb>>2]|0;fc=c[Kb+4>>2]|0;Kb=cb(Xb|0,fc|0,Wb|0,gc|0)|0;Ob=H;c[Ob>>2]=Kb;c[Ob+4>>2]=C;Ob=Y;Kb=c[Ob>>2]|0;Ab=c[Ob+4>>2]|0;Ob=cb(Kb|0,Ab|0,Ib|0,Jb|0)|0;zb=K;c[zb>>2]=Ob;c[zb+4>>2]=C;zb=W;Ob=c[zb>>2]|0;lc=c[zb+4>>2]|0;zb=cb(Ob|0,lc|0,vb|0,Ub|0)|0;Hb=f;c[Hb>>2]=zb;c[Hb+4>>2]=C;Hb=ma;zb=c[Hb>>2]|0;ic=c[Hb+4>>2]|0;Hb=cb(zb|0,ic|0,Pb|0,ec|0)|0;Zb=la;c[Zb>>2]=Hb;c[Zb+4>>2]=C;Zb=bb(Bb|0,ub|0,qb|0,pb|0)|0;pb=m;c[pb>>2]=Zb;c[pb+4>>2]=C;pb=bb(rb|0,mc|0,$b|0,Fb|0)|0;Fb=ja;c[Fb>>2]=pb;c[Fb+4>>2]=C;Fb=bb(Tb|0,Lb|0,dc|0,sb|0)|0;sb=ha;c[sb>>2]=Fb;c[sb+4>>2]=C;sb=bb(Db|0,Qb|0,bc|0,hc|0)|0;hc=fa;c[hc>>2]=sb;c[hc+4>>2]=C;hc=bb(ob|0,yb|0,wb|0,Eb|0)|0;Eb=da;c[Eb>>2]=hc;c[Eb+4>>2]=C;Eb=bb(cc|0,Vb|0,Mb|0,Yb|0)|0;Yb=ba;c[Yb>>2]=Eb;c[Yb+4>>2]=C;Yb=bb(Wb|0,gc|0,Xb|0,fc|0)|0;fc=$;c[fc>>2]=Yb;c[fc+4>>2]=C;fc=bb(Ib|0,Jb|0,Kb|0,Ab|0)|0;Ab=Y;c[Ab>>2]=fc;c[Ab+4>>2]=C;Ab=bb(vb|0,Ub|0,Ob|0,lc|0)|0;lc=W;c[lc>>2]=Ab;c[lc+4>>2]=C;lc=bb(Pb|0,ec|0,zb|0,ic|0)|0;ic=ma;c[ic>>2]=lc;c[ic+4>>2]=C;Na(o,l);Na(n,m);Ma(m,n,x);ic=V;lc=c[ic>>2]|0;zb=c[ic+4>>2]|0;ic=W;ec=c[ic>>2]|0;Pb=c[ic+4>>2]|0;ic=lb(lc|0,zb|0,18,0)|0;Ab=C;Ob=cb(ec|0,Pb|0,lc|0,zb|0)|0;zb=cb(Ob|0,C|0,ic|0,Ab|0)|0;Ab=W;c[Ab>>2]=zb;c[Ab+4>>2]=C;Ab=X;zb=c[Ab>>2]|0;ic=c[Ab+4>>2]|0;Ab=Y;Ob=c[Ab>>2]|0;lc=c[Ab+4>>2]|0;Ab=lb(zb|0,ic|0,18,0)|0;Pb=C;ec=cb(Ob|0,lc|0,zb|0,ic|0)|0;ic=cb(ec|0,C|0,Ab|0,Pb|0)|0;Pb=Y;c[Pb>>2]=ic;c[Pb+4>>2]=C;Pb=Z;ic=c[Pb>>2]|0;Ab=c[Pb+4>>2]|0;Pb=$;ec=c[Pb>>2]|0;zb=c[Pb+4>>2]|0;Pb=lb(ic|0,Ab|0,18,0)|0;lc=C;Ob=cb(ec|0,zb|0,ic|0,Ab|0)|0;Ab=cb(Ob|0,C|0,Pb|0,lc|0)|0;lc=$;c[lc>>2]=Ab;c[lc+4>>2]=C;lc=aa;Ab=c[lc>>2]|0;Pb=c[lc+4>>2]|0;lc=ba;Ob=c[lc>>2]|0;ic=c[lc+4>>2]|0;lc=lb(Ab|0,Pb|0,18,0)|0;zb=C;ec=cb(Ob|0,ic|0,Ab|0,Pb|0)|0;Pb=cb(ec|0,C|0,lc|0,zb|0)|0;zb=ba;c[zb>>2]=Pb;c[zb+4>>2]=C;zb=ca;Pb=c[zb>>2]|0;lc=c[zb+4>>2]|0;zb=da;ec=c[zb>>2]|0;Ab=c[zb+4>>2]|0;zb=lb(Pb|0,lc|0,18,0)|0;ic=C;Ob=cb(ec|0,Ab|0,Pb|0,lc|0)|0;lc=cb(Ob|0,C|0,zb|0,ic|0)|0;ic=da;c[ic>>2]=lc;c[ic+4>>2]=C;ic=ea;lc=c[ic>>2]|0;zb=c[ic+4>>2]|0;ic=fa;Ob=c[ic>>2]|0;Pb=c[ic+4>>2]|0;ic=lb(lc|0,zb|0,18,0)|0;Ab=C;ec=cb(Ob|0,Pb|0,lc|0,zb|0)|0;zb=cb(ec|0,C|0,ic|0,Ab|0)|0;Ab=fa;c[Ab>>2]=zb;c[Ab+4>>2]=C;Ab=ga;zb=c[Ab>>2]|0;ic=c[Ab+4>>2]|0;Ab=ha;ec=c[Ab>>2]|0;lc=c[Ab+4>>2]|0;Ab=lb(zb|0,ic|0,18,0)|0;Pb=C;Ob=cb(ec|0,lc|0,zb|0,ic|0)|0;ic=cb(Ob|0,C|0,Ab|0,Pb|0)|0;Pb=ha;c[Pb>>2]=ic;c[Pb+4>>2]=C;Pb=ia;ic=c[Pb>>2]|0;Ab=c[Pb+4>>2]|0;Pb=ja;Ob=c[Pb>>2]|0;zb=c[Pb+4>>2]|0;Pb=lb(ic|0,Ab|0,18,0)|0;lc=C;ec=cb(Ob|0,zb|0,ic|0,Ab|0)|0;Ab=cb(ec|0,C|0,Pb|0,lc|0)|0;lc=ja;c[lc>>2]=Ab;c[lc+4>>2]=C;lc=ka;Ab=c[lc>>2]|0;Pb=c[lc+4>>2]|0;lc=m;ec=c[lc>>2]|0;ic=c[lc+4>>2]|0;lc=lb(Ab|0,Pb|0,18,0)|0;zb=C;Ob=cb(ec|0,ic|0,Ab|0,Pb|0)|0;Pb=cb(Ob|0,C|0,lc|0,zb|0)|0;zb=C;lc=m;c[lc>>2]=Pb;c[lc+4>>2]=zb;lc=ka;c[lc>>2]=0;c[lc+4>>2]=0;lc=zb;zb=Pb;Pb=0;do Ob=cb(lc>>31>>>6|0,0,zb|0,lc|0)|0,Ab=ab(Ob|0,C|0,26)|0,Ob=C,ic=fb(Ab|0,Ob|0,26)|0,ec=bb(zb|0,lc|0,ic|0,C|0)|0,ic=m+(Pb<<3)|0,c[ic>>2]=ec,c[ic+4>>2]=C,ic=m+((Pb|1)<<3)|0,ec=ic,Ub=cb(Ab|0,Ob|0,c[ec>>2]|0,c[ec+4>>2]|0)|0,ec=C,Ob=cb(ec>>31>>>7|0,0,Ub|0,ec|0)|0,Ab=ab(Ob|0,C|0,25)|0,Ob=C,vb=fb(Ab|0,Ob|0,25)|0,fc=bb(Ub|0,ec|0,vb|0,C|0)|0,vb=ic,c[vb>>2]=fc,c[vb+4>>2]=C,Pb=Pb+2|0,vb=m+(Pb<<3)|0,fc=vb,zb=cb(Ab|0,Ob|0,c[fc>>2]|0,c[fc+4>>2]|0)|0,lc=C,fc=vb,c[fc>>2]=zb,c[fc+4>>2]=lc;while(Pb>>>0<10);Pb=ka;lc=c[Pb>>2]|0;zb=c[Pb+4>>2]|0;Pb=m;mc=c[Pb>>2]|0;rb=c[Pb+4>>2]|0;Pb=lb(lc|0,zb|0,18,0)|0;ub=C;Bb=cb(mc|0,rb|0,lc|0,zb|0)|0;zb=cb(Bb|0,C|0,Pb|0,ub|0)|0;ub=C;Pb=ka;c[Pb>>2]=0;c[Pb+4>>2]=0;Pb=cb(ub>>31>>>6|0,0,zb|0,ub|0)|0;Bb=ab(Pb|0,C|0,26)|0;Pb=C;lc=fb(Bb|0,Pb|0,26)|0;rb=bb(zb|0,ub|0,lc|0,C|0)|0;lc=m;c[lc>>2]=rb;c[lc+4>>2]=C;lc=ja;rb=cb(Bb|0,Pb|0,c[lc>>2]|0,c[lc+4>>2]|0)|0;lc=ja;c[lc>>2]=rb;c[lc+4>>2]=C;D=Za;E=o;e=D+80|0;do c[D>>2]=c[E>>2],D=D+4|0,E=E+4|0;while((D|0)<(e|0));D=$a;E=m;e=D+80|0;do c[D>>2]=c[E>>2],D=D+4|0,E=E+4|0;while((D|0)<(e|0));Na(j,gb);Na(k,ib);Ma(hb,j,k);lc=hb+144|0;rb=c[lc>>2]|0;Pb=c[lc+4>>2]|0;lc=hb+64|0;Bb=lc;ub=c[Bb>>2]|0;zb=c[Bb+4>>2]|0;Bb=lb(rb|0,Pb|0,18,0)|0;mc=C;fc=cb(ub|0,zb|0,rb|0,Pb|0)|0;Pb=cb(fc|0,C|0,Bb|0,mc|0)|0;mc=lc;c[mc>>2]=Pb;c[mc+4>>2]=C;mc=hb+136|0;Pb=c[mc>>2]|0;lc=c[mc+4>>2]|0;mc=hb+56|0;Bb=mc;fc=c[Bb>>2]|0;rb=c[Bb+4>>2]|0;Bb=lb(Pb|0,lc|0,18,0)|0;zb=C;ub=cb(fc|0,rb|0,Pb|0,lc|0)|0;lc=cb(ub|0,C|0,Bb|0,zb|0)|0;zb=mc;c[zb>>2]=lc;c[zb+4>>2]=C;zb=hb+128|0;lc=c[zb>>2]|0;mc=c[zb+4>>2]|0;zb=hb+48|0;Bb=zb;ub=c[Bb>>2]|0;Pb=c[Bb+4>>2]|0;Bb=lb(lc|0,mc|0,18,0)|0;rb=C;fc=cb(ub|0,Pb|0,lc|0,mc|0)|0;mc=cb(fc|0,C|0,Bb|0,rb|0)|0;rb=zb;c[rb>>2]=mc;c[rb+4>>2]=C;rb=hb+120|0;mc=c[rb>>2]|0;zb=c[rb+4>>2]|0;rb=hb+40|0;Bb=rb;fc=c[Bb>>2]|0;lc=c[Bb+4>>2]|0;Bb=lb(mc|0,zb|0,18,0)|0;Pb=C;ub=cb(fc|0,lc|0,mc|0,zb|0)|0;zb=cb(ub|0,C|0,Bb|0,Pb|0)|0;Pb=rb;c[Pb>>2]=zb;c[Pb+4>>2]=C;Pb=hb+112|0;zb=c[Pb>>2]|0;rb=c[Pb+4>>2]|0;Pb=hb+32|0;Bb=Pb;ub=c[Bb>>2]|0;mc=c[Bb+4>>2]|0;Bb=lb(zb|0,rb|0,18,0)|0;lc=C;fc=cb(ub|0,mc|0,zb|0,rb|0)|0;rb=cb(fc|0,C|0,Bb|0,lc|0)|0;lc=Pb;c[lc>>2]=rb;c[lc+4>>2]=C;lc=hb+104|0;rb=c[lc>>2]|0;Pb=c[lc+4>>2]|0;lc=hb+24|0;Bb=lc;fc=c[Bb>>2]|0;zb=c[Bb+4>>2]|0;Bb=lb(rb|0,Pb|0,18,0)|0;mc=C;ub=cb(fc|0,zb|0,rb|0,Pb|0)|0;Pb=cb(ub|0,C|0,Bb|0,mc|0)|0;mc=lc;c[mc>>2]=Pb;c[mc+4>>2]=C;mc=hb+96|0;Pb=c[mc>>2]|0;lc=c[mc+4>>2]|0;mc=hb+16|0;Bb=mc;ub=c[Bb>>2]|0;rb=c[Bb+4>>2]|0;Bb=lb(Pb|0,lc|0,18,0)|0;zb=C;fc=cb(ub|0,rb|0,Pb|0,lc|0)|0;lc=cb(fc|0,C|0,Bb|0,zb|0)|0;zb=mc;c[zb>>2]=lc;c[zb+4>>2]=C;zb=hb+88|0;lc=c[zb>>2]|0;mc=c[zb+4>>2]|0;zb=hb+8|0;Bb=zb;fc=c[Bb>>2]|0;Pb=c[Bb+4>>2]|0;Bb=lb(lc|0,mc|0,18,0)|0;rb=C;ub=cb(fc|0,Pb|0,lc|0,mc|0)|0;mc=cb(ub|0,C|0,Bb|0,rb|0)|0;rb=zb;c[rb>>2]=mc;c[rb+4>>2]=C;rb=hb+80|0;mc=rb;Bb=c[mc>>2]|0;ub=c[mc+4>>2]|0;mc=hb;lc=c[mc>>2]|0;Pb=c[mc+4>>2]|0;mc=lb(Bb|0,ub|0,18,0)|0;fc=C;vb=cb(lc|0,Pb|0,Bb|0,ub|0)|0;ub=cb(vb|0,C|0,mc|0,fc|0)|0;fc=C;mc=hb;c[mc>>2]=ub;c[mc+4>>2]=fc;mc=rb;c[mc>>2]=0;c[mc+4>>2]=0;mc=fc;fc=ub;ub=0;do vb=cb(mc>>31>>>6|0,0,fc|0,mc|0)|0,Bb=ab(vb|0,C|0,26)|0,vb=C,Pb=fb(Bb|0,vb|0,26)|0,lc=bb(fc|0,mc|0,Pb|0,C|0)|0,Pb=hb+(ub<<3)|0,c[Pb>>2]=lc,c[Pb+4>>2]=C,Pb=hb+((ub|1)<<3)|0,lc=Pb,Ob=cb(Bb|0,vb|0,c[lc>>2]|0,c[lc+4>>2]|0)|0,lc=C,vb=cb(lc>>31>>>7|0,0,Ob|0,lc|0)|0,Bb=ab(vb|0,C|0,25)|0,vb=C,Ab=fb(Bb|0,vb|0,25)|0,ic=bb(Ob|0,lc|0,Ab|0,C|0)|0,Ab=Pb,c[Ab>>2]=ic,c[Ab+4>>2]=C,ub=ub+2|0,Ab=hb+(ub<<3)|0,ic=Ab,fc=cb(Bb|0,vb|0,c[ic>>2]|0,c[ic+4>>2]|0)|0,mc=C,ic=Ab,c[ic>>2]=fc,c[ic+4>>2]=mc;while(ub>>>0<10);ub=rb;mc=c[ub>>2]|0;fc=c[ub+4>>2]|0;ub=hb;ic=c[ub>>2]|0;Ab=c[ub+4>>2]|0;ub=lb(mc|0,fc|0,18,0)|0;vb=C;Bb=cb(ic|0,Ab|0,mc|0,fc|0)|0;fc=cb(Bb|0,C|0,ub|0,vb|0)|0;vb=C;ub=rb;c[ub>>2]=0;c[ub+4>>2]=0;ub=cb(vb>>31>>>6|0,0,fc|0,vb|0)|0;Bb=ab(ub|0,C|0,26)|0;ub=C;mc=fb(Bb|0,ub|0,26)|0;Ab=bb(fc|0,vb|0,mc|0,C|0)|0;mc=hb;c[mc>>2]=Ab;c[mc+4>>2]=C;mc=zb;Ab=cb(Bb|0,ub|0,c[mc>>2]|0,c[mc+4>>2]|0)|0;mc=zb;c[mc>>2]=Ab;c[mc+4>>2]=C;mc=j;Ab=c[mc>>2]|0;ub=c[mc+4>>2]|0;mc=k;Bb=bb(Ab|0,ub|0,c[mc>>2]|0,c[mc+4>>2]|0)|0;mc=C;vb=k;c[vb>>2]=Bb;c[vb+4>>2]=mc;vb=na;fc=c[vb>>2]|0;ic=c[vb+4>>2]|0;vb=oa;Pb=bb(fc|0,ic|0,c[vb>>2]|0,c[vb+4>>2]|0)|0;vb=C;lc=oa;c[lc>>2]=Pb;c[lc+4>>2]=vb;lc=pa;Ob=c[lc>>2]|0;ec=c[lc+4>>2]|0;lc=qa;Ub=bb(Ob|0,ec|0,c[lc>>2]|0,c[lc+4>>2]|0)|0;lc=C;Kb=qa;c[Kb>>2]=Ub;c[Kb+4>>2]=lc;Kb=ra;Jb=c[Kb>>2]|0;Ib=c[Kb+4>>2]|0;Kb=sa;Yb=bb(Jb|0,Ib|0,c[Kb>>2]|0,c[Kb+4>>2]|0)|0;Kb=C;Xb=sa;c[Xb>>2]=Yb;c[Xb+4>>2]=Kb;Xb=ta;gc=c[Xb>>2]|0;Wb=c[Xb+4>>2]|0;Xb=ua;Eb=bb(gc|0,Wb|0,c[Xb>>2]|0,c[Xb+4>>2]|0)|0;Xb=C;Mb=ua;c[Mb>>2]=Eb;c[Mb+4>>2]=Xb;Mb=va;Vb=c[Mb>>2]|0;cc=c[Mb+4>>2]|0;Mb=wa;hc=bb(Vb|0,cc|0,c[Mb>>2]|0,c[Mb+4>>2]|0)|0;Mb=C;wb=wa;c[wb>>2]=hc;c[wb+4>>2]=Mb;wb=xa;yb=c[wb>>2]|0;ob=c[wb+4>>2]|0;wb=ya;sb=bb(yb|0,ob|0,c[wb>>2]|0,c[wb+4>>2]|0)|0;wb=C;bc=ya;c[bc>>2]=sb;c[bc+4>>2]=wb;bc=za;Qb=c[bc>>2]|0;Db=c[bc+4>>2]|0;bc=Aa;Fb=bb(Qb|0,Db|0,c[bc>>2]|0,c[bc+4>>2]|0)|0;bc=C;dc=Aa;c[dc>>2]=Fb;c[dc+4>>2]=bc;dc=Ba;Lb=c[dc>>2]|0;Tb=c[dc+4>>2]|0;dc=Ca;pb=bb(Lb|0,Tb|0,c[dc>>2]|0,c[dc+4>>2]|0)|0;dc=C;$b=Ca;c[$b>>2]=pb;c[$b+4>>2]=dc;$b=Da;Zb=c[$b>>2]|0;qb=c[$b+4>>2]|0;$b=Ea;Hb=bb(Zb|0,qb|0,c[$b>>2]|0,c[$b+4>>2]|0)|0;$b=C;_b=Ea;c[_b>>2]=Hb;c[_b+4>>2]=$b;D=Fa;e=D+72|0;do c[D>>2]=0,D=D+4|0;while((D|0)<(e|0));zb=lb(Bb|0,mc|0,121665,0)|0;rb=C;_b=h;c[_b>>2]=zb;c[_b+4>>2]=rb;_b=lb(Pb|0,vb|0,121665,0)|0;tb=Ga;c[tb>>2]=_b;c[tb+4>>2]=C;tb=lb(Ub|0,lc|0,121665,0)|0;_b=Ha;c[_b>>2]=tb;c[_b+4>>2]=C;_b=lb(Yb|0,Kb|0,121665,0)|0;tb=Ia;c[tb>>2]=_b;c[tb+4>>2]=C;tb=lb(Eb|0,Xb|0,121665,0)|0;_b=Ja;c[_b>>2]=tb;c[_b+4>>2]=C;_b=lb(hc|0,Mb|0,121665,0)|0;tb=Ka;c[tb>>2]=_b;c[tb+4>>2]=C;tb=lb(sb|0,wb|0,121665,0)|0;_b=Oa;c[_b>>2]=tb;c[_b+4>>2]=C;_b=lb(Fb|0,bc|0,121665,0)|0;tb=Pa;c[tb>>2]=_b;c[tb+4>>2]=C;tb=lb(pb|0,dc|0,121665,0)|0;_b=Qa;c[_b>>2]=tb;c[_b+4>>2]=C;_b=lb(Hb|0,$b|0,121665,0)|0;tb=Ra;c[tb>>2]=_b;c[tb+4>>2]=C;tb=Fa;c[tb>>2]=0;c[tb+4>>2]=0;tb=rb;rb=zb;zb=0;do _b=cb(tb>>31>>>6|0,0,rb|0,tb|0)|0,Rb=ab(_b|0,C|0,26)|0,_b=C,Sb=fb(Rb|0,_b|0,26)|0,Nb=bb(rb|0,tb|0,Sb|0,C|0)|0,Sb=h+(zb<<3)|0,c[Sb>>2]=Nb,c[Sb+4>>2]=C,Sb=h+((zb|1)<<3)|0,Nb=Sb,Cb=cb(Rb|0,_b|0,c[Nb>>2]|0,c[Nb+4>>2]|0)|0,Nb=C,_b=cb(Nb>>31>>>7|0,0,Cb|0,Nb|0)|0,Rb=ab(_b|0,C|0,25)|0,_b=C,kc=fb(Rb|0,_b|0,25)|0,jc=bb(Cb|0,Nb|0,kc|0,C|0)|0,kc=Sb,c[kc>>2]=jc,c[kc+4>>2]=C,zb=zb+2|0,kc=h+(zb<<3)|0,jc=kc,rb=cb(Rb|0,_b|0,c[jc>>2]|0,c[jc+4>>2]|0)|0,tb=C,jc=kc,c[jc>>2]=rb,c[jc+4>>2]=tb;while(zb>>>0<10);zb=Fa;tb=c[zb>>2]|0;rb=c[zb+4>>2]|0;zb=h;$b=c[zb>>2]|0;Hb=c[zb+4>>2]|0;zb=lb(tb|0,rb|0,18,0)|0;dc=C;pb=cb($b|0,Hb|0,tb|0,rb|0)|0;rb=cb(pb|0,C|0,zb|0,dc|0)|0;dc=C;zb=Fa;c[zb>>2]=0;c[zb+4>>2]=0;zb=cb(dc>>31>>>6|0,0,rb|0,dc|0)|0;pb=ab(zb|0,C|0,26)|0;zb=C;tb=fb(pb|0,zb|0,26)|0;Hb=C;$b=Ga;bc=c[$b>>2]|0;Fb=c[$b+4>>2]|0;$b=cb(rb|0,dc|0,Ab|0,ub|0)|0;dc=bb($b|0,C|0,tb|0,Hb|0)|0;Hb=h;c[Hb>>2]=dc;c[Hb+4>>2]=C;Hb=cb(bc|0,Fb|0,fc|0,ic|0)|0;Fb=cb(Hb|0,C|0,pb|0,zb|0)|0;zb=Ga;c[zb>>2]=Fb;c[zb+4>>2]=C;zb=Ha;Fb=cb(c[zb>>2]|0,c[zb+4>>2]|0,Ob|0,ec|0)|0;zb=Ha;c[zb>>2]=Fb;c[zb+4>>2]=C;zb=Ia;Fb=cb(c[zb>>2]|0,c[zb+4>>2]|0,Jb|0,Ib|0)|0;zb=Ia;c[zb>>2]=Fb;c[zb+4>>2]=C;zb=Ja;Fb=cb(c[zb>>2]|0,c[zb+4>>2]|0,gc|0,Wb|0)|0;zb=Ja;c[zb>>2]=Fb;c[zb+4>>2]=C;zb=Ka;Fb=cb(c[zb>>2]|0,c[zb+4>>2]|0,Vb|0,cc|0)|0;zb=Ka;c[zb>>2]=Fb;c[zb+4>>2]=C;zb=Oa;Fb=cb(c[zb>>2]|0,c[zb+4>>2]|0,yb|0,ob|0)|0;zb=Oa;c[zb>>2]=Fb;c[zb+4>>2]=C;zb=Pa;Fb=cb(c[zb>>2]|0,c[zb+4>>2]|0,Qb|0,Db|0)|0;zb=Pa;c[zb>>2]=Fb;c[zb+4>>2]=C;zb=Qa;Fb=cb(c[zb>>2]|0,c[zb+4>>2]|0,Lb|0,Tb|0)|0;zb=Qa;c[zb>>2]=Fb;c[zb+4>>2]=C;zb=Ra;Fb=cb(c[zb>>2]|0,c[zb+4>>2]|0,Zb|0,qb|0)|0;zb=Ra;c[zb>>2]=Fb;c[zb+4>>2]=C;Ma(jb,k,h);zb=jb+144|0;Fb=c[zb>>2]|0;pb=c[zb+4>>2]|0;zb=jb+64|0;Hb=zb;bc=c[Hb>>2]|0;dc=c[Hb+4>>2]|0;Hb=lb(Fb|0,pb|0,18,0)|0;tb=C;$b=cb(bc|0,dc|0,Fb|0,pb|0)|0;pb=cb($b|0,C|0,Hb|0,tb|0)|0;tb=zb;c[tb>>2]=pb;c[tb+4>>2]=C;tb=jb+136|0;pb=c[tb>>2]|0;zb=c[tb+4>>2]|0;tb=jb+56|0;Hb=tb;$b=c[Hb>>2]|0;Fb=c[Hb+4>>2]|0;Hb=lb(pb|0,zb|0,18,0)|0;dc=C;bc=cb($b|0,Fb|0,pb|0,zb|0)|0;zb=cb(bc|0,C|0,Hb|0,dc|0)|0;dc=tb;c[dc>>2]=zb;c[dc+4>>2]=C;dc=jb+128|0;zb=c[dc>>2]|0;tb=c[dc+4>>2]|0;dc=jb+48|0;Hb=dc;bc=c[Hb>>2]|0;pb=c[Hb+4>>2]|0;Hb=lb(zb|0,tb|0,18,0)|0;Fb=C;$b=cb(bc|0,pb|0,zb|0,tb|0)|0;tb=cb($b|0,C|0,Hb|0,Fb|0)|0;Fb=dc;c[Fb>>2]=tb;c[Fb+4>>2]=C;Fb=jb+120|0;tb=c[Fb>>2]|0;dc=c[Fb+4>>2]|0;Fb=jb+40|0;Hb=Fb;$b=c[Hb>>2]|0;zb=c[Hb+4>>2]|0;Hb=lb(tb|0,dc|0,18,0)|0;pb=C;bc=cb($b|0,zb|0,tb|0,dc|0)|0;dc=cb(bc|0,C|0,Hb|0,pb|0)|0;pb=Fb;c[pb>>2]=dc;c[pb+4>>2]=C;pb=jb+112|0;dc=c[pb>>2]|0;Fb=c[pb+4>>2]|0;pb=jb+32|0;Hb=pb;bc=c[Hb>>2]|0;tb=c[Hb+4>>2]|0;Hb=lb(dc|0,Fb|0,18,0)|0;zb=C;$b=cb(bc|0,tb|0,dc|0,Fb|0)|0;Fb=cb($b|0,C|0,Hb|0,zb|0)|0;zb=pb;c[zb>>2]=Fb;c[zb+4>>2]=C;zb=jb+104|0;Fb=c[zb>>2]|0;pb=c[zb+4>>2]|0;zb=jb+24|0;Hb=zb;$b=c[Hb>>2]|0;dc=c[Hb+4>>2]|0;Hb=lb(Fb|0,pb|0,18,0)|0;tb=C;bc=cb($b|0,dc|0,Fb|0,pb|0)|0;pb=cb(bc|0,C|0,Hb|0,tb|0)|0;tb=zb;c[tb>>2]=pb;c[tb+4>>2]=C;tb=jb+96|0;pb=c[tb>>2]|0;zb=c[tb+4>>2]|0;tb=jb+16|0;Hb=tb;bc=c[Hb>>2]|0;Fb=c[Hb+4>>2]|0;Hb=lb(pb|0,zb|0,18,0)|0;dc=C;$b=cb(bc|0,Fb|0,pb|0,zb|0)|0;zb=cb($b|0,C|0,Hb|0,dc|0)|0;dc=tb;c[dc>>2]=zb;c[dc+4>>2]=C;dc=jb+88|0;zb=c[dc>>2]|0;tb=c[dc+4>>2]|0;dc=jb+8|0;Hb=dc;$b=c[Hb>>2]|0;pb=c[Hb+4>>2]|0;Hb=lb(zb|0,tb|0,18,0)|0;Fb=C;bc=cb($b|0,pb|0,zb|0,tb|0)|0;tb=cb(bc|0,C|0,Hb|0,Fb|0)|0;Fb=dc;c[Fb>>2]=tb;c[Fb+4>>2]=C;Fb=jb+80|0;tb=Fb;Hb=c[tb>>2]|0;bc=c[tb+4>>2]|0;tb=jb;zb=c[tb>>2]|0;pb=c[tb+4>>2]|0;tb=lb(Hb|0,bc|0,18,0)|0;$b=C;rb=cb(zb|0,pb|0,Hb|0,bc|0)|0;bc=cb(rb|0,C|0,tb|0,$b|0)|0;$b=C;tb=jb;c[tb>>2]=bc;c[tb+4>>2]=$b;tb=Fb;c[tb>>2]=0;c[tb+4>>2]=0;tb=$b;$b=bc;bc=0;do rb=cb(tb>>31>>>6|0,0,$b|0,tb|0)|0,Hb=ab(rb|0,C|0,26)|0,rb=C,pb=fb(Hb|0,rb|0,26)|0,zb=bb($b|0,tb|0,pb|0,C|0)|0,pb=jb+(bc<<3)|0,c[pb>>2]=zb,c[pb+4>>2]=C,pb=jb+((bc|1)<<3)|0,zb=pb,wb=cb(Hb|0,rb|0,c[zb>>2]|0,c[zb+4>>2]|0)|0,zb=C,rb=cb(zb>>31>>>7|0,0,wb|0,zb|0)|0,Hb=ab(rb|0,C|0,25)|0,rb=C,sb=fb(Hb|0,rb|0,25)|0,Mb=bb(wb|0,zb|0,sb|0,C|0)|0,sb=pb,c[sb>>2]=Mb,c[sb+4>>2]=C,bc=bc+2|0,sb=jb+(bc<<3)|0,Mb=sb,$b=cb(Hb|0,rb|0,c[Mb>>2]|0,c[Mb+4>>2]|0)|0,tb=C,Mb=sb,c[Mb>>2]=$b,c[Mb+4>>2]=tb;while(bc>>>0<10);bc=Fb;tb=c[bc>>2]|0;$b=c[bc+4>>2]|0;bc=jb;qb=c[bc>>2]|0;Zb=c[bc+4>>2]|0;bc=lb(tb|0,$b|0,18,0)|0;Tb=C;Lb=cb(qb|0,Zb|0,tb|0,$b|0)|0;$b=cb(Lb|0,C|0,bc|0,Tb|0)|0;Tb=C;bc=Fb;c[bc>>2]=0;c[bc+4>>2]=0;bc=cb(Tb>>31>>>6|0,0,$b|0,Tb|0)|0;Lb=ab(bc|0,C|0,26)|0;bc=C;tb=fb(Lb|0,bc|0,26)|0;Zb=bb($b|0,Tb|0,tb|0,C|0)|0;tb=jb;c[tb>>2]=Zb;c[tb+4>>2]=C;tb=dc;Zb=cb(Lb|0,bc|0,c[tb>>2]|0,c[tb+4>>2]|0)|0;tb=dc;c[tb>>2]=Zb;c[tb+4>>2]=C;tb=0;do Zb=hb+(tb<<3)|0,bc=Zb,Lb=c[bc>>2]|0,Tb=c[bc+4>>2]|0,bc=Za+(tb<<3)|0,$b=bc,qb=c[$b>>2]|0,Db=c[$b+4>>2]|0,$b=(qb^Lb)&mb,Qb=(Db^Tb)&nb,Tb=ab(0,$b^Lb|0,32)|0,Lb=Zb,c[Lb>>2]=Tb,c[Lb+4>>2]=C,Lb=ab(0,$b^qb|0,32)|0,qb=bc,c[qb>>2]=Lb,c[qb+4>>2]=C,tb=tb+1|0;while((tb|0)!=10);nc=0;do tb=jb+(nc<<3)|0,dc=tb,Fb=c[dc>>2]|0,qb=c[dc+4>>2]|0,dc=$a+(nc<<3)|0,Lb=dc,bc=c[Lb>>2]|0,$b=c[Lb+4>>2]|0,Lb=(bc^Fb)&mb,Tb=($b^qb)&nb,qb=ab(0,Lb^Fb|0,32)|0,Fb=tb,c[Fb>>2]=qb,c[Fb+4>>2]=C,Fb=ab(0,Lb^bc|0,32)|0,bc=dc,c[bc>>2]=Fb,c[bc+4>>2]=C,nc=nc+1|0;while((nc|0)!=10);Xa=Xa+1|0;if((Xa|0)==8){oc=Ya;pc=Za;qc=_a;rc=$a;sc=gb;tc=hb;uc=ib;vc=jb;break}else nb=jb,mb=hb,bc=$a,Fb=Za,w=kb<<1&255,jb=ib,ib=nb,hb=gb,gb=mb,$a=_a,_a=bc,Za=Ya,Ya=Fb}Ya=Sa+1|0;if((Ya|0)==32){wc=tc;xc=vc;break}else Sa=Ya,Ta=pc,Ua=oc,t=rc,Va=qc,u=tc,Wa=sc,v=vc,s=uc}D=y;E=wc;e=D+80|0;do c[D>>2]=c[E>>2],D=D+4|0,E=E+4|0;while((D|0)<(e|0));D=z;E=xc;e=D+80|0;do c[D>>2]=c[E>>2],D=D+4|0,E=E+4|0;while((D|0)<(e|0));Na(h,z);Na(r,h);Na(q,r);La(j,q,z);La(k,j,h);Na(q,k);La(l,q,j);Na(q,l);Na(r,q);Na(q,r);Na(r,q);Na(q,r);La(m,q,l);Na(q,m);Na(r,q);Na(q,r);Na(r,q);Na(q,r);Na(r,q);Na(q,r);Na(r,q);Na(q,r);Na(r,q);La(n,r,m);Na(q,n);Na(r,q);Na(q,r);Na(r,q);Na(q,r);Na(r,q);Na(q,r);Na(r,q);Na(q,r);Na(r,q);Na(q,r);Na(r,q);Na(q,r);Na(r,q);Na(q,r);Na(r,q);Na(q,r);Na(r,q);Na(q,r);Na(r,q);La(q,r,n);Na(r,q);Na(q,r);Na(r,q);Na(q,r);Na(r,q);Na(q,r);Na(r,q);Na(q,r);Na(r,q);Na(q,r);La(o,q,m);Na(q,o);Na(r,q);m=2;do Na(q,r),Na(r,q),m=m+2|0;while((m|0)<50);La(p,r,o);Na(r,p);Na(q,r);m=2;do Na(r,q),Na(q,r),m=m+2|0;while((m|0)<100);La(r,q,p);Na(q,r);Na(r,q);p=2;do Na(q,r),Na(r,q),p=p+2|0;while((p|0)<50);La(q,r,o);Na(r,q);Na(q,r);Na(r,q);Na(q,r);Na(r,q);La(A,r,k);La(z,y,A);A=c[z>>2]|0;c[h>>2]=A;y=h+4|0;c[y>>2]=c[z+8>>2];k=h+8|0;c[k>>2]=c[z+16>>2];r=h+12|0;c[r>>2]=c[z+24>>2];q=h+16|0;c[q>>2]=c[z+32>>2];o=h+20|0;c[o>>2]=c[z+40>>2];p=h+24|0;c[p>>2]=c[z+48>>2];m=h+28|0;c[m>>2]=c[z+56>>2];n=h+32|0;c[n>>2]=c[z+64>>2];l=h+36|0;c[l>>2]=c[z+72>>2];z=A;A=0;while(1){j=h+(A<<2)|0;E=z>>31&z;!(A&1)?(D=E>>26,c[j>>2]=(_(D,-67108864)|0)+z,e=A+1|0,xc=h+(e<<2)|0,wc=(c[xc>>2]|0)+D|0,c[xc>>2]=wc,yc=wc,zc=e):(e=E>>25,c[j>>2]=(_(e,-33554432)|0)+z,j=A+1|0,E=h+(j<<2)|0,wc=(c[E>>2]|0)+e|0,c[E>>2]=wc,yc=wc,zc=j);if((zc|0)==9)break;else z=yc,A=zc}zc=c[l>>2]|0;A=(zc>>31&zc)>>25;c[l>>2]=(_(A,-33554432)|0)+zc;zc=(A*19|0)+(c[h>>2]|0)|0;c[h>>2]=zc;A=zc;zc=0;while(1){yc=h+(zc<<2)|0;z=A>>31&A;!(zc&1)?(j=z>>26,c[yc>>2]=(_(j,-67108864)|0)+A,wc=zc+1|0,E=h+(wc<<2)|0,e=(c[E>>2]|0)+j|0,c[E>>2]=e,Ac=wc,Bc=e):(e=z>>25,c[yc>>2]=(_(e,-33554432)|0)+A,yc=zc+1|0,z=h+(yc<<2)|0,wc=(c[z>>2]|0)+e|0,c[z>>2]=wc,Ac=yc,Bc=wc);if((Ac|0)==9)break;else A=Bc,zc=Ac}Ac=c[l>>2]|0;zc=(Ac>>31&Ac)>>25;c[l>>2]=(_(zc,-33554432)|0)+Ac;Ac=(zc*19|0)+(c[h>>2]|0)|0;zc=(Ac>>31&Ac)>>26;Bc=(_(zc,-67108864)|0)+Ac|0;c[h>>2]=Bc;c[y>>2]=zc+(c[y>>2]|0);zc=Bc;Bc=0;while(1){Ac=h+(Bc<<2)|0;!(Bc&1)?(c[Ac>>2]=zc&67108863,A=Bc+1|0,wc=h+(A<<2)|0,yc=(c[wc>>2]|0)+(zc>>26)|0,c[wc>>2]=yc,Cc=A,Dc=yc):(c[Ac>>2]=zc&33554431,Ac=Bc+1|0,yc=h+(Ac<<2)|0,A=(c[yc>>2]|0)+(zc>>25)|0,c[yc>>2]=A,Cc=Ac,Dc=A);if((Cc|0)==9)break;else zc=Dc,Bc=Cc}Cc=c[l>>2]|0;c[l>>2]=Cc&33554431;Bc=((Cc>>25)*19|0)+(c[h>>2]|0)|0;c[h>>2]=Bc;Cc=Bc;Bc=0;while(1){Dc=h+(Bc<<2)|0;!(Bc&1)?(c[Dc>>2]=Cc&67108863,zc=Bc+1|0,A=h+(zc<<2)|0,Ac=(c[A>>2]|0)+(Cc>>26)|0,c[A>>2]=Ac,Ec=zc,Fc=Ac):(c[Dc>>2]=Cc&33554431,Dc=Bc+1|0,Ac=h+(Dc<<2)|0,zc=(c[Ac>>2]|0)+(Cc>>25)|0,c[Ac>>2]=zc,Ec=Dc,Fc=zc);if((Ec|0)==9)break;else Cc=Fc,Bc=Ec}Ec=c[l>>2]|0;Bc=Ec&33554431;c[l>>2]=Bc;Fc=((Ec>>25)*19|0)+(c[h>>2]|0)|0;c[h>>2]=Fc;Ec=1;Cc=~(Fc+-67108845>>31);while(1){zc=c[h+(Ec<<2)>>2]|0;!(Ec&1)?(Dc=zc<<16&(zc^-67108864),Ac=Dc<<8&Dc,Dc=Ac<<4&Ac,Ac=Dc<<2&Dc,Gc=Ac<<1&Ac):(Ac=zc<<16&(zc^-33554432),zc=Ac<<8&Ac,Ac=zc<<4&zc,zc=Ac<<2&Ac,Gc=zc<<1&zc);zc=Gc>>31&Cc;Ec=Ec+1|0;if((Ec|0)==10){Hc=zc;break}else Cc=zc}Cc=Fc-(Hc&67108845)|0;c[h>>2]=Cc;h=Hc&67108863;Fc=Hc&33554431;Ec=(c[y>>2]|0)-Fc|0;Gc=Ec<<2;zc=(c[k>>2]|0)-h|0;Ac=zc<<3;Dc=(c[r>>2]|0)-Fc|0;A=Dc<<5;yc=(c[q>>2]|0)-Hc|0;Hc=yc<<6;wc=(c[o>>2]|0)-Fc|0;c[o>>2]=wc;o=(c[p>>2]|0)-h|0;z=o<<1;e=(c[m>>2]|0)-Fc|0;E=e<<3;j=(c[n>>2]|0)-h<<4;c[y>>2]=Gc;c[k>>2]=Ac;c[r>>2]=A;c[q>>2]=Hc;c[p>>2]=z;c[m>>2]=E;c[n>>2]=j;c[l>>2]=Bc-Fc<<6;a[b>>0]=Cc;a[b+1>>0]=Cc>>>8;a[b+2>>0]=Cc>>>16;a[b+3>>0]=Gc|Cc>>>24;a[b+4>>0]=Ec>>>6;a[b+5>>0]=Ec>>>14;a[b+6>>0]=Ac|Ec>>>22;a[b+7>>0]=zc>>>5;a[b+8>>0]=zc>>>13;a[b+9>>0]=A|zc>>>21;a[b+10>>0]=Dc>>>3;a[b+11>>0]=Dc>>>11;a[b+12>>0]=Hc|Dc>>>19;a[b+13>>0]=yc>>>2;a[b+14>>0]=yc>>>10;a[b+15>>0]=yc>>>18;a[b+16>>0]=wc;a[b+17>>0]=wc>>>8;a[b+18>>0]=wc>>>16;a[b+19>>0]=wc>>>24|z;a[b+20>>0]=o>>>7;a[b+21>>0]=o>>>15;a[b+22>>0]=o>>>23|E;a[b+23>>0]=e>>>5;a[b+24>>0]=e>>>13;E=c[n>>2]|0;a[b+25>>0]=e>>>21|E;a[b+26>>0]=E>>>8;a[b+27>>0]=E>>>16;e=c[l>>2]|0;a[b+28>>0]=E>>>24|e;a[b+29>>0]=e>>>8;a[b+30>>0]=e>>>16;a[b+31>>0]=e>>>24;i=g;return 0}function La(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0,g=0,h=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0;e=i;i=i+160|0;f=e;Ma(f,b,d);d=f+144|0;b=c[d>>2]|0;g=c[d+4>>2]|0;d=f+64|0;h=d;j=c[h>>2]|0;k=c[h+4>>2]|0;h=lb(b|0,g|0,18,0)|0;l=C;m=cb(j|0,k|0,b|0,g|0)|0;g=cb(m|0,C|0,h|0,l|0)|0;l=d;c[l>>2]=g;c[l+4>>2]=C;l=f+136|0;g=c[l>>2]|0;d=c[l+4>>2]|0;l=f+56|0;h=l;m=c[h>>2]|0;b=c[h+4>>2]|0;h=lb(g|0,d|0,18,0)|0;k=C;j=cb(m|0,b|0,g|0,d|0)|0;d=cb(j|0,C|0,h|0,k|0)|0;k=l;c[k>>2]=d;c[k+4>>2]=C;k=f+128|0;d=c[k>>2]|0;l=c[k+4>>2]|0;k=f+48|0;h=k;j=c[h>>2]|0;g=c[h+4>>2]|0;h=lb(d|0,l|0,18,0)|0;b=C;m=cb(j|0,g|0,d|0,l|0)|0;l=cb(m|0,C|0,h|0,b|0)|0;b=k;c[b>>2]=l;c[b+4>>2]=C;b=f+120|0;l=c[b>>2]|0;k=c[b+4>>2]|0;b=f+40|0;h=b;m=c[h>>2]|0;d=c[h+4>>2]|0;h=lb(l|0,k|0,18,0)|0;g=C;j=cb(m|0,d|0,l|0,k|0)|0;k=cb(j|0,C|0,h|0,g|0)|0;g=b;c[g>>2]=k;c[g+4>>2]=C;g=f+112|0;k=c[g>>2]|0;b=c[g+4>>2]|0;g=f+32|0;h=g;j=c[h>>2]|0;l=c[h+4>>2]|0;h=lb(k|0,b|0,18,0)|0;d=C;m=cb(j|0,l|0,k|0,b|0)|0;b=cb(m|0,C|0,h|0,d|0)|0;d=g;c[d>>2]=b;c[d+4>>2]=C;d=f+104|0;b=c[d>>2]|0;g=c[d+4>>2]|0;d=f+24|0;h=d;m=c[h>>2]|0;k=c[h+4>>2]|0;h=lb(b|0,g|0,18,0)|0;l=C;j=cb(m|0,k|0,b|0,g|0)|0;g=cb(j|0,C|0,h|0,l|0)|0;l=d;c[l>>2]=g;c[l+4>>2]=C;l=f+96|0;g=c[l>>2]|0;d=c[l+4>>2]|0;l=f+16|0;h=l;j=c[h>>2]|0;b=c[h+4>>2]|0;h=lb(g|0,d|0,18,0)|0;k=C;m=cb(j|0,b|0,g|0,d|0)|0;d=cb(m|0,C|0,h|0,k|0)|0;k=l;c[k>>2]=d;c[k+4>>2]=C;k=f+88|0;d=c[k>>2]|0;l=c[k+4>>2]|0;k=f+8|0;h=k;m=c[h>>2]|0;g=c[h+4>>2]|0;h=lb(d|0,l|0,18,0)|0;b=C;j=cb(m|0,g|0,d|0,l|0)|0;l=cb(j|0,C|0,h|0,b|0)|0;b=k;c[b>>2]=l;c[b+4>>2]=C;b=f+80|0;l=b;h=c[l>>2]|0;j=c[l+4>>2]|0;l=f;d=c[l>>2]|0;g=c[l+4>>2]|0;l=lb(h|0,j|0,18,0)|0;m=C;n=cb(d|0,g|0,h|0,j|0)|0;j=cb(n|0,C|0,l|0,m|0)|0;m=C;l=f;c[l>>2]=j;c[l+4>>2]=m;l=b;c[l>>2]=0;c[l+4>>2]=0;l=m;m=j;j=0;do n=cb(l>>31>>>6|0,0,m|0,l|0)|0,h=ab(n|0,C|0,26)|0,n=C,g=fb(h|0,n|0,26)|0,d=bb(m|0,l|0,g|0,C|0)|0,g=f+(j<<3)|0,c[g>>2]=d,c[g+4>>2]=C,g=f+((j|1)<<3)|0,d=g,o=cb(h|0,n|0,c[d>>2]|0,c[d+4>>2]|0)|0,d=C,n=cb(d>>31>>>7|0,0,o|0,d|0)|0,h=ab(n|0,C|0,25)|0,n=C,p=fb(h|0,n|0,25)|0,q=bb(o|0,d|0,p|0,C|0)|0,p=g,c[p>>2]=q,c[p+4>>2]=C,j=j+2|0,p=f+(j<<3)|0,q=p,m=cb(h|0,n|0,c[q>>2]|0,c[q+4>>2]|0)|0,l=C,q=p,c[q>>2]=m,c[q+4>>2]=l;while(j>>>0<10);j=b;l=c[j>>2]|0;m=c[j+4>>2]|0;j=f;q=c[j>>2]|0;p=c[j+4>>2]|0;j=lb(l|0,m|0,18,0)|0;n=C;h=cb(q|0,p|0,l|0,m|0)|0;m=cb(h|0,C|0,j|0,n|0)|0;n=C;j=b;c[j>>2]=0;c[j+4>>2]=0;j=cb(n>>31>>>6|0,0,m|0,n|0)|0;b=ab(j|0,C|0,26)|0;j=C;h=fb(b|0,j|0,26)|0;l=bb(m|0,n|0,h|0,C|0)|0;h=f;c[h>>2]=l;c[h+4>>2]=C;h=k;l=cb(b|0,j|0,c[h>>2]|0,c[h+4>>2]|0)|0;h=k;c[h>>2]=l;c[h+4>>2]=C;h=a;a=f;f=h+80|0;do c[h>>2]=c[a>>2],h=h+4|0,a=a+4|0;while((h|0)<(f|0));i=e;return}function Ma(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0,g=0,h=0,i=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0,t=0,u=0,v=0,w=0,x=0,y=0,z=0,A=0;e=ab(0,c[b>>2]|0,32)|0;f=C;g=ab(0,c[d>>2]|0,32)|0;h=lb(g|0,C|0,e|0,f|0)|0;f=a;c[f>>2]=h;c[f+4>>2]=C;f=ab(0,c[b>>2]|0,32)|0;h=C;e=d+8|0;g=ab(0,c[e>>2]|0,32)|0;i=lb(g|0,C|0,f|0,h|0)|0;h=C;f=b+8|0;g=ab(0,c[f>>2]|0,32)|0;j=C;k=ab(0,c[d>>2]|0,32)|0;l=lb(k|0,C|0,g|0,j|0)|0;j=cb(l|0,C|0,i|0,h|0)|0;h=a+8|0;c[h>>2]=j;c[h+4>>2]=C;h=ab(0,c[f>>2]|0,31)|0;j=C;i=ab(0,c[e>>2]|0,32)|0;l=lb(i|0,C|0,h|0,j|0)|0;j=C;h=ab(0,c[b>>2]|0,32)|0;i=C;g=d+16|0;k=ab(0,c[g>>2]|0,32)|0;m=lb(k|0,C|0,h|0,i|0)|0;i=cb(m|0,C|0,l|0,j|0)|0;j=C;l=b+16|0;m=ab(0,c[l>>2]|0,32)|0;h=C;k=ab(0,c[d>>2]|0,32)|0;n=lb(k|0,C|0,m|0,h|0)|0;h=cb(i|0,j|0,n|0,C|0)|0;n=a+16|0;c[n>>2]=h;c[n+4>>2]=C;n=ab(0,c[f>>2]|0,32)|0;h=C;j=ab(0,c[g>>2]|0,32)|0;i=lb(j|0,C|0,n|0,h|0)|0;h=C;n=ab(0,c[l>>2]|0,32)|0;j=C;m=ab(0,c[e>>2]|0,32)|0;k=lb(m|0,C|0,n|0,j|0)|0;j=cb(k|0,C|0,i|0,h|0)|0;h=C;i=ab(0,c[b>>2]|0,32)|0;k=C;n=d+24|0;m=ab(0,c[n>>2]|0,32)|0;o=lb(m|0,C|0,i|0,k|0)|0;k=cb(j|0,h|0,o|0,C|0)|0;o=C;h=b+24|0;j=ab(0,c[h>>2]|0,32)|0;i=C;m=ab(0,c[d>>2]|0,32)|0;p=lb(m|0,C|0,j|0,i|0)|0;i=cb(k|0,o|0,p|0,C|0)|0;p=a+24|0;c[p>>2]=i;c[p+4>>2]=C;p=ab(0,c[l>>2]|0,32)|0;i=C;o=ab(0,c[g>>2]|0,32)|0;k=lb(o|0,C|0,p|0,i|0)|0;i=C;p=ab(0,c[f>>2]|0,32)|0;o=C;j=ab(0,c[n>>2]|0,32)|0;m=lb(j|0,C|0,p|0,o|0)|0;o=C;p=ab(0,c[h>>2]|0,32)|0;j=C;q=ab(0,c[e>>2]|0,32)|0;r=lb(q|0,C|0,p|0,j|0)|0;j=cb(r|0,C|0,m|0,o|0)|0;o=fb(j|0,C|0,1)|0;j=cb(o|0,C|0,k|0,i|0)|0;i=C;k=ab(0,c[b>>2]|0,32)|0;o=C;m=d+32|0;r=ab(0,c[m>>2]|0,32)|0;p=lb(r|0,C|0,k|0,o|0)|0;o=cb(j|0,i|0,p|0,C|0)|0;p=C;i=b+32|0;j=ab(0,c[i>>2]|0,32)|0;k=C;r=ab(0,c[d>>2]|0,32)|0;q=lb(r|0,C|0,j|0,k|0)|0;k=cb(o|0,p|0,q|0,C|0)|0;q=a+32|0;c[q>>2]=k;c[q+4>>2]=C;q=ab(0,c[l>>2]|0,32)|0;k=C;p=ab(0,c[n>>2]|0,32)|0;o=lb(p|0,C|0,q|0,k|0)|0;k=C;q=ab(0,c[h>>2]|0,32)|0;p=C;j=ab(0,c[g>>2]|0,32)|0;r=lb(j|0,C|0,q|0,p|0)|0;p=cb(r|0,C|0,o|0,k|0)|0;k=C;o=ab(0,c[f>>2]|0,32)|0;r=C;q=ab(0,c[m>>2]|0,32)|0;j=lb(q|0,C|0,o|0,r|0)|0;r=cb(p|0,k|0,j|0,C|0)|0;j=C;k=ab(0,c[i>>2]|0,32)|0;p=C;o=ab(0,c[e>>2]|0,32)|0;q=lb(o|0,C|0,k|0,p|0)|0;p=cb(r|0,j|0,q|0,C|0)|0;q=C;j=ab(0,c[b>>2]|0,32)|0;r=C;k=d+40|0;o=ab(0,c[k>>2]|0,32)|0;s=lb(o|0,C|0,j|0,r|0)|0;r=cb(p|0,q|0,s|0,C|0)|0;s=C;q=b+40|0;p=ab(0,c[q>>2]|0,32)|0;j=C;o=ab(0,c[d>>2]|0,32)|0;t=lb(o|0,C|0,p|0,j|0)|0;j=cb(r|0,s|0,t|0,C|0)|0;t=a+40|0;c[t>>2]=j;c[t+4>>2]=C;t=ab(0,c[h>>2]|0,32)|0;j=C;s=ab(0,c[n>>2]|0,32)|0;r=lb(s|0,C|0,t|0,j|0)|0;j=C;t=ab(0,c[f>>2]|0,32)|0;s=C;p=ab(0,c[k>>2]|0,32)|0;o=lb(p|0,C|0,t|0,s|0)|0;s=cb(o|0,C|0,r|0,j|0)|0;j=C;r=ab(0,c[q>>2]|0,32)|0;o=C;t=ab(0,c[e>>2]|0,32)|0;p=lb(t|0,C|0,r|0,o|0)|0;o=cb(s|0,j|0,p|0,C|0)|0;p=fb(o|0,C|0,1)|0;o=C;j=ab(0,c[l>>2]|0,32)|0;s=C;r=ab(0,c[m>>2]|0,32)|0;t=lb(r|0,C|0,j|0,s|0)|0;s=cb(p|0,o|0,t|0,C|0)|0;t=C;o=ab(0,c[i>>2]|0,32)|0;p=C;j=ab(0,c[g>>2]|0,32)|0;r=lb(j|0,C|0,o|0,p|0)|0;p=cb(s|0,t|0,r|0,C|0)|0;r=C;t=ab(0,c[b>>2]|0,32)|0;s=C;o=d+48|0;j=ab(0,c[o>>2]|0,32)|0;u=lb(j|0,C|0,t|0,s|0)|0;s=cb(p|0,r|0,u|0,C|0)|0;u=C;r=b+48|0;p=ab(0,c[r>>2]|0,32)|0;t=C;j=ab(0,c[d>>2]|0,32)|0;v=lb(j|0,C|0,p|0,t|0)|0;t=cb(s|0,u|0,v|0,C|0)|0;v=a+48|0;c[v>>2]=t;c[v+4>>2]=C;v=ab(0,c[h>>2]|0,32)|0;t=C;u=ab(0,c[m>>2]|0,32)|0;s=lb(u|0,C|0,v|0,t|0)|0;t=C;v=ab(0,c[i>>2]|0,32)|0;u=C;p=ab(0,c[n>>2]|0,32)|0;j=lb(p|0,C|0,v|0,u|0)|0;u=cb(j|0,C|0,s|0,t|0)|0;t=C;s=ab(0,c[l>>2]|0,32)|0;j=C;v=ab(0,c[k>>2]|0,32)|0;p=lb(v|0,C|0,s|0,j|0)|0;j=cb(u|0,t|0,p|0,C|0)|0;p=C;t=ab(0,c[q>>2]|0,32)|0;u=C;s=ab(0,c[g>>2]|0,32)|0;v=lb(s|0,C|0,t|0,u|0)|0;u=cb(j|0,p|0,v|0,C|0)|0;v=C;p=ab(0,c[f>>2]|0,32)|0;j=C;t=ab(0,c[o>>2]|0,32)|0;s=lb(t|0,C|0,p|0,j|0)|0;j=cb(u|0,v|0,s|0,C|0)|0;s=C;v=ab(0,c[r>>2]|0,32)|0;u=C;p=ab(0,c[e>>2]|0,32)|0;t=lb(p|0,C|0,v|0,u|0)|0;u=cb(j|0,s|0,t|0,C|0)|0;t=C;s=ab(0,c[b>>2]|0,32)|0;j=C;v=d+56|0;p=ab(0,c[v>>2]|0,32)|0;w=lb(p|0,C|0,s|0,j|0)|0;j=cb(u|0,t|0,w|0,C|0)|0;w=C;t=b+56|0;u=ab(0,c[t>>2]|0,32)|0;s=C;p=ab(0,c[d>>2]|0,32)|0;x=lb(p|0,C|0,u|0,s|0)|0;s=cb(j|0,w|0,x|0,C|0)|0;x=a+56|0;c[x>>2]=s;c[x+4>>2]=C;x=ab(0,c[i>>2]|0,32)|0;s=C;w=ab(0,c[m>>2]|0,32)|0;j=lb(w|0,C|0,x|0,s|0)|0;s=C;x=ab(0,c[h>>2]|0,32)|0;w=C;u=ab(0,c[k>>2]|0,32)|0;p=lb(u|0,C|0,x|0,w|0)|0;w=C;x=ab(0,c[q>>2]|0,32)|0;u=C;y=ab(0,c[n>>2]|0,32)|0;z=lb(y|0,C|0,x|0,u|0)|0;u=cb(z|0,C|0,p|0,w|0)|0;w=C;p=ab(0,c[f>>2]|0,32)|0;z=C;x=ab(0,c[v>>2]|0,32)|0;y=lb(x|0,C|0,p|0,z|0)|0;z=cb(u|0,w|0,y|0,C|0)|0;y=C;w=ab(0,c[t>>2]|0,32)|0;u=C;p=ab(0,c[e>>2]|0,32)|0;x=lb(p|0,C|0,w|0,u|0)|0;u=cb(z|0,y|0,x|0,C|0)|0;x=fb(u|0,C|0,1)|0;u=cb(x|0,C|0,j|0,s|0)|0;s=C;j=ab(0,c[l>>2]|0,32)|0;x=C;y=ab(0,c[o>>2]|0,32)|0;z=lb(y|0,C|0,j|0,x|0)|0;x=cb(u|0,s|0,z|0,C|0)|0;z=C;s=ab(0,c[r>>2]|0,32)|0;u=C;j=ab(0,c[g>>2]|0,32)|0;y=lb(j|0,C|0,s|0,u|0)|0;u=cb(x|0,z|0,y|0,C|0)|0;y=C;z=ab(0,c[b>>2]|0,32)|0;x=C;s=d+64|0;j=ab(0,c[s>>2]|0,32)|0;w=lb(j|0,C|0,z|0,x|0)|0;x=cb(u|0,y|0,w|0,C|0)|0;w=C;y=b+64|0;u=ab(0,c[y>>2]|0,32)|0;z=C;j=ab(0,c[d>>2]|0,32)|0;p=lb(j|0,C|0,u|0,z|0)|0;z=cb(x|0,w|0,p|0,C|0)|0;p=a+64|0;c[p>>2]=z;c[p+4>>2]=C;p=ab(0,c[i>>2]|0,32)|0;z=C;w=ab(0,c[k>>2]|0,32)|0;x=lb(w|0,C|0,p|0,z|0)|0;z=C;p=ab(0,c[q>>2]|0,32)|0;w=C;u=ab(0,c[m>>2]|0,32)|0;j=lb(u|0,C|0,p|0,w|0)|0;w=cb(j|0,C|0,x|0,z|0)|0;z=C;x=ab(0,c[h>>2]|0,32)|0;j=C;p=ab(0,c[o>>2]|0,32)|0;u=lb(p|0,C|0,x|0,j|0)|0;j=cb(w|0,z|0,u|0,C|0)|0;u=C;z=ab(0,c[r>>2]|0,32)|0;w=C;x=ab(0,c[n>>2]|0,32)|0;p=lb(x|0,C|0,z|0,w|0)|0;w=cb(j|0,u|0,p|0,C|0)|0;p=C;u=ab(0,c[l>>2]|0,32)|0;j=C;z=ab(0,c[v>>2]|0,32)|0;x=lb(z|0,C|0,u|0,j|0)|0;j=cb(w|0,p|0,x|0,C|0)|0;x=C;p=ab(0,c[t>>2]|0,32)|0;w=C;u=ab(0,c[g>>2]|0,32)|0;z=lb(u|0,C|0,p|0,w|0)|0;w=cb(j|0,x|0,z|0,C|0)|0;z=C;x=ab(0,c[f>>2]|0,32)|0;j=C;p=ab(0,c[s>>2]|0,32)|0;u=lb(p|0,C|0,x|0,j|0)|0;j=cb(w|0,z|0,u|0,C|0)|0;u=C;z=ab(0,c[y>>2]|0,32)|0;w=C;x=ab(0,c[e>>2]|0,32)|0;p=lb(x|0,C|0,z|0,w|0)|0;w=cb(j|0,u|0,p|0,C|0)|0;p=C;u=ab(0,c[b>>2]|0,32)|0;j=C;z=d+72|0;x=ab(0,c[z>>2]|0,32)|0;A=lb(x|0,C|0,u|0,j|0)|0;j=cb(w|0,p|0,A|0,C|0)|0;A=C;p=b+72|0;b=ab(0,c[p>>2]|0,32)|0;w=C;u=ab(0,c[d>>2]|0,32)|0;d=lb(u|0,C|0,b|0,w|0)|0;w=cb(j|0,A|0,d|0,C|0)|0;d=a+72|0;c[d>>2]=w;c[d+4>>2]=C;d=ab(0,c[q>>2]|0,32)|0;w=C;A=ab(0,c[k>>2]|0,32)|0;j=lb(A|0,C|0,d|0,w|0)|0;w=C;d=ab(0,c[h>>2]|0,32)|0;A=C;b=ab(0,c[v>>2]|0,32)|0;u=lb(b|0,C|0,d|0,A|0)|0;A=cb(u|0,C|0,j|0,w|0)|0;w=C;j=ab(0,c[t>>2]|0,32)|0;u=C;d=ab(0,c[n>>2]|0,32)|0;b=lb(d|0,C|0,j|0,u|0)|0;u=cb(A|0,w|0,b|0,C|0)|0;b=C;w=ab(0,c[f>>2]|0,32)|0;f=C;A=ab(0,c[z>>2]|0,32)|0;j=lb(A|0,C|0,w|0,f|0)|0;f=cb(u|0,b|0,j|0,C|0)|0;j=C;b=ab(0,c[p>>2]|0,32)|0;u=C;w=ab(0,c[e>>2]|0,32)|0;e=lb(w|0,C|0,b|0,u|0)|0;u=cb(f|0,j|0,e|0,C|0)|0;e=fb(u|0,C|0,1)|0;u=C;j=ab(0,c[i>>2]|0,32)|0;f=C;b=ab(0,c[o>>2]|0,32)|0;w=lb(b|0,C|0,j|0,f|0)|0;f=cb(e|0,u|0,w|0,C|0)|0;w=C;u=ab(0,c[r>>2]|0,32)|0;e=C;j=ab(0,c[m>>2]|0,32)|0;b=lb(j|0,C|0,u|0,e|0)|0;e=cb(f|0,w|0,b|0,C|0)|0;b=C;w=ab(0,c[l>>2]|0,32)|0;f=C;u=ab(0,c[s>>2]|0,32)|0;j=lb(u|0,C|0,w|0,f|0)|0;f=cb(e|0,b|0,j|0,C|0)|0;j=C;b=ab(0,c[y>>2]|0,32)|0;e=C;w=ab(0,c[g>>2]|0,32)|0;u=lb(w|0,C|0,b|0,e|0)|0;e=cb(f|0,j|0,u|0,C|0)|0;u=a+80|0;c[u>>2]=e;c[u+4>>2]=C;u=ab(0,c[q>>2]|0,32)|0;e=C;j=ab(0,c[o>>2]|0,32)|0;f=lb(j|0,C|0,u|0,e|0)|0;e=C;u=ab(0,c[r>>2]|0,32)|0;j=C;b=ab(0,c[k>>2]|0,32)|0;w=lb(b|0,C|0,u|0,j|0)|0;j=cb(w|0,C|0,f|0,e|0)|0;e=C;f=ab(0,c[i>>2]|0,32)|0;w=C;u=ab(0,c[v>>2]|0,32)|0;b=lb(u|0,C|0,f|0,w|0)|0;w=cb(j|0,e|0,b|0,C|0)|0;b=C;e=ab(0,c[t>>2]|0,32)|0;j=C;f=ab(0,c[m>>2]|0,32)|0;u=lb(f|0,C|0,e|0,j|0)|0;j=cb(w|0,b|0,u|0,C|0)|0;u=C;b=ab(0,c[h>>2]|0,32)|0;w=C;e=ab(0,c[s>>2]|0,32)|0;f=lb(e|0,C|0,b|0,w|0)|0;w=cb(j|0,u|0,f|0,C|0)|0;f=C;u=ab(0,c[y>>2]|0,32)|0;j=C;b=ab(0,c[n>>2]|0,32)|0;e=lb(b|0,C|0,u|0,j|0)|0;j=cb(w|0,f|0,e|0,C|0)|0;e=C;f=ab(0,c[l>>2]|0,32)|0;l=C;w=ab(0,c[z>>2]|0,32)|0;u=lb(w|0,C|0,f|0,l|0)|0;l=cb(j|0,e|0,u|0,C|0)|0;u=C;e=ab(0,c[p>>2]|0,32)|0;j=C;f=ab(0,c[g>>2]|0,32)|0;g=lb(f|0,C|0,e|0,j|0)|0;j=cb(l|0,u|0,g|0,C|0)|0;g=a+88|0;c[g>>2]=j;c[g+4>>2]=C;g=ab(0,c[r>>2]|0,32)|0;j=C;u=ab(0,c[o>>2]|0,32)|0;l=lb(u|0,C|0,g|0,j|0)|0;j=C;g=ab(0,c[q>>2]|0,32)|0;u=C;e=ab(0,c[v>>2]|0,32)|0;f=lb(e|0,C|0,g|0,u|0)|0;u=C;g=ab(0,c[t>>2]|0,32)|0;e=C;w=ab(0,c[k>>2]|0,32)|0;b=lb(w|0,C|0,g|0,e|0)|0;e=cb(b|0,C|0,f|0,u|0)|0;u=C;f=ab(0,c[h>>2]|0,32)|0;h=C;b=ab(0,c[z>>2]|0,32)|0;g=lb(b|0,C|0,f|0,h|0)|0;h=cb(e|0,u|0,g|0,C|0)|0;g=C;u=ab(0,c[p>>2]|0,32)|0;e=C;f=ab(0,c[n>>2]|0,32)|0;n=lb(f|0,C|0,u|0,e|0)|0;e=cb(h|0,g|0,n|0,C|0)|0;n=fb(e|0,C|0,1)|0;e=cb(n|0,C|0,l|0,j|0)|0;j=C;l=ab(0,c[i>>2]|0,32)|0;n=C;g=ab(0,c[s>>2]|0,32)|0;h=lb(g|0,C|0,l|0,n|0)|0;n=cb(e|0,j|0,h|0,C|0)|0;h=C;j=ab(0,c[y>>2]|0,32)|0;e=C;l=ab(0,c[m>>2]|0,32)|0;g=lb(l|0,C|0,j|0,e|0)|0;e=cb(n|0,h|0,g|0,C|0)|0;g=a+96|0;c[g>>2]=e;c[g+4>>2]=C;g=ab(0,c[r>>2]|0,32)|0;e=C;h=ab(0,c[v>>2]|0,32)|0;n=lb(h|0,C|0,g|0,e|0)|0;e=C;g=ab(0,c[t>>2]|0,32)|0;h=C;j=ab(0,c[o>>2]|0,32)|0;l=lb(j|0,C|0,g|0,h|0)|0;h=cb(l|0,C|0,n|0,e|0)|0;e=C;n=ab(0,c[q>>2]|0,32)|0;l=C;g=ab(0,c[s>>2]|0,32)|0;j=lb(g|0,C|0,n|0,l|0)|0;l=cb(h|0,e|0,j|0,C|0)|0;j=C;e=ab(0,c[y>>2]|0,32)|0;h=C;n=ab(0,c[k>>2]|0,32)|0;g=lb(n|0,C|0,e|0,h|0)|0;h=cb(l|0,j|0,g|0,C|0)|0;g=C;j=ab(0,c[i>>2]|0,32)|0;i=C;l=ab(0,c[z>>2]|0,32)|0;e=lb(l|0,C|0,j|0,i|0)|0;i=cb(h|0,g|0,e|0,C|0)|0;e=C;g=ab(0,c[p>>2]|0,32)|0;h=C;j=ab(0,c[m>>2]|0,32)|0;m=lb(j|0,C|0,g|0,h|0)|0;h=cb(i|0,e|0,m|0,C|0)|0;m=a+104|0;c[m>>2]=h;c[m+4>>2]=C;m=ab(0,c[t>>2]|0,32)|0;h=C;e=ab(0,c[v>>2]|0,32)|0;i=lb(e|0,C|0,m|0,h|0)|0;h=C;m=ab(0,c[q>>2]|0,32)|0;q=C;e=ab(0,c[z>>2]|0,32)|0;g=lb(e|0,C|0,m|0,q|0)|0;q=cb(g|0,C|0,i|0,h|0)|0;h=C;i=ab(0,c[p>>2]|0,32)|0;g=C;m=ab(0,c[k>>2]|0,32)|0;k=lb(m|0,C|0,i|0,g|0)|0;g=cb(q|0,h|0,k|0,C|0)|0;k=fb(g|0,C|0,1)|0;g=C;h=ab(0,c[r>>2]|0,32)|0;q=C;i=ab(0,c[s>>2]|0,32)|0;m=lb(i|0,C|0,h|0,q|0)|0;q=cb(k|0,g|0,m|0,C|0)|0;m=C;g=ab(0,c[y>>2]|0,32)|0;k=C;h=ab(0,c[o>>2]|0,32)|0;i=lb(h|0,C|0,g|0,k|0)|0;k=cb(q|0,m|0,i|0,C|0)|0;i=a+112|0;c[i>>2]=k;c[i+4>>2]=C;i=ab(0,c[t>>2]|0,32)|0;k=C;m=ab(0,c[s>>2]|0,32)|0;q=lb(m|0,C|0,i|0,k|0)|0;k=C;i=ab(0,c[y>>2]|0,32)|0;m=C;g=ab(0,c[v>>2]|0,32)|0;h=lb(g|0,C|0,i|0,m|0)|0;m=cb(h|0,C|0,q|0,k|0)|0;k=C;q=ab(0,c[r>>2]|0,32)|0;r=C;h=ab(0,c[z>>2]|0,32)|0;i=lb(h|0,C|0,q|0,r|0)|0;r=cb(m|0,k|0,i|0,C|0)|0;i=C;k=ab(0,c[p>>2]|0,32)|0;m=C;q=ab(0,c[o>>2]|0,32)|0;o=lb(q|0,C|0,k|0,m|0)|0;m=cb(r|0,i|0,o|0,C|0)|0;o=a+120|0;c[o>>2]=m;c[o+4>>2]=C;o=ab(0,c[y>>2]|0,32)|0;m=C;i=ab(0,c[s>>2]|0,32)|0;r=lb(i|0,C|0,o|0,m|0)|0;m=C;o=ab(0,c[t>>2]|0,32)|0;t=C;i=ab(0,c[z>>2]|0,32)|0;k=lb(i|0,C|0,o|0,t|0)|0;t=C;o=ab(0,c[p>>2]|0,32)|0;i=C;q=ab(0,c[v>>2]|0,32)|0;v=lb(q|0,C|0,o|0,i|0)|0;i=cb(v|0,C|0,k|0,t|0)|0;t=fb(i|0,C|0,1)|0;i=cb(t|0,C|0,r|0,m|0)|0;m=a+128|0;c[m>>2]=i;c[m+4>>2]=C;m=ab(0,c[y>>2]|0,32)|0;y=C;i=ab(0,c[z>>2]|0,32)|0;r=lb(i|0,C|0,m|0,y|0)|0;y=C;m=ab(0,c[p>>2]|0,32)|0;i=C;t=ab(0,c[s>>2]|0,32)|0;s=lb(t|0,C|0,m|0,i|0)|0;i=cb(s|0,C|0,r|0,y|0)|0;y=a+136|0;c[y>>2]=i;c[y+4>>2]=C;y=ab(0,c[p>>2]|0,31)|0;p=C;i=ab(0,c[z>>2]|0,32)|0;z=lb(i|0,C|0,y|0,p|0)|0;p=a+144|0;c[p>>2]=z;c[p+4>>2]=C;return}function Na(a,b){a=a|0;b=b|0;var d=0,e=0,f=0,g=0,h=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0,t=0,u=0,v=0,w=0,x=0,y=0,z=0,A=0,B=0,D=0,E=0,F=0,G=0,H=0,I=0,J=0,K=0,L=0,M=0,N=0,O=0,P=0,Q=0,R=0,S=0;d=i;i=i+160|0;e=d;f=c[b>>2]|0;g=ab(0,f|0,32)|0;h=C;j=lb(g|0,h|0,g|0,h|0)|0;k=e;c[k>>2]=j;c[k+4>>2]=C;k=ab(0,f|0,31)|0;f=C;j=b+8|0;l=c[j>>2]|0;m=ab(0,l|0,32)|0;n=C;o=lb(m|0,n|0,k|0,f|0)|0;p=e+8|0;q=p;c[q>>2]=o;c[q+4>>2]=C;q=lb(m|0,n|0,m|0,n|0)|0;o=C;r=b+16|0;s=ab(0,c[r>>2]|0,32)|0;t=C;u=lb(s|0,t|0,g|0,h|0)|0;v=cb(u|0,C|0,q|0,o|0)|0;o=fb(v|0,C|0,1)|0;v=e+16|0;q=v;c[q>>2]=o;c[q+4>>2]=C;q=lb(s|0,t|0,m|0,n|0)|0;o=C;u=b+24|0;w=ab(0,c[u>>2]|0,32)|0;x=C;y=lb(w|0,x|0,g|0,h|0)|0;z=cb(y|0,C|0,q|0,o|0)|0;o=fb(z|0,C|0,1)|0;z=e+24|0;q=z;c[q>>2]=o;c[q+4>>2]=C;q=lb(s|0,t|0,s|0,t|0)|0;o=C;y=ab(0,l|0,30)|0;A=lb(w|0,x|0,y|0,C|0)|0;y=cb(A|0,C|0,q|0,o|0)|0;o=C;q=b+32|0;A=ab(0,c[q>>2]|0,32)|0;B=C;D=lb(A|0,B|0,k|0,f|0)|0;f=cb(y|0,o|0,D|0,C|0)|0;D=e+32|0;o=D;c[o>>2]=f;c[o+4>>2]=C;o=lb(w|0,x|0,s|0,t|0)|0;f=C;y=lb(A|0,B|0,m|0,n|0)|0;k=cb(y|0,C|0,o|0,f|0)|0;f=C;o=b+40|0;y=ab(0,c[o>>2]|0,32)|0;E=C;F=lb(y|0,E|0,g|0,h|0)|0;G=cb(k|0,f|0,F|0,C|0)|0;F=fb(G|0,C|0,1)|0;G=e+40|0;f=G;c[f>>2]=F;c[f+4>>2]=C;f=lb(w|0,x|0,w|0,x|0)|0;F=C;k=lb(A|0,B|0,s|0,t|0)|0;H=cb(k|0,C|0,f|0,F|0)|0;F=C;f=b+48|0;k=ab(0,c[f>>2]|0,32)|0;I=C;J=lb(k|0,I|0,g|0,h|0)|0;K=cb(H|0,F|0,J|0,C|0)|0;J=C;F=ab(0,l|0,31)|0;l=lb(y|0,E|0,F|0,C|0)|0;F=cb(K|0,J|0,l|0,C|0)|0;l=fb(F|0,C|0,1)|0;F=e+48|0;J=F;c[J>>2]=l;c[J+4>>2]=C;J=lb(A|0,B|0,w|0,x|0)|0;l=C;K=lb(y|0,E|0,s|0,t|0)|0;H=cb(K|0,C|0,J|0,l|0)|0;l=C;J=lb(k|0,I|0,m|0,n|0)|0;K=cb(H|0,l|0,J|0,C|0)|0;J=C;l=b+56|0;H=ab(0,c[l>>2]|0,32)|0;L=C;M=lb(H|0,L|0,g|0,h|0)|0;N=cb(K|0,J|0,M|0,C|0)|0;M=fb(N|0,C|0,1)|0;N=e+56|0;J=N;c[J>>2]=M;c[J+4>>2]=C;J=lb(A|0,B|0,A|0,B|0)|0;M=C;K=lb(k|0,I|0,s|0,t|0)|0;O=C;P=b+64|0;Q=ab(0,c[P>>2]|0,32)|0;R=C;S=lb(Q|0,R|0,g|0,h|0)|0;h=cb(S|0,C|0,K|0,O|0)|0;O=C;K=lb(H|0,L|0,m|0,n|0)|0;n=C;m=lb(y|0,E|0,w|0,x|0)|0;S=cb(m|0,C|0,K|0,n|0)|0;n=fb(S|0,C|0,1)|0;S=cb(h|0,O|0,n|0,C|0)|0;n=fb(S|0,C|0,1)|0;S=cb(n|0,C|0,J|0,M|0)|0;M=e+64|0;J=M;c[J>>2]=S;c[J+4>>2]=C;J=lb(y|0,E|0,A|0,B|0)|0;S=C;n=lb(k|0,I|0,w|0,x|0)|0;x=cb(n|0,C|0,J|0,S|0)|0;S=C;J=lb(H|0,L|0,s|0,t|0)|0;t=cb(x|0,S|0,J|0,C|0)|0;J=C;S=ab(0,c[j>>2]|0,32)|0;j=C;x=lb(Q|0,R|0,S|0,j|0)|0;s=cb(t|0,J|0,x|0,C|0)|0;x=C;J=ab(0,c[b>>2]|0,32)|0;t=C;n=c[b+72>>2]|0;b=ab(0,n|0,32)|0;w=C;O=lb(b|0,w|0,J|0,t|0)|0;t=cb(s|0,x|0,O|0,C|0)|0;O=fb(t|0,C|0,1)|0;t=e+72|0;c[t>>2]=O;c[t+4>>2]=C;t=lb(y|0,E|0,y|0,E|0)|0;O=C;x=lb(k|0,I|0,A|0,B|0)|0;B=cb(x|0,C|0,t|0,O|0)|0;O=C;t=ab(0,c[r>>2]|0,32)|0;r=C;x=lb(Q|0,R|0,t|0,r|0)|0;A=cb(B|0,O|0,x|0,C|0)|0;x=C;O=ab(0,c[u>>2]|0,32)|0;u=C;B=lb(H|0,L|0,O|0,u|0)|0;s=C;J=lb(b|0,w|0,S|0,j|0)|0;j=cb(J|0,C|0,B|0,s|0)|0;s=fb(j|0,C|0,1)|0;j=cb(A|0,x|0,s|0,C|0)|0;s=fb(j|0,C|0,1)|0;j=e+80|0;x=j;c[x>>2]=s;c[x+4>>2]=C;x=lb(k|0,I|0,y|0,E|0)|0;E=C;y=ab(0,c[q>>2]|0,32)|0;q=C;s=lb(H|0,L|0,y|0,q|0)|0;A=cb(s|0,C|0,x|0,E|0)|0;E=C;x=lb(Q|0,R|0,O|0,u|0)|0;s=cb(A|0,E|0,x|0,C|0)|0;x=C;E=lb(b|0,w|0,t|0,r|0)|0;r=cb(s|0,x|0,E|0,C|0)|0;E=C;x=fb(r|0,E|0,1)|0;s=C;t=e+88|0;c[t>>2]=x;c[t+4>>2]=s;t=lb(k|0,I|0,k|0,I|0)|0;I=C;k=lb(Q|0,R|0,y|0,q|0)|0;A=C;B=c[o>>2]|0;o=ab(0,B|0,32)|0;J=C;S=lb(H|0,L|0,o|0,J|0)|0;h=C;K=lb(b|0,w|0,O|0,u|0)|0;u=cb(K|0,C|0,S|0,h|0)|0;h=fb(u|0,C|0,1)|0;u=cb(h|0,C|0,k|0,A|0)|0;A=fb(u|0,C|0,1)|0;u=cb(A|0,C|0,t|0,I|0)|0;I=C;t=e+96|0;c[t>>2]=u;c[t+4>>2]=I;t=ab(0,c[f>>2]|0,32)|0;f=C;A=lb(H|0,L|0,t|0,f|0)|0;L=C;H=lb(Q|0,R|0,o|0,J|0)|0;J=cb(H|0,C|0,A|0,L|0)|0;L=C;A=lb(b|0,w|0,y|0,q|0)|0;q=cb(J|0,L|0,A|0,C|0)|0;A=C;L=fb(q|0,A|0,1)|0;J=C;y=e+104|0;c[y>>2]=L;c[y+4>>2]=J;y=c[l>>2]|0;l=ab(0,y|0,32)|0;H=C;o=lb(l|0,H|0,l|0,H|0)|0;k=C;h=lb(Q|0,R|0,t|0,f|0)|0;R=cb(h|0,C|0,o|0,k|0)|0;k=C;o=ab(0,B|0,31)|0;B=lb(b|0,w|0,o|0,C|0)|0;o=cb(R|0,k|0,B|0,C|0)|0;B=C;k=fb(o|0,B|0,1)|0;R=C;h=e+112|0;c[h>>2]=k;c[h+4>>2]=R;h=c[P>>2]|0;P=ab(0,h|0,32)|0;Q=C;S=lb(P|0,Q|0,l|0,H|0)|0;H=C;l=lb(b|0,w|0,t|0,f|0)|0;f=cb(l|0,C|0,S|0,H|0)|0;H=C;S=fb(f|0,H|0,1)|0;l=C;t=e+120|0;c[t>>2]=S;c[t+4>>2]=l;t=lb(P|0,Q|0,P|0,Q|0)|0;Q=C;P=ab(0,y|0,30)|0;y=lb(b|0,w|0,P|0,C|0)|0;P=cb(y|0,C|0,t|0,Q|0)|0;Q=C;t=e+128|0;c[t>>2]=P;c[t+4>>2]=Q;t=ab(0,h|0,31)|0;h=lb(b|0,w|0,t|0,C|0)|0;t=C;y=e+136|0;c[y>>2]=h;c[y+4>>2]=t;y=ab(0,n|0,31)|0;n=lb(y|0,C|0,b|0,w|0)|0;w=C;b=e+144|0;c[b>>2]=n;c[b+4>>2]=w;b=M;y=c[b>>2]|0;K=c[b+4>>2]|0;b=lb(n|0,w|0,18,0)|0;O=C;m=cb(n|0,w|0,y|0,K|0)|0;K=cb(m|0,C|0,b|0,O|0)|0;O=M;c[O>>2]=K;c[O+4>>2]=C;O=N;K=c[O>>2]|0;M=c[O+4>>2]|0;O=lb(h|0,t|0,18,0)|0;b=C;m=cb(K|0,M|0,h|0,t|0)|0;t=cb(m|0,C|0,O|0,b|0)|0;b=N;c[b>>2]=t;c[b+4>>2]=C;b=F;t=c[b>>2]|0;N=c[b+4>>2]|0;b=lb(P|0,Q|0,18,0)|0;O=C;m=cb(t|0,N|0,P|0,Q|0)|0;Q=cb(m|0,C|0,b|0,O|0)|0;O=F;c[O>>2]=Q;c[O+4>>2]=C;O=G;Q=c[O>>2]|0;F=c[O+4>>2]|0;O=lb(f|0,H|0,36,0)|0;H=C;f=cb(Q|0,F|0,S|0,l|0)|0;l=cb(f|0,C|0,O|0,H|0)|0;H=G;c[H>>2]=l;c[H+4>>2]=C;H=D;l=c[H>>2]|0;G=c[H+4>>2]|0;H=lb(o|0,B|0,36,0)|0;B=C;o=cb(l|0,G|0,k|0,R|0)|0;R=cb(o|0,C|0,H|0,B|0)|0;B=D;c[B>>2]=R;c[B+4>>2]=C;B=z;R=c[B>>2]|0;D=c[B+4>>2]|0;B=lb(q|0,A|0,36,0)|0;A=C;q=cb(R|0,D|0,L|0,J|0)|0;J=cb(q|0,C|0,B|0,A|0)|0;A=z;c[A>>2]=J;c[A+4>>2]=C;A=v;J=c[A>>2]|0;z=c[A+4>>2]|0;A=lb(u|0,I|0,18,0)|0;B=C;q=cb(J|0,z|0,u|0,I|0)|0;I=cb(q|0,C|0,A|0,B|0)|0;B=v;c[B>>2]=I;c[B+4>>2]=C;B=p;I=c[B>>2]|0;v=c[B+4>>2]|0;B=lb(r|0,E|0,36,0)|0;E=C;r=cb(I|0,v|0,x|0,s|0)|0;s=cb(r|0,C|0,B|0,E|0)|0;E=p;c[E>>2]=s;c[E+4>>2]=C;E=j;s=c[E>>2]|0;B=c[E+4>>2]|0;E=e;r=c[E>>2]|0;x=c[E+4>>2]|0;E=lb(s|0,B|0,18,0)|0;v=C;I=cb(r|0,x|0,s|0,B|0)|0;B=cb(I|0,C|0,E|0,v|0)|0;v=C;E=e;c[E>>2]=B;c[E+4>>2]=v;E=j;c[E>>2]=0;c[E+4>>2]=0;E=v;v=B;B=0;do I=cb(E>>31>>>6|0,0,v|0,E|0)|0,s=ab(I|0,C|0,26)|0,I=C,x=fb(s|0,I|0,26)|0,r=bb(v|0,E|0,x|0,C|0)|0,x=e+(B<<3)|0,c[x>>2]=r,c[x+4>>2]=C,x=e+((B|1)<<3)|0,r=x,A=cb(s|0,I|0,c[r>>2]|0,c[r+4>>2]|0)|0,r=C,I=cb(r>>31>>>7|0,0,A|0,r|0)|0,s=ab(I|0,C|0,25)|0,I=C,q=fb(s|0,I|0,25)|0,u=bb(A|0,r|0,q|0,C|0)|0,q=x,c[q>>2]=u,c[q+4>>2]=C,B=B+2|0,q=e+(B<<3)|0,u=q,v=cb(s|0,I|0,c[u>>2]|0,c[u+4>>2]|0)|0,E=C,u=q,c[u>>2]=v,c[u+4>>2]=E;while(B>>>0<10);B=j;E=c[B>>2]|0;v=c[B+4>>2]|0;B=e;u=c[B>>2]|0;q=c[B+4>>2]|0;B=lb(E|0,v|0,18,0)|0;I=C;s=cb(u|0,q|0,E|0,v|0)|0;v=cb(s|0,C|0,B|0,I|0)|0;I=C;B=j;c[B>>2]=0;c[B+4>>2]=0;B=cb(I>>31>>>6|0,0,v|0,I|0)|0;j=ab(B|0,C|0,26)|0;B=C;s=fb(j|0,B|0,26)|0;E=bb(v|0,I|0,s|0,C|0)|0;s=e;c[s>>2]=E;c[s+4>>2]=C;s=p;E=cb(j|0,B|0,c[s>>2]|0,c[s+4>>2]|0)|0;s=p;c[s>>2]=E;c[s+4>>2]=C;s=a;a=e;e=s+80|0;do c[s>>2]=c[a>>2],s=s+4|0,a=a+4|0;while((s|0)<(e|0));i=d;return}function Oa(){var a=0;!(c[2]|0)?a=56:a=c[(ja()|0)+60>>2]|0;return a|0}function Pa(a){a=a|0;var b=0;a>>>0>4294963200?(c[(Oa()|0)>>2]=0-a,b=-1):b=a;return b|0}function Qa(a){a=a|0;return 0}function Ra(a){a=a|0;return}function Sa(a){a=a|0;var b=0,d=0;b=i;i=i+16|0;d=b;c[d>>2]=c[a+60>>2];a=Pa(ka(6,d|0)|0)|0;i=b;return a|0}function Ta(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0,g=0,h=0;e=i;i=i+32|0;f=e;g=e+20|0;c[f>>2]=c[a+60>>2];c[f+4>>2]=0;c[f+8>>2]=b;c[f+12>>2]=g;c[f+16>>2]=d;(Pa(ta(140,f|0)|0)|0)<0?(c[g>>2]=-1,h=-1):h=c[g>>2]|0;i=e;return h|0}function Ua(a,b,d){a=a|0;b=b|0;d=d|0;var e=0,f=0,g=0,h=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0,t=0,u=0,v=0,w=0,x=0,y=0,z=0;e=i;i=i+48|0;f=e+16|0;g=e;h=e+32|0;j=a+28|0;k=c[j>>2]|0;c[h>>2]=k;l=a+20|0;m=(c[l>>2]|0)-k|0;c[h+4>>2]=m;c[h+8>>2]=b;c[h+12>>2]=d;b=a+60|0;k=a+44|0;n=h;h=2;o=m+d|0;while(1){!(c[2]|0)?(c[f>>2]=c[b>>2],c[f+4>>2]=n,c[f+8>>2]=h,p=Pa(wa(146,f|0)|0)|0):(ua(1,a|0),c[g>>2]=c[b>>2],c[g+4>>2]=n,c[g+8>>2]=h,m=Pa(wa(146,g|0)|0)|0,ga(0),p=m);if((o|0)==(p|0)){q=6;break}if((p|0)<0){r=n;s=h;q=8;break}m=o-p|0;t=c[n+4>>2]|0;p>>>0<=t>>>0?(h|0)==2?(c[j>>2]=(c[j>>2]|0)+p,u=t,v=p,w=n,x=2):(u=t,v=p,w=n,x=h):(y=c[k>>2]|0,c[j>>2]=y,c[l>>2]=y,u=c[n+12>>2]|0,v=p-t|0,w=n+8|0,x=h+-1|0);c[w>>2]=(c[w>>2]|0)+v;c[w+4>>2]=u-v;n=w;h=x;o=m}(q|0)==6?(o=c[k>>2]|0,c[a+16>>2]=o+(c[a+48>>2]|0),k=o,c[j>>2]=k,c[l>>2]=k,z=d):(q|0)==8&&(c[a+16>>2]=0,c[j>>2]=0,c[l>>2]=0,c[a>>2]=c[a>>2]|32,(s|0)==2?z=0:z=d-(c[r+4>>2]|0)|0);i=e;return z|0}function Va(b,d,e){b=b|0;d=d|0;e=e|0;var f=0,g=0;f=i;i=i+80|0;g=f;c[b+36>>2]=3;((c[b>>2]&64|0)==0?(c[g>>2]=c[b+60>>2],c[g+4>>2]=21505,c[g+8>>2]=f+12,(ra(54,g|0)|0)!=0):0)&&(a[b+75>>0]=-1);g=Ua(b,d,e)|0;i=f;return g|0}function Wa(a){a=a|0;var b=0,d=0,e=0,f=0,g=0,h=0,i=0;do if(a){if((c[a+76>>2]|0)<=-1){b=Ya(a)|0;break}d=(Qa(a)|0)==0;e=Ya(a)|0;d?b=e:(Ra(a),b=e)}else{!(c[13]|0)?f=0:f=Wa(c[13]|0)|0;ha(36);e=c[8]|0;if(!e)g=f;else{d=e;e=f;while(1){(c[d+76>>2]|0)>-1?h=Qa(d)|0:h=0;(c[d+20>>2]|0)>>>0>(c[d+28>>2]|0)>>>0?i=Ya(d)|0|e:i=e;h&&Ra(d);d=c[d+56>>2]|0;if(!d){g=i;break}else e=i}}sa(36);b=g}while(0);return b|0}function Xa(a){a=a|0;c[a+68>>2]|0||Ra(a);return}function Ya(a){a=a|0;var b=0,d=0,e=0,f=0,g=0,h=0,i=0;b=a+20|0;d=a+28|0;((c[b>>2]|0)>>>0>(c[d>>2]|0)>>>0?(za[c[a+36>>2]&3](a,0,0)|0,(c[b>>2]|0)==0):0)?e=-1:(f=a+4|0,g=c[f>>2]|0,h=a+8|0,i=c[h>>2]|0,g>>>0<i>>>0&&za[c[a+40>>2]&3](a,g-i|0,1)|0,c[a+16>>2]=0,c[d>>2]=0,c[b>>2]=0,c[h>>2]=0,c[f>>2]=0,e=0);return e|0}function Za(a){a=a|0;var b=0,d=0,e=0,f=0,g=0,h=0,i=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0,t=0,u=0,v=0,w=0,x=0,y=0,z=0,A=0,B=0,C=0,D=0,E=0,F=0,G=0,H=0,I=0,J=0,K=0,L=0,M=0,N=0,O=0,P=0,Q=0,R=0,S=0,T=0,U=0,V=0,W=0,X=0,Y=0,Z=0,_=0,$=0,aa=0,ba=0,ca=0,da=0,ea=0,fa=0,ga=0,ha=0,ia=0,ja=0,ka=0,la=0,pa=0,qa=0,ra=0,sa=0,ta=0,ua=0,wa=0,xa=0,ya=0,za=0,Aa=0,Ba=0,Ca=0,Da=0,Ea=0,Fa=0,Ga=0,Ha=0,Ia=0,Ja=0,Ka=0,La=0,Ma=0,Na=0,Pa=0,Qa=0,Ra=0;do if(a>>>0<245){b=a>>>0<11?16:a+11&-8;d=b>>>3;e=c[43]|0;f=e>>>d;if(f&3){g=(f&1^1)+d|0;h=212+(g<<1<<2)|0;i=h+8|0;j=c[i>>2]|0;k=j+8|0;l=c[k>>2]|0;do if((h|0)!=(l|0)){l>>>0<(c[47]|0)>>>0&&ma();m=l+12|0;if((c[m>>2]|0)==(j|0)){c[m>>2]=h;c[i>>2]=l;break}else ma()}else c[43]=e&~(1<<g);while(0);l=g<<3;c[j+4>>2]=l|3;i=j+l+4|0;c[i>>2]=c[i>>2]|1;n=k;return n|0}i=c[45]|0;if(b>>>0>i>>>0){if(f){l=2<<d;h=f<<d&(l|0-l);l=(h&0-h)+-1|0;h=l>>>12&16;m=l>>>h;l=m>>>5&8;o=m>>>l;m=o>>>2&4;p=o>>>m;o=p>>>1&2;q=p>>>o;p=q>>>1&1;r=(l|h|m|o|p)+(q>>>p)|0;p=212+(r<<1<<2)|0;q=p+8|0;o=c[q>>2]|0;m=o+8|0;h=c[m>>2]|0;do if((p|0)!=(h|0)){h>>>0<(c[47]|0)>>>0&&ma();l=h+12|0;if((c[l>>2]|0)==(o|0)){c[l>>2]=p;c[q>>2]=h;s=c[45]|0;break}else ma()}else c[43]=e&~(1<<r),s=i;while(0);i=(r<<3)-b|0;c[o+4>>2]=b|3;e=o+b|0;c[e+4>>2]=i|1;c[e+i>>2]=i;s&&(h=c[48]|0,q=s>>>3,p=212+(q<<1<<2)|0,d=c[43]|0,f=1<<q,d&f?(q=p+8|0,k=c[q>>2]|0,k>>>0<(c[47]|0)>>>0?ma():(t=q,u=k)):(c[43]=d|f,t=p+8|0,u=p),c[t>>2]=h,c[u+12>>2]=h,c[h+8>>2]=u,c[h+12>>2]=p);c[45]=i;c[48]=e;n=m;return n|0}e=c[44]|0;if(e){i=(e&0-e)+-1|0;e=i>>>12&16;p=i>>>e;i=p>>>5&8;h=p>>>i;p=h>>>2&4;f=h>>>p;h=f>>>1&2;d=f>>>h;f=d>>>1&1;k=c[476+((i|e|p|h|f)+(d>>>f)<<2)>>2]|0;f=(c[k+4>>2]&-8)-b|0;d=k;h=k;while(1){k=c[d+16>>2]|0;if(!k){p=c[d+20>>2]|0;if(!p){v=f;w=h;break}else x=p}else x=k;k=(c[x+4>>2]&-8)-b|0;p=k>>>0<f>>>0;f=p?k:f;d=x;h=p?x:h}h=c[47]|0;w>>>0<h>>>0&&ma();d=w+b|0;w>>>0>=d>>>0&&ma();f=c[w+24>>2]|0;m=c[w+12>>2]|0;do if((m|0)==(w|0)){o=w+20|0;r=c[o>>2]|0;if(!r){p=w+16|0;k=c[p>>2]|0;if(!k){y=0;break}else z=k,A=p}else z=r,A=o;while(1){o=z+20|0;r=c[o>>2]|0;if(r){z=r;A=o;continue}o=z+16|0;r=c[o>>2]|0;if(!r){B=z;C=A;break}else z=r,A=o}if(C>>>0<h>>>0)ma();else{c[C>>2]=0;y=B;break}}else{o=c[w+8>>2]|0;o>>>0<h>>>0&&ma();r=o+12|0;(c[r>>2]|0)!=(w|0)&&ma();p=m+8|0;if((c[p>>2]|0)==(w|0)){c[r>>2]=m;c[p>>2]=o;y=m;break}else ma()}while(0);do if(f){m=c[w+28>>2]|0;h=476+(m<<2)|0;if((w|0)==(c[h>>2]|0)){c[h>>2]=y;if(!y){c[44]=c[44]&~(1<<m);break}}else{f>>>0<(c[47]|0)>>>0&&ma();m=f+16|0;(c[m>>2]|0)==(w|0)?c[m>>2]=y:c[f+20>>2]=y;if(!y)break}m=c[47]|0;y>>>0<m>>>0&&ma();c[y+24>>2]=f;h=c[w+16>>2]|0;do if(h)if(h>>>0<m>>>0)ma();else{c[y+16>>2]=h;c[h+24>>2]=y;break}while(0);h=c[w+20>>2]|0;if(h)if(h>>>0<(c[47]|0)>>>0)ma();else{c[y+20>>2]=h;c[h+24>>2]=y;break}}while(0);v>>>0<16?(f=v+b|0,c[w+4>>2]=f|3,h=w+f+4|0,c[h>>2]=c[h>>2]|1):(c[w+4>>2]=b|3,c[d+4>>2]=v|1,c[d+v>>2]=v,h=c[45]|0,h&&(f=c[48]|0,m=h>>>3,h=212+(m<<1<<2)|0,o=c[43]|0,p=1<<m,o&p?(m=h+8|0,r=c[m>>2]|0,r>>>0<(c[47]|0)>>>0?ma():(D=m,E=r)):(c[43]=o|p,D=h+8|0,E=h),c[D>>2]=f,c[E+12>>2]=f,c[f+8>>2]=E,c[f+12>>2]=h),c[45]=v,c[48]=d);n=w+8|0;return n|0}else F=b}else F=b}else if(a>>>0<=4294967231){h=a+11|0;f=h&-8;p=c[44]|0;if(p){o=0-f|0;r=h>>>8;r?f>>>0>16777215?G=31:(h=(r+1048320|0)>>>16&8,m=r<<h,r=(m+520192|0)>>>16&4,k=m<<r,m=(k+245760|0)>>>16&2,e=14-(r|h|m)+(k<<m>>>15)|0,G=f>>>(e+7|0)&1|e<<1):G=0;e=c[476+(G<<2)>>2]|0;a:do if(!e)H=o,I=0,J=0,K=86;else{m=o;k=0;h=f<<((G|0)==31?0:25-(G>>>1)|0);r=e;i=0;while(1){q=c[r+4>>2]&-8;j=q-f|0;if(j>>>0<m>>>0)if((q|0)==(f|0)){L=j;M=r;N=r;K=90;break a}else O=j,P=r;else O=m,P=i;j=c[r+20>>2]|0;r=c[r+16+(h>>>31<<2)>>2]|0;q=(j|0)==0|(j|0)==(r|0)?k:j;j=(r|0)==0;if(j){H=O;I=q;J=P;K=86;break}else m=O,k=q,h=h<<(j&1^1),i=P}}while(0);if((K|0)==86){if((I|0)==0&(J|0)==0){e=2<<G;o=p&(e|0-e);if(!o){F=f;break}e=(o&0-o)+-1|0;o=e>>>12&16;b=e>>>o;e=b>>>5&8;d=b>>>e;b=d>>>2&4;i=d>>>b;d=i>>>1&2;h=i>>>d;i=h>>>1&1;Q=c[476+((e|o|b|d|i)+(h>>>i)<<2)>>2]|0}else Q=I;!Q?(R=H,S=J):(L=H,M=Q,N=J,K=90)}if((K|0)==90)while(1){K=0;i=(c[M+4>>2]&-8)-f|0;h=i>>>0<L>>>0;d=h?i:L;i=h?M:N;h=c[M+16>>2]|0;if(h){L=d;M=h;N=i;K=90;continue}M=c[M+20>>2]|0;if(!M){R=d;S=i;break}else L=d,N=i,K=90}if((S|0)!=0?R>>>0<((c[45]|0)-f|0)>>>0:0){p=c[47]|0;S>>>0<p>>>0&&ma();i=S+f|0;S>>>0>=i>>>0&&ma();d=c[S+24>>2]|0;h=c[S+12>>2]|0;do if((h|0)==(S|0)){b=S+20|0;o=c[b>>2]|0;if(!o){e=S+16|0;k=c[e>>2]|0;if(!k){T=0;break}else U=k,V=e}else U=o,V=b;while(1){b=U+20|0;o=c[b>>2]|0;if(o){U=o;V=b;continue}b=U+16|0;o=c[b>>2]|0;if(!o){W=U;X=V;break}else U=o,V=b}if(X>>>0<p>>>0)ma();else{c[X>>2]=0;T=W;break}}else{b=c[S+8>>2]|0;b>>>0<p>>>0&&ma();o=b+12|0;(c[o>>2]|0)!=(S|0)&&ma();e=h+8|0;if((c[e>>2]|0)==(S|0)){c[o>>2]=h;c[e>>2]=b;T=h;break}else ma()}while(0);do if(d){h=c[S+28>>2]|0;p=476+(h<<2)|0;if((S|0)==(c[p>>2]|0)){c[p>>2]=T;if(!T){c[44]=c[44]&~(1<<h);break}}else{d>>>0<(c[47]|0)>>>0&&ma();h=d+16|0;(c[h>>2]|0)==(S|0)?c[h>>2]=T:c[d+20>>2]=T;if(!T)break}h=c[47]|0;T>>>0<h>>>0&&ma();c[T+24>>2]=d;p=c[S+16>>2]|0;do if(p)if(p>>>0<h>>>0)ma();else{c[T+16>>2]=p;c[p+24>>2]=T;break}while(0);p=c[S+20>>2]|0;if(p)if(p>>>0<(c[47]|0)>>>0)ma();else{c[T+20>>2]=p;c[p+24>>2]=T;break}}while(0);do if(R>>>0>=16){c[S+4>>2]=f|3;c[i+4>>2]=R|1;c[i+R>>2]=R;d=R>>>3;if(R>>>0<256){p=212+(d<<1<<2)|0;h=c[43]|0;b=1<<d;h&b?(d=p+8|0,e=c[d>>2]|0,e>>>0<(c[47]|0)>>>0?ma():(Y=d,Z=e)):(c[43]=h|b,Y=p+8|0,Z=p);c[Y>>2]=i;c[Z+12>>2]=i;c[i+8>>2]=Z;c[i+12>>2]=p;break}p=R>>>8;p?R>>>0>16777215?_=31:(b=(p+1048320|0)>>>16&8,h=p<<b,p=(h+520192|0)>>>16&4,e=h<<p,h=(e+245760|0)>>>16&2,d=14-(p|b|h)+(e<<h>>>15)|0,_=R>>>(d+7|0)&1|d<<1):_=0;d=476+(_<<2)|0;c[i+28>>2]=_;h=i+16|0;c[h+4>>2]=0;c[h>>2]=0;h=c[44]|0;e=1<<_;if(!(h&e)){c[44]=h|e;c[d>>2]=i;c[i+24>>2]=d;c[i+12>>2]=i;c[i+8>>2]=i;break}e=R<<((_|0)==31?0:25-(_>>>1)|0);h=c[d>>2]|0;while(1){if((c[h+4>>2]&-8|0)==(R|0)){$=h;K=148;break}d=h+16+(e>>>31<<2)|0;b=c[d>>2]|0;if(!b){aa=d;ba=h;K=145;break}else e=e<<1,h=b}if((K|0)==145)if(aa>>>0<(c[47]|0)>>>0)ma();else{c[aa>>2]=i;c[i+24>>2]=ba;c[i+12>>2]=i;c[i+8>>2]=i;break}else if((K|0)==148){h=$+8|0;e=c[h>>2]|0;b=c[47]|0;if(e>>>0>=b>>>0&$>>>0>=b>>>0){c[e+12>>2]=i;c[h>>2]=i;c[i+8>>2]=e;c[i+12>>2]=$;c[i+24>>2]=0;break}else ma()}}else e=R+f|0,c[S+4>>2]=e|3,h=S+e+4|0,c[h>>2]=c[h>>2]|1;while(0);n=S+8|0;return n|0}else F=f}else F=f}else F=-1;while(0);S=c[45]|0;if(S>>>0>=F>>>0){R=S-F|0;$=c[48]|0;R>>>0>15?(ba=$+F|0,c[48]=ba,c[45]=R,c[ba+4>>2]=R|1,c[ba+R>>2]=R,c[$+4>>2]=F|3):(c[45]=0,c[48]=0,c[$+4>>2]=S|3,R=$+S+4|0,c[R>>2]=c[R>>2]|1);n=$+8|0;return n|0}$=c[46]|0;if($>>>0>F>>>0){R=$-F|0;c[46]=R;$=c[49]|0;S=$+F|0;c[49]=S;c[S+4>>2]=R|1;c[$+4>>2]=F|3;n=$+8|0;return n|0}do if(!(c[161]|0)){$=va(30)|0;if(!($+-1&$)){c[163]=$;c[162]=$;c[164]=-1;c[165]=-1;c[166]=0;c[154]=0;c[161]=(oa(0)|0)&-16^1431655768;break}else ma()}while(0);$=F+48|0;R=c[163]|0;S=F+47|0;ba=R+S|0;aa=0-R|0;R=ba&aa;if(R>>>0<=F>>>0){n=0;return n|0}_=c[153]|0;if((_|0)!=0?(Z=c[151]|0,Y=Z+R|0,Y>>>0<=Z>>>0|Y>>>0>_>>>0):0){n=0;return n|0}b:do if(!(c[154]&4)){_=c[49]|0;c:do if(_){Y=620;while(1){Z=c[Y>>2]|0;if(Z>>>0<=_>>>0?(T=Y+4|0,(Z+(c[T>>2]|0)|0)>>>0>_>>>0):0){ca=Y;da=T;break}Y=c[Y+8>>2]|0;if(!Y){K=173;break c}}Y=ba-(c[46]|0)&aa;if(Y>>>0<2147483647){T=na(Y|0)|0;if((T|0)==((c[ca>>2]|0)+(c[da>>2]|0)|0)){if((T|0)!=(-1|0)){ea=T;fa=Y;K=193;break b}}else ga=T,ha=Y,K=183}}else K=173;while(0);do if((K|0)==173?(_=na(0)|0,(_|0)!=(-1|0)):0){f=_;Y=c[162]|0;T=Y+-1|0;!(T&f)?ia=R:ia=R-f+(T+f&0-Y)|0;Y=c[151]|0;f=Y+ia|0;if(ia>>>0>F>>>0&ia>>>0<2147483647){T=c[153]|0;if((T|0)!=0?f>>>0<=Y>>>0|f>>>0>T>>>0:0)break;T=na(ia|0)|0;if((T|0)==(_|0)){ea=_;fa=ia;K=193;break b}else ga=T,ha=ia,K=183}}while(0);d:do if((K|0)==183){T=0-ha|0;do if($>>>0>ha>>>0&(ha>>>0<2147483647&(ga|0)!=(-1|0))?(_=c[163]|0,f=S-ha+_&0-_,f>>>0<2147483647):0)if((na(f|0)|0)==(-1|0)){na(T|0)|0;break d}else{ja=f+ha|0;break}else ja=ha;while(0);if((ga|0)!=(-1|0)){ea=ga;fa=ja;K=193;break b}}while(0);c[154]=c[154]|4;K=190}else K=190;while(0);((((K|0)==190?R>>>0<2147483647:0)?(ja=na(R|0)|0,R=na(0)|0,ja>>>0<R>>>0&((ja|0)!=(-1|0)&(R|0)!=(-1|0))):0)?(ga=R-ja|0,ga>>>0>(F+40|0)>>>0):0)&&(ea=ja,fa=ga,K=193);if((K|0)==193){ga=(c[151]|0)+fa|0;c[151]=ga;ga>>>0>(c[152]|0)>>>0&&(c[152]=ga);ga=c[49]|0;do if(ga){ja=620;do{R=c[ja>>2]|0;ha=ja+4|0;S=c[ha>>2]|0;if((ea|0)==(R+S|0)){ka=R;la=ha;pa=S;qa=ja;K=203;break}ja=c[ja+8>>2]|0}while((ja|0)!=0);if(((K|0)==203?(c[qa+12>>2]&8|0)==0:0)?ga>>>0<ea>>>0&ga>>>0>=ka>>>0:0){c[la>>2]=pa+fa;ja=ga+8|0;S=(ja&7|0)==0?0:0-ja&7;ja=ga+S|0;ha=fa-S+(c[46]|0)|0;c[49]=ja;c[46]=ha;c[ja+4>>2]=ha|1;c[ja+ha+4>>2]=40;c[50]=c[165];break}ha=c[47]|0;ea>>>0<ha>>>0?(c[47]=ea,ra=ea):ra=ha;ha=ea+fa|0;ja=620;while(1){if((c[ja>>2]|0)==(ha|0)){sa=ja;ta=ja;K=211;break}ja=c[ja+8>>2]|0;if(!ja){ua=620;break}}if((K|0)==211)if(!(c[ta+12>>2]&8)){c[sa>>2]=ea;ja=ta+4|0;c[ja>>2]=(c[ja>>2]|0)+fa;ja=ea+8|0;S=ea+((ja&7|0)==0?0:0-ja&7)|0;ja=ha+8|0;R=ha+((ja&7|0)==0?0:0-ja&7)|0;ja=S+F|0;$=R-S-F|0;c[S+4>>2]=F|3;do if((R|0)!=(ga|0)){if((R|0)==(c[48]|0)){ia=(c[45]|0)+$|0;c[45]=ia;c[48]=ja;c[ja+4>>2]=ia|1;c[ja+ia>>2]=ia;break}ia=c[R+4>>2]|0;if((ia&3|0)==1){da=ia&-8;ca=ia>>>3;e:do if(ia>>>0>=256){aa=c[R+24>>2]|0;ba=c[R+12>>2]|0;do if((ba|0)==(R|0)){T=R+16|0;f=T+4|0;_=c[f>>2]|0;if(!_){Y=c[T>>2]|0;if(!Y){wa=0;break}else xa=Y,ya=T}else xa=_,ya=f;while(1){f=xa+20|0;_=c[f>>2]|0;if(_){xa=_;ya=f;continue}f=xa+16|0;_=c[f>>2]|0;if(!_){za=xa;Aa=ya;break}else xa=_,ya=f}if(Aa>>>0<ra>>>0)ma();else{c[Aa>>2]=0;wa=za;break}}else{f=c[R+8>>2]|0;f>>>0<ra>>>0&&ma();_=f+12|0;(c[_>>2]|0)!=(R|0)&&ma();T=ba+8|0;if((c[T>>2]|0)==(R|0)){c[_>>2]=ba;c[T>>2]=f;wa=ba;break}else ma()}while(0);if(!aa)break;ba=c[R+28>>2]|0;f=476+(ba<<2)|0;do if((R|0)!=(c[f>>2]|0)){aa>>>0<(c[47]|0)>>>0&&ma();T=aa+16|0;(c[T>>2]|0)==(R|0)?c[T>>2]=wa:c[aa+20>>2]=wa;if(!wa)break e}else{c[f>>2]=wa;if(wa)break;c[44]=c[44]&~(1<<ba);break e}while(0);ba=c[47]|0;wa>>>0<ba>>>0&&ma();c[wa+24>>2]=aa;f=R+16|0;T=c[f>>2]|0;do if(T)if(T>>>0<ba>>>0)ma();else{c[wa+16>>2]=T;c[T+24>>2]=wa;break}while(0);T=c[f+4>>2]|0;if(!T)break;if(T>>>0<(c[47]|0)>>>0)ma();else{c[wa+20>>2]=T;c[T+24>>2]=wa;break}}else{T=c[R+8>>2]|0;ba=c[R+12>>2]|0;aa=212+(ca<<1<<2)|0;do if((T|0)!=(aa|0)){T>>>0<ra>>>0&&ma();if((c[T+12>>2]|0)==(R|0))break;ma()}while(0);if((ba|0)==(T|0)){c[43]=c[43]&~(1<<ca);break}do if((ba|0)==(aa|0))Ba=ba+8|0;else{ba>>>0<ra>>>0&&ma();f=ba+8|0;if((c[f>>2]|0)==(R|0)){Ba=f;break}ma()}while(0);c[T+12>>2]=ba;c[Ba>>2]=T}while(0);Ca=R+da|0;Da=da+$|0}else Ca=R,Da=$;ca=Ca+4|0;c[ca>>2]=c[ca>>2]&-2;c[ja+4>>2]=Da|1;c[ja+Da>>2]=Da;ca=Da>>>3;if(Da>>>0<256){ia=212+(ca<<1<<2)|0;aa=c[43]|0;f=1<<ca;do if(!(aa&f))c[43]=aa|f,Ea=ia+8|0,Fa=ia;else{ca=ia+8|0;_=c[ca>>2]|0;if(_>>>0>=(c[47]|0)>>>0){Ea=ca;Fa=_;break}ma()}while(0);c[Ea>>2]=ja;c[Fa+12>>2]=ja;c[ja+8>>2]=Fa;c[ja+12>>2]=ia;break}f=Da>>>8;do if(!f)Ga=0;else{if(Da>>>0>16777215){Ga=31;break}aa=(f+1048320|0)>>>16&8;da=f<<aa;_=(da+520192|0)>>>16&4;ca=da<<_;da=(ca+245760|0)>>>16&2;Y=14-(_|aa|da)+(ca<<da>>>15)|0;Ga=Da>>>(Y+7|0)&1|Y<<1}while(0);f=476+(Ga<<2)|0;c[ja+28>>2]=Ga;ia=ja+16|0;c[ia+4>>2]=0;c[ia>>2]=0;ia=c[44]|0;Y=1<<Ga;if(!(ia&Y)){c[44]=ia|Y;c[f>>2]=ja;c[ja+24>>2]=f;c[ja+12>>2]=ja;c[ja+8>>2]=ja;break}Y=Da<<((Ga|0)==31?0:25-(Ga>>>1)|0);ia=c[f>>2]|0;while(1){if((c[ia+4>>2]&-8|0)==(Da|0)){Ha=ia;K=281;break}f=ia+16+(Y>>>31<<2)|0;da=c[f>>2]|0;if(!da){Ia=f;Ja=ia;K=278;break}else Y=Y<<1,ia=da}if((K|0)==278)if(Ia>>>0<(c[47]|0)>>>0)ma();else{c[Ia>>2]=ja;c[ja+24>>2]=Ja;c[ja+12>>2]=ja;c[ja+8>>2]=ja;break}else if((K|0)==281){ia=Ha+8|0;Y=c[ia>>2]|0;da=c[47]|0;if(Y>>>0>=da>>>0&Ha>>>0>=da>>>0){c[Y+12>>2]=ja;c[ia>>2]=ja;c[ja+8>>2]=Y;c[ja+12>>2]=Ha;c[ja+24>>2]=0;break}else ma()}}else Y=(c[46]|0)+$|0,c[46]=Y,c[49]=ja,c[ja+4>>2]=Y|1;while(0);n=S+8|0;return n|0}else ua=620;while(1){ja=c[ua>>2]|0;if(ja>>>0<=ga>>>0?($=ja+(c[ua+4>>2]|0)|0,$>>>0>ga>>>0):0){Ka=$;break}ua=c[ua+8>>2]|0}S=Ka+-47|0;$=S+8|0;ja=S+(($&7|0)==0?0:0-$&7)|0;$=ga+16|0;S=ja>>>0<$>>>0?ga:ja;ja=S+8|0;R=ea+8|0;ha=(R&7|0)==0?0:0-R&7;R=ea+ha|0;Y=fa+-40-ha|0;c[49]=R;c[46]=Y;c[R+4>>2]=Y|1;c[R+Y+4>>2]=40;c[50]=c[165];Y=S+4|0;c[Y>>2]=27;c[ja>>2]=c[155];c[ja+4>>2]=c[156];c[ja+8>>2]=c[157];c[ja+12>>2]=c[158];c[155]=ea;c[156]=fa;c[158]=0;c[157]=ja;ja=S+24|0;do ja=ja+4|0,c[ja>>2]=7;while((ja+4|0)>>>0<Ka>>>0);if((S|0)!=(ga|0)){ja=S-ga|0;c[Y>>2]=c[Y>>2]&-2;c[ga+4>>2]=ja|1;c[S>>2]=ja;R=ja>>>3;if(ja>>>0<256){ha=212+(R<<1<<2)|0;ia=c[43]|0;da=1<<R;ia&da?(R=ha+8|0,f=c[R>>2]|0,f>>>0<(c[47]|0)>>>0?ma():(La=R,Ma=f)):(c[43]=ia|da,La=ha+8|0,Ma=ha);c[La>>2]=ga;c[Ma+12>>2]=ga;c[ga+8>>2]=Ma;c[ga+12>>2]=ha;break}ha=ja>>>8;ha?ja>>>0>16777215?Na=31:(da=(ha+1048320|0)>>>16&8,ia=ha<<da,ha=(ia+520192|0)>>>16&4,f=ia<<ha,ia=(f+245760|0)>>>16&2,R=14-(ha|da|ia)+(f<<ia>>>15)|0,Na=ja>>>(R+7|0)&1|R<<1):Na=0;R=476+(Na<<2)|0;c[ga+28>>2]=Na;c[ga+20>>2]=0;c[$>>2]=0;ia=c[44]|0;f=1<<Na;if(!(ia&f)){c[44]=ia|f;c[R>>2]=ga;c[ga+24>>2]=R;c[ga+12>>2]=ga;c[ga+8>>2]=ga;break}f=ja<<((Na|0)==31?0:25-(Na>>>1)|0);ia=c[R>>2]|0;while(1){if((c[ia+4>>2]&-8|0)==(ja|0)){Pa=ia;K=307;break}R=ia+16+(f>>>31<<2)|0;da=c[R>>2]|0;if(!da){Qa=R;Ra=ia;K=304;break}else f=f<<1,ia=da}if((K|0)==304)if(Qa>>>0<(c[47]|0)>>>0)ma();else{c[Qa>>2]=ga;c[ga+24>>2]=Ra;c[ga+12>>2]=ga;c[ga+8>>2]=ga;break}else if((K|0)==307){ia=Pa+8|0;f=c[ia>>2]|0;ja=c[47]|0;if(f>>>0>=ja>>>0&Pa>>>0>=ja>>>0){c[f+12>>2]=ga;c[ia>>2]=ga;c[ga+8>>2]=f;c[ga+12>>2]=Pa;c[ga+24>>2]=0;break}else ma()}}}else{f=c[47]|0;(f|0)==0|ea>>>0<f>>>0&&(c[47]=ea);c[155]=ea;c[156]=fa;c[158]=0;c[52]=c[161];c[51]=-1;f=0;do ia=212+(f<<1<<2)|0,c[ia+12>>2]=ia,c[ia+8>>2]=ia,f=f+1|0;while((f|0)!=32);f=ea+8|0;ia=(f&7|0)==0?0:0-f&7;f=ea+ia|0;ja=fa+-40-ia|0;c[49]=f;c[46]=ja;c[f+4>>2]=ja|1;c[f+ja+4>>2]=40;c[50]=c[165]}while(0);fa=c[46]|0;if(fa>>>0>F>>>0){ea=fa-F|0;c[46]=ea;fa=c[49]|0;ga=fa+F|0;c[49]=ga;c[ga+4>>2]=ea|1;c[fa+4>>2]=F|3;n=fa+8|0;return n|0}}c[(Oa()|0)>>2]=12;n=0;return n|0}function _a(a){a=a|0;var b=0,d=0,e=0,f=0,g=0,h=0,i=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0,t=0,u=0,v=0,w=0,x=0,y=0,z=0,A=0,B=0,C=0,D=0,E=0,F=0,G=0,H=0,I=0,J=0,K=0,L=0;if(!a)return;b=a+-8|0;d=c[47]|0;b>>>0<d>>>0&&ma();e=c[a+-4>>2]|0;a=e&3;(a|0)==1&&ma();f=e&-8;g=b+f|0;do if(!(e&1)){h=c[b>>2]|0;if(!a)return;i=b+(0-h)|0;j=h+f|0;i>>>0<d>>>0&&ma();if((i|0)==(c[48]|0)){k=g+4|0;l=c[k>>2]|0;if((l&3|0)!=3){m=i;n=j;break}c[45]=j;c[k>>2]=l&-2;c[i+4>>2]=j|1;c[i+j>>2]=j;return}l=h>>>3;if(h>>>0<256){h=c[i+8>>2]|0;k=c[i+12>>2]|0;o=212+(l<<1<<2)|0;(h|0)!=(o|0)&&(h>>>0<d>>>0&&ma(),(c[h+12>>2]|0)!=(i|0)&&ma());if((k|0)==(h|0)){c[43]=c[43]&~(1<<l);m=i;n=j;break}(k|0)!=(o|0)?(k>>>0<d>>>0&&ma(),o=k+8|0,(c[o>>2]|0)==(i|0)?p=o:ma()):p=k+8|0;c[h+12>>2]=k;c[p>>2]=h;m=i;n=j;break}h=c[i+24>>2]|0;k=c[i+12>>2]|0;do if((k|0)==(i|0)){o=i+16|0;l=o+4|0;q=c[l>>2]|0;if(!q){r=c[o>>2]|0;if(!r){s=0;break}else t=r,u=o}else t=q,u=l;while(1){l=t+20|0;q=c[l>>2]|0;if(q){t=q;u=l;continue}l=t+16|0;q=c[l>>2]|0;if(!q){v=t;w=u;break}else t=q,u=l}if(w>>>0<d>>>0)ma();else{c[w>>2]=0;s=v;break}}else{l=c[i+8>>2]|0;l>>>0<d>>>0&&ma();q=l+12|0;(c[q>>2]|0)!=(i|0)&&ma();o=k+8|0;if((c[o>>2]|0)==(i|0)){c[q>>2]=k;c[o>>2]=l;s=k;break}else ma()}while(0);if(h){k=c[i+28>>2]|0;l=476+(k<<2)|0;if((i|0)==(c[l>>2]|0)){c[l>>2]=s;if(!s){c[44]=c[44]&~(1<<k);m=i;n=j;break}}else{h>>>0<(c[47]|0)>>>0&&ma();k=h+16|0;(c[k>>2]|0)==(i|0)?c[k>>2]=s:c[h+20>>2]=s;if(!s){m=i;n=j;break}}k=c[47]|0;s>>>0<k>>>0&&ma();c[s+24>>2]=h;l=i+16|0;o=c[l>>2]|0;do if(o)if(o>>>0<k>>>0)ma();else{c[s+16>>2]=o;c[o+24>>2]=s;break}while(0);o=c[l+4>>2]|0;if(o)if(o>>>0<(c[47]|0)>>>0)ma();else{c[s+20>>2]=o;c[o+24>>2]=s;m=i;n=j;break}else m=i,n=j}else m=i,n=j}else m=b,n=f;while(0);m>>>0>=g>>>0&&ma();f=g+4|0;b=c[f>>2]|0;b&1||ma();if(!(b&2)){if((g|0)==(c[49]|0)){s=(c[46]|0)+n|0;c[46]=s;c[49]=m;c[m+4>>2]=s|1;if((m|0)!=(c[48]|0))return;c[48]=0;c[45]=0;return}if((g|0)==(c[48]|0)){s=(c[45]|0)+n|0;c[45]=s;c[48]=m;c[m+4>>2]=s|1;c[m+s>>2]=s;return}s=(b&-8)+n|0;d=b>>>3;do if(b>>>0>=256){v=c[g+24>>2]|0;w=c[g+12>>2]|0;do if((w|0)==(g|0)){u=g+16|0;t=u+4|0;p=c[t>>2]|0;if(!p){a=c[u>>2]|0;if(!a){x=0;break}else y=a,z=u}else y=p,z=t;while(1){t=y+20|0;p=c[t>>2]|0;if(p){y=p;z=t;continue}t=y+16|0;p=c[t>>2]|0;if(!p){A=y;B=z;break}else y=p,z=t}if(B>>>0<(c[47]|0)>>>0)ma();else{c[B>>2]=0;x=A;break}}else{t=c[g+8>>2]|0;t>>>0<(c[47]|0)>>>0&&ma();p=t+12|0;(c[p>>2]|0)!=(g|0)&&ma();u=w+8|0;if((c[u>>2]|0)==(g|0)){c[p>>2]=w;c[u>>2]=t;x=w;break}else ma()}while(0);if(v){w=c[g+28>>2]|0;j=476+(w<<2)|0;if((g|0)==(c[j>>2]|0)){c[j>>2]=x;if(!x){c[44]=c[44]&~(1<<w);break}}else{v>>>0<(c[47]|0)>>>0&&ma();w=v+16|0;(c[w>>2]|0)==(g|0)?c[w>>2]=x:c[v+20>>2]=x;if(!x)break}w=c[47]|0;x>>>0<w>>>0&&ma();c[x+24>>2]=v;j=g+16|0;i=c[j>>2]|0;do if(i)if(i>>>0<w>>>0)ma();else{c[x+16>>2]=i;c[i+24>>2]=x;break}while(0);i=c[j+4>>2]|0;if(i)if(i>>>0<(c[47]|0)>>>0)ma();else{c[x+20>>2]=i;c[i+24>>2]=x;break}}}else{i=c[g+8>>2]|0;w=c[g+12>>2]|0;v=212+(d<<1<<2)|0;(i|0)!=(v|0)&&(i>>>0<(c[47]|0)>>>0&&ma(),(c[i+12>>2]|0)!=(g|0)&&ma());if((w|0)==(i|0)){c[43]=c[43]&~(1<<d);break}(w|0)!=(v|0)?(w>>>0<(c[47]|0)>>>0&&ma(),v=w+8|0,(c[v>>2]|0)==(g|0)?C=v:ma()):C=w+8|0;c[i+12>>2]=w;c[C>>2]=i}while(0);c[m+4>>2]=s|1;c[m+s>>2]=s;if((m|0)==(c[48]|0)){c[45]=s;return}else D=s}else c[f>>2]=b&-2,c[m+4>>2]=n|1,c[m+n>>2]=n,D=n;n=D>>>3;if(D>>>0<256){b=212+(n<<1<<2)|0;f=c[43]|0;s=1<<n;f&s?(n=b+8|0,C=c[n>>2]|0,C>>>0<(c[47]|0)>>>0?ma():(E=n,F=C)):(c[43]=f|s,E=b+8|0,F=b);c[E>>2]=m;c[F+12>>2]=m;c[m+8>>2]=F;c[m+12>>2]=b;return}b=D>>>8;b?D>>>0>16777215?G=31:(F=(b+1048320|0)>>>16&8,E=b<<F,b=(E+520192|0)>>>16&4,s=E<<b,E=(s+245760|0)>>>16&2,f=14-(b|F|E)+(s<<E>>>15)|0,G=D>>>(f+7|0)&1|f<<1):G=0;f=476+(G<<2)|0;c[m+28>>2]=G;c[m+20>>2]=0;c[m+16>>2]=0;E=c[44]|0;s=1<<G;do if(E&s){F=D<<((G|0)==31?0:25-(G>>>1)|0);b=c[f>>2]|0;while(1){if((c[b+4>>2]&-8|0)==(D|0)){H=b;I=130;break}C=b+16+(F>>>31<<2)|0;n=c[C>>2]|0;if(!n){J=C;K=b;I=127;break}else F=F<<1,b=n}if((I|0)==127)if(J>>>0<(c[47]|0)>>>0)ma();else{c[J>>2]=m;c[m+24>>2]=K;c[m+12>>2]=m;c[m+8>>2]=m;break}else if((I|0)==130){b=H+8|0;F=c[b>>2]|0;j=c[47]|0;if(F>>>0>=j>>>0&H>>>0>=j>>>0){c[F+12>>2]=m;c[b>>2]=m;c[m+8>>2]=F;c[m+12>>2]=H;c[m+24>>2]=0;break}else ma()}}else c[44]=E|s,c[f>>2]=m,c[m+24>>2]=f,c[m+12>>2]=m,c[m+8>>2]=m;while(0);m=(c[51]|0)+-1|0;c[51]=m;if(!m)L=628;else return;while(1){m=c[L>>2]|0;if(!m)break;else L=m+8|0}c[51]=-1;return}function $a(){}function ab(a,b,c){a=a|0;b=b|0;c=c|0;if((c|0)<32){C=b>>c;return a>>>c|(b&(1<<c)-1)<<32-c}C=(b|0)<0?-1:0;return b>>c-32|0}function bb(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0;e=b-d>>>0;e=b-d-(c>>>0>a>>>0|0)>>>0;return(C=e,a-c>>>0|0)|0}function cb(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0;e=a+c>>>0;return(C=b+d+(e>>>0<a>>>0|0)>>>0,e|0)|0}function db(b,d,e){b=b|0;d=d|0;e=e|0;var f=0,g=0,h=0,i=0;f=b+e|0;if((e|0)>=20){d=d&255;g=b&3;h=d|d<<8|d<<16|d<<24;i=f&-4;if(g){g=b+4-g|0;while((b|0)<(g|0))a[b>>0]=d,b=b+1|0}while((b|0)<(i|0))c[b>>2]=h,b=b+4|0}while((b|0)<(f|0))a[b>>0]=d,b=b+1|0;return b-e|0}function eb(a,b,c){a=a|0;b=b|0;c=c|0;if((c|0)<32){C=b>>>c;return a>>>c|(b&(1<<c)-1)<<32-c}C=0;return b>>>c-32|0}function fb(a,b,c){a=a|0;b=b|0;c=c|0;if((c|0)<32){C=b<<c|(a&(1<<c)-1<<32-c)>>>32-c;return a<<c}C=a<<c-32;return 0}function gb(b,d,e){b=b|0;d=d|0;e=e|0;var f=0;if((e|0)>=4096)return qa(b|0,d|0,e|0)|0;f=b|0;if((b&3)==(d&3)){while(b&3){if(!e)return f|0;a[b>>0]=a[d>>0]|0;b=b+1|0;d=d+1|0;e=e-1|0}while((e|0)>=4)c[b>>2]=c[d>>2],b=b+4|0,d=d+4|0,e=e-4|0}while((e|0)>0)a[b>>0]=a[d>>0]|0,b=b+1|0,d=d+1|0,e=e-1|0;return f|0}function hb(b){b=b|0;var c=0;c=a[m+(b&255)>>0]|0;if((c|0)<8)return c|0;c=a[m+(b>>8&255)>>0]|0;if((c|0)<8)return c+8|0;c=a[m+(b>>16&255)>>0]|0;return(c|0)<8?c+16|0:(a[m+(b>>>24)>>0]|0)+24|0}function ib(a,b){a=a|0;b=b|0;var c=0,d=0,e=0,f=0;c=a&65535;d=b&65535;e=_(d,c)|0;f=a>>>16;a=(e>>>16)+(_(d,f)|0)|0;d=b>>>16;b=_(d,c)|0;return(C=(a>>>16)+(_(d,f)|0)+(((a&65535)+b|0)>>>16)|0,a+b<<16|e&65535|0)|0}function jb(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0,f=0,g=0,h=0,i=0;e=b>>31|((b|0)<0?-1:0)<<1;f=((b|0)<0?-1:0)>>31|((b|0)<0?-1:0)<<1;g=d>>31|((d|0)<0?-1:0)<<1;h=((d|0)<0?-1:0)>>31|((d|0)<0?-1:0)<<1;i=bb(e^a,f^b,e,f)|0;b=C;a=g^e;e=h^f;return bb((ob(i,b,bb(g^c,h^d,g,h)|0,C,0)|0)^a,C^e,a,e)|0}function kb(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0,g=0,h=0,j=0,k=0,l=0,m=0;f=i;i=i+16|0;g=f|0;h=b>>31|((b|0)<0?-1:0)<<1;j=((b|0)<0?-1:0)>>31|((b|0)<0?-1:0)<<1;k=e>>31|((e|0)<0?-1:0)<<1;l=((e|0)<0?-1:0)>>31|((e|0)<0?-1:0)<<1;m=bb(h^a,j^b,h,j)|0;b=C;ob(m,b,bb(k^d,l^e,k,l)|0,C,g)|0;l=bb(c[g>>2]^h,c[g+4>>2]^j,h,j)|0;j=C;i=f;return(C=j,l)|0}function lb(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;var e=0,f=0;e=a;a=c;c=ib(e,a)|0;f=C;return(C=(_(b,a)|0)+(_(d,e)|0)+f|f&0,c|0|0)|0}function mb(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;return ob(a,b,c,d,0)|0}function nb(a,b,d,e){a=a|0;b=b|0;d=d|0;e=e|0;var f=0,g=0;f=i;i=i+16|0;g=f|0;ob(a,b,d,e,g)|0;i=f;return(C=c[g+4>>2]|0,c[g>>2]|0)|0}function ob(a,b,d,e,f){a=a|0;b=b|0;d=d|0;e=e|0;f=f|0;var g=0,h=0,i=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0,t=0,u=0,v=0,w=0,x=0,y=0,z=0,A=0,B=0,D=0,E=0,F=0,G=0,H=0;g=a;h=b;i=h;j=d;k=e;l=k;if(!i){m=(f|0)!=0;if(!l){m&&(c[f>>2]=(g>>>0)%(j>>>0),c[f+4>>2]=0);n=0;o=(g>>>0)/(j>>>0)>>>0;return(C=n,o)|0}else{if(!m){n=0;o=0;return(C=n,o)|0}c[f>>2]=a|0;c[f+4>>2]=b&0;n=0;o=0;return(C=n,o)|0}}m=(l|0)==0;do if(j){if(!m){p=(aa(l|0)|0)-(aa(i|0)|0)|0;if(p>>>0<=31){q=p+1|0;r=31-p|0;s=p-31>>31;t=q;u=g>>>(q>>>0)&s|i<<r;v=i>>>(q>>>0)&s;w=0;x=g<<r;break}if(!f){n=0;o=0;return(C=n,o)|0}c[f>>2]=a|0;c[f+4>>2]=h|b&0;n=0;o=0;return(C=n,o)|0}r=j-1|0;if(r&j){s=(aa(j|0)|0)+33-(aa(i|0)|0)|0;q=64-s|0;p=32-s|0;y=p>>31;z=s-32|0;A=z>>31;t=s;u=p-1>>31&i>>>(z>>>0)|(i<<p|g>>>(s>>>0))&A;v=A&i>>>(s>>>0);w=g<<q&y;x=(i<<q|g>>>(z>>>0))&y|g<<p&s-33>>31;break}f&&(c[f>>2]=r&g,c[f+4>>2]=0);if((j|0)==1){n=h|b&0;o=a|0|0;return(C=n,o)|0}else{r=hb(j|0)|0;n=i>>>(r>>>0)|0;o=i<<32-r|g>>>(r>>>0)|0;return(C=n,o)|0}}else{if(m){f&&(c[f>>2]=(i>>>0)%(j>>>0),c[f+4>>2]=0);n=0;o=(i>>>0)/(j>>>0)>>>0;return(C=n,o)|0}if(!g){f&&(c[f>>2]=0,c[f+4>>2]=(i>>>0)%(l>>>0));n=0;o=(i>>>0)/(l>>>0)>>>0;return(C=n,o)|0}r=l-1|0;if(!(r&l)){f&&(c[f>>2]=a|0,c[f+4>>2]=r&i|b&0);n=0;o=i>>>((hb(l|0)|0)>>>0);return(C=n,o)|0}r=(aa(l|0)|0)-(aa(i|0)|0)|0;if(r>>>0<=30){s=r+1|0;p=31-r|0;t=s;u=i<<p|g>>>(s>>>0);v=i>>>(s>>>0);w=0;x=g<<p;break}if(!f){n=0;o=0;return(C=n,o)|0}c[f>>2]=a|0;c[f+4>>2]=h|b&0;n=0;o=0;return(C=n,o)|0}while(0);if(!t)B=x,D=w,E=v,F=u,G=0,H=0;else{b=d|0|0;d=k|e&0;e=cb(b|0,d|0,-1,-1)|0;k=C;h=x;x=w;w=v;v=u;u=t;t=0;do a=h,h=x>>>31|h<<1,x=t|x<<1,g=v<<1|a>>>31|0,a=v>>>31|w<<1|0,bb(e,k,g,a)|0,i=C,l=i>>31|((i|0)<0?-1:0)<<1,t=l&1,v=bb(g,a,l&b,(((i|0)<0?-1:0)>>31|((i|0)<0?-1:0)<<1)&d)|0,w=C,u=u-1|0;while((u|0)!=0);B=h;D=x;E=w;F=v;G=0;H=t}t=D;D=0;f&&(c[f>>2]=F,c[f+4>>2]=E);n=(t|0)>>>31|(B|D)<<1|(D<<1|t>>>31)&0|G;o=(t<<1|0>>>31)&-2|H;return(C=n,o)|0}function pb(a,b){a=a|0;b=b|0;return ya[a&1](b|0)|0}function qb(a,b,c,d){a=a|0;b=b|0;c=c|0;d=d|0;return za[a&3](b|0,c|0,d|0)|0}function rb(a,b){a=a|0,b=b|0,Aa[a&1](b|0)}function sb(a){a=a|0;ba(0);return 0}function tb(a,b,c){a=a|0;b=b|0;c=c|0;ba(1);return 0}function ub(a){a=a|0,ba(2)}var ya=[sb,Sa],za=[tb,Va,Ta,Ua],Aa=[ub,Xa];return{_curve25519_donna:Ka,_free:_a,_i64Add:cb,_bitshift64Ashr:ab,_i64Subtract:bb,_memset:db,_malloc:Za,_memcpy:gb,_bitshift64Lshr:eb,_fflush:Wa,___errno_location:Oa,_bitshift64Shl:fb,runPostSets:$a,stackAlloc:Ba,stackSave:Ca,stackRestore:Da,establishStackSpace:Ea,setThrew:Fa,setTempRet0:Ia,getTempRet0:Ja,dynCall_ii:pb,dynCall_iiii:qb,dynCall_vi:rb}}(e.Na,e.Oa,buffer);e._curve25519_donna=Z._curve25519_donna;var Da=e._free=Z._free;e.runPostSets=Z.runPostSets;var cb=e._i64Add=Z._i64Add,ab=e._bitshift64Ashr=Z._bitshift64Ashr,bb=e._i64Subtract=Z._i64Subtract,db=e._memset=Z._memset,ua=e._malloc=Z._malloc,gc=e._memcpy=Z._memcpy,fb=e._bitshift64Lshr=Z._bitshift64Lshr;e._fflush=Z._fflush;e.___errno_location=Z.___errno_location;var gb=e._bitshift64Shl=Z._bitshift64Shl;e.dynCall_ii=Z.dynCall_ii;e.dynCall_iiii=Z.dynCall_iiii;e.dynCall_vi=Z.dynCall_vi;n.W=Z.stackAlloc;n.na=Z.stackSave;n.X=Z.stackRestore;n.md=Z.establishStackSpace;n.cb=Z.setTempRet0;n.Ua=Z.getTempRet0;function xc(a){this.name="ExitStatus",this.message="Program terminated with exit("+a+")",this.status=a}xc.prototype=Error();xc.prototype.constructor=xc;var Yc=null,Xa=function Zc(){e.calledRun||$c(),e.calledRun||(Xa=Zc)};e.callMain=e.jd=function(a){function b(){for(var a=0;3>a;a++)d.push(0)}assert(0==L,"cannot call main when async dependencies remain! (listen on __ATMAIN__)");assert(0==Pa.length,"cannot call main when preRun functions remain to be called");a=a||[];xa||(xa=!0,Oa(Qa));var c=a.length+1,d=[G(Va(e.thisProgram),"i8",0)];b();for(var f=0;f<c-1;f+=1)d.push(G(Va(a[f]),"i8",0)),b();d.push(0);d=G(d,"i32",0);try{var h=e._main(c,d,0);ad(h,!0)}catch(g){if(!(g instanceof xc))if("SimulateInfiniteLoop"==g)e.noExitRuntime=!0;else throw g&&"object"===typeof g&&g.stack&&e.S("exception thrown: "+[g,g.stack]),g}finally{}};function $c(a){function b(){if(!e.calledRun&&(e.calledRun=!0,!A)){xa||(xa=!0,Oa(Qa));Oa(Ra);e.onRuntimeInitialized&&e.onRuntimeInitialized();e._main&&bd&&e.callMain(a);if(e.postRun)for("function"==typeof e.postRun&&(e.postRun=[e.postRun]);e.postRun.length;)Ua(e.postRun.shift());Oa(Sa)}}a=a||e.arguments;null===Yc&&(Yc=Date.now());if(!(0<L)){if(e.preRun)for("function"==typeof e.preRun&&(e.preRun=[e.preRun]);e.preRun.length;)Ta(e.preRun.shift());Oa(Pa);0<L||e.calledRun||(e.setStatus?(e.setStatus("Running..."),setTimeout(function(){setTimeout(function(){e.setStatus("")},1),b()},1)):b())}}e.run=e.run=$c;function ad(a,b){if(!b||!e.noExitRuntime){!e.noExitRuntime&&(A=!0,m=void 0,Oa(K),e.onExit)&&e.onExit(a);throw new xc(a)}}e.exit=e.exit=ad;var cd=[];function z(a){void 0!==a?(e.print(a),e.S(a),a=JSON.stringify(a)):a="";A=!0;var b="abort("+a+") at "+Ea()+"\nIf this abort() is unexpected, build with -s ASSERTIONS=1 which can give more information.";cd&&cd.forEach(function(c){b=c(b,a)});throw b}e.abort=e.abort=z;if(e.preInit)for("function"==typeof e.preInit&&(e.preInit=[e.preInit]);0<e.preInit.length;)e.preInit.pop()();var bd=!0;e.noInitialRun&&(bd=!1);$c();module.exports=e}),null);
__d("WAWebCryptoCurve25519",["Promise","WAWeb-curve25519-donna","WAWebCryptoLibraryUtilsApi","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){var h,i;function j(){i||(i=b("WAWeb-curve25519-donna"))}var k=new Uint8Array(32);k[0]=9;function a(a){var b;a===void 0?(b=new Uint8Array(32),self.crypto.getRandomValues(b)):b=new Uint8Array(a);b[0]&=248;b[31]&=127;b[31]|=64;return s({pubKey:32,privKey:b,basepoint:k},function(a){var d=i._curve25519_donna(a.pubKey,a.privKey,a.basepoint);if(d)throw c("err")("Curve25519:keyPair Error Code "+d);return{pubKey:r(a.pubKey,32),privKey:b.buffer}})}function d(a,d){return(h||(h=b("Promise"))).resolve().then(function(){return s({sharedKey:32,pubKey:a,privKey:d},function(a){var b=i._curve25519_donna(a.sharedKey,a.privKey,a.pubKey);if(b)throw c("err")("Curve25519:sharedSecret Error Code "+b);return r(a.sharedKey,32)})})}var l=5;function m(a){return a.pubKey.byteLength===33&&a.privKey.byteLength===32}function e(a){if(m(a))return a;if(a.pubKey.byteLength!==32||a.privKey.byteLength!==32)throw c("err")("Invalid key pair type");var b=n(a.pubKey),d=new Uint8Array(32);d.set(new Uint8Array(a.privKey));return{pubKey:b,privKey:d.buffer}}function n(a){if(a.byteLength!==32)throw c("err")("Invalid key type");var b=new Uint8Array(33);b[0]=l;b.set(new Uint8Array(a),1);return b.buffer}function o(a){return a.privKey.byteLength===32&&a.pubKey.byteLength===32}function f(a){if(o(a))return a;if(a.pubKey.byteLength!==33||a.privKey.byteLength!==32)throw c("err")("Invalid key pair type");var b=new Uint8Array(32),d=new Uint8Array(32);b.set(new Uint8Array(a.pubKey).subarray(1));d.set(new Uint8Array(a.privKey));return{pubKey:b.buffer,privKey:d.buffer}}function p(a){if(a.byteLength!==33)throw c("err")("Invalid key type");var b=new Uint8Array(32);b.set(new Uint8Array(a).subarray(1));return b.buffer}function q(a){if(typeof a==="number")return i._malloc(a);a=new Uint8Array(a.buffer||a);var b=i._malloc(a.length);i.HEAPU8.set(a,b);return b}function r(a,b){var c=new Uint8Array(b);c.set(i.HEAPU8.subarray(a,a+b));return c.buffer}function s(a,b){j();var c={};try{for(var d in a)c[d]=q(a[d]);return b(c)}finally{for(d in c)i._free(c[d])}}function t(a,b){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=(yield c("WAWebCryptoLibraryUtilsApi").signMsg(a.pubKey,a.privKey,b));return a});return u.apply(this,arguments)}function v(a,b,d){if(a.byteLength!==32)throw c("err")("Invalid public key length: "+a.byteLength);var e=new Uint8Array(33);e[0]=l;e.set(a,1);return c("WAWebCryptoLibraryUtilsApi").verifySignature(e,b,d)}g.keyPair=a;g.sharedSecret=d;g.toSignalCurveKeyPair=e;g.toSignalCurvePubKey=n;g.isValidCurveKeyPair=o;g.toCurveKeyPair=f;g.toCurveKeyPubKey=p;g.calculateSignature=t;g.verifySignature=v}),98);
__d("WAWebDBMarkAsReadForTable",["WAWebModelStorageUtils","WAWebMsgKey","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,e){return d("WAWebModelStorageUtils").getStorage().lock([a],function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a[0];var b=(yield a.anyOf(["msgKey"],e));b.length!==0&&(yield a.bulkCreateOrReplace(b.map(function(a){return babelHelpers["extends"]({},a,{read:!0})})));return b.map(function(a){a=a.msgKey;return c("WAWebMsgKey").from(a)})});return function(b){return a.apply(this,arguments)}}())}g.markAsReadForTable=a}),98);
__d("WAWebDBUpdateAddOnAcksForTable",["WANullthrows","WAWebModelStorageUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,e,f){return d("WAWebModelStorageUtils").getStorage().lock([a],function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a[0];var b=[],d=new Map();for(var g of e){var h=g.msgKey.toString();b.push(h);d.set(g.msgKey.toString(),g)}h=(yield a.anyOf(["msgKey"],b,{shouldDecrypt:!1}));g=[];b=[];for(h of h){var i=c("WANullthrows")(d.get(h.msgKey));if(!f(h,i))continue;var j=babelHelpers["extends"]({},h,{ack:i.ack});g.push(j);b.push(i)}yield a.bulkCreateOrReplace_ALREADY_ENCRYPTED_RECORDS_ONLY(g);return b});return function(b){return a.apply(this,arguments)}}())}g.updateAddOnAcksForTable=a}),98);
__d("WAWebMessageAddOnType",["$InternalEnum"],(function(a,b,c,d,e,f){a=b("$InternalEnum")({Reaction:"reaction",ReactionEnc:"reaction_enc",PollVote:"poll_vote",KeepInChat:"keep_in_chat",MessageEdit:"message_edit",PinMessage:"pin_message",Comment:"comment",Unknown:"unknown"});f.MessageAddOnType=a}),66);
__d("WAWebDBCommentAddOnProvider",["Promise","WAWebDBMarkAsReadForTable","WAWebDBUpdateAddOnAcksForTable","WAWebMessageAddOnType","WAWebMsgType","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;a={type:d("WAWebMessageAddOnType").MessageAddOnType.Comment,matches:function(a){return a.type===d("WAWebMsgType").MSG_TYPE.COMMENT},matchesFutureproof:function(a){return a.type===d("WAWebMsgType").MSG_TYPE.UNKNOWN&&a.futureproofType===d("WAWebMsgType").MSG_TYPE.COMMENT},canRenderInUi:function(){return!0},processOrphansForNewMsg:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,d){return(h||(h=b("Promise"))).resolve()});function c(b,c,d){return a.apply(this,arguments)}return c}(),updateAcks:function(a,b){return d("WAWebDBUpdateAddOnAcksForTable").updateAddOnAcksForTable("comments",a,b)},markAsRead:function(a){return d("WAWebDBMarkAsReadForTable").markAsReadForTable("comments",a.map(String))}};g.commentsAddOnProvider=a}),98);
__d("WAWebEphemeralKeepInChatUtils",["WAWebBackendApi","WAWebEphemeralConstants","WAWebMsgGetters","WAWebProtobufsE2E.pb","WAWebUserPrefsMeUser","WAWebWid","WAWebWidFactory"],(function(a,b,c,d,e,f,g){function a(a){if(a!=null&&a===d("WAWebProtobufsE2E.pb").KeepType.KEEP_FOR_ALL)return d("WAWebEphemeralConstants").KeepInChatState.KEPT;else if(a!=null&&a===d("WAWebProtobufsE2E.pb").KeepType.UNDO_KEEP_FOR_ALL)return d("WAWebEphemeralConstants").KeepInChatState.UNKEPT;return null}function b(a){return a===d("WAWebEphemeralConstants").KeepInChatState.KEPT}function h(a){return a===d("WAWebEphemeralConstants").KeepInChatState.UNKEPT}function e(a){var b,c;a.forEach(function(a){(!b||i(a,b)===1)&&(c=b,b=a)});c!=null&&d("WAWebBackendApi").frontendSendAndReceive("logTieBreakIgnoredKicWam",{keepInChatMessage:c});return b}function i(a,b){if(a.senderTimestampMs==null)return-1;if(b.senderTimestampMs==null)return 1;if(a.senderTimestampMs>b.senderTimestampMs)return 1;else if(a.senderTimestampMs===b.senderTimestampMs&&a.id.id>b.id.id)return 1;return-1}function j(a){if(a.kicKey!=null){var b,c=d("WAWebMsgGetters").getIsGroupMsg(a);if(((b=a.kicKey)==null?void 0:b.fromMe)===!0)return d("WAWebUserPrefsMeUser").getMaybeMeUser();else if(c&&((b=a.kicKey)==null?void 0:b.participant)!=null)return d("WAWebWidFactory").toUserWid(a.kicKey.participant);else if(!c&&((b=a.kicKey)==null?void 0:b.remote)!=null)return d("WAWebWidFactory").toUserWid(a.kicKey.remote)}}function f(a){return h(a.kicState)&&c("WAWebWid").equals(j(a),d("WAWebMsgGetters").getSender(a))}g.parseKeepTypeToKicState=a;g.isKept=b;g.isUnkept=h;g.runKeepInChatTieBreaker=e;g.compareKeepInChatMessages=i;g.getKicSender=j;g.kicSenderSuperPowerActive=f}),98);
__d("WAWebMsgDataFromModel",[],(function(a,b,c,d,e,f){function g(a){a=a.toJSON();return babelHelpers["extends"]({},a,{paymentNoteMsg:a.paymentNoteMsg?g(a.paymentNoteMsg):void 0})}f.msgDataFromMsgModel=g}),66);
__d("WAWebDBKeepInChatAddOnProvider",["WALogger","WAWebBackendApi","WAWebEphemeralKeepInChatUtils","WAWebMessageAddOnType","WAWebMsgDataFromModel","WAWebMsgType","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["keepInChatAddOnProvider: found orphan"]);h=function(){return a};return a}a={type:d("WAWebMessageAddOnType").MessageAddOnType.KeepInChat,matches:function(a){return a.type===d("WAWebMsgType").MSG_TYPE.KEEP_IN_CHAT},matchesFutureproof:function(a){return a.type===d("WAWebMsgType").MSG_TYPE.UNKNOWN&&a.futureproofType===d("WAWebMsgType").MSG_TYPE.KEEP_IN_CHAT},canRenderInUi:function(){return!0},processOrphansForNewMsg:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){a=c.map(function(a){return a.parsedMsgPayload});b=d("WAWebEphemeralKeepInChatUtils").runKeepInChatTieBreaker(a);d("WALogger").LOG(h()).devConsole({winningOrphanMsg:b});if(b!=null){c=d("WAWebMsgDataFromModel").msgDataFromMsgModel(b);yield d("WAWebBackendApi").frontendSendAndReceive("processKeepInChatMessage",{keepInChatMessage:c,allowNotification:!1})}});function c(b,c,d){return a.apply(this,arguments)}return c}()};g.keepInChatAddOnProvider=a}),98);
__d("WAWebDBReactionsAddOnProvider",["WAWebDBMarkAsReadForTable","WAWebDBUpdateAddOnAcksForTable","WAWebMessageAddOnType","WAWebMsgType","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){a={type:d("WAWebMessageAddOnType").MessageAddOnType.Reaction,matches:function(a){return a.type===d("WAWebMsgType").MSG_TYPE.REACTION},matchesFutureproof:function(a){return a.type===d("WAWebMsgType").MSG_TYPE.UNKNOWN&&a.futureproofType===d("WAWebMsgType").MSG_TYPE.REACTION},canRenderInUi:function(){return!0},processOrphansForNewMsg:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,d){throw c("err")("Reactions not yet integrated into orphan framework")});function d(b,c,d){return a.apply(this,arguments)}return d}(),updateAcks:function(a,b){return d("WAWebDBUpdateAddOnAcksForTable").updateAddOnAcksForTable("reactions",a,b)},markAsRead:function(a){return d("WAWebDBMarkAsReadForTable").markAsReadForTable("reactions",a.map(String))}};g.reactionsAddOnProvider=a}),98);
__d("WAWebDBAddOnProviders",["WAWebDBCommentAddOnProvider","WAWebDBKeepInChatAddOnProvider","WAWebDBMessageEditAddOnProvider","WAWebDBPinInChatAddOnProvider","WAWebDBPollVotesAddOnProvider","WAWebDBReactionsAddOnProvider","WAWebDBReactionsEncAddOnProvider"],(function(a,b,c,d,e,f,g){var h=[d("WAWebDBPollVotesAddOnProvider").pollVotesAddOnProvider,d("WAWebDBKeepInChatAddOnProvider").keepInChatAddOnProvider,d("WAWebDBReactionsAddOnProvider").reactionsAddOnProvider,d("WAWebDBReactionsEncAddOnProvider").reactionsEncAddOnProvider,d("WAWebDBMessageEditAddOnProvider").messageEditAddOnProvider,d("WAWebDBPinInChatAddOnProvider").pinInChatAddOnProvider,d("WAWebDBCommentAddOnProvider").commentsAddOnProvider];function a(a){var b;return(b=h.find(function(b){return b.type===a}))!=null?b:null}function b(a){return h.find(function(b){return b.matches(a)})}function c(a){return h.find(function(b){return b.matchesFutureproof(a)})}g.addOnProviders=h;g.getProviderForAddOnType=a;g.getAddOnProviderForMsg=b;g.getAddOnProviderForFutureproofMsg=c}),98);
__d("WAWebDBMapOrphansToProviders",["WAWebDBAddOnProviders"],(function(a,b,c,d,e,f,g){function a(a){var b=new Map();for(var c=0;c<a.length;c++){var e,f=a[c],g=d("WAWebDBAddOnProviders").getProviderForAddOnType(f.type);if(!g)continue;e=(e=b.get(g))!=null?e:[];e.push(f);b.set(g,e)}return b}g.mapOrphansToProviders=a}),98);
__d("WAWebMessageEditGatingUtils",["WAWebABProps","gkx"],(function(a,b,c,d,e,f,g){function a(){return d("WAWebABProps").getABPropConfigValue("message_edit_receive")||h()||c("gkx")("26261")&&d("WAWebABProps").getABPropConfigValue("web_message_edit_receive_desktop_beta_rollout")}function h(){return d("WAWebABProps").getABPropConfigValue("message_edit_send")||c("gkx")("26261")&&d("WAWebABProps").getABPropConfigValue("web_message_edit_send_desktop_beta_rollout")}function b(){return d("WAWebABProps").getABPropConfigValue("caption_edit_receive")||i()}function i(){return d("WAWebABProps").getABPropConfigValue("caption_edit_send")}function e(){return d("WAWebABProps").getABPropConfigValue("web_message_edit_processing_reply_messages")}function f(){return d("WAWebABProps").getABPropConfigValue("cag_message_edit_send")}function j(){return d("WAWebABProps").getABPropConfigValue("cag_message_edit_receive")}g.receiveTextEditEnabled=a;g.sendTextEditEnabled=h;g.receiveCaptionEditEnabled=b;g.sendCaptionEditEnabled=i;g.processReplyMessagesEnabled=e;g.sendCagMsgEditEnabled=f;g.receiveCagMsgEditEnabled=j}),98);
__d("WAWebMessageEditUtils",["$InternalEnum","WATimeUtils","WAWebABProps","WAWebMsgType","WAWebWid"],(function(a,b,c,d,e,f,g){var h=30*24*60*60;function i(a){if(a)return h;a=d("WAWebABProps").getABPropConfigValue("message_edit_window_duration_seconds");return a==null||a<=0?20*60:a}function j(a){if(a)return h;a=d("WAWebABProps").getABPropConfigValue("message_edit_client_entry_point_limit_seconds");return a==null||a<=0?15*60:a}var k=b("$InternalEnum").Mirrored(["TextEdit","CaptionEdit"]);function a(a){switch(a){case d("WAWebMsgType").MSG_TYPE.CHAT:return k.TextEdit;case d("WAWebMsgType").MSG_TYPE.IMAGE:case d("WAWebMsgType").MSG_TYPE.VIDEO:case d("WAWebMsgType").MSG_TYPE.DOCUMENT:return k.CaptionEdit;default:return null}}var l=[(b=d("WAWebMsgType")).MSG_TYPE.CHAT,b.MSG_TYPE.IMAGE,b.MSG_TYPE.VIDEO,b.MSG_TYPE.DOCUMENT];function e(a){return l.includes(a)?!0:!1}function f(a){var b=a.parentTsInSeconds,e=a.editTsInSeconds;a=a.msgKey;a=c("WAWebWid").isNewsletter(a.remote);return e!=null?e<b+i(a):d("WATimeUtils").unixTime()<b+i(a)}function m(a){var b=a.parentTsInSeconds;a=a.msgKey;return d("WATimeUtils").unixTime()<b+j(c("WAWebWid").isNewsletter(a.remote))}g.getMessageEditProcessingWindowDurationSeconds=i;g.getMessageEditUIEntryPointLimitSeconds=j;g.MsgEditType=k;g.getMsgEditType=a;g.msgTypeSupportsEditing=e;g.isParentWithinEditProcessingWindow=f;g.isParentWithinEditUIWindow=m}),98);
__d("WAWebDBMessageEditAddOnProvider",["WAWebDBProcessEditProtocolMsgs","WAWebMessageAddOnType","WAWebMessageEditGatingUtils","WAWebMessageEditUtils","WAWebMsgType","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){a={type:d("WAWebMessageAddOnType").MessageAddOnType.MessageEdit,matches:function(a){return a.type===d("WAWebMsgType").MSG_TYPE.PROTOCOL&&a.subtype==="message_edit"},matchesFutureproof:function(a){return a.type===d("WAWebMsgType").MSG_TYPE.UNKNOWN&&a.futureproofType===d("WAWebMsgType").MSG_TYPE.PROTOCOL&&a.futureproofSubtype==="message_edit"},canRenderInUi:function(a){a=a.editMsgType?d("WAWebMessageEditUtils").getMsgEditType(a.editMsgType):d("WAWebMessageEditUtils").MsgEditType.TextEdit;if(!a)return!1;switch(a){case d("WAWebMessageEditUtils").MsgEditType.TextEdit:return d("WAWebMessageEditGatingUtils").receiveTextEditEnabled();case d("WAWebMessageEditUtils").MsgEditType.CaptionEdit:return d("WAWebMessageEditGatingUtils").receiveCaptionEditEnabled()}},processOrphansForNewMsg:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){b=(yield d("WAWebDBProcessEditProtocolMsgs").processEditProtocolMsgs(c.map(function(a){return a.parsedMsgPayload})));b=(c=b.find(function(b){return b.parentMsg.id.equals(a.id)}))==null?void 0:c.editedMsgData;b&&Object.assign(a,b)});function c(b,c,d){return a.apply(this,arguments)}return c}()};g.messageEditAddOnProvider=a}),98);
__d("WAWebDBPinInChatAddOnProvider",["WAWebDBUpdateAddOnAcksForTable","WAWebMessageAddOnType","WAWebMsgType","WAWebPinMessageProcessor","WAWebPinMsgGatingUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){a={type:d("WAWebMessageAddOnType").MessageAddOnType.PinMessage,matches:function(a){return a.type===d("WAWebMsgType").MSG_TYPE.PIN_MESSAGE},matchesFutureproof:function(a){return a.type===d("WAWebMsgType").MSG_TYPE.UNKNOWN&&a.futureproofType===d("WAWebMsgType").MSG_TYPE.PIN_MESSAGE},canRenderInUi:function(){return d("WAWebPinMsgGatingUtils").isPinnedMessagesM1ReceiverEnabled()},processOrphansForNewMsg:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){b=c.map(function(a){return a.parsedMsgPayload});yield d("WAWebPinMessageProcessor").processPinMessages(a.id.remote,b)});function c(b,c,d){return a.apply(this,arguments)}return c}(),updateAcks:function(a,b){return d("WAWebDBUpdateAddOnAcksForTable").updateAddOnAcksForTable("pinned-messages",a,b)}};g.pinInChatAddOnProvider=a}),98);
__d("WAWebDBPollVotesAddOnProvider",["WAWebDBMarkAsReadForTable","WAWebDBProcessPollUpdateMsgs","WAWebDBUpdateAddOnAcksForTable","WAWebMessageAddOnType","WAWebMsgType","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){a={type:d("WAWebMessageAddOnType").MessageAddOnType.PollVote,matches:function(a){return a.type===d("WAWebMsgType").MSG_TYPE.POLL_UPDATE&&a.subtype==="poll_vote"},matchesFutureproof:function(a){return a.type===d("WAWebMsgType").MSG_TYPE.UNKNOWN&&a.futureproofType===d("WAWebMsgType").MSG_TYPE.POLL_UPDATE},canRenderInUi:function(){return!0},processOrphansForNewMsg:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){var f=new Map();for(a of e)f.set(a.msgKey,a);b=(yield d("WAWebDBProcessPollUpdateMsgs").processPollUpdateMsgs(e.map(function(a){a=a.parsedMsgPayload;if(a.type===d("WAWebMsgType").MSG_TYPE.POLL_UPDATE&&a.addonEncrypted)return a;throw c("err")("Invalid poll vote orphan type")})));return b.map(function(a){var b;b=a.read||((b=(b=f.get(a.msgKey.toString()))==null?void 0:b.read)!=null?b:!1);return a.read===b?a:babelHelpers["extends"]({},a,{read:b})})});function e(b,c,d){return a.apply(this,arguments)}return e}(),updateAcks:function(a,b){return d("WAWebDBUpdateAddOnAcksForTable").updateAddOnAcksForTable("poll-votes",a,b)},markAsRead:function(a){return d("WAWebDBMarkAsReadForTable").markAsReadForTable("poll-votes",a.map(String))}};g.pollVotesAddOnProvider=a}),98);
__d("WAWebDBOrphanDbSerialization",["WAWebDBMessageSerialization","WAWebWidFactory"],(function(a,b,c,d,e,f,g){function a(a){return babelHelpers["extends"]({},a,{sender:a.sender==null?null:d("WAWebWidFactory").createUserWid(a.sender),parsedMsgPayload:d("WAWebDBMessageSerialization").messageFromDbRow(a.parsedMsgPayload)})}g.orphanFromDbRow=a}),98);
__d("WAWebDBGetByParentMsgKey",["WAWebDBOrphanDbSerialization","WAWebSchemaMessageOrphans","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a){return d("WAWebSchemaMessageOrphans").getMessageOrphanTable().equals(["parentMsgKey"],String(a)).then(function(a){return a.filter(Boolean).map(d("WAWebDBOrphanDbSerialization").orphanFromDbRow)})}function c(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=new Set(a.map(function(a){return String(a)}));a=(yield d("WAWebSchemaMessageOrphans").getMessageOrphanTable().anyOf(["parentMsgKey"],Array.from(a)));var b=new Map();a.forEach(function(a){var c=b.get(a.parentMsgKey)||[];c.push(a);b.set(a.parentMsgKey,c)});return b});return h.apply(this,arguments)}g.getMessageOrphansByParentMsgKey=a;g.getMessageOrphansByParentMsgKeys=c}),98);
__d("WAWebDBProcessOrphansForNewMsg",["Promise","WALogger","WAWebAddonProcessMsgs","WAWebAddonProcessMsgsUtils","WAWebDBGetByParentMsgKey","WAWebDBMapOrphansToProviders","WAWebSchemaMessageOrphans","asyncToGeneratorRuntime","lodash"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["processOrphansForNewMsg: found orphans"]);i=function(){return a};return a}function a(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){var f=(yield d("WAWebDBGetByParentMsgKey").getMessageOrphansByParentMsgKey(a.id));f.length&&d("WALogger").LOG(i()).devConsole({orphans:f});f=d("WAWebAddonProcessMsgsUtils").sortAddonOrphans(f);var g=f.unifiedAddons;f=f.otherOrphans;f=(yield d("WAWebDBMapOrphansToProviders").mapOrphansToProviders(f));var j=[d("WAWebAddonProcessMsgs").processMsgs(g)];for(var k of f.entries()){var l=k[0],m=k[1];j.push(l.processOrphansForNewMsg(a,e,m))}yield (h||(h=b("Promise"))).all(j);l=c("lodash").flatten(Array.from(f.values())).map(function(a){return a.msgKey});l=l.concat(g.map(function(a){return a.id.toString()}));yield d("WAWebSchemaMessageOrphans").getMessageOrphanTable().bulkRemove(l)});return j.apply(this,arguments)}g.processOrphansForNewMsg=a}),98);
__d("WAWebDBCommunityTypes",["$InternalEnum"],(function(a,b,c,d,e,f){a=b("$InternalEnum").Mirrored(["SubGroupLink","SiblingGroupLink","SubGroupUnlink","SiblingGroupUnlink"]);f.CommunityLinkOperation=a}),66);
__d("WAWebDBCommunity",["Promise","WABatcher","WALogger","WAWebDBCommunityTypes","WAWebGroupsParticipantsApi","WAWebSchemaChat","WAWebSchemaGroupMetadata","WAWebSchemaUnjoinedSubgroupMetadata","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["bulkPersistCommunityLink"]);i=function(){return a};return a}function j(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WALogger").DEV(i()).devConsole(a);var c=new Map(),e=new Map();a.forEach(function(a){a.subgroups.forEach(function(a){e.set(String(a.id),null)});switch(a.action){case d("WAWebDBCommunityTypes").CommunityLinkOperation.SiblingGroupLink:case d("WAWebDBCommunityTypes").CommunityLinkOperation.SiblingGroupUnlink:c.set(String(a.chatId),null);break;default:return}});(yield d("WAWebSchemaGroupMetadata").getGroupMetadataTable().bulkGet(Array.from(c.keys()))).forEach(function(a){a&&a.parentGroup!=null&&c.set(a.id,String(a.parentGroup))});(yield d("WAWebSchemaChat").getChatTable().bulkGet(Array.from(e.keys()))).forEach(function(a){a&&e.set(a.id,a)});var f=new Map(),g=new Map(),j=new Set(),k=function(a,b,c){b.forEach(function(b){var d=String(b.id),h=e.get(d);if(h!=null&&!h.isReadOnly)f.set(d,{id:d,parentGroup:c?a:void 0});else if(c){j["delete"](d);b={id:d,subject:b.subject,subjectTime:(h=b.subjectTime)!=null?h:0,parentGroup:a};h=g.get(d);h&&h.subjectTime>b.subjectTime&&(b.subject=h.subject,b.subjectTime=h.subjectTime);g.set(d,b)}else g["delete"](d),j.add(d)})};a.forEach(function(a){var b=null,e=!1;switch(a.action){case d("WAWebDBCommunityTypes").CommunityLinkOperation.SiblingGroupLink:b=c.get(String(a.chatId));e=!0;break;case d("WAWebDBCommunityTypes").CommunityLinkOperation.SiblingGroupUnlink:b=c.get(String(a.chatId));e=!1;break;case d("WAWebDBCommunityTypes").CommunityLinkOperation.SubGroupLink:b=String(a.chatId);e=!0;break;case d("WAWebDBCommunityTypes").CommunityLinkOperation.SubGroupUnlink:b=String(a.chatId),e=!1}b!=null&&k(b,a.subgroups,e)});yield (h||(h=b("Promise"))).all([d("WAWebSchemaGroupMetadata").getGroupMetadataTable().bulkCreateOrMerge(Array.from(f.values())),d("WAWebSchemaUnjoinedSubgroupMetadata").getUnjoinedSubgroupMetadataTable().bulkRemove(Array.from(j)),d("WAWebSchemaUnjoinedSubgroupMetadata").getUnjoinedSubgroupMetadataTable().bulkGet(Array.from(g.keys())).then(function(a){a.forEach(function(a){if(!a)return;var b=g.get(a.id);if(!b)return;a.subjectTime!=null&&a.subjectTime>b.subjectTime&&(b.subjectTime=a.subjectTime,b.subject=a.subject)});return d("WAWebSchemaUnjoinedSubgroupMetadata").getUnjoinedSubgroupMetadataTable().bulkCreateOrMerge(Array.from(g.values()).map(function(a){return babelHelpers["extends"]({},a)}))})])});return k.apply(this,arguments)}var l=function(){var a=5e3;return d("WABatcher").batch({delayMs:a},function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield j(a);return(h||(h=b("Promise"))).resolve(a.map(function(a){return void 0}))});return function(b){return a.apply(this,arguments)}}())}();function a(a,b,c,d){d===void 0&&(d=!1);a={chatId:a,subgroups:b,action:c};return d?l(a):j([a])}function m(a){return d("WAWebSchemaGroupMetadata").getGroupMetadataTable().equals(["parentGroup"],a.toString())}function c(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){return(yield m(a)).map(function(a){return d("WAWebWidFactory").createWid(a.id)})});return n.apply(this,arguments)}function o(a){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){return(yield m(a)).find(function(a){return a.defaultSubgroup===!0})});return p.apply(this,arguments)}function e(a){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield o(a));return a==null?null:d("WAWebWidFactory").createWid(a.id)});return q.apply(this,arguments)}function r(a){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield m(a));a=(yield d("WAWebGroupsParticipantsApi").bulkCheckMyMembership(b.map(function(a){a=a.id;return d("WAWebWidFactory").createWid(a)}))).map(function(a,c){return[b[c],a]});return a.filter(function(a){a=a[1];return a}).map(function(a){a=a[0];return a})});return s.apply(this,arguments)}function t(a){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){return(yield r(a)).map(function(a){a=a.id;return d("WAWebWidFactory").createWid(a)})});return u.apply(this,arguments)}function v(a){return d("WAWebSchemaUnjoinedSubgroupMetadata").getUnjoinedSubgroupMetadataTable().equals(["parentGroup"],a.toString())}function f(a){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){return(yield v(a)).map(function(a){return d("WAWebWidFactory").createWid(a.id)})});return w.apply(this,arguments)}function x(a){return y.apply(this,arguments)}function y(){y=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.parentGroup;if(b==null)return!1;a=d("WAWebWidFactory").createWid(a.id);b=(yield t(d("WAWebWidFactory").createWid(b)));return b.length===1&&b[0].equals(a)});return y.apply(this,arguments)}g.persistCommunityLink=a;g.getSubgroups=c;g.getDefaultSubgroupMetadata=o;g.getDefaultSubgroup=e;g.getJoinedSubgroupsMetadata=r;g.getJoinedSubgroups=t;g.getUnjoinedSubgroupsMetadata=v;g.getUnjoinedSubgroups=f;g.isLastJoinedSubgroup=x}),98);
__d("WAWebDBStoreMessageOrphans",["WALogger","WAWebDBAddOnProviders","WAWebDBMessageSerialization","WAWebMessageAddOnType","WAWebMsgGetters","WAWebSchemaMessageOrphans","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["storeMessageOrphans:"]);h=function(){return a};return a}function a(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){d("WALogger").LOG(h()).devConsole({msgs:a});a=a.map(function(a){var c;return{msgKey:a.id.toString(),parentMsgKey:b(a).toString(),sender:d("WAWebMsgGetters").getSender(a).toString(),parsedMsgPayload:d("WAWebDBMessageSerialization").dbRowFromMessage(babelHelpers["extends"]({},a)),type:(c=(c=d("WAWebDBAddOnProviders").addOnProviders.find(function(b){return b.matches(a)}))==null?void 0:c.type)!=null?c:d("WAWebMessageAddOnType").MessageAddOnType.Unknown,senderTimestampMs:a.senderTimestampMs,t:a.t}});yield d("WAWebSchemaMessageOrphans").getMessageOrphanTable().bulkCreateOrReplace(a)});return i.apply(this,arguments)}g.storeMessageOrphans=a}),98);
__d("WAWebDBEphemeralMessage",["WALogger","WATimeUtils","WAWebDBMessageDelete","WAWebEphemeralKeepInChatUtils","WAWebSchemaMessage","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["pruneExpiredMessages completed"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["pruneExpiredMessages started"]);i=function(){return a};return a}function a(){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){d("WALogger").LOG(i()).tags("ephemeral-messages");var a=(yield d("WAWebSchemaMessage").getMessageTable().lessThan(["expiredTimestamp"],d("WATimeUtils").unixTime(),{shouldDecrypt:!1}));a=a.filter(function(a){return!d("WAWebEphemeralKeepInChatUtils").isKept(a.kicState)});yield d("WAWebDBMessageDelete").removeMessagesFromHistory(a.map(function(a){return a.id.toString()}));d("WALogger").LOG(h()).tags("ephemeral-messages");return a});return j.apply(this,arguments)}function c(a){return d("WAWebDBMessageDelete").removeMessagesFromHistory(a.map(function(a){return a.id.toString()}))}g.pruneExpiredMessages=a;g.removeExpiredMessagesFromHistory=c}),98);
__d("WATopLevelDomains",[],(function(a,b,c,d,e,f){"use strict";a=new Set(["abb","abbott","abudhabi","ac","academy","accountants","ad","ads","adult","ae","aero","af","afl","africa","ag","agency","ai","aig","al","am","amsterdam","anz","ao","apartments","app","aq","ar","army","art","as","asia","at","au","auction","audi","audio","auto","autos","aw","aws","ax","axa","az","ba","baby","band","bank","bar","barclays","basketball","bb","bbva","bd","be","beauty","beer","berlin","best","bet","bf","bg","bh","bi","bible","bid","bike","bingo","bio","biz","bj","black","blog","blue","bm","bmw","bn","bnpparibas","bo","bond","bot","boutique","box","br","bradesco","broker","brussels","bs","bt","build","builders","business","buzz","bw","by","bz","bzh","ca","cab","cafe","cam","camera","camp","canon","capital","car","cards","care","career","careers","cars","casa","cash","casino","cat","cc","cd","center","ceo","cern","cf","cfd","cg","ch","chat","cheap","church","ci","city","ck","cl","claims","click","clinic","clothing","cloud","club","cm","cn","co","coach","codes","coffee","com","community","company","condos","consulting","contact","contractors","cool","coop","country","coupons","courses","cpa","cr","credit","cricket","crs","cu","cv","cw","cx","cy","cyou","cz","dance","date","dating","day","de","deals","delivery","dental","dentist","desi","design","dev","dhl","diamonds","diet","digital","direct","directory","discount","dj","dk","dm","do","doctor","dog","domains","download","dvag","dz","earth","ec","eco","edu","education","ee","eg","email","energy","engineer","engineering","equipment","es","estate","et","eu","eus","events","exchange","expert","express","fail","faith","family","fan","fans","farm","fashion","fi","film","finance","financial","fish","fishing","fit","fitness","fj","flights","flowers","fm","fo","football","forex","forum","foundation","fr","frl","fun","fund","futbol","fyi","ga","gal","gallery","game","games","garden","gay","gd","gdn","ge","gent","gg","gh","gi","gift","gifts","gives","gl","glass","gle","global","gm","gmbh","gold","golf","goog","google","gop","gov","gp","gq","gr","graphics","gratis","green","group","gs","gt","guide","guru","gy","hair","hamburg","haus","health","healthcare","help","hk","hn","holdings","holiday","homes","horse","hospital","host","hosting","hot","house","how","hr","ht","hu","icu","id","ie","il","im","immo","in","inc","info","ink","institute","insure","int","international","investments","io","iq","ir","is","ist","istanbul","it","java","je","jewelry","jm","jo","jobs","jp","ke","kg","kh","ki","kim","kitchen","kiwi","kn","kp","kpmg","kpn","kr","krd","kred","kw","ky","kz","la","land","lat","law","lawyer","lb","lc","leclerc","legal","lgbt","li","lidl","life","limited","limo","link","live","lk","llc","loan","loans","lol","london","love","lr","ls","lt","ltd","ltda","lu","luxe","lv","ly","ma","madrid","makeup","management","market","marketing","markets","mba","mc","md","me","media","melbourne","men","menu","mg","miami","mil","mk","ml","mm","mn","mo","mobi","moda","moe","mom","monash","money","monster","mortgage","moscow","movie","mp","mq","mr","ms","mt","mu","museum","mv","mw","mx","my","mz","na","name","navy","nc","ne","net","network","neustar","new","news","nf","ng","ngo","ni","nico","ninja","nl","no","np","nr","nrw","ntt","nu","nyc","nz","observer","om","one","ong","onl","online","ooo","org","ovh","pa","page","paris","partners","parts","party","pay","pe","pet","pf","pg","ph","pharmacy","photo","photography","photos","physio","pics","pictet","pictures","pink","pioneer","pizza","pk","pl","place","plus","pm","pn","poker","porn","post","pr","press","pro","productions","promo","properties","ps","pt","pub","pw","py","qa","quebec","quest","racing","radio","re","realtor","recipes","red","ren","rent","repair","report","rest","restaurant","review","reviews","rio","rip","ro","rocks","rodeo","rs","ru","run","rw","sa","sale","salon","sap","saxo","sb","sbi","sbs","sc","school","science","scot","sd","se","security","services","sex","sexy","sg","sh","sharp","shiksha","shoes","shop","shopping","show","si","site","sk","ski","skin","sky","sl","sm","sn","sncf","so","social","softbank","software","solar","solutions","sony","soy","space","sport","spot","sr","srl","st","statebank","storage","store","stream","studio","study","style","su","sucks","supply","support","surf","sv","swiss","sx","sy","sydney","systems","sz","taipei","tatar","tax","taxi","tc","td","team","tech","technology","tel","tf","tg","th","tickets","tienda","tips","tires","tj","tk","tl","tm","tn","to","today","tokyo","tools","top","tours","town","toyota","toys","tr","trade","trading","training","travel","tt","tube","tv","tw","tz","ua","ug","uk","university","uno","us","uy","uz","va","vc","ve","vegas","ventures","vet","vg","vi","video","vin","vip","vision","vn","vote","voto","vu","wales","wang","watch","webcam","weber","website","wedding","wf","wien","wiki","win","wine","work","works","world","ws","wtf","xin","xyz","yandex","ye","yoga","yokohama","youtube","yt","za","zip","zm","zone","zw","\u0431\u0435\u043b","\u0434\u0435\u0442\u0438","\u043c\u043e\u0441\u043a\u0432\u0430","\u043e\u043d\u043b\u0430\u0439\u043d","\u043e\u0440\u0433","\u0440\u0443\u0441","\u0440\u0444","\u0441\u0430\u0439\u0442","\u0443\u043a\u0440","\u05e7\u05d5\u05dd","\u0634\u0628\u0643\u0629","\u092d\u093e\u0930\u0924","\u0c2d\u0c3e\u0c30\u0c24\u0c4d","\u79fb\u52a8"]);f.TLD=a}),66);
/**
 * License: https://www.facebook.com/legal/license/NKF0mBOyBt2/
 */
__d("punycode-2.1.1",[],(function(a,b,c,d,e,f){"use strict";b={};var g={exports:b};function h(){var a=2147483647,b=36,c=1,d=26,e=38,f=700,h=72,i=128,j="-",k=/^xn--/,l=/[^\0-\x7E]/,m=/[\x2E\u3002\uFF0E\uFF61]/g,n={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},o=b-c,p=Math.floor,q=String.fromCharCode;function r(a){throw new RangeError(n[a])}function s(a,b){var c=[],d=a.length;while(d--)c[d]=b(a[d]);return c}function t(a,b){var c=a.split("@"),d="";c.length>1&&(d=c[0]+"@",a=c[1]);a=a.replace(m,".");c=a.split(".");a=s(c,b).join(".");return d+a}function u(a){var b=[],c=0,d=a.length;while(c<d){var e=a.charCodeAt(c++);if(e>=55296&&e<=56319&&c<d){var f=a.charCodeAt(c++);(f&64512)==56320?b.push(((e&1023)<<10)+(f&1023)+65536):(b.push(e),c--)}else b.push(e)}return b}var v=function(a){return String.fromCodePoint.apply(String,a)},w=function(a){if(a-48<10)return a-22;if(a-65<26)return a-65;return a-97<26?a-97:b},x=function(a,b){return a+22+75*(a<26)-((b!=0)<<5)},y=function(a,c,g){var h=0;a=g?p(a/f):a>>1;a+=p(a/c);for(;a>o*d>>1;h+=b)a=p(a/o);return p(h+(o+1)*a/(a+e))},z=function(e){var f=[],g=e.length,k=0,l=i,m=h,n=e.lastIndexOf(j);n<0&&(n=0);for(var o=0;o<n;++o)e.charCodeAt(o)>=128&&r("not-basic"),f.push(e.charCodeAt(o));for(o=n>0?n+1:0;o<g;){n=k;for(var q=1,s=b;;s+=b){o>=g&&r("invalid-input");var t=w(e.charCodeAt(o++));(t>=b||t>p((a-k)/q))&&r("overflow");k+=t*q;var u=s<=m?c:s>=m+d?d:s-m;if(t<u)break;t=b-u;q>p(a/t)&&r("overflow");q*=t}u=f.length+1;m=y(k-n,u,n==0);p(k/u)>a-l&&r("overflow");l+=p(k/u);k%=u;f.splice(k++,0,l)}return String.fromCodePoint.apply(String,f)},A=function(e){var f=[];e=u(e);var g=e.length,k=i,l=0,m=h;for(var n=e,o=Array.isArray(n),s=0,n=o?n:n[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var t;if(o){if(s>=n.length)break;t=n[s++]}else{s=n.next();if(s.done)break;t=s.value}t=t;t<128&&f.push(q(t))}t=f.length;s=t;t&&f.push(j);while(s<g){o=a;for(var n=e,v=Array.isArray(n),w=0,n=v?n:n[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var z;if(v){if(w>=n.length)break;z=n[w++]}else{w=n.next();if(w.done)break;z=w.value}z=z;z>=k&&z<o&&(o=z)}z=s+1;o-k>p((a-l)/z)&&r("overflow");l+=(o-k)*z;k=o;for(w=e,v=Array.isArray(w),n=0,w=v?w:w[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){if(v){if(n>=w.length)break;o=w[n++]}else{n=w.next();if(n.done)break;o=n.value}o=o;o<k&&++l>a&&r("overflow");if(o==k){o=l;for(var A=b;;A+=b){var B=A<=m?c:A>=m+d?d:A-m;if(o<B)break;var C=o-B,D=b-B;f.push(q(x(B+C%D,0)));o=p(C/D)}f.push(q(x(o,0)));m=y(l,z,s==t);l=0;++s}}++l;++k}return f.join("")},B=function(a){return t(a,function(a){return k.test(a)?z(a.slice(4).toLowerCase()):a})},C=function(a){return t(a,function(a){return l.test(a)?"xn--"+A(a):a})};v={version:"2.1.0",ucs2:{decode:u,encode:v},decode:z,encode:A,toASCII:C,toUnicode:B};g.exports=v}var i=!1;function j(){i||(i=!0,h());return g.exports}function a(a){switch(a){case void 0:return j()}}e.exports=a}),null);
__d("punycode",["punycode-2.1.1"],(function(a,b,c,d,e,f){e.exports=b("punycode-2.1.1")()}),null);
__d("WALinkify",["WALogger","WATopLevelDomains","punycode"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["text size: ",", error: ",""]);h=function(){return a};return a}e=Array.from(d("WATopLevelDomains").TLD).join("|");f="(?:http|https)://|mailto:";var i=/^https?:\/\/$/gi,j="\\w|[^\\s\0-\x7f\xab\xbb\u2018\u2019\u201c\u201d]|%[0-9a-f][0-9a-f]";e=e+"|xn--(?:"+j+")+";var k="(?:"+j+")|(?:"+j+")(?:"+j+"|-)*(?:"+j+")",l="(?!_)(?:(?:"+k+")\\.)+("+e+")(?!\\."+k+")",m=":\\d{1,5}",n="@!.?,(\\[{<\xab\u2018\u201c:";j="(?:"+j+"|[^\\s%])";var o="/"+j+"*?";n="["+n+"]*(?!"+j+"|#)";var p="\\?(?!"+n+")"+j+"*?";j="#"+j+"*?";var q="0-9a-z!#$%&'*+/=?^_`{|}~\\-";q="\\b\\w["+q+"]*(?:\\.["+q+"]+)*";var r="^|\\W\\.|[^/\\w.]|_";r="("+r+")("+f+")?("+q+"@)?("+l+")(?:(?!"+k+")|(?=_))(?:(?=[^:/?#])|("+m+")?("+o+")?("+p+")?("+j+")?(?="+n+"))";var s=1,t=2,u=3,v=4,w=5,x=6,y=7,z=8,A=9,B=new Map([[34,34],[41,40],[62,60],[93,91],[125,123],[187,171],[8217,8216],[8221,8220]]),C=new Map([[34,34],[40,41],[60,62],[91,93],[123,125],[171,187],[8216,8217],[8220,8221]]),D=new RegExp(""+r,"ig"),E=new RegExp("\\.(?:"+e+")","i");function F(a){try{return D.exec(a)}catch(b){d("WALogger").ERROR(h(),a.length,String(b)).devConsole(b).sendLogs("linkify-regex-error");return null}}function a(a,b){b===void 0&&(b=!1);if(!E.test(a))return[];D.lastIndex=0;var c=[],d;while(d=F(a)){d=H(d,b);d&&c.push(d)}return c}function G(a,b){b===void 0&&(b=!1);if(!E.test(a))return null;D.lastIndex=0;return H(F(a),b)}function H(a,b){b===void 0&&(b=!1);if(!a)return null;var e=a[s].length,f=a[0],g=a.index+e,h=a.index,j=a[s]==="_";if(j&&h-1&&/\S/.test(a.input[h-1]))return null;j=a[w];if(j&&j.startsWith("xn--")&&!d("WATopLevelDomains").TLD.has(c("punycode").toUnicode(j)))return null;if(a[x]){h=parseInt(a[x].slice(1),10);if(a[x][1]==="0"||!(0<h&&h<1<<16))return null}j=[A,z,y].find(function(b){return a&&a[b]})||0;if(j){h=[];var k=a[j];k.slice(-1)==="_"&&f[g-1]==="_"&&(f=f.slice(0,-1),a[j]=k=k.slice(0,-1));var l=0,m=0;for(var n=0;n<k.length;n++){var o=k.charCodeAt(n);o===m?(m=h.pop()||0,m===0&&(l=n)):C.has(o)?(m!==0&&h.push(m),m=C.get(o)):B.has(o)||m===0&&(l=n)}if(l!==k.length-1){o=a.slice(t,j);o.splice(w-t,1);f=o.filter(function(a){return a}).join("")+k.slice(0,l+1);D.lastIndex=g+f.length}else f=f.slice(e)}else f=f.slice(e);n=f;h=a[t];m=Boolean(h&&h.match(i));if(b&&!m)return null;h?h=h.toLowerCase():(n.toLowerCase().indexOf("irc.")===0?h="irc://":n.toLowerCase().indexOf("ftp.")===0?h="ftp://":a[u]?h="mailto:":h="http://",n=h+n);j=a[v];return{href:n,url:f,index:g,input:a.input,scheme:h,username:a[u],domain:j,port:a[x],path:a[y],params:a[z],anchor:a[A],isHttp:m}}function b(a){var b=G(a);return b&&b.url===a&&b.scheme==="mailto:"&&b.username!=null&&b.username!==""&&(b.params==null||b.params==="")&&(b.anchor==null||b.anchor==="")?b:null}g.findLinks=a;g.findLink=G;g.validateEmail=b}),98);
__d("WALanguagesAndRegions",[],(function(a,b,c,d,e,f){"use strict";a={fub:["237","235","234"],af:["237","27"],agq:["237"],yay:["234"],bss:["237"],agg:["675"],ast:["34"],avu:["243","211"],az:["994"],bkc:["237","241"],ksf:["237"],bfd:["237"],bjt:["221"],bcn:["234"],bas:["237"],bsq:["231"],bkv:["234"],bom:["234"],btt:["234"],bin:["234"],bmq:["226","223"],bs:["387","385","383","382","381"],fue:["229","228"],br:["33"],bys:["234"],bwr:["234"],cky:["234"],ca:["376","33","39","34"],tzm:["212"],fuq:["234"],ckl:["234"],asg:["234"],co:["33","39"],crh:["7"],hr:["387","385","383","382","381"],mfn:["234"],cs:["420","421"],dbq:["237","234"],dnj:["225","231"],dzg:["235","227"],ddn:["229"],dgh:["234"],dow:["237"],dua:["229"],nl:["297","32","599","31","1","597"],igb:["234"],etr:["675"],enn:["234"],kgy:["675"],et:["372"],ich:["234"],ee:["229","233","228"],ewo:["237"],fo:["298"],fmp:["237"],fi:["358","46"],fr:["32","229","226","257","237","1","236","242","243","235","269","253","240","33","241","509","225","352","261","223","377","227","250","221","248","41","228","678"],fur:["39"],ff:["237","224","222","221"],gaj:["675"],gl:["34"],gby:["234"],gba:["236"],gmm:["237"],de:["43","32","49","423","352","41"],tof:["675"],god:["225"],ank:["234"],gkn:["234"],gux:["229","226","227","228"],gde:["237","234"],gkp:["224"],kl:["299"],jgk:["234"],ha:["229","237","235","233","225","227","234","249","228"],haw:["1"],hbb:["234"],hu:["36"],dud:["234"],jab:["234"],iby:["234"],is:["354"],idu:["234"],ig:["240"],ige:["234"],ikx:["256"],ikk:["234"],ikq:["234"],smn:["358"],ga:["353","44"],atg:["234"],izi:["234"],dyo:["220","221"],jbu:["237","234"],kab:["213"],kea:["238"],tbd:["675"],hig:["234"],kai:["234"],kkj:["237","236","242"],kzr:["237","235"],naq:["264"],geb:["675"],okr:["234"],ksh:["49"],ses:["223"],khq:["223"],kun:["291","251"],kup:["675"],kub:["237","234"],kpe:["224","231"],nmg:["237","240"],ku:["963","90"],lkt:["1"],hia:["234"],lag:["255"],lv:["371"],lmp:["237"],ln:["242","243"],liv:[],lt:["370"],yaz:["234"],nds:["55","49","31"],dsb:["49"],lu:["243"],lb:["32","33","49","352"],mda:["234"],mb:["261"],mt:["356"],mi:["64"],arn:["56"],mas:["254","255"],ffm:["223"],mql:["229","228"],mbo:["237"],mbu:["234"],mif:["237"],mzm:["234"],mua:["237","235"],sur:["234"],nv:["1"],anc:["234"],nnh:["237"],jgo:["237"],fuv:["237","234"],nin:["234"],dgi:["226"],se:["358","46","47"],nso:["27"],ann:["234"],oc:["33","39","377","34"],pbi:["237"],pip:["234"],pl:["48"],pt:["244","55","238","240","245","853","258","351","239","670"],prg:[],fuf:["224","223","221","232"],qu:["54","591","57","593","51"],ro:["373","40"],cla:["234"],sav:["221"],sg:["236","235","243"],gd:["44"],seh:["258"],sr:["387","385","383","382","381"],sh:["387","385","383","382","381"],srr:["220","221"],sch:["39"],sld:["226"],sms:["358"],sk:["420","421"],sl:["386"],sok:["235"],es:["54","501","591","56","57","506","53","593","503","240","502","504","52","505","507","595","51","34","1","598","58"],srn:["597"],gsw:["43","33","49","423","41"],shi:["212"],tal:["234"],tmh:["223"],taq:["226","223"],tan:["234"],twq:["227"],blt:["856","84"],yer:["234"],tuq:["235","218","227","234"],ttr:["234"],tik:["237"],to:["676"],dts:["223"],kdl:["234"],tsw:["234"],tr:["90"],tk:["993"],hsb:["49"],vai:["231","232"],vi:["855","84"],vo:[],vut:["237","234"],wja:["234"],wa:["32"],wae:["43","39","423","41"],wji:["234"],cy:["44"],fy:["31"],fuh:["229","226","227"],yba:["234"],yav:["237"],yle:["675"],yll:["675"],yo:["229","234"],dje:["227"],gnd:["237"]};f.LANGUAGE_TO_REGIONS=a}),66);
__d("WAIdn",["WALanguagesAndRegions","WAStringz"],(function(a,b,c,d,e,f,g){"use strict";var h={:["ast","ksf","bas","ca","cs","dua","nl","ee","ewo","fo","fr","gl","kl","hu","is","ga","dyo","kea","kkj","nmg","lkt","lag","ln","lu","mas","nnh","jgo","pt","qu","seh","sk","es","to","vai","vi","wae","cy","fy","yav","yo"],:["af","agq","bss","bfd","bas","bkv","btt","nl","igb","ewo","fr","fur","gaj","gby","kl","jab","atg","jbu","kkj","naq","ksh","ku","nmb","lmp","ln","mda","mg","mas","mzm","jgo","nin","ann","ro","sg","scn","srn","yer","tr","wa","cy","yav","yle"],:["agg","ast","az","br","ca","co","cs","nl","etr","et","fr","gl","de","tof","god","hu","tbd","geb","ksh","kup","nds","lb","arn","oc","sg","sk","es","gsw","dts","tr","tk","vo","wa","wae","fy","yll"],:["mt"],:["agq","bss","bfd","bas","bkv","btt","ddn","igb","kjy","ich","gux","haw","jab","iby","idu","jbu","kub","nmg","lv","mda","mi","mas","mql","nin","prg","gd","to","yba","yav"],:["az","crh","tr"],:["lv"],:["dsb","nv","pl","hsb"],:["bs","hr","cs","dzg","et","fi","smn","geb","khq","ses","kun","lkt","lv","lt","dsb","se","nso","prg","sr","sh","sms","sk","sl","taq","twq","tuq","hsb","wqe","dje"],:["ckl","ank","ha","ikx","kai","hia","mbu","anc","nin","pip","tal","tan","wja","wji"],:["naq"],:["naq"],:["liv"],:["fmp","dud","tmh"],:["fub","yay","bkc","bjt","bcn","bas","bsq","bmq","fue","bys","bwr","cky","fuq","ckl","asg","dbq","dnj","dgh","dow","dua","enn","ff","gby","gba","gmm","ank","gde","gkp","jgk","ha","hbb","ikx","kkj","hig","kzr","kai","kpe","nmg","hia","ffm","mbo","mbu","mif","mzm","mua","sur","anc","fuv","nin","dgi","pbi","pip","fuf","cla","sav","srr","sld","sok","tal","tan","yer","ttr","tik","kdl","tsw","vai","vut","wja","wji","fuh","gnd"],:["tzm","kab","okr","shi","tmh","taq"],:["tzm","kab","shi"],:["tzm","kab","shi","tmh","taq"],:[],:["izi","yaz","blt","vi"],:["yay","bom","bin","mfn","dzg","igb","enn","gkn","iby","ikk","ikw","izi","okr","yaz","blt","tan","tuq","vi","yo"],:["avu","mfn","igb","enn","iby","ig","ige","ikk","ikw","izi","okr","blt","tan","vi"]},i=new Set(["abq","ab","ady","av","az","ba","be","bs","bg","bua","ce","ckt","cu","cv","crh","dar","dng","myv","evn","gag","inh","kbd","xal","krc","kaa","kk","kjh","kca","ky","kv","koi","kpy","kum","lbe","lez","mk","mns","chm","mdf","mn","ttt","gld","yrk","nog","os","ru","rue","sr","sh","cjs","alt","tab","tg","tt","tkr","tk","tyv","ude","udm","uk","uz","mrj","sah"]),j=new Set(["374","994","375","387","359","995","7","383","996","389","373","976","382","381","992","993","380","998"]),k="\u0430\u0432\u0433\u0435\u043a\u043c\u043d\u043e\u0440\u0441\u0442\u0443\u0445\u0448\u0449\u044c\u0455\u0456\u0458\u0461\u0475\u04af\u04bb\u04cf\u0501\u051b\u051d\u0527\ua699";function l(a){return i.has(a)}function m(a){return j.has(a)}function n(a){return k.includes(a)}var o=new RegExp("^[a-z0-9-]+$"),p=2;function a(a,b,c,e){a=a.split(".");var f,g=!1;a.forEach(function(a){g=!a.match(o);if(g)if(!f)f=a;else return null});if(f==null||g)return null;a=[];var i=!0,j=d("WAStringz").toArray(f);for(var k=0;k<j.length;k++){var q=j[k];i=i&&n(q);if(i)continue;if(h[q])if(a.length>=p)return null;else a.push(q)}if(i){if(m(c)||m(b))return null;return e.some(function(a){return l(a)})?null:new Set(j)}if(!a.length)return null;q=a.filter(function(a){var f=h[a];if(f==null)return!1;if(e.some(function(a){return f.includes(a)}))return!1;a=new Set();for(var g=0;g<f.length;g++){var i=d("WALanguagesAndRegions").LANGUAGE_TO_REGIONS[f[g]];if(i==null)continue;for(var j=0;j<i.length;j++)a.add(i[j])}return a.has(c)||a.has(b)?!1:!0});return q.length?new Set(q):null}g.findSuspiciousCharacters=a}),98);
__d("WASuspiciousLinks",["WAIdn","WAJids","WAPhoneUtils"],(function(a,b,c,d,e,f,g){"use strict";var h=/^(?:https?:\/\/)?([^/?#]+)(?:[/?#]|$)/i,i="ZZ";function a(a,b,c,e){a=a.match(h);a=a&&a[1];if(a==null)return null;c=d("WAPhoneUtils").phoneCC(c);var f;if(b==="whatsapp")f="";else{var g=d("WAJids").interpretAndValidateJid(b.toString());f=g.jidType!=="lidUser"?d("WAPhoneUtils").phoneCC(d("WAJids").toPhoneUserJid(b)):i}g=e.map(function(a){return a.toLowerCase()});return d("WAIdn").findSuspiciousCharacters(a,f,c,g)}g.findSuspiciousCharacters=a}),98);
__d("WAWebLinkify",["WALinkify","WASuspiciousLinks","WAWebJidUtils","WAWebUserPrefsMeUser"],(function(a,b,c,d,e,f,g){function a(a,b,c){b===void 0&&(b=!1);a=d("WALinkify").findLinks(a,b);return a.map(function(a){return i(a,c)})}function h(a,b,c){b===void 0&&(b=!1);a=d("WALinkify").findLink(a,b);if(a==null)return;return i(a,c)}function b(a){return a.body!=null&&h(a.body,!0)!=null}function i(a,b){var c=d("WAWebUserPrefsMeUser").getMaybeMeUser(),e=null;if(b&&c){b=b.isLid()?d("WAWebJidUtils").toLidUserJid(b.user):d("WAWebJidUtils").toPhoneUserJid(b.user);e=d("WASuspiciousLinks").findSuspiciousCharacters(a.domain,b,d("WAWebJidUtils").toPhoneUserJid(c.user),[])}return babelHelpers["extends"]({},a,{suspiciousCharacters:(b=e)!=null?b:void 0})}g.validateEmail=d("WALinkify").validateEmail;g.findLinks=a;g.findLink=h;g.hasHttpLink=b}),98);
__d("WAWebDBEncryptMultipleMsgs",["Promise","WAAsyncSleep","WALogger","WAWebBrokerGlobalAppState","WAWebDBMessageSerialization","WAWebDBMessageUtils","WAWebDbEncryptionKey","WAWebLinkify","WAWebSchemaMessage","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["processAndEncryptSingleMsgRow without throttle failed with error: ",", message: ",", stack: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["processAndEncryptSingleMsgRow failed for msg: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["processAndEncryptSingleMsgRow with throttle failed with error: ",", message: ",", stack: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["processAndEncryptSingleMsgRow failed for msg: ",""]);l=function(){return a};return a}var m=function(b){babelHelpers.inheritsLoose(a,b);function a(){var a,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(a=c=b.call.apply(b,[this].concat(e))||this,c.name="DroppingMsgRowDueToLogout",a)||babelHelpers.assertThisInitialized(c)}return a}(babelHelpers.wrapNativeSuper(Error));function a(a,b){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){c===void 0&&(c=!1);yield d("WAWebDbEncryptionKey").DbEncKeyStore.waitForFinalDbMsgEncKey();yield new(h||(h=b("Promise")))(function(a){return self.setTimeout(a,0)});if(c){c=[];for(var e=0;e<a.length;e++)try{var f=a[e];f=(yield o(f,e));c.push(f)}catch(b){if(b instanceof m)throw b;d("WALogger").DEV(l(),a[e].id.remote).tags("message-store");d("WALogger").ERROR(k(),b.name,b.message,b.stack).tags("message-store").devConsole(b)}}else{f=(yield (h||(h=b("Promise"))).all(a.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield o(a)["catch"](function(b){if(b instanceof m)throw b;d("WALogger").DEV(j(),a.id.remote).tags("message-store");d("WALogger").ERROR(i(),b.name,b.message,b.stack).tags("message-store").devConsole(b)})["finally"](function(){return void 0}));return b});return function(b){return a.apply(this,arguments)}}())));c=f.filter(Boolean)}return c});return n.apply(this,arguments)}function o(a,b){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){if(c("WAWebBrokerGlobalAppState").isLogoutInProgress)return(h||(h=b("Promise"))).reject(new m());e!=null&&(yield d("WAAsyncSleep").asyncSleepAfterGivenLoopIteration(e,35,100));e=d("WAWebSchemaMessage").getMessageTable();var f=d("WAWebDBMessageUtils").getVcardWids(a),g=d("WAWebDBMessageSerialization").dbRowFromMessage(a);e=(yield e.preflightEncryptSingleRecord(babelHelpers["extends"]({},g)));return[babelHelpers["extends"]({},g,e,{vcardWAids:f}),d("WAWebLinkify").hasHttpLink(a)]});return p.apply(this,arguments)}g.DroppingMsgRowDueToLogout=m;g.encryptMultipleDBMsgs=a;g.processAndEncryptSingleMsgRow=o}),98);
__d("WAPromiseMap",["Promise"],(function(a,b,c,d,e,f){"use strict";var g;function a(a,c){return(g||(g=b("Promise"))).resolve(a).then(function(a){return(g||(g=b("Promise"))).all(a.map(function(a,b){return c(a,b)}))})}f.promiseMap=a}),66);
__d("WAWebMsgDataUtils",["WANullthrows","WATimeUtils","WAWebAck","WAWebBizGatingUtils","WAWebBotTypes","WAWebCommonMsgUtils","WAWebMsgKey","WAWebMsgType","WAWebUserPrefsMeUser","WAWebWid","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a){var b=a.type,e=a.subtype,f;b===d("WAWebMsgType").MSG_TYPE.GP2?e==="subject"?f=d("WAWebCommonMsgUtils").EventType.NOTEWORTHY:e==="add"||e==="invite"||e==="invite_auto_add"||e==="linked_group_join"||e==="community_invite_auto_add_rich"?a.recipients&&d("WAWebUserPrefsMeUser").isMePrimary(a.recipients[0])?f=d("WAWebCommonMsgUtils").EventType.SIGNIFICANT:f=d("WAWebCommonMsgUtils").EventType.IGNORE:e==="linked_group_promote"||e==="linked_group_demote"?c("WAWebWid").isGroup(a.id.remote)&&a.recipients&&d("WAWebUserPrefsMeUser").isMePrimary(a.recipients[0])&&!d("WAWebUserPrefsMeUser").isMeAccount(a.author)?f=d("WAWebCommonMsgUtils").EventType.SIGNIFICANT:f=d("WAWebCommonMsgUtils").EventType.IGNORE:e==="remove"?a.recipients&&d("WAWebUserPrefsMeUser").isMePrimary(a.recipients[0])?f=d("WAWebCommonMsgUtils").EventType.NOTEWORTHY:f=d("WAWebCommonMsgUtils").EventType.IGNORE:e==="create"||e==="empty_subgroup_create"||e==="general_chat_add"?f=d("WAWebCommonMsgUtils").EventType.NOTEWORTHY:e==="created_subgroup_suggestion"?f=d("WAWebCommonMsgUtils").EventType.DEFAULT:e==="parent_group_link"||e==="auto_add"||e==="default_sub_group_admin_add"||e==="community_participant_add_rich"||e==="subgroup_admin_triggered_auto_add"||e==="subgroup_admin_triggered_invite_auto_add"||e==="sibling_group_link"||e==="community_invite_rich"||e==="sub_group_participant_add_rich"||e==="sub_group_invite_rich"||e==="community_link_parent_group_rich"?f=d("WAWebCommonMsgUtils").EventType.SIGNIFICANT:e==="membership_approval_request"||e==="created_membership_requests"?f=d("WAWebCommonMsgUtils").EventType.NOTEWORTHY:e==="sibling_group_unlink"?f=d("WAWebCommonMsgUtils").EventType.NOTEWORTHY:f=d("WAWebCommonMsgUtils").EventType.IGNORE:b===d("WAWebMsgType").MSG_TYPE.BROADCAST_NOTIFICATION||b===d("WAWebMsgType").MSG_TYPE.NOTIFICATION||b===d("WAWebMsgType").MSG_TYPE.E2E_NOTIFICATION?e==="create"?f=d("WAWebCommonMsgUtils").EventType.NOTEWORTHY:f=d("WAWebCommonMsgUtils").EventType.IGNORE:b===d("WAWebMsgType").MSG_TYPE.GROUPS_V4_INVITE&&d("WAWebUserPrefsMeUser").isMePrimary(a.from)?f=d("WAWebCommonMsgUtils").EventType.IGNORE:b===d("WAWebMsgType").MSG_TYPE.CALL_LOG?f=d("WAWebCommonMsgUtils").EventType.NOTEWORTHY:a.broadcast?c("WAWebWid").isBroadcast(a.id.remote)?f=d("WAWebCommonMsgUtils").EventType.NOTEWORTHY:f=d("WAWebCommonMsgUtils").EventType.IGNORE:b===d("WAWebMsgType").MSG_TYPE.REVOKED?f=d("WAWebCommonMsgUtils").EventType.IGNORE:c("WAWebWid").isPSA(a.id.remote)?f=a.ack===d("WAWebAck").ACK.RECEIVED?d("WAWebCommonMsgUtils").EventType.DEFAULT:d("WAWebCommonMsgUtils").EventType.AMBIENT:b===d("WAWebMsgType").MSG_TYPE.CIPHERTEXT||b===d("WAWebMsgType").MSG_TYPE.OVERSIZED?f=d("WAWebCommonMsgUtils").EventType.AMBIENT:b===d("WAWebMsgType").MSG_TYPE.NOTIFICATION_TEMPLATE?e==="sender_invite"||(e==="chat_assignment"||e==="chat_assignment_unassign")&&d("WAWebBizGatingUtils").shouldReorderChatOnAssignment(e==="chat_assignment_unassign")?f=d("WAWebCommonMsgUtils").EventType.NOTEWORTHY:f=d("WAWebCommonMsgUtils").EventType.IGNORE:b===d("WAWebMsgType").MSG_TYPE.PROTOCOL&&e==="ephemeral_setting"?f=d("WAWebCommonMsgUtils").EventType.IGNORE:b===d("WAWebMsgType").MSG_TYPE.REACTION?f=d("WAWebCommonMsgUtils").EventType.IGNORE:f=d("WAWebCommonMsgUtils").EventType.DEFAULT;return f}function e(a,b){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e=a.id,f=c("WANullthrows")(d("WAWebUserPrefsMeUser").getMaybeMeLidUser()),g=a.id.isLid()?f:d("WAWebUserPrefsMeUser").getMaybeMeUser(),h=void 0;if(a.isGroup){var i;g=((i=a.groupMetadata)==null?void 0:i.isLidAddressingMode)===!0?f:d("WAWebUserPrefsMeUser").getMaybeMeUser();h=d("WAWebWidFactory").toUserWid(g)}else a.id.isStatusV3()&&(h=d("WAWebUserPrefsMeUser").assertGetMeUser());i=new(c("WAWebMsgKey"))({from:g,to:e,id:yield c("WAWebMsgKey").newId(),participant:h,selfDir:"out"});h=(f=a.contact.businessProfile)==null?void 0:f.automatedType;var j;if(h)switch(h){case d("WAWebBotTypes").BizBotAutomatedType.PARTIAL_1P:j=d("WAWebBotTypes").BizBotType.BIZ_1P;break;case d("WAWebBotTypes").BizBotAutomatedType.FULL_3P:j=d("WAWebBotTypes").BizBotType.BIZ_3P;break;case d("WAWebBotTypes").BizBotAutomatedType.UNKNOWN:j=null}return{id:i,from:c("WANullthrows")(g),to:e,type:b,t:d("WATimeUtils").unixTime(),isNewMsg:!0,local:!0,ack:d("WAWebAck").ACK.CLOCK,bizBotType:j}});return h.apply(this,arguments)}g.eventTypeFromMsgType=a;g.genOutgoingMsgData=e}),98);
__d("WAWebNewsletterDBConstants",["$InternalEnum"],(function(a,b,c,d,e,f){a=b("$InternalEnum")({Subscriber:0,Admin:1,Guest:2,Owner:3});f.NewsletterDBMembership=a}),66);
__d("WAWebNewsletterDBUtils",["WAWebApiChat","WAWebDBMessageSerialization","WAWebDBMessageUtils","WAWebJidToWid","WAWebMsgKey","WAWebNewsletterDBConstants","WAWebSchemaMessage","WAWebSchemaNewsletterMetadata","WAWebWid","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){return(yield d("WAWebApiChat").getChatRecord(d("WAWebJidToWid").newsletterJidToWid(a)))!=null});return h.apply(this,arguments)}function i(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("WAWebSchemaNewsletterMetadata").getNewsletterMetadataTable().get(a));return a==null||a.membershipType===d("WAWebNewsletterDBConstants").NewsletterDBMembership.Guest});return j.apply(this,arguments)}function e(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield i(a));return!a});return k.apply(this,arguments)}var l=Number.MAX_SAFE_INTEGER-1e4;function f(a,b){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){b=d("WAWebDBMessageUtils").craftInternalId(b,a);a=(yield d("WAWebSchemaMessage").getMessageTable().anyOf(["internalId"],[b]));b=a[0];return b==null?null:d("WAWebDBMessageSerialization").messageFromDbRow(b)});return m.apply(this,arguments)}function n(a,b){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=new Map(),e=new Map(a.map(function(a){return[d("WAWebDBMessageUtils").craftInternalId(b,a),a]}));a=(yield d("WAWebSchemaMessage").getMessageTable().anyOf(["internalId"],Array.from(e.keys())));a.forEach(function(a){if(a.internalId==null)return;var b=e.get(a.internalId);if(b==null)return;c.set(b,d("WAWebDBMessageSerialization").messageFromDbRow(a))});return c});return o.apply(this,arguments)}function p(a,b){b=b instanceof c("WAWebWid")?b:d("WAWebWidFactory").createWid(b);return new(c("WAWebMsgKey"))({remote:b,fromMe:!0,id:a.toString(10)})}function q(a){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=d("WAWebDBMessageUtils").craftInternalId(a.toJid(),l);a=d("WAWebDBMessageUtils").endOfChat(a);b=(yield d("WAWebSchemaMessage").getMessageTable().between(["internalId"],b,a,{lowerInclusive:!0,upperInclusive:!1,limit:1,reverse:!0}));if(b.length===0)return l;if(b[0].internalId==null)return l;a=d("WAWebDBMessageUtils").getInChatMsgId(b[0].internalId);return Math.min(a+1,Number.MAX_SAFE_INTEGER)});return r.apply(this,arguments)}function s(a){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("WAWebSchemaMessage").getMessageTable().bulkGet(a.map(String)));a=a.filter(Boolean).map(function(a){return{id:a.id,viewed:!0}});yield d("WAWebSchemaMessage").getMessageTable().bulkCreateOrMerge(a)});return t.apply(this,arguments)}g.doesNewsletterExistInStorage=a;g.isPreviewNewsletter=i;g.isSubscribedNewsletter=e;g.TEMPORARY_SERVER_ID_LOWER_BOUND=l;g.getMessageByServerId=f;g.bulkGetMessagesByServerIds=n;g.craftNewsletterMsgKeyFromServerId=p;g.getTemporaryServerId=q;g.updateMsgViewReceipt=s}),98);
__d("WAWebPrimaryFeaturesModel",["WAWebBaseModel"],(function(a,b,c,d,e,f,g){a=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,c;for(var e=arguments.length,f=new Array(e),g=0;g<e;g++)f[g]=arguments[g];return(b=c=a.call.apply(a,[this].concat(f))||this,c.features=d("WAWebBaseModel").prop(),c.ddmSettings=d("WAWebBaseModel").prop(!1),c.clearAndDeleteChatSync=d("WAWebBaseModel").prop(!1),c.viewOnceSpReceiver=d("WAWebBaseModel").prop(!1),c.recentSticker=d("WAWebBaseModel").prop(!1),c.favoriteSticker=d("WAWebBaseModel").prop(!1),c.linkPreview=d("WAWebBaseModel").prop(!1),c.hqLinkPreview=d("WAWebBaseModel").prop(!1),c.pollCreationInCags=d("WAWebBaseModel").prop(!1),c.newsletter=d("WAWebBaseModel").prop(!1),c.externalWebBetaOptIn=d("WAWebBaseModel").prop(!1),c.historySyncOnDemand=d("WAWebBaseModel").prop(!1),c.webLinkPreviewNseSupport=d("WAWebBaseModel").prop(!1),c.messagePlaceholderResendNseSupport=d("WAWebBaseModel").prop(!1),c.isPrimaryBetaBuild=d("WAWebBaseModel").prop(!1),c.primaryCampaignIdInHistorySyncSupport=d("WAWebBaseModel").prop(!1),c.contactManagement=d("WAWebBaseModel").prop(!1),c.paymentInfoSyncSupport=d("WAWebBaseModel").prop(!1),c.customPaymentMethodsSyncSupport=d("WAWebBaseModel").prop(!1),b)||babelHelpers.assertThisInitialized(c)}var c=b.prototype;c.setPrimaryFeatures=function(a){this.features=a;a=new Set(a);this.ddmSettings=a.has("ddm_settings");this.clearAndDeleteChatSync=a.has("clear_and_delete_chat_sync");this.viewOnceSpReceiver=a.has("vo_sp_receiver");this.recentSticker=a.has("recent_sticker");this.favoriteSticker=a.has("favorite_sticker");this.linkPreview=a.has("link_preview");this.hqLinkPreview=a.has("link_preview_hq_thumbnail");this.pollCreationInCags=a.has("poll_creation_cag");this.newsletter=a.has("newsletter");this.externalWebBetaOptIn=a.has("external_web_beta_opt_in");this.historySyncOnDemand=a.has("history_sync_on_demand");this.webLinkPreviewNseSupport=a.has("web_link_preview_nse_support");this.messagePlaceholderResendNseSupport=a.has("message_placeholder_resend_nse_support");this.isPrimaryBetaBuild=a.has("is_primary_beta_build");this.primaryCampaignIdInHistorySyncSupport=a.has("primary_campaign_id_in_history_sync_support");this.contactManagement=a.has("contact_management");this.paymentInfoSyncSupport=a.has("payment_info_sync_support");this.customPaymentMethodsSyncSupport=a.has("custom_payment_methods_sync_support")};return b}(d("WAWebBaseModel").BaseModel);a.Proxy="primaryFeatures";b=d("WAWebBaseModel").defineModel(a);c=new b({id:"1"});g.PrimaryFeaturesClass=a;g.PrimaryFeatures=c}),98);
__d("WAWebUserPrefsHistorySync",["WALogger","WATimeUtils","WAWebPermanentStorage","WAWebProtobufsHistorySync.pb","WAWebUserPrefsIndexedDBStorage","WAWebUserPrefsKeys","WAWebUserPrefsMultiDevice","WAWebUserPrefsStore","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[history sync] set recent sync single chunk "," status to ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[history sync] set last history sync chunk with chunk order ",""]);i=function(){return a};return a}function a(a,b,c){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){if(a==null||b==null)return;a===d("WAWebProtobufsHistorySync.pb").HistorySync$HistorySyncType.RECENT&&(d("WALogger").LOG(i(),b),yield d("WAWebUserPrefsIndexedDBStorage").userPrefsIdb.set(d("WAWebUserPrefsKeys").BACKEND_ONLY_KEYS.MD_HISTORY_LAST_RECENT_SYNC_CHUNK_PROCESSED,{chunkOrder:b,progress:e}));yield d("WAWebUserPrefsIndexedDBStorage").userPrefsIdb.set(d("WAWebUserPrefsKeys").BACKEND_ONLY_KEYS.MD_HISTORY_LAST_CHUNK_PROCESSED,a+"_"+b);c("WAWebUserPrefsStore").set(d("WAWebUserPrefsKeys").MD_KEYS.MD_HISTORY_LAST_CHUNK_PROCESSED,a+"_"+b,{shouldWriteToIdb:!1})});return j.apply(this,arguments)}function e(){var a=d("WAWebUserPrefsIndexedDBStorage").userPrefsIdb.get(d("WAWebUserPrefsKeys").BACKEND_ONLY_KEYS.MD_HISTORY_LAST_CHUNK_PROCESSED);return a}function f(){var a=d("WAWebUserPrefsIndexedDBStorage").userPrefsIdb.get(d("WAWebUserPrefsKeys").BACKEND_ONLY_KEYS.MD_HISTORY_LAST_RECENT_SYNC_CHUNK_PROCESSED);return a}function k(){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield d("WAWebUserPrefsIndexedDBStorage").userPrefsIdb.set(d("WAWebUserPrefsKeys").BACKEND_ONLY_KEYS.INITIAL_HISTORY_SYNCED,!0);return c("WAWebUserPrefsStore").set(d("WAWebUserPrefsKeys").MD_KEYS.INITIAL_HISTORY_SYNCED,"true",{shouldWriteToIdb:!1})});return l.apply(this,arguments)}function m(){var a=d("WAWebUserPrefsIndexedDBStorage").userPrefsIdb.get(d("WAWebUserPrefsKeys").BACKEND_ONLY_KEYS.INITIAL_HISTORY_SYNCED);return a===!0}function n(){return!!c("WAWebUserPrefsStore").get(d("WAWebUserPrefsKeys").MD_KEYS.INITIAL_HISTORY_SYNCED,{storage:c("WAWebPermanentStorage")})}function o(a){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b;b=(b=(yield q()))!=null?b:{};yield d("WAWebUserPrefsIndexedDBStorage").userPrefsIdb.set(d("WAWebUserPrefsKeys").BACKEND_ONLY_KEYS.HISTORY_SYNC_STATUS,babelHelpers["extends"]({},b,a));c("WAWebUserPrefsStore").set(d("WAWebUserPrefsKeys").MD_KEYS.HISTORY_SYNC_STATUS,babelHelpers["extends"]({},b,a),{shouldWriteToIdb:!1})});return p.apply(this,arguments)}function q(){var a=d("WAWebUserPrefsIndexedDBStorage").userPrefsIdb.get(d("WAWebUserPrefsKeys").BACKEND_ONLY_KEYS.HISTORY_SYNC_STATUS);return a}function r(a){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("WAWebUserPrefsIndexedDBStorage").userPrefsIdb.set(d("WAWebUserPrefsKeys").BACKEND_ONLY_KEYS.HISTORY_SYNC_CHUNK_COUNT_FOR_END_OF_RECENT_SYNC,a)});return s.apply(this,arguments)}function t(){var a;return(a=d("WAWebUserPrefsIndexedDBStorage").userPrefsIdb.get(d("WAWebUserPrefsKeys").BACKEND_ONLY_KEYS.HISTORY_SYNC_CHUNK_COUNT_FOR_END_OF_RECENT_SYNC))!=null?a:0}function u(a){return v.apply(this,arguments)}function v(){v=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("WAWebUserPrefsIndexedDBStorage").userPrefsIdb.set(d("WAWebUserPrefsKeys").BACKEND_ONLY_KEYS.ESTIMATED_HISTORY_SYNC_CHUNK_COUNT_FOR_END_OF_RECENT_SYNC,a)});return v.apply(this,arguments)}function w(){var a=d("WAWebUserPrefsIndexedDBStorage").userPrefsIdb.get(d("WAWebUserPrefsKeys").BACKEND_ONLY_KEYS.ESTIMATED_HISTORY_SYNC_CHUNK_COUNT_FOR_END_OF_RECENT_SYNC);return(a=a)!=null?a:0}function x(){var a=c("WAWebUserPrefsStore").get(d("WAWebUserPrefsKeys").MD_KEYS.HISTORY_SYNC_REMAINING_PAUSED_SECONDS);if(typeof a==="number")return a}function y(a){c("WAWebUserPrefsStore").set(d("WAWebUserPrefsKeys").MD_KEYS.HISTORY_SYNC_REMAINING_PAUSED_SECONDS,a)}function z(){var a=c("WAWebUserPrefsStore").get(d("WAWebUserPrefsKeys").KEYS.HISTORY_SYNC_EARLIEST_DATE);if(typeof a!=="number"||a===0){var b;b=(b=d("WAWebUserPrefsMultiDevice").getPairingTimestamp())!=null?b:d("WATimeUtils").unixTime();var e=c("gkx")("26254")?90*d("WATimeUtils").DAY_SECONDS:d("WATimeUtils").YEAR_SECONDS;return b-e}return a}function A(a){c("WAWebUserPrefsStore").set(d("WAWebUserPrefsKeys").KEYS.HISTORY_SYNC_EARLIEST_DATE,a)}function B(a,b,c){return C.apply(this,arguments)}function C(){C=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){if(c==null||a!==d("WAWebProtobufsHistorySync.pb").HistorySync$HistorySyncType.RECENT)return;d("WALogger").LOG(h(),c,b);c=(a={},a[c]=b,a);a=(b=(yield D()))!=null?b:{};yield d("WAWebUserPrefsIndexedDBStorage").userPrefsIdb.set(d("WAWebUserPrefsKeys").BACKEND_ONLY_KEYS.HISTORY_SYNC_SINGLE_CHUNK_STATUS,babelHelpers["extends"]({},a,c))});return C.apply(this,arguments)}function D(){var a=d("WAWebUserPrefsIndexedDBStorage").userPrefsIdb.get(d("WAWebUserPrefsKeys").BACKEND_ONLY_KEYS.HISTORY_SYNC_SINGLE_CHUNK_STATUS);return a}function E(a){c("WAWebUserPrefsStore").setUser(d("WAWebUserPrefsKeys").KEYS.INITIAL_HIST_BOUNDARY,JSON.stringify(a))}function F(){var a=c("WAWebUserPrefsStore").getUser(d("WAWebUserPrefsKeys").KEYS.INITIAL_HIST_BOUNDARY);if(typeof a!=="string")return null;var b;try{b=JSON.parse(a)}catch(a){return null}if(b==null||typeof b!=="object"||b instanceof Array)return null;b;var e={};Object.entries(b).forEach(function(a){var b=a[0];a=a[1];typeof a==="number"&&(e[b]=a)});return e}function G(a){return H.apply(this,arguments)}function H(){H=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("WAWebUserPrefsIndexedDBStorage").userPrefsIdb.set(d("WAWebUserPrefsKeys").BACKEND_ONLY_KEYS.HISTORY_SYNC_STATUS_AFTER_PAIRING_LOGGING_COUNT,a)});return H.apply(this,arguments)}function I(){var a=d("WAWebUserPrefsIndexedDBStorage").userPrefsIdb.get(d("WAWebUserPrefsKeys").BACKEND_ONLY_KEYS.HISTORY_SYNC_STATUS_AFTER_PAIRING_LOGGING_COUNT);return a}function J(a){return K.apply(this,arguments)}function K(){K=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b;b=(b=L())!=null?b:0;yield d("WAWebUserPrefsIndexedDBStorage").userPrefsIdb.set(d("WAWebUserPrefsKeys").BACKEND_ONLY_KEYS.HISTORY_SYNC_TOTAL_PROCESSED_MESSAGE_COUNT,b+a)});return K.apply(this,arguments)}function L(){var a=d("WAWebUserPrefsIndexedDBStorage").userPrefsIdb.get(d("WAWebUserPrefsKeys").BACKEND_ONLY_KEYS.HISTORY_SYNC_TOTAL_PROCESSED_MESSAGE_COUNT);return a}g.setLastHistorySyncedChunk=a;g.getLastHistorySyncedChunk=e;g.getLastHistoryRecentSyncedChunk=f;g.setInitialHistorySyncComplete=k;g.getInitialHistorySyncComplete=m;g.getInitialHistorySyncCompleteLocalStorage=n;g.setHistorySyncStatus=o;g.getHistorySyncStatus=q;g.setChunkCountForEndOfRecentHistorySync=r;g.getChunkCountForEndOfRecentHistorySync=t;g.setEstimatedChunkCountForEndOfRecentHistorySync=u;g.getEstimatedChunkCountForEndOfRecentHistorySync=w;g.getHistorySyncRemainingPausedSeconds=x;g.setHistorySyncRemainingPausedSeconds=y;g.getHistorySyncEarliestDate=z;g.setHistorySyncEarliestDate=A;g.setRecentSyncSingleChunkStatus=B;g.getRecentSyncSingleChunkStatus=D;g.setHistoryInitialSyncBoundary=E;g.getHistoryInitialSyncBoundary=F;g.setHistorySyncStatusAfterPairingLoggingCount=G;g.getHistorySyncStatusAfterPairingLoggingCount=I;g.setHistorySyncTotalProcessedMessageCount=J;g.getHistorySyncTotalProcessedMessageCount=L}),98);
__d("WAWebSyncGatingUtils",["WALogger","WAWebABProps","WAWebMobilePlatforms","WAWebPrimaryFeaturesModel","WAWebUserPrefsHistorySync","gkx"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[rdu] History sync on demand feature is disabled as initial sync is incomplete or initial sync boundary is not available"]);h=function(){return a};return a}function a(){if(c("gkx")("26255")||!d("WAWebPrimaryFeaturesModel").PrimaryFeatures.historySyncOnDemand)return!1;var a=d("WAWebUserPrefsHistorySync").getInitialHistorySyncCompleteLocalStorage(),b=d("WAWebUserPrefsHistorySync").getHistoryInitialSyncBoundary();if(a&&(b==null||Object.keys(b).length===0)){d("WALogger").LOG(h());return!1}a=d("WAWebMobilePlatforms").getMobilePlatform()===d("WAWebMobilePlatforms").PLATFORMS.ANDROID||d("WAWebMobilePlatforms").getMobilePlatform()===d("WAWebMobilePlatforms").PLATFORMS.SMBA;return a&&d("WAWebPrimaryFeaturesModel").PrimaryFeatures.isPrimaryBetaBuild&&d("WAWebABProps").getABPropConfigValue("history_sync_on_demand_with_android_beta")?!0:d("WAWebABProps").getABPropConfigValue("history_sync_on_demand")}function b(){return d("WAWebPrimaryFeaturesModel").PrimaryFeatures.historySyncOnDemand}function e(){return d("WAWebABProps").getABPropConfigValue("placeholder_message_resend")}function f(){return!c("gkx")("26255")}function i(){return d("WAWebPrimaryFeaturesModel").PrimaryFeatures.webLinkPreviewNseSupport}function j(){return d("WAWebPrimaryFeaturesModel").PrimaryFeatures.messagePlaceholderResendNseSupport}function k(){return d("WAWebABProps").getABPropConfigValue("web_noncritical_history_sync_message_processing_break_iteration")}function l(){return d("WAWebABProps").getABPropConfigValue("web_recent_sync_handling_loop_restart_v2_enabled")}function m(){return d("WAWebABProps").getABPropConfigValue("web_recent_sync_chunk_download_optimization")}function n(){return d("WAWebABProps").getABPropConfigValue("web_recent_sync_worker_compatible_handling")}function o(){return d("WAWebABProps").getABPropConfigValue("web_recent_sync_next_chunk_fetch_optimization")}g.isHistorySyncOnDemandEnabled=a;g.shouldPopulateStarMessageWithTimestamp=b;g.isPlaceholderMessageResendEnabled=e;g.isHistorySyncWithoutMmsEnabled=f;g.isWebLinkPreviewNseSupportEnabled=i;g.isMessagePlaceholderResendNseSupportEnabled=j;g.getRecentSyncMessageProcessingBreakIteration=k;g.isHistorySyncHandlingRestartV2Enabled=l;g.isRecentSyncDownloadOptimizationEnabled=m;g.isRecentSyncWorkerComaptibleHandlingEnabled=n;g.isRecentSyncNextChunkFetchOptimizationEnabled=o}),98);
__d("WAWebDBStoreMessage",["Promise","WAJids","WALogger","WAPromiseMap","WAWeb-dexie","WAWebCommonMsgUtils","WAWebDBMessageSerialization","WAWebDBMessageUtils","WAWebDBMsgUtils","WAWebLinkify","WAWebModelStorageUtils","WAWebMsgDataUtils","WAWebMsgGetters","WAWebMsgKey","WAWebMsgType","WAWebNewsletterDBUtils","WAWebSchemaFtsIndexingQueue","WAWebSyncGatingUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": completed in ","ms"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": completed in ","ms"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": "," in ","ms"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": start"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[process-msg] craftMessageRangeIndex failed with error ",""]);m=function(){return a};return a}var n=1e9;function o(a){return a.some(function(a){return a.type!==d("WAWebMsgType").MSG_TYPE.NOTIFICATION_TEMPLATE})}function a(a,e,f){f===void 0&&(f=!1);var g=e==null?a[0].id.remote:e,i=d("WAWebDBMessageUtils").beginningOfChat(g),j=d("WAWebDBMessageUtils").endOfChat(g),k=s("storeMessageInTransaction: "+a.length+" message(s), chat "+((g==null?void 0:g.toString())||"-"));return d("WAWebModelStorageUtils").getStorage().lock(["chat","message"],function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(c){var e=c[0];c=c[1];k.addStage("got table lock");var l=(yield e.get(g.toString()));k.addStage("got chat");if(!g.isStatusV3()&&(l!=null||o(a))){l=q(l,a,g);yield e.createOrMerge(g.toString(),l)}k.addStage("got messages meta");e=c.all({reverse:!f,limit:1,index:["rowId"],returnKeyType:"keys"}).then(function(a){k.addStage("got boundary row id");return a.length===0?n:a[0]});l=c.between(["internalId"],i,j,{limit:1,reverse:!f,returnKeyType:"keys"}).then(function(a){k.addStage("got chat msg boundary id");return a.length===0?n:d("WAWebDBMessageUtils").getInChatMsgId(a[0])});e=(yield (h||(h=b("Promise"))).all([e,l]));l=e[0];e=e[1];k.addStage("got boundaries");var m=f?l-a.length:l+1,s=f?e-a.length:e+1,t=(yield d("WAPromiseMap").promiseMap(a,function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=d("WAWebDBMessageSerialization").dbRowFromMessage(a),e=!f&&(yield p(a.id,a));return r({msg:c,chatId:g.toString(),hasLink:d("WAWebLinkify").hasHttpLink(a),rowId:m+b,inChatMsgId:d("WAWebMsgGetters").getIsNewsletterMsg(a)?(c=a.serverId)!=null?c:yield d("WAWebNewsletterDBUtils").getTemporaryServerId(g):s+b,pendingReadReceipt:e})});return function(b,c){return a.apply(this,arguments)}}()));k.addStage("messages ready for storing in db");return c.bulkCreate(t).then(function(){return t})});return function(a){return c.apply(this,arguments)}}()).then(function(a){k.done(),c("WAWeb-dexie").ignoreTransaction(function(){d("WAWebSchemaFtsIndexingQueue").getFtsIndexingQueueTable().bulkCreateOrReplace(a.map(function(a){return{id:String(a.rowId)}}))})})}function p(a,b){if(a.fromMe||a.remote.isStatusV3())return!1;a=d("WAWebMsgDataUtils").eventTypeFromMsgType(b);return a===d("WAWebCommonMsgUtils").EventType.AMBIENT||a===d("WAWebCommonMsgUtils").EventType.DEFAULT}function q(a,b,c){var e,f=void 0,g=Math.max(0,(e=a==null?void 0:a.unreadCount)!=null?e:0),h=(e=a==null?void 0:a.unreadMentionsOfMe)!=null?e:[];b.forEach(function(a){var b=d("WAWebMsgDataUtils").eventTypeFromMsgType(a);if(b===d("WAWebCommonMsgUtils").EventType.IGNORE)return;a&&a.t!=null&&((f==null||a.t>f)&&(f=a.t));(b===d("WAWebCommonMsgUtils").EventType.AMBIENT||b===d("WAWebCommonMsgUtils").EventType.DEFAULT)&&!a.id.fromMe&&(g+=1);b=p(a.id,a);if(b&&d("WAWebMsgGetters").getIsImportantMessage(a)){b={id:a.id.toString(),timestamp:a.t};h.push(b)}});a&&a.t!=null&&((f==null||a.t>f)&&(f=a.t));return{id:c.toString(),unreadCount:g,t:f,unreadMentionsOfMe:h}}function r(a){var b=a.msg,e=a.chatId,f=a.hasLink,g=a.rowId,h=a.inChatMsgId;a=a.pendingReadReceipt;var i=[d("WAWebMsgType").MSG_TYPE.IMAGE,d("WAWebMsgType").MSG_TYPE.VIDEO,d("WAWebMsgType").MSG_TYPE.AUDIO].includes(b.type),j=d("WAWebSyncGatingUtils").shouldPopulateStarMessageWithTimestamp()?b.t:g;f=babelHelpers["extends"]({},b,{vcardWAids:b.vcardWAids||d("WAWebDBMessageUtils").getVcardWids(b),id:b.id.toString(),isStarred:b.star?j:void 0,hasLink:b.type==="chat"&&f?g:void 0,isMediaMsg:i?g:void 0,isDocMsg:b.type===d("WAWebMsgType").MSG_TYPE.DOCUMENT?g:void 0,isCarouselMsg:b.carouselCardsParsed!=null?g:void 0,expiredTimestamp:(j=d("WAWebMsgGetters").getEphemeralExpirationTimestamp(b))!=null?j:void 0});g!=null&&(f.rowId=g);h!=null&&(f.internalId=d("WAWebDBMessageUtils").craftInternalId(e,h));a&&e!==d("WAJids").STATUS_JID&&(f.pendingReadReceipt=d("WAWebDBMsgUtils").PendingReadReceiptType.Message);i=b.c2sTimestamp;if(b.id.fromMe){i=(j=b.c2sTimestamp)!=null?j:b.t}else i=b.t;try{b.type!==d("WAWebMsgType").MSG_TYPE.REACTION&&(f.messageRangeIndex=d("WAWebDBMessageUtils").craftMessageRangeIndex(e,!c("WAWebMsgKey").fromString(b.id).fromMe,d("WAWebMsgType").SYSTEM_MESSAGE_TYPES.includes(b.type),i))}catch(a){d("WALogger").ERROR(m(),a)}return f}function s(a){d("WALogger").DEV(l(),a);var b=5e3,c=Date.now(),e=[];return{addStage:function(a){e.push([a,Date.now()-c])},done:function(){if(Date.now()-c>b){for(var f of e){var g=f[0],h=f[1];d("WALogger").DEV(k(),a,g,h)}d("WALogger").WARN(j(),a,Date.now()-c)}else d("WALogger").DEV(i(),a,Date.now()-c)}}}g.storeMessageInTransaction=a;g.isPendingUnreadReceipt=p;g.addMsgMetadataToMsgRow=r}),98);
__d("WAWebDBStoreMsgsUtils",[],(function(a,b,c,d,e,f){var g=1e9;function a(a,b){b===void 0&&(b=!1);return a.all({reverse:!b,limit:1,index:["rowId"],returnKeyType:"keys"}).then(function(a){return a.length===0?g:a[0]})}f.INLINE_MESSAGE_STARTING_INDEX=g;f.getLastRowId=a}),66);
__d("WAWebDBStoreNewsletterEncryptedMsgs",["WALogger","WAPromiseMap","WAWebDBStoreMessage","WAWebDBStoreMsgsUtils","WAWebModelStorageUtils","WAWebMsgKey","WAWebNewsletterDBUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[newsletter-store] Failed to store messages"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[newsletter][storage] serverId is missing from message"]);i=function(){return a};return a}function a(a){return d("WAWebModelStorageUtils").getStorage().lock(["message","chat"],function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(e){e=e[0];var f=(yield d("WAWebDBStoreMsgsUtils").getLastRowId(e)),g=(yield d("WAPromiseMap").promiseMap(a,function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e,g=a[0];a=a[1];e=(e=g.serverId)!=null?e:yield d("WAWebNewsletterDBUtils").getTemporaryServerId(g.to);if(e==null){d("WALogger").ERROR(i()).tags("newsletter").devConsole(g).sendLogs("newsletter-missing-serverId");return null}var h=c("WAWebMsgKey").fromString(g.id),j=(yield d("WAWebDBStoreMessage").isPendingUnreadReceipt(h,g));g=d("WAWebDBStoreMessage").addMsgMetadataToMsgRow({msg:g,chatId:h.remote.toString(),hasLink:a,inChatMsgId:e,rowId:f+b+1,pendingReadReceipt:j});delete g.serverId;return g});return function(b,c){return a.apply(this,arguments)}}())).filter(Boolean);try{yield e.bulkCreateWith_ALREADY_ENCRYPTED_RECORDS_ONLY(g)}catch(a){d("WALogger").ERROR(h()).tags("newsletter").devConsole(a)}});return function(a){return e.apply(this,arguments)}}())}g.storeEncryptedNewsletterMessages=a}),98);
__d("WAWebUpdateDuplicatedLidThread",["WALogger","WAWebApiChat","WAWebApiContact","WAWebPnhGatingUtils","WAWebSchemaChat","WAWebWid","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["updateChatIsDeprecatedBulk: deprecating lid chats "]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["updateChatIsDeprecatedBulk - true: deprecated "," chats during offline resume"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["shouldDeprecateLidThread: called with deprecated chatid"]);j=function(){return a};return a}function a(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(!d("WAWebPnhGatingUtils").isMatFullyEnabled())return;var b=[],e=a.filter(function(a){return a!=null&&c("WAWebWid").isLid(a.id)&&!a.isDeprecated}),f=d("WAWebApiContact").getAlternateWidBulkForLids(e.map(function(a){return a.id.toString()}));e.forEach(function(c){var d;d=l(c,(d=f.get(c.id.toString()))!=null?d:[],a);d&&b.push({id:c.id.toString(),isDeprecated:!0})});if(b.length===0)return;yield d("WAWebSchemaChat").getChatTable().bulkCreateOrMerge(b).then(function(){d("WALogger").LOG(i(),b.length),d("WALogger").WARN(h()).sendLogs("deprecating-lid-chat-pnh-ctwa-mat")})});return k.apply(this,arguments)}function l(a,b,e){if(!c("WAWebWid").isLid(a.id)||b.length===0)return!1;if(a.isDeprecated===!0){d("WALogger").WARN(j()).sendLogs("deprecating-lid-chat-pnh-ctwa-mat");return!0}b=b.some(function(a){return e.some(function(b){return(b==null?void 0:b.id)===a})});b&&d("WAWebApiChat").updateDeprecatedChatMatCache(d("WAWebWidFactory").createWid(a.id),b);return b}g.updateDuplicatedLidThreadBulk=a;g.shouldDeprecateLidThread=l}),98);
__d("WAWebDBMessageBulkHelper",["Promise","WAJids","WALogger","WAWebApiContact","WAWebDBEncryptMultipleMsgs","WAWebDBStoreEncryptedMsgs","WAWebDBStoreNewsletterEncryptedMsgs","WAWebModelStorageUtils","WAWebMsgGetters","WAWebPnhGatingUtils","WAWebSchemaChat","WAWebUpdateDuplicatedLidThread","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][msg-cache]: storing chat updates: ",""]);i=function(){return a};return a}function a(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){try{yield k(a,b)}catch(c){if(d("WAWebDBStoreEncryptedMsgs").isEligibleForFallback(a.length,c))yield k(a,b,!0);else throw c}});return j.apply(this,arguments)}function k(a,b,c){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){e===void 0&&(e=!1);a=(yield (h||(h=b("Promise"))).all([n(a),d("WAWebDBEncryptMultipleMsgs").encryptMultipleDBMsgs(a,!1)]));var f=a[0],g=a[1];yield d("WAWebModelStorageUtils").getStorage().lock(["chat","message","fts-indexing-queue"],function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a[0];a[1];a[2];yield b.bulkCreateOrMerge(f);yield d("WAWebDBStoreEncryptedMsgs").storeEncryptedDBMessages(g,c,!1,e)});return function(b){return a.apply(this,arguments)}}())});return l.apply(this,arguments)}function c(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield (h||(h=b("Promise"))).all([n(a),d("WAWebDBEncryptMultipleMsgs").encryptMultipleDBMsgs(a,!1)]));var c=a[0],e=a[1];return d("WAWebModelStorageUtils").getStorage().lock(["chat","message"],function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a[0];yield a.bulkCreateOrMerge(c);yield d("WAWebDBStoreNewsletterEncryptedMsgs").storeEncryptedNewsletterMessages(e)});return function(b){return a.apply(this,arguments)}}())});return m.apply(this,arguments)}function n(a){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=new Map();a.forEach(function(a){var c=a.id,e=c.remote.toString();if(e!==d("WAJids").STATUS_JID&&d("WAWebMsgGetters").getIsUnreadType(a)){var f=b.get(e)||{unread:0,t:0,unreadMentionsOfMe:[]};if(!c.fromMe){f.unread+=1;if(d("WAWebMsgGetters").getIsImportantMessage(a)){c={id:a.id.toString(),timestamp:a.t};f.unreadMentionsOfMe?f.unreadMentionsOfMe.push(c):f.unreadMentionsOfMe=[c]}}a.t!=null&&a.t>f.t&&(f.t=Math.max(a.t,f.t));b.set(e,f)}});var c=Array.from(b.keys()),e,f;if(d("WAWebPnhGatingUtils").isMatFullyEnabled()){f=d("WAWebApiContact").getAlternateWidBulkForLids(c);a=[];for(var g of f.values())a.push.apply(a,g);e=(yield d("WAWebSchemaChat").getChatTable().bulkGet(a))}g=(yield d("WAWebSchemaChat").getChatTable().bulkGet(c));a=g.map(function(a,g){var h,i;g=c[g];var j=b.get(g),k=(j==null?void 0:j.unread)||0,l=Math.max(0,a?a.unreadCount:0),m=(j==null?void 0:j.t)||void 0;a&&a.t!=null&&((m==null||a.t>m)&&(m=a.t));var n=[];h=(h=a==null?void 0:a.archiveAtMentionViewedInDrawer)!=null?h:!1;j=(j=j==null?void 0:j.unreadMentionsOfMe)!=null?j:[];i=(i=a==null?void 0:a.unreadMentionsOfMe)!=null?i:[];j.length>0&&(h=!1);n=j.concat(i);j=a==null?void 0:a.isDeprecated;if(j!==!0&&d("WAWebPnhGatingUtils").isMatFullyEnabled()&&a!=null){a=d("WAWebUpdateDuplicatedLidThread").shouldDeprecateLidThread(a,(i=f.get(a.id.toString()))!=null?i:[],e);a&&(j=!0)}i={id:g,unreadCount:l+k,t:m,unreadMentionsOfMe:n,archiveAtMentionViewedInDrawer:h,isDeprecated:j};return i});d("WALogger").LOG(i(),JSON.stringify(a));return a});return o.apply(this,arguments)}g.persistNewMessagesInBulk=a;g.persistNewNewsletterMessagesInBulk=c}),98);
__d("WAWebDBQueryAndRemoveLocalLabelAssociation",["WAWebSchemaLabelAssociation","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(a){return d("WAWebSchemaLabelAssociation").getLabelAssociationTable().anyOf(["associationId","type"],a.map(function(a){var b=a.associationId;a=a.type;return[b,a]}))}function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield h(a));yield d("WAWebSchemaLabelAssociation").getLabelAssociationTable().bulkRemove(a.map(function(a){var b=a.labelId,c=a.associationId;a=a.type;return[b,c,a]}))});return i.apply(this,arguments)}g.queryLocalLabelAssociation=h;g.queryAndRemoveLocalLabelAssociation=a}),98);
__d("WAWebFtsLightClient",["Promise","WAWebFtsStorage","WAWebRuntimeEnvironmentUtils","WAWebSchemaFtsIndexingQueue","WAWebWorkerSafeBackendApi","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h,i=null;function j(){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(i!=null)return i;i=(yield d("WAWebWorkerSafeBackendApi").workerSafeSendAndReceive("getFtsClientInstance"));return i});return k.apply(this,arguments)}function a(a){return d("WAWebSchemaFtsIndexingQueue").getFtsIndexingQueueTable().bulkCreateOrReplace(a.map(function(a){return{id:a}}))}function c(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b;if(d("WAWebRuntimeEnvironmentUtils").isWorker())return d("WAWebFtsStorage").getIndexV3Table().bulkRemoveByIndex(["id"],a);b=(b=i)!=null?b:yield j();yield b.purge(a)});return l.apply(this,arguments)}function e(){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a;if(d("WAWebRuntimeEnvironmentUtils").isWorker())return(h||(h=b("Promise"))).resolve();a=(a=i)!=null?a:yield j();yield a.index()});return m.apply(this,arguments)}f={purge:c,index:e,addToIndexingTable:a};g.ftsLightClient=f}),98);
__d("WAWebDBMessageDelete",["Promise","WALogger","WAWebBotGating","WAWebDBQueryAndRemoveLocalLabelAssociation","WAWebDBStoreRevokeMsgs","WAWebFtsLightClient","WAWebModelStorageInitialize","WAWebModelStorageUtils","WAWebSchemaLabelAssociation","WAWebSchemaMessage","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["removeMessagesFromHistory: error ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["removeMessagesFromHistory: delete "," messages"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[bot] findAndDeleteAssociatedPluginMsg failed with error: ",", stack: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[bot] Removing bot plugin msgs after delete for self"]);l=function(){return a};return a}function a(a){var c=[],e=[];return d("WAWebModelStorageInitialize").initializeWithoutGKs().then(function(){if(a.length>0)return d("WAWebSchemaMessage").getMessageTable().bulkGet(a,!1).then(function(a){a.forEach(function(a){(a==null?void 0:a.rowId)!=null&&c.push(String(a.rowId));var b=a==null?void 0:a.botResponseTargetId,d=a==null?void 0:a.internalId;(a==null?void 0:a.botPluginSearchProvider)!=null&&(a==null?void 0:a.botPluginSearchUrl)!=null&&b!=null&&d!=null&&e.push({internalId:d,targetId:b})})})}).then(function(){return d("WAWebModelStorageUtils").getStorage().lock(["message","label-association"],function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(c){c=d("WAWebDBQueryAndRemoveLocalLabelAssociation").queryAndRemoveLocalLabelAssociation(a.map(function(a){return{associationId:a,type:d("WAWebSchemaLabelAssociation").LabelAssociationType.Message}}));try{d("WAWebBotGating").isBotReceiveEnabled()&&(e.length>0&&(d("WALogger").LOG(l()),yield d("WAWebDBStoreRevokeMsgs").findAndDeleteAssociatedPluginMsg(e)))}catch(a){d("WALogger").ERROR(k(),a.name,a.stack).devConsole(a).sendLogs("Plugin carousel delete failed")}return(h||(h=b("Promise"))).all([d("WAWebSchemaMessage").getMessageTable().bulkRemove(a),c])});return function(a){return c.apply(this,arguments)}}())}).then(function(){c.length>0&&d("WAWebFtsLightClient").ftsLightClient.purge(c)["catch"](function(){})}).then(function(){d("WALogger").DEV(j(),String(a.length))})["catch"](function(a){d("WALogger").ERROR(i(),a);throw a})}function c(a){a=a.filter(function(a){return a.includes("status@broadcast")});return a.length>0?d("WAWebSchemaMessage").getMessageTable().bulkRemove(a):(h||(h=b("Promise"))).resolve()}g.removeMessagesFromHistory=a;g.removeStatusMessage=c}),98);
__d("WAWebDBMarkFutureproofMessagesReparsed",["WALogger","WAWebMsgType","WAWebSchemaMessage","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["markFutureproofMessagesReparsed: error ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["markFutureproofMessagesReparsed: update "," messages"]);i=function(){return a};return a}function a(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){try{if(a.length===0)return;a=(yield d("WAWebSchemaMessage").getMessageTable().bulkGet(a));a=a.filter(Boolean).filter(function(a){return a.type===d("WAWebMsgType").MSG_TYPE.UNKNOWN});if(a.length===0)return;d("WALogger").DEV(i(),String(a.length));a=a.map(function(a){return{id:a.id.toString(),futureproofReparsed:!0}});yield d("WAWebSchemaMessage").getMessageTable().bulkCreateOrMerge(a)}catch(a){d("WALogger").ERROR(h(),a);throw a}});return j.apply(this,arguments)}g.markFutureproofMessagesReparsed=a}),98);
__d("WAWebDBProcessEditProtocolMsgs",["$InternalEnum","Promise","WAAckLevel","WALogger","WANullthrows","WATimeUtils","WAWeb-dexie","WAWebAddonQueryUtils","WAWebApiChat","WAWebBackendApi","WAWebBotGating","WAWebDBMarkFutureproofMessagesReparsed","WAWebDBMessageSerialization","WAWebDBMsgUtils","WAWebDBStoreMessageOrphans","WAWebFtsLightClient","WAWebLidMigrationUtils","WAWebMessageEditGatingUtils","WAWebMessageEditUtils","WAWebModelStorageUtils","WAWebMsgGetters","WAWebMsgKeyUtils","WAWebMsgType","WAWebUserPrefsMeUser","WAWebWid","asyncToGeneratorRuntime","lodash"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[message-edit] add unread mention."]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[message-edit] remove unread mention."]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[message-edit] updating unread chats"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[message-edit] updating message rows"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[message-edit] message has been updated by a newer edit. Will skip updating the message row."]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[message-edit] storing orphan edit protocol messages"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[message-edit] processing edit protocol messages"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[message-edit] protocol msg does not have a valid sender timestamp"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["[message-edit] sender is not the parent msg sender"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["[message-edit] protocol msg exceeds edit window, will be dropped"]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["[message-edit] original message cannot be a forwarded message"]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["[message-edit] original message msgId::"," type is "," which cannot be edited"]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["[message-edit] protocol msg is missing original msg key"]);u=function(){return a};return a}var v=b("$InternalEnum").Mirrored(["Added","Removed"]);function a(a,b){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){e===void 0&&(e=!1);if(a.length===0)return[];d("WALogger").DEV(o()).devConsole({protocolMsgs:a});var f=(yield d("WAWebAddonQueryUtils").getParentMsgsByMsgKey(a.map(function(a){return a.protocolMessageKey}).filter(Boolean))),g=x(a,f),h=[],i=[];g.sort(function(a,b){return c("WANullthrows")(b.latestEditSenderTimestampMs)-c("WANullthrows")(a.latestEditSenderTimestampMs)});for(g of g){var j=g.protocolMessageKey&&f.get(g.protocolMessageKey.toString());!j||j.type===d("WAWebMsgType").MSG_TYPE.CIPHERTEXT?h.push(g):i.push(F(j,g))}yield y(h);i.length&&(yield A(i),C(i.filter(function(a){return a.isLatest&&!d("WAWebMsgGetters").getIsNewsletterMsg(a.parentMsg)}).map(function(a){return a.parentMsg})),yield G(i));j=i.filter(function(a){return a.isLatest});j.length&&d("WAWebBackendApi").frontendFireAndForget("updateEditedMessagesAction",{messageEdits:j});if(e){f=b("WAWebDBMarkFutureproofMessagesReparsed");g=f.markFutureproofMessagesReparsed;yield g(a.map(function(a){return a.id.toString()}))}return j});return w.apply(this,arguments)}function x(a,b){return a.filter(function(a){var e=a.protocolMessageKey;if(!e){d("WALogger").ERROR(u()).devConsole(a).sendLogs("message-edit-missing-original-msg-key");return!1}e=b.get(e.toString());if(e){var f=d("WAWebMessageEditUtils").msgTypeSupportsEditing(e.type)||e.type===d("WAWebMsgType").MSG_TYPE.CIPHERTEXT;if(!f){d("WALogger").ERROR(t(),e.id,e.type).devConsole({parentMsg:e,protocolMsg:a}).sendLogs("message-edit-unsupported-msg-type");return!1}if(e.isForwarded===!0){d("WALogger").ERROR(s()).devConsole({parentMsg:e,protocolMsg:a}).sendLogs("message-edit-forwarded-message");return!1}f=c("WANullthrows")(e.t);var g=c("WANullthrows")(a.t);if(!d("WAWebMessageEditUtils").isParentWithinEditProcessingWindow({parentTsInSeconds:f,editTsInSeconds:g,msgKey:e.id})){d("WALogger").WARN(r()).devConsole({protocolMsg:a,parentTsInSeconds:f,editTsInSeconds:g});return!1}f=d("WAWebMsgGetters").getSender(e);g=d("WAWebMsgGetters").getSender(a);if(!d("WAWebMsgGetters").getIsNewsletterMsg(e)&&(!f||!g||!c("WAWebWid").equals.apply(c("WAWebWid"),d("WAWebLidMigrationUtils").normalizeUserWidsToLidOrPn(f,g)))){d("WALogger").ERROR(q()).devConsole({protocolMsg:a,parentMsgSender:f,protocolMsgSender:g}).sendLogs("message-edit-sender-mismatch");return!1}}if(a.latestEditSenderTimestampMs==null){d("WALogger").ERROR(p()).devConsole({protocolMsg:a}).sendLogs("message-edit-missing-timestamp");return!1}return!0})}function y(a){return z.apply(this,arguments)}function z(){z=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(!a.length)return;d("WALogger").DEV(n()).devConsole({protocolMsgs:a});var c=b("WAWebDBStoreMessageOrphans");c=c.storeMessageOrphans;yield c(a,function(a){return a.protocolMessageKey})});return z.apply(this,arguments)}function A(a){return B.apply(this,arguments)}function B(){B=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(!a.length)return;yield d("WAWebModelStorageUtils").getStorage().lock(["message","chat"],function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(c){var e=c[0];c=c[1];var f=[],g=new Set();a.forEach(function(a){var b=a.parentMsg,c=a.editedMsgData,e=a.isLatest,h=a.protocolMsg;if(!e){d("WALogger").DEV(m()).devConsole({messageEdit:a});return}f.push(babelHelpers["extends"]({},b,c));if(!d("WAWebMsgGetters").getIsSentByMe(h)){e=h.id.remote.toString();g.add(e)}});var i=[];f.length&&(d("WALogger").DEV(l()).devConsole({editedMsgs:f}),i.push(e.bulkCreateOrMerge(f.map(d("WAWebDBMessageSerialization").dbRowFromMessage))));if(g.size){e=Array.from(g).map(function(a){return{id:a,unreadEditTimestampMs:d("WATimeUtils").unixTimeMs()}});d("WALogger").DEV(k()).devConsole({unreadChatUpdates:e});i.push(c.bulkCreateOrMerge(e))}yield (h||(h=b("Promise"))).all(i)});return function(a){return c.apply(this,arguments)}}())});return B.apply(this,arguments)}function C(a){if(!a.length)return;var e=c("lodash").uniq(a.map(function(a){return String(c("WANullthrows")(a.rowId))}));d("WAWebFtsLightClient").ftsLightClient.purge(e)["catch"](function(){});c("WAWeb-dexie").ignoreTransaction(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield d("WAWebFtsLightClient").ftsLightClient.addToIndexingTable(e),d("WAWebFtsLightClient").ftsLightClient.index()["catch"](function(){})}))}function D(a,b){if(d("WAWebMsgGetters").getIsSentByMe(a)){if(a.local===!0)return d("WAWebMsgGetters").getIsNewsletterMsg(a)&&!d("WAWebUserPrefsMeUser").isMeAccount(b.from)?d("WAAckLevel").ACK.SENT:d("WAAckLevel").ACK.CLOCK;return d("WAWebMsgKeyUtils").isNoteToSelf(a.id)?d("WAAckLevel").ACK.READ:d("WAAckLevel").ACK.SENT}return void 0}var E=new Map();function F(a,b){var e=Boolean(b.matchedText)||Boolean(b.canonicalUrl)||Boolean(b.description)||Boolean(b.title),f={latestEditMsgKey:b.latestEditMsgKey,latestEditSenderTimestampMs:b.latestEditSenderTimestampMs,errorCode:b.errorCode,ack:D(a,b),pendingReadReceipt:d("WAWebMsgGetters").getIsSentByMe(a)?void 0:d("WAWebDBMsgUtils").PendingReadReceiptType.MessageEdit},g=c("WANullthrows")(d("WAWebMessageEditUtils").getMsgEditType(a.type)),h,i;if(g===d("WAWebMessageEditUtils").MsgEditType.TextEdit){h=babelHelpers["extends"]({},f,{subtype:e?"url":void 0,body:b.body,mentionedJidList:b.mentionedJidList,groupMentions:b.groupMentions,title:b.title,description:b.description,canonicalUrl:b.canonicalUrl,matchedText:b.matchedText,inviteGrpType:b.inviteGrpType,thumbnail:b.thumbnail,richPreviewType:b.richPreviewType,doNotPlayInline:b.doNotPlayInline,thumbnailDirectPath:(e=b.thumbnailDirectPath)!=null?e:void 0,thumbnailSha256:(e=b.thumbnailSha256)!=null?e:void 0,thumbnailEncSha256:(e=b.thumbnailEncSha256)!=null?e:void 0,thumbnailHeight:(e=b.thumbnailHeight)!=null?e:void 0,thumbnailWidth:(e=b.thumbnailWidth)!=null?e:void 0,mediaKey:b.mediaKey,mediaKeyTimestamp:b.mediaKeyTimestamp,botPluginSearchUrl:b.botPluginSearchUrl,botPluginSearchProvider:b.botPluginSearchProvider,botPluginReferenceIndex:b.botPluginReferenceIndex,botPluginType:b.botPluginType,botPluginMaybeParent:b.botPluginMaybeParent,botReelPluginThumbnailCdnUrl:b.botReelPluginThumbnailCdnUrl})}else g===d("WAWebMessageEditUtils").MsgEditType.CaptionEdit&&(i=babelHelpers["extends"]({},f,{caption:b.caption,mentionedJidList:b.mentionedJidList,groupMentions:b.groupMentions,isCaptionByUser:!0}));g=c("WANullthrows")((e=h)!=null?e:i);d("WAWebMsgGetters").getIsSentByMe(a)&&(b.count!=null&&(g.count=b.count));f=(e=(f=E.get(a.id.toString()))!=null?f:a.latestEditSenderTimestampMs)!=null?e:0;e=c("WANullthrows")(b.latestEditSenderTimestampMs);f=e>=f;f&&E.set(a.id.toString(),e);var j;if(!d("WAWebMsgGetters").getIsSentByMe(a)){e=d("WAWebMsgGetters").getHasMentionOfMe(a);var k=d("WAWebMsgGetters").getHasMentionOfMe(babelHelpers["extends"]({},a,g));e&&!k?j=v.Removed:!e&&k&&(j=v.Added)}d("WAWebBotGating").isBotReceiveEnabled()&&(d("WAWebMsgGetters").getIsMetaBotResponse(a)||a.botEditType!=null)&&(g.botEditType=b.botEditType,g.botEditTargetId=b.botEditTargetId);return{parentMsg:a,protocolMsg:b,editedMsgData:g,isLatest:f,mentionOfMe:j}}function G(a){return H.apply(this,arguments)}function H(){H=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(!d("WAWebMessageEditGatingUtils").receiveCaptionEditEnabled())return;var b=new Map(),c=new Map();for(a of a){var e=a.parentMsg,f=a.mentionOfMe,g=e.id.remote.toString();if(!f)continue;switch(f){case v.Removed:f=e.id.toString();var h=b.get(g);h||(h=[],b.set(g,h));h.push(f);break;case v.Added:h=c.get(g);h||(h=[],c.set(g,h));f={id:e.id.toString(),timestamp:e.t};h.push(f)}}b.size&&(d("WALogger").DEV(j()).devConsole(b),yield d("WAWebApiChat").removeUnreadMentionChat(b));c.size&&(d("WALogger").DEV(i()).devConsole(c),yield d("WAWebApiChat").addUnreadMentionChat(c))});return H.apply(this,arguments)}g.EditedMentionOfMe=v;g.processEditProtocolMsgs=a;g.generateMessageEdit=F}),98);
__d("WAWebDBUpdateLastAddOnPreviewChat",["WAWebApiChat"],(function(a,b,c,d,e,f,g){function a(a){return d("WAWebApiChat").bulkUpdateChatLastAddOnPreview(a)}g.updateDatabaseForLastAddOnPreview=a}),98);
__d("WAWebLastAddOnDBSerialization",["WANullthrows"],(function(a,b,c,d,e,f,g){function a(a){switch(a.type){case"reaction":return{type:"reaction",msgKey:a.msgKey,parentMsgKey:a.parentMsgKey,reactionText:a.reactionText,sender:a.sender,timestamp:a.timestamp};case"poll_vote":return{type:"poll_vote",msgKey:a.msgKey,parentMsgKey:a.parentMsgKey,sender:a.sender,timestamp:a.timestamp};case"comment":return{type:"comment",msgKey:a.msgKey,parentMsgKey:a.parentMsgKey,sender:a.sender,timestamp:a.timestamp}}}function b(a){return{msgKey:a.msgKey,parentMsgKey:a.parentMsgKey,sender:a.senderUserJid,reactionText:a.reactionText,timestamp:a.timestamp,isOrphan:a.orphan===1,type:"reaction"}}function d(a,b){return{msgKey:a.msgKey.toString(),isOrphan:b,selectedOptionsCount:a.selectedOptionLocalIds.length,parentMsgKey:a.parentMsgKey.toString(),sender:a.sender.toString(),timestamp:a.senderTimestampMs,type:"poll_vote"}}function e(a){return{msgKey:a.msgKey,parentMsgKey:a.parentMsgKey,sender:a.sender,timestamp:a.t*1e3,isOrphan:!1,type:"comment"}}function f(a){return{msgKey:a.msgKey,parentMsgKey:a.parentMsgKey,sender:a.senderUserJid,timestamp:a.timestamp,reactionText:c("WANullthrows")(a.reactionText),type:"reaction"}}g.lastAddOnPreviewFromCandidate=a;g.lastAddOnPreviewCandidateFromReactionRowType=b;g.lastAddOnPreviewCandidateFromVoteData=d;g.lastAddOnPreviewCandidateFromCommentRowType=e;g.lastAddOnPreviewFromDeprecatedLastReactionPreview=f}),98);
__d("WAWebPollsCreateOptionLocalIdMap",["Promise","WAHex","WANullthrows","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield (h||(h=b("Promise"))).all(a.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield j(a)),c=d("WAHex").toHex(new Uint8Array(b));return{hash:b,hexHash:c,localId:a.localId}});return function(b){return a.apply(this,arguments)}}())));var e=new Map(),f=new Map();for(a of a){var g=a.hash,i=a.hexHash,k=a.localId;e.set(i,k);f.set(k,g)}return{getLocalIdForHexHash:function(a){return c("WANullthrows")(e.get(a))},getLocalIdForHash:function(a){return c("WANullthrows")(e.get(d("WAHex").toHex(new Uint8Array(a))))},getHashForLocalId:function(a){return c("WANullthrows")(f.get(a))},includesHashes:function(a){return a.every(function(a){return e.has(d("WAHex").toHex(new Uint8Array(a)))})}}});return i.apply(this,arguments)}function j(a){return self.crypto.subtle.digest("SHA-256",new TextEncoder().encode(a.name))}g.createOptionLocalIdMap=a}),98);
__d("WAWebPollsProtobufConversion",["WALongInt","WANullthrows","WAWebPollsCreateOptionLocalIdMap","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,b){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){b=(yield d("WAWebPollsCreateOptionLocalIdMap").createOptionLocalIdMap(b));a=a.selectedOptionLocalIds.map(b.getHashForLocalId);return{selectedOptions:a.length===0?null:a}});return h.apply(this,arguments)}function e(a){var b=a.voteProtobuf,e=a.pollVoteMsgKey,f=a.parentMsgKey,g=a.sender,h=a.senderTimestampMs,i=a.t,j=a.optionLocalIdMap,k=a.ack;a=a.read;return{msgKey:e,parentMsgKey:c("WANullthrows")(f),selectedOptionLocalIds:b.selectedOptions.map(j.getLocalIdForHash),senderTimestampMs:d("WALongInt").numberOrThrowIfTooLarge(h),t:d("WALongInt").maybeNumberOrThrowIfTooLarge(i),sender:g,ack:k,read:a}}g.protobufFromVote=a;g.voteFromProtobuf=e}),98);
__d("WAWebWamEnumDeviceType",[],(function(a,b,c,d,e,f){a=Object.freeze({PRIMARY:1,COMPANION:2});f.DEVICE_TYPE=a}),66);
__d("WAWebWamEnumDsmError",[],(function(a,b,c,d,e,f){a=Object.freeze({INVALID_SENDER:1,MISSING_DSM:2,INVALID_DSM:3});f.DSM_ERROR=a}),66);
__d("WAWebMdBadDeviceSentMessageWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumDeviceType","WAWebWamEnumDsmError"],(function(a,b,c,d,e,f,g){a=d("WAWebWamCodegenUtils").defineEvents({MdBadDeviceSentMessage:[2176,{dsmError:[2,d("WAWebWamEnumDsmError").DSM_ERROR],peerType:[1,d("WAWebWamEnumDeviceType").DEVICE_TYPE]},[1,1,1],"regular"]});g.MdBadDeviceSentMessageWamEvent=a}),98);
__d("WAWebWamEnumE2eFailureReason",[],(function(a,b,c,d,e,f){a=Object.freeze({INVALID_MESSAGE:0,LEGACY_MESSAGE:1,INVALID_VERSION:2,PRE_KEY_MESSAGE_MISSING_PRE_KEY:3,PRE_KEY_MESSAGE_INVALID_KEY:4,UNTRUSTED_IDENTITY:5,NO_SESSION_AVAILABLE:6,PLAINTEXT_BYTE_MISMATCH:7,UNKNOWN_CIPHERTEXT_TYPE:8,UNKNOWN_CIPHERTEXT_VERSION:9,INVALID_PADDING:10,INVALID_PROTOCOL_BUFFER:11,INVALID_NUMBER_OF_MESSAGE_TYPES:12,INVALID_IMAGE_FILE_LENGTH:13,INVALID_IMAGE_FILE_SHA256:14,INVALID_IMAGE_MEDIA_URL:15,INVALID_IMAGE_MEDIA_KEY:16,INVALID_IMAGE_MIME_TYPE:17,UNKNOWN_V2_TAGS:18,INVALID_EDIT_VERSION:19,INVALID_HSM_NAMESPACE:20,INVALID_HSM_ELEMENT:21,UNKNOWN_PROTOCOL_MESSAGE_TYPE:22,DUPLICATE_MESSAGE:23,FINGERPRINT_IDENTITY_MISMATCH:24,FINGERPRINT_VERSION_MISMATCH:25,INVALID_ARGUMENT:26,INVALID_KEY:27,INVALID_KEY_ID:28,INVALID_MAC:29,NO_MEMORY:30,STALE_KEY_EXCHANGE:31,VRF_SIGNATURE_VERIFICATION_FAILED:32,ERROR_MINIMUM_VALUE:33,ERROR_UNKNOWN:34,INVALID_BROADCAST_STANZA_ATTRIBUTE:35,INVALID_LIST_REPLY_MESSAGE:36,INVALID_LIST_REPLY_ROW_IDENTIFIER:37,INVALID_BUTTONS_RESPONSE_MESSAGE:38,INVALID_BUTTONS_RESPONSE_BUTTON_IDENTIFIER:39,INVALID_ORDER_MESSAGE:40,ERROR_CANCELLED:41,FUTURE_MESSAGE:42,INVALID_EMPTY_PROTOBUF_NOT_ALLOWED:43,SELF_SEND:44,INVALID_MEDIA_MIME_TYPE_TEMPLATE_MESSAGE:45,INVALID_MEDIA_ENC_HASH:46,INVALID_IDENTITY:47,PASSTHROUGH:48,NOT_IN_PENDING_DEVICES:49,EDIT_TYPE_AND_PROTOCOL_MISMATCH:50,DECRYPTION_FAILED:51,DESERIALIZE_INVALID_PROTO_FORMAT:52,DESERIALIZE_RATCHET_KEY_BAD_FORMAT:53,DESERIALIZE_PK_INVALID_PROTO_FORMAT:54,DESERIALZE_PK_KEY_BAD_FORMAT:55,TOO_MANY_MESSAGES_IN_FUTURE:56,EMPTY_VERSION_CONTENT_SUFFIX:57,CONTENT_EXCEEDED_EXPECTED_LENGTH:58,GRP_INVALID_PROTO_FORMAT:59,GRP_INVALID_KEY_FORMAT:60,GRP_VERSION_CONTENT_EMPTY:61,GRP_INVALID_VERSION_CONTENT_LENGTH:62,GRP_SENDER_KEY_INVALID_PROTO_FORMAT:63,GRP_SENDER_KEY_PROTO_ERROR:64,GRP_TOO_MANY_MESSAGES_IN_FUTURE:65,MISSING_MESSAGE_SECRET:66,MESSAGE_SECRET_INVALID:67,INVALID_REACTION_TEXT:68,UNSUPPORTED_MESSAGE_TYPE:69,UNSUPPORTED_IN_INTEROP:70,TARGET_MESSAGE_NOT_FOUND:71,STATUS_FROM_HOSTED_DEVICE_UNSUPPORTED:72,GROUP_MESSAGE_FROM_HOSTED_DEVICE_UNSUPPORTED:73,BROADCAST_FROM_HOSTED_DEVICE_UNSUPPORTED:74,LIVE_LOCATION_FROM_HOSTED_DEVICE_UNSUPPORTED:75,MESSAGE_TYPE_MISMATCH:76,ERROR_SESSION_STATE_UNACKED_PKMSG_GET_BASE_KEY:77,ERROR_SIGNAL_MESSAGE_GET_SENDER_RATCHET_KEY:78,ERROR_SESSION_STATE_GET_ROOT_KEY:79,ERROR_SESSION_STATE_GET_SENDER_RATCHET_KEY_PAIR:80,ERROR_SESSION_STATE_SET_SENDER_CHAIN_KEY:81,ERROR_SESSION_STATE_FIND_RECEIVER_CHAIN:82,ERROR_SESSION_RECORD_DESERIALIZE:83,ERROR_SENDER_KEY_STATE_REMOVE_SENDER_MESSAGE_KEY:84,ERROR_EMPTY_PLAINTEXT_DATA:85,ERROR_MAC_LEN_MISMATCH:86,ERROR_INVALID_MAC_LEN:87,ERROR_INVALID_SIGNATURE_LEN:88,ERROR_SENDER_KEY_LOAD_KEY:89,ERROR_FAST_RATCHET_SENDER_KEY_LOAD_KEY:90,ERROR_UNKNOWN_LOAD_KEY:91,ERROR_UNKNOWN_LOAD_SESSION:92,ERROR_SESSION_RECORD_GET_STATE:93,ERROR_SESSION_STATE_GET_SENDER_CHAIN_KEY:94,ERROR_INVALID_KEY_MATEIRAL_DATA_LEN:95,ERROR_SESSION_STATE_GET_SENDER_RATCHET_KEY:96,ERROR_SESSION_STATE_GET_LOCAL_IDENTITY_KEY:97,ERROR_SESSION_STATE_GET_REMOTE_IDENTITY_KEY:98});f.E2E_FAILURE_REASON=a}),66);
__d("WAWebHandleMsgError",["$InternalEnum","WACustomError","WAWebABProps","WAWebMdBadDeviceSentMessageWamEvent","WAWebWamEnumDsmError","WAWebWamEnumE2eFailureReason"],(function(a,b,c,d,e,f,g){c=function(a){babelHelpers.inheritsLoose(b,a);function b(b,c){var e;c===d("WAWebWamEnumDsmError").DSM_ERROR.MISSING_DSM?e=a.call(this,"message should be deviceSentMessage")||this:c===d("WAWebWamEnumDsmError").DSM_ERROR.INVALID_SENDER?e=a.call(this,"message should not be deviceSentMessage")||this:c===d("WAWebWamEnumDsmError").DSM_ERROR.INVALID_DSM?e=a.call(this,"invalid deviceSentMessage")||this:e=a.call(this,"unknown deviceSentMessage error")||this;new(d("WAWebMdBadDeviceSentMessageWamEvent").MdBadDeviceSentMessageWamEvent)({peerType:b,dsmError:c}).commit();e.peerType=b;e.dsmError=c;return babelHelpers.assertThisInitialized(e)}return b}((a=d("WACustomError")).customError("DeviceSentMessageError"));e=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}return b}(a.customError("UnknownDeviceMessageError"));f=function(a){babelHelpers.inheritsLoose(b,a);function b(b,c,d){var e;e=a.call(this,typeof b==="string"?b:String(b))||this;e.code=b;e.e2eFailureReason=c;e.sendLogs=(b=d==null?void 0:d.sendLogs)!=null?b:!0;return e}return b}(a.customError("MessageValidationError"));var h=function(b){babelHelpers.inheritsLoose(a,b);function a(a){var c;c=b.call(this,"Received Nack error code "+((c=a)!=null?c:"")+" from Server on message sent")||this;c.ackErrorCode=a;return c}return a}(a.customError("MessageSentAckError"));a=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}return b}(a.customError("BizNodeValidationError"));b=b("$InternalEnum")({INVALID_POLL_UPDATE_STANZA:"poll_update_message_stanza_invalid",INVALID_REACTION_STANZA:"reaction_message_stanza_invalid",INVALID_PIN_IN_CHAT_STANZA:"pin_in_chat_message_stanza_invalid",INVALID_COMMENT_STANZA:"comment_message_stanza_invalid",INVALID_EVENT_RESPONSE_STANZA:"event_response_message_stanza_invalid",INVALID_EVENT_EDIT_STANZA:"event_edit_message_stanza_invalid"});var i=function(b){babelHelpers.inheritsLoose(a,b);function a(a){a=b.call(this,a,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.MESSAGE_TYPE_MISMATCH)||this;a.name="MessageProtobufMismatchError";return a}return a}(f),j=function(b){babelHelpers.inheritsLoose(a,b);function a(a){a=b.call(this,"Received "+a.length+" message keys: "+a.join(", "),d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_NUMBER_OF_MESSAGE_TYPES)||this;a.name="MessageProtobufInvalidMessageTypes";return a}return a}(f),k=function(a){if(a==="outgoing")return d("WAWebABProps").getABPropConfigValue("web_abort_building_e2e_proto_on_error");else if(a==="relay")return d("WAWebABProps").getABPropConfigValue("web_abort_decrypting_e2e_on_error");return!1};g.DeviceSentMessageError=c;g.UnknownDeviceMessageError=e;g.MessageValidationError=f;g.MessageSentAckError=h;g.BizNodeValidationError=a;g.MessageProtobufMismatchErrorCode=b;g.MessageProtobufMismatchError=i;g.MessageProtobufInvalidMessageTypes=j;g.isMessageDropValidationEnabled=k}),98);
__d("WAWebPollsValidationError",["$InternalEnum","WACustomError","WAWebHandleMsgError"],(function(a,b,c,d,e,f,g){c=(a=b("$InternalEnum"))({DUPLICATE_OPTIONS:"poll_creation_duplicate_options"});e=a({INVALID_MESSAGE_SECRET:"poll_creation_invalid_message_secret",INVALID_NAME:"poll_creation_invalid_name",INVALID_OPTIONS_COUNT:"poll_creation_invalid_options_count",INVALID_OPTION:"poll_creation_invalid_option",INVALID_SELECTABLE_OPTIONS_COUNT:"poll_creation_invalid_selectable_options_count",MISSING_MESSAGE_SECRET:"poll_creation_missing_message_secret",MISSING_NAME:"poll_creation_missing_name",MISSING_OPTIONS:"poll_creation_missing_options",MISSING_SELECTABLE_OPTIONS_COUNT:"poll_creation_missing_selectable_options_count"});f=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.name="PollCreationValidationError",b)||babelHelpers.assertThisInitialized(c)}return b}(d("WAWebHandleMsgError").MessageValidationError);b=a({INVALID_VOTE_ENC_IV:"poll_update_invalid_vote_enc_iv",MISSING_POLL_MESSAGE_KEY:"poll_update_missing_poll_message_key",MISSING_SENDER_TIMESTAMP:"poll_update_missing_sender_timestamp",MISSING_UPDATE:"poll_update_missing_update",MISSING_VOTE_ENC_IV:"poll_update_missing_vote_enc_iv",MISSING_VOTE_ENC_PAYLOAD:"poll_update_missing_vote_enc_payload",MESSAGE_STANZA_INVALID:"poll_update_message_stanza_invalid"});var h=function(b){babelHelpers.inheritsLoose(a,b);function a(){var a,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(a=c=b.call.apply(b,[this].concat(e))||this,c.name="PollUpdateValidationError",a)||babelHelpers.assertThisInitialized(c)}return a}(d("WAWebHandleMsgError").MessageValidationError);a=a({INVALID_MESSAGE_SECRET:"poll_vote_invalid_message_secret",INVALID_OPTION:"poll_vote_invalid_option",INVALID_OPTIONS_COUNT:"poll_vote_invalid_options_count",OPTION_NOT_FOUND:"poll_vote_option_not_found"});d=function(a){babelHelpers.inheritsLoose(b,a);function b(b){var c;c=a.call(this,b)||this;c.code=b;return c}return b}(d("WACustomError").customError("PollVoteValidationError"));g.PollCreationValidationWarningCode=c;g.PollCreationValidationErrorCode=e;g.PollCreationValidationError=f;g.PollUpdateValidationErrorCode=b;g.PollUpdateValidationError=h;g.PollVoteValidationErrorCode=a;g.PollVoteValidationError=d}),98);
__d("WAWebPollsVoteEncryption",["WAWebAddOnEncryption","WAWebApiContact","WAWebMessageSecretErrorsWamEvent","WAWebPnhGatingUtils","WAWebProtobufsE2E.pb","WAWebWamEnumMessageSecretAllowedType","WAWebWamEnumMessageSecretErrorType","WAWebWidFactory","asyncToGeneratorRuntime","decodeProtobuf"],(function(a,b,c,d,e,f,g){function a(a){return h(a)["catch"](function(b){if(d("WAWebPnhGatingUtils").isMatFullyEnabled()&&a.pollCreationOriginalSender.isUser()){var c=d("WAWebApiContact").getAlternateUserWid(a.pollCreationOriginalSender);if(c!=null)return h(babelHelpers["extends"]({},a,{pollCreationOriginalSender:d("WAWebWidFactory").toUserWid(c)}))}throw b})["catch"](function(a){new(d("WAWebMessageSecretErrorsWamEvent").MessageSecretErrorsWamEvent)({messageSecretAllowedList:d("WAWebWamEnumMessageSecretAllowedType").MESSAGE_SECRET_ALLOWED_TYPE.MESSAGE_POLL,messageSecretError:d("WAWebWamEnumMessageSecretErrorType").MESSAGE_SECRET_ERROR_TYPE.DECRYPTION_ERROR}).commit();throw a})}function h(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b={type:"poll_vote",encryptedAddOn:a.encryptedVote};b=(yield d("WAWebAddOnEncryption").decryptAddOn(b,{messageSecret:a.messageSecret,iv:a.iv,stanzaId:a.stanzaId,originalMessageSender:a.pollCreationOriginalSender,addOnSender:a.voteSender}));return d("decodeProtobuf").decodeProtobuf(d("WAWebProtobufsE2E.pb").Message$PollVoteMessageSpec,b)});return i.apply(this,arguments)}g.decryptVote=a}),98);
__d("WAWebPollsExtractVotes",["Promise","WALogger","WANullthrows","WAWebMessageSecretErrorsWamEvent","WAWebMsgGetters","WAWebPollsCreateOptionLocalIdMap","WAWebPollsProtobufConversion","WAWebPollsValidationError","WAWebPollsVoteEncryption","WAWebUserPrefsMeUser","WAWebWamEnumE2eFailureReason","WAWebWamEnumMessageSecretAllowedType","WAWebWamEnumMessageSecretErrorType","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Poll vote extraction failed: ","\n",""],["Poll vote extraction failed: ","\\n",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Poll vote extraction failed: ",""]);j=function(){return a};return a}function a(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield (h||(h=b("Promise"))).allSettled(Array.from(a.entries()).map(function(a){var b=a[0];a=a[1];return l(b,a)})));return a.map(function(a){switch(a.status){case"fulfilled":return a.value;case"rejected":a=a.reason;if(a instanceof d("WAWebPollsValidationError").PollVoteValidationError){d("WALogger").ERROR(j(),a.code).sendLogs(a.code);return}d("WALogger").ERROR(i(),a.message,a.stack).sendLogs("poll-vote-extraction-unknown-error")}}).filter(Boolean)});return k.apply(this,arguments)}function l(a,b){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(b.messageSecret==null){new(d("WAWebMessageSecretErrorsWamEvent").MessageSecretErrorsWamEvent)({messageSecretAllowedList:d("WAWebWamEnumMessageSecretAllowedType").MESSAGE_SECRET_ALLOWED_TYPE.MESSAGE_POLL,messageSecretError:d("WAWebWamEnumMessageSecretErrorType").MESSAGE_SECRET_ERROR_TYPE.MISSING_MESSAGE_SECRET}).commit();throw new(d("WAWebPollsValidationError").PollCreationValidationError)(d("WAWebPollsValidationError").PollCreationValidationErrorCode.MISSING_MESSAGE_SECRET,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.MISSING_MESSAGE_SECRET)}var e=c("WANullthrows")(b.messageSecret),f=c("WANullthrows")(b.pollSelectableOptionsCount),g=c("WANullthrows")(b.pollOptions),h=c("WANullthrows")(a.encPollVote);if(e.byteLength!==32){new(d("WAWebMessageSecretErrorsWamEvent").MessageSecretErrorsWamEvent)({messageSecretAllowedList:d("WAWebWamEnumMessageSecretAllowedType").MESSAGE_SECRET_ALLOWED_TYPE.MESSAGE_POLL,messageSecretError:d("WAWebWamEnumMessageSecretErrorType").MESSAGE_SECRET_ERROR_TYPE.WRONG_LENGTH}).commit();throw new(d("WAWebPollsValidationError").PollVoteValidationError)(d("WAWebPollsValidationError").PollVoteValidationErrorCode.INVALID_MESSAGE_SECRET)}var i=d("WAWebWidFactory").toUserWid(d("WAWebMsgGetters").getSender(a));h=(yield d("WAWebPollsVoteEncryption").decryptVote({encryptedVote:h.encPayload,iv:h.encIv,messageSecret:e,stanzaId:b.id.id,pollCreationOriginalSender:d("WAWebMsgGetters").getOriginalSender(b),voteSender:i}));e=h.selectedOptions.length;if(e>g.length||f!==0&&e>f)throw new(d("WAWebPollsValidationError").PollVoteValidationError)(d("WAWebPollsValidationError").PollVoteValidationErrorCode.INVALID_OPTIONS_COUNT);if(h.selectedOptions.some(function(a){return a.byteLength!==32}))throw new(d("WAWebPollsValidationError").PollVoteValidationError)(d("WAWebPollsValidationError").PollVoteValidationErrorCode.INVALID_OPTION);b=(yield d("WAWebPollsCreateOptionLocalIdMap").createOptionLocalIdMap(g));if(!b.includesHashes(h.selectedOptions))throw new(d("WAWebPollsValidationError").PollVoteValidationError)(d("WAWebPollsValidationError").PollVoteValidationErrorCode.OPTION_NOT_FOUND);return d("WAWebPollsProtobufConversion").voteFromProtobuf({voteProtobuf:h,pollVoteMsgKey:a.id,parentMsgKey:a.pollUpdateParentKey,sender:i,senderTimestampMs:a.senderTimestampMs,t:c("WANullthrows")(a.t),optionLocalIdMap:b,ack:a.ack,read:d("WAWebUserPrefsMeUser").isMeAccount(i)})});return m.apply(this,arguments)}g.extractVotes=a}),98);
__d("WAWebDBGetReactions",["WAWebApiContact","WAWebEmoji","WAWebLidGroupsGatingUtils","WAWebLidMigrationUtils","WAWebModelStorageUtils","WAWebMsgKey","WAWebParseMsgKeyString","WAWebReactionsBEUtils","WAWebSchemaReactions","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("WAWebSchemaReactions").getReactionsTable().equals(["parentMsgKey"],a));var b={reactions:[],reactionByMe:null},e=new Map();a.forEach(function(a){var f=a.reactionText,g=a.orphan;if(f!==d("WAWebReactionsBEUtils").REVOKED_REACTION_TEXT&&g!==1){g=d("WAWebEmoji").EmojiUtil.getEmojiAggregate(f);f=(f=e.get(g))!=null?f:[];e.set(g,[].concat(f,[a]));g=c("WAWebParseMsgKeyString")(a.msgKey);g.fromMe&&(b.reactionByMe=a)}});var f=b.reactionByMe?d("WAWebEmoji").EmojiUtil.getEmojiAggregate(b.reactionByMe.reactionText):"";e.forEach(function(a,c){var d=!1;c===f&&(d=!0);b.reactions.push({aggregateEmoji:c,senders:a,hasReactionByMe:d})});return b});return h.apply(this,arguments)}function e(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=new Map();yield d("WAWebModelStorageUtils").getStorage().lock(["reactions"],function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){b=b[0];b=(yield b.anyOf(["parentMsgKey"],a));b.forEach(function(a){var b=a.reactionText,e=a.orphan;if(b!==d("WAWebReactionsBEUtils").REVOKED_REACTION_TEXT&&e!==1){e=(b=c.get(a.parentMsgKey))!=null?b:[];e.push(a);c.set(a.parentMsgKey,e)}})});return function(a){return e.apply(this,arguments)}}());return c});return i.apply(this,arguments)}function f(a){return d("WAWebModelStorageUtils").getStorage().lock(["reactions"],function(b){b=b[0];return b.anyOf(["parentMsgKey"],a)})}function j(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.parentMsgKey;a=a.senderUserJid;if(d("WAWebLidGroupsGatingUtils").allowReferenceByAltJid()){var e,f,g=[];e=(e=d("WAWebLidMigrationUtils").getAlternateMsgKey(c("WAWebMsgKey").from(b)))==null?void 0:e.toString();f=(f=d("WAWebApiContact").getAlternateUserWid(d("WAWebWidFactory").createWid(a)))==null?void 0:f.toString();e=[b,e].filter(Boolean);f=[a,f].filter(Boolean);for(e of e)for(var h of f)g.push([e,h]);h=(yield d("WAWebSchemaReactions").getReactionsTable().anyOf(["parentMsgKey","senderUserJid"],g,{limit:1}));return h[0]}return d("WAWebSchemaReactions").getReactionsTable().get([b,a])});return k.apply(this,arguments)}g.getReactions=a;g.getFilteredReactionsFromParentMsgs=e;g.getAllReactionsFromParentMsgs=f;g.existsReactionAddressingModeInsensitive=j}),98);
__d("WAWebSchemaTypes.flow",["$InternalEnum"],(function(a,b,c,d,e,f){a=b("$InternalEnum").Mirrored(["ParentMsgPlaceholder","ParentMsgMissing","ParentMsgFutureproof"]);f.OrphanReactionsReasonType=a}),66);
__d("WAWebReactionsBEUtils",["WALogger","WALongInt","WANullthrows","WAWebAddonQueryUtils","WAWebBotGenTypingIndicatorMsg","WAWebDBGetReactions","WAWebMsgGetters","WAWebMsgKey","WAWebMsgType","WAWebPnhGatingUtils","WAWebSchemaMessage","WAWebSchemaTypes.flow","WAWebWid","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["createReactionsRowFromMsg: reactions not allowed for this message type ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["createReactionsRowFromMsg: sender or reactionMsg are null"]);i=function(){return a};return a}var j="";function k(a,b){return a===d("WAWebMsgType").MSG_TYPE.UNKNOWN||a===d("WAWebMsgType").MSG_TYPE.CIPHERTEXT||a===d("WAWebMsgType").MSG_TYPE.REVOKED||a===d("WAWebMsgType").MSG_TYPE.DEBUG||a===d("WAWebMsgType").MSG_TYPE.DEBUG_PLACEHOLDER||a===d("WAWebMsgType").MSG_TYPE.GP2||a===d("WAWebMsgType").MSG_TYPE.NOTIFICATION||a===d("WAWebMsgType").MSG_TYPE.NEWSLETTER_NOTIFICATION||a===d("WAWebMsgType").MSG_TYPE.NOTIFICATION_TEMPLATE||a===d("WAWebMsgType").MSG_TYPE.E2E_NOTIFICATION||a===d("WAWebMsgType").MSG_TYPE.CALL_LOG||a===d("WAWebMsgType").MSG_TYPE.CHAT&&b===d("WAWebBotGenTypingIndicatorMsg").BOT_TYPING_PLACEHOLDER_MSG_SUBTYPE?!1:!0}function a(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=[],e=[];a.forEach(function(a){a&&e.push(a.reactionParentKey)});var f=new Map();d("WAWebPnhGatingUtils").isMatFullyEnabled()&&a.forEach(function(a){var b=a.reactionParentKey,g=d("WAWebMsgGetters").getOriginalSender(a);if(b!=null&&g!=null&&b.remote.isUser()&&!c("WAWebWid").equals(g,b.remote)){b=c("WAWebMsgKey").from({fromMe:b.fromMe,id:b.id,participant:b.participant,remote:g});e.push(b);f.set(a.reactionParentKey.remote,b.toString())}});var g=(yield d("WAWebAddonQueryUtils").getParentMsgsByMsgKey(e));a.forEach(function(a){var e,l;e=(e=a.author)!=null?e:a.from;if(!e||!a){d("WALogger").WARN(i());return}var m=g.get(a.reactionParentKey.toString());if(d("WAWebPnhGatingUtils").isMatFullyEnabled()&&!m){var n=f.get(a.reactionParentKey.remote);n!=null&&(m=g.get(n))}n=0;var o;if(!m)n=1,o=d("WAWebSchemaTypes.flow").OrphanReactionsReasonType.ParentMsgMissing;else if(((l=m)==null?void 0:l.type)===d("WAWebMsgType").MSG_TYPE.CIPHERTEXT)n=1,o=d("WAWebSchemaTypes.flow").OrphanReactionsReasonType.ParentMsgPlaceholder;else if(((l=m)==null?void 0:l.type)===d("WAWebMsgType").MSG_TYPE.UNKNOWN)n=1,o=d("WAWebSchemaTypes.flow").OrphanReactionsReasonType.ParentMsgFutureproof;else if(!k(m.type,m.subtype)){d("WALogger").WARN(h(),m.type);return}l=d("WAWebWidFactory").toUserWid(e);m={msgKey:a.id.toString(),parentMsgKey:(m=(e=m)==null?void 0:e.id.toString())!=null?m:a.reactionParentKey.toString(),senderUserJid:l.toString(),reactionText:(e=a.reactionText)!=null?e:j,timestamp:a.reactionTimestamp,orphan:n,orphanReason:o,read:!1,t:c("WANullthrows")(d("WALongInt").maybeNumberOrThrowIfTooLarge(a.t))};b.push(m)});return b});return l.apply(this,arguments)}function e(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=[],c=[];a.forEach(function(a){var d=a.parentMsgKey,e=a.orphan;a=a.reactionText;if(e!==1)if(a!==j){e={id:d,hasReaction:!0};c.push(e)}else b.push(d)});var e=(yield d("WAWebDBGetReactions").getFilteredReactionsFromParentMsgs(b));b.forEach(function(a){var b=e.get(a);b=b&&b.length>0||!1;a={id:a,hasReaction:b};c.push(a)});return d("WAWebSchemaMessage").getMessageTable().bulkCreateOrMerge(c)});return m.apply(this,arguments)}g.REVOKED_REACTION_TEXT=j;g.canHaveReactions=k;g.createReactionsRowFromMsg=a;g.updateHasReactionFromParent=e}),98);
__d("WAWebShouldUpdateLastAddOnPreview",["WAWebLastAddOnDBSerialization","WAWebMsgKey","WAWebReactionsBEUtils","WAWebSchemaChat","WAWebUserPrefsMeUser","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(a){var b=c("WAWebMsgKey").fromString(a.parentMsgKey);return a.type==="comment"?!0:(d("WAWebUserPrefsMeUser").isSerializedWidMe(a.sender)||b.fromMe)&&!a.isOrphan}function i(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=new Map();a=(yield d("WAWebSchemaChat").getChatTable().bulkGet(a));a.forEach(function(a){var c;a!=null&&b.set(a.id.toString(),(c=a.chatlistPreview)!=null?c:a.lastReactionPreview)});return b});return j.apply(this,arguments)}function k(a){a=c("WAWebMsgKey").fromString(a.parentMsgKey);return a.remote.toString()}function l(a,b){return!n(a)?!1:a.sender===b.sender&&a.parentMsgKey===b.parentMsgKey&&a.timestamp>=b.timestamp}function a(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.filter(function(a){return h(a)});var b=new Map();if(!a.length)return b;var e=new Set(a.map(function(a){a=c("WAWebMsgKey").fromString(a.parentMsgKey);return a.remote.toString()})),f=(yield i(Array.from(e)));a.forEach(function(a){var c=k(a),e=f.get(c),g=b.get(c);g=(g=g)!=null?g:e;n(a)?g&&l(a,g)&&a.timestamp>=g.timestamp&&b.set(c,void 0):g?a.timestamp>=g.timestamp&&b.set(c,d("WAWebLastAddOnDBSerialization").lastAddOnPreviewFromCandidate(a)):b.set(c,d("WAWebLastAddOnDBSerialization").lastAddOnPreviewFromCandidate(a))});return b});return m.apply(this,arguments)}function n(a){switch(a.type){case"poll_vote":return a.selectedOptionsCount===0;case"reaction":default:return a.reactionText===d("WAWebReactionsBEUtils").REVOKED_REACTION_TEXT}}g.isAddOnPreviewUpdateCandidate=h;g.bulkGetChatLastAddOnPreviewMap=i;g.filterChatsWithAddOnPreviewUpdates=a}),98);
__d("WAWebDBProcessPollUpdateMsgs",["Promise","WAWebBackendApi","WAWebDBMarkFutureproofMessagesReparsed","WAWebDBPollsGetParentMessages","WAWebDBPollsUpsertVotes","WAWebDBStoreMessageOrphans","WAWebDBUpdateLastAddOnPreviewChat","WAWebLastAddOnDBSerialization","WAWebPollsExtractVotes","WAWebShouldUpdateLastAddOnPreview","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.length===0)return[];a=(yield d("WAWebDBPollsGetParentMessages").getParentMessages(a));var c=a.pollUpdateMsgsToParentMsgs,e=a.orphans;for(a of c.entries()){var f=a[0],g=a[1];g.pollInvalidated&&c["delete"](f)}g=(yield (h||(h=b("Promise"))).all([b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(e.length===0)return;var a=b("WAWebDBStoreMessageOrphans");a=a.storeMessageOrphans;yield a(e,function(a){return a.pollUpdateParentKey});a=e.map(function(a){return a.id.toString()});var c=b("WAWebDBMarkFutureproofMessagesReparsed");c=c.markFutureproofMessagesReparsed;yield c(a)})(),b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(c.size===0)return;var a=(yield d("WAWebDBPollsUpsertVotes").upsertVotesDb(yield d("WAWebPollsExtractVotes").extractVotes(c)));yield d("WAWebBackendApi").frontendSendAndReceive("upsertVotesModelCollection",{votes:a,restoredFromDb:!1});var e=a.map(function(a){return a.msgKey.toString()}),f=b("WAWebDBMarkFutureproofMessagesReparsed");f=f.markFutureproofMessagesReparsed;yield f(e);f=(yield d("WAWebShouldUpdateLastAddOnPreview").filterChatsWithAddOnPreviewUpdates(a.map(function(a){return d("WAWebLastAddOnDBSerialization").lastAddOnPreviewCandidateFromVoteData(a,!1)})));f.size>0&&(yield d("WAWebDBUpdateLastAddOnPreviewChat").updateDatabaseForLastAddOnPreview(f),d("WAWebBackendApi").frontendFireAndForget("updateChatLastAddOnPreview",{chatMap:f}));return a})()]));f=g[1];return(a=f)!=null?a:[]});return i.apply(this,arguments)}g.processPollUpdateMsgs=a}),98);
__d("WAWebHandleMessageTypes.flow",[],(function(a,b,c,d,e,f){a=Object.freeze({ReportingTokenInfo:"reporting_token_info"});f.MsgAdditionalInfoType=a}),66);
__d("WAWebDBReportingTokenUtils",["WALogger","WATimeUtils","WAWebGetMessageCache","WAWebHandleMessageTypes.flow","WAWebMessagingGatingUtils","WAWebSchemaReportingToken","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["reporting tag is already stored for the msgKey"]);h=function(){return a};return a}var i=-1;function a(a){var b=a.reportingTokenInfo;if(b==null)return null;var c=b.reportingTag,e=b.reportingTokenContent;b=b.version;a={id:a.id.toString(),ts:d("WATimeUtils").unixTimeMs()};c!=null&&(a.reportingTag=c);e!=null&&(a.reportingTokenContent=e);b!=null&&(a.version=b);return a}function c(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("WAWebSchemaReportingToken").getReportingTokenTable().get(a));return a});return j.apply(this,arguments)}function e(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a==null||a<=i)return;if(a===0)return d("WAWebSchemaReportingToken").getReportingTokenTable().clear();a=d("WATimeUtils").unixTimeMs()-a*d("WATimeUtils").DAY_MILLISECONDS;a=(yield d("WAWebSchemaReportingToken").getReportingTokenTable().lessThan(["ts"],a));yield d("WAWebSchemaReportingToken").getReportingTokenTable().bulkRemove(a.map(function(a){return a.id}))});return k.apply(this,arguments)}function f(a,b){if(!d("WAWebMessagingGatingUtils").isReportingTokenReceivingEnabled())return;if(b==null||b.reportingTag==null)return;d("WAWebGetMessageCache").getMessageCache().addAdditionalInfo({type:d("WAWebHandleMessageTypes.flow").MsgAdditionalInfoType.ReportingTokenInfo,data:{id:a.toString(),reportingTag:b.reportingTag,ts:d("WATimeUtils").unixTimeMs()}})}function l(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.map(function(a){return a.id}),c=(yield d("WAWebSchemaReportingToken").getReportingTokenTable().bulkGet(b)),e=[];a.forEach(function(a,b){b=c[b];if(b==null||b.reportingTag==null)e.push(a);else{b=a.reportingTag;a=babelHelpers.objectWithoutPropertiesLoose(a,["reportingTag"]);b!=null&&d("WALogger").WARN(h()).tags("messaging","wa-ice","report-token").sendLogs("report-token-reporting-tag-existed-for-msgKey");e.push(a)}});yield d("WAWebSchemaReportingToken").getReportingTokenTable().bulkCreateOrMerge(e)});return m.apply(this,arguments)}g.DEFAULT_RT_CLEANUP_OLDER_THAN_DAYS=i;g.msgToReportingTokenRow=a;g.getReportingTokenRowFromMsg=c;g.cleanupReportingTokenTable=e;g.maybeStoreReportingTag=f;g.handleAddReportingTokenInfos=l}),98);
__d("WAWebDBStoreEncryptedMsgs",["Promise","WALogger","WAPromiseMap","WAWeb-dexie","WAWebDBMessageUtils","WAWebDBMsgUtils","WAWebDBStoreMessage","WAWebDBStoreMsgsUtils","WAWebFtsLightClient","WAWebMessagingGatingUtils","WAWebModelStorageUtils","WAWebMsgKey","WAWebPostIncomingMessageDropMetric","WAWebWidFactory","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["storeEncryptedDBMessages: failed to log bad message properties: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["storeEncryptedDBMessages: message prop '","' is a function and cannot be cloned: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["storeEncryptedDBMessages: failed to post db error metrics: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["storeEncryptedDBMessages: all "," message(s) are already in the DB"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["storeEncryptedDBMessages: dropping "," out of "," message(s): ",", due to DB error: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["storeEncryptedDBMessages: BulkError in bulkCreate for history sync msgs, retrying with bulk create or replace"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[storeEncryptedMessage][lastChatMsgId] lastInChatMsgIdMap with key "," is null or not a number with value "," before calculation"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["storeEncryptedDBMessages: perform fallback for "," out of original "," messages"]);p=function(){return a};return a}function a(a,e,f,g){f===void 0&&(f=!1);g===void 0&&(g=!1);return d("WAWebModelStorageUtils").getStorage().lock(["message"],function(){var i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(i){var j=i[0];i=a;if(g){var k=(yield d("WAWebDBMsgUtils").getMsgsExistByMsgKey(a.map(function(a){a=a[0];return a.id.toString()})));i=a.filter(function(a,b){return!k[b]});d("WALogger").WARN(p(),i.length,a.length);if(i.length===0)return}var l=(yield d("WAWebDBStoreMsgsUtils").getLastRowId(j,f)),m=new Map();yield (h||(h=b("Promise"))).all(e.map(function(a){var b=d("WAWebWidFactory").createWid(a);a=d("WAWebDBMessageUtils").beginningOfChat(b);var c=d("WAWebDBMessageUtils").endOfChat(b);return j.between(["internalId"],a,c,{limit:1,reverse:!f,returnKeyType:"keys"}).then(function(a){a=a.length===0?d("WAWebDBStoreMsgsUtils").INLINE_MESSAGE_STARTING_INDEX:d("WAWebDBMessageUtils").getInChatMsgId(a[0]);m.set(b.toString(),a)})}));var t=f?-1:1;i=(yield d("WAPromiseMap").promiseMap(i,function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e=a[0];a=a[1];f&&(e.isMdHistoryMsg=!0);var g=c("WAWebMsgKey").fromString(e.id),h=g.remote.toString();b=l+t*(b+1);var i=m.get(h);if(i==null||Number.isNaN(i)){d("WALogger").DEV(o(),h,i).sendLogs("history-sync-nanerror-check-lastinchatmsgidmap-lastChatMsgId");return}i=i+t*1;m.set(h,i);g=!f&&(yield d("WAWebDBStoreMessage").isPendingUnreadReceipt(g,e));e=d("WAWebDBStoreMessage").addMsgMetadataToMsgRow({msg:e,chatId:h,hasLink:a,rowId:b,inChatMsgId:i,pendingReadReceipt:g});return e});return function(b,c){return a.apply(this,arguments)}}())).filter(Boolean);try{yield j.bulkCreateWith_ALREADY_ENCRYPTED_RECORDS_ONLY(i)}catch(b){if(f&&b instanceof c("WAWeb-dexie").BulkError)d("WALogger").ERROR(n()),yield j.bulkCreateOrReplace_ALREADY_ENCRYPTED_RECORDS_ONLY(i);else{(g||!q(a.length,b))&&(r(i,b),s(i));throw b}}return i});return function(a){return i.apply(this,arguments)}}()).then(function(a){a&&a.length>0&&c("WAWeb-dexie").ignoreTransaction(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield d("WAWebFtsLightClient").ftsLightClient.addToIndexingTable(a.map(function(a){return a.rowId!=null?String(a.rowId):null}).filter(Boolean)),d("WAWebFtsLightClient").ftsLightClient.index()["catch"](function(){})}))})}function q(a,b){return a>1&&b instanceof c("WAWeb-dexie").BulkError&&d("WAWebMessagingGatingUtils").isMessageDropBulkDbOperationFallbackEnabled()}function r(a,e){c("WAWeb-dexie").ignoreTransaction(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=a;if(e instanceof c("WAWeb-dexie").BulkError){var f=a.map(function(a){a=a.id;return a.toString()}),g=(yield d("WAWebDBMsgUtils").getMsgsExistByMsgKey(f));b=a.filter(function(a,b){return!g[b]})}b.length>0?(d("WALogger").WARN(m(),b.length,a.length,b.map(function(a){a=a.id;return a}),e),d("WAWebPostIncomingMessageDropMetric").postIncomingMessageDropDBOperationFailedForMsgRows(b)):d("WALogger").WARN(l(),a.length)}))["catch"](function(a){d("WALogger").ERROR(k(),a).sendLogs("failed-to-post-db-error-metrics")})}function s(a){if(c("gkx")("26258"))return;var b=function(a){var b=new Set(),c=function a(c,e){Object.entries(c).forEach(function(c){var f=c[0];c=c[1];if(typeof c==="function"){var g=[].concat(e,[f]).join(".");d("WALogger").WARN(j(),g,c)}else if(c!=null&&typeof c==="object"){if(b.has(c))return;b.add(c);a(c,[].concat(e,[f]))}})};c(a,[])};try{a.forEach(b)}catch(a){d("WALogger").WARN(i(),a)}}g.storeEncryptedDBMessages=a;g.isEligibleForFallback=q}),98);
__d("WAWebApiOrphanRevoke",["WALogger","WANullthrows","WAWebMsgGetters","WAWebMsgType","WAWebSchemaOrphanRevoke","WAWebWid","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["applyOrphanRevokes: found orphan revoke for message ",""]);h=function(){return a};return a}var i=new Map(),j=!1,k={reset:function(){i=new Map(),j=!1},bulkRemoveOrphans:function(a){a.forEach(function(a){i["delete"](a.msgKey)});return d("WAWebSchemaOrphanRevoke").getOrphanRevokeTable().bulkRemove(a.map(function(a){return a.msgKey}))},bulkCreateOrReplaceOrphanRevokes:function(a){a.forEach(function(a){i.has(a.msgKey)&&i["delete"](a.msgKey),i.set(a.msgKey,a)});return d("WAWebSchemaOrphanRevoke").getOrphanRevokeTable().bulkCreateOrReplace(a)},getAllOrphanRevokes:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(!j){var a=(yield d("WAWebSchemaOrphanRevoke").getOrphanRevokeTable().all());i=new Map(a.map(function(a){return[a.msgKey,a]}));j=!0}return i});function c(){return a.apply(this,arguments)}return c}()};function a(a){return k.bulkCreateOrReplaceOrphanRevokes(a)}function e(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield k.getAllOrphanRevokes()),e=[],f=[];a.forEach(function(a){var g=a.id.toString();if(b.has(g)){g=c("WANullthrows")(b.get(g));d("WALogger").LOG(h(),a.id.toString());if(!c("WAWebWid").isStatusV3(a.id.remote)){var i;f.push({id:a.id,to:a.to,author:a.author,revokeSender:d("WAWebWidFactory").createWidFromWidLike((i=g.sender)!=null?i:d("WAWebMsgGetters").getSender(a)),type:d("WAWebMsgType").MSG_TYPE.REVOKED,kind:d("WAWebMsgType").MsgKind.RevokedMessage,subtype:g.subtype==="admin_revoke"?"admin":"sender",protocolMessageKey:a.id,from:a.from,t:a.t,broadcast:a.broadcast})}e.push(g)}else f.push(a)});k.bulkRemoveOrphans(e);return f});return l.apply(this,arguments)}g.addOrphanRevokes=a;g.applyOrphanRevokes=e}),98);
__d("WAWebDBStoreRevokeMsgs",["Promise","WALogger","WAWebAddonProcessRevoke","WAWebApiChat","WAWebApiOrphanRevoke","WAWebBackendApi","WAWebBotGating","WAWebFtsLightClient","WAWebLidMigrationUtils","WAWebModelStorageUtils","WAWebMsgGetters","WAWebMsgKey","WAWebMsgType","WAWebSchemaMessage","WAWebWid","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["processRevokeMsg: orphan revoke message key ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Store Revoked Msg: delete associated carousel revoke failed with error: ",", stack: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Store Revoked Msg: re-validate bot revoke failed with error: ",", stack: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["processRevokeMsgs: sending invalid revoke for secondary validation as bot invoker revoke"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["processRevokeMsgs: invalid revoke request ",", ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["processRevokeMsgs: admin revoke came for the different group than the original message was in"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["processRevokeMsgs: "," has not been revoked"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["processRevokeMsgs: admin revoke has to be sent to a group or newsletter chat"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["processRevokeMsgs: "," has not been revoked"]);q=function(){return a};return a}var r=20;function a(a){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=[],f=[],g=[],r=new Map(),s=[],u=[],v=[],w=a.filter(function(a){var b=a.revokeMsgKey,e=a.newMsgKey,f=a.subtype,g=!0;f==="admin_revoke"?!c("WAWebWid").isGroup(b.remote)&&!c("WAWebWid").isNewsletter(b.remote)?(g=!1,d("WALogger").LOG(q(),String(b)),d("WALogger").WARN(p()).sendLogs("process-admin-revoke-message")):c("WAWebWid").equals(b.remote,e.remote)||(g=!1,d("WALogger").LOG(o(),String(b)),d("WALogger").WARN(n()).sendLogs("process-admin-revoke-message")):(g=c("WAWebWid").equals(b.remote,e.remote)&&c("WAWebWid").equals.apply(c("WAWebWid"),d("WAWebLidMigrationUtils").normalizeUserWidsToLidOrPn(b.participant,e.participant))&&b.fromMe===e.fromMe,g||(d("WALogger").LOG(m(),String(b),String(e)),d("WAWebBotGating").isBotReceiveEnabled()&&(d("WALogger").LOG(l()),s.push(a))));return g});if(d("WAWebBotGating").isBotReceiveEnabled()&&s.length>0)try{a=s.map(function(a){return a.revokeMsgKey.toString()});a=(yield d("WAWebSchemaMessage").getMessageTable().bulkGet(a,!1));a.forEach(function(a,b){var e=!1;b=s[b];var f=b.newMsgKey,g=b.subtype,h=b.sender;if((a==null?void 0:a.id)==null||b==null||g==="admin_revoke")return;g=c("WAWebMsgKey").from(a.id);g=g.remote;var i=a.botTargetSenderJid?d("WAWebWidFactory").createWidFromWidLike(a.botTargetSenderJid):null;if(i==null||g==null)return;var j=a.botPluginSearchUrl!=null&&a.botResponseTargetId!=null,k=!j&&a.botPluginMaybeParent===!0;g.isGroup()?c("WAWebWid").equals(i,f.participant)&&(e=!0):g.isBot()||c("WAWebWid").equals(i,h)&&(e=!0);if(e){u.push(b);f=a.internalId;g=a.botResponseTargetId;d("WAWebBotGating").isBotCarouselEnabled()&&(j||k)&&f!=null&&g!=null&&v.push({internalId:f,targetId:g})}});w.push.apply(w,u)}catch(a){d("WALogger").ERROR(k(),a.name,a.stack).devConsole(a).sendLogs("Re-validate revoke failed")}if(d("WAWebBotGating").isBotCarouselEnabled()&&v.length>0)try{yield t(v)}catch(a){d("WALogger").ERROR(j(),a.name,a.stack).devConsole(a).sendLogs("Plugin carousel delete revoke failed")}a=(yield (h||(h=b("Promise"))).all([d("WAWebModelStorageUtils").getStorage().lock(["message"],function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(j){j=j[0];var k=(yield j.bulkGet([].concat(w.map(function(a){return a.revokeMsgKey.toString()}),w.map(function(a){return(a=(a=d("WAWebLidMigrationUtils").getAlternateMsgKey(a.revokeMsgKey))==null?void 0:a.toString())!=null?a:""}),w.map(function(a){return a.newMsgKey.toString()})),!1)),a=[],l=w.length,m=k.slice(0,l),n=k.slice(l,l*2),o=k.slice(l*2);w.forEach(function(b,h){var j;j=(j=m[h])!=null?j:n[h];h=o[h];if(j==null){d("WALogger").LOG(i(),b.revokeMsgKey);a.push(b);return}e.push(j.id);g.push(String(j.rowId));f.push({id:b.newMsgKey.toString(),to:j.to,author:j.author,type:d("WAWebMsgType").MSG_TYPE.REVOKED,subtype:b.subtype==="admin_revoke"?"admin":"sender",revokeSender:b.sender,protocolMessageKey:j.id,protocolMessageRowId:h==null?void 0:h.rowId,from:j.from,t:j.t,rowId:j.rowId,internalId:j.internalId,messageRangeIndex:j.messageRangeIndex,revokeTimestamp:b.revokeTimestamp,disappearingModeInitiator:b.disappearingModeInitiator,ephemeralDuration:b.ephemeralDuration,ephemeralSettingTimestamp:b.ephemeralSettingTimestamp});if(d("WAWebMsgGetters").getIsImportantMessage(j)){h=c("WAWebMsgKey").fromString(j.id);b=h.remote.toString();if(r.has(b)){h=(h=r.get(b))!=null?h:[];r.set(b,[].concat(h,[j.id]))}else r.set(b,[j.id])}});k=[];e.length>0&&k.push(j.bulkRemove(e));f.length>0&&k.push(j.bulkCreateOrReplace(f));yield (h||(h=b("Promise"))).all(k);return a});return function(b){return a.apply(this,arguments)}}()),d("WAWebAddonProcessRevoke").processRevokeMsgs(w)]));var x=a[0];a[1];if(x.length>0){a=x.map(function(a){return{msgKey:a.revokeMsgKey.toString(),sender:a.sender,timestamp:a.timestamp,subtype:(a=a.subtype)!=null?a:"sender_revoke"}});yield d("WAWebApiOrphanRevoke").addOrphanRevokes(a)}d("WAWebFtsLightClient").ftsLightClient.purge(g)["catch"](function(){});r.size>0&&d("WAWebApiChat").removeUnreadMentionChat(r)});return s.apply(this,arguments)}function t(a){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=[],e=[];a=a.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield v(a));var b=a.pluginLinkMsgIds;a=a.pluginLinkMsgIdsRowIds;c=[].concat(c,b);e=[].concat(e,a);yield d("WAWebSchemaMessage").getMessageTable().bulkRemove(c)});return function(b){return a.apply(this,arguments)}}());yield (h||(h=b("Promise"))).all(a);d("WAWebFtsLightClient").ftsLightClient.purge(e)["catch"](function(){});d("WAWebBackendApi").frontendFireAndForget("deleteAssociatedBotCarouselMsgs",{msgKeys:c})});return u.apply(this,arguments)}function v(a){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=[],c=[],e=a.internalId,f=a.targetId;a=e.split("_")[0];yield d("WAWebSchemaMessage").getMessageTable().between(["internalId"],e,a+"_g",{reverse:!1,limit:r,shouldDecrypt:!1},function(a){if(a.botResponseTargetId===f)b.push(a.id),c.push(String(a.rowId));else return!0;return!1});return{pluginLinkMsgIds:b,pluginLinkMsgIdsRowIds:c}});return w.apply(this,arguments)}g.processRevokeMsgs=a;g.findAndDeleteAssociatedPluginMsg=t;g.findAssociatedPluginMsgs=v}),98);
__d("WAWebWorkerStorageUtils",["invariant","Promise","WAWebIdb","WAWebStorage","err"],(function(a,b,c,d,e,f,g,h){var i,j="worker-storage",k=null;function a(){var a=new(c("WAWebIdb"))(j);k=new(d("WAWebStorage").Storage)(a)}function e(){k!=null||h(0,56324);return k}function f(){return k==null?(i||(i=b("Promise"))).reject(c("err")("[worker-storage] Storage should be created first before being destroyed")):k.purge().then(function(){k=null})["catch"](function(a){k=null;throw a})}g.DATABASE_NAME=j;g.createStorage=a;g.getStorage=e;g.destroyStorage=f}),98);
__d("WAWebWorkerStorageVersionUngated",[],(function(a,b,c,d,e,f){a=1;f.versionToRollout=a}),66);
__d("WAWebWorkerStorageVersions",["WAWebWorkerStorageUtils"],(function(a,b,c,d,e,f,g){function a(){return d("WAWebWorkerStorageUtils").getStorage().versions.version(0)}function b(){return d("WAWebWorkerStorageUtils").getStorage().versions.version(1)}g.localStorageCreateTable=a;g.deferredMessagesStorageCreateTable=b}),98);
__d("WAWebSchemaDeferredMessagesStorage",["WAWebStorageMutationBuilder","WAWebStorageSchema","WAWebWorkerStorageUtils","WAWebWorkerStorageVersions"],(function(a,b,c,d,e,f,g){c=d("WAWebStorageMutationBuilder").columnBuilder();var h=c.addColumn,i=c.addEncryptedColumn,j=c.addUserDefinedPrimaryKey;function a(){d("WAWebWorkerStorageUtils").getStorage().add("deferred_messages").version(d("WAWebWorkerStorageVersions").deferredMessagesStorageCreateTable(),[j("id"),h("type"),i("plaintext",d("WAWebStorageSchema").ENCRYPTED_VALUE_TYPE.ARRAY_BUFFER),h("info"),h("paymentInfo"),h("bizInfo")]).view(function(a){return{id:a.id,type:a.type,plaintext:a.plaintext,info:a.info,paymentInfo:a.paymentInfo,bizInfo:a.bizInfo}}).useDbMsgEncKeyForEncryptedCol(!0)}function b(){return d("WAWebWorkerStorageUtils").getStorage().table("deferred_messages")}g.addTable=a;g.getTable=b}),98);
__d("WAWebApiDeferredMessagesStorage",["WAWebSchemaDeferredMessagesStorage","WAWebWorkerStorageUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(){return d("WAWebSchemaDeferredMessagesStorage").getTable().all().then(function(a){return a.map(function(a){return{id:a.id,type:a.type,plaintext:a.plaintext,info:a.info,paymentInfo:a.paymentInfo,bizInfo:a.bizInfo}})})}function c(a){var c=a.map(function(a){return{id:a.id,type:a.type,plaintext:a.plaintext,info:a.info,paymentInfo:a.paymentInfo,bizInfo:a.bizInfo}});return d("WAWebWorkerStorageUtils").getStorage().lock(["deferred_messages"],function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a[0];yield a.bulkCreateOrReplace(c)});return function(b){return a.apply(this,arguments)}}())}function e(a){return d("WAWebSchemaDeferredMessagesStorage").getTable().remove(a)}function f(){return d("WAWebSchemaDeferredMessagesStorage").getTable().clear()}a={getDeferredMessages:a,updateDeferredMessages:c,deleteDeferredMessage:e,clearDeferredMessages:f};g["default"]=a}),98);
__d("WAWebGetGroupAddressingMode",["WAWebDBGroupsGroupMetadata","WAWebHandleMsgCommon","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(!a.isGroup())return;a=(yield d("WAWebDBGroupsGroupMetadata").getGroupMetadata(a));if(a==null)return null;return a.isLidAddressingMode==null?d("WAWebHandleMsgCommon").STANZA_MSG_ADDRESSING_MODE.pn:a.isLidAddressingMode?d("WAWebHandleMsgCommon").STANZA_MSG_ADDRESSING_MODE.lid:d("WAWebHandleMsgCommon").STANZA_MSG_ADDRESSING_MODE.pn});return h.apply(this,arguments)}function c(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=new Map(),c=(yield d("WAWebDBGroupsGroupMetadata").bulkGetGroupMetadata(a));a.map(function(a,e){if(!a.isGroup()){b.set(a.toString(),null);return}e=c[e];e!=null?b.set(e.id,e.isLidAddressingMode===!0?d("WAWebHandleMsgCommon").STANZA_MSG_ADDRESSING_MODE.lid:d("WAWebHandleMsgCommon").STANZA_MSG_ADDRESSING_MODE.pn):b.set(a.toString(),null)});return b});return i.apply(this,arguments)}g.getGroupAddressingMode=a;g.bulkGetGroupAddressingMode=c}),98);
__d("WAWebHandleMsgTypes.flow",["$InternalEnum"],(function(a,b,c,d,e,f){c=(a=b("$InternalEnum"))({Self:1,Bsp:2});d=a({OnPremise:1,Facebook:2});e=a.Mirrored(["SUCCESS","RETRY","HSM_MISMATCH","BACKFILL","PARSE_ERROR","PARSE_VALIDATION_ERROR","SIGNAL_OLD_COUNTER_ERROR"]);b=a.Mirrored(["E2E","FANOUT","BOT_UNAVAILABLE_FANOUT","HOSTED_UNAVAILABLE_FANOUT"]);a=a({NO_OVERWRITE:0,RETRY:1,FUTURE_PROOF:2,PEER_RETRY:3});var g=Object.freeze({CHAT:"chat",GROUP:"group",PEER_BROADCAST:"peer_broadcast",OTHER_BROADCAST:"other_broadcast",DIRECT_PEER_STATUS:"direct_peer_status",OTHER_STATUS:"other_status"});f.ActualActorsEnumType=c;f.HostStorageEnumType=d;f.E2EProcessResult=e;f.PlaceholderType=b;f.MessageOverwriteOption=a;f.MESSAGE_TYPE=g}),66);
__d("WAWebDBBulkPersistContact",["WABatcher","WALogger","WAWebSchemaContact","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["bulkPersistContactChanges: persisting "," records"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["bulkPersistContactChanges: processing "," records"]);i=function(){return a};return a}var j=d("WABatcher").batch({delayMs:3e3},function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield k(a);return a.map(function(a){return void 0})});return function(b){return a.apply(this,arguments)}}());function a(a,b){return j(babelHelpers["extends"]({},b,{id:a.toJid()}))}function k(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WALogger").DEV(i(),a.length);b=b();d("WALogger").DEV(h(),a.length);yield d("WAWebSchemaContact").getContactTable().bulkCreateOrMerge(b);function b(){return Array.from(a.reduce(function(a,b){var c;a.set(b.id,babelHelpers["extends"]({},(c=a.get(b.id))!=null?c:{},b));return a},new Map()).values())}});return l.apply(this,arguments)}g.persistContactUpdateBatched=a}),98);
__d("WAWebHandlePushnameUpdate",["WALogger","WAPromiseQueue","WAWebBackendApi","WAWebDBBulkPersistContact","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["updatePushName: set pushname for ",""]);h=function(){return a};return a}var i=new(d("WAPromiseQueue").PromiseQueue)();function j(a,b){return d("WAWebBackendApi").frontendSendAndReceive("updatePushname",{contactId:a,pushname:b})}function a(a,c,e){e===void 0&&(e=!1);var f=d("WAWebWidFactory").toUserWid(a);return i.enqueue(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=void 0;e||(a=(yield j(f,c)));(a===!0||a===void 0)&&(d("WALogger").LOG(h(),f.toLogString()),void d("WAWebDBBulkPersistContact").persistContactUpdateBatched(f,{pushname:c}))}))}g.updatePushname=a}),98);
__d("WAWebEphemeralityResolver",["WALogger","WATimeUtils","WAWebEphemeralityTypes"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[DMResolve] resolving new incoming chat DM settings"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[DMResolve] DM setting for chat is null"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["getDisappearingModeSettingForUser: disappearing mode setting fetched for ",": duration="," settingTimestamp=",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["getDisappearingModeSettingForUser: empty contact"]);k=function(){return a};return a}function l(a){if(!a){d("WALogger").LOG(k());return null}var b=a.disappearingModeDuration,c=a.disappearingModeSettingTimestamp;d("WALogger").LOG(j(),a.id.toString(),b,c).tags("DM","DDM");return b==null||b===0?null:{duration:b,settingTimestamp:(a=c)!=null?a:0}}function m(a){a=l(a);return a!=null?a.duration:null}function n(a){return(a=a)!=null?a:0}function o(a){return(a=a)!=null?a:d("WAWebEphemeralityTypes").DisappearingModeInitiator.ChangedInChat}function p(a){return(a=a)!=null?a:d("WATimeUtils").unixTime()}function q(a){return(a=a)!=null?a:d("WAWebEphemeralityTypes").DisappearingModeTrigger.ChatSettings}function r(a,b){b=b===d("WAWebEphemeralityTypes").DisappearingModeInitiator.InitiatedByMe;return(a=a)!=null?a:b}function s(a){return a==null||a.duration==null&&a.settingTimestamp==null&&a.initiator==null?null:{duration:n(a.duration),settingTimestamp:p(a.settingTimestamp),initiator:o(a.initiator),disappearingModeTrigger:q(a.disappearingModeTrigger),initiatedByMe:r(a.initiatedByMe,a.initiator)}}function a(a,b){return(a==null?void 0:a.duration)===(b==null?void 0:b.duration)&&(a==null?void 0:a.settingTimestamp)===(b==null?void 0:b.settingTimestamp)&&(a==null?void 0:a.initiator)===(b==null?void 0:b.initiator)}function b(a,b){a=m(a);b=m(b);if(a==null&&b==null){d("WALogger").LOG(i()).tags("DM","DDM");return null}var c;a!=null&&(c={duration:a,settingTimestamp:d("WATimeUtils").unixTime(),initiator:d("WAWebEphemeralityTypes").DisappearingModeInitiator.InitiatedByMe,disappearingModeTrigger:d("WAWebEphemeralityTypes").DisappearingModeTrigger.AccountSettings,initiatedByMe:!0});var e;b!=null&&(e={duration:b,settingTimestamp:d("WATimeUtils").unixTime(),initiator:d("WAWebEphemeralityTypes").DisappearingModeInitiator.InitiatedByOther,disappearingModeTrigger:d("WAWebEphemeralityTypes").DisappearingModeTrigger.AccountSettings,initiatedByMe:!1});return c!=null&&e!=null?e.duration<c.duration?e:c:(a=c)!=null?a:e}function c(a,b){a=s(a);if(a==null&&b==null)return null;else if(a!=null&&b==null)return{duration:a.duration,settingTimestamp:a.settingTimestamp,initiator:a.initiator===d("WAWebEphemeralityTypes").DisappearingModeInitiator.InitiatedByMe?d("WAWebEphemeralityTypes").DisappearingModeInitiator.ChangedInChat:a.initiator,disappearingModeTrigger:d("WAWebEphemeralityTypes").DisappearingModeTrigger.ChatSettings,initiatedByMe:a.initiator===d("WAWebEphemeralityTypes").DisappearingModeInitiator.InitiatedByMe};else if(a==null&&b!=null)return{duration:b.duration,settingTimestamp:p(b.settingTimestamp),initiator:o(b.initiator),disappearingModeTrigger:q(b.disappearingModeTrigger),initiatedByMe:b.initiatedByMe};else if(a!=null&&b!=null){var c;if(a.settingTimestamp>((c=b.settingTimestamp)!=null?c:0))return babelHelpers["extends"]({},a);else if(a.settingTimestamp<((c=b.settingTimestamp)!=null?c:0))return{duration:b.duration,settingTimestamp:p(b.settingTimestamp),initiator:o(b.initiator),disappearingModeTrigger:q(b.disappearingModeTrigger),initiatedByMe:b.initiatedByMe};return babelHelpers["extends"]({},a,{initiator:b.initiator===d("WAWebEphemeralityTypes").DisappearingModeInitiator.ChangedInChat?d("WAWebEphemeralityTypes").DisappearingModeInitiator.ChangedInChat:a.initiator})}}function e(a,b){d("WALogger").LOG(h()).devConsole({incomingMsgSettings:a,localDDMDuration:b});a=s(a);b=n(b);if(a==null&&b===0)return null;else if(a!=null&&b===0)return{duration:a.duration,settingTimestamp:a.settingTimestamp,initiator:a.initiator===d("WAWebEphemeralityTypes").DisappearingModeInitiator.InitiatedByMe?d("WAWebEphemeralityTypes").DisappearingModeInitiator.ChangedInChat:a.initiator,disappearingModeTrigger:a.disappearingModeTrigger,initiatedByMe:a.initiatedByMe};else if(a==null&&b>0)return{duration:b,settingTimestamp:d("WATimeUtils").unixTime(),initiator:d("WAWebEphemeralityTypes").DisappearingModeInitiator.InitiatedByMe,disappearingModeTrigger:d("WAWebEphemeralityTypes").DisappearingModeTrigger.AccountSettings,initiatedByMe:!0};else if(a!=null&&b>0){if(a.initiator===d("WAWebEphemeralityTypes").DisappearingModeInitiator.ChangedInChat||a.duration>0&&a.duration<b){var c=a.initiator,e=a.initiatedByMe;c===d("WAWebEphemeralityTypes").DisappearingModeInitiator.InitiatedByMe&&(c=d("WAWebEphemeralityTypes").DisappearingModeInitiator.ChangedInChat,e=!0);return{initiator:c,settingTimestamp:a.settingTimestamp,duration:a.duration,disappearingModeTrigger:a.disappearingModeTrigger,initiatedByMe:e}}return b<a.duration?{duration:b,settingTimestamp:d("WATimeUtils").unixTime(),initiator:d("WAWebEphemeralityTypes").DisappearingModeInitiator.InitiatedByMe,disappearingModeTrigger:d("WAWebEphemeralityTypes").DisappearingModeTrigger.AccountSettings,initiatedByMe:!0}:babelHelpers["extends"]({},a)}}g.getDisappearingModeSettingForUser=l;g.getEphemeralDurationForUser=m;g.resolveEphermalityDuration=n;g.resolveDisappearingModeInitiator=o;g.resolveSettingTimestamp=p;g.resolveDisappearingModeTrigger=q;g.resolveDisappearingModeInitiatedByMe=r;g.resolveMessageEphemerality=s;g.compareEphemeralityFields=a;g.resolveNewChatDMSettings=b;g.resolveExistingChatDMSettings=c;g.resolveNewIncomingChatDMSettings=e}),98);
__d("WAWebWamEnumChatGatedReason",[],(function(a,b,c,d,e,f){a=Object.freeze({TOS3:1,COUNTRY:2});f.CHAT_GATED_REASON=a}),66);
__d("WAWebGatedMessageReceivedWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumChatGatedReason"],(function(a,b,c,d,e,f,g){a=d("WAWebWamCodegenUtils").defineEvents({GatedMessageReceived:[3152,{chatGatedReason:[1,d("WAWebWamEnumChatGatedReason").CHAT_GATED_REASON]},[1,1,1],"regular"]});g.GatedMessageReceivedWamEvent=a}),98);
__d("WAWebWamEnumAgentEngagementEnumType",[],(function(a,b,c,d,e,f){a=Object.freeze({DIRECT_CHAT:0,INVOKED:1,MEMBER:2});f.AGENT_ENGAGEMENT_ENUM_TYPE=a}),66);
__d("WAWebWamEnumBotType",[],(function(a,b,c,d,e,f){a=Object.freeze({UNKNOWN:0,METABOT:1,BOT_1P_BIZ:2,BOT_3P_BIZ:3});f.BOT_TYPE=a}),66);
__d("WAWebWamEnumMessageType",[],(function(a,b,c,d,e,f){a=Object.freeze({INDIVIDUAL:1,GROUP:2,BROADCAST:3,STATUS:4,CHANNEL:5,INTEROP:6});f.MESSAGE_TYPE=a}),66);
__d("WAWebWamEnumRevokeType",[],(function(a,b,c,d,e,f){a=Object.freeze({SENDER:0,ADMIN:1});f.REVOKE_TYPE=a}),66);
__d("WAWebWamEnumSizeBucket",[],(function(a,b,c,d,e,f){a=Object.freeze({LT32:1,LT64:2,LT128:3,LT256:4,LT512:5,LT1000:6,LT1024:16,LT1500:7,LT2000:8,LT2500:9,LT3000:10,LT3500:11,LT4000:12,LT4500:13,LT5000:14,LARGEST_BUCKET:15});f.SIZE_BUCKET=a}),66);
__d("WAWebWamEnumStickerMakerSourceType",[],(function(a,b,c,d,e,f){a=Object.freeze({CUTOUT_IMAGE:1,WEB_STICKER_MAKER:2,IOS_STICKER_MAKER:3,ANDROID_STICKER_MAKER:4,TRANSPARENT_IMAGE:5});f.STICKER_MAKER_SOURCE_TYPE=a}),66);
__d("WAWebMessageReceiveWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumAddressingMode","WAWebWamEnumAgentEngagementEnumType","WAWebWamEnumBotType","WAWebWamEnumChatOriginsType","WAWebWamEnumDisappearingChatInitiatorType","WAWebWamEnumEditType","WAWebWamEnumEphemeralityInitiatorType","WAWebWamEnumEphemeralityTriggerActionType","WAWebWamEnumMediaType","WAWebWamEnumMessageType","WAWebWamEnumOppositeVisibleIdentificationType","WAWebWamEnumRevokeType","WAWebWamEnumSizeBucket","WAWebWamEnumStickerMakerSourceType","WAWebWamEnumTypeOfGroupEnum"],(function(a,b,c,d,e,f,g){b=(a=d("WAWebWamCodegenUtils")).defineEvents({MessageReceive:[450,{agentEngagementType:[28,d("WAWebWamEnumAgentEngagementEnumType").AGENT_ENGAGEMENT_ENUM_TYPE],botType:[37,d("WAWebWamEnumBotType").BOT_TYPE],chatOrigins:[38,d("WAWebWamEnumChatOriginsType").CHAT_ORIGINS_TYPE],deviceCount:[16,a.TYPES.INTEGER],deviceSizeBucket:[10,d("WAWebWamEnumSizeBucket").SIZE_BUCKET],disappearingChatInitiator:[14,d("WAWebWamEnumDisappearingChatInitiatorType").DISAPPEARING_CHAT_INITIATOR_TYPE],editType:[25,d("WAWebWamEnumEditType").EDIT_TYPE],ephemeralityDuration:[13,a.TYPES.INTEGER],ephemeralityInitiator:[26,d("WAWebWamEnumEphemeralityInitiatorType").EPHEMERALITY_INITIATOR_TYPE],ephemeralityTriggerAction:[27,d("WAWebWamEnumEphemeralityTriggerActionType").EPHEMERALITY_TRIGGER_ACTION_TYPE],hasUsername:[39,a.TYPES.BOOLEAN],isAComment:[36,a.TYPES.BOOLEAN],isAReply:[19,a.TYPES.BOOLEAN],isForwardedForward:[18,a.TYPES.BOOLEAN],isLid:[24,a.TYPES.BOOLEAN],isViewOnce:[9,a.TYPES.BOOLEAN],localAddressingMode:[33,d("WAWebWamEnumAddressingMode").ADDRESSING_MODE],messageAddressingMode:[34,d("WAWebWamEnumAddressingMode").ADDRESSING_MODE],messageIsInternational:[4,a.TYPES.BOOLEAN],messageIsInvisible:[23,a.TYPES.BOOLEAN],messageIsOffline:[5,a.TYPES.BOOLEAN],messageMediaType:[2,d("WAWebWamEnumMediaType").MEDIA_TYPE],messageQueueTime:[15,a.TYPES.TIMER],messageReceiveT0:[6,a.TYPES.TIMER],messageReceiveT1:[7,a.TYPES.TIMER],messageType:[1,d("WAWebWamEnumMessageType").MESSAGE_TYPE],mutedGroupMessage:[8,a.TYPES.BOOLEAN],numOfWebUrlsInTextMessage:[3,a.TYPES.INTEGER],offlineCount:[30,a.TYPES.INTEGER],oppositeVisibleIdentification:[40,d("WAWebWamEnumOppositeVisibleIdentificationType").OPPOSITE_VISIBLE_IDENTIFICATION_TYPE],paddingBytesSize:[22,a.TYPES.INTEGER],participantCount:[17,a.TYPES.INTEGER],receiverDefaultDisappearingDuration:[12,a.TYPES.INTEGER],revokeType:[20,d("WAWebWamEnumRevokeType").REVOKE_TYPE],senderDefaultDisappearingDuration:[11,a.TYPES.INTEGER],serverAddressingMode:[35,d("WAWebWamEnumAddressingMode").ADDRESSING_MODE],stickerIsAi:[29,a.TYPES.BOOLEAN],stickerIsFromStickerMaker:[31,a.TYPES.BOOLEAN],stickerMakerSourceType:[32,d("WAWebWamEnumStickerMakerSourceType").STICKER_MAKER_SOURCE_TYPE],typeOfGroup:[21,d("WAWebWamEnumTypeOfGroupEnum").TYPE_OF_GROUP_ENUM]},[1,1,1],"regular"]});g.MessageReceiveWamEvent=b}),98);
__d("WAWebWamGroupMetadataMetricUtils",["WAWebDBGroupsGroupMetadata","WAWebGroupType","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a!=null&&a.isGroup()){a=(yield d("WAWebDBGroupsGroupMetadata").getGroupMetadata(a));if(a!=null)return d("WAWebGroupType").groupTypeToWamEnum(d("WAWebGroupType").getGroupTypeFromGroupMetadata(a))}});return h.apply(this,arguments)}function c(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("WAWebDBGroupsGroupMetadata").getGroupMetadata(a));return a==null?null:j(a)});return i.apply(this,arguments)}function j(a){return d("WAWebGroupType").getGroupTypeFromGroupMetadata(a)===d("WAWebGroupType").GroupType.LINKED_ANNOUNCEMENT_GROUP&&(a==null?void 0:a.incognito)===!0}g.getGroupTypeFromChatWid=a;g.isCagIncognitoFromChatWid=c;g.isCagIncognitoFromGroupMetadata=j}),98);
__d("WAWebWamNumberToSizeBucket",["WAWebWamEnumSizeBucket"],(function(a,b,c,d,e,f,g){function a(a){if(a<32)return d("WAWebWamEnumSizeBucket").SIZE_BUCKET.LT32;if(a<64)return d("WAWebWamEnumSizeBucket").SIZE_BUCKET.LT64;if(a<128)return d("WAWebWamEnumSizeBucket").SIZE_BUCKET.LT128;if(a<256)return d("WAWebWamEnumSizeBucket").SIZE_BUCKET.LT256;if(a<512)return d("WAWebWamEnumSizeBucket").SIZE_BUCKET.LT512;if(a<1024)return d("WAWebWamEnumSizeBucket").SIZE_BUCKET.LT1024;if(a<1500)return d("WAWebWamEnumSizeBucket").SIZE_BUCKET.LT1500;if(a<2e3)return d("WAWebWamEnumSizeBucket").SIZE_BUCKET.LT2000;if(a<2500)return d("WAWebWamEnumSizeBucket").SIZE_BUCKET.LT2500;if(a<3e3)return d("WAWebWamEnumSizeBucket").SIZE_BUCKET.LT3000;if(a<3500)return d("WAWebWamEnumSizeBucket").SIZE_BUCKET.LT3500;if(a<4e3)return d("WAWebWamEnumSizeBucket").SIZE_BUCKET.LT4000;if(a<4500)return d("WAWebWamEnumSizeBucket").SIZE_BUCKET.LT4500;return a<5e3?d("WAWebWamEnumSizeBucket").SIZE_BUCKET.LT5000:d("WAWebWamEnumSizeBucket").SIZE_BUCKET.LARGEST_BUCKET}g["default"]=a}),98);
__d("WAWebWamGroupMetricUtils",["WAWebWamNumberToSizeBucket"],(function(a,b,c,d,e,f,g){function h(a){return Math.max(a,32)}function a(a){var b=Object.freeze({}),c=a.participants.length;c!=null&&(b=babelHelpers["extends"]({participantCount:h(c)},b));c=a.cachedDeviceCount;c!=null&&(b=babelHelpers["extends"]({deviceCount:h(c)},b));return b}function b(a){return{participantCount:h(a.participants.length),deviceCount:h(a.senderKey.size),deviceSizeBucket:c("WAWebWamNumberToSizeBucket")(a.senderKey.size)}}g.capCount=h;g.getGroupCountMetricsFromGroupMetadata=a;g.getGroupMetricsFromDbRecord=b}),98);
__d("WAWebWamGroupMetricCache",["Promise","WALogger","WAWebSchemaParticipant","WAWebWamGroupMetricUtils"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["_getGroupMetricsFromDb: failed to get for ",": ",""]);i=function(){return a};return a}var j=new Map();function a(a){if(!a.isGroup())return(h||(h=b("Promise"))).resolve(null);a=a.toString();j.has(a)||j.set(a,k(a));return j.get(a)||(h||(h=b("Promise"))).resolve(null)}function k(a){return d("WAWebSchemaParticipant").getParticipantTable().get(a).then(function(a){return a&&d("WAWebWamGroupMetricUtils").getGroupMetricsFromDbRecord(a)})["catch"](function(b){d("WALogger").WARN(i(),a,b)})}function c(a){if(a.participants==null||a.senderKey==null)return;j.set(a.groupId,(h||(h=b("Promise"))).resolve(d("WAWebWamGroupMetricUtils").getGroupMetricsFromDbRecord(a)))}g.getGroupMetrics=a;g.cacheGroupMetrics=c}),98);
__d("WAWebWamEnumE2eSenderType",[],(function(a,b,c,d,e,f){a=Object.freeze({MY_PRIMARY:1,OTHER_PRIMARY:2,MY_COMPANION:3,OTHER_COMPANION:4,MY_HOSTED_COMPANION:5,OTHER_HOSTED_COMPANION:6});f.E2E_SENDER_TYPE=a}),66);
__d("WAWebWamEnumInvisibleMessageCategoryType",[],(function(a,b,c,d,e,f){a=Object.freeze({PEER:1,INVISIBLE_KEY_DISTRIBUTION:2,OTHER:3});f.INVISIBLE_MESSAGE_CATEGORY_TYPE=a}),66);
__d("WAWebWamMsgUtils",["WAWebApiParse","WAWebBotTypes","WAWebHandleMsgCommon","WAWebInteractiveMessageType","WAWebMsgGetters","WAWebProtobufsE2E.pb","WAWebUserPrefsMeUser","WAWebWamEnumAgentEngagementEnumType","WAWebWamEnumBotType","WAWebWamEnumE2eSenderType","WAWebWamEnumInvisibleMessageCategoryType","WAWebWamEnumMediaType","WAWebWamEnumMessageType","WAWebWid"],(function(a,b,c,d,e,f,g){function a(a){if(d("WAWebMsgGetters").getIsStatusV3(a))return d("WAWebWamEnumMessageType").MESSAGE_TYPE.STATUS;else if(d("WAWebMsgGetters").getIsGroupMsg(a))return d("WAWebWamEnumMessageType").MESSAGE_TYPE.GROUP;else if(c("WAWebWid").isBroadcast(a.id.remote))return d("WAWebWamEnumMessageType").MESSAGE_TYPE.BROADCAST;else if(c("WAWebWid").isNewsletter(a.id.remote))return d("WAWebWamEnumMessageType").MESSAGE_TYPE.CHANNEL;return d("WAWebWamEnumMessageType").MESSAGE_TYPE.INDIVIDUAL}function b(a){switch(a){case"chat":return d("WAWebWamEnumMessageType").MESSAGE_TYPE.INDIVIDUAL;case"group":return d("WAWebWamEnumMessageType").MESSAGE_TYPE.GROUP;case"peer_broadcast":case"other_broadcast":return d("WAWebWamEnumMessageType").MESSAGE_TYPE.BROADCAST;case"direct_peer_status":case"other_status":return d("WAWebWamEnumMessageType").MESSAGE_TYPE.STATUS}}function e(a){if(a.isDynamicReplyButtonsMsg===!0)return d("WAWebWamEnumMediaType").MEDIA_TYPE.BUTTON_MESSAGE;switch(a.type){case"image":return d("WAWebWamEnumMediaType").MEDIA_TYPE.PHOTO;case"video":return a.isGif===!0?d("WAWebWamEnumMediaType").MEDIA_TYPE.GIF:d("WAWebWamEnumMediaType").MEDIA_TYPE.VIDEO;case"ptv":return d("WAWebWamEnumMediaType").MEDIA_TYPE.PUSH_TO_VIDEO;case"audio":return d("WAWebWamEnumMediaType").MEDIA_TYPE.AUDIO;case"ptt":return d("WAWebWamEnumMediaType").MEDIA_TYPE.PTT;case"document":return d("WAWebWamEnumMediaType").MEDIA_TYPE.DOCUMENT;case"unknown":return d("WAWebWamEnumMediaType").MEDIA_TYPE.FUTURE;case"location":return a.isLive===!0?d("WAWebWamEnumMediaType").MEDIA_TYPE.LIVE_LOCATION:d("WAWebWamEnumMediaType").MEDIA_TYPE.LOCATION;case"vcard":return d("WAWebWamEnumMediaType").MEDIA_TYPE.CONTACT;case"multi_vcard":return d("WAWebWamEnumMediaType").MEDIA_TYPE.CONTACT_ARRAY;case"chat":if(a.matchedText!=null){if(d("WAWebApiParse").matchCatalogUrl(a.matchedText))return d("WAWebWamEnumMediaType").MEDIA_TYPE.CATALOG_LINK;else if(d("WAWebApiParse").matchProductUrl(a.matchedText))return d("WAWebWamEnumMediaType").MEDIA_TYPE.PRODUCT_LINK;return d("WAWebWamEnumMediaType").MEDIA_TYPE.URL}return d("WAWebWamEnumMediaType").MEDIA_TYPE.NONE;case"sticker":return d("WAWebWamEnumMediaType").MEDIA_TYPE.STICKER;case"product":return d("WAWebWamEnumMediaType").MEDIA_TYPE.PRODUCT_IMAGE;case"list":var b;b=(b=(b=a.list)==null?void 0:b.listType)!=null?b:d("WAWebProtobufsE2E.pb").Message$ListMessage$ListType.UNKNOWN;switch(b){case d("WAWebProtobufsE2E.pb").Message$ListMessage$ListType.SINGLE_SELECT:return d("WAWebWamEnumMediaType").MEDIA_TYPE.LIST;case d("WAWebProtobufsE2E.pb").Message$ListMessage$ListType.PRODUCT_LIST:return d("WAWebWamEnumMediaType").MEDIA_TYPE.PRODUCT_LIST;default:return d("WAWebWamEnumMediaType").MEDIA_TYPE.NONE}case"list_response":return d("WAWebWamEnumMediaType").MEDIA_TYPE.LIST_REPLY;case"buttons_response":return d("WAWebWamEnumMediaType").MEDIA_TYPE.BUTTON_RESPONSE_MESSAGE;case"order":return d("WAWebWamEnumMediaType").MEDIA_TYPE.ORDER;case"interactive":return h(a.interactiveType);case"reaction":case"reaction_enc":return d("WAWebWamEnumMediaType").MEDIA_TYPE.REACTION;case"poll_creation":return d("WAWebWamEnumMediaType").MEDIA_TYPE.POLL_CREATE;case"poll_update":return a.subtype==="poll_vote"?d("WAWebWamEnumMediaType").MEDIA_TYPE.POLL_VOTE:d("WAWebWamEnumMediaType").MEDIA_TYPE.NONE;case"keep_in_chat":return a.keepType===d("WAWebProtobufsE2E.pb").KeepType.KEEP_FOR_ALL?d("WAWebWamEnumMediaType").MEDIA_TYPE.KEEP:d("WAWebWamEnumMediaType").MEDIA_TYPE.UNKEEP;case"pin_message":return d("WAWebWamEnumMediaType").MEDIA_TYPE.PIN_IN_CHAT;case"protocol":return a.subtype==="ephemeral_sync_response"?d("WAWebWamEnumMediaType").MEDIA_TYPE.EPHEMERAL_SYNC_RESPONSE:d("WAWebWamEnumMediaType").MEDIA_TYPE.NONE;case"event_creation":return d("WAWebWamEnumMediaType").MEDIA_TYPE.EVENT_CREATE;case"event_response":return d("WAWebWamEnumMediaType").MEDIA_TYPE.EVENT_RESPOND;case"biz-cover-photo":case"broadcast_notification":case"call_log":case"ciphertext":case"debug_placeholder":case"debug":case"e2e_notification":case"gp2":case"groups_v4_invite":case"hsm":case"interactive_response":case"native_flow":case"newsletter_notification":case"notification":case"notification_template":case"oversized":case"payment":case"pinned_message":case"request_phone_number":case"revoked":case"status_v3":case"template_button_reply":case"comment":case"history_bundle":case"newsletter_admin_invite":case"biz_content_placeholder":case"event_edit_encrypted":return d("WAWebWamEnumMediaType").MEDIA_TYPE.NONE;default:a.type;return d("WAWebWamEnumMediaType").MEDIA_TYPE.NONE}}function h(a){if(a==null)return d("WAWebWamEnumMediaType").MEDIA_TYPE.NONE;switch(a){case c("WAWebInteractiveMessageType").SHOPS_STOREFRONT:return d("WAWebWamEnumMediaType").MEDIA_TYPE.SHOP_STOREFRONT;case c("WAWebInteractiveMessageType").NATIVE_FLOW:return d("WAWebWamEnumMediaType").MEDIA_TYPE.INTERACTIVE_NFM;case c("WAWebInteractiveMessageType").CAROUSEL:return d("WAWebWamEnumMediaType").MEDIA_TYPE.INTERACTIVE_CAROUSEL}}function f(a){if(!(a instanceof c("WAWebWid")))return null;return d("WAWebUserPrefsMeUser").isMeAccount(a)?a.isCompanion()?d("WAWebWamEnumE2eSenderType").E2E_SENDER_TYPE.MY_COMPANION:d("WAWebWamEnumE2eSenderType").E2E_SENDER_TYPE.MY_PRIMARY:a.isCompanion()?d("WAWebWamEnumE2eSenderType").E2E_SENDER_TYPE.OTHER_COMPANION:d("WAWebWamEnumE2eSenderType").E2E_SENDER_TYPE.OTHER_PRIMARY}function i(a){if(a.id.remote.isBot())return d("WAWebWamEnumAgentEngagementEnumType").AGENT_ENGAGEMENT_ENUM_TYPE.DIRECT_CHAT;var b=d("WAWebMsgGetters").getIsBotQuery(a);a=d("WAWebMsgGetters").getIsMetaBotResponse(a);return b||a?d("WAWebWamEnumAgentEngagementEnumType").AGENT_ENGAGEMENT_ENUM_TYPE.INVOKED:null}function j(a,b,c){if(a==null?void 0:a.isBot())return d("WAWebWamEnumBotType").BOT_TYPE.METABOT;if(b){if(b===d("WAWebBotTypes").BizBotType.BIZ_1P)return d("WAWebWamEnumBotType").BOT_TYPE.BOT_1P_BIZ;if(b===d("WAWebBotTypes").BizBotType.BIZ_3P)return d("WAWebWamEnumBotType").BOT_TYPE.BOT_3P_BIZ}if(c){if(c===d("WAWebBotTypes").BizBotAutomatedType.PARTIAL_1P)return d("WAWebWamEnumBotType").BOT_TYPE.BOT_1P_BIZ;if(c===d("WAWebBotTypes").BizBotAutomatedType.FULL_3P)return d("WAWebWamEnumBotType").BOT_TYPE.BOT_3P_BIZ}return d("WAWebWamEnumBotType").BOT_TYPE.UNKNOWN}function k(a){if(a==null||a==="")return null;switch(a){case d("WAWebHandleMsgCommon").CATEGORY_PEER:return d("WAWebWamEnumInvisibleMessageCategoryType").INVISIBLE_MESSAGE_CATEGORY_TYPE.PEER;default:return null}}g.getWamMessageType=a;g.getMessageTypeFromMsgInfoType=b;g.getWamMediaType=e;g.getInteractiveWamType=h;g.getWamE2eSenderType=f;g.getWamAgentEngagementType=i;g.getWamBotType=j;g.getWamInvisibleMessageCatgoryType=k}),98);
__d("WAWebLogReceivedMessages",["Promise","WALogger","WATimeUtils","WAWebABProps","WAWebBackendApi","WAWebChatThreadLogging","WAWebChatThreadLoggingUtils","WAWebEphemeralityResolver","WAWebGatedMessageReceivedWamEvent","WAWebMessageReceiveWamEvent","WAWebMsgGetters","WAWebRuntimeEnvironmentUtils","WAWebSchemaContact","WAWebUserPrefsMeUser","WAWebWamAddressingModeUtils","WAWebWamEnumChatGatedReason","WAWebWamEnumRevokeType","WAWebWamGroupMetadataMetricUtils","WAWebWamGroupMetricCache","WAWebWamMsgUtils","WAWebWidFactory","WAWebWorkerSafeBackendApi","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["error logging received messages: ",""]);i=function(){return a};return a}function j(a,b,c,d,e,f,g,h){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e,f,g,i,j,k){var l,m=d("WATimeUtils").unixTimeMs(),n=(l=f.get(d("WAWebUserPrefsMeUser").assertGetMeUser().toJid()))==null?void 0:l.ephemeralDuration;yield (h||(h=b("Promise"))).all(a.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.from;if(b==null)return;var h=new(d("WAWebMessageReceiveWamEvent").MessageReceiveWamEvent)({messageType:d("WAWebWamMsgUtils").getWamMessageType(a),messageMediaType:d("WAWebWamMsgUtils").getWamMediaType(a),messageIsInternational:d("WAWebMsgGetters").getIsInternational(a),messageIsOffline:c,isViewOnce:Boolean(a.isViewOnce),isForwardedForward:d("WAWebMsgGetters").getNumTimesForwarded(a)>1,isAReply:d("WAWebMsgGetters").getIsReply(a),editType:d("WAWebMsgGetters").getWamEditType(a),botType:d("WAWebWamMsgUtils").getWamBotType(b,a.bizBotType)});if(!b.isGroup()){var l;l=(l=f.get(b.toJid()))==null?void 0:l.ephemeralDuration;l!=null&&(h.senderDefaultDisappearingDuration=l);n!=null&&(h.receiverDefaultDisappearingDuration=n);h.isLid=b.isLid()}d("WAWebMsgGetters").getIsRevoke(a)&&(h.revokeType=a.subtype==="admin_revoke"?d("WAWebWamEnumRevokeType").REVOKE_TYPE.ADMIN:d("WAWebWamEnumRevokeType").REVOKE_TYPE.SENDER);g!=null&&(h.messageReceiveT0=g-e,h.messageReceiveT1=m-g,i!=null&&(h.messageQueueTime=i-g));a.ephemeralDuration!=null&&a.ephemeralDuration>0&&(h.ephemeralityDuration=a.ephemeralDuration);l=d("WAWebMsgGetters").getWamDisappearingModeInitiator(a);l!=null&&(h.disappearingChatInitiator=l);if(d("WAWebABProps").getABPropConfigValue("dm_initiator_trigger")){l=d("WAWebMsgGetters").getWamDisappearingModeTrigger(a);l!=null&&(h.ephemeralityTriggerAction=l);l=d("WAWebMsgGetters").getWamDisappearingModeInitiatedByMe(a);l!=null&&(h.ephemeralityInitiator=l)}l=d("WAWebWamMsgUtils").getWamAgentEngagementType(a);l!=null&&(h.agentEngagementType=l);l=(yield d("WAWebWamGroupMetadataMetricUtils").getGroupTypeFromChatWid(b));l!=null&&(h.typeOfGroup=l);d("WAWebABProps").getABPropConfigValue("web_extra_lid_group_logging_attributes")&&(j!=null&&(h.serverAddressingMode=d("WAWebWamAddressingModeUtils").getWamAddressingModeFromString(j)),k!=null&&(h.localAddressingMode=d("WAWebWamAddressingModeUtils").getWamAddressingModeFromString(k)));if(b==null?void 0:b.isGroup()){l=(yield d("WAWebWamGroupMetadataMetricUtils").isCagIncognitoFromChatWid(b));a=d("WAWebMsgGetters").getIsReaction(a);l!=null&&a!=null&&(h.isLid=l&&a);l=(yield d("WAWebWamGroupMetricCache").getGroupMetrics(b));(l==null?void 0:l.participantCount)!=null&&(h.participantCount=l.participantCount);(l==null?void 0:l.deviceCount)!=null&&(h.deviceCount=l.deviceCount);(l==null?void 0:l.deviceSizeBucket)!=null&&(h.deviceSizeBucket=l.deviceSizeBucket)}h.commit()});return function(b){return a.apply(this,arguments)}}()))});return k.apply(this,arguments)}function l(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=new Set(a.filter(function(a){return a.id.remote.isUser()}).map(function(a){return a.id.remote.toJid()}));a.add(d("WAWebUserPrefsMeUser").assertGetMeUser().toJid());var b=Array.from(a);if(d("WAWebRuntimeEnvironmentUtils").isWorker()){a=(yield d("WAWebSchemaContact").getContactTable().bulkGet(b));return new Map(a.map(function(a,c){return[b[c],{ephemeralDuration:d("WAWebEphemeralityResolver").getEphemeralDurationForUser(a),shouldBlockByCountry:function(){return!1},shouldBlockByTos:function(){return!1}}]}))}return d("WAWebWorkerSafeBackendApi").workerSafeSendAndReceive("getContactData",{ids:b.map(d("WAWebWidFactory").createWid)})});return m.apply(this,arguments)}function n(a,b){for(a of a){var c=b.get(a.id.remote.toJid());c&&!d("WAWebMsgGetters").getIsSentByMe(a)&&(c.shouldBlockByCountry()?new(d("WAWebGatedMessageReceivedWamEvent").GatedMessageReceivedWamEvent)({chatGatedReason:d("WAWebWamEnumChatGatedReason").CHAT_GATED_REASON.COUNTRY}).commit():c.shouldBlockByTos()&&new(d("WAWebGatedMessageReceivedWamEvent").GatedMessageReceivedWamEvent)({chatGatedReason:d("WAWebWamEnumChatGatedReason").CHAT_GATED_REASON.TOS3}).commit())}}function o(a){d("WAWebChatThreadLogging").handleActivitiesForChatThreadLogging(a.filter(d("WAWebChatThreadLoggingUtils").shouldIncrementMsgSendAndReceive).map(function(a){return{activityType:a.id.fromMe?"msgSend":"msgReceive",ts:a.t,chatId:a.id.remote,isViewOnce:a.isViewOnce===!0,isReaction:d("WAWebMsgGetters").getIsReaction(a),isForwarded:a.isForwarded===!0,isCommerceMessage:d("WAWebChatThreadLoggingUtils").isCommerceMessage(a),isReply:d("WAWebMsgGetters").getIsReply(a),isEdit:d("WAWebMsgGetters").getIsEditProtocolMsg(a),isBot:d("WAWebMsgGetters").getIsBotQuery(a)||d("WAWebMsgGetters").getIsMetaBotResponse(a)}}))}function p(a){a.filter(d("WAWebMsgGetters").getIsAuthenticationMessage).forEach(function(a){d("WAWebBackendApi").frontendFireAndForget("logOTPMessageReceivedActions",{msgData:a})})}function a(a,c,e,f,g,k,m){l(a).then(function(d){return(h||(h=b("Promise"))).all([j(a,c,e,d,f,g,k,m),n(a,d),o(a),p(a)])})["catch"](function(a){d("WALogger").WARN(i(),a)})}g.logReceivedMessagesInWAM=a}),98);
__d("WAWebParsedProtocolMsgType",[],(function(a,b,c,d,e,f){a=Object.freeze({HISTORY:"history",APP_STATE_SYNC_KEY_SHARE:"appStateSyncKeyShare",APP_STATE_SYNC_KEY_REQUEST:"appStateSyncKeyRequest",PEER_DATA_OPERATION_REQUEST_RESPONSE_MESSAGE:"peerDataOperationRequestResponseMessage",PEER_DATA_OPERATION_REQUEST_MESSAGE:"peerDataOperationRequestMessage"});f.PARSED_PROTOCOL_MESSAGE_TYPE=a}),66);
__d("WAWebProcessMatMessages",["WANullthrows","WAWebApiChat","WAWebMsgGetters","WAWebMsgKey","WAWebMsgType","WAWebPnhGatingUtils","WAWebWid","WAWebWorkerSafeBackendApi","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=[],f=[];a=a.filter(function(a){var b;b=(b=a.id.remote)!=null?b:a.from;if(b.isUser()){var c;f.push((c=a.id.remote)!=null?c:a.from)}else e.push(a);return b.isUser()});var g=a.filter(function(a){return a.subtype==="sender_revoke"}),h=[];g.forEach(function(a){a=a.protocolMessageKey;a&&(h.push(a),a.remote.isUser()&&f.push(a.remote))});var i=(yield d("WAWebApiChat").getMatChatBulk(f)),j=new Map();g.forEach(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.protocolMessageKey;if(b!=null){var d=(yield i.get(b.remote));if(d!=null&&!c("WAWebWid").equals(d,b.remote)){b=c("WAWebMsgKey").from({fromMe:b.fromMe,id:b.id,participant:b.participant,remote:d});j.set(a.id.id,b)}}});return function(b){return a.apply(this,arguments)}}());a.forEach(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b;b=(b=(yield i.get((b=a.id.remote)!=null?b:a.from)))!=null?b:a.id.remote;if(b.isSameAccount(a.id.remote)){e.push(a);return}var f=c("WAWebMsgKey").from({fromMe:a.id.fromMe,id:a.id.id,participant:a.id.participant,remote:b});if(a.subtype==="sender_revoke"){var g;e.push(babelHelpers["extends"]({},a,{id:f,kind:d("WAWebMsgType").MsgKind.ProtocolRevoke,protocolMessageKey:(g=j.get(a.id.id))!=null?g:a.protocolMessageKey,from:a.id.fromMe?a.from:b}))}else e.push(babelHelpers["extends"]({},a,{id:f,from:a.id.fromMe?a.from:b}));d("WAWebWorkerSafeBackendApi").workerSafeFireAndForget("incrementPnhCtwaDailyCount",{chatId:b})});return function(b){return a.apply(this,arguments)}}());return e});return h.apply(this,arguments)}function i(a,b,d){d=c("WAWebMsgKey").from({fromMe:d.fromMe,id:d.id,participant:d.participant,remote:b});a=c("WAWebMsgKey").from({fromMe:a.fromMe,id:a.id,participant:a.participant,remote:b});return{newMsgKey:a,newParentMsgKey:d}}function e(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){return n(a,"reactionParentKey")});return j.apply(this,arguments)}function f(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){return n(a,"protocolMessageKey")});return k.apply(this,arguments)}function l(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){return n(a,"pollUpdateParentKey")});return m.apply(this,arguments)}function n(a,b){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e;e=(e=a.id.remote)!=null?e:a.from;if(!e.isUser())return a;var f=(yield d("WAWebApiChat").getMatChat(e)),g=a[b];if(f==null||g==null||!(g instanceof c("WAWebMsgKey"))||f.isSameAccount(e))return a;e=i(a.id,f,g);g=e.newMsgKey;e=e.newParentMsgKey;d("WAWebWorkerSafeBackendApi").workerSafeFireAndForget("incrementPnhCtwaDailyCount",{chatId:f});return babelHelpers["extends"]({},a,(g={id:g},g[b]=e,g.from=a.id.fromMe?a.from:f,g))});return o.apply(this,arguments)}function p(a){var b=new Set(),e=new Map();d("WAWebPnhGatingUtils").isMatFullyEnabled()&&a.forEach(function(a){var f=c("WANullthrows")(a.pollUpdateParentKey);a=d("WAWebMsgGetters").getOriginalSender(a);if(f!=null&&a!=null&&f.remote.isUser()&&!a.isSameAccount(f.remote)){a=c("WAWebMsgKey").from({fromMe:f.fromMe,id:f.id,participant:f.participant,remote:a});b.add(a.toString());e.set(f.toString(),a)}});return{matParentMsgKeys:b,alternateWidMap:e}}g.processRenderableMatMessages=a;g.processReactionMatMessages=e;g.processEditMatMessages=f;g.processPollUpdateMatMessages=l;g.processAddonMatMessages=n;g.getAlternateWidMapForPolls=p}),98);
__d("WAWebNotificationConstants",[],(function(a,b,c,d,e,f){a="granted";b="default";c="denied";f.PERMISSION_ALLOWED=a;f.PERMISSION_DEFAULT=b;f.PERMISSION_DENIED=c}),66);
__d("WAWebUserPrefsNotifications",["WATimeUtils","WAWebNotificationConstants","WAWebUserPrefsKeys","WAWebUserPrefsStore","cr:5151"],(function(a,b,c,d,e,f,g){function a(){return c("WAWebUserPrefsStore").getUser(d("WAWebUserPrefsKeys").KEYS.GLOBAL_MUTE_SOUNDS)!==!0}function e(a){c("WAWebUserPrefsStore").setUser(d("WAWebUserPrefsKeys").KEYS.GLOBAL_MUTE_SOUNDS,!a)}function f(){return c("WAWebUserPrefsStore").getUser(d("WAWebUserPrefsKeys").KEYS.GLOBAL_MUTE_CALL_RINGTONE)!==!0}function h(a){c("WAWebUserPrefsStore").setUser(d("WAWebUserPrefsKeys").KEYS.GLOBAL_MUTE_CALL_RINGTONE,!a)}function i(){var a=c("WAWebUserPrefsStore").getUser(d("WAWebUserPrefsKeys").KEYS.GLOBAL_MUTE_NOTIFICATIONS);if(typeof a!=="boolean"){var b;return((b=window.Notification)==null?void 0:b.permission)===d("WAWebNotificationConstants").PERMISSION_ALLOWED}return!a}function j(a){c("WAWebUserPrefsStore").setUser(d("WAWebUserPrefsKeys").KEYS.GLOBAL_MUTE_NOTIFICATIONS,!a)}function k(){return c("WAWebUserPrefsStore").getUser(d("WAWebUserPrefsKeys").KEYS.GLOBAL_OFFLINE_NOTIFICATIONS_ENABLED)===!0}function l(a){c("WAWebUserPrefsStore").setUser(d("WAWebUserPrefsKeys").KEYS.GLOBAL_OFFLINE_NOTIFICATIONS_ENABLED,a)}function m(){return c("WAWebUserPrefsStore").getUser(d("WAWebUserPrefsKeys").KEYS.SECURITY_NOTIFICATIONS)!==!0}function n(a){c("WAWebUserPrefsStore").setUser(d("WAWebUserPrefsKeys").KEYS.SECURITY_NOTIFICATIONS,!a)}var o={isDismissed:!1,firstSeenTime:null};function p(){var a=c("WAWebUserPrefsStore").getUser(d("WAWebUserPrefsKeys").KEYS.WEB_NOTIFICATIONS_BB_STATUS);if(a==null)return o;if(typeof a!=="object"||a instanceof Array)return o;a={isDismissed:a.isDismissed===!0,firstSeenTime:typeof a.firstSeenTime==="number"?d("WATimeUtils").castToUnixTime(a.firstSeenTime):null};return a}function q(a){var b,e=p();e=e.firstSeenTime;e=e===void 0?null:e;b=(b=a.firstSeenTime)!=null?b:e;c("WAWebUserPrefsStore").setUser(d("WAWebUserPrefsKeys").KEYS.WEB_NOTIFICATIONS_BB_STATUS,{isDismissed:a.isDismissed,firstSeenTime:b})}var r={isDismissed:!1,firstSeenTime:null,isLongResumeTime:!1};function s(){var a=c("WAWebUserPrefsStore").getUser(d("WAWebUserPrefsKeys").KEYS.OFFLINE_NOTIFICATIONS_BB_STATUS);if(a==null||typeof a!=="object"||a instanceof Array)return r;a={isDismissed:a.isDismissed===!0,firstSeenTime:typeof a.firstSeenTime==="number"?d("WATimeUtils").castToUnixTime(a.firstSeenTime):null,isLongResumeTime:a.isLongResumeTime===!0};return a}function t(a){var b,e=s(),f=e.isDismissed;f=f===void 0?!1:f;var g=e.firstSeenTime;g=g===void 0?null:g;e=e.isLongResumeTime;e=e===void 0?!1:e;b=(b=a.isDismissed)!=null?b:f;f=(f=a.firstSeenTime)!=null?f:g;a=(g=a.isLongResumeTime)!=null?g:e;c("WAWebUserPrefsStore").setUser(d("WAWebUserPrefsKeys").KEYS.OFFLINE_NOTIFICATIONS_BB_STATUS,{isDismissed:b,firstSeenTime:f,isLongResumeTime:a})}function u(){return c("WAWebUserPrefsStore").getUser(d("WAWebUserPrefsKeys").KEYS.GLOBAL_MUTE_PREVIEWS)!==!0}function v(a){c("WAWebUserPrefsStore").setUser(d("WAWebUserPrefsKeys").KEYS.GLOBAL_MUTE_PREVIEWS,!a)}function w(){return b("cr:5151")?c("WAWebUserPrefsStore").getUser(b("cr:5151").IGNORE_NONDIRECT_GROUP_MSG)===!0:!1}function x(a){b("cr:5151")&&c("WAWebUserPrefsStore").setUser(b("cr:5151").IGNORE_NONDIRECT_GROUP_MSG,a)}function y(){return c("WAWebUserPrefsStore").getUser(d("WAWebUserPrefsKeys").KEYS.OUTGOING_MESSAGE_SOUND)===!0}function z(a){c("WAWebUserPrefsStore").setUser(d("WAWebUserPrefsKeys").KEYS.OUTGOING_MESSAGE_SOUND,a)}function A(){return c("WAWebUserPrefsStore").getUser(d("WAWebUserPrefsKeys").KEYS.GLOBAL_COLLAPSE_MUTED)===!0}function B(a){c("WAWebUserPrefsStore").setUser(d("WAWebUserPrefsKeys").KEYS.GLOBAL_COLLAPSE_MUTED,a)}function C(){return c("WAWebUserPrefsStore").getUser(d("WAWebUserPrefsKeys").KEYS.GLOBAL_OFFLINE_NOTIFICATIONS_INTERNAL_ENABLED_ONCE)===!0}function D(){c("WAWebUserPrefsStore").setUser(d("WAWebUserPrefsKeys").KEYS.GLOBAL_OFFLINE_NOTIFICATIONS_INTERNAL_ENABLED_ONCE,!0)}g.getGlobalSounds=a;g.setGlobalSounds=e;g.getGlobalCallRingtone=f;g.setGlobalCallRingtone=h;g.getGlobalNotifications=i;g.setGlobalNotifications=j;g.getGlobalOfflineNotifications=k;g.setGlobalOfflineNotifications=l;g.getGlobalSecurityNotifications=m;g.setGlobalSecurityNotifications=n;g.DEFAULT_NOTIFICATION_BB_STATUS=o;g.getWebNotificationsBBStatus=p;g.setWebNotificationsBBStatus=q;g.DEFAULT_OFFLINE_NOTIFICATION_BB_STATUS=r;g.getOfflineNotificationsBBStatus=s;g.setOfflineNotificationsBBStatus=t;g.getGlobalPreviews=u;g.setGlobalPreviews=v;g.getIgnoreNondirectGroupMsg=w;g.setIgnoreNondirectGroupMsg=x;g.getOutgoingMessageSound=y;g.setOutgoingMessageSound=z;g.getCollapseMuted=A;g.setCollapseMuted=B;g.getOfflineNotificationsInternalEnabledOnce=C;g.setOfflineNotificationsInternalEnabledOnce=D}),98);
__d("WAWebVerifyProtobufMsgObjectKeys",["$InternalEnum","WAWebABProps","WAWebHandleMsgError","WAWebMsgType"],(function(a,b,c,d,e,f,g){var h=b("$InternalEnum")({Buttons:1,Template:2,SenderKeyDistribution:3,UnknownMessageKey:4});function i(a,b){switch(a){case"$$unknownFieldCount":return b[a]===0?null:d("WAWebMsgType").MSG_TYPE.UNKNOWN;case"messageContextInfo":return null;case"contactMessage":return d("WAWebMsgType").MSG_TYPE.VCARD;case"contactsArrayMessage":return d("WAWebMsgType").MSG_TYPE.MULTI_VCARD;case"conversation":case"extendedTextMessage":return d("WAWebMsgType").MSG_TYPE.CHAT;case"imageMessage":return d("WAWebMsgType").MSG_TYPE.IMAGE;case"locationMessage":case"liveLocationMessage":return d("WAWebMsgType").MSG_TYPE.LOCATION;case"documentMessage":return d("WAWebMsgType").MSG_TYPE.DOCUMENT;case"audioMessage":return d("WAWebMsgType").MSG_TYPE.AUDIO;case"videoMessage":return d("WAWebMsgType").MSG_TYPE.VIDEO;case"protocolMessage":return d("WAWebMsgType").MSG_TYPE.PROTOCOL;case"highlyStructuredMessage":return d("WAWebMsgType").MSG_TYPE.PROTOCOL;case"sendPaymentMessage":case"requestPaymentMessage":case"paymentInviteMessage":return d("WAWebMsgType").MSG_TYPE.PAYMENT;case"declinePaymentRequestMessage":case"cancelPaymentRequestMessage":return d("WAWebMsgType").MSG_TYPE.UNKNOWN;case"stickerMessage":return d("WAWebMsgType").MSG_TYPE.STICKER;case"groupInviteMessage":return d("WAWebMsgType").MSG_TYPE.GROUPS_V4_INVITE;case"templateButtonReplyMessage":return d("WAWebMsgType").MSG_TYPE.TEMPLATE_BUTTON_REPLY;case"productMessage":return d("WAWebMsgType").MSG_TYPE.PRODUCT;case"listMessage":return d("WAWebMsgType").MSG_TYPE.LIST;case"orderMessage":return d("WAWebMsgType").MSG_TYPE.ORDER;case"listResponseMessage":return d("WAWebMsgType").MSG_TYPE.LIST_RESPONSE;case"buttonsResponseMessage":return d("WAWebMsgType").MSG_TYPE.BUTTONS_RESPONSE;case"interactiveMessage":return d("WAWebMsgType").MSG_TYPE.INTERACTIVE;case"interactiveResponseMessage":return d("WAWebMsgType").MSG_TYPE.INTERACTIVE_RESPONSE;case"reactionMessage":return d("WAWebMsgType").MSG_TYPE.REACTION;case"encReactionMessage":return d("WAWebMsgType").MSG_TYPE.REACTION_ENC;case"encCommentMessage":return d("WAWebMsgType").MSG_TYPE.COMMENT;case"pinInChatMessage":return d("WAWebMsgType").MSG_TYPE.PIN_MESSAGE;case"pollCreationMessage":case"pollCreationMessageV2":case"pollCreationMessageV3":return d("WAWebMsgType").MSG_TYPE.POLL_CREATION;case"pollUpdateMessage":return d("WAWebMsgType").MSG_TYPE.POLL_UPDATE;case"keepInChatMessage":return d("WAWebMsgType").MSG_TYPE.KEEP_IN_CHAT;case"requestPhoneNumberMessage":return d("WAWebMsgType").MSG_TYPE.REQUEST_PHONE_NUMBER;case"ptvMessage":return d("WAWebMsgType").MSG_TYPE.PTV;case"callLogMesssage":return d("WAWebMsgType").MSG_TYPE.CALL_LOG;case"buttonsMessage":return h.Buttons;case"templateMessage":return h.Template;case"senderKeyDistributionMessage":case"fastRatchetKeySenderKeyDistributionMessage":return h.SenderKeyDistribution;case"newsletterAdminInviteMessage":return d("WAWebMsgType").MSG_TYPE.NEWSLETTER_ADMIN_INVITE;case"eventMessage":return d("WAWebMsgType").MSG_TYPE.EVENT_CREATION;case"encEventResponseMessage":return d("WAWebMsgType").MSG_TYPE.EVENT_RESPONSE;default:return h.UnknownMessageKey}}function j(a){if(a!=null&&typeof a==="object"&&"message"in a){a=a.message;if(a!=null&&typeof a==="object")return a}return null}function k(a){var b=[],c=Object.keys(a);for(var e=0;e<c.length;e++){var f=c[e],g=j(a[f]);if(g!=null){var h=k(g);h.length===0?b.push([d("WAWebMsgType").MSG_TYPE.UNKNOWN,f]):b.push.apply(b,k(g))}else{h=i(f,a);h!=null&&b.push([h,f])}}return b}function l(a){return Boolean(a.find(function(a){a=a[0];return typeof a==="number"&&a===h.SenderKeyDistribution}))}function a(a){if(!d("WAWebABProps").getABPropConfigValue("web_invalid_message_count_validation"))return;a=k(a);var b=a.length===1||a.length===2&&l(a);if(!b)throw new(d("WAWebHandleMsgError").MessageProtobufInvalidMessageTypes)(a.map(function(a){a[0];a=a[1];return a}))}g.UndeclaredMessageType=h;g.getProtobufMessageTypesToKeys=k;g.verifyProtobufMessageObjectKeys=a}),98);
__d("WAWebHandleMsgProcess",["Promise","WACryptoPkcs7","WALogger","WAWebABProps","WAWebAddonGatingUtils","WAWebAddonPluginProcessor","WAWebAddonProcessMsgsUtils","WAWebApiDeferredMessagesStorage","WAWebBackendApi","WAWebBackendJobs.flow","WAWebBizCoexGatingUtils","WAWebCastToReactionMsg","WAWebCmd","WAWebDBAddOnProviders","WAWebDBMsgUtils","WAWebGetGroupAddressingMode","WAWebGetMessageCache","WAWebHandleMsgError","WAWebHandleMsgProcessUtils","WAWebHandleMsgTypes.flow","WAWebHandleMsgValidate","WAWebHandlePushnameUpdate","WAWebLogMissingGroupParticipantMappings","WAWebLogReceivedMessages","WAWebMessageEditGatingUtils","WAWebMessageProcessor","WAWebMessageProcessorCache","WAWebMsgProcessingApiUtils","WAWebMsgType","WAWebParsedProtocolMsgType","WAWebPinMsgGatingUtils","WAWebPnhGatingUtils","WAWebProcessMatMessages","WAWebProtobufsE2E.pb","WAWebRuntimeEnvironmentUtils","WAWebSchemaGroupMetadata","WAWebSignal","WAWebUserPrefsMeUser","WAWebUserPrefsNotifications","WAWebVerifyProtobufMsgObjectKeys","WAWebWamEnumDsmError","WAWebWid","WAWebWorkerSafeBackendApi","asyncToGeneratorRuntime","decodeProtobuf"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Handle security notification payload wid error"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Handle security notification empty wid error"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Me wid is empty during security notification parsing"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Reparsed processDecryptedMessageProto: msgId::",", message decrypted:"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["parsed render able msgs not reparsed as expected"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Reparsing processDecryptedMessageProto: msgId::",", message decrypted:"]);n=function(){return a};return a}function a(a){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=a.decrypted,f=a.info,g=a.paymentInfo,o=a.e2eInfo,q=a.bizInfo,r=a.hsmInfo,s=a.isPadded;s=s===void 0?!0:s;var t=a.msgMeta,u=a.reparsing;u=u===void 0?!1:u;var v=a.msgBotInfo,w=a.reportingTokenInfo;s=o.e2eType===d("WAWebBackendJobs.flow").CiphertextType.Msmsg?!1:s;s=s?d("WACryptoPkcs7").unpadPkcs7(new Uint8Array(e)):new Uint8Array(e);e=d("decodeProtobuf").decodeProtobuf(d("WAWebProtobufsE2E.pb").MessageSpec,s);d("WAWebVerifyProtobufMsgObjectKeys").verifyProtobufMessageObjectKeys(e);var x=d("WAWebMsgProcessingApiUtils").getFrom(f),z=o.retryCount>0&&d("WAWebMsgProcessingApiUtils").placeholderCheck(f)||u;z=z?d("WAWebHandleMsgTypes.flow").MessageOverwriteOption.RETRY:d("WAWebHandleMsgTypes.flow").MessageOverwriteOption.NO_OVERWRITE;if(u){d("WALogger").LOG(n(),f.externalId).tags("messaging").devConsole(e);var A=(yield d("WAWebMsgProcessingApiUtils").parseMessage({info:f,ciphertextType:o.e2eType,msgProtobuf:e,paymentInfo:g,bizInfo:q,hsmInfo:r,hidePlaceholder:o.hideFail,processDecryptedProtoParams:a,msgBotInfo:v,reportingTokenInfo:w,meta:t}));if(A.renderableMsgs==null)d("WALogger").ERROR(m());else{A=A.renderableMsgs;var B=A[0],C=d("WAWebAddonGatingUtils").isUnifiedInfraEnabledForType(B.type)||Boolean(d("WAWebDBAddOnProviders").getAddOnProviderForMsg(B)),D=[d("WAWebMsgType").MSG_TYPE.DOCUMENT,d("WAWebMsgType").MSG_TYPE.POLL_CREATION,d("WAWebMsgType").MSG_TYPE.PTV,d("WAWebMsgType").MSG_TYPE.STICKER];if(!C&&!D.includes(B.type))return{hasInactiveMsg:!1};d("WAWebHandleMsgValidate").renderableMessagesValidation({renderableMsgs:A,msgMeta:t,info:f,proto:e,bizInfo:q,reportingTokenInfo:w});C=p({renderableMsgs:A,reparsing:u,bizInfo:q,msgMeta:t,paymentInfo:g,info:f,messageOverwriteOption:z});D=C.tasks;B=C.hasInactiveMsg;yield (h||(h=b("Promise"))).all(D);d("WALogger").LOG(l(),f.externalId).tags("messaging").devConsole(e);return{hasInactiveMsg:B}}}A=(yield d("WAWebHandleMsgProcessUtils").preProcessMsg(f,e));d("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()&&((A==null?void 0:A.senderOrRecipientAccountTypeHosted)===!0&&(f.senderOrRecipientAccountTypeHosted=!0),(A==null?void 0:A.hostedBizEncMismatch)===!0&&(f.hostedBizEncStateMismatch=!0));if(f.type===d("WAWebHandleMsgTypes.flow").MESSAGE_TYPE.PEER_BROADCAST&&o.retryCount>0){C=(yield d("WAWebDBMsgUtils").getMsgByMsgKey(d("WAWebMsgProcessingApiUtils").messageInfoToKey(f)));(C==null?void 0:C.broadcastParticipants)!=null&&(f.bclParticipants=C.broadcastParticipants,C.broadcastEphSettings!=null&&(f.bclEphSettings=C.broadcastEphSettings))}D=(yield d("WAWebMsgProcessingApiUtils").parseMessage({info:f,ciphertextType:o.e2eType,msgProtobuf:e,paymentInfo:g,bizInfo:q,hsmInfo:r,hidePlaceholder:o.hideFail,processDecryptedProtoParams:a,msgBotInfo:v,reportingTokenInfo:w,meta:t}));B=null;D.history?B=d("WAWebParsedProtocolMsgType").PARSED_PROTOCOL_MESSAGE_TYPE.HISTORY:D.appStateSyncKeyShare?B=d("WAWebParsedProtocolMsgType").PARSED_PROTOCOL_MESSAGE_TYPE.APP_STATE_SYNC_KEY_SHARE:D.appStateSyncKeyRequest?B=d("WAWebParsedProtocolMsgType").PARSED_PROTOCOL_MESSAGE_TYPE.APP_STATE_SYNC_KEY_REQUEST:D.peerDataOperationRequestResponseMessage?B=d("WAWebParsedProtocolMsgType").PARSED_PROTOCOL_MESSAGE_TYPE.PEER_DATA_OPERATION_REQUEST_RESPONSE_MESSAGE:D.peerDataOperationRequestMessage&&(B=d("WAWebParsedProtocolMsgType").PARSED_PROTOCOL_MESSAGE_TYPE.PEER_DATA_OPERATION_REQUEST_MESSAGE);if(d("WAWebRuntimeEnvironmentUtils").isWorker()&&B)yield c("WAWebApiDeferredMessagesStorage").updateDeferredMessages([{id:f.externalId,type:B,plaintext:s,info:f,paymentInfo:g,bizInfo:q}]);else if(D.history)d("WAWebWorkerSafeBackendApi").workerSafeSendAndReceive("handleHistorySyncNotification",{historySyncMetaData:D.history,from:x,externalId:f.externalId});else if(D.appStateSyncKeyShare)yield d("WAWebWorkerSafeBackendApi").workerSafeSendAndReceive("handleAppStateSyncKeyShare",{keyShare:D.appStateSyncKeyShare,from:x});else if(D.appStateSyncKeyRequest)d("WAWebWorkerSafeBackendApi").workerSafeSendAndReceive("handleAppStateSyncKeyRequest",{keyRequest:D.appStateSyncKeyRequest,from:x});else if(D.peerDataOperationRequestResponseMessage)d("WAWebWorkerSafeBackendApi").workerSafeSendAndReceive("handlePeerDataOperationRequestResponse",{stanzaId:f.externalId,response:D.peerDataOperationRequestResponseMessage});else if(D.peerDataOperationRequestMessage)d("WAWebWorkerSafeBackendApi").workerSafeSendAndReceive("handlePeerDataOperationRequest",{stanzaId:f.externalId,request:D.peerDataOperationRequestMessage});else if(D.securityNotificationEnabled)d("WAWebUserPrefsMeUser").getMe()==null?d("WALogger").ERROR(k()).sendLogs("Me wid is empty during security notification parsing"):x==null||!(x instanceof c("WAWebWid"))?d("WALogger").ERROR(j()).sendLogs("Handle security notification empty wid error"):!d("WAWebUserPrefsMeUser").isMePrimaryNonLid(x)?d("WALogger").ERROR(i()).sendLogs("Handle security notification payload wid error"):d("WAWebUserPrefsNotifications").setGlobalSecurityNotifications(D.securityNotificationEnabled.isEnabled);else{A=!1;D.deviceSent==null?A=!0:D.deviceSent.phash?A=(yield d("WAWebHandleMsgValidate").validateBclHash(D.deviceSent.phash,D.deviceSent.info)):D.deviceSent.destination&&(A=(yield d("WAWebHandleMsgValidate").validateMsgDestination(D.deviceSent.destination,f)));if(!A)throw new(d("WAWebHandleMsgError").DeviceSentMessageError)(d("WAWebMsgProcessingApiUtils").getDeviceType(f.author),d("WAWebWamEnumDsmError").DSM_ERROR.INVALID_DSM);C=D.renderableMsgs;d("WAWebHandleMsgValidate").renderableMessagesValidation({renderableMsgs:C,msgMeta:t,info:f,proto:e,bizInfo:q,reportingTokenInfo:w});r=p({renderableMsgs:C,reparsing:u,bizInfo:q,msgMeta:t,paymentInfo:g,info:f,messageOverwriteOption:z});o=r.tasks;a=r.hasInactiveMsg;D.storeMsg!=null&&d("WAWebMessageProcessorCache").messageProcessorCache.addMessages([{msg:D.storeMsg}],!1);D.senderKey!=null&&o.push(d("WAWebSignal").Session.createGroupSignalSession(f.author,D.senderKey.groupId,D.senderKey.key));f.pushname&&d("WAWebHandlePushnameUpdate").updatePushname(f.author,f.pushname,f.offline!=null);v=y(f.chat);yield (h||(h=b("Promise"))).all(o);B=(yield v);void d("WAWebLogMissingGroupParticipantMappings").logMissingGroupParticipantMappings(f.chat,f.author,f.addressingMode,B);d("WAWebLogReceivedMessages").logReceivedMessagesInWAM(D.renderableMsgs,f.offline!=null,f.ts*1e3,f.clientReceivedTsMillis,f.msgProcessStartTsMillis,f.addressingMode,B);return{hasInactiveMsg:a}}return{hasInactiveMsg:!1}});return o.apply(this,arguments)}function p(a){var b,c=a.renderableMsgs,e=a.reparsing,f=a.bizInfo,g=a.msgMeta,h=a.paymentInfo,i=a.info;a=a.messageOverwriteOption;var j=[],k=!1,l=c[0];d("WAWebAddonGatingUtils").isUnifiedInfraEnabledForType((b=c[0])==null?void 0:b.type)&&d("WAWebAddonProcessMsgsUtils").castToAddonMsgData(c[0])!=null?(k=!0,j.push(w(c[0],i,e,a))):c[0]!=null&&d("WAWebCastToReactionMsg").castToReactionEncMsgData(c[0])!=null?(k=!0,j.push(r(d("WAWebCastToReactionMsg").assertReactionEncMsgData(c[0]),i,e))):l!=null&&l.kind===d("WAWebMsgType").MsgKind.PollVoteEncrypted?j.push(u(l,i,e)):((b=c[0])==null?void 0:b.type)===d("WAWebMsgType").MSG_TYPE.KEEP_IN_CHAT?(k=!0,j.push(d("WAWebHandleMsgProcessUtils").processKeepInChatMsg(c[0],i,e))):d("WAWebMessageEditGatingUtils").receiveTextEditEnabled()&&((l=c[0])==null?void 0:l.type)===d("WAWebMsgType").MSG_TYPE.PROTOCOL&&((b=c[0])==null?void 0:b.subtype)==="message_edit"?j.push(d("WAWebHandleMsgProcessUtils").processEditProtocolMsg(c[0],i,e)):((l=c[0])==null?void 0:l.type)===d("WAWebMsgType").MSG_TYPE.PROTOCOL&&((b=c[0])==null?void 0:b.subtype)==="ephemeral_sync_response"?j.push(d("WAWebHandleMsgProcessUtils").processEphemeralSyncResponseMsg(c[0],i,e)):d("WAWebPinMsgGatingUtils").isPinnedMessagesM1ReceiverEnabled()&&((l=c[0])==null?void 0:l.type)===d("WAWebMsgType").MSG_TYPE.PIN_MESSAGE?(k=!0,j.push(d("WAWebHandleMsgProcessUtils").processPinMsg(c[0],i,e))):c[0]!=null&&d("WAWebCastToReactionMsg").castToReactionMsgData(c[0])!=null?(k=!0,j.push(t(d("WAWebCastToReactionMsg").assertReactionMsgData(c[0]),i,e))):c.length>0&&j.push(q(c,i,h,f,g,a,e));return{tasks:j,hasInactiveMsg:k}}function q(a,b,c,e,f,g,h){return d("WAWebMessageProcessor").processRenderableMessages(a,b,c,e,f,g,h)}function e(a){return d("WAWebMessageProcessor").processPlaceholderMessage(a)}function r(a,b,c){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){var e=(yield d("WAWebSchemaGroupMetadata").getGroupMetadataTable().get(b.chat.toString()));e=Boolean(e==null?void 0:e.incognito)&&Boolean(e==null?void 0:e.defaultSubgroup);if(e){e=(yield d("WAWebHandleMsgProcessUtils").convertEncReactionToReaction(a));if(e!=null)return t(e,b,c)}});return s.apply(this,arguments)}function t(a,b,c){return d("WAWebMessageProcessor").processReactionMessage(a,b,c)}function u(a,b,c){return v.apply(this,arguments)}function v(){v=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){b=b.offline!=null&&!c;a=d("WAWebPnhGatingUtils").isMatFullyEnabled()?yield d("WAWebProcessMatMessages").processPollUpdateMatMessages(a):a;a=d("WAWebGetMessageCache").getMessageCache().addMessages([{msg:a}],!b);(c||d("WAWebCmd").Cmd.isMainStreamReadyMd&&d("WAWebCmd").Cmd.isOfflineDeliveryEnd)&&(yield a)});return v.apply(this,arguments)}function w(a,b,c,d){return x.apply(this,arguments)}function x(){x=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){b=b.offline!=null&&!c;var f=d("WAWebAddonProcessMsgsUtils").castToAddonMsgData(a);if(d("WAWebPnhGatingUtils").isMatFullyEnabled()&&f!=null){var g=d("WAWebAddonPluginProcessor").getAddonProcessor(f.type);g=g.parentKey;f=(yield d("WAWebProcessMatMessages").processAddonMatMessages(f,g))}else f=a;g=d("WAWebGetMessageCache").getMessageCache().addMessages([{msg:f}],!b);(c||d("WAWebCmd").Cmd.isMainStreamReadyMd&&d("WAWebCmd").Cmd.isOfflineDeliveryEnd)&&(yield g);e===d("WAWebHandleMsgTypes.flow").MessageOverwriteOption.RETRY&&d("WAWebBackendApi").frontendFireAndForget("removePlaceholder",{msg:a})});return x.apply(this,arguments)}function y(a){if(!d("WAWebABProps").getABPropConfigValue("web_extra_lid_group_logging_attributes"))return;return d("WAWebGetGroupAddressingMode").getGroupAddressingMode(a)}g.processDecryptedMessageProto=a;g.processMsgs=p;g.processRenderableMsg=q;g.processPlaceholderMsg=e;g.processReactionMsg=t;g.processPollUpdateVoteMsg=u}),98);
__d("WAWebDeviceListPk",["err"],(function(a,b,c,d,e,f,g){function a(a){switch(a.server){case"lid":return a.user+"@lid";case"c.us":return a.user;case"hosted":return a.user}throw c("err")("Jid "+a.toString({legacy:!0})+' is not fully qualified to create a device list pk, jid.server should be "c.us" or "lid"')}g.createDeviceListPK=a}),98);
__d("WAWebPhashUtils",["WABase64","WACryptoSha256","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.map(function(a){return d("WAWebWidFactory").toUserWid(a).toString({legacy:!0})}).sort().join("");var b=[];for(var c=0;c<a.length;c++)b.push(a.charCodeAt(c));c=new Uint8Array(b);a=(yield self.crypto.subtle.digest({name:"SHA-1"},c));return"1:"+d("WABase64").encodeB64(a.slice(0,6))});return h.apply(this,arguments)}function c(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.map(function(a){return a.toString({legacy:!0,formatFull:!0})}).sort().join("");var b=[];for(var c=0;c<a.length;c++)b.push(a.charCodeAt(c));c=new Uint8Array(b);a=(yield d("WACryptoSha256").sha256(c));return"2:"+d("WABase64").encodeB64(a.slice(0,6))});return i.apply(this,arguments)}g.phashV1=a;g.phashV2=c}),98);
__d("WAWebApiDeviceList",["Promise","WAJids","WALruCache","WAWebDeviceListPk","WAWebPhashUtils","WAWebSchemaDeviceList","WAWebUserPrefsMeUser","WAWebWidFactory","asyncToGeneratorRuntime","err","lodash"],(function(a,b,c,d,e,f,g){var h,i=new(d("WALruCache").LruCache)({sizeLimit:5e3,getSize:function(){return 1}});function j(a){a=d("WAWebDeviceListPk").createDeviceListPK(a);if(!i.has(a)){var c=d("WAWebSchemaDeviceList").getDeviceListTable().get(a);i.put(a,c)}return(c=i.get(a))!=null?c:(h||(h=b("Promise"))).resolve(null)}function k(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=[];a.forEach(function(a){i.has(d("WAWebDeviceListPk").createDeviceListPK(a))||c.push(d("WAWebDeviceListPk").createDeviceListPK(a))});if(c.length>0){var e=(yield d("WAWebSchemaDeviceList").getDeviceListTable().bulkGet(c));e.forEach(function(a,d){i.put(c[d],(h||(h=b("Promise"))).resolve(a))})}return(h||(h=b("Promise"))).all(a.map(function(a){return i.get(d("WAWebDeviceListPk").createDeviceListPK(a))}))});return l.apply(this,arguments)}function a(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("WAWebSchemaDeviceList").getDeviceListTable().createOrReplace(a),i.put(a.id,(h||(h=b("Promise"))).resolve(a))});return m.apply(this,arguments)}function e(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("WAWebSchemaDeviceList").getDeviceListTable().bulkCreateOrReplace(a),a.forEach(function(a){i.put(a.id,(h||(h=b("Promise"))).resolve(a))})});return n.apply(this,arguments)}function o(a){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield k(a));return a.map(function(a){if(a&&!a.deleted){var b=a.devices.map(function(a){return{id:a.id,isHosted:a.isHosted}});return{id:a.id,devices:b}}return null})});return p.apply(this,arguments)}function f(a,b){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(b===d("WAJids").DEFAULT_DEVICE_ID)return!0;a=(yield o([a]));a=a[0];if(!a)return!1;return!a.devices.some(function(a){return a.id===b})?!1:!0});return q.apply(this,arguments)}function r(a){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield k(a));return a.map(function(a){if(a&&!a.deleted){var b=a.devices.map(function(a){return{id:a.id,isHosted:a.isHosted}});return{id:a.id,devices:b,timestamp:a.timestamp,expectedTs:a.expectedTs}}return null})});return s.apply(this,arguments)}function t(a,b){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(b==null)return!0;a=(yield o([a]));a=a.map(function(a){return a==null?[]:a.devices.map(function(b){return d("WAWebWidFactory").createDeviceWidFromDeviceListPk(a.id,b.id,b.isHosted)})});a=c("lodash").flatMap(a,function(a){return a});a=(yield d("WAWebPhashUtils").phashV2(a));return a!==b});return u.apply(this,arguments)}function v(){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=d("WAWebUserPrefsMeUser").assertGetMe();a=(yield j(a));if(!a||a.deleted)throw c("err")("syncd: cannot find my device list");return a});return w.apply(this,arguments)}function x(){return d("WAWebSchemaDeviceList").getDeviceListTable().all()}g.getDeviceRecord=j;g.bulkGetDeviceRecord=k;g.createOrReplaceDeviceRecord=a;g.bulkCreateOrReplaceDeviceRecord=e;g.getDeviceIds=o;g.hasDevice=f;g.getDeviceInfoForSync=r;g.doesDeviceHashMatch=t;g.getMyDeviceList=v;g.getAllDeviceLists=x}),98);
__d("WAWebHandleMsgMetaUtils",["WAWebHandleMsgCommon"],(function(a,b,c,d,e,f,g){a=function(a){return(a==null?void 0:a.type)===d("WAWebHandleMsgCommon").STANZA_MSG_TYPES.reaction};b=function(a){return(a==null?void 0:a.type)===d("WAWebHandleMsgCommon").STANZA_MSG_TYPES.poll&&(a==null?void 0:a.pollType)===d("WAWebHandleMsgCommon").POLL_TYPES.vote};c=function(a){return(a==null?void 0:a.type)===d("WAWebHandleMsgCommon").STANZA_MSG_TYPES.text&&(a==null?void 0:a.threadMsgId)!=null&&(a==null?void 0:a.threadMsgSenderJid)!=null};e=function(a){return(a==null?void 0:a.type)===d("WAWebHandleMsgCommon").STANZA_MSG_TYPES.event&&(a==null?void 0:a.eventType)===d("WAWebHandleMsgCommon").EVENT_TYPES.response};f=function(a){return(a==null?void 0:a.type)===d("WAWebHandleMsgCommon").STANZA_MSG_TYPES.event&&(a==null?void 0:a.eventType)===d("WAWebHandleMsgCommon").EVENT_TYPES.edit};g.isReactionMsgMeta=a;g.isPollVoteMsgMeta=b;g.isCommentMsgMeta=c;g.isEventResponseMsgMeta=e;g.isEventEditMsgMeta=f}),98);
__d("WAWebHandleMsgValidate",["WAJids","WALogger","WAWebAck","WAWebApiDeviceList","WAWebE2EProtoUtils","WAWebHandleMsgError","WAWebHandleMsgMetaUtils","WAWebMessagingGatingUtils","WAWebMsgType","WAWebPhashUtils","WAWebReportingTokenUtils","WAWebUserPrefsMeUser","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["expected: ",", got: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["no record found for sender: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["sender: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["encDestination: ",", destination: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Type in stanza [","] is different from the one derived from protobuf [","]. Message type: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["no biz node found in HSM"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["button message is invalid"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["no biz node found in list message"]);o=function(){return a};return a}function a(a,b){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=b.chat;if(!a.equals(c)){d("WALogger").ERROR(k(),String(a),c.toString()).sendLogs("validateMsgDestination: drop due to the deviceSentMessage meta mismatch.");return!1}a=b.author;if(!d("WAWebUserPrefsMeUser").isMeAccount(a)){d("WALogger").ERROR(j(),a.toString()).sendLogs("validateMsgDestination: drop due to msg is not sent from your own device.");return!1}b=(yield d("WAWebApiDeviceList").hasDevice(a,(c=a.device)!=null?c:0));b||d("WALogger").ERROR(i(),a.toString()).sendLogs("validateMsgDestination:drop due to invalid device");return b});return p.apply(this,arguments)}function c(a,b){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c;c=(c=b.bclParticipants)!=null?c:[];c=(yield d("WAWebPhashUtils").phashV2(c));if(c!==a){d("WALogger").ERROR(h(),a,c).sendLogs("validateBclHash: drop due to invalid hash.");return!1}b.bclHashValidated=!0;return!0});return q.apply(this,arguments)}function e(a){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.device==null?d("WAJids").DEFAULT_DEVICE_ID:a.device;if(b===d("WAJids").DEFAULT_DEVICE_ID)return!0;a=(yield d("WAWebApiDeviceList").getDeviceIds([a]));a=a[0];return a!=null&&a.devices.some(function(a){return a.id===b})});return r.apply(this,arguments)}function s(a,b){var c=a.listMessage,e=a.buttonsMessage;a=a.highlyStructuredMessage;if(c&&(b==null?void 0:b.verifiedListEnvelope)!==!0){d("WALogger").ERROR(o()).sendLogs("validateBizNode:drop due to missing biz node in invalid SMAX in list message");return!1}if(e){e=(b==null?void 0:b.verifiedButtonsEnvelope)===!0||(b==null?void 0:b.nativeFlowName)!=null||((c=e.contextInfo)==null?void 0:c.isForwarded)===!0&&(e==null?void 0:(c=e.buttons)==null?void 0:c.length)===0;e||d("WALogger").ERROR(n()).sendLogs("validateBizNode:drop due to invalid SMAX for buttons message");return e}if(a&&(b==null?void 0:b.verifiedHsmEnvelope)!==!0){d("WALogger").ERROR(m()).sendLogs("validateBizNode:drop due to missing biz node in invalid SMAX in HSM");return!1}return!0}function f(a){var b=a.renderableMsgs,c=a.msgMeta,e=a.info,f=a.proto,g=a.bizInfo;a=a.reportingTokenInfo;if(b.length>0&&!s(f,g))throw new(d("WAWebHandleMsgError").BizNodeValidationError)("[messaging] Biz node validation failed due to absence of biz node in SMAX");g=b[0];if(d("WAWebHandleMsgMetaUtils").isReactionMsgMeta(c)&&g!=null&&(g.type!==d("WAWebMsgType").MSG_TYPE.REACTION&&g.type!==d("WAWebMsgType").MSG_TYPE.REACTION_ENC))throw new(d("WAWebHandleMsgError").MessageProtobufMismatchError)(d("WAWebHandleMsgError").MessageProtobufMismatchErrorCode.INVALID_REACTION_STANZA);if(d("WAWebHandleMsgMetaUtils").isPollVoteMsgMeta(c)&&g!=null){b=g.type===d("WAWebMsgType").MSG_TYPE.UNKNOWN&&g.futureproofType===d("WAWebMsgType").MSG_TYPE.POLL_UPDATE;var h=g.type===d("WAWebMsgType").MSG_TYPE.POLL_UPDATE&&g.subtype==="poll_vote";if(!b&&!h)throw new(d("WAWebHandleMsgError").MessageProtobufMismatchError)(d("WAWebHandleMsgError").MessageProtobufMismatchErrorCode.INVALID_POLL_UPDATE_STANZA)}if(g!=null&&d("WAWebHandleMsgMetaUtils").isCommentMsgMeta(c)){b=g.type===d("WAWebMsgType").MSG_TYPE.UNKNOWN&&g.futureproofType===d("WAWebMsgType").MSG_TYPE.COMMENT;h=new Set([d("WAWebMsgType").MsgKind.CommentEncrypted,d("WAWebMsgType").MsgKind.CommentDecrypted,d("WAWebMsgType").MsgKind.RevokedAddon,d("WAWebMsgType").MsgKind.ProtocolRevoke]);if(!b&&!h.has(g.kind))throw new(d("WAWebHandleMsgError").MessageProtobufMismatchError)(d("WAWebHandleMsgError").MessageProtobufMismatchErrorCode.INVALID_COMMENT_STANZA)}if(e.edit===d("WAWebAck").EDIT_ATTR.PIN_IN_CHAT&&g!=null){b=g.type===d("WAWebMsgType").MSG_TYPE.UNKNOWN&&g.futureproofType===d("WAWebMsgType").MSG_TYPE.PIN_MESSAGE;if(g.type!==d("WAWebMsgType").MSG_TYPE.PIN_MESSAGE&&!b)throw new(d("WAWebHandleMsgError").MessageProtobufMismatchError)(d("WAWebHandleMsgError").MessageProtobufMismatchErrorCode.INVALID_PIN_IN_CHAT_STANZA)}if(d("WAWebHandleMsgMetaUtils").isEventResponseMsgMeta(c)&&g!=null){h=g.type===d("WAWebMsgType").MSG_TYPE.UNKNOWN&&g.futureproofType===d("WAWebMsgType").MSG_TYPE.EVENT_RESPONSE;e=g.type===d("WAWebMsgType").MSG_TYPE.EVENT_RESPONSE;if(!h&&!e)throw new(d("WAWebHandleMsgError").MessageProtobufMismatchError)(d("WAWebHandleMsgError").MessageProtobufMismatchErrorCode.INVALID_EVENT_RESPONSE_STANZA)}if(d("WAWebHandleMsgMetaUtils").isEventEditMsgMeta(c)&&g!=null){b=g.type===d("WAWebMsgType").MSG_TYPE.UNKNOWN&&g.futureproofType===d("WAWebMsgType").MSG_TYPE.EVENT_EDIT_ENCRYPTED;h=g.type===d("WAWebMsgType").MSG_TYPE.EVENT_EDIT_ENCRYPTED;if(!b&&!h)throw new(d("WAWebHandleMsgError").MessageProtobufMismatchError)(d("WAWebHandleMsgError").MessageProtobufMismatchErrorCode.INVALID_EVENT_EDIT_STANZA)}e=d("WAWebE2EProtoUtils").typeAttributeFromProtobuf(f);g!=null&&(c==null?void 0:c.type)!==e&&d("WAWebMessagingGatingUtils").isMsgTypeValidationEnabled()&&d("WALogger").ERROR(l(),c==null?void 0:c.type,e,g.type).tags("messaging","wa-ice","report-token","non-sad").sendLogs("report-token-stanza-protobuf-type-mismatched",.001).devConsole({msgMeta:c,proto:f});g!=null&&void d("WAWebReportingTokenUtils").validateReportingTokenInfo(g,a)}g.validateMsgDestination=a;g.validateBclHash=c;g.isFromKnownDevice=e;g.validateBizNode=s;g.renderableMessagesValidation=f}),98);
__d("WAPromiseLoop",["regeneratorRuntime"],(function(a,b,c,d,e,f){"use strict";function a(a,c){var d,e,f,g,h;return b("regeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:d=!1,f=function(a){d=!0,e=a},g=0,h=c;case 4:if(d){i.next=11;break}i.next=7;return b("regeneratorRuntime").awrap(a(f,h,g));case 7:h=i.sent;g++;i.next=4;break;case 11:return i.abrupt("return",e);case 12:case"end":return i.stop()}},null,this)}f.promiseLoop=a}),66);
__d("WAWebApiGroupInviteV4Store",["WATimeUtils","WAWebSchemaGroupInviteV4","WAWebUserPrefsMeUser","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,b){return d("WAWebSchemaGroupInviteV4").getGroupInviteV4Table().createOrMerge(a,b)}function c(a){return d("WAWebSchemaGroupInviteV4").getGroupInviteV4Table().bulkCreateOrMerge(a)}function e(a,b,c,d){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){a=(yield d("WAWebSchemaGroupInviteV4").getGroupInviteV4Table().equals(["from","to","groupId"],[a,b,c]).then(function(a){return a.filter(function(a){return!a.expired&&a.expiration<=e})}));d("WAWebSchemaGroupInviteV4").getGroupInviteV4Table().bulkCreateOrReplace(a.map(function(a){return babelHelpers["extends"]({},a,{expired:!0})}));return a});return h.apply(this,arguments)}function f(a){var b;b=(b=d("WAWebUserPrefsMeUser").getMaybeMeUser())==null?void 0:b.toString();return d("WAWebSchemaGroupInviteV4").getGroupInviteV4Table().equals(["from","groupId"],[b,a.toString()]).then(function(a){return a.filter(function(a){return!a.expired&&d("WATimeUtils").unixTime()<=a.expiration})}).then(function(a){return a.map(function(a){return a.to})})}g.persistGroupInviteV4Msg=a;g.persistGroupInviteV4Msgs=c;g.revokeGroupInvites=e;g.getPendingParticipants=f}),98);
__d("WAWebHandlePlaceholderMsgKeyHashUtils",["WABase64","WACryptoHmac","WAWebABProps","WAWebUserPrefsMultiDevice","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h=null,i=new TextEncoder(),j=function(a){return i.encode(a).buffer};function k(){h||(h=d("WAWebUserPrefsMultiDevice").getChatThreadLoggingSecretB64().then(function(a){return a==null?null:d("WABase64").decodeB64(a)}));return h}function a(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b,c=(yield k());if(!c)return null;b=j(String(a.id.id+(a.id.fromMe?"1":"0")+((b=(b=a.id.remote)==null?void 0:b.toString({legacy:!0}))!=null?b:"")+((a=(b=a.id.participant)==null?void 0:b.toString({legacy:!0}))!=null?a:"")));a=(yield d("WACryptoHmac").hmacSha256(c,b));return d("WABase64").encodeB64(a)});return l.apply(this,arguments)}function c(){return d("WAWebABProps").getABPropConfigValue("placeholder_message_key_hash_logging")}g.getMessageKeyHash=a;g.messageKeyHashEnabled=c}),98);
__d("WAWebWamEnumPlaceholderAction",[],(function(a,b,c,d,e,f){a=Object.freeze({OTHER:0,ADD:1,VIEW:2,POPULATE:3});f.PLACEHOLDER_ACTION=a}),66);
__d("WAWebWamEnumPlaceholderChatType",[],(function(a,b,c,d,e,f){a=Object.freeze({OTHER:0,INDIVIDUAL:1,GROUP:2,STATUS:3,BROADCAST:4,CHANNEL:5,INTEROP:6});f.PLACEHOLDER_CHAT_TYPE=a}),66);
__d("WAWebWamEnumPlaceholderPopulationType",[],(function(a,b,c,d,e,f){a=Object.freeze({OTHER:0,RETRY:1,PEER_MESSAGE:2,RESEND:3});f.PLACEHOLDER_POPULATION_TYPE=a}),66);
__d("WAWebWamEnumPlaceholderReasonType",[],(function(a,b,c,d,e,f){a=Object.freeze({OTHER:0,SIGNAL_NO_SESSION:1,DEVICE_VERIFICATION_FAILURE:2,UNKNOWN_SELF_DEVICE:3,SIGNAL_INVALID_KEY:4,SIGNAL_INVALID_KEY_ID:5,SIGNAL_INVALID_MESSAGE:6,DEVICE_VERIFICATION_FAILURE_SELF_PEER:7,UNKNOWN_COMPANION_NO_PREKEY:8,BAD_EPHEMERAL_SETTING:9,SIGNAL_FUTURE_MESSAGE:10,SIGNAL_INVALID_SIGNATURE:11,SIGNAL_BAD_MAC:12,SIGNAL_INVALID_SESSION:13});f.PLACEHOLDER_REASON_TYPE=a}),66);
__d("WAWebWamEnumPlaceholderType",[],(function(a,b,c,d,e,f){a=Object.freeze({OTHER:0,CIPHERTEXT:1,FANOUT:2,DOWNGRADE:3});f.PLACEHOLDER_TYPE=a}),66);
__d("WAWebPlaceholderActivityWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumE2eSenderType","WAWebWamEnumMediaType","WAWebWamEnumMessageType","WAWebWamEnumPlaceholderAction","WAWebWamEnumPlaceholderChatType","WAWebWamEnumPlaceholderPopulationType","WAWebWamEnumPlaceholderReasonType","WAWebWamEnumPlaceholderType","WAWebWamEnumSizeBucket","WAWebWamEnumTypeOfGroupEnum"],(function(a,b,c,d,e,f,g){b=(a=d("WAWebWamCodegenUtils")).defineEvents({PlaceholderActivity:[1980,{deviceCount:[9,a.TYPES.INTEGER],deviceSizeBucket:[8,d("WAWebWamEnumSizeBucket").SIZE_BUCKET],e2eSenderType:[16,d("WAWebWamEnumE2eSenderType").E2E_SENDER_TYPE],isHostedChat:[19,a.TYPES.BOOLEAN],isLid:[12,a.TYPES.BOOLEAN],messageBeforeReg:[15,a.TYPES.BOOLEAN],messageIsRevoke:[7,a.TYPES.BOOLEAN],messageKeyHash:[14,a.TYPES.STRING],messageMediaType:[6,d("WAWebWamEnumMediaType").MEDIA_TYPE],messageType:[5,d("WAWebWamEnumMessageType").MESSAGE_TYPE],participantCount:[10,a.TYPES.INTEGER],placeholderActionInd:[2,d("WAWebWamEnumPlaceholderAction").PLACEHOLDER_ACTION],placeholderAddReason:[11,d("WAWebWamEnumPlaceholderReasonType").PLACEHOLDER_REASON_TYPE],placeholderChatTypeInd:[3,d("WAWebWamEnumPlaceholderChatType").PLACEHOLDER_CHAT_TYPE],placeholderPopulationType:[17,d("WAWebWamEnumPlaceholderPopulationType").PLACEHOLDER_POPULATION_TYPE],placeholderTimePeriod:[4,a.TYPES.INTEGER],placeholderTypeInd:[1,d("WAWebWamEnumPlaceholderType").PLACEHOLDER_TYPE],typeOfGroup:[13,d("WAWebWamEnumTypeOfGroupEnum").TYPE_OF_GROUP_ENUM]},[1,1,1],"regular"]});g.PlaceholderActivityWamEvent=b}),98);
__d("WAWebHandlePlaceholderWam",["Promise","WATimeUtils","WAWebDBGroupsGroupMetadata","WAWebDBMessageSerialization","WAWebGroupType","WAWebHandlePlaceholderMsgKeyHashUtils","WAWebMsgGetters","WAWebPlaceholderActivityWamEvent","WAWebWamEnumPlaceholderAction","WAWebWamEnumPlaceholderChatType","WAWebWamEnumPlaceholderType","WAWebWamGroupMetadataMetricUtils","WAWebWamGroupMetricCache","WAWebWamMsgUtils","WAWebWid","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield n(a));a.forEach(function(a){a.placeholderActionInd=d("WAWebWamEnumPlaceholderAction").PLACEHOLDER_ACTION.ADD,a.commit()})});return i.apply(this,arguments)}function e(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.map(function(a){return d("WAWebDBMessageSerialization").messageFromDbRow(a)});a=(yield n(a));a.forEach(function(a){a.placeholderActionInd=d("WAWebWamEnumPlaceholderAction").PLACEHOLDER_ACTION.VIEW,a.commit()})});return j.apply(this,arguments)}function f(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield n(a,!0));a.forEach(function(a){a.placeholderActionInd=d("WAWebWamEnumPlaceholderAction").PLACEHOLDER_ACTION.POPULATE,a.commit()})});return k.apply(this,arguments)}function l(a,b,c){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){var f,g=a.id.remote;f=new(d("WAWebPlaceholderActivityWamEvent").PlaceholderActivityWamEvent)({placeholderChatTypeInd:t(g),placeholderTimePeriod:Math.max(d("WATimeUtils").unixTime()-((f=a.t)!=null?f:0),0),placeholderTypeInd:a.subtype==="fanout"?d("WAWebWamEnumPlaceholderType").PLACEHOLDER_TYPE.FANOUT:d("WAWebWamEnumPlaceholderType").PLACEHOLDER_TYPE.CIPHERTEXT,messageIsRevoke:d("WAWebMsgGetters").getIsRevoke(a),messageMediaType:d("WAWebWamMsgUtils").getWamMediaType(a),messageType:d("WAWebWamMsgUtils").getWamMessageType(a)});a.placeholderAddReason!=null&&(f.placeholderAddReason=a.placeholderAddReason);e&&a.placeholderPopulationType!=null&&(f.placeholderPopulationType=a.placeholderPopulationType);a.e2eSenderType!=null&&(f.e2eSenderType=a.e2eSenderType);c("WAWebWid").isGroup(g)?yield p(f,a,b):c("WAWebWid").isUser(g)&&(f.isLid=g.isLid());yield r(f,a);return f});return m.apply(this,arguments)}function n(a,b){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){c===void 0&&(c=!1);var e=[],f=[];for(a of a)d("WAWebMsgGetters").getIsGroupMsg(a)?f.push(a):e.push(a);a=(yield d("WAWebDBGroupsGroupMetadata").bulkGetGroupMetadata(f.map(function(a){return a.id.remote}))).map(function(a,b){return[f[b],a]});return(h||(h=b("Promise"))).all([].concat(e.map(function(a){return l(a,null,c)}),a.map(function(a){var b=a[0];a=a[1];return l(b,a,c)})))});return o.apply(this,arguments)}function p(a,b,c){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){var e=(yield d("WAWebWamGroupMetricCache").getGroupMetrics(b.id.remote));e!=null&&(e.participantCount!=null&&(a.participantCount=e.participantCount),e.deviceCount!=null&&(a.deviceCount=e.deviceCount),e.deviceSizeBucket!=null&&(a.deviceSizeBucket=e.deviceSizeBucket));if(c){e=d("WAWebWamGroupMetadataMetricUtils").isCagIncognitoFromGroupMetadata(c);a.isLid=e&&d("WAWebMsgGetters").getIsReaction(b);a.typeOfGroup=d("WAWebGroupType").groupTypeToWamEnum(d("WAWebGroupType").getGroupTypeFromGroupMetadata(c))}});return q.apply(this,arguments)}function r(a,b){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(d("WAWebHandlePlaceholderMsgKeyHashUtils").messageKeyHashEnabled()){b=(yield d("WAWebHandlePlaceholderMsgKeyHashUtils").getMessageKeyHash(b));b!=null&&(a.messageKeyHash=b)}});return s.apply(this,arguments)}function t(a){if(c("WAWebWid").isGroup(a))return d("WAWebWamEnumPlaceholderChatType").PLACEHOLDER_CHAT_TYPE.GROUP;else if(c("WAWebWid").isStatusV3(a))return d("WAWebWamEnumPlaceholderChatType").PLACEHOLDER_CHAT_TYPE.STATUS;else if(c("WAWebWid").isBroadcast(a))return d("WAWebWamEnumPlaceholderChatType").PLACEHOLDER_CHAT_TYPE.BROADCAST;else if(c("WAWebWid").isUser(a))return d("WAWebWamEnumPlaceholderChatType").PLACEHOLDER_CHAT_TYPE.INDIVIDUAL;else if(c("WAWebWid").isNewsletter(a))return d("WAWebWamEnumPlaceholderChatType").PLACEHOLDER_CHAT_TYPE.CHANNEL;return d("WAWebWamEnumPlaceholderChatType").PLACEHOLDER_CHAT_TYPE.OTHER}g.addPlaceholderWam=a;g.viewPlaceholderWam=e;g.populatePlaceholderWam=f}),98);
__d("WAWebDBProcessMessage",["Promise","WALogger","WATimeUtils","WAWeb-dexie","WAWebApiGroupInviteV4Store","WAWebCommonMsgUtils","WAWebDBMessageSerialization","WAWebDBStoreMessage","WAWebDbEncryptionKey","WAWebFtsLightClient","WAWebHandlePlaceholderWam","WAWebLinkify","WAWebModelStorageUtils","WAWebSchemaMessage","WAWebSyncGatingUtils","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["additional information ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error storing messages"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["storeMessages: store ",", for chat ",", isHistorySync: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["updateMessage: msgId::",", Previous row in message table is not a placeholder or futureproof"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["additional information ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error storing messages"]);n=function(){return a};return a}var o=function(b){babelHelpers.inheritsLoose(a,b);function a(){var a,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(a=c=b.call.apply(b,[this].concat(e))||this,c.name="DuplicateMessageError",a)||babelHelpers.assertThisInitialized(c)}return a}(babelHelpers.wrapNativeSuper(Error)),p=function(b){babelHelpers.inheritsLoose(a,b);function a(){var a,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(a=c=b.call.apply(b,[this].concat(e))||this,c.name="PreviousMsgNotUpdatableError",a)||babelHelpers.assertThisInitialized(c)}return a}(babelHelpers.wrapNativeSuper(Error));function a(a,b,c){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){f===void 0&&(f=!1);d("WALogger").DEV(k(),a.length,e,f);d("WAWebCommonMsgUtils").logUndefinedMessage(a);yield d("WAWebDbEncryptionKey").DbEncKeyStore.waitForFinalDbMsgEncKey();return(h||(h=b("Promise"))).resolve(d("WAWebDBStoreMessage").storeMessageInTransaction(a,e,f)).then(function(){d("WAWebFtsLightClient").ftsLightClient.index()["catch"](function(){})})["catch"](function(b){if(b instanceof c("WAWeb-dexie").BulkError||b instanceof c("WAWeb-dexie").ConstraintError)throw new o();else{d("WALogger").WARN(j()).devConsole(b);d("WALogger").DEV(i(),a.map(function(a){return a.id.toString()})).devConsole(b);throw b}})});return q.apply(this,arguments)}function e(a,c){var e,f=c==null?(e=a[0])==null?void 0:e.id.remote:c;if(f){e=a.map(function(a){var b=d("WAWebDBMessageSerialization").dbRowFromMessage(a);return d("WAWebDBStoreMessage").addMsgMetadataToMsgRow({msg:b,chatId:f.toString(),hasLink:d("WAWebLinkify").hasHttpLink(a)})});return(h||(h=b("Promise"))).resolve(d("WAWebSchemaMessage").getMessageTable().bulkCreateOrMerge(e)).then(function(){d("WAWebFtsLightClient").ftsLightClient.index()["catch"](function(){})})["catch"](function(b){d("WALogger").WARN(n()).devConsole(b);d("WALogger").DEV(m(),a.map(function(a){return a.id.toString()})).devConsole(b);throw b})}return(h||(h=b("Promise"))).resolve()}function f(a){return d("WAWebCommonMsgUtils").isPlaceholderMsg(a.type)?(h||(h=b("Promise"))).resolve(a):d("WAWebModelStorageUtils").getStorage().lock(["message"],function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){b=b[0];var e=(yield b.get(a.id.toString()));if(!e)throw c("err")("[messaging] updateMessage: msgId::"+a.id.toString()+", Failed to find previous message row in message table");if(!d("WAWebCommonMsgUtils").isPlaceholderMsg(e.type)&&!d("WAWebCommonMsgUtils").isFutureproofMsg(e.type)){d("WALogger").LOG(l(),a.id.toString()).tags("messaging");throw new p()}var f=a.from,g=babelHelpers["extends"]({},a);e.t!=null&&(g.t=e.t);e.ack>a.ack&&(g.ack=e.ack);f=d("WAWebDBStoreMessage").addMsgMetadataToMsgRow({msg:d("WAWebDBMessageSerialization").dbRowFromMessage(g),chatId:f.toString(),hasLink:d("WAWebLinkify").hasHttpLink(g),rowId:void 0,inChatMsgId:void 0,pendingReadReceipt:e.pendingReadReceipt});f.rowId=e.rowId;f.internalId=e.internalId;if(f.rowId==null||f.internalId==null)throw c("err")("[messaging] updateMessage: msgId::"+a.id.toString()+", missing rowId or internalId");yield b.createOrReplace(f);d("WAWebCommonMsgUtils").isPlaceholderMsg(e.type)&&void d("WAWebHandlePlaceholderWam").populatePlaceholderWam([d("WAWebDBMessageSerialization").messageFromDbRow(e)]);d("WAWebFtsLightClient").ftsLightClient.index()["catch"](function(){});return g});return function(a){return e.apply(this,arguments)}}())}function r(a){return d("WAWebSchemaMessage").getMessageTable().bulkGet(a).then(function(a){a=a.filter(Boolean).map(function(a){return{id:a.id,isStarred:d("WAWebSyncGatingUtils").shouldPopulateStarMessageWithTimestamp()?a.t:a.rowId}});return d("WAWebSchemaMessage").getMessageTable().bulkCreateOrMerge(a)})}function s(a){return d("WAWebSchemaMessage").getMessageTable().bulkCreateOrMerge(a.map(function(a){return{id:a,isStarred:void 0}}))}function t(a){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield (h||(h=b("Promise"))).all(a.map(function(a){return d("WAWebApiGroupInviteV4Store").persistGroupInviteV4Msg(a.id.toString(),{id:a.id.toString(),from:a.from.toString(),to:a.to.toString(),groupId:a.inviteGrp,expiration:parseInt(a.inviteCodeExp,10),expired:d("WATimeUtils").unixTime()>=parseInt(a.inviteCodeExp,10)})}));return h.resolve()});return u.apply(this,arguments)}g.DuplicateMessageError=o;g.PreviousMsgNotUpdatableError=p;g.storeMessages=a;g.updateExistingMessages=e;g.updateMessage=f;g.starMessages=r;g.unstarMessages=s;g.processGroupInviteMessages=t}),98);
__d("WAWebHandleForMessageRangeEnums",["$InternalEnum"],(function(a,b,c,d,e,f){a=b("$InternalEnum").Mirrored(["DropMessage","SkipUI"]);c=b("$InternalEnum").Mirrored(["DOES_NOT_CONTAIN","CONTAINS_BY_TIMESTAMP","CONTAINS_BY_ADDITIONAL"]);f.ActiveRangeHandlerAction=a;f.RangeContain=c}),66);
__d("WAWebPersistedJobDefinitions",["WATimeUtils","WAWebBackendErrors","WAWebBizGatingUtils"],(function(a,b,c,d,e,f,g){a={rotateKey:function(){return{type:"rotateKey",args:{},uniqKey:"rotateKey"}},setAbout:function(a){return{type:"setAbout",args:{content:a},uniqKey:"setAbout"}},queryProductList:function(a,b,c,e,f){c===void 0&&(c=null);if(d("WAWebBizGatingUtils").commerceFeaturesDisabledBySanctions())throw new(d("WAWebBackendErrors").E451)();return{type:"queryProductList",args:{catalogWid:a.toString(),productIds:b,width:e,height:f,directConnectionEncryptedInfo:c},uniqKey:"queryProductList:"+b.slice().sort().join(",")+":"+e+":"+f}},getPublicKey:function(a){return{type:"getPublicKey",args:{businessJid:a.toString()},uniqKey:"getPublicKey:"+a.toString()}},getSignedUserInfo:function(a){return{type:"getSignedUserInfo",args:{businessJid:a.toString()},uniqKey:"getSignedUserInfo:"+a.toString()}},verifyPostcode:function(a,b){return{type:"verifyPostcode",args:{businessJid:a.toString(),directConnectionEncryptedInfo:b},uniqKey:"verifyPostcode:"+a.toString()+":"+b}},deleteReactions:function(a,b){return{type:"deleteReactions",args:{chatId:a,parentMsgKeys:b},uniqKey:"deleteReactions:"+a}},deleteReactionsV2:function(a,b){return{type:"deleteReactionsV2",args:{chatId:a,parentMsgKeys:b}}},deleteAddOns:function(a,b){return{type:"deleteAddOns",args:{chatId:a,parentMsgKeys:b}}},sendRequestedKeyShare:function(a,b,c){return{type:"sendRequestedKeyShare",args:{keys:a,orphanKeys:b,peerDeviceId:c.toString()}}},dismissQuickPromotion:function(a){var b=d("WATimeUtils").unixTime();return{type:"dismissQuickPromotion",args:{id:a,ts:b},uniqKey:"dismissQuickPromotion-"+a+"-"+b}},primaryActionClickInQuickPromotion:function(a){var b=d("WATimeUtils").unixTime();return{type:"primaryActionClickInQuickPromotion",args:{id:a,ts:b},uniqKey:"primaryActionClickInQuickPromotion-"+a+"-"+b}},impressionOnQuickPromotion:function(a){var b=d("WATimeUtils").unixTime();return{type:"impressionOnQuickPromotion",args:{id:a,ts:b},uniqKey:"impressionOnQuickPromotion-"+a+"-"+b}},userExposureToQuickPromotion:function(a,b,c){var e=d("WATimeUtils").unixTime();return{type:"userExposureToQuickPromotion",args:{id:a,ts:e,experimentKey:b,exposureHoldout:c},uniqKey:"userExposureToQuickPromotion-"+a+"-"+e}},setTextStatus:function(a,b,c,d){return{type:"setTextStatus",args:{id:a,text:b,emoji:c,ephemeralDurationSeconds:d},uniqKey:"setTextStatus"}},queryAndUpdateGroupsMetadataByJids:function(a){return{type:"queryAndUpdateGroupsMetadataByJids",args:a,uniqKey:"handleGroupsDirtyNotification"}}};g.jobSerializers=a}),98);
__d("WAWebHandleSingleMsg",["Promise","WABackoffUtils","WALogger","WAPromiseDelays","WAPromiseLoop","WASyncdOrphan","WATimeUtils","WAWebApiGroupInviteV4Store","WAWebApiOrphanRevoke","WAWebBackendApi","WAWebBackendErrors","WAWebCheckUpdateOrphanReactions","WAWebDBProcessMessage","WAWebDBStoreRevokeMsgs","WAWebHandleForMessageRange","WAWebHandleForMessageRangeEnums","WAWebHandleMsgTypes.flow","WAWebHandlePlaceholderWam","WAWebMsgType","WAWebPersistedJobDefinitions","WAWebPersistedJobManager","WAWebWid","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Msg: "," chat: "," Error: ",", message: ",", stack: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Msg: "," chat: "," Error: ",", message: ",", stack: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Msg: "," chat: "," Error: PreviousMsgNotUpdatableError"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleSingleMsg: checkOrphanMutations failed during handleSingleMsg for: "," chat: "," Error: ",", message: ",", stack: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleSingleMsg: msgId::",", checkOrphanMutations done"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleSingleMsg: msgId::",", write message to db done, overwrite: ",", skipUI: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["storeMessages loop: Gave up after "," tries"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["storeMessages loop: failed with error ","."]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["storeMessages loop"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["storeMessages loop: detect resend message"]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["processPlaceholderMsg: skip creating duplicate placeholder"]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["placeholder populate successful"]);t=function(){return a};return a}function a(a,b,c,d,e){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g,u){g===void 0&&(g=d("WAWebHandleMsgTypes.flow").MessageOverwriteOption.NO_OVERWRITE);u===void 0&&(u=!0);var v=g!==d("WAWebHandleMsgTypes.flow").MessageOverwriteOption.NO_OVERWRITE,w={add:"after",update:v,isHistory:!1},x=e.type===d("WAWebMsgType").MSG_TYPE.PROTOCOL&&["sender_revoke","admin_revoke"].includes(e.subtype),y=e;if(!x){g=(yield d("WAWebApiOrphanRevoke").applyOrphanRevokes([y]));if(g.length===0)return;y=g[0]}e=(yield d("WAWebHandleForMessageRange").handleForActiveMessageRange(a,y));if(e.has(d("WAWebHandleForMessageRangeEnums").ActiveRangeHandlerAction.DropMessage))return;g=e.has(d("WAWebHandleForMessageRangeEnums").ActiveRangeHandlerAction.SkipUI);try{c("WAWebWid").isStatusV3(a)&&(yield d("WAWebBackendApi").frontendSendAndReceive("handleStatusV3Update",{rawMsg:y,checksum:null,isMsgUpdate:!1}));yield d("WAPromiseLoop").promiseLoop(function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(c,e,f){e=d("WAPromiseDelays").delayMs(d("WABackoffUtils").expBackoff(f,12e4,1e3,.1));try{if(v)y=(yield d("WAWebDBProcessMessage").updateMessage(y)),d("WALogger").LOG(t()).tags("handleSingleMsg");else if(x){yield d("WAWebDBStoreRevokeMsgs").processRevokeMsgs([{revokeMsgKey:y.protocolMessageKey,newMsgKey:y.id,timestamp:y.t,subtype:y.subtype,sender:y.author,revokeTimestamp:y.t}]);d("WAWebBackendApi").frontendFireAndForget("deleteModelsForLastAddOnPreview",{messagesIds:[y.protocolMessageKey.toString()]});var g=b("WAWebPersistedJobManager").getJobManager;yield g().waitUntilPersisted(d("WAWebPersistedJobDefinitions").jobSerializers.deleteAddOns(a.toString(),[y.protocolMessageKey.toString()]))}else try{yield d("WAWebDBProcessMessage").storeMessages([y],a),y.type===d("WAWebMsgType").MSG_TYPE.CIPHERTEXT&&void d("WAWebHandlePlaceholderWam").addPlaceholderWam([y])}catch(a){if(a instanceof d("WAWebDBProcessMessage").DuplicateMessageError)y.type===d("WAWebMsgType").MSG_TYPE.CIPHERTEXT?d("WALogger").LOG(s()):(d("WALogger").LOG(r()),y=(yield d("WAWebDBProcessMessage").updateMessage(y)),w.update=!0);else throw a}if(y.type===d("WAWebMsgType").MSG_TYPE.GROUPS_V4_INVITE){g=y.id.toString();yield d("WAWebApiGroupInviteV4Store").persistGroupInviteV4Msg(g,{id:g,from:y.from.toString(),to:y.to.toString(),groupId:y.inviteGrp,expiration:parseInt(y.inviteCodeExp,10),expired:d("WATimeUtils").unixTime()>=parseInt(y.inviteCodeExp,10)})}d("WALogger").LOG(q()).tags("handleSingleMsg");c()}catch(a){d("WALogger").LOG(p(),a).tags("handleSingleMsg");if(f>3){d("WALogger").WARN(o(),f);return(h||(h=b("Promise"))).reject(a)}return e}});return function(a,b,d){return c.apply(this,arguments)}}());d("WALogger").LOG(n(),y.id.id,v,g).tags("messaging");try{yield d("WASyncdOrphan").checkOrphanMutations([y.id.toString()],[a.toString()]),d("WALogger").DEV(m(),y.id.id).tags("messaging"),yield d("WAWebCheckUpdateOrphanReactions").checkUpdateForOrphanReactions([y.id.toString()])}catch(b){d("WALogger").ERROR(l(),String(y.id),String(a),b.name,b.message,b.stack).devConsole(b)}g||(yield d("WAWebBackendApi").frontendSendAndReceive("processMultipleMessages",{chatId:a,msgObjs:[babelHelpers["extends"]({},y,{recvFresh:!0,isNewMsg:!0})],meta:w,processMessagesOrigin:f,chatMsgsCollection:null,preserveOrder:u}))}catch(b){if(b instanceof d("WAWebBackendErrors").LogoutDrop)return;if(b instanceof d("WAWebDBProcessMessage").PreviousMsgNotUpdatableError){d("WALogger").WARN(k(),String(y.id),String(a));return}!c("gkx")("26258")?d("WALogger").WARN(j(),String(y.id),String(a),b.name,b.message,b.stack).tags("messaging").devConsole(b).sendLogs("msg_handler for MD: error storing/processing single message"):d("WALogger").WARN(i(),String(y.id),String(a),b.name,b.message,b.stack).tags("messaging").devConsole(b)}});return u.apply(this,arguments)}g.handleSingleMsg=a}),98);
__d("WAWebLogMissingGroupParticipantMappings",["WALogger","WAWebABProps","WAWebApiContact","WAWebGroupsParticipantsApi","WAWebIsCagGroupCache","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["participant missing mapping, addressing mode mismatch = ",""]);h=function(){return a};return a}function a(a,b,c,d){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f){if(!d("WAWebABProps").getABPropConfigValue("web_extra_lid_group_logging_attributes"))return;if(!a.isGroup()||c("WAWebIsCagGroupCache").isCag(a)||b.isBot())return;b=d("WAWebWidFactory").toUserWid(b);if(d("WAWebApiContact").getAlternateUserWid(b)!=null)return;a=(yield d("WAWebGroupsParticipantsApi").getParticipants(a));if(a==null||a.participants.includes(b.toString()))return;d("WALogger").ERROR(h(),String(f!==e)).sendLogs("GroupLidInfra/incoming_group_message_unknown")});return i.apply(this,arguments)}g.logMissingGroupParticipantMappings=a}),98);
__d("WAWebDBCreateOrUpdateReactions",["WAWebApiContact","WAWebLidGroupsGatingUtils","WAWebLidMigrationUtils","WAWebModelStorageUtils","WAWebUserPrefsMeUser","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a){var c=new Map();a.forEach(function(a){d("WAWebUserPrefsMeUser").isSerializedWidMe(a.senderUserJid)&&(a.read=!0);var b=h(a),e=c.get(b);e?e.timestamp<=a.timestamp&&c.set(b,a):c.set(b,a)});return d("WAWebModelStorageUtils").getStorage().lock(["reactions"],function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a[0];var b=[],e=[];Array.from(c.values()).forEach(function(a){e.push([a.parentMsgKey,a.senderUserJid]);if(d("WAWebLidGroupsGatingUtils").allowReferenceByAltJid()){var b=d("WAWebApiContact").getAlternateUserWid(d("WAWebWidFactory").createWid(a.senderUserJid));b!=null&&e.push([a.parentMsgKey,b.toString()])}});var f=(yield a.anyOf(["parentMsgKey","senderUserJid"],e));f.forEach(function(a){var d=h(a),e=c.get(d);e&&(e.timestamp<=a.timestamp?c["delete"](d):e.senderUserJid!==a.senderUserJid&&b.push([a.parentMsgKey,a.senderUserJid]))});b.length>0&&(yield a.bulkRemove(b));yield a.bulkCreateOrReplace(Array.from(c.values()));return Array.from(c.values())});return function(b){return a.apply(this,arguments)}}())}function h(a){var b=d("WAWebWidFactory").createWid(a.senderUserJid),c=String(d("WAWebLidMigrationUtils").normalizeWidToPn(b));b=String(d("WAWebLidMigrationUtils").normalizeWidToLid(b));return a.parentMsgKey+","+c+","+b}g.createOrUpdateReactions=a}),98);
__d("WAWebReactionEncMessageValidationError",["$InternalEnum","WAWebHandleMsgError"],(function(a,b,c,d,e,f,g){a=b("$InternalEnum")({INVALID_ENC_IV:"enc_reaction_invalid_iv",INVALID_ENC_PAYLOAD:"enc_reaction_invalid_payload",MISSING_TARGET_MSG_KEY:"enc_reaction_missing_target_msg_key",MISSING_MESSAGE_SECRET:"enc_reaction_missing_message_secret",MISSING_SENDER:"enc_reaction_missing_sender",MISSING_PARENT_MESSAGE:"enc_reaction_missing_parent_message",MISSING_PARENT_MESSAGE_SENDER:"enc_reaction_missing_parent_message_sender",DECRYPTION_FAILED:"enc_reaction_decryption_failed"});c=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.name="ReactionEncMessageValidationError",b)||babelHelpers.assertThisInitialized(c)}return b}(d("WAWebHandleMsgError").MessageValidationError);g.ReactionEncValidationErrorCode=a;g.ReactionEncMessageValidationError=c}),98);
__d("WAWebReactionsEncryption",["WAWebAddOnEncryption","WAWebProtobufsE2E.pb","asyncToGeneratorRuntime","decodeProtobuf"],(function(a,b,c,d,e,f,g){function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b={type:"reaction",encryptedAddOn:a.encryptedReaction};b=(yield d("WAWebAddOnEncryption").decryptAddOn(b,{messageSecret:a.messageSecret,iv:a.iv,stanzaId:a.stanzaId,originalMessageSender:a.originalMessageSender,addOnSender:a.reactionSender}));return d("decodeProtobuf").decodeProtobuf(d("WAWebProtobufsE2E.pb").Message$ReactionMessageSpec,b)});return h.apply(this,arguments)}g.parseEncReaction=a}),98);
__d("WAWebReactionsValidationError",["$InternalEnum","WAWebHandleMsgError"],(function(a,b,c,d,e,f,g){a=b("$InternalEnum")({INVALID_REACTION_TEXT_LENGTH:"reaction_invalid_text_length",MISSING_PARENT_MSG_KEY:"reaction_missing_parent_msg_key",MISSING_TIMESTAMP:"reaction_missing_timestamp"});c=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.name="ReactionValidationError",b)||babelHelpers.assertThisInitialized(c)}return b}(d("WAWebHandleMsgError").MessageValidationError);g.ReactionValidationErrorCode=a;g.ReactionValidationError=c}),98);
__d("WAWebHandleMsgProcessUtils",["Promise","WALogger","WALongInt","WAWebBackendApi","WAWebBizCoexGatingUtils","WAWebDBCreateOrUpdateReactions","WAWebDBMsgUtils","WAWebDBPollsUpsertVotes","WAWebDBProcessEditProtocolMsgs","WAWebDBStoreMessageOrphans","WAWebDBUpdateLastAddOnPreviewChat","WAWebE2EProtoUtils","WAWebGetMessageCache","WAWebHandleMsgCommon","WAWebHandleMsgError","WAWebHandleMsgValidate","WAWebIcdcHandlerApi","WAWebLastAddOnDBSerialization","WAWebMsgGetters","WAWebMsgType","WAWebOfflineDeviceCache","WAWebPinMessageProcessor","WAWebPnhGatingUtils","WAWebProcessMatMessages","WAWebReactionEncMessageValidationError","WAWebReactionsBEUtils","WAWebReactionsEncryption","WAWebReactionsValidationError","WAWebShouldUpdateLastAddOnPreview","WAWebSyncDeviceAdvDeviceListJob","WAWebWamEnumE2eFailureReason","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["storeReactionMsgBulk: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["convertEncReactionToReaction: parent msg "," secret is missing"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["processDecryptedMessageProto: msgId::",", message decrypted: "]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["storing offline message for async processing"]);l=function(){return a};return a}function m(a,b){d("WALogger").DEV(l()).devConsole({msg:a,msgInfo:b});a={msg:a,receiptInfo:{externalId:a.id.id,from:a.from,author:b.author}};void d("WAWebGetMessageCache").getMessageCache().addMessages([a],!1)}function a(a,b){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a.offline==null&&d("WALogger").LOG(k(),a.externalId).tags("messaging").devConsole(b);if(!a.isHsm&&b.highlyStructuredMessage)throw new(d("WAWebHandleMsgCommon").HsmMismatchError)();var c=null;if(!(yield d("WAWebHandleMsgValidate").isFromKnownDevice(a.author))){var e=d("WAWebWidFactory").toUserWid(a.author);a.offline==null?d("WAWebSyncDeviceAdvDeviceListJob").syncDeviceListJob([e],null,null):d("WAWebOfflineDeviceCache").OfflinePendingDeviceCache.addOfflinePendingDevice(String(e),null);throw new(d("WAWebHandleMsgError").UnknownDeviceMessageError)("[messaging] msgId::"+a.externalId+", processDecryptedMessageProto: reject message from unknown device")}b.messageContextInfo&&(d("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()&&(c=a.chat.isUser()?yield d("WAWebIcdcHandlerApi").handleHostedIcdcMetadataInline(a.chat,a.author,b.messageContextInfo):null),d("WAWebIcdcHandlerApi").handleICDCData(a.author,a.chat.isUser()?a.chat:null,b.messageContextInfo));return c});return n.apply(this,arguments)}function c(a){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=a.targetMessageKey,e=a.encIv,f=a.encPayload,g=a.author?a.author:a.id.participant;if(g==null)throw new(d("WAWebReactionEncMessageValidationError").ReactionEncMessageValidationError)(d("WAWebReactionEncMessageValidationError").ReactionEncValidationErrorCode.MISSING_SENDER,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);var i=(yield d("WAWebDBMsgUtils").getMsgByMsgKey(c));if(i==null){var k=b("WAWebDBStoreMessageOrphans");k=k.storeMessageOrphans;yield k([a],function(a){return a.targetMessageKey});return(h||(h=b("Promise"))).resolve()}k=i.messageSecret;if(k==null){d("WALogger").LOG(j(),c.id).tags("messaging");throw new(d("WAWebReactionEncMessageValidationError").ReactionEncMessageValidationError)(d("WAWebReactionEncMessageValidationError").ReactionEncValidationErrorCode.MISSING_MESSAGE_SECRET,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE,{sendLogs:!1})}var l=d("WAWebMsgGetters").getOriginalSender(i);if(l==null)throw new(d("WAWebReactionEncMessageValidationError").ReactionEncMessageValidationError)(d("WAWebReactionEncMessageValidationError").ReactionEncValidationErrorCode.MISSING_PARENT_MESSAGE_SENDER,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);f={encryptedReaction:f,messageSecret:k,iv:e,stanzaId:i.id.id,originalMessageSender:l,reactionSender:d("WAWebWidFactory").toUserWid(g)};var m;try{m=(yield d("WAWebReactionsEncryption").parseEncReaction(f))}catch(a){throw new(d("WAWebReactionEncMessageValidationError").ReactionEncMessageValidationError)(d("WAWebReactionEncMessageValidationError").ReactionEncValidationErrorCode.DECRYPTION_FAILED,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE)}e=(k=d("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis(m.text))!=null?k:d("WAWebReactionsBEUtils").REVOKED_REACTION_TEXT;i=m.senderTimestampMs;if(i==null)throw new(d("WAWebReactionsValidationError").ReactionValidationError)(d("WAWebReactionsValidationError").ReactionValidationErrorCode.MISSING_TIMESTAMP,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);return babelHelpers["extends"]({},a,{type:d("WAWebMsgType").MSG_TYPE.REACTION,kind:d("WAWebMsgType").MsgKind.ReactionDecrypted,reactionParentKey:c,reactionText:e,reactionTimestamp:d("WALongInt").numberOrThrowIfTooLarge(i),encPayload:void 0,targetMessageKey:void 0,encIv:void 0})});return o.apply(this,arguments)}function e(a,b,c){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){if(b.offline!=null&&!c)return m(a,b);yield d("WAWebBackendApi").frontendSendAndReceive("processEphemeralSyncResponse",{msg:a})});return p.apply(this,arguments)}function f(a,b,c){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){if(b.offline!=null&&!c)return m(a,b);yield d("WAWebBackendApi").frontendSendAndReceive("processKeepInChatMessage",{keepInChatMessage:a,allowNotification:!0})});return q.apply(this,arguments)}function r(a,b,c){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){a=d("WAWebPnhGatingUtils").isMatFullyEnabled()?yield d("WAWebProcessMatMessages").processEditMatMessages(a):a;if(b.offline!=null&&!c)return m(a,b);yield d("WAWebDBProcessEditProtocolMsgs").processEditProtocolMsgs([a],c)});return s.apply(this,arguments)}function t(a,b,c){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){if(b.offline!=null&&!c)return m(a,b);yield d("WAWebPinMessageProcessor").processPinMessages(a.id.remote,[a])});return u.apply(this,arguments)}function v(a){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("WAWebDBPollsUpsertVotes").upsertVotesDb(a));d("WAWebBackendApi").frontendFireAndForget("upsertVotesModelCollection",{votes:a,restoredFromDb:!0});yield x(a.map(function(a){return d("WAWebLastAddOnDBSerialization").lastAddOnPreviewCandidateFromVoteData(a,!1)}))});return w.apply(this,arguments)}function x(a){return y.apply(this,arguments)}function y(){y=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("WAWebShouldUpdateLastAddOnPreview").filterChatsWithAddOnPreviewUpdates(a));a.size>0&&(yield d("WAWebDBUpdateLastAddOnPreviewChat").updateDatabaseForLastAddOnPreview(a),d("WAWebBackendApi").frontendFireAndForget("updateChatLastAddOnPreview",{chatMap:a}))});return y.apply(this,arguments)}function z(a){var b=a.id,c=a.reactionTimestamp,e=a.reactionText,f=a.reactionParentKey,g=a.sender;a=a.unread;g=d("WAWebWidFactory").toUserWid(g);var h=0;return{msgKey:b.toString(),parentMsgKey:f.toString(),senderUserJid:g.toString(),reactionText:(b=e)!=null?b:d("WAWebReactionsBEUtils").REVOKED_REACTION_TEXT,timestamp:c,orphan:h,read:!a}}function A(a){return B.apply(this,arguments)}function B(){B=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.map(function(a){return z(a)});var b="reaction received: "+a.map(function(a){return a.msgKey.toString()+" to "+a.parentMsgKey}).toString()+";";d("WALogger").DEV(i(),b).tags("messaging");b=(yield d("WAWebDBCreateOrUpdateReactions").createOrUpdateReactions(a));b&&(yield x(b.map(function(a){return d("WAWebLastAddOnDBSerialization").lastAddOnPreviewCandidateFromReactionRowType(a)})));return b});return B.apply(this,arguments)}g.preProcessMsg=a;g.convertEncReactionToReaction=c;g.processEphemeralSyncResponseMsg=e;g.processKeepInChatMsg=f;g.processEditProtocolMsg=r;g.processPinMsg=t;g.storePollVotesBulk=v;g.storeReactionMsgBulk=A}),98);
__d("WAWebApiActiveMessageRanges",["WALogger","WANullthrows","WASyncAction.pb","WAWebDBMsgUtils","WAWebSchemaActiveMessageRanges","asyncToGeneratorRuntime","decodeProtobuf","err"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["getRangesForChat failed with error: ",""]);h=function(){return a};return a}var i=new Map(),j={reset:function(){i=new Map()},removeRange:function(a,b){var c;(c=i.get(a))==null?void 0:c["delete"](b);return d("WAWebSchemaActiveMessageRanges").getActiveMessageRangesTable().remove([a,b])},createOrReplaceRange:function(a){var b=i.get(a.chatId);b==null&&(b=new Map(),i.set(a.chatId,b));b.set(a.action,a);return d("WAWebSchemaActiveMessageRanges").getActiveMessageRangesTable().createOrReplace(a)},bulkCreateOrReplaceRanges:function(a){a.forEach(function(a){var b=i.get(a.chatId);b==null&&(b=new Map(),i.set(a.chatId,b));b.set(a.action,a)});return d("WAWebSchemaActiveMessageRanges").getActiveMessageRangesTable().bulkCreateOrReplace(a)},getRangesForChat:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=i.get(a);try{if(b==null){var c=(yield d("WAWebSchemaActiveMessageRanges").getActiveMessageRangesTable().anyOf(["chatId"],[a]));b=new Map(c.map(function(a){return[a.action,a]}));i.set(a,b)}}catch(a){d("WALogger").ERROR(h(),a)}return b?Array.from(b.values()):[]});function c(b){return a.apply(this,arguments)}return c}()};function k(a,b){switch(a){case d("WAWebSchemaActiveMessageRanges").ActiveRangeAction.Archive:return{action:d("WAWebSchemaActiveMessageRanges").ActiveRangeAction.Archive,actionValue:c("WANullthrows")(b.archiveChatAction)};case d("WAWebSchemaActiveMessageRanges").ActiveRangeAction.MarkChatAsRead:return{action:d("WAWebSchemaActiveMessageRanges").ActiveRangeAction.MarkChatAsRead,actionValue:c("WANullthrows")(b.markChatAsReadAction)};case d("WAWebSchemaActiveMessageRanges").ActiveRangeAction.ClearChatKeepStarredKeepMedia:return{action:d("WAWebSchemaActiveMessageRanges").ActiveRangeAction.ClearChatKeepStarredKeepMedia,actionValue:c("WANullthrows")(b.clearChatAction)};case d("WAWebSchemaActiveMessageRanges").ActiveRangeAction.ClearChatKeepStarredDeleteMedia:return{action:d("WAWebSchemaActiveMessageRanges").ActiveRangeAction.ClearChatKeepStarredDeleteMedia,actionValue:c("WANullthrows")(b.clearChatAction)};case d("WAWebSchemaActiveMessageRanges").ActiveRangeAction.ClearChatDeleteStarredKeepMedia:return{action:d("WAWebSchemaActiveMessageRanges").ActiveRangeAction.ClearChatDeleteStarredKeepMedia,actionValue:c("WANullthrows")(b.clearChatAction)};case d("WAWebSchemaActiveMessageRanges").ActiveRangeAction.ClearChatDeleteStarredDeleteMedia:return{action:d("WAWebSchemaActiveMessageRanges").ActiveRangeAction.ClearChatDeleteStarredDeleteMedia,actionValue:c("WANullthrows")(b.clearChatAction)};case d("WAWebSchemaActiveMessageRanges").ActiveRangeAction.DeleteChatDeleteMedia:return{action:d("WAWebSchemaActiveMessageRanges").ActiveRangeAction.DeleteChatDeleteMedia,actionValue:c("WANullthrows")(b.deleteChatAction)};case d("WAWebSchemaActiveMessageRanges").ActiveRangeAction.DeleteChatKeepMedia:return{action:d("WAWebSchemaActiveMessageRanges").ActiveRangeAction.DeleteChatKeepMedia,actionValue:c("WANullthrows")(b.deleteChatAction)};default:throw c("err")("unsupported action for message ranges: "+String(a))}}function a(a,b,c){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){c=d("decodeProtobuf").decodeProtobuf(d("WASyncAction.pb").SyncActionValueSpec,c);var e=k(b,c);e=e.actionValue;e=((e=e.messageRange)==null?void 0:e.messages)||[];var f=(yield d("WAWebDBMsgUtils").filterReceivedMessagesInRange(a,e));e=Math.max(0,e.length-f.length);return j.createOrReplaceRange(babelHelpers["extends"]({chatId:a},k(b,c),{remainingMessages:e}))});return l.apply(this,arguments)}function e(a,b){return j.removeRange(a,b)}function f(a){return j.bulkCreateOrReplaceRanges(a)}function m(a){return j.getRangesForChat(a)}function n(a,b){switch(a){case"archive":return d("WAWebSchemaActiveMessageRanges").ActiveRangeAction.Archive;case"markChatAsRead":return d("WAWebSchemaActiveMessageRanges").ActiveRangeAction.MarkChatAsRead;case"clearChat":if((b==null?void 0:b.deleteStarred)&&b.deleteMedia)return d("WAWebSchemaActiveMessageRanges").ActiveRangeAction.ClearChatDeleteStarredDeleteMedia;else if((b==null?void 0:b.deleteStarred)&&!b.deleteMedia)return d("WAWebSchemaActiveMessageRanges").ActiveRangeAction.ClearChatDeleteStarredKeepMedia;else if((b==null?void 0:b.deleteMedia)&&!b.deleteStarred)return d("WAWebSchemaActiveMessageRanges").ActiveRangeAction.ClearChatKeepStarredDeleteMedia;return d("WAWebSchemaActiveMessageRanges").ActiveRangeAction.ClearChatKeepStarredKeepMedia;case"deleteChat":return(b==null?void 0:b.deleteMedia)?d("WAWebSchemaActiveMessageRanges").ActiveRangeAction.DeleteChatDeleteMedia:d("WAWebSchemaActiveMessageRanges").ActiveRangeAction.DeleteChatKeepMedia;default:throw c("err")("unsupported active message range action")}}g._cache=j;g.addActiveMessageRange=a;g.removeActiveMessageRange=e;g.bulkUpdateActiveMessageRanges=f;g.getActiveMessageRanges=m;g.getActiveRangeAction=n}),98);
__d("WAWebTimestampConversionUtils",["WALogger","WALongInt","WATimeUtils"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: maybeMillisecondsToSeconds: messageTimestamp: "," too large to cast"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: maybeMillisecondsToSeconds: no need to adjust timestamp"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: maybeMillisecondsToSeconds: adjusting future timestamp"]);j=function(){return a};return a}function a(a){var b=a;try{d("WALongInt").numberOrThrowIfTooLarge(a)/d("WATimeUtils").unixTime()>10?(b=d("WALongInt").numberOrThrowIfTooLarge(a)/1e3,d("WALogger").LOG(j())):d("WALogger").LOG(i())}catch(b){d("WALogger").WARN(h(),a)}return b}g.maybeMillisecondsToSeconds=a}),98);
__d("WAWebActiveMessageRanges",["WALogger","WALongInt","WAWebApiActiveMessageRanges","WAWebHandleForMessageRangeEnums","WAWebSchemaActiveMessageRanges","WAWebTimestampConversionUtils"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: last message timestamp was converted to seconds from ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: missing message range from row."]);i=function(){return a};return a}function j(a,b){var c,e;if(a==null){d("WALogger").WARN(i());return d("WAWebHandleForMessageRangeEnums").RangeContain.DOES_NOT_CONTAIN}var f=a.messages;a=a.lastMessageTimestamp;c=d("WAWebTimestampConversionUtils").maybeMillisecondsToSeconds((c=a)!=null?c:0);c!==((e=a)!=null?e:0)&&d("WALogger").LOG(h(),a).sendLogs("syncd: last message timestamp was converted to seconds",.1);if(b.t!=null&&b.t<d("WALongInt").numberOrThrowIfTooLarge(c))return d("WAWebHandleForMessageRangeEnums").RangeContain.CONTAINS_BY_TIMESTAMP;e=b.id;for(a=f,c=Array.isArray(a),b=0,a=c?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){if(c){if(b>=a.length)break;f=a[b++]}else{b=a.next();if(b.done)break;f=b.value}f=f;f=f.key;if(f!=null&&e!=null&&f.id===e.id)return d("WAWebHandleForMessageRangeEnums").RangeContain.CONTAINS_BY_ADDITIONAL}return d("WAWebHandleForMessageRangeEnums").RangeContain.DOES_NOT_CONTAIN}function a(a,b){d("WAWebApiActiveMessageRanges").getActiveMessageRanges(a.remote.toString()).then(function(c){c.forEach(function(c){if([d("WAWebSchemaActiveMessageRanges").ActiveRangeAction.Archive,d("WAWebSchemaActiveMessageRanges").ActiveRangeAction.MarkChatAsRead].includes(c.action)&&j(c.actionValue.messageRange,{id:a,t:b})===d("WAWebHandleForMessageRangeEnums").RangeContain.DOES_NOT_CONTAIN)return d("WAWebApiActiveMessageRanges").removeActiveMessageRange(a.remote.toString(),c.action)})})}g.rangeContainsMessage=j;g.checkAndRemoveActiveMessageRanges=a}),98);
__d("WAWebApiOrphanReceipt",["WAWebModelStorageUtils","WAWebSchemaOrphanReceipt"],(function(a,b,c,d,e,f,g){function a(a){return d("WAWebSchemaOrphanReceipt").getOrphanReceiptTable().remove(a)}function b(a){return d("WAWebSchemaOrphanReceipt").getOrphanReceiptTable().get(a)}function c(a,b,c){return d("WAWebModelStorageUtils").getStorage().lock(["orphan-receipt"],function(d){var e=d[0];return e.bulkGet(c).then(function(d){var f=c.reduce(function(c,e,f){f=d[f];f==null&&(f={msgKey:e});e=f[a];(e==null||e>b)&&(f[a]=b,c.push(f));return c},[]);return e.bulkCreateOrReplace(f)})})}g.removeOrphanReceipt=a;g.getOrphanReceipt=b;g.createOrUpdateOrphanReceipt=c}),98);
__d("WAWebHandleMsgReceiptCommon",["WALogger","WAPromiseQueue","WATimeUtils","WAWebAck","WAWebActiveMessageRanges","WAWebApiActiveMessageRanges","WAWebApiChat","WAWebApiOrphanReceipt","WAWebBackendApi","WAWebChatThreadLogging","WAWebDBMessageSerialization","WAWebDBMessageUtils","WAWebMarkAddOnsAsReadJob","WAWebMessageAddOnType","WAWebMsgKey","WAWebNewsletterDBUtils","WAWebNewsletterGatingUtils","WAWebSchemaMessage","asyncToGeneratorRuntime","lodash"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["updateChatPeerRead: storing "," orphan acks"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["updateChatPeerRead: maybeOrphans ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["shouldMarkChatRead: messageExistsOutsideRange=",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["shouldMarkChatRead: found an active mark as unread range"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["processReactionOrphanPeerReceipt: orphan read ack found for incoming ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["processReactionOrphanPeerReceipt: no orphan ack found for incoming ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["processOrphanPeerReceipt: orphan read ack found for incoming ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["processOrphanPeerReceipt: orphan played ack found for incoming ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["processOrphanPeerReceipt: no orphan ack found for incoming ",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["updateMsgAcks: store "," orphan acks"]);q=function(){return a};return a}var r=new(d("WAPromiseQueue").PromiseQueue)();function s(a,b){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=(yield d("WAWebApiActiveMessageRanges").getActiveMessageRanges(a));a=a.filter(function(a){return a.action==="markChatAsRead"&&a.actionValue.read===!1&&a.actionValue.messageRange!=null});if(a.length===0)return!0;d("WALogger").DEV(k());var e=a[0];a=b.some(function(a){return!d("WAWebActiveMessageRanges").rangeContainsMessage(e.actionValue.messageRange,{id:c("WAWebMsgKey").fromString(a.id),t:a.t})});d("WALogger").DEV(j(),a);return a});return t.apply(this,arguments)}function u(a,b){return v.apply(this,arguments)}function v(){v=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e=b.map(String),f=null;b=(yield d("WAWebSchemaMessage").getMessageTable().bulkGet(e,!1));var g=[];b.forEach(function(a,b){if(!a)g.push(e[b]);else if(a.pendingReadReceipt==null)return;else a.rowId!=null&&(f==null||a.rowId>f)&&(f=a.rowId)});g.length>0&&d("WALogger").LOG(i(),g.length);var j;if(g.length===0)j=new Set();else{var k=(yield d("WAWebMarkAddOnsAsReadJob").markUnclassifiedAddOnsAsReadJob(g.map(function(a){return c("WAWebMsgKey").from(a)}))),l=k.updatedAddOns;k=k.updatedOrphans;j=new Set([].concat(k,c("lodash").flatten(Array.from(l.values()))).map(String))}var m=g.filter(function(a){return!j.has(a)});r.enqueue(function(){d("WALogger").LOG(h(),m.length);return d("WAWebApiOrphanReceipt").createOrUpdateOrphanReceipt(d("WAWebAck").ACK_STRING.READ,0,m)});yield d("WAWebApiChat").markMessageAndChatAsRead(f,String(a),!(yield s(a.toString(),b.filter(Boolean))));if(a.isNewsletter()){d("WAWebNewsletterGatingUtils").isNewsletterEnabled()&&(yield d("WAWebBackendApi").frontendSendAndReceive("updateNewsletterUnreadMsgCount",{id:a}));return}yield d("WAWebBackendApi").frontendSendAndReceive("updateChatUnreadMsgCountAndClearMentions",{remote:a})});return v.apply(this,arguments)}function a(a,b){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=a.map(function(a){return d("WAWebDBMessageUtils").craftInternalId(b.toJid(),a)});a=(yield d("WAWebSchemaMessage").getMessageTable().anyOf(["internalId"],a));a=a.map(function(a){return c("WAWebMsgKey").fromString(a.id)});yield d("WAWebNewsletterDBUtils").updateMsgViewReceipt(a);return d("WAWebBackendApi").frontendFireAndForget("updateMsgsViewed",{ids:a})});return w.apply(this,arguments)}function e(a,b,c){r.enqueue(function(){d("WALogger").LOG(q(),a.length);var e=null;b===d("WAWebAck").ACK.PLAYED?e=d("WAWebAck").ACK_STRING.PLAYED:b===d("WAWebAck").ACK.READ&&(e=d("WAWebAck").ACK_STRING.READ);if(e)return d("WAWebApiOrphanReceipt").createOrUpdateOrphanReceipt(e,c,a.map(String))})}function f(a){return r.enqueue(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=(yield d("WAWebApiOrphanReceipt").getOrphanReceipt(String(a)));if(!b){d("WALogger").LOG(p(),a);return}b[d("WAWebAck").ACK_STRING.PLAYED]!=null&&(d("WALogger").LOG(o(),a),yield d("WAWebBackendApi").frontendSendAndReceive("updateMsgPeerAcks",{msgKeys:[a],ack:d("WAWebAck").ACK.PLAYED,t:b[d("WAWebAck").ACK_STRING.PLAYED]}));b[d("WAWebAck").ACK_STRING.READ]!=null&&(d("WALogger").LOG(n(),a),u(a.remote,[a]));yield d("WAWebApiOrphanReceipt").removeOrphanReceipt(String(a))}))}function x(a){return r.enqueue(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=(yield d("WAWebApiOrphanReceipt").getOrphanReceipt(String(a)));if(!b){d("WALogger").LOG(m(),a);return}b[d("WAWebAck").ACK_STRING.READ]!=null&&(d("WALogger").LOG(l(),a),yield d("WAWebMarkAddOnsAsReadJob").markAddOnsAsReadJob(new Map([[d("WAWebMessageAddOnType").MessageAddOnType.Reaction,[c("WAWebMsgKey").fromString(b.msgKey)]]])));yield d("WAWebApiOrphanReceipt").removeOrphanReceipt(String(a))}))}function y(a){return z.apply(this,arguments)}function z(){z=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.map(String);a=(yield d("WAWebSchemaMessage").getMessageTable().bulkGet(a,!1));d("WAWebChatThreadLogging").handleActivitiesForChatThreadLogging(a.filter(Boolean).map(function(a){return d("WAWebDBMessageSerialization").messageFromDbRow(a)}).filter(function(a){return a.isViewOnce}).map(function(a){var b;return{activityType:"viewOnceOpen",ts:(b=a.t)!=null?b:d("WATimeUtils").unixTime(),chatId:a.id.remote}}))});return z.apply(this,arguments)}g.updateChatPeerRead=u;g.updateMsgViewed=a;g.updateOrphanPeerReceipt=e;g.processOrphanPeerReceipt=f;g.processReactionOrphanPeerReceipt=x;g.handleViewOnceOpenedIfNecessary=y}),98);
__d("WAWebOfflineDeviceCache",["WAComms","WADeprecatedSendIq","WALogger","WAPromiseQueue","WAShiftTimer","WAWebApiPendingDeviceSync","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][device-cache]: creating snapshot for pending devices ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][device-cache]: creating snapshot: schedule in "," ms"]);i=function(){return a};return a}var j=3e3;a=function(){function a(){var a=this;this.pendingDeviceCache=new Set();this.pendingAcks=[];this.snapshotTimer=new(d("WAShiftTimer").ShiftTimer)(function(){a.createSnapshot()});this.checkpointQueue=new(d("WAPromiseQueue").PromiseQueue)()}var c=a.prototype;c.addOfflinePendingDevice=function(a,b){this.pendingDeviceCache.add(a),b&&this.pendingAcks.push(b),this.snapshotTimer.isScheduled()||(d("WALogger").LOG(i(),j),this.snapshotTimer.onOrAfter(j))};c.createSnapshot=function(){this.snapshotTimer.isScheduled()&&this.snapshotTimer.cancel();var a=Array.from(this.pendingDeviceCache),c=this.pendingAcks;d("WALogger").LOG(h(),a.join(","));this.checkpointQueue.enqueue(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield d("WAWebApiPendingDeviceSync").addUserToPendingDeviceSync(a),c.forEach(function(a){return d("WADeprecatedSendIq").deprecatedCastStanza(a)}),d("WAComms").cancelDeadSocketTimer()}));this.pendingDeviceCache=new Set();this.pendingAcks=[]};return a}();c=new a();g.OfflinePendingDeviceCache=c}),98);
__d("WASmaxOutOfflineBatchRequest",["WASmaxJsx","WAWap"],(function(a,b,c,d,e,f,g){function a(a){a=a.offlineBatchCount;a=d("WASmaxJsx").smax("ib",null,d("WASmaxJsx").smax("offline_batch",{count:d("WAWap").INT(a)}));return a}g.makeBatchRequest=a}),98);
__d("WASmaxOfflineBatchRPC",["WAComms","WASmaxOutOfflineBatchRequest","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a){var c;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:c=d("WASmaxOutOfflineBatchRequest").makeBatchRequest(a);e.next=3;return b("regeneratorRuntime").awrap(d("WAComms").castSmaxStanza(c));case 3:case"end":return e.stop()}},null,this)}g.sendBatchRPC=a}),98);
__d("WAWebEventsWaitForReadyForOffline",["Promise","WAWebCmd","WAWebEventsWaitForBbEvent","err"],(function(a,b,c,d,e,f,g){var h,i;function a(){if(i)return;i=c("WAWebEventsWaitForBbEvent")(d("WAWebCmd").Cmd,"offline_process_ready")}function e(){return!i?(h||(h=b("Promise"))).reject(c("err")("waitForOfflineProcessReady called before init")):i}g.initWaitForOfflineProcessReady=a;g.waitForOfflineProcessReady=e}),98);
__d("WAWebHandleOfflineAbProps",["WAWebABProps","WAWebRuntimeEnvironmentUtils","gkx"],(function(a,b,c,d,e,f,g){function a(){return d("WAWebABProps").getABPropConfigValue("web_non_blocking_offline_resume_max_message_count")}function b(){return c("gkx")("26255")&&process.platform==="darwin"?!1:!0}function e(){return!d("WAWebRuntimeEnvironmentUtils").isServiceWorker()&&d("WAWebABProps").getABPropConfigValue("web_offline_dynamic_batch_size_enabled")}function f(){var a=JSON.parse(d("WAWebABProps").getABPropConfigValue("web_offline_dynamic_batch_config")),b=parseFloat(a.multiplier);a=a.version||"default";return{multiplier:Number.isNaN(b)?.2:b,version:a}}g.getNonBlockingOfflineResumeMaxMessageCount=a;g.isNonBlockingResumeFromOpenTabEnabled=b;g.isOfflineDynamicBatchSizeEnabled=e;g.getOfflineDynamicBatchConfig=f}),98);
__d("WAWebOfflineHandler",["invariant","WALogger","WASmaxOfflineBatchRPC","WAWebCmd","WAWebEventsWaitForReadyForOffline","WAWebHandleOfflineAbProps","WAWebOfflineResumeUtils","WAWebPageLoadLogging","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g,h){function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][adaptive] _maybeRequestMoreStanza: request next batch, pending message ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][adaptive] _maybeRequestMoreStanza: start request next batch"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][adaptive] _maybeRequestMoreStanza: skip, prevPending: ",", currentPending: ",", complete: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][adaptive][debounced] _maybeRequestMoreStanzaDebounced: start request next batch"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][adaptive][debounced] _maybeRequestMoreStanzaDebounced: skipDebouncing: ",", prevPending: ",", currentPending: ",", complete: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][adaptive][debounced] _maybeRequestMoreStanza: request next batch, pending message ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][adaptive] _endBatchCheck: done"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[resume-from-open-tab] restart client due to exceed the LIMIT, message: ",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["[resume-from-open-tab][non-blocking] resume from current state of app"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume] initState called more than once"]);r=function(){return a};return a}var s=200,t=10,u=200,v=100,w=new Map([[0,200],[1,100],[2,50],[3,10]]),x=a();e=function(){function a(){this._offlineManagerInitialized=!1,this._pendingMessageCount=0,this._isPendingPrevBatch=!1,this._isPendingCurrentBatch=!1,this._currentBatchSize=s,this._runningMaxOfflineRetry=0,this._isOfflineDynamicBatchSizeEnabled=!1,this._lastBatchRequestTimestamp=0}var e=a.prototype;e.initState=function(a){var b=this;this._offlineResumeManager!=null&&d("WALogger").ERROR(r());this._offlineResumeManager=a.createBlockingStageManager();d("WAWebPageLoadLogging").addPageLoadQplAnnotation({blocking_resume:!0});this._createNonblockingStageManager=a.createNonblockingStageManager;c("gkx")("26255")&&d("WAWebCmd").Cmd.on("socket_stream_disconnected",function(){!c("gkx")("26258")&&!d("WAWebHandleOfflineAbProps").isNonBlockingResumeFromOpenTabEnabled()&&b._offlineResumeManager.isResumeFromRestartInProgress()&&d("WAWebOfflineResumeUtils").refreshWindow()})};e.processOfflinePreviewIb=function(a){d("WAWebPageLoadLogging").addPageLoadQplPoint("offline_preview_received");this._resetBatchState();this._isOfflineDynamicBatchSizeEnabled=d("WAWebHandleOfflineAbProps").isOfflineDynamicBatchSizeEnabled();if(this._createNonblockingStageManager!=null){var b=this._createNonblockingStageManager;d("WAWebHandleOfflineAbProps").isNonBlockingResumeFromOpenTabEnabled()&&d("WAWebCmd").Cmd.isMainStreamReadyMd&&this.isResumeFromRestartComplete()?z(a.message)?(d("WALogger").LOG(q()),this._offlineResumeManager=b({mainScreenLoaded:!0})):(d("WALogger").LOG(p(),a.message),d("WAWebOfflineResumeUtils").refreshWindow()):!this._offlineManagerInitialized&&!this.isResumeFromRestartComplete()&&z(a.message)&&(d("WAWebPageLoadLogging").addPageLoadQplAnnotation({blocking_resume:!1}),this._offlineResumeManager=b())}this._offlineManagerInitialized=!0;this._offlineResumeManager.processOfflinePreview(a)};e.processMessageDecryptResult=function(a){this._offlineResumeManager.processDecryptResult(a),this._pendingMessageCount-=1,void this._maybeRequestMoreStanza()};e.addOfflinePendingMessage=function(){this.isResumeFromRestartComplete()||(this._pendingMessageCount+=1)};e.newOfflineStanza=function(a,b,c){var e=this;this._isPendingPrevBatch=!1;this._runningMaxOfflineRetry=Math.max(this._runningMaxOfflineRetry,c);this._endBatchCheck==null&&(this._endBatchCheck=self.setTimeout(function(){e._maybeRequestMoreStanza(),e._endBatchCheck=null,d("WALogger").LOG(o())},0));return this._offlineResumeManager.newOfflineStanza(a,b,c)};e.offlineStanzaReceivedAfterComplete=function(){return this._offlineResumeManager.offlineStanzaReceivedAfterComplete()};e.getOfflineDeliveryProgress=function(){return this._offlineResumeManager.getOfflineDeliveryProgress()};e.getOfflineMessageCount=function(){return Math.max(this._offlineResumeManager.offlineMessagePreviewCounter,0)};e.isResumeOnSocketDisconnectInProgress=function(){return this._offlineResumeManager.isResumeOnSocketDisconnectInProgress()};e.isResumeFromRestartComplete=function(){return this._offlineResumeManager.isResumeFromRestartComplete()};e.getHasMessagesToDownload=function(){return this._offlineResumeManager.getHasMessagesToDownload()};e.getFinishedDownloading=function(){return this.getOfflineDeliveryProgress()===100};e.processOfflineIb=function(a){d("WAWebPageLoadLogging").addPageLoadQplPoint("offline_received");return this._offlineResumeManager.processOfflineSessionComplete(a)};e.shouldUseOfflineResumeScreen=function(){return this._offlineResumeManager.shouldUseOfflineResumeScreen()};e.getResumeUIProgressBarType=function(){return this._offlineResumeManager.getResumeUIProgressBarType()};e._resetBatchState=function(){this._isPendingPrevBatch=!1,this._isPendingCurrentBatch=!1,this._lastBatchRequestTimestamp=0};e._sendBatchRequestIBDebounced=function(a,b){var c=this;b===void 0&&(b=!1);b=b===!0||this._lastBatchRequestTimestamp===0;this._batchIBCheckTimer!=null&&self.clearTimeout(this._batchIBCheckTimer);b?(d("WALogger").LOG(n(),this._pendingMessageCount),void d("WASmaxOfflineBatchRPC").sendBatchRPC({offlineBatchCount:a}),this._lastBatchRequestTimestamp=Date.now(),this._runningMaxOfflineRetry=0,this._isPendingPrevBatch=!0,this._isPendingCurrentBatch=!1):this._batchIBCheckTimer=self.setTimeout(function(){void c._maybeRequestMoreStanzaDebounced()},v)};e._maybeRequestMoreStanzaDebounced=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a===void 0&&(a=!1);var b=Date.now()-this._lastBatchRequestTimestamp;a=a||!this.isResumeFromRestartComplete()&&this._pendingMessageCount<=s&&b>=v&&this._isPendingPrevBatch===!1&&this._isPendingCurrentBatch===!0;if(this.isResumeFromRestartComplete()||this._isPendingPrevBatch||this._isPendingCurrentBatch){this.isResumeFromRestartComplete()||d("WALogger").LOG(m(),a,this._isPendingPrevBatch,this._isPendingCurrentBatch,this.isResumeFromRestartComplete());if(a===!1)return}if(this._pendingMessageCount<=s){d("WALogger").LOG(l());this._isPendingCurrentBatch=!0;yield d("WAWebEventsWaitForReadyForOffline").waitForOfflineProcessReady();s;b=x(this._runningMaxOfflineRetry,this._currentBatchSize);this._currentBatchSize=b;this._sendBatchRequestIBDebounced(b,a)}});function a(b){return a.apply(this,arguments)}return a}();e._maybeRequestMoreStanza=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a===void 0&&(a=!1);if(this._isOfflineDynamicBatchSizeEnabled)return this._maybeRequestMoreStanzaDebounced(a);if(this.isResumeFromRestartComplete()||this._isPendingPrevBatch||this._isPendingCurrentBatch){this.isResumeFromRestartComplete()||d("WALogger").LOG(k(),this._isPendingPrevBatch,this._isPendingCurrentBatch,this.isResumeFromRestartComplete());return}this._pendingMessageCount<=s&&(d("WALogger").LOG(j()),this._isPendingCurrentBatch=!0,yield d("WAWebEventsWaitForReadyForOffline").waitForOfflineProcessReady(),void d("WASmaxOfflineBatchRPC").sendBatchRPC({offlineBatchCount:s}),this._isPendingCurrentBatch=!1,this._isPendingPrevBatch=!0,d("WALogger").LOG(i(),this._pendingMessageCount))});function a(b){return a.apply(this,arguments)}return a}();return a}();function y(a,b,c,d){var e;d===void 0&&(d=.2);if(a===0)return u;if(a>3)return t;var f=null;e=a-((e=b)!=null?e:0);if(e===0){f=Math.floor(c*d)+c;((e=w.get(a-1))!=null?e:u)<=f&&(f=c)}else f=w.get(a);f!=null||h(0,75725,a,(d=b)!=null?d:"N/A",c);return(e=f)!=null?e:u}function a(){var a=null;return function(b,c){var e=d("WAWebHandleOfflineAbProps").getOfflineDynamicBatchConfig(),f=e.version;e=e.multiplier;var g=a;a=b;switch(f){case"progressive":return y(b,g,c,e);default:return u}}}function z(a){return a>=d("WAWebHandleOfflineAbProps").getNonBlockingOfflineResumeMaxMessageCount()?!1:!0}f=new e();g.OfflineMessageHandlerImpl=e;g.OfflineMessageHandler=f}),98);
__d("WAWebCastToProtocolRevokedMsgData",["invariant","WAWebMsgType"],(function(a,b,c,d,e,f,g,h){function i(a){return a.type===d("WAWebMsgType").MSG_TYPE.PROTOCOL&&(a.subtype==="sender_revoke"||a.subtype==="admin_revoke")?a:null}function a(a){a=i(a);a!=null||h(0,77158);return a}g.castToProtocolRevokeMsgData=i;g.assertProtocolRevokeMsgData=a}),98);
__d("WAWebDBProcessGroupInviteMsgs",["WATimeUtils","WAWebApiGroupInviteV4Store","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("WAWebApiGroupInviteV4Store").persistGroupInviteV4Msgs(a.map(function(a){return{id:a.id.toString(),from:a.from.toString(),to:a.to.toString(),groupId:a.inviteGrp,expiration:parseInt(a.inviteCodeExp,10),expired:d("WATimeUtils").unixTime()>=parseInt(a.inviteCodeExp,10)}}))});return h.apply(this,arguments)}g.processGroupInviteMessages=a}),98);
__d("WAWebDBProcessPaymentMessages",["WAWebDBMsgUtils","WAWebModelStorageUtils","WAWebMsgType","WAWebProtobufsWeb.pb","WAWebSchemaMessage","WAWebUserPrefsMeUser","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){c=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.name="DuplicateMessageError",b)||babelHelpers.assertThisInitialized(c)}return b}(babelHelpers.wrapNativeSuper(Error));e=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.name="PreviousMsgNotPlaceholderError",b)||babelHelpers.assertThisInitialized(c)}return b}(babelHelpers.wrapNativeSuper(Error));function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=[],e=[],f=a.map(function(a){return a.paymentRequestMessageKey?a.paymentRequestMessageKey.toString():""}).filter(function(a){return a!==""}),g=a.filter(function(a){return a.subtype==="payment_action_request_declined"||a.subtype==="payment_transaction_request_cancelled"}).map(function(a){return a.id.toString()});return d("WAWebModelStorageUtils").getStorage().lock(["message"],function(){var h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){b[0];b=(yield d("WAWebDBMsgUtils").getMsgsByMsgKey(f.concat(g)));var h=new Map();b.forEach(function(a){a!=null&&h.set(a.id.toString(),a)});a.forEach(function(a){var b;b=(b=a.paymentRequestMessageKey)==null?void 0:b.toString();var f=h.get(b||"");if(f&&b!=null)if(a.subtype==="send"&&a.paymentTxnStatus!=null)c.push({id:b,paymentTxnStatus:a.paymentTxnStatus});else{var g=f.from.isGroup()?f.author:f.from;g=f.paymentMessageReceiverJid.equals(d("WAWebUserPrefsMeUser").getMeUser())?g:f.paymentMessageReceiverJid;a.subtype==="payment_action_request_declined"?c.push({id:b,paymentStatus:d("WAWebProtobufsWeb.pb").PaymentInfo$Status.REJECTED,paymentTxnStatus:d("WAWebProtobufsWeb.pb").PaymentInfo$TxnStatus.COLLECT_REJECTED}):a.subtype==="payment_transaction_request_cancelled"&&c.push({id:b,paymentStatus:d("WAWebProtobufsWeb.pb").PaymentInfo$Status.CANCELLED,paymentTxnStatus:d("WAWebProtobufsWeb.pb").PaymentInfo$TxnStatus.COLLECT_CANCELED});c.push({id:a.id.toString(),type:d("WAWebMsgType").MSG_TYPE.NOTIFICATION_TEMPLATE,templateParams:[g||"",f.paymentCurrency||"",String(f.paymentAmount1000)]})}else h.get(a.id.toString())&&!a.isMdHistoryMsg&&e.push(a.id.toString())});yield d("WAWebSchemaMessage").getMessageTable().bulkRemove(e);yield d("WAWebSchemaMessage").getMessageTable().bulkCreateOrMerge(c);return c});return function(a){return h.apply(this,arguments)}}())});return h.apply(this,arguments)}g.DuplicateMessageError=c;g.PreviousMsgNotPlaceholderError=e;g.processPaymentMessages=a}),98);
__d("WAWebDBProcessReactionsMsgs",["WAWebApiChat","WAWebBackendApi","WAWebDBCreateOrUpdateReactions","WAWebDBMarkFutureproofMessagesReparsed","WAWebLastAddOnDBSerialization","WAWebReactionsBEUtils","WAWebShouldUpdateLastAddOnPreview","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.length>0){var c=(yield d("WAWebReactionsBEUtils").createReactionsRowFromMsg(a));c=(yield d("WAWebDBCreateOrUpdateReactions").createOrUpdateReactions(c));d("WAWebReactionsBEUtils").updateHasReactionFromParent(c);a=a.map(function(a){return a.id.toString()});var e=b("WAWebDBMarkFutureproofMessagesReparsed");e=e.markFutureproofMessagesReparsed;yield e(a);e=(yield d("WAWebShouldUpdateLastAddOnPreview").filterChatsWithAddOnPreviewUpdates(c.map(function(a){return d("WAWebLastAddOnDBSerialization").lastAddOnPreviewCandidateFromReactionRowType(a)})));yield d("WAWebApiChat").bulkUpdateChatLastAddOnPreview(e);d("WAWebBackendApi").frontendFireAndForget("updateChatLastAddOnPreview",{chatMap:e})}});return h.apply(this,arguments)}g.processReactionMsgs=a}),98);
__d("WAWebDBProcessReplyMsgs",["WALogger","WANullthrows","WAWebDBMessageSerialization","WAWebDBMsgUtils","WAWebGroupType","WAWebMessageEditGatingUtils","WAWebMessageEditUtils","WAWebModelStorageUtils","WAWebMsgGetters","WAWebMsgKey","WAWebUserPrefsMeUser","asyncToGeneratorRuntime","lodash"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[reply-messages] updating reply messages with inconsistent quoted content"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[reply-messages] validating reply messages with editable quoted messages"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[reply-messages] found inconsistent quoted content"]);j=function(){return a};return a}function a(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(!d("WAWebMessageEditGatingUtils").processReplyMessagesEnabled()||!a.length)return;var e=(yield d("WAWebModelStorageUtils").getStorage().lock(["message"],function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){b=b[0];var e=new Set();a.forEach(function(a){e.add(l(a).toString())});var f=(yield d("WAWebDBMsgUtils").getMsgsByMsgKey(Array.from(e.values()))).filter(function(a){a=d("WAWebMessageEditUtils").getMsgEditType(a.type);if(!a)return!1;switch(a){case d("WAWebMessageEditUtils").MsgEditType.TextEdit:return d("WAWebMessageEditGatingUtils").receiveTextEditEnabled();case d("WAWebMessageEditUtils").MsgEditType.CaptionEdit:return d("WAWebMessageEditGatingUtils").receiveCaptionEditEnabled()}}),g=new Map(f.map(function(a){return[a.id.toString(),a]}));f=a.filter(function(a){return g.has(l(a).toString())});if(!f.length)return;d("WALogger").DEV(i()).devConsole({replyMsgIds:f.map(function(a){return a.id.id}),quotedMsgIds:f.map(function(a){return a.quotedStanzaID})});var j=[];f.forEach(function(a){var b=c("WANullthrows")(g.get(l(a).toString()));n(c("WANullthrows")(a.quotedMsg),b)&&j.push(babelHelpers["extends"]({},a,{quotedMsg:b}))});if(!j.length)return;d("WALogger").DEV(h()).devConsole({replyMsgIds:j.map(function(a){return a.id.id})});yield b.bulkCreateOrMerge(j.map(d("WAWebDBMessageSerialization").dbRowFromMessage));return j});return function(a){return e.apply(this,arguments)}}()));(e==null?void 0:e.length)&&e.forEach(function(b){var d=c("WANullthrows")(a.find(function(a){return a.id.equals(b.id)}));d.quotedMsg=b.quotedMsg})});return k.apply(this,arguments)}function l(a){var b,e;b=(b=a.quotedParticipant)!=null?b:void 0;e=(e=a.quotedRemoteJid)!=null?e:a.id.remote;return new(c("WAWebMsgKey"))({id:c("WANullthrows")(a.quotedStanzaID),fromMe:d("WAWebUserPrefsMeUser").isMeAccount(b),remote:e,participant:d("WAWebMsgGetters").getIsGroupMsg(a)||(b==null?void 0:b.isBot())?b:void 0})}var m={inviteGrpType:d("WAWebGroupType").GroupType.DEFAULT,thumbnail:"",body:"",caption:"",interactiveAnnotations:[],scanLengths:[],staticUrl:"",pageCount:0};function n(a,b){var e,f=(e=c("lodash")).pickBy(a,function(a){return a!=null}),g=e.pickBy(b,function(a,b){return Object.prototype.hasOwnProperty.call(f,b)});e.defaults(f,m);e.defaults(g,m);if(c("lodash").isEqual(f,g))return!1;d("WALogger").DEV(j()).devConsole({expected:g,received:f,quotedMsgContent:a,originalQuotedMsg:b});return!0}g.processReplyMsgs=a}),98);
__d("WAWebStoreMsgs",["WALogger","WASyncdOrphan","WAWebAddonGatingUtils","WAWebAddonProcessMsgs","WAWebAddonProcessMsgsUtils","WAWebApiOrphanRevoke","WAWebBackendApi","WAWebBizCoexGatingUtils","WAWebBotGating","WAWebCastToProtocolRevokedMsgData","WAWebCastToReactionMsg","WAWebCheckUpdateOrphanReactions","WAWebCommonMsgUtils","WAWebDBAddOnProviders","WAWebDBMessageBulkHelper","WAWebDBMessageSerialization","WAWebDBProcessEditProtocolMsgs","WAWebDBProcessGroupInviteMsgs","WAWebDBProcessPaymentMessages","WAWebDBProcessPollUpdateMsgs","WAWebDBProcessReactionsMsgs","WAWebDBProcessReplyMsgs","WAWebDBStoreRevokeMsgs","WAWebHandleForMessageRange","WAWebHandlePlaceholderWam","WAWebMsgGetters","WAWebMsgType","WAWebPersistedJobDefinitions","WAWebPersistedJobManager","WAWebPinMessageProcessor","WAWebPinMsgGatingUtils","WAWebSchemaMessage","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[store-msgs] [classify-msgs]: skip for "," duplicate messages, with id ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["storeMsgs: receive a protocol message with a type ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[store-msgs]: classifyMsgs got "," existing message(s)"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[store-msgs]: classifyMsgs got "," message(s)"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[store-msgs] Error: ",", message: ",", stack: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[store-msgs] Error: ",", message: ",", stack: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[store-msgs] done: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["storeMsgs: checkOrphanMutations failed during handleSingleMsg for: "," chat: "," Error: ",", message: ",", stack: ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[store-msgs] start: ",""]);p=function(){return a};return a}function q(a){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("WAWebSchemaMessage").getMessageTable().bulkRemove(a.map(function(a){return a.id.toString()}))});return r.apply(this,arguments)}function a(a){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.length===0)return;try{var b=(yield v(a)),e=Object.entries(b).map(function(a){var b=a[0];a=a[1];return Array.isArray(a)&&a.length>0&&b+": "+a.length}).filter(Boolean).join(", ");d("WALogger").LOG(p(),e);var f=b.newMsgs,g=b.replaceMsgs,h=b.revokeMsgs,i=b.paymentMsgs,j=b.reactionMsgs,k=b.groupInviteMsgs,r=b.chatsWithNewOfflineMsg,s=b.pollUpdateMsgs,w=b.removedPlaceholders,x=b.keepInChatMessages,y=b.editProtocolMsgs,z=b.replyMsgs,A=b.newsletterMsgs,B=b.pinMsgs,C=b.unifiedAddons,D=b.botInvokeSystemMsgs;b=b.replaceCommentMsgs;var E=(yield d("WAWebApiOrphanRevoke").applyOrphanRevokes(f));yield d("WAWebDBMessageBulkHelper").persistNewMessagesInBulk(E,r);yield d("WAWebDBMessageBulkHelper").persistNewNewsletterMessagesInBulk(A);yield d("WAWebSchemaMessage").getMessageTable().bulkCreateOrReplace(g);yield q(b);yield u(h);yield d("WAWebDBProcessPaymentMessages").processPaymentMessages(i);yield d("WAWebDBProcessReactionsMsgs").processReactionMsgs(j);yield d("WAWebDBProcessGroupInviteMsgs").processGroupInviteMessages(k);yield d("WAWebBackendApi").frontendSendAndReceive("processKeepInChatMessages",{keepInChatMessages:x,allowNotification:!1});yield d("WAWebDBProcessEditProtocolMsgs").processEditProtocolMsgs(y);yield d("WAWebDBProcessReplyMsgs").processReplyMsgs(z);yield d("WAWebDBProcessPollUpdateMsgs").processPollUpdateMsgs(s);d("WAWebPinMsgGatingUtils").isPinnedMessagesM1ReceiverEnabled()&&(yield d("WAWebPinMessageProcessor").groupAndProcessPinMessages(B));yield d("WAWebAddonProcessMsgs").processMsgs(C);yield d("WAWebHandleForMessageRange").handleOfflineForMessageRange(a);if(d("WAWebBotGating").isBotReceiveEnabled()&&D.length>0){var F=new Set();D.forEach(function(a){if(F.has(a.id.remote.toString()))return;F.add(a.id.remote.toString());void d("WAWebBackendApi").frontendFireAndForget("updateBotInvokeSystemMsgCreated",{chatId:a.id.remote})})}E=a.map(function(a){return a.id.toString()});try{yield d("WASyncdOrphan").checkOrphanMutations(E,r),yield d("WAWebCheckUpdateOrphanReactions").checkUpdateForOrphanReactions(E)}catch(b){d("WALogger").ERROR(o(),String(E.join(" ")),String(a[0].id.remote),b.name,b.message,b.stack).devConsole(b)}t(f,w);d("WALogger").LOG(n(),e)}catch(a){c("gkx")("26258")?d("WALogger").ERROR(m(),a.name,a.message,a.stack).sendLogs("storeMsgs-error",.01):d("WALogger").ERROR(l(),a.name,a.message,a.stack).devConsole(a).sendLogs("storeMsgs-error: "+a.message)}});return s.apply(this,arguments)}function t(a,b){a=a.filter(function(a){return d("WAWebCommonMsgUtils").isPlaceholderMsg(a.type)});a.length>0&&void d("WAWebHandlePlaceholderWam").addPlaceholderWam(a);b.length>0&&void d("WAWebHandlePlaceholderWam").populatePlaceholderWam(b)}function u(a){var c=[];a.forEach(function(a){a.protocolMessageKey&&c.push({revokeMsgKey:a.protocolMessageKey,newMsgKey:a.id,timestamp:a.t,subtype:a.subtype,sender:d("WAWebMsgGetters").getSender(a),revokeTimestamp:a.t,disappearingModeInitiator:a.disappearingModeInitiator,ephemeralDuration:a.ephemeralDuration,ephemeralSettingTimestamp:a.ephemeralSettingTimestamp})});return d("WAWebDBStoreRevokeMsgs").processRevokeMsgs(c).then(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(c.length>0){var e=[],f=new Set();c.forEach(function(a){e.push(a.revokeMsgKey.toString());a=a.revokeMsgKey.remote.toString();f.add(a)});var g=b("WAWebPersistedJobManager").getJobManager;yield g().waitUntilPersisted(d("WAWebPersistedJobDefinitions").jobSerializers.deleteAddOns(Array.from(f.values()).join(","),e))}return a});return function(b){return a.apply(this,arguments)}}())}function v(a){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WALogger").DEV(k(),a.length);var b=(yield d("WAWebSchemaMessage").getMessageTable().bulkGet(a.map(function(a){return String(a.id)}),!1));d("WALogger").DEV(j(),b.filter(function(a){return a!=null}).length);var c=[],e=[],f=[],g=[],l=[],m=[],n=[],o=[],p=[],q=[],r=[],s=[],t=[],u=new Set(),v=new Map(),w=new Map(),z=[],A=[];a.forEach(function(a,h){var j=a,k=String(a.id);h=b[h];if(h!=null&&y(a,h)){if(a.type===d("WAWebMsgType").MSG_TYPE.COMMENT){var B=d("WAWebAddonProcessMsgsUtils").castToAddonMsgData(j);d("WAWebAddonGatingUtils").isUnifiedInfraEnabledForType(a.type)&&B!=null&&t.push(B);A.push(a)}else{B=d("WAWebDBMessageSerialization").dbRowFromMessage(j);B.t=h.t;B.internalId=h.internalId;B.rowId=h.rowId;B.pendingReadReceipt=h.pendingReadReceipt;d("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()&&h.placeholderCreatedWhenAccountIsHosted!==!0&&B.senderOrRecipientAccountTypeHosted===!0&&(B.hostedBizEncStateMismatch=!0);e.push(B)}d("WAWebCommonMsgUtils").isPlaceholderMsg(h.type)&&w.set(k,j)}else if(h&&!(d("WAWebCommonMsgUtils").isFutureproofMsg(h.type)&&x(a)))c.push(a.id.id);else{B=v.get(k);h=B&&!d("WAWebCommonMsgUtils").isPlaceholderMsg(B.type);if(h)c.push(a.id.id);else{a.type===d("WAWebMsgType").MSG_TYPE.NOTIFICATION_TEMPLATE&&a.subtype==="bot_invoke_disclaimer"&&z.push(j);if(d("WAWebMsgGetters").getIsNewsletterMsg(a)&&a.type!==d("WAWebMsgType").MSG_TYPE.PROTOCOL&&a.subtype!=="admin_revoke")r.push(j);else if(d("WAWebAddonGatingUtils").isUnifiedInfraEnabledForType(a.type)&&d("WAWebAddonProcessMsgsUtils").castToAddonMsgData(j)!=null){B=d("WAWebAddonProcessMsgsUtils").castToAddonMsgData(j);B!=null&&t.push(B)}else a.type===d("WAWebMsgType").MSG_TYPE.KEEP_IN_CHAT?n.push(j):d("WAWebCastToReactionMsg").castToReactionMsgData(j)!=null?g.push(d("WAWebCastToReactionMsg").assertReactionMsgData(j)):a.kind===d("WAWebMsgType").MsgKind.PollVoteEncrypted?m.push(a):a.type===d("WAWebMsgType").MSG_TYPE.PIN_MESSAGE?s.push(j):d("WAWebCastToProtocolRevokedMsgData").castToProtocolRevokeMsgData(j)?f.push(d("WAWebCastToProtocolRevokedMsgData").assertProtocolRevokeMsgData(j)):["sender_revoke","admin_revoke"].includes(a.subtype)?(f.push(a),d("WALogger").ERROR(i(),a.type).tags("messaging").sendLogs("storeMsgs-protocol",.01)):a.type===d("WAWebMsgType").MSG_TYPE.PAYMENT&&a.subtype==="send"||a.subtype==="payment_action_request_declined"||a.subtype==="payment_transaction_request_cancelled"?(l.push(j),v.set(k,j),u.add(String(a.id.remote))):a.type===d("WAWebMsgType").MSG_TYPE.GROUPS_V4_INVITE?(o.push(j),v.set(k,j),u.add(String(a.id.remote))):a.type===d("WAWebMsgType").MSG_TYPE.PROTOCOL&&a.subtype==="message_edit"?p.push(j):a.quotedMsg?(q.push(j),v.set(k,j),u.add(String(a.id.remote))):a.type!==d("WAWebMsgType").MSG_TYPE.PROTOCOL&&(v.set(k,j),u.add(String(a.id.remote)))}}});c.length>0&&d("WALogger").LOG(h(),c.length,c);return{newMsgs:Array.from(v.values()),chatsWithNewOfflineMsg:Array.from(u),removedPlaceholders:Array.from(w.values()),replaceMsgs:e,revokeMsgs:f,paymentMsgs:l,reactionMsgs:g,pollUpdateMsgs:m,keepInChatMessages:n,groupInviteMsgs:o,editProtocolMsgs:p,replyMsgs:q,newsletterMsgs:r,pinMsgs:s,unifiedAddons:t,botInvokeSystemMsgs:z,replaceCommentMsgs:A}});return w.apply(this,arguments)}function x(a){if(d("WAWebAddonGatingUtils").isUnifiedInfraEnabledForType(a.type))return!0;var c=b("WAWebDBAddOnProviders");c=c.getAddOnProviderForMsg;return Boolean(c(a))}function y(a,b){return d("WAWebCommonMsgUtils").isPlaceholderMsg(b.type)&&!d("WAWebCommonMsgUtils").isPlaceholderMsg(a.type)||d("WAWebCommonMsgUtils").isFutureproofMsg(b.type)&&!d("WAWebCommonMsgUtils").isFutureproofMsg(a.type)&&!x(a)}g.storeMsgs=a;g.classifyMsgs=v}),98);
__d("WAWebGroupConstants",[],(function(a,b,c,d,e,f){a={ANNOUNCEMENT:"announcement",RESTRICT:"restrict",NO_FREQUENTLY_FORWARDED:"no_frequently_forwarded",EPHEMERAL:"ephemeral",MEMBERSHIP_APPROVAL_MODE:"membership_approval_mode",REPORT_TO_ADMIN_MODE:"report_to_admin_mode",ALLOW_NON_ADMIN_SUB_GROUP_CREATION:"allow_non_admin_sub_group_creation",MEMBER_ADD_MODE:"member_add_mode"};b=60;f.GROUP_SETTING_TYPE=a;f.PAST_PARTICIPANT_EXPIRATION_DAYS=b}),66);
__d("WAWebApiParticipantStore",["WALogger","WATimeUtils","WAWebBackendApi","WAWebGroupConstants","WAWebModelStorageUtils","WAWebSchemaParticipant","WAWebUserPrefsMeUser","WAWebWamGroupMetricCache","WAWebWidFactory","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["getGroupSenderKeyList: missed "," sender key(s) for primary devices"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["getGroupSenderKeyList: include "," because its primary doesn't have sender key"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["pruneExpiredPastParticipants: Pruning expired past participants from participant DB"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["markForgetSenderKey: group participant info missing for group ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["markHasSenderKey: group participant info missing for group ",""]);l=function(){return a};return a}var m=function(b){babelHelpers.inheritsLoose(a,b);function a(){var a,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(a=c=b.call.apply(b,[this].concat(e))||this,c.name="GroupUnSyncedError",a)||babelHelpers.assertThisInitialized(c)}return a}(babelHelpers.wrapNativeSuper(Error));function a(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.toString();b=(yield d("WAWebSchemaParticipant").getParticipantTable().get(b));return o(a,b)});return n.apply(this,arguments)}function o(a,b){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e=[],f=[];if(!b)return{skDistribList:e,skList:f,rotateKey:!1};var g=b.senderKey,j=b.rotateKey,k=0;g.forEach(function(a,b){var c=d("WAWebWidFactory").createWid(b),h=d("WAWebWidFactory").toUserWid(c);h=(h=g.get(h.toString()))!=null?h:!1;a&&h?f.push(c):(e.push(c),c.isCompanion()&&a&&!h&&(d("WALogger").WARN(i(),b),k++))});c("gkx")("26258")||k>0&&d("WALogger").WARN(h(),k).sendLogs("missing-sender-key-on-primary");yield r(a,g.size);d("WAWebWamGroupMetricCache").cacheGroupMetrics(b);return j?{skDistribList:[].concat(e,f),skList:[],rotateKey:j}:{skDistribList:e,skList:f,rotateKey:j}});return p.apply(this,arguments)}function e(a,c){var e=a.toString();return d("WAWebModelStorageUtils").getStorage().lock(["participant"],function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a[0];var b=(yield a.get(e));if(!b){d("WALogger").LOG(l(),e);return}yield a.createOrReplace(q(b,c,!0))});return function(b){return a.apply(this,arguments)}}())}function f(a,c){var e=a.toString();return d("WAWebModelStorageUtils").getStorage().lock(["participant"],function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a[0];var b=(yield a.get(e));if(!b){d("WALogger").LOG(k(),e);return}yield a.createOrReplace(q(b,c,!1))});return function(b){return a.apply(this,arguments)}}())}function q(a,b,c){var e=new Map(a.senderKey),f=!1;b.forEach(function(a){if(d("WAWebUserPrefsMeUser").isMeDevice(a))return;var b=String(a);e.has(b)?e.set(b,c):a.isLid()||(f=!0)});return{groupId:a.groupId,senderKey:e,participants:a.participants,pastParticipants:a.pastParticipants,admins:a.admins,rotateKey:f,deviceSyncComplete:a.deviceSyncComplete}}function r(a,b){return d("WAWebBackendApi").frontendSendAndReceive("updateCachedDeviceCount",{groupWid:a,deviceCount:b})}function s(a){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.map(function(a){return a.id.toString()}),c=(yield d("WAWebSchemaParticipant").getParticipantTable().bulkGet(b));b=a.map(function(a,b){return babelHelpers["extends"]({},a,{pastParticipants:(a=c[b])==null?void 0:(b=a.pastParticipants)==null?void 0:b.map(function(a){var b=a.jid,c=a.leaveTs;a=a.leaveReason;return{id:d("WAWebWidFactory").createWid(b),leaveTs:c,leaveReason:a}})})});return b});return t.apply(this,arguments)}function u(){return d("WAWebModelStorageUtils").getStorage().lock(["participant"],function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a[0];var b=(yield d("WAWebSchemaParticipant").getParticipantTable().all()),c=[],e=d("WATimeUtils").DAY_SECONDS*d("WAWebGroupConstants").PAST_PARTICIPANT_EXPIRATION_DAYS;b.forEach(function(a){var b=a.pastParticipants.filter(function(a){a=d("WATimeUtils").castToUnixTime(a.leaveTs);a=d("WATimeUtils").happenedWithin(a,e);return a});if(b.length!==a.pastParticipants.length){a=babelHelpers["extends"]({},a,{pastParticipants:b});c.push(a)}});c.length>0&&d("WALogger").DEV(j());return a.bulkCreateOrReplace(c)});return function(b){return a.apply(this,arguments)}}())}var v=new Map();function w(a,b){v.set(a,b)}function x(a){a!=null?v["delete"](a):v.clear()}function y(a){return z.apply(this,arguments)}function z(){z=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=v.get(a);if(b==null){var c=(yield d("WAWebSchemaParticipant").getParticipantTable().get(a));c=!!c&&c.admins.includes((c=d("WAWebUserPrefsMeUser").getMaybeMeUser())==null?void 0:c.toString());v.set(a,c);return c}return b});return z.apply(this,arguments)}g.GroupUnSyncedError=m;g.getGroupSenderKeyList=a;g.getGroupSenderKeyListFromParticipantRecord=o;g.markHasSenderKey=e;g.markForgetSenderKey=f;g.injectPastParticipantsFromDB=s;g.pruneExpiredPastParticipants=u;g.setAdminshipCache=w;g.clearAdminshipCache=x;g.isCurrentUserGroupAdmin=y}),98);
__d("WAWebChatConstants",["$InternalEnum"],(function(a,b,c,d,e,f){a=b("$InternalEnum")({COMPLETE_BUT_MORE_MESSAGES_REMAIN_ON_PRIMARY:0,COMPLETE_AND_NO_MORE_MESSAGE_REMAIN_ON_PRIMARY:1,INCOMPLETE:2,NOT_INCLUDED_IN_HIST_SYNC:3,COMPLETE_ON_DEMAND_SYNC_BUT_MORE_MSG_REMAIN_ON_PRIMARY:4});c=60*5*1e3;f.ConversationEndOfHistoryTransferModelPropType=a;f.FTS_TTL=c}),66);
__d("WAWebUpdateLidMetadataApi",["WAWebApiContact","WAWebBackendApi","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.updates;var b=a.map(function(a){var b=a.lid;a=a.data;return{lid:d("WAWebWidFactory").toUserWid(b),shareOwnPn:(b=a.shareOwnPn)!=null?b:null,displayNameLID:(b=a.displayNameLID)!=null?b:null,requestedPnTimestamp:(b=a.requestedPnTimestamp)!=null?b:null,username:(b=a.username)!=null?b:null}});yield d("WAWebBackendApi").frontendSendAndReceive("bulkUpdateLidContactState",{lidContactDataMappings:b});yield d("WAWebApiContact").updateLidMetadata(a)});return h.apply(this,arguments)}function c(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.mappings;a=a.flushImmediately;var c=b.map(function(a){var b=a.lid;a=a.pn;return{lid:b.toString(),phoneNumber:a.toString()}});yield d("WAWebBackendApi").frontendSendAndReceive("bulkUpdatePhoneNumberJids",{lidPhoneNumberMappings:c});yield d("WAWebApiContact").createLidPnMappings({mappings:b,flushImmediately:a})});return i.apply(this,arguments)}g.updateLidMetadata=a;g.createLidPnMappings=c}),98);
__d("WAWebCreateOrReplaceDisplayNamesAndLidPnMappingsJob",["Promise","WAWebUpdateLidMetadataApi","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function a(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){var e=[],f=[];for(a of a){if(a==null)continue;var g=a.id,i=a.displayName,j=a.lid,k=a.phoneNumber;g.isLid()?j=g:k=g;if(j==null)continue;j=d("WAWebWidFactory").toUserWid(j);i!=null&&e.push({lid:j,data:{displayNameLID:i}});k!=null&&f.push({lid:j,pn:d("WAWebWidFactory").toUserWid(k)})}yield (h||(h=b("Promise"))).all([e.length>0?d("WAWebUpdateLidMetadataApi").updateLidMetadata({updates:e}):null,f.length>0?d("WAWebUpdateLidMetadataApi").createLidPnMappings({mappings:f,flushImmediately:c}):null].filter(Boolean))});return i.apply(this,arguments)}g.createOrReplaceDisplayNamesAndLidPnMappings=a}),98);
__d("WAWebDBParticipantTypes",[],(function(a,b,c,d,e,f,g){a=Object.freeze({ADD:"add",REMOVE:"remove",DEMOTE:"demote",PROMOTE:"promote",LINKED_GROUP_PROMOTE:"linked_group_promote",LINKED_GROUP_DEMOTE:"linked_group_demote"});b=Object.freeze({DEVICE:"device",PARTICIPANT:"participant"});c=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.name="GroupUnSyncedError",b)||babelHelpers.assertThisInitialized(c)}return b}(babelHelpers.wrapNativeSuper(Error));g.PARTICIPANT_OPERATION=a;g.STALE_TYPES=b;g.GroupUnSyncedError=c}),98);
__d("WAWebLeaveReasonType",["$InternalEnum"],(function(a,b,c,d,e,f){a=b("$InternalEnum").Mirrored(["Left","Removed"]);f.LeaveReason=a}),66);
__d("WAWebPnhCagIncognito",["WAWebApiContact"],(function(a,b,c,d,e,f,g){function a(a){var b=a.participants.iAmAdmin();a=a.participants.toArray();var c=[],e=[];if(b)for(var b=a,f=Array.isArray(b),g=0,b=f?b:b[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var h;if(f){if(g>=b.length)break;h=b[g++]}else{g=b.next();if(g.done)break;h=g.value}h=h;c.push(h.id);e.push(d("WAWebApiContact").getCurrentLid(h.id))}else for(h=a,g=Array.isArray(h),f=0,h=g?h:h[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){if(g){if(f>=h.length)break;b=h[f++]}else{f=h.next();if(f.done)break;b=f.value}a=b;a.id.isLid()?c.push(a.id):e.push(d("WAWebApiContact").getCurrentLid(a.id))}return[].concat(c,e).filter(Boolean)}function b(a,b){var c=[];if(a){for(a=0;a<b.length;a++){var d=b[a];c.push(d.id);d.lid&&c.push(d.lid)}return c}for(d=0;d<b.length;d++){a=b[d];a.id.isLid()?c.push(a.id):a.lid&&c.push(a.lid)}return c}g.augmentedCagGroupMetadataParticipantList=a;g.augmentedCagGroupParticipantList=b}),98);
__d("WAWebWamEnumMessageChatType",[],(function(a,b,c,d,e,f){a=Object.freeze({OTHER:0,INDIVIDUAL:1,GROUP:2,STATUS:3,BROADCAST:4,CHANNEL:5});f.MESSAGE_CHAT_TYPE=a}),66);
__d("WAWebGetMessageChatTypeFromWid",["WAWebWamEnumMessageChatType"],(function(a,b,c,d,e,f,g){function a(a){if(a.isUser())return d("WAWebWamEnumMessageChatType").MESSAGE_CHAT_TYPE.INDIVIDUAL;if(a.isGroup())return d("WAWebWamEnumMessageChatType").MESSAGE_CHAT_TYPE.GROUP;if(a.isBroadcast())return d("WAWebWamEnumMessageChatType").MESSAGE_CHAT_TYPE.BROADCAST;if(a.isStatusV3())return d("WAWebWamEnumMessageChatType").MESSAGE_CHAT_TYPE.STATUS;return a.isNewsletter()?d("WAWebWamEnumMessageChatType").MESSAGE_CHAT_TYPE.CHANNEL:d("WAWebWamEnumMessageChatType").MESSAGE_CHAT_TYPE.OTHER}g.getMessageChatTypeFromWid=a}),98);
__d("WAWebWamEnumExpiryReason",[],(function(a,b,c,d,e,f){a=Object.freeze({USER_LEAVE:1,DEVICE_UNPAIR:2,IDENTITY_CHANGE:3,AUDIENCE_CHANGE:4,PERIODIC_ROTATION:5,KEY_CORRUPTION:6,PEER_COMPANION_UNPAIR:7,OTHER_DEVICE_UNPAIR:8});f.EXPIRY_REASON=a}),66);
__d("WAWebSenderKeyExpiredWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumExpiryReason","WAWebWamEnumMessageChatType","WAWebWamEnumSizeBucket"],(function(a,b,c,d,e,f,g){a=d("WAWebWamCodegenUtils").defineEvents({SenderKeyExpired:[3130,{chatType:[1,d("WAWebWamEnumMessageChatType").MESSAGE_CHAT_TYPE],deviceSizeBucket:[2,d("WAWebWamEnumSizeBucket").SIZE_BUCKET],expiryReason:[3,d("WAWebWamEnumExpiryReason").EXPIRY_REASON]},[1,1,1],"regular"]});g.SenderKeyExpiredWamEvent=a}),98);
__d("WAWebPostSenderKeyExpiredMetric",["WAWebGetMessageChatTypeFromWid","WAWebSenderKeyExpiredWamEvent","WAWebWamNumberToSizeBucket","WAWebWidFactory"],(function(a,b,c,d,e,f,g){function a(a){var b=a.chatId,e=a.expiryReason;a=a.deviceCount;var f=new(d("WAWebSenderKeyExpiredWamEvent").SenderKeyExpiredWamEvent)();e!=null&&(f.expiryReason=e);if(b!=null){e=d("WAWebWidFactory").createWidFromWidLike(b);f.chatType=d("WAWebGetMessageChatTypeFromWid").getMessageChatTypeFromWid(e)}a!=null&&a>0&&(f.deviceSizeBucket=c("WAWebWamNumberToSizeBucket")(a));f.commit()}g.postSenderKeyExpiredMetric=a}),98);
__d("WAWebDBGroupParticipant",["WABatcher","WALogger","WAWebDBParticipantTypes","WAWebGroupType","WAWebLeaveReasonType","WAWebModelStorageUtils","WAWebPnhCagIncognito","WAWebPostSenderKeyExpiredMetric","WAWebSchemaParticipant","WAWebUserPrefsMeUser","WAWebWamEnumExpiryReason","WAWebWamGroupMetricCache","WAWebWidFactory","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["updateCommunityParticipantsBatched: failed with unknown action ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["updateCommunityParticipantsBatched: no local record found for group ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["updateCommunityParticipantsBatched: aggregating "," changes"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["updateParticipants: failed with unknown action ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["updateParticipantsBatched: no local record found for group ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["updateParticipantsBatched: aggregating "," changes"]);m=function(){return a};return a}var n=3e3;function a(a){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.groupInfos;var b=(yield d("WAWebSchemaParticipant").getParticipantTable().bulkGet(a.map(function(a){return a.id.toString()}))),c=new Map();b.forEach(function(a){return a&&c.set(a.groupId,a.senderKey)});b=a.map(function(a){var b,e=[],f=[],g=a.id.toString(),h=c.get(g)||new Map();(b=a.participants)==null?void 0:b.forEach(function(a){a.isAdmin&&f.push(a.id),e.push(a.id)});b=(b=(b=a.pastParticipants)==null?void 0:b.map(function(a){var b=a.id,c=a.leaveTs;a=a.leaveReason;return{jid:b.toString(),leaveTs:c,leaveReason:a}}))!=null?b:[];var i=Boolean(a.incognito)&&Boolean(a.defaultSubgroup);if(i){i=f.some(function(a){return d("WAWebUserPrefsMeUser").isMeAccount(a)});i=d("WAWebPnhCagIncognito").augmentedCagGroupParticipantList(i,a.participants);i.forEach(function(a){a=String(a);h.has(a)||h.set(a,!1)})}else{(i=a.participants)==null?void 0:i.forEach(function(a){h.set(String(a.id),!1)})}return{groupId:g,participants:e.map(String),pastParticipants:b,admins:f.map(String),senderKey:h,rotateKey:!1,staleType:d("WAWebDBParticipantTypes").STALE_TYPES.DEVICE}});return d("WAWebSchemaParticipant").getParticipantTable().bulkCreateOrReplace(b)});return o.apply(this,arguments)}function e(a){var c=a.group,e=a.participants,f=a.admins,g=a.deviceIds;a=a.groupInfo;var h=!1;a!=null&&(h=Boolean(a.incognito)&&Boolean(a.defaultSubgroup));var i=c.toString();return d("WAWebModelStorageUtils").getStorage().lock(["participant"],function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a[0];var b=(yield a.get(i));if(!b)return a.create(B(i,{participants:e,admins:f,deviceIds:g}));yield a.createOrReplace(h?D(b,{participants:e,admins:f,deviceIds:g}):C(b,{participants:e,admins:f,deviceIds:g}))});return function(b){return a.apply(this,arguments)}}())}function f(a){return d("WAWebModelStorageUtils").getStorage().lock(["participant"],function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){b=b[0];var c=(yield b.bulkGet(a.map(function(a){return a.groupId}))),d=a.map(function(a,b){var d=a.groupId;a=a.pastParticipants;b=c[b];return!b?B(d,{pastParticipants:a}):v(b,a)});return b.bulkCreateOrReplace(d)});return function(a){return c.apply(this,arguments)}}())}var p=function(){return d("WABatcher").batch({delayMs:n},function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WALogger").DEV(m(),a.length).devConsole(a);var c=Array.from(new Set(a.map(function(a){return a.id})));yield d("WAWebModelStorageUtils").getStorage().lock(["participant"],function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){b=b[0];var e=new Map((yield b.bulkGet(c)).filter(Boolean).map(function(a){return[a.groupId,a]}));a.forEach(function(a){var b=a.id,c=a.data;a=a.groupMetadata;a=Boolean(a==null?void 0:a.defaultSubgroup)&&Boolean(a==null?void 0:a.incognito);var f=e.get(b);if(!f){d("WALogger").LOG(l(),b);return}b=c.participants;var g=null;switch(c.action){case d("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.ADD:g=a?u(f,b,c.deviceIds):t(f,b,c.deviceIds);break;case d("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.REMOVE:g=a?x(f,b,c.timestamp,c.author,c.reason):w(f,b,c.timestamp,c.author,c.reason);break;case d("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.DEMOTE:g=a?z(f,b,c.deviceIds,d("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.DEMOTE):y(f,b,c.deviceIds,d("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.DEMOTE);break;case d("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.PROMOTE:g=a?z(f,b,c.deviceIds,d("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.PROMOTE):y(f,b,c.deviceIds,d("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.PROMOTE);break;default:d("WALogger").LOG(k(),c.action)}g!=null&&e.set(g.groupId,g)});return b.bulkCreateOrReplace(Array.from(e.values()))});return function(a){return e.apply(this,arguments)}}());return a.map(function(a){return void 0})});return function(b){return a.apply(this,arguments)}}())}(),q=function(){return d("WABatcher").batch({delayMs:n},function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WALogger").DEV(j(),a.length).devConsole(a);var c=Array.from(new Set(a.map(function(a){return a.id})));yield d("WAWebModelStorageUtils").getStorage().lock(["participant"],function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){b=b[0];var e=new Map((yield b.bulkGet(c)).filter(Boolean).map(function(a){return[a.groupId,a]}));a.forEach(function(a){var b=a.id;a=a.data;var c=e.get(b);if(!c){d("WALogger").LOG(i(),b);return}b=a.participants;var f=null;switch(a.action){case d("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.LINKED_GROUP_PROMOTE:f=A(c,b,d("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.LINKED_GROUP_PROMOTE);break;case d("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.LINKED_GROUP_DEMOTE:f=A(c,b,d("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.LINKED_GROUP_DEMOTE);break;default:d("WALogger").LOG(h(),a.action)}f!=null&&e.set(f.groupId,f)});return b.bulkCreateOrReplace(Array.from(e.values()))});return function(a){return e.apply(this,arguments)}}());return a.map(function(a){return void 0})});return function(b){return a.apply(this,arguments)}}())}();function r(a,e,f){f===void 0&&(f=!1);if(f)return q({id:String(a),data:e});var g=e.participants,h=a.toString();return d("WAWebModelStorageUtils").getStorage().lock(["participant"],function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a[0];var b=(yield a.get(h));if(!b)throw new(d("WAWebDBParticipantTypes").GroupUnSyncedError)("updateCommunityParticipants: group participant info missing for action "+e.action);switch(e.action){case d("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.LINKED_GROUP_PROMOTE:return a.createOrReplace(A(b,g,d("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.LINKED_GROUP_PROMOTE));case d("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.LINKED_GROUP_DEMOTE:return a.createOrReplace(A(b,g,d("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.LINKED_GROUP_DEMOTE));default:throw c("err")("updateCommunityParticipants: failed with unknown action "+e.action)}});return function(b){return a.apply(this,arguments)}}())}function s(a,e,f,g){g===void 0&&(g=!1);var h=Boolean(f==null?void 0:f.defaultSubgroup)&&Boolean(f==null?void 0:f.incognito);if(g)return p({id:String(a),data:e,groupMetadata:f});var i=e.participants,j=a.toString();return d("WAWebModelStorageUtils").getStorage().lock(["participant"],function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a[0];var b=(yield a.get(j));if(!b)throw new(d("WAWebDBParticipantTypes").GroupUnSyncedError)("updateParticipants: group participant info missing for action "+e.action);switch(e.action){case d("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.ADD:return a.createOrReplace(h?u(b,i,e.deviceIds):t(b,i,e.deviceIds));case d("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.REMOVE:return a.createOrReplace(h?x(b,i,e.timestamp,e.author,e.reason):w(b,i,e.timestamp,e.author,e.reason));case d("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.DEMOTE:return a.createOrReplace(h?z(b,i,e.deviceIds,d("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.DEMOTE):y(b,i,e.deviceIds,d("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.DEMOTE));case d("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.PROMOTE:return a.createOrReplace(h?z(b,i,e.deviceIds,d("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.PROMOTE):y(b,i,e.deviceIds,d("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.PROMOTE));default:throw c("err")("updateParticipants: failed with unknown action "+e.action)}});return function(b){return a.apply(this,arguments)}}())}function t(a,b,c){var e=new Map(a.senderKey);c.forEach(function(a){if(d("WAWebUserPrefsMeUser").isMeDevice(a))return;if(a.isHosted())return;a=String(a);e.set(a,!1)});var f=new Set();for(c of b){b=c.id;f.add(String(b))}b=(c=(b=a.pastParticipants)==null?void 0:b.filter(function(a){return!f.has(a.jid)}))!=null?c:[];c=a.participants;for(var g of f.values())c.push(g);return{groupId:a.groupId,senderKey:e,participants:c,pastParticipants:b,admins:a.admins,rotateKey:a.rotateKey,staleType:a.staleType}}function u(a,b,c){var e=new Map(a.senderKey);c.forEach(function(a){if(d("WAWebUserPrefsMeUser").isMeDevice(a))return;if(a.isHosted())return;a=String(a);e.set(a,!1)});var f=new Set(),g=new Set();for(c of b){b=c.id;var h=c.lid;g.add(String(b));h!=null&&!b.isLid()&&f.add(String(h))}c=(h=(b=a.pastParticipants)==null?void 0:b.filter(function(a){return!g.has(a.jid)}))!=null?h:[];b=a.participants.filter(function(a){return!f.has(a)});for(h of g.values())b.push(h);return{groupId:a.groupId,senderKey:e,participants:b,pastParticipants:c,admins:a.admins,rotateKey:a.rotateKey,staleType:a.staleType}}function v(a,b){return{groupId:a.groupId,senderKey:a.senderKey,participants:a.participants,pastParticipants:b.map(function(a){var b=a.id,c=a.leaveReason;a=a.leaveTs;return{jid:b.toString(),leaveTs:a,leaveReason:c}}),admins:a.admins,rotateKey:a.rotateKey,staleType:a.staleType}}function w(a,b,c,e,f){var g=new Map(a.senderKey),h=a.rotateKey;g.forEach(function(a,c){var e=d("WAWebWidFactory").createWid(c),f=b.some(function(a){return a.id.isSameAccount(e)});f&&(h=h||a,g["delete"](c))});h&&g.forEach(function(a,b){g.set(b,!1)});var i=b.map(function(a){a=a.id;return String(a)});f=(f=a.pastParticipants)==null?void 0:f.concat((f=b.map(function(a){return{jid:a.id.toString(),leaveTs:c,leaveReason:a.id.equals(e)?d("WAWebLeaveReasonType").LeaveReason.Left:d("WAWebLeaveReasonType").LeaveReason.Removed}}))!=null?f:[]);!a.rotateKey&&h&&d("WAWebPostSenderKeyExpiredMetric").postSenderKeyExpiredMetric({chatId:a.groupId,deviceCount:a.senderKey.size,expiryReason:d("WAWebWamEnumExpiryReason").EXPIRY_REASON.USER_LEAVE});var j=a.admins.filter(function(a){return!i.includes(a)}),k=a.participants.filter(function(a){return!i.includes(a)});return{groupId:a.groupId,senderKey:g,participants:k,pastParticipants:f,admins:j,rotateKey:h,staleType:a.staleType}}function x(a,b,c,e,f){var g,h=new Map(a.senderKey),i=a.rotateKey,j=b.map(function(a){return a.id.isLid()?a.id:a.lid}).filter(Boolean);h.forEach(function(a,c){var e=d("WAWebWidFactory").createWid(c);if(e.isLid()&&f!==d("WAWebGroupType").REMOVE_REASON.DEFAULT_SUBGROUP_DEMOTE){var g=j.some(function(a){return a.isSameAccount(e)});g&&h["delete"](c);return}if(!e.isLid()&&f===d("WAWebGroupType").REMOVE_REASON.DEFAULT_SUBGROUP_DEMOTE){h["delete"](c);return}g=b.some(function(a){return a.id.user===e.user&&a.id.server===e.server});g&&(i=i||a,h["delete"](c))});i&&h.forEach(function(a,b){a=d("WAWebWidFactory").createWid(b);a.isLid()||h.set(b,!1)});var k=b.map(function(a){a=a.id;return String(a)});g=(g=a.pastParticipants)==null?void 0:g.concat((g=b.map(function(a){return{jid:a.id.toString(),leaveTs:c,leaveReason:a.id.equals(e)?d("WAWebLeaveReasonType").LeaveReason.Left:d("WAWebLeaveReasonType").LeaveReason.Removed}}))!=null?g:[]);!a.rotateKey&&i&&d("WAWebPostSenderKeyExpiredMetric").postSenderKeyExpiredMetric({chatId:a.groupId,deviceCount:a.senderKey.size,expiryReason:d("WAWebWamEnumExpiryReason").EXPIRY_REASON.USER_LEAVE});var l=a.admins.filter(function(a){return!k.includes(a)}),m=a.participants;if(f===d("WAWebGroupType").REMOVE_REASON.DEFAULT_SUBGROUP_DEMOTE){var n=b.reduce(function(a,b){var c=b.lid;b=b.id;return c==null||b.isLid()?a:a.set(b.toString(),c.toString())},new Map());m=m.map(function(a){var b;return(b=n.get(a))!=null?b:a})}else m=m.filter(function(a){return!k.includes(a)});return{groupId:a.groupId,senderKey:h,participants:m,pastParticipants:g,admins:l,rotateKey:i,staleType:a.staleType}}function y(a,b,c,e){c=a.admins;var f=b.map(function(a){a=a.id;return String(a)});if(e===d("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.DEMOTE)c=a.admins.filter(function(a){return!f.includes(a)});else if(e===d("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.PROMOTE){var g=new Set(a.admins);f.forEach(function(a){return g.add(a)});c=Array.from(g)}return{groupId:a.groupId,senderKey:a.senderKey,participants:a.participants,pastParticipants:a.pastParticipants,admins:c,rotateKey:a.rotateKey,staleType:a.staleType}}function z(a,b,c,e){var f=a.admins,g=b.map(function(a){a=a.id;return String(a)}),h=new Map(a.senderKey);c!=null&&c.length>0&&c.forEach(function(a){if(d("WAWebUserPrefsMeUser").isMeDevice(a))return;if(a.isHosted())return;a=String(a);h.set(a,!1)});c=a.participants;if(e===d("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.DEMOTE){f=a.admins.filter(function(a){return!g.includes(a)});var i=f.some(function(a){return d("WAWebUserPrefsMeUser").isMeAccount(d("WAWebWidFactory").createWid(a))});if(!i){var j=b.reduce(function(a,b){var c=b.lid;b=b.id;return c==null||b.isLid()?a:a.set(b.toString(),c.toString())},new Map());c=c.map(function(a){var b;return(b=j.get(a))!=null?b:a})}}else if(e===d("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.PROMOTE){var k=b.reduce(function(a,b){var c=b.lid;b=b.id;return c==null||b.isLid()?a:a.set(c.toString(),b.toString())},new Map());f=a.admins.concat(g);c=c.map(function(a){var b;return(b=k.get(a))!=null?b:a})}return{groupId:a.groupId,senderKey:h,participants:c,pastParticipants:a.pastParticipants,admins:f,rotateKey:a.rotateKey,staleType:a.staleType}}function A(a,b,c){var e=a.admins,f=a.participants,g=b.map(function(a){a=a.id;return String(a)});if(c===d("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.LINKED_GROUP_DEMOTE)e=a.admins.filter(function(a){return!g.includes(a)}),f=e;else if(c===d("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.LINKED_GROUP_PROMOTE){b=g.filter(function(b){return!a.admins.includes(b)});e=a.admins.concat(b);f=e}return{groupId:a.groupId,senderKey:a.senderKey,participants:f,pastParticipants:a.pastParticipants,admins:e,rotateKey:a.rotateKey,staleType:a.staleType}}function B(a,b){var c=b.participants;c=c===void 0?[]:c;var e=b.pastParticipants;e=e===void 0?[]:e;var f=b.admins;f=f===void 0?[]:f;b=b.deviceIds;b=b===void 0?[]:b;var g=new Map();b.forEach(function(a){if(d("WAWebUserPrefsMeUser").isMeDevice(a))return;if(a.isHosted())return;a=String(a);g.has(a)||g.set(a,!1)});return{groupId:a,senderKey:g,participants:c.map(function(a){a=a.id;return String(a)}),pastParticipants:e.map(function(a){var b=a.id,c=a.leaveReason;a=a.leaveTs;return{jid:b.toString(),leaveTs:a,leaveReason:c}}),admins:f.map(String),rotateKey:!1,staleType:c.length===0?d("WAWebDBParticipantTypes").STALE_TYPES.PARTICIPANT:void 0}}function C(a,b){var c=b.participants,e=b.admins;b=b.deviceIds;var f=a.rotateKey,g=a.senderKey,h=new Map();b.forEach(function(a){if(d("WAWebUserPrefsMeUser").isMeDevice(a))return;if(a.isHosted())return;a=String(a);var b=g.get(a);b==null?h.set(a,!1):(h.set(a,b),g["delete"](a))});for(b of g.values())f=f||b;return{groupId:a.groupId,senderKey:h,participants:c.map(function(a){a=a.id;return String(a)}),pastParticipants:a.pastParticipants,admins:e.map(String),rotateKey:f}}function D(a,b){var c=b.participants,e=b.admins;b=b.deviceIds;var f=a.rotateKey,g=a.senderKey,h=new Map();b.forEach(function(a){if(d("WAWebUserPrefsMeUser").isMeDevice(a))return;if(a.isHosted())return;a=String(a);var b=g.get(a);b==null?h.set(a,!1):(h.set(a,b),g["delete"](a))});for(b of g.entries()){var i=b[0],j=b[1];if(j&&!d("WAWebWidFactory").createWid(i).isLid()){f=!0;break}}return{groupId:a.groupId,senderKey:h,participants:c.map(function(a){a=a.id;return String(a)}),pastParticipants:a.pastParticipants,admins:e.map(String),rotateKey:f}}function E(a){var b=a.group;return d("WAWebModelStorageUtils").getStorage().lock(["participant"],function(a){a=a[0];return a.merge(String(b),{staleType:d("WAWebDBParticipantTypes").STALE_TYPES.PARTICIPANT})})}function F(a){var b=a.groupIds;return d("WAWebModelStorageUtils").getStorage().lock(["participant"],function(a){a=a[0];return a.bulkCreateOrMerge(b.map(function(a){return{groupId:String(a),staleType:d("WAWebDBParticipantTypes").STALE_TYPES.PARTICIPANT}}))})}function G(a){var c=a.group,e=a.oldId,f=a.newId,g=String(c);return d("WAWebModelStorageUtils").getStorage().lock(["participant"],function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a[0];var b=(yield a.get(g));if(!b)throw new(d("WAWebDBParticipantTypes").GroupUnSyncedError)("modifyGroupParticipant: group participant info missing");return a.createOrReplace(H(b,e,f))});return function(b){return a.apply(this,arguments)}}())}function H(a,b,c){var e=String(b),f=String(c),g=new Map(a.senderKey);c=a.participants.filter(function(a){return a!==e}).concat(f);Array.from(g.keys()).forEach(function(a){var c=d("WAWebWidFactory").createWid(a).user;b.user===c?g["delete"](a):g.set(a,!1)});g.set(f,!1);var h=a.admins.map(function(a){return a===e?f:a});return babelHelpers["extends"]({},a,{participants:c,senderKey:g,admins:h,rotateKey:!0})}function I(a){return J.apply(this,arguments)}function J(){J=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b,c;a=a.groupWid;a=(yield d("WAWebSchemaParticipant").getParticipantTable().get(String(a)));if(!a)return null;var e=new Set(a.admins);b=(b=(b=a.participants)==null?void 0:b.map(function(a){return{id:d("WAWebWidFactory").createWid(a),isAdmin:e.has(a),isSuperAdmin:!1}}))!=null?b:[];c=(c=(c=a.pastParticipants)==null?void 0:c.map(function(a){var b=a.jid,c=a.leaveTs;a=a.leaveReason;return{id:d("WAWebWidFactory").createWid(b),leaveTs:c,leaveReason:a}}))!=null?c:[];d("WAWebWamGroupMetricCache").cacheGroupMetrics(a);var f=a.deviceSyncComplete!=null&&!a.deviceSyncComplete?d("WAWebDBParticipantTypes").STALE_TYPES.PARTICIPANT:void 0;return{participants:b,pastParticipants:c,staleType:(b=a.staleType)!=null?b:f,deviceCount:a.senderKey.size}});return J.apply(this,arguments)}g.updateGroupParticipantTableWithoutDeviceSync=a;g.replaceParticipants=e;g.addPastParticipants=f;g.updateCommunityParticipants=r;g.updateDBParticipants=s;g.addParticipantInfo=t;g.addParticipantInfoIncognitoCag=u;g.removeParticipantInfo=w;g.removeParticipantInfoIncognitoCag=x;g.changeParticipantAdminInfoIncognitoCag=z;g.createParticipantInfo=B;g.replaceParticipantInfo=C;g.replaceParticipantInfoIncognitoCag=D;g.markGroupParticipantStale=E;g.bulkMarkGroupParticipantStale=F;g.modifyGroupParticipant=G;g.getGroupParticipant=I}),98);
__d("WAWebGroupDatabaseJob",["WAJobOrchestratorTypes","WAWebDBGroupParticipant","WAWebDBGroupsGroupMetadata","WAWebOrchestratorNonPersistedJob"],(function(a,b,c,d,e,f,g){function a(a){return d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("updateGroupMetadataTable",function(a){return d("WAWebDBGroupsGroupMetadata").updateGroupMetadataTable(a)},{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.SKIP}).waitUntilCompleted({groupInfos:a})}function b(a){return d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("updateGroupParticipantTableWithoutDeviceSync",function(a){return d("WAWebDBGroupParticipant").updateGroupParticipantTableWithoutDeviceSync(a)},{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.SKIP}).waitUntilCompleted({groupInfos:a})}function c(a){return d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("markGroupParticipantStale",function(a){return d("WAWebDBGroupParticipant").markGroupParticipantStale(a)},{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.SKIP}).waitUntilCompleted({group:a})}function e(a){return d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("bulkMarkGroupParticipantStale",function(a){return d("WAWebDBGroupParticipant").bulkMarkGroupParticipantStale(a)},{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.SKIP}).waitUntilCompleted({groupIds:a})}function f(a,b,c){return d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("modifyGroupParticipant",function(a){return d("WAWebDBGroupParticipant").modifyGroupParticipant(a)},{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.SKIP}).waitUntilCompleted({group:a,oldId:b,newId:c})}function h(a){return d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("getGroupMetadata",function(a){return d("WAWebDBGroupsGroupMetadata").getGroupMetadataUNSAFE(a)},{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.SKIP}).waitUntilCompleted({groupWid:a})}function i(a){return d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("getGroupParticipant",function(a){return d("WAWebDBGroupParticipant").getGroupParticipant(a)},{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.SKIP}).waitUntilCompleted({groupWid:a})}g.updateGroupMetadataTableJob=a;g.updateGroupParticipantTableWithoutDeviceSyncJob=b;g.markGroupParticipantStaleJob=c;g.bulkMarkGroupParticipantStaleJob=e;g.modifyGroupParticipantJob=f;g.getGroupMetadataJob=h;g.getGroupParticipantJob=i}),98);
__d("WAWebUserPrefsModelStorage",["WAWebUserPrefsKeys","WAWebUserPrefsStore"],(function(a,b,c,d,e,f,g){function a(){return c("WAWebUserPrefsStore").getUser(d("WAWebUserPrefsKeys").KEYS.CONTACT_CHECKSUM_MODEL_STORAGE)}function b(a){c("WAWebUserPrefsStore").setUser(d("WAWebUserPrefsKeys").KEYS.CONTACT_CHECKSUM_MODEL_STORAGE,a)}function e(a){c("WAWebUserPrefsStore").setUser(d("WAWebUserPrefsKeys").KEYS.INITIAL_GROUP_PHASH,JSON.stringify(a))}function f(a){var b=c("WAWebUserPrefsStore").getUser(d("WAWebUserPrefsKeys").KEYS.INITIAL_GROUP_PHASH);try{return JSON.parse(b)[a]}catch(a){return null}}function h(){var a=c("WAWebUserPrefsStore").getUser(d("WAWebUserPrefsKeys").KEYS.INITIAL_GROUP_PHASH);try{return JSON.parse(a)}catch(a){return null}}g.getContactChecksum=a;g.setContactChecksum=b;g.setInitialGroupPhash=e;g.getInitialGroupPhash=f;g.getInitialGroupPhashMap=h}),98);
__d("WAWebQueryAndUpdateGroupMetadataJob",["Promise","WALogger","WATimeUtils","WAWebApiChat","WAWebApiParticipantStore","WAWebBackendApi","WAWebChatConstants","WAWebCreateOrReplaceDisplayNamesAndLidPnMappingsJob","WAWebGroupDatabaseJob","WAWebGroupQueryJob","WAWebGroupSystemMsg","WAWebHandleSingleMsg","WAWebPhashUtils","WAWebQueryAndUpdateSubgroupSuggestionsJob","WAWebSchemaChat","WAWebUserPrefsModelStorage","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Completed updateGroupEndOfHistorySyncFlag"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["One ore more chat create failed for group not synced in initial sync with error: "," "]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Start updateGroupEndOfHistorySyncFlag"]);k=function(){return a};return a}function a(a,b){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){a===void 0&&(a=!1);if(c!=null){c=(yield d("WAWebGroupQueryJob").queryGroupsById(c,"per_group_dirty_recovery"));if(c==null||c.length===0)return}else{c=(yield d("WAWebGroupQueryJob").queryAllGroups());if(c.length===0)return}c=(yield d("WAWebApiParticipantStore").injectPastParticipantsFromDB(c));var e=[],f=[];c.forEach(function(b){d("WAWebBackendApi").frontendFireAndForget("createOrUpdateGroupMetadataFromQuery",{groupInfo:b}),a&&void o(b),e.push(d("WAWebGroupQueryJob").maybeQueryAndUpdateMembershipApprovalRequests(b))});yield d("WAWebGroupDatabaseJob").updateGroupMetadataTableJob(c);yield d("WAWebGroupDatabaseJob").updateGroupParticipantTableWithoutDeviceSyncJob(c);a&&(yield m(c));var g=[];c.forEach(function(a){var b=a.participants.map(function(a){return{id:d("WAWebWidFactory").toUserWid(a.id),lid:a.lid?d("WAWebWidFactory").toUserWid(a.lid):null,displayName:a.displayName}});g.concat(b);f.push(d("WAWebQueryAndUpdateSubgroupSuggestionsJob").maybeQueryAndUpdateSubgroupSuggestions(a))});yield d("WAWebCreateOrReplaceDisplayNamesAndLidPnMappingsJob").createOrReplaceDisplayNamesAndLidPnMappings(g,!0);yield (h||(h=b("Promise"))).all(e)});return l.apply(this,arguments)}function m(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WALogger").LOG(k()).tags("history-sync","groups");var c=b("WAWebChatConstants").ConversationEndOfHistoryTransferModelPropType,e=d("WAWebUserPrefsModelStorage").getInitialGroupPhashMap(),f=[];for(a of a){var g=(yield d("WAWebApiChat").getChatRecord(a.id));if(g)continue;g=e==null?void 0:e[a.id.toString()];if(g!=null)continue;f.push({unreadCount:0,muteExpiration:0,isAutoMuted:!1,id:a.id,endOfHistoryTransferType:c.NOT_INCLUDED_IN_HIST_SYNC})}yield d("WAWebBackendApi").frontendSendAndReceive("chatCollectionAdd",{things:f,options:{merge:!0}});yield d("WAWebSchemaChat").getChatTable().bulkCreate(f.map(function(a){var b=a.endOfHistoryTransferType;a=a.id;b={endOfHistoryTransferType:b,id:a.toString(),unreadCount:0,muteExpiration:0,isAutoMuted:!1};return b}))["catch"](function(a){d("WALogger").LOG(j(),a.message).tags("history-sync","groups")});d("WALogger").LOG(i()).tags("history-sync","groups")});return n.apply(this,arguments)}function o(a){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=d("WAWebUserPrefsModelStorage").getInitialGroupPhash(a.id.toString());if(b==null)return;var c=(yield d("WAWebPhashUtils").phashV1(a.participants.map(function(a){return a.id}))),e=c.substring(2);b!=null&&b!==c&&b!==e&&d("WAWebHandleSingleMsg").handleSingleMsg(a.id,d("WAWebGroupSystemMsg").genInitialPhashMismatchMsg(a.id,d("WATimeUtils").unixTime()),"pHashMismatchMsg")});return p.apply(this,arguments)}g.queryAndUpdateAllGroupMetadata=a}),98);
__d("WAWebDefinePersistedJob",["WAJobBuilder"],(function(a,b,c,d,e,f,g){function a(){return d("WAJobBuilder").definePersistedJob()}g.defineWebPersistedJob=a}),98);
__d("WAWebQueryAndUpdateGroupsMetadataByJidsJob",["WALogger","WAWebDefinePersistedJob","WAWebQueryAndUpdateGroupMetadataJob","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["queryAndUpdateGroupsMetadataByJidsJob: started persisted job"]);h=function(){return a};return a}a=d("WAWebDefinePersistedJob").defineWebPersistedJob().finalStep("queryAndUpdateGroupsMetadataByJids",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WALogger").LOG(h()),yield d("WAWebQueryAndUpdateGroupMetadataJob").queryAndUpdateAllGroupMetadata(!1,a)});return function(b){return a.apply(this,arguments)}}()).end();g.queryAndUpdateGroupsMetadataByJidsJob=a}),98);
__d("WAWebApiSubgroupSuggestionStore",["Promise","WABatcher","WALogger","WAWebSchemaSubgroupSuggestionV2","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["removeSubgroupSuggestionsBatched: aggregating "," changes"]);i=function(){return a};return a}c=3e3;e=function(a){return d("WAWebSchemaSubgroupSuggestionV2").getSubgroupSuggestionTable().equals(["parentGroupId"],a.toString()).then(function(a){return a.map(function(a){var b=a.id,c=a.parentGroupId,e=a.subject,f=a.desc,g=a.owner,h=a.t,i=a.isExistingGroup;a=a.participantCount;return{id:d("WAWebWidFactory").createWid(b),parentGroupId:d("WAWebWidFactory").createWid(c),subject:e,desc:f,owner:d("WAWebWidFactory").createWid(g),t:h,isExistingGroup:i,participantCount:a}})})};var j=function(a,b){b=b.map(function(b){var c=b.id,d=b.subject,e=b.desc,f=b.owner,g=b.t,h=b.isExistingGroup;b=b.participantCount;return{id:c.toString(),parentGroupId:a.toString(),subject:d,desc:e,owner:f.toString(),t:g,isExistingGroup:h,participantCount:b}});return d("WAWebSchemaSubgroupSuggestionV2").getSubgroupSuggestionTable().bulkCreateOrReplace(b)};f=function(a,c,e,f){var g=function(){var g=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var g=(yield (h||(h=b("Promise"))).all(c.map(function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){b=(yield d("WAWebSchemaSubgroupSuggestionV2").getSubgroupSuggestionTable().get([a.toString(),b.toString(),e.toString()]));return b});return function(a){return c.apply(this,arguments)}}())));g=g.filter(Boolean);var i=g.map(function(a){return babelHelpers["extends"]({},a,{owner:f,parentGroupId:d("WAWebWidFactory").createWid(a.parentGroupId),id:d("WAWebWidFactory").createWid(a.id)})});yield k(g.map(function(b){b=b.id;return{parentGroupId:a,id:d("WAWebWidFactory").createWid(b),owner:e}}));yield j(a,i)});return function(){return g.apply(this,arguments)}}();return g()};var k=function(a){return d("WAWebSchemaSubgroupSuggestionV2").getSubgroupSuggestionTable().bulkRemove(a.map(function(a){var b=a.parentGroupId,c=a.id;a=a.owner;return[b.toString(),c.toString(),a.toString()]}))},l=function(a){return d("WAWebSchemaSubgroupSuggestionV2").getSubgroupSuggestionTable().bulkRemoveByIndex(["parentGroupId"],[a.toString()])},m=d("WABatcher").batch({delayMs:c},function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WALogger").DEV(i(),a.length).devConsole(a);a=a.reduce(function(a,b){a.push.apply(a,b.suggestionsRowKeys);return a},[]);yield k(a);return[]});return function(b){return a.apply(this,arguments)}}());function a(a){var b=a.subgroupSuggestions;a=a.isOffline;return a===!0?m({suggestionsRowKeys:b}):k(b)}g.getSubgroupSuggestions=e;g.addSubgroupSuggestions=j;g.updateOwnerInSubgroupSuggestions=f;g.removeSubgroupSuggestions=k;g.removeAllSubgroupSuggestions=l;g.removeSubgroupSuggestionsWithOfflineOption=a}),98);
__d("WASmaxInGroupsGetSubGroupSuggestionsClientErrors",["WAResultOrError","WASmaxInGroupsIQErrorBadRequestMixin","WASmaxInGroupsIQErrorFallbackClientMixin","WASmaxInGroupsIQErrorForbiddenMixin","WASmaxInGroupsIQErrorItemNotFoundMixin","WASmaxInGroupsIQErrorRateOverlimitMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorBadRequest",value:b.value});var c=d("WASmaxInGroupsIQErrorForbiddenMixin").parseIQErrorForbiddenMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"IQErrorForbidden",value:c.value});var e=d("WASmaxInGroupsIQErrorItemNotFoundMixin").parseIQErrorItemNotFoundMixin(a);if(e.success)return d("WAResultOrError").makeResult({name:"IQErrorItemNotFound",value:e.value});var f=d("WASmaxInGroupsIQErrorRateOverlimitMixin").parseIQErrorRateOverlimitMixin(a);if(f.success)return d("WAResultOrError").makeResult({name:"IQErrorRateOverlimit",value:f.value});var g=d("WASmaxInGroupsIQErrorFallbackClientMixin").parseIQErrorFallbackClientMixin(a);return g.success?d("WAResultOrError").makeResult({name:"IQErrorFallbackClient",value:g.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorBadRequest","IQErrorForbidden","IQErrorItemNotFound","IQErrorRateOverlimit","IQErrorFallbackClient"],[b,c,e,f,g])}g.parseGetSubGroupSuggestionsClientErrors=a}),98);
__d("WASmaxInGroupsGetSubGroupSuggestionsResponseClientError",["WAResultOrError","WASmaxInGroupsGetSubGroupSuggestionsClientErrors","WASmaxInGroupsIQErrorResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInGroupsIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInGroupsGetSubGroupSuggestionsClientErrors").parseGetSubGroupSuggestionsClientErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorGetSubGroupSuggestionsClientErrors:b.value}))}g.parseGetSubGroupSuggestionsResponseClientError=a}),98);
__d("WASmaxInGroupsGetSubGroupSuggestionsResponseServerError",["WASmaxInGroupsBaseServerErrorMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxInGroupsBaseServerErrorMixin").parseBaseServerErrorMixin(a,b);return!c.success?c:c}g.parseGetSubGroupSuggestionsResponseServerError=a}),98);
__d("WASmaxInGroupsGetSubGroupSuggestionsFetchByViewMixin",["WAResultOrError","WASmaxInGroupsEnums","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").attrStringEnum(a,"view",d("WASmaxInGroupsEnums").ENUM_ADMIN_CREATOR);return!a.success?a:d("WAResultOrError").makeResult({view:a.value})}g.parseGetSubGroupSuggestionsFetchByViewMixin=a}),98);
__d("WASmaxInGroupsSubGroupSuggestionDescriptionMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"description");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"body");if(!b.success)return b;a=d("WASmaxParseUtils").contentString(b.value);return!a.success?a:d("WAResultOrError").makeResult({bodyElementValue:a.value})}g.parseSubGroupSuggestionDescriptionMixin=a}),98);
__d("WASmaxInGroupsSubGroupSuggestionWithoutCreatorMixin",["WAResultOrError","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"sub_group_suggestion");if(!b.success)return b;b=d("WASmaxParseJid").attrGroupJid(a,"jid");return!b.success?b:d("WAResultOrError").makeResult({jid:b.value})}g.parseSubGroupSuggestionWithoutCreatorMixin=a}),98);
__d("WASmaxInGroupsSubGroupSuggestionMixin",["WAResultOrError","WASmaxInGroupsSubGroupSuggestionWithoutCreatorMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"sub_group_suggestion");if(!b.success)return b;b=d("WASmaxParseJid").attrUserJid(a,"creator");if(!b.success)return b;a=d("WASmaxInGroupsSubGroupSuggestionWithoutCreatorMixin").parseSubGroupSuggestionWithoutCreatorMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({creator:b.value},a.value))}g.parseSubGroupSuggestionMixin=a}),98);
__d("WASmaxInGroupsGetSubGroupSuggestionsResponseSuccess",["WAResultOrError","WASmaxInGroupsEnums","WASmaxInGroupsGetSubGroupSuggestionsFetchByViewMixin","WASmaxInGroupsIQResultResponseMixin","WASmaxInGroupsSubGroupSuggestionDescriptionMixin","WASmaxInGroupsSubGroupSuggestionMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"description");if(!b.success)return b;b=d("WASmaxInGroupsSubGroupSuggestionDescriptionMixin").parseSubGroupSuggestionDescriptionMixin(a);return!b.success?b:b}function i(a){var b=d("WASmaxParseUtils").assertTag(a,"is_existing_group");if(!b.success)return b;b=d("WASmaxParseUtils").contentStringEnum(a,d("WASmaxInGroupsEnums").ENUM_FALSE_TRUE);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}function j(a){var b=d("WASmaxParseUtils").assertTag(a,"participant_count");if(!b.success)return b;b=d("WASmaxParseUtils").contentInt(a);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}function k(a){var b=d("WASmaxParseUtils").assertTag(a,"sub_group_suggestion");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"subject");if(!b.success)return b;var c=d("WASmaxParseUtils").optionalChildWithTag(a,"description",h);if(!c.success)return c;var e=d("WASmaxParseUtils").optionalChildWithTag(a,"is_existing_group",i);if(!e.success)return e;var f=d("WASmaxParseUtils").optionalChildWithTag(a,"participant_count",j);if(!f.success)return f;var g=d("WASmaxParseUtils").attrIntRange(a,"creation",0,void 0);if(!g.success)return g;b=d("WASmaxParseUtils").contentString(b.value);if(!b.success)return b;a=d("WASmaxInGroupsSubGroupSuggestionMixin").parseSubGroupSuggestionMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({creation:g.value,subjectElementValue:b.value},a.value,{description:c.value,isExistingGroup:e.value,participantCount:f.value}))}function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"sub_group_suggestions");if(!c.success)return c;var e=d("WASmaxInGroupsGetSubGroupSuggestionsFetchByViewMixin").parseGetSubGroupSuggestionsFetchByViewMixin(c.value);if(!e.success)return e;a=d("WASmaxInGroupsIQResultResponseMixin").parseIQResultResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxParseUtils").mapChildrenWithTag(c.value,"sub_group_suggestion",0,1e3,k);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({subGroupSuggestionsGetSubGroupSuggestionsFetchByViewMixin:e.value},a.value,{subGroupSuggestionsSubGroupSuggestion:b.value}))}g.parseGetSubGroupSuggestionsResponseSuccessSubGroupSuggestionsSubGroupSuggestionDescription=h;g.parseGetSubGroupSuggestionsResponseSuccessSubGroupSuggestionsSubGroupSuggestionIsExistingGroup=i;g.parseGetSubGroupSuggestionsResponseSuccessSubGroupSuggestionsSubGroupSuggestionParticipantCount=j;g.parseGetSubGroupSuggestionsResponseSuccessSubGroupSuggestionsSubGroupSuggestion=k;g.parseGetSubGroupSuggestionsResponseSuccess=a}),98);
__d("WASmaxOutGroupsBaseIQGetRequestMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("iq",{id:d("WAWap").generateId(),type:"get"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBaseIQGetRequestMixin=a}),98);
__d("WASmaxOutGroupsBaseGetGroupMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutGroupsBaseIQGetRequestMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.iqTo;a=d("WASmaxOutGroupsBaseIQGetRequestMixin").mergeBaseIQGetRequestMixin(d("WASmaxJsx").smax("iq",{to:d("WAWap").GROUP_JID(a),xmlns:"w:g2"}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBaseGetGroupMixin=a}),98);
__d("WASmaxOutGroupsSubGroupMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.anySubGroupJid;a=d("WASmaxJsx").smax("smax$any",{sub_group_jid:d("WAWap").GROUP_JID(a)});return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeSubGroupMixin=a}),98);
__d("WASmaxOutGroupsGetSubGroupSuggestionsRequest",["WASmaxJsx","WASmaxOutGroupsBaseGetGroupMixin","WASmaxOutGroupsSubGroupMixin"],(function(a,b,c,d,e,f,g){function a(a){var b=a.subGroupMixinArgs;b=d("WASmaxOutGroupsBaseGetGroupMixin").mergeBaseGetGroupMixin(d("WASmaxJsx").smax("iq",null,d("WASmaxOutGroupsSubGroupMixin").mergeSubGroupMixin(d("WASmaxJsx").smax("sub_group_suggestions",null),b)),a);return b}g.makeGetSubGroupSuggestionsRequest=a}),98);
__d("WASmaxGroupsGetSubGroupSuggestionsRPC",["WAComms","WASmaxInGroupsGetSubGroupSuggestionsResponseClientError","WASmaxInGroupsGetSubGroupSuggestionsResponseServerError","WASmaxInGroupsGetSubGroupSuggestionsResponseSuccess","WASmaxOutGroupsGetSubGroupSuggestionsRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,c){var e,f,g,h,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:e=d("WASmaxOutGroupsGetSubGroupSuggestionsRequest").makeGetSubGroupSuggestionsRequest(a);j.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(e,c));case 3:f=j.sent;g=d("WASmaxInGroupsGetSubGroupSuggestionsResponseSuccess").parseGetSubGroupSuggestionsResponseSuccess(f,e);if(!g.success){j.next=7;break}return j.abrupt("return",{name:"GetSubGroupSuggestionsResponseSuccess",value:g.value});case 7:h=d("WASmaxInGroupsGetSubGroupSuggestionsResponseClientError").parseGetSubGroupSuggestionsResponseClientError(f,e);if(!h.success){j.next=10;break}return j.abrupt("return",{name:"GetSubGroupSuggestionsResponseClientError",value:h.value});case 10:i=d("WASmaxInGroupsGetSubGroupSuggestionsResponseServerError").parseGetSubGroupSuggestionsResponseServerError(f,e);if(!i.success){j.next=13;break}return j.abrupt("return",{name:"GetSubGroupSuggestionsResponseServerError",value:i.value});case 13:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("GetSubGroupSuggestions",{Success:g,ClientError:h,ServerError:i}));case 14:case"end":return j.stop()}},null,this)}g.sendGetSubGroupSuggestionsRPC=a}),98);
__d("WAWebMexEventV2WamEvent",["WAWebWamCodegenUtils"],(function(a,b,c,d,e,f,g){b=(a=d("WAWebWamCodegenUtils")).defineEvents({MexEventV2:[4336,{mexEventV2DurationMs:[1,a.TYPES.TIMER],mexEventV2EndTime:[2,a.TYPES.INTEGER],mexEventV2ErrorCodes:[3,a.TYPES.STRING],mexEventV2Errors:[4,a.TYPES.STRING],mexEventV2HasData:[5,a.TYPES.BOOLEAN],mexEventV2IsMex:[6,a.TYPES.BOOLEAN],mexEventV2OperationName:[7,a.TYPES.STRING],mexEventV2QueryId:[8,a.TYPES.STRING],mexEventV2StartTime:[9,a.TYPES.INTEGER]},[1,1,1],"regular"]});g.MexEventV2WamEvent=b}),98);
__d("WAWebMexLogging",["WALogger","WAWebMexEventV2WamEvent"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[MEX][MexPerfTracker] Logging event:"]);h=function(){return a};return a}c=function(){function a(a){this.$1=!1,this.$2="",this.$3="",this.$4=-1,this.$5=-1,this.$6=-1,this.$7=!1,this.$8="",this.$9="",this.$1=a}var b=a.prototype;b.start=function(){this.$4=Date.now()};b.stop=function(){this.$5=Date.now(),this.$6=this.$5-this.$4};b.setQueryId=function(a){a!=null&&(this.$3=a)};b.setOperationName=function(a){a!=null&&(this.$2=a)};b.setHasData=function(a){this.$7=a};b.setErrors=function(a){if(a!=null){a=this.parseErrorsAndCodes(a);this.$8=a.errors;this.$9=a.errorCodes}};b.setExtensionErrors=function(a){if(a!=null){a=a.filter(function(a){return((a=a.extensions)==null?void 0:a.error_code)!=null}).map(function(a){return i(a.extensions.error_code,a.message)});this.setErrors(a)}};b.logEvent=function(){var a={mexEventV2DurationMs:this.$6,mexEventV2EndTime:this.$5,mexEventV2ErrorCodes:this.$9,mexEventV2Errors:this.$8,mexEventV2HasData:this.$7,mexEventV2IsMex:this.$1,mexEventV2OperationName:this.$2,mexEventV2QueryId:this.$3,mexEventV2StartTime:this.$4};d("WALogger").DEV(h()).tags("GQL","MEX").devConsole(a);new(d("WAWebMexEventV2WamEvent").MexEventV2WamEvent)(a).commit()};b.parseErrorsAndCodes=function(a){var b=a.map(function(a){return a.code});return{errors:JSON.stringify(a),errorCodes:JSON.stringify(b)}};return a}();function i(a,b){return{code:a,detail:b,type:"EXTENSION"}}function a(a,b){return{code:a,detail:b,type:"CLIENT"}}function b(a,b){return{code:a,detail:b,type:"TRANSPORT"}}g.MexPerfTracker=c;g.createLoggingExtensionError=i;g.createLoggingClientError=a;g.createLoggingTransportError=b}),98);
__d("WAWebMexRelayEnvironmentV2",["JSResourceForInteraction","WABinary","WADeprecatedSendIq","WADeprecatedWapParser","WANullthrows","WAWap","WAWebMexLogging","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield c("JSResourceForInteraction")("relay-runtime").__setRef("WAWebMexRelayEnvironmentV2").load());return{Environment:a.Environment,RecordSource:a.RecordSource,Store:a.Store,Network:a.Network,fetchQuery:a.fetchQuery,readInlineData:a.readInlineData,commitMutation:a.commitMutation}});return i.apply(this,arguments)}function j(a,b){var e;b!=null&&(e={query_id:d("WAWap").CUSTOM_STRING(b)});return d("WADeprecatedSendIq").deprecatedSendIq(d("WAWap").wap("iq",{id:d("WAWap").generateId(),to:d("WAWap").S_WHATSAPP_NET,type:"get",xmlns:"w:mex"},new(d("WAWap").WapNode)("query",e,d("WABinary").Binary.build(JSON.stringify(a)).readByteArray())),new(c("WADeprecatedWapParser"))("mexParser",function(a){return new TextDecoder("utf-8").decode(a.child("result").contentBytes())}))}var k;function a(){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(k==null){var a=(yield h()),b=a.Environment,c=a.Network,d=a.RecordSource;a=a.Store;c=c.create(p);a=new a(new d(),{queryCacheExpirationTime:0});d=function(){return void 0};k=new b({network:c,store:a,getDataID:d})}return k});return l.apply(this,arguments)}var m=function(b){babelHelpers.inheritsLoose(a,b);function a(a,c){var d;d=b.call(this)||this;d.name="MexIqError";d.code=a;d.message=c;return d}return a}(babelHelpers.wrapNativeSuper(Error)),n=function(b){babelHelpers.inheritsLoose(a,b);function a(a){var c;c=b.call(this)||this;c.name="MexPayloadParsingError";c.error=a;return c}return a}(babelHelpers.wrapNativeSuper(Error)),o=function(b){babelHelpers.inheritsLoose(a,b);function a(a){var c;c=b.call(this)||this;c.name="MexFatalExtensionError";c.error=a;return c}return a}(babelHelpers.wrapNativeSuper(Error));function p(a,b,c){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){e=(e=e.metadata)==null?void 0:e.mexPerfTracker;e!=null&&(e.setQueryId(a.id),e.setOperationName(a.name));b={variables:b};b=(yield s(b,c("WANullthrows")(a.id),e));if(!b.success){e!=null&&(e.setHasData(!1),e.setErrors([d("WAWebMexLogging").createLoggingTransportError(b.errorCode,b.errorText)]));throw new m(b.errorCode,b.errorText)}a={};try{a=JSON.parse(b.result)}catch(a){e!=null&&(e.setHasData(!1),e.setErrors([d("WAWebMexLogging").createLoggingClientError(472,a.message)]));throw new n(a)}b=a;e!=null&&(e.setHasData(b.data!=null),e.setExtensionErrors(b.errors));e=r(b.errors);if(e!=null)throw new o(e);return a});return q.apply(this,arguments)}function r(a){var b;if(a==null||a.length===0)return null;b=(b=a.find(function(a){return((a=a.extensions)==null?void 0:a.is_summary)===!0}))!=null?b:a.find(function(a){return((a=a.extensions)==null?void 0:a.error_code)!=null});if(b==null){a=a[0];a.extensions.error_code=500;return a}return b}function s(a,b,c){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){try{return yield j(a,b)}catch(a){c!=null&&(c.setHasData(!1),c.setErrors([d("WAWebMexLogging").createLoggingClientError(471,a.message)]));throw new m(500,a.message)}});return t.apply(this,arguments)}g.requireRelayRuntime=h;g.sendMexIq=j;g.getEnvironment=a;g.MexIqError=m;g.MexPayloadParsingError=n;g.MexFatalExtensionError=o;g.fetchFunc=p;g.parseFatalExtensionError=r}),98);
__d("WAWebGraphQLServerError",["$InternalEnum"],(function(a,b,c,d,e,f){a=b("$InternalEnum")({INVALID_ACCESS_TOKEN:190});c=function(a){babelHelpers.inheritsLoose(b,a);function b(b){var c;c=a.call(this)||this;c.name="GraphQLServerError";c.source=b;return c}return b}(babelHelpers.wrapNativeSuper(Error));f.GraphQLErrorCode=a;f.GraphQLServerError=c}),66);
__d("WAWebGraphQLConstants",[],(function(a,b,c,d,e,f){a="https://graph.facebook.com/graphql";b="https://graph.whatsapp.com/graphql/catalog";c="WA|787118555984857|7bb1544a3599aa180ac9a3f7688ba243";f.FACEBOOK_GRAPHQL_ENDPOINT=a;f.WHATSAPP_GRAPHQL_ENDPOINT=b;f.WHATSAPP_GRAPHQL_ACCESS_TOKEN=c}),66);
__d("WAWebGraphQLPersistedQueries",[],(function(a,b,c,d,e,f){a={WAWebQueryCatalogHasCategoriesQuery:"5247905281934978",WAWebQueryCatalogProductQuery:"3975937262530766",WAWebQueryCatalogQuery:"5456143974442934",WAWebQueryProductCollectionsQuery:"5349138355174780",WAWebQueryProductListCatalogJobQuery:"5431107963648273",WAWebQueryProductSingleCollectionQuery:"5797153010317042",queryProductListCatalogQuery:"5127568407281377"};f.PersistedQueries=a}),66);
__d("WAWebGraphQLRemapLocale",["WALogger","lodash"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Invalid json locale mapping"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Invalid json locale mapping"]);i=function(){return a};return a}function a(){var b=babelHelpers.taggedTemplateLiteralLoose(["locale format should use underscore instead of hyphen"]);a=function(){return b};return b}b=function(a,b){try{var e=JSON.parse(b);if(!c("lodash").isPlainObject(e)){d("WALogger").WARN(i());return a}return Object.keys(e).find(function(b){b=e[b];return Array.isArray(b)?b.includes(a):!1})||a}catch(b){d("WALogger").WARN(h());return a}};g.graphQLRemapLocale=b}),98);
__d("WAWebRelayEnvironment",["JSResourceForInteraction","WAWebGraphQLConstants","WAWebGraphQLPersistedQueries","WAWebGraphQLRemapLocale","WAWebGraphQLServerError","WAWebL10N","WAWebMiscGatingUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield c("JSResourceForInteraction")("relay-runtime").__setRef("WAWebRelayEnvironment").load());return{Environment:a.Environment,RecordSource:a.RecordSource,Store:a.Store,Network:a.Network,fetchQuery:a.fetchQuery,readInlineData:a.readInlineData,commitMutation:a.commitMutation}});return i.apply(this,arguments)}function j(a){switch(a){case"facebook":return d("WAWebGraphQLConstants").FACEBOOK_GRAPHQL_ENDPOINT;default:a;return d("WAWebGraphQLConstants").WHATSAPP_GRAPHQL_ENDPOINT}}var k=new Map();function a(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e;e=(e=a.environmentType)!=null?e:"whatsapp";var f=k.get(e);if(f!=null)return f;f=(yield h());var g=f.Environment,i=f.Network,l=f.RecordSource;f=f.Store;var m={Accept:"application/json","Content-Type":"application/json"},n=function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b,e){var f;f=(f=d("WAWebGraphQLPersistedQueries").PersistedQueries[b.name])!=null?f:b.id;b={access_token:(b=a==null?void 0:a.accessToken)!=null?b:d("WAWebGraphQLConstants").WHATSAPP_GRAPHQL_ACCESS_TOKEN,doc_id:f,variables:e,lang:d("WAWebGraphQLRemapLocale").graphQLRemapLocale(c("WAWebL10N").getFullLocale().replace("-","_"),d("WAWebMiscGatingUtils").getGraphqlLocaleRemapping())};e=(yield self.fetch(j((f=a.environmentType)!=null?f:"whatsapp"),{method:"POST",headers:m,body:JSON.stringify(b)}));if(!e.ok)throw new(d("WAWebGraphQLServerError").GraphQLServerError)({errors:[{code:e.status,message:e.statusText}]});f=(yield e.json());if((f==null?void 0:f.errors)!=null)throw new(d("WAWebGraphQLServerError").GraphQLServerError)({errors:f.errors});return f});return function(a,b){return e.apply(this,arguments)}}();g=new g({network:i.create(n),store:new f(new l())});k.set(e,g);return g});return l.apply(this,arguments)}g.requireRelayRuntime=h;g.getEnvironment=a}),98);
__d("WAWebRelayClient",["Promise","WAWebGraphQLServerError","WAWebRelayEnvironment","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){var h;function a(a){throw c("err")("Invariant Violation")}function e(a,b,c){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){c=c===void 0?{}:c;var e=c.eventLogger,f=c.environmentType,g=c.accessToken,h=c.getInlineDataReader;c=babelHelpers.objectWithoutPropertiesLoose(c,["eventLogger","environmentType","accessToken","getInlineDataReader"]);var i=(yield d("WAWebRelayEnvironment").requireRelayRuntime()),j=i.fetchQuery;i=i.readInlineData;try{f=(yield d("WAWebRelayEnvironment").getEnvironment({environmentType:f,accessToken:g}));g=(yield j)(f,a,b,c).toPromise();e==null?void 0:e.success();h==null?void 0:h(i);return g}catch(a){a instanceof d("WAWebGraphQLServerError").GraphQLServerError&&(e==null?void 0:e.failure(a.source.errors));throw a}});return i.apply(this,arguments)}function f(a,b,c){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){e=e===void 0?{}:e;var f=e.eventLogger,g=e.environmentType,i=e.accessToken,j=e.getInlineDataReader,k=babelHelpers.objectWithoutPropertiesLoose(e,["eventLogger","environmentType","accessToken","getInlineDataReader"]);e=(yield d("WAWebRelayEnvironment").requireRelayRuntime());var l=e.commitMutation,m=e.readInlineData;try{var n=(yield d("WAWebRelayEnvironment").getEnvironment({environmentType:g,accessToken:i}));return new(h||(h=b("Promise")))(function(b,d){l(n,babelHelpers["extends"]({mutation:a,variables:c},k,{onCompleted:function(a){f==null?void 0:f.success(),j==null?void 0:j(m),b(a)},onError:function(a){d(a)}}))})}catch(a){a instanceof d("WAWebGraphQLServerError").GraphQLServerError&&(f==null?void 0:f.failure(a.source.errors));throw a}});return j.apply(this,arguments)}g.graphql=a;g.fetchQuery=e;g.commitMutation=f}),98);
__d("WAWebMexRelayClientV2",["WALogger","WAWebMexLogging","WAWebMexRelayEnvironmentV2","WAWebRelayClient","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[MEX][v2] RelayClient Error:"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[MEX][v2] RelayClient Result:"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[MEX][v2] RelayClient Query:"]);j=function(){return a};return a}function a(a,b){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){d("WALogger").DEV(j()).tags("GQL","MEX").devConsole({operation:a,variables:b});var c=new(d("WAWebMexLogging").MexPerfTracker)(!0);c.start();try{var e=m(a);l(e,c);var f=(yield d("WAWebMexRelayEnvironmentV2").requireRelayRuntime());f=f.fetchQuery;f=(yield f(yield d("WAWebMexRelayEnvironmentV2").getEnvironment(),n(e),b,{fetchPolicy:"network-only",networkCacheConfig:{force:!0,metadata:{mexPerfTracker:c}}}).toPromise());d("WALogger").DEV(i()).tags("GQL","MEX").devConsole({operation:a,variables:b,result:f});c.setHasData(!0);c.stop();c.logEvent();return f}catch(a){d("WALogger").ERROR(h()).tags("GQL","MEX").devConsole({error:a});a instanceof d("WAWebMexRelayEnvironmentV2").MexIqError||a instanceof d("WAWebMexRelayEnvironmentV2").MexPayloadParsingError||a instanceof d("WAWebMexRelayEnvironmentV2").MexFatalExtensionError||(c.setHasData(!1),c.setErrors([d("WAWebMexLogging").createLoggingClientError(417,a.message)]));c.stop();c.logEvent();throw a}});return k.apply(this,arguments)}function l(a,b){var c;b.setQueryId((c=a.params)==null?void 0:c.id);b.setOperationName((c=a.params)==null?void 0:c.name)}function m(a){if(a.kind==="Request")return a;a=new Error("operation kind "+((a=JSON.stringify(a.kind))!=null?a:"")+" is not 'Request'");a.stack;throw a}function n(a){return babelHelpers["extends"]({},a,{params:babelHelpers["extends"]({},a.params,{operationKind:"query"})})}g.graphql=d("WAWebRelayClient").graphql;g.deprecatedFetchQuery=a;g.convertToConcreteRequest=m}),98);
__d("WAWebMexNativeClient",["WALogger","WAWebMexLogging","WAWebMexRelayClientV2","WAWebMexRelayEnvironmentV2","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[mex][native-client] unexpected error: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[mex][native-client] infra error: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[mex][native-client] result:"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[mex][native-client] Mex native client request:"]);k=function(){return a};return a}function a(a,b){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){d("WALogger").DEV(k()).tags("mex","native-client").devConsole({operation:a,variables:b});var c=new(d("WAWebMexLogging").MexPerfTracker)(!0);c.start();try{a=d("WAWebMexRelayClientV2").convertToConcreteRequest(a);var e=a.params;c.setQueryId(e.id);c.setOperationName(e.name);e={metadata:{mexPerfTracker:c}};a=(yield d("WAWebMexRelayEnvironmentV2").fetchFunc(a.params,b,e));d("WALogger").DEV(j()).tags("mex","native-client").devConsole({result:a});b=m(a,c);c.setHasData(!0);c.stop();c.logEvent();return b.data}catch(a){a instanceof d("WAWebMexRelayEnvironmentV2").MexIqError||a instanceof d("WAWebMexRelayEnvironmentV2").MexPayloadParsingError||a instanceof d("WAWebMexRelayEnvironmentV2").MexFatalExtensionError?a instanceof d("WAWebMexRelayEnvironmentV2").MexFatalExtensionError||d("WALogger").ERROR(i(),a.message).tags("mex","native-client").devConsole({error:a}).sendLogs("mex-native-client-infra-error"):(d("WALogger").ERROR(h(),a.message).tags("mex","native-client").devConsole({error:a}).sendLogs("mex-native-client-unexpected-error"),c.setHasData(!1),c.setErrors([d("WAWebMexLogging").createLoggingClientError(417,a.message)]));c.stop();c.logEvent();throw a}});return l.apply(this,arguments)}function m(a,b){if(a.data!=null)return{data:a.data};if(Array.isArray(a)){a="mex response is an array";b.setErrors([d("WAWebMexLogging").createLoggingClientError(472,a)]);throw new(d("WAWebMexRelayEnvironmentV2").MexPayloadParsingError)(c("err")(a))}a="data is missing in mex response";b.setErrors([d("WAWebMexLogging").createLoggingClientError(472,a)]);throw new(d("WAWebMexRelayEnvironmentV2").MexPayloadParsingError)(c("err")(a))}g.fetchQuery=a}),98);
__d("WAWebMexClient",["WAWebMexNativeClient","WAWebRelayClient","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,b){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){return d("WAWebMexNativeClient").fetchQuery(a,b)});return h.apply(this,arguments)}g.graphql=d("WAWebRelayClient").graphql;g.fetchQuery=a}),98);
__d("WAWebMexUtils",["$InternalEnum","WALogger","WAWebBackendErrors","WAWebMexRelayEnvironmentV2","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[MEX][","] fetch query error"]);h=function(){return a};return a}c=b("$InternalEnum")({Newsletter:"NEWSLETTER",Group:"GROUP",Community:"COMMUNITY"});function i(a,b){d("WALogger").ERROR(h(),b).tags("GQL","MEX").devConsole({e:a});if(a instanceof d("WAWebMexRelayEnvironmentV2").MexFatalExtensionError){b=a.error.extensions.error_code;throw new(d("WAWebBackendErrors").ServerStatusCodeError)(Number(b),"MexFatalExtensionError:"+a.error.message)}if(a instanceof d("WAWebMexRelayEnvironmentV2").MexIqError)throw new(d("WAWebBackendErrors").ServerStatusCodeError)(a.code,"MexIqError");throw a}function a(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){try{return yield a()}catch(a){i(a,b);throw a}});return j.apply(this,arguments)}g.MexSupportedFeature=c;g.runWithErrorHandler=a}),98);
__d("WAWebMexFetchSubgroupSuggestionsJob",["WALogger","WAWebBackendErrors","WAWebMexClient","WAWebMexFetchSubgroupSuggestionsJobQuery.graphql","WAWebMexUtils","WAWebWid","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[MEX][COMMUNITY] Fetched subgroup suggestions for ",""]);i=function(){return a};return a}var j=h!==void 0?h:h=b("WAWebMexFetchSubgroupSuggestionsJobQuery.graphql");function a(a,b,c){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){var g={group_id:a,query_context:f,sub_group_hint_id:e};return d("WAWebMexUtils").runWithErrorHandler(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b,e=(yield d("WAWebMexClient").fetchQuery(j,g)),f=new(c("WAWebWid"))(a,{intentionallyUsePrivateConstructor:!0});b=(b=e.xwa2_group_query_by_id)==null?void 0:(b=b.sub_group_suggestions)==null?void 0:b.edges;if(b==null)throw new(d("WAWebBackendErrors").ServerStatusCodeError)(500,"missing edges in response");b=b.map(function(a){a=a.node;if(a!=null)return l(f,a);throw new(d("WAWebBackendErrors").ServerStatusCodeError)(500,"null node in sub_group_suggestions")});d("WALogger").DEV(i(),f.toString()).tags("GQL","MEX").devConsole({result:e});return b}),d("WAWebMexUtils").MexSupportedFeature.Community)});return k.apply(this,arguments)}function l(a,b){var e,f,g;if(b.is_existing_group==null)throw new(d("WAWebBackendErrors").ServerStatusCodeError)(500,"missing is_existing_group in response");else g=b.is_existing_group;if(b.id==null)throw new(d("WAWebBackendErrors").ServerStatusCodeError)(500,"missing id in response");else e=new(c("WAWebWid"))(b.id,{intentionallyUsePrivateConstructor:!0});if(b.creator.id==null)throw new(d("WAWebBackendErrors").ServerStatusCodeError)(500,"missing creator.id in response");else f=new(c("WAWebWid"))(b.creator.id,{intentionallyUsePrivateConstructor:!0});return{id:e,parentGroupId:a,subject:(a=(e=b.subject)==null?void 0:e.value)!=null?a:"",desc:(e=b.description)==null?void 0:e.value,owner:f,t:parseInt(b.creation_time,10),isExistingGroup:g,participantCount:b.total_participants_count}}g.mexFetchSubgroupSuggestions=a}),98);
__d("WAWebMexSwitch",["WAWebABProps"],(function(a,b,c,d,e,f,g){b=function(){function a(a,b){this.$1=a,this.$2=b}var b=a.prototype;b.isMexEnabled=function(a){return this.$3()&&this.$4(a)};b.$3=function(){var a=d("WAWebABProps").getABPropConfigValue(this.$1);return a===!0};b.$4=function(a){var b=d("WAWebABProps").getABPropConfigValue(this.$2);if(Number.isInteger(b)){b=b;return(b&a)===a}return!1};return a}();function a(a){return Math.pow(2,a-1)}g.MexSwitch=b;g.createValueForBitPosition=a}),98);
__d("WAWebMexGroupSwitch",["WAWebMexSwitch"],(function(a,b,c,d,e,f,g){var h=function(b){babelHelpers.inheritsLoose(a,b);function a(){var a;a=b.call(this,"mex_group_migration_enabled","mex_group_flags")||this;a.$MexGroupSwitch1=d("WAWebMexSwitch").createValueForBitPosition(1);return a}var c=a.prototype;c.isMexEnabledForSubgroupSuggestions=function(){return this.isMexEnabled(this.$MexGroupSwitch1)};return a}(d("WAWebMexSwitch").MexSwitch),i;function a(){i==null&&(i=new h());return i}g.getMexGroupSwitch=a}),98);
__d("WAWebGetSubgroupSuggestionsJob",["Promise","WALogger","WASmaxGroupsGetSubGroupSuggestionsRPC","WAWebBackendErrors","WAWebJidToWid","WAWebMexFetchSubgroupSuggestionsJob","WAWebMexGroupSwitch","WAWebWidToJid","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["querySubgroupSuggestions failed: ",":",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["querySubgroupSuggestions failed: ",":",""]);j=function(){return a};return a}function a(a,b){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){if(d("WAWebMexGroupSwitch").getMexGroupSwitch().isMexEnabledForSubgroupSuggestions())try{return d("WAWebMexFetchSubgroupSuggestionsJob").mexFetchSubgroupSuggestions(a.toJid(),c.toJid(),"INTERACTIVE")}catch(a){var e;e=(e=a.code)!=null?e:a.status;var f=a.message;d("WALogger").LOG(i(),e,f);return a instanceof d("WAWebBackendErrors").ServerStatusCodeError?(h||(h=b("Promise"))).reject(a):(h||(h=b("Promise"))).reject(new(d("WAWebBackendErrors").ServerStatusCodeError)(Number(e),f))}else return l(a,c)});return k.apply(this,arguments)}function l(a,b){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){b=(yield d("WASmaxGroupsGetSubGroupSuggestionsRPC").sendGetSubGroupSuggestionsRPC({iqTo:d("WAWebWidToJid").widToGroupJid(a),subGroupMixinArgs:{anySubGroupJid:d("WAWebWidToJid").widToGroupJid(b)}}));switch(b.name){case"GetSubGroupSuggestionsResponseSuccess":return b.value.subGroupSuggestionsSubGroupSuggestion.map(function(b){var c=d("WAWebJidToWid").groupJidToWid(b.jid);return{id:c,parentGroupId:a,subject:b.subjectElementValue,desc:(c=b.description)==null?void 0:c.bodyElementValue,owner:d("WAWebJidToWid").userJidToUserWid(b.creator),t:b.creation,isExistingGroup:((c=b.isExistingGroup)==null?void 0:c.elementValue)==="true",participantCount:(c=b.participantCount)==null?void 0:c.elementValue}});case"GetSubGroupSuggestionsResponseClientError":var c=b.value.errorGetSubGroupSuggestionsClientErrors;return n(c.value);default:b.name;return n(b.value.errorServerErrors.value)}});return m.apply(this,arguments)}function n(a){var c=a.code;a=a.text;d("WALogger").LOG(j(),c,a);return(h||(h=b("Promise"))).reject(new(d("WAWebBackendErrors").ServerStatusCodeError)(Number(c),a))}g.querySubgroupSuggestions=a}),98);
__d("WAWebQueryAndUpdateSubgroupSuggestionsJob",["WAWebApiSubgroupSuggestionStore","WAWebBackendApi","WAWebCommunityGatingUtils","WAWebDBCommunity","WAWebGetSubgroupSuggestionsJob","WAWebUserPrefsMeUser","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=(yield d("WAWebGetSubgroupSuggestionsJob").querySubgroupSuggestions(a,b));b=(yield d("WAWebApiSubgroupSuggestionStore").getSubgroupSuggestions(a));b=b.filter(function(a){return!c.some(function(b){return b.id.equals(a.id)&&b.owner.equals(a.owner)})});yield d("WAWebApiSubgroupSuggestionStore").removeSubgroupSuggestions(b.map(function(b){var c=b.id;b=b.owner;return{parentGroupId:a,id:c,owner:b}}));yield d("WAWebApiSubgroupSuggestionStore").addSubgroupSuggestions(a,c);d("WAWebBackendApi").frontendFireAndForget("createOrUpdateSubgroupSuggestions",{parentGroupId:a,subgroupSuggestions:c})});return i.apply(this,arguments)}function a(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.isParentGroup===!0&&a.allowNonAdminSubGroupCreation===!1&&a.participants.some(function(a){return d("WAWebUserPrefsMeUser").isMeAccount(a.id)&&a.isAdmin})&&d("WAWebCommunityGatingUtils").memberSuggestedGroupsEnabled()){var b=(yield d("WAWebDBCommunity").getJoinedSubgroups(a.id));if(b.length)return h(a.id,b[0])}});return j.apply(this,arguments)}g.queryAndUpdateSubgroupSuggestions=h;g.maybeQueryAndUpdateSubgroupSuggestions=a}),98);
__d("WASmaxInInAppCommsIQErrorInternalServerErrorMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","internal-server-error");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",500);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorInternalServerErrorMixin=a}),98);
__d("WASmaxInInAppCommsIQErrorRequestTimeoutMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","request-timeout");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",408);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorRequestTimeoutMixin=a}),98);
__d("WASmaxInInAppCommsIQErrorServiceUnavailableMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","service-unavailable");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",503);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorServiceUnavailableMixin=a}),98);
__d("WASmaxInInAppCommsIQErrorInternalServerErrorOrRequestTimeoutOrServiceUnavailableMixinGroup",["WAResultOrError","WASmaxInInAppCommsIQErrorInternalServerErrorMixin","WASmaxInInAppCommsIQErrorRequestTimeoutMixin","WASmaxInInAppCommsIQErrorServiceUnavailableMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInInAppCommsIQErrorInternalServerErrorMixin").parseIQErrorInternalServerErrorMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorInternalServerError",value:b.value});var c=d("WASmaxInInAppCommsIQErrorRequestTimeoutMixin").parseIQErrorRequestTimeoutMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"IQErrorRequestTimeout",value:c.value});var e=d("WASmaxInInAppCommsIQErrorServiceUnavailableMixin").parseIQErrorServiceUnavailableMixin(a);return e.success?d("WAResultOrError").makeResult({name:"IQErrorServiceUnavailable",value:e.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorInternalServerError","IQErrorRequestTimeout","IQErrorServiceUnavailable"],[b,c,e])}g.parseIQErrorInternalServerErrorOrRequestTimeoutOrServiceUnavailableMixinGroup=a}),98);
__d("WASmaxInInAppCommsIQErrorResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","error");return!c.success?c:d("WAResultOrError").makeResult({type:c.value})}g.parseIQErrorResponseMixin=a}),98);
__d("WASmaxInInAppCommsEventResponseError",["WAResultOrError","WASmaxInInAppCommsIQErrorInternalServerErrorOrRequestTimeoutOrServiceUnavailableMixinGroup","WASmaxInInAppCommsIQErrorResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInInAppCommsIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInInAppCommsIQErrorInternalServerErrorOrRequestTimeoutOrServiceUnavailableMixinGroup").parseIQErrorInternalServerErrorOrRequestTimeoutOrServiceUnavailableMixinGroup(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorIQErrorInternalServerErrorOrRequestTimeoutOrServiceUnavailableMixinGroup:b.value}))}g.parseEventResponseError=a}),98);
__d("WASmaxInInAppCommsIQResultResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","result");return!c.success?c:d("WAResultOrError").makeResult({type:c.value})}g.parseIQResultResponseMixin=a}),98);
__d("WASmaxInInAppCommsEventResponseSuccess",["WASmaxInInAppCommsIQResultResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxInInAppCommsIQResultResponseMixin").parseIQResultResponseMixin(a,b);return!c.success?c:c}g.parseEventResponseSuccess=a}),98);
__d("WASmaxOutInAppCommsBaseIQSetRequestMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("iq",{id:d("WAWap").generateId(),type:"set"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBaseIQSetRequestMixin=a}),98);
__d("WASmaxOutInAppCommsEventRequest",["WASmaxJsx","WASmaxOutInAppCommsBaseIQSetRequestMixin","WAWap"],(function(a,b,c,d,e,f,g){function a(a){var b,c=a.eventPromotionId,e=a.eventType,f=a.eventTimestampSec;a=a.eventLogdata;c=d("WASmaxOutInAppCommsBaseIQSetRequestMixin").mergeBaseIQSetRequestMixin(d("WASmaxJsx").smax("iq",{xmlns:"w:comms",to:(b=d("WAWap")).S_WHATSAPP_NET},d("WASmaxJsx").smax("event",{promotion_id:b.CUSTOM_STRING(c),type:b.CUSTOM_STRING(e),timestamp_sec:b.INT(f),logdata:b.CUSTOM_STRING(a)})));return c}g.makeEventRequest=a}),98);
__d("WASmaxInAppCommsEventRPC",["WAComms","WASmaxInInAppCommsEventResponseError","WASmaxInInAppCommsEventResponseSuccess","WASmaxOutInAppCommsEventRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,c){var e,f,g,h;return b("regeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:e=d("WASmaxOutInAppCommsEventRequest").makeEventRequest(a);i.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(e,c));case 3:f=i.sent;g=d("WASmaxInInAppCommsEventResponseSuccess").parseEventResponseSuccess(f,e);if(!g.success){i.next=7;break}return i.abrupt("return",{name:"EventResponseSuccess",value:g.value});case 7:h=d("WASmaxInInAppCommsEventResponseError").parseEventResponseError(f,e);if(!h.success){i.next=10;break}return i.abrupt("return",{name:"EventResponseError",value:h.value});case 10:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("Event",{Success:g,Error:h}));case 11:case"end":return i.stop()}},null,this)}g.sendEventRPC=a}),98);
__d("WAWebJobLoadQuickPromotions",["Promise","WAWebBackendApi","WAWebBizGatingUtils","WAWebSchemaQuickPromotions"],(function(a,b,c,d,e,f,g){var h;function a(){return!d("WAWebBizGatingUtils").qpSDKProcessingEnabled()?(h||(h=b("Promise"))).resolve():d("WAWebSchemaQuickPromotions").getQuickPromotionsTable().all().then(function(a){a.sort(function(a,b){return a.data.qpConfigPriority-b.data.qpConfigPriority}),d("WAWebBackendApi").frontendFireAndForget("loadedQuickPromotions",{promotions:a})})}g.loadQuickPromotions=a}),98);
__d("WASmaxInBizCtwaAdAccountIQErrorResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","error");return!c.success?c:d("WAResultOrError").makeResult({type:c.value})}g.parseIQErrorResponseMixin=a}),98);
__d("WASmaxInBizCtwaAdAccountHackBaseIQErrorResponseMixin",["WAResultOrError","WASmaxInBizCtwaAdAccountIQErrorResponseMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").optional(d("WASmaxParseJid").attrUserJid,a,"to");if(!c.success)return c;a=d("WASmaxInBizCtwaAdAccountIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({to:c.value},a.value))}g.parseHackBaseIQErrorResponseMixin=a}),98);
__d("WASmaxInBizCtwaAdAccountIQErrorBadRequestMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","bad-request");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",400);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorBadRequestMixin=a}),98);
__d("WASmaxInBizCtwaAdAccountIQErrorForbiddenMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","forbidden");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",403);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorForbiddenMixin=a}),98);
__d("WASmaxInBizCtwaAdAccountIQErrorInternalServerErrorMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","internal-server-error");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",500);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorInternalServerErrorMixin=a}),98);
__d("WASmaxInBizCtwaAdAccountIQErrorServiceUnavailableMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","service-unavailable");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",503);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorServiceUnavailableMixin=a}),98);
__d("WASmaxInBizCtwaAdAccountIQErrorBadRequestOrForbiddenOrInternalServerErrorOrServiceUnavailableMixinGroup",["WAResultOrError","WASmaxInBizCtwaAdAccountIQErrorBadRequestMixin","WASmaxInBizCtwaAdAccountIQErrorForbiddenMixin","WASmaxInBizCtwaAdAccountIQErrorInternalServerErrorMixin","WASmaxInBizCtwaAdAccountIQErrorServiceUnavailableMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInBizCtwaAdAccountIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorBadRequest",value:b.value});var c=d("WASmaxInBizCtwaAdAccountIQErrorForbiddenMixin").parseIQErrorForbiddenMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"IQErrorForbidden",value:c.value});var e=d("WASmaxInBizCtwaAdAccountIQErrorInternalServerErrorMixin").parseIQErrorInternalServerErrorMixin(a);if(e.success)return d("WAResultOrError").makeResult({name:"IQErrorInternalServerError",value:e.value});var f=d("WASmaxInBizCtwaAdAccountIQErrorServiceUnavailableMixin").parseIQErrorServiceUnavailableMixin(a);return f.success?d("WAResultOrError").makeResult({name:"IQErrorServiceUnavailable",value:f.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorBadRequest","IQErrorForbidden","IQErrorInternalServerError","IQErrorServiceUnavailable"],[b,c,e,f])}g.parseIQErrorBadRequestOrForbiddenOrInternalServerErrorOrServiceUnavailableMixinGroup=a}),98);
__d("WASmaxInBizCtwaAdAccountGetAccessTokenAndSessionCookiesResponseError",["WAResultOrError","WASmaxInBizCtwaAdAccountHackBaseIQErrorResponseMixin","WASmaxInBizCtwaAdAccountIQErrorBadRequestOrForbiddenOrInternalServerErrorOrServiceUnavailableMixinGroup","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInBizCtwaAdAccountHackBaseIQErrorResponseMixin").parseHackBaseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInBizCtwaAdAccountIQErrorBadRequestOrForbiddenOrInternalServerErrorOrServiceUnavailableMixinGroup").parseIQErrorBadRequestOrForbiddenOrInternalServerErrorOrServiceUnavailableMixinGroup(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorIQErrorBadRequestOrForbiddenOrInternalServerErrorOrServiceUnavailableMixinGroup:b.value}))}g.parseGetAccessTokenAndSessionCookiesResponseError=a}),98);
__d("WASmaxInBizCtwaAdAccountGetAccessTokenAndSessionCookiesResponseIncorrectNonce",["WAResultOrError","WASmaxInBizCtwaAdAccountHackBaseIQErrorResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;var e=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,c.value,"code","432");if(!e.success)return e;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,c.value,"text","INCORRECT_NONCE");if(!c.success)return c;a=d("WASmaxInBizCtwaAdAccountHackBaseIQErrorResponseMixin").parseHackBaseIQErrorResponseMixin(a,b);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({errorCode:e.value,errorText:c.value},a.value))}g.parseGetAccessTokenAndSessionCookiesResponseIncorrectNonce=a}),98);
__d("WASmaxInBizCtwaAdAccountIQResultResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","result");return!c.success?c:d("WAResultOrError").makeResult({type:c.value})}g.parseIQResultResponseMixin=a}),98);
__d("WASmaxInBizCtwaAdAccountHackBaseIQResultResponseMixin",["WAResultOrError","WASmaxInBizCtwaAdAccountIQResultResponseMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").optional(d("WASmaxParseJid").attrUserJid,a,"to");if(!c.success)return c;a=d("WASmaxInBizCtwaAdAccountIQResultResponseMixin").parseIQResultResponseMixin(a,b);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({to:c.value},a.value))}g.parseHackBaseIQResultResponseMixin=a}),98);
__d("WASmaxInBizCtwaAdAccountGetAccessTokenAndSessionCookiesResponseSuccess",["WAResultOrError","WASmaxInBizCtwaAdAccountHackBaseIQResultResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"access_token");if(!c.success)return c;var e=d("WASmaxParseUtils").flattenedChildWithTag(a,"session_cookies");if(!e.success)return e;var f=d("WASmaxParseUtils").flattenedChildWithTag(a,"business_person");if(!f.success)return f;c=d("WASmaxParseUtils").contentString(c.value);if(!c.success)return c;e=d("WASmaxParseUtils").contentString(e.value);if(!e.success)return e;f=d("WASmaxParseUtils").attrString(f.value,"id");if(!f.success)return f;a=d("WASmaxInBizCtwaAdAccountHackBaseIQResultResponseMixin").parseHackBaseIQResultResponseMixin(a,b);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({accessTokenElementValue:c.value,sessionCookiesElementValue:e.value,businessPersonId:f.value},a.value))}g.parseGetAccessTokenAndSessionCookiesResponseSuccess=a}),98);
__d("WASmaxInBizCtwaAdAccountGetAccessTokenAndSessionCookiesResponseTooManyAttempts",["WAResultOrError","WASmaxInBizCtwaAdAccountHackBaseIQErrorResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;var e=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,c.value,"code","431");if(!e.success)return e;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,c.value,"text","TOO_MANY_ATTEMPTS");if(!c.success)return c;a=d("WASmaxInBizCtwaAdAccountHackBaseIQErrorResponseMixin").parseHackBaseIQErrorResponseMixin(a,b);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({errorCode:e.value,errorText:c.value},a.value))}g.parseGetAccessTokenAndSessionCookiesResponseTooManyAttempts=a}),98);
__d("WASmaxOutBizCtwaAdAccountBaseIQGetRequestMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("iq",{id:d("WAWap").generateId(),type:"get"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBaseIQGetRequestMixin=a}),98);
__d("WASmaxOutBizCtwaAdAccountHackBaseIQGetRequestMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WASmaxOutBizCtwaAdAccountBaseIQGetRequestMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.iqFrom;a=d("WASmaxOutBizCtwaAdAccountBaseIQGetRequestMixin").mergeBaseIQGetRequestMixin(d("WASmaxJsx").smax("iq",{from:d("WASmaxAttrs").OPTIONAL(d("WAWap").USER_JID,a),to:d("WAWap").S_WHATSAPP_NET}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeHackBaseIQGetRequestMixin=a}),98);
__d("WASmaxOutBizCtwaAdAccountGetAccessTokenAndSessionCookiesRequest",["WASmaxJsx","WASmaxOutBizCtwaAdAccountHackBaseIQGetRequestMixin","WAWap"],(function(a,b,c,d,e,f,g){function a(a){var b=a.codeElementValue;b=d("WASmaxOutBizCtwaAdAccountHackBaseIQGetRequestMixin").mergeHackBaseIQGetRequestMixin(d("WASmaxJsx").smax("iq",{xmlns:"fb:thrift_iq",smax_id:d("WAWap").INT(104)},d("WASmaxJsx").smax("parameters",null,d("WASmaxJsx").smax("code",null,b))),a);return b}g.makeGetAccessTokenAndSessionCookiesRequest=a}),98);
__d("WASmaxBizCtwaAdAccountGetAccessTokenAndSessionCookiesRPC",["WAComms","WASmaxInBizCtwaAdAccountGetAccessTokenAndSessionCookiesResponseError","WASmaxInBizCtwaAdAccountGetAccessTokenAndSessionCookiesResponseIncorrectNonce","WASmaxInBizCtwaAdAccountGetAccessTokenAndSessionCookiesResponseSuccess","WASmaxInBizCtwaAdAccountGetAccessTokenAndSessionCookiesResponseTooManyAttempts","WASmaxOutBizCtwaAdAccountGetAccessTokenAndSessionCookiesRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,c){var e,f,g,h,i,j;return b("regeneratorRuntime").async(function(k){while(1)switch(k.prev=k.next){case 0:e=d("WASmaxOutBizCtwaAdAccountGetAccessTokenAndSessionCookiesRequest").makeGetAccessTokenAndSessionCookiesRequest(a);k.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(e,c));case 3:f=k.sent;g=d("WASmaxInBizCtwaAdAccountGetAccessTokenAndSessionCookiesResponseSuccess").parseGetAccessTokenAndSessionCookiesResponseSuccess(f,e);if(!g.success){k.next=7;break}return k.abrupt("return",{name:"GetAccessTokenAndSessionCookiesResponseSuccess",value:g.value});case 7:h=d("WASmaxInBizCtwaAdAccountGetAccessTokenAndSessionCookiesResponseTooManyAttempts").parseGetAccessTokenAndSessionCookiesResponseTooManyAttempts(f,e);if(!h.success){k.next=10;break}return k.abrupt("return",{name:"GetAccessTokenAndSessionCookiesResponseTooManyAttempts",value:h.value});case 10:i=d("WASmaxInBizCtwaAdAccountGetAccessTokenAndSessionCookiesResponseIncorrectNonce").parseGetAccessTokenAndSessionCookiesResponseIncorrectNonce(f,e);if(!i.success){k.next=13;break}return k.abrupt("return",{name:"GetAccessTokenAndSessionCookiesResponseIncorrectNonce",value:i.value});case 13:j=d("WASmaxInBizCtwaAdAccountGetAccessTokenAndSessionCookiesResponseError").parseGetAccessTokenAndSessionCookiesResponseError(f,e);if(!j.success){k.next=16;break}return k.abrupt("return",{name:"GetAccessTokenAndSessionCookiesResponseError",value:j.value});case 16:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("GetAccessTokenAndSessionCookies",{Success:g,TooManyAttempts:h,IncorrectNonce:i,Error:j}));case 17:case"end":return k.stop()}},null,this)}g.sendGetAccessTokenAndSessionCookiesRPC=a}),98);
__d("WASmaxInBizAccessTokenIQErrorResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","error");return!c.success?c:d("WAResultOrError").makeResult({type:c.value})}g.parseIQErrorResponseMixin=a}),98);
__d("WASmaxInBizAccessTokenHackBaseIQErrorResponseMixin",["WAResultOrError","WASmaxInBizAccessTokenIQErrorResponseMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").optional(d("WASmaxParseJid").attrUserJid,a,"to");if(!c.success)return c;a=d("WASmaxInBizAccessTokenIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({to:c.value},a.value))}g.parseHackBaseIQErrorResponseMixin=a}),98);
__d("WASmaxInBizAccessTokenIQErrorBadRequestMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","bad-request");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",400);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorBadRequestMixin=a}),98);
__d("WASmaxInBizAccessTokenIQErrorForbiddenMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","forbidden");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",403);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorForbiddenMixin=a}),98);
__d("WASmaxInBizAccessTokenIQErrorInternalServerErrorMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","internal-server-error");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",500);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorInternalServerErrorMixin=a}),98);
__d("WASmaxInBizAccessTokenIQErrorServiceUnavailableMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","service-unavailable");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",503);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorServiceUnavailableMixin=a}),98);
__d("WASmaxInBizAccessTokenIQErrorBadRequestOrForbiddenOrInternalServerErrorOrServiceUnavailableMixinGroup",["WAResultOrError","WASmaxInBizAccessTokenIQErrorBadRequestMixin","WASmaxInBizAccessTokenIQErrorForbiddenMixin","WASmaxInBizAccessTokenIQErrorInternalServerErrorMixin","WASmaxInBizAccessTokenIQErrorServiceUnavailableMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInBizAccessTokenIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorBadRequest",value:b.value});var c=d("WASmaxInBizAccessTokenIQErrorForbiddenMixin").parseIQErrorForbiddenMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"IQErrorForbidden",value:c.value});var e=d("WASmaxInBizAccessTokenIQErrorInternalServerErrorMixin").parseIQErrorInternalServerErrorMixin(a);if(e.success)return d("WAResultOrError").makeResult({name:"IQErrorInternalServerError",value:e.value});var f=d("WASmaxInBizAccessTokenIQErrorServiceUnavailableMixin").parseIQErrorServiceUnavailableMixin(a);return f.success?d("WAResultOrError").makeResult({name:"IQErrorServiceUnavailable",value:f.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorBadRequest","IQErrorForbidden","IQErrorInternalServerError","IQErrorServiceUnavailable"],[b,c,e,f])}g.parseIQErrorBadRequestOrForbiddenOrInternalServerErrorOrServiceUnavailableMixinGroup=a}),98);
__d("WASmaxInBizAccessTokenRequestSilentNonceResponseError",["WAResultOrError","WASmaxInBizAccessTokenHackBaseIQErrorResponseMixin","WASmaxInBizAccessTokenIQErrorBadRequestOrForbiddenOrInternalServerErrorOrServiceUnavailableMixinGroup","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInBizAccessTokenHackBaseIQErrorResponseMixin").parseHackBaseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInBizAccessTokenIQErrorBadRequestOrForbiddenOrInternalServerErrorOrServiceUnavailableMixinGroup").parseIQErrorBadRequestOrForbiddenOrInternalServerErrorOrServiceUnavailableMixinGroup(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorIQErrorBadRequestOrForbiddenOrInternalServerErrorOrServiceUnavailableMixinGroup:b.value}))}g.parseRequestSilentNonceResponseError=a}),98);
__d("WASmaxInBizAccessTokenIQResultResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","result");return!c.success?c:d("WAResultOrError").makeResult({type:c.value})}g.parseIQResultResponseMixin=a}),98);
__d("WASmaxInBizAccessTokenHackBaseIQResultResponseMixin",["WAResultOrError","WASmaxInBizAccessTokenIQResultResponseMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").optional(d("WASmaxParseJid").attrUserJid,a,"to");if(!c.success)return c;a=d("WASmaxInBizAccessTokenIQResultResponseMixin").parseIQResultResponseMixin(a,b);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({to:c.value},a.value))}g.parseHackBaseIQResultResponseMixin=a}),98);
__d("WASmaxInBizAccessTokenRequestSilentNonceResponseRecoveryRequired",["WAResultOrError","WASmaxInBizAccessTokenHackBaseIQResultResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"result");if(!c.success)return c;var e=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,c.value,"status","RecoveryRequired");if(!e.success)return e;c=d("WASmaxParseUtils").attrString(c.value,"email");if(!c.success)return c;a=d("WASmaxInBizAccessTokenHackBaseIQResultResponseMixin").parseHackBaseIQResultResponseMixin(a,b);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({resultStatus:e.value,resultEmail:c.value},a.value))}g.parseRequestSilentNonceResponseRecoveryRequired=a}),98);
__d("WASmaxInBizAccessTokenRequestSilentNonceResponseSuccess",["WAResultOrError","WASmaxInBizAccessTokenHackBaseIQResultResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"result");if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,c.value,"status","Success");if(!c.success)return c;a=d("WASmaxInBizAccessTokenHackBaseIQResultResponseMixin").parseHackBaseIQResultResponseMixin(a,b);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({resultStatus:c.value},a.value))}g.parseRequestSilentNonceResponseSuccess=a}),98);
__d("WASmaxOutBizAccessTokenBaseIQGetRequestMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("iq",{id:d("WAWap").generateId(),type:"get"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBaseIQGetRequestMixin=a}),98);
__d("WASmaxOutBizAccessTokenHackBaseIQGetRequestMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WASmaxOutBizAccessTokenBaseIQGetRequestMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.iqFrom;a=d("WASmaxOutBizAccessTokenBaseIQGetRequestMixin").mergeBaseIQGetRequestMixin(d("WASmaxJsx").smax("iq",{from:d("WASmaxAttrs").OPTIONAL(d("WAWap").USER_JID,a),to:d("WAWap").S_WHATSAPP_NET}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeHackBaseIQGetRequestMixin=a}),98);
__d("WASmaxOutBizAccessTokenRequestSilentNonceRequest",["WASmaxJsx","WASmaxOutBizAccessTokenHackBaseIQGetRequestMixin","WAWap"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxOutBizAccessTokenHackBaseIQGetRequestMixin").mergeHackBaseIQGetRequestMixin(d("WASmaxJsx").smax("iq",{xmlns:"fb:thrift_iq",smax_id:d("WAWap").INT(118)}),a);return a}g.makeRequestSilentNonceRequest=a}),98);
__d("WASmaxBizAccessTokenRequestSilentNonceRPC",["WAComms","WASmaxInBizAccessTokenRequestSilentNonceResponseError","WASmaxInBizAccessTokenRequestSilentNonceResponseRecoveryRequired","WASmaxInBizAccessTokenRequestSilentNonceResponseSuccess","WASmaxOutBizAccessTokenRequestSilentNonceRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,c){var e,f,g,h,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:e=d("WASmaxOutBizAccessTokenRequestSilentNonceRequest").makeRequestSilentNonceRequest(a);j.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(e,c));case 3:f=j.sent;g=d("WASmaxInBizAccessTokenRequestSilentNonceResponseSuccess").parseRequestSilentNonceResponseSuccess(f,e);if(!g.success){j.next=7;break}return j.abrupt("return",{name:"RequestSilentNonceResponseSuccess",value:g.value});case 7:h=d("WASmaxInBizAccessTokenRequestSilentNonceResponseRecoveryRequired").parseRequestSilentNonceResponseRecoveryRequired(f,e);if(!h.success){j.next=10;break}return j.abrupt("return",{name:"RequestSilentNonceResponseRecoveryRequired",value:h.value});case 10:i=d("WASmaxInBizAccessTokenRequestSilentNonceResponseError").parseRequestSilentNonceResponseError(f,e);if(!i.success){j.next=13;break}return j.abrupt("return",{name:"RequestSilentNonceResponseError",value:i.value});case 13:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("RequestSilentNonce",{Success:g,RecoveryRequired:h,Error:i}));case 14:case"end":return j.stop()}},null,this)}g.sendRequestSilentNonceRPC=a}),98);
__d("WAWebCTWABizAccessTokenNonceManager",["Promise","WACustomError","WALogger","WAPromiseTimeout","WAQplTypes","WAResolvable","WASmaxBizAccessTokenRequestSilentNonceRPC","WAWebBizGatingUtils","WAWebCTWAConstants","WAWebQplQuickPerformanceLoggerMarkerIds","WAWebQplQuickPerformanceLoggerModule"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received a biz token nonce without asking for it"]);i=function(){return a};return a}var j=null;function a(a){return d("WAPromiseTimeout").promiseTimeout(k(a),d("WAWebCTWAConstants").MANAGE_ADS_FETCH_TIMEOUT_MS)["catch"](function(a){a instanceof d("WACustomError").TimeoutError&&d("WAWebQplQuickPerformanceLoggerModule").QPL.markerEnd(d("WAWebQplQuickPerformanceLoggerMarkerIds").QuickLogMarkerId.MANAGE_ADS_FETCH_NONCE,d("WAQplTypes").QuickLogActionType.ABORTED);throw a})}function k(a){if(!d("WAWebBizGatingUtils").adManagementEnabled())return(h||(h=b("Promise"))).resolve({type:"not-enabled"});if(j!=null&&a!==!0)return j.promise;d("WAWebQplQuickPerformanceLoggerModule").QPL.markerStart(d("WAWebQplQuickPerformanceLoggerMarkerIds").QuickLogMarkerId.MANAGE_ADS_FETCH_NONCE);d("WAWebQplQuickPerformanceLoggerModule").QPL.markerPoint(d("WAWebQplQuickPerformanceLoggerMarkerIds").QuickLogMarkerId.MANAGE_ADS_FETCH_NONCE,"request_nonce_start");var c=j=new(d("WAResolvable").Resolvable)();return d("WASmaxBizAccessTokenRequestSilentNonceRPC").sendRequestSilentNonceRPC({}).then(function(a){switch(a.name){case"RequestSilentNonceResponseError":d("WAWebQplQuickPerformanceLoggerModule").QPL.markerPoint(d("WAWebQplQuickPerformanceLoggerMarkerIds").QuickLogMarkerId.MANAGE_ADS_FETCH_NONCE,"request_nonce_end");d("WAWebQplQuickPerformanceLoggerModule").QPL.markerEnd(d("WAWebQplQuickPerformanceLoggerMarkerIds").QuickLogMarkerId.MANAGE_ADS_FETCH_NONCE,d("WAQplTypes").QuickLogActionType.FAIL);j=null;return{type:"error"};case"RequestSilentNonceResponseRecoveryRequired":d("WAWebQplQuickPerformanceLoggerModule").QPL.markerPoint(d("WAWebQplQuickPerformanceLoggerMarkerIds").QuickLogMarkerId.MANAGE_ADS_FETCH_NONCE,"request_nonce_end");d("WAWebQplQuickPerformanceLoggerModule").QPL.markerEnd(d("WAWebQplQuickPerformanceLoggerMarkerIds").QuickLogMarkerId.MANAGE_ADS_FETCH_NONCE,d("WAQplTypes").QuickLogActionType.FAIL);j=null;return{type:"recovery-required",emailMask:a.value.resultEmail};default:a.name;d("WAWebQplQuickPerformanceLoggerModule").QPL.markerPoint(d("WAWebQplQuickPerformanceLoggerMarkerIds").QuickLogMarkerId.MANAGE_ADS_FETCH_NONCE,"request_nonce_end");d("WAWebQplQuickPerformanceLoggerModule").QPL.markerPoint(d("WAWebQplQuickPerformanceLoggerMarkerIds").QuickLogMarkerId.MANAGE_ADS_FETCH_NONCE,"push_nonce_start");return c.promise}})["catch"](function(a){d("WAWebQplQuickPerformanceLoggerModule").QPL.markerPoint(d("WAWebQplQuickPerformanceLoggerMarkerIds").QuickLogMarkerId.MANAGE_ADS_FETCH_NONCE,"request_nonce_end");d("WAWebQplQuickPerformanceLoggerModule").QPL.markerEnd(d("WAWebQplQuickPerformanceLoggerMarkerIds").QuickLogMarkerId.MANAGE_ADS_FETCH_NONCE,d("WAQplTypes").QuickLogActionType.FAIL);j=null;throw a})}function c(a){j==null&&(d("WALogger").WARN(i()),j=new(d("WAResolvable").Resolvable)()),j.resolve({type:"success",nonce:a}),d("WAWebQplQuickPerformanceLoggerModule").QPL.markerPoint(d("WAWebQplQuickPerformanceLoggerMarkerIds").QuickLogMarkerId.MANAGE_ADS_FETCH_NONCE,"push_nonce_end"),d("WAWebQplQuickPerformanceLoggerModule").QPL.markerEnd(d("WAWebQplQuickPerformanceLoggerMarkerIds").QuickLogMarkerId.MANAGE_ADS_FETCH_NONCE,d("WAQplTypes").QuickLogActionType.SUCCESS)}function e(a){j==null&&(j=new(d("WAResolvable").Resolvable)()),j.resolve({type:"success",nonce:l(a)})}function f(){j=null}function l(a){return a}g.fetchNonce=a;g.setNonceFromPushNotification=c;g.setNonceFromRecoveryCode=e;g.markNonceAsUsed=f;g.castToNonce=l}),98);
__d("WAWebFailureErrorCodes",[],(function(a,b,c,d,e,f){a={REASON_GENERIC_FAILURE:400,REASON_NOT_AUTHORIZED:401,REASON_TEMP_BANNED:402,REASON_LOCKED:403,REASON_CLIENT_TOO_OLD:405,REASON_BANNED:406,REASON_BAD_USER_AGENT:409,REASON_INTERNAL_SERVER_ERROR:500,REASON_EXPERIMENTAL:501,REASON_SERVICE_UNAVAILABLE:503};f.FAILURE_REASON=a}),66);
__d("WAWebFetchAdAccountToken",["WAQplTypes","WAResolvable","WASmaxBizCtwaAdAccountGetAccessTokenAndSessionCookiesRPC","WAWebCTWABizAccessTokenNonceManager","WAWebFailureErrorCodes","WAWebGraphQLServerError","WAWebQplQuickPerformanceLoggerMarkerIds","WAWebQplQuickPerformanceLoggerModule"],(function(a,b,c,d,e,f,g){var h=null;function a(){if(h!=null)return h.promise;h;h=new(d("WAResolvable").Resolvable)();var a=h=new(d("WAResolvable").Resolvable)();void i(1).then(function(b){b.type==="success"||(b.type,h=null),a.resolve(b)})["catch"](function(b){h=null,a.reject(b)});return a.promise}function b(){h=null}function c(a){if(a instanceof d("WAWebGraphQLServerError").GraphQLServerError){a=a.source.errors.some(function(a){return d("WAWebGraphQLServerError").GraphQLErrorCode.cast(a.code)===d("WAWebGraphQLServerError").GraphQLErrorCode.INVALID_ACCESS_TOKEN||a.code===d("WAWebFailureErrorCodes").FAILURE_REASON.REASON_GENERIC_FAILURE});return a}return!1}function i(a){return d("WAWebCTWABizAccessTokenNonceManager").fetchNonce().then(function(b){switch(b.type){case"error":case"not-enabled":case"recovery-required":return b;default:b.type;return j(b.nonce).then(function(b){return b.type==="incorrect-nonce"&&a>0?i(a-1):b})}})}function j(a){d("WAWebCTWABizAccessTokenNonceManager").markNonceAsUsed();d("WAWebQplQuickPerformanceLoggerModule").QPL.markerStart(d("WAWebQplQuickPerformanceLoggerMarkerIds").QuickLogMarkerId.MANAGE_ADS_FETCH_TOKEN);d("WAWebQplQuickPerformanceLoggerModule").QPL.markerPoint(d("WAWebQplQuickPerformanceLoggerMarkerIds").QuickLogMarkerId.MANAGE_ADS_FETCH_TOKEN,"request_token_start");return d("WASmaxBizCtwaAdAccountGetAccessTokenAndSessionCookiesRPC").sendGetAccessTokenAndSessionCookiesRPC({codeElementValue:a}).then(function(a){switch(a.name){case"GetAccessTokenAndSessionCookiesResponseTooManyAttempts":m();return{type:"too-many-attempts"};case"GetAccessTokenAndSessionCookiesResponseIncorrectNonce":m();return{type:"incorrect-nonce"};case"GetAccessTokenAndSessionCookiesResponseError":m();return{type:"error"};default:a.name;l();return{type:"success",token:a.value.accessTokenElementValue}}})["catch"](function(a){m();throw a})}function k(a){d("WAWebQplQuickPerformanceLoggerModule").QPL.markerPoint(d("WAWebQplQuickPerformanceLoggerMarkerIds").QuickLogMarkerId.MANAGE_ADS_FETCH_TOKEN,"request_token_end"),d("WAWebQplQuickPerformanceLoggerModule").QPL.markerEnd(d("WAWebQplQuickPerformanceLoggerMarkerIds").QuickLogMarkerId.MANAGE_ADS_FETCH_TOKEN,a)}function l(){k(d("WAQplTypes").QuickLogActionType.SUCCESS)}function m(){k(d("WAQplTypes").QuickLogActionType.FAIL)}g.fetchToken=a;g.markTokenAsInvalid=b;g.hasGraphQLAuthError=c}),98);
__d("WAWebQuickPromotionActionMutation",["Promise","WACustomError","WALogger","WAPromiseTimeout","WAWebBizGatingUtils","WAWebCTWAConstants","WAWebFetchAdAccountToken","WAWebOrchestratorNonPersistedJob","WAWebQuickPromotionActionMutation.graphql","WAWebRelayClient"],(function(a,b,c,d,e,f,g){var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(['executeQuickPromotionActionMutation: failed as "timeout"']);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(['executeQuickPromotionActionMutation: failed as "','"']);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["executeQuickPromotionActionMutation: success"]);l=function(){return a};return a}var m={type:"error"},n=h!==void 0?h:h=b("WAWebQuickPromotionActionMutation.graphql");function a(a){if(!d("WAWebBizGatingUtils").qpGraphQLEnabled())return(i||(i=b("Promise"))).resolve({type:"not-enabled"});var c=d("WAWebCTWAConstants").KNOWN_QP_SURFACES.get(a.surface_nux_id);return c==null||!d("WAWebBizGatingUtils").qpSurfaceIdsUsingGraphQL().has(c)?(i||(i=b("Promise"))).resolve({type:"not-enabled"}):d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("quickPromotionActionMutation",function(){return o(a)}).waitUntilCompleted()}function o(a){return d("WAPromiseTimeout").promiseTimeout(p(a),d("WAWebCTWAConstants").QP_ACTION_MUTATION_TIMEOUT_MS).then(function(a){if(a.type==="success"){d("WALogger").LOG(l());return a}a.type;d("WALogger").WARN(k(),a.type);return a})["catch"](function(a){if(a instanceof d("WACustomError").TimeoutError){d("WALogger").WARN(j());return{type:"timeout"}}throw a})}function p(a){return d("WAWebFetchAdAccountToken").fetchToken().then(function(b){if(b.type==="success")return q(a,b.token).then(function(a){a.type==="auth-failure"?d("WAWebFetchAdAccountToken").markTokenAsInvalid():a.type;return a});b.type;return b})}function q(a,b){return d("WAWebRelayClient").commitMutation(n,{input:a},{environmentType:"facebook",accessToken:b}).then(function(a){if(a==null)return m;return a.wa_quick_promotion_log_event==null?m:{type:"success"}})["catch"](function(a){return d("WAWebFetchAdAccountToken").hasGraphQLAuthError(a)?{type:"auth-failure"}:m})}g.executeQuickPromotionActionMutation=a}),98);
__d("WAWebJobDismissQuickPromotion",["WALogger","WASmaxInAppCommsEventRPC","WAWebBizGatingUtils","WAWebDefinePersistedJob","WAWebJobLoadQuickPromotions","WAWebModelStorageUtils","WAWebQuickPromotionActionMutation","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["dismissQuickPromotion: unable to log through IQ"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["dismissQuickPromotion: unable to log through GraphQL"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["dismissQuickPromotion: surface id for GraphQL call not found"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["dismissQuickPromotion: promotion not found"]);k=function(){return a};return a}function a(a){var c=a.id,e=a.ts;return d("WAWebModelStorageUtils").getStorage().lock(["quick-promotions"],function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a[0];var b=(yield a.get(c));if(b==null){d("WALogger").WARN(k());return}var f=babelHelpers["extends"]({},b.tracking,{dismisses:b.tracking.dismisses+1}),g=f.lastDismissTs;(g==null||e>g)&&(f.lastDismissTs=e);yield a.merge(c,{tracking:f});return{surfaceId:b.surfaceId,instanceLogData:(g=b.data.qpConfigInstanceLogData)==null?void 0:g.elementValue}});return function(b){return a.apply(this,arguments)}}()).then(function(a){return d("WAWebJobLoadQuickPromotions").loadQuickPromotions().then(function(){return a})})}function c(a,b){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=b.id;b=b.ts;var e=(a==null?void 0:a.instanceLogData)!=null?String.fromCharCode.apply(null,a.instanceLogData):"";if(d("WAWebBizGatingUtils").qpGraphQLEnabled()){a=a==null?void 0:a.surfaceId;if(a==null)d("WALogger").WARN(j());else{a;var f;try{f=(yield d("WAWebQuickPromotionActionMutation").executeQuickPromotionActionMutation({event:"ACTION",action:"DISMISS",promotion_id:c,surface_nux_id:a,promotion_logging_data:e,client_time:b}))}catch(a){d("WALogger").ERROR(i()).devConsole(a)}if(((a=f)==null?void 0:a.type)!=="not-enabled")return;f.type}}a=(yield d("WASmaxInAppCommsEventRPC").sendEventRPC({eventType:"dismiss",eventPromotionId:c,eventTimestampSec:b,eventLogdata:e}));a.name!=="EventResponseSuccess"&&(a.name,d("WALogger").ERROR(h()).devConsole(a.value))});return l.apply(this,arguments)}e=d("WAWebDefinePersistedJob").defineWebPersistedJob().step("saveToDb",a).finalStep("reportToComms",c).end();g.dismissQuickPromotion=e}),98);
__d("WAWebJobImpressionOnQuickPromotion",["WALogger","WASmaxInAppCommsEventRPC","WAWebBizGatingUtils","WAWebDefinePersistedJob","WAWebJobLoadQuickPromotions","WAWebModelStorageUtils","WAWebQuickPromotionActionMutation","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["impressionOnQuickPromotion: unable to log"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["impressionOnQuickPromotion: unable to log through GraphQL"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["impressionOnQuickPromotion: surface id for GraphQL call not found"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["impressionOnQuickPromotion: promotion not found"]);k=function(){return a};return a}function a(a){var c=a.id,e=a.ts;return d("WAWebModelStorageUtils").getStorage().lock(["quick-promotions"],function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a[0];var b=(yield a.get(c));if(b==null){d("WALogger").WARN(k());return}var f=babelHelpers["extends"]({},b.tracking,{impressions:b.tracking.impressions+1}),g=f.lastImpressionTs;(g==null||e>g)&&(f.lastImpressionTs=e);yield a.merge(c,{tracking:f});return{surfaceId:b.surfaceId,instanceLogData:(g=b.data.qpConfigInstanceLogData)==null?void 0:g.elementValue}});return function(b){return a.apply(this,arguments)}}()).then(function(a){return d("WAWebJobLoadQuickPromotions").loadQuickPromotions().then(function(){return a})})}function c(a,b){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=b.id;b=b.ts;var e=(a==null?void 0:a.instanceLogData)!=null?String.fromCharCode.apply(null,a.instanceLogData):"";if(d("WAWebBizGatingUtils").qpGraphQLEnabled()){a=a==null?void 0:a.surfaceId;if(a==null)d("WALogger").WARN(j());else{a;var f;try{f=(yield d("WAWebQuickPromotionActionMutation").executeQuickPromotionActionMutation({event:"VIEW",promotion_id:c,surface_nux_id:a,promotion_logging_data:e,client_time:b}))}catch(a){d("WALogger").ERROR(i()).devConsole(a)}if(((a=f)==null?void 0:a.type)!=="not-enabled")return;f.type}}a=(yield d("WASmaxInAppCommsEventRPC").sendEventRPC({eventType:"impression",eventPromotionId:c,eventTimestampSec:b,eventLogdata:e}));a.name!=="EventResponseSuccess"&&(a.name,d("WALogger").ERROR(h()).devConsole(a.value))});return l.apply(this,arguments)}e=d("WAWebDefinePersistedJob").defineWebPersistedJob().step("saveToDb",a).finalStep("reportToComms",c).end();g.impressionOnQuickPromotion=e}),98);
__d("WAWebJobPrimaryActionClickInQuickPromotion",["WALogger","WASmaxInAppCommsEventRPC","WAWebBizGatingUtils","WAWebDefinePersistedJob","WAWebJobLoadQuickPromotions","WAWebModelStorageUtils","WAWebQuickPromotionActionMutation","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["primaryActionClickInQuickPromotion: unable to log"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["primaryActionClickInQuickPromotion: unable to log through GraphQL"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["primaryActionClickInQuickPromotion: surface id for GraphQL call not found"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["primaryActionClickInQuickPromotion: promotion not found"]);k=function(){return a};return a}function a(a){var c=a.id,e=a.ts;return d("WAWebModelStorageUtils").getStorage().lock(["quick-promotions"],function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a[0];var b=(yield a.get(c));if(b==null){d("WALogger").WARN(k());return}var f=babelHelpers["extends"]({},b.tracking,{primaryClicks:b.tracking.primaryClicks+1}),g=f.lastPrimaryClickTs;(g==null||e>g)&&(f.lastPrimaryClickTs=e);yield a.merge(c,{tracking:f});return{surfaceId:b.surfaceId,instanceLogData:(g=b.data.qpConfigInstanceLogData)==null?void 0:g.elementValue}});return function(b){return a.apply(this,arguments)}}()).then(function(a){return d("WAWebJobLoadQuickPromotions").loadQuickPromotions().then(function(){return a})})}function c(a,b){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=b.id;b=b.ts;var e=(a==null?void 0:a.instanceLogData)!=null?String.fromCharCode.apply(null,a.instanceLogData):"";if(d("WAWebBizGatingUtils").qpGraphQLEnabled()){a=a==null?void 0:a.surfaceId;if(a==null)d("WALogger").WARN(j());else{a;var f;try{f=(yield d("WAWebQuickPromotionActionMutation").executeQuickPromotionActionMutation({event:"ACTION",action:"PRIMARY",promotion_id:c,surface_nux_id:a,promotion_logging_data:e,client_time:b}))}catch(a){d("WALogger").ERROR(i()).devConsole(a)}if(((a=f)==null?void 0:a.type)!=="not-enabled")return;f.type}}a=(yield d("WASmaxInAppCommsEventRPC").sendEventRPC({eventType:"primary_click",eventPromotionId:c,eventTimestampSec:b,eventLogdata:e}));a.name!=="EventResponseSuccess"&&(a.name,d("WALogger").ERROR(h()).devConsole(a.value))});return l.apply(this,arguments)}e=d("WAWebDefinePersistedJob").defineWebPersistedJob().step("saveToDb",a).finalStep("reportToComms",c).end();g.primaryActionClickInQuickPromotion=e}),98);
__d("WAWebJobUserExposureToQuickPromotion",["WALogger","WASmaxInAppCommsEventRPC","WAWebDefinePersistedJob","WAWebJobLoadQuickPromotions","WAWebModelStorageUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["userExposureToQuickPromotion: unable to log"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["userExposureToQuickPromotion: skipping comms step: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["userExposureToQuickPromotion: missing experiment key"]);j=function(){return a};return a}function a(a){var c=a.id,e=a.experimentKey,f=a.exposureHoldout;if(e.length===0){d("WALogger").ERROR(j()).sendLogs("user-exposure-quick-promotion-missing-exp-key");return"missing-key"}return d("WAWebModelStorageUtils").getStorage().lock(["quick-promotions"],function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a[0];var b=(yield a.get(c));if(b==null)return"not-found";if(f==null)return"old-job";b=b.tracking;var d=b.lastLoggedExposure;if(d!=null&&(d.experimentKey===e&&d.exposureHoldout===f))return"deduped";d=babelHelpers["extends"]({},b,{lastLoggedExposure:{experimentKey:e,exposureHoldout:f}});yield a.merge(c,{tracking:d});return"updated"});return function(b){return a.apply(this,arguments)}}()).then(function(a){return a==="updated"?d("WAWebJobLoadQuickPromotions").loadQuickPromotions().then(function(){return a}):a})}function c(a,b){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=b.id,e=b.ts;b=b.experimentKey;if(a!=="updated"&&a!=="old-job"){d("WALogger").WARN(i(),a);return}a=(yield d("WASmaxInAppCommsEventRPC").sendEventRPC({eventType:"exposure",eventPromotionId:c,eventTimestampSec:e,eventLogdata:b}));a.name!=="EventResponseSuccess"&&(a.name,d("WALogger").ERROR(h()).devConsole(a.value))});return k.apply(this,arguments)}e=d("WAWebDefinePersistedJob").defineWebPersistedJob().step("saveToDb",a).finalStep("reportToComms",c).end();g.userExposureToQuickPromotion=e}),98);
__d("WAWebQueryGetPublicKeyJob",["WADeprecatedSendIq","WADeprecatedWapParser","WAWap","WAWapDeprecatedSmaxID","WAWebBackendErrors","WAWebCommsWapMd","WAWebDefinePersistedJob","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h=new(c("WADeprecatedWapParser"))("getPublicKeyResponse",function(a){a.assertTag("iq");a.assertFromServer();a=(a=a.maybeChild("public_key"))==null?void 0:(a=a.maybeChild("pem"))==null?void 0:a.contentString();return{certificate:a}});a=d("WAWebDefinePersistedJob").defineWebPersistedJob().finalStep("sendStanza",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b;a=a.businessJid;b=(b=d("WAWap")).wap("iq",{to:b.S_WHATSAPP_NET,type:"get",smax_id:b.SMAX_ID(c("WAWapDeprecatedSmaxID").BizGetPublicKey),xmlns:"w:biz:catalog",id:b.generateId()},b.wap("public_key",{jid:d("WAWebCommsWapMd").USER_JID(d("WAWebWidFactory").createWid(a))}));a=(yield d("WADeprecatedSendIq").deprecatedSendIq(b,h));if(!a.success)throw new(d("WAWebBackendErrors").ServerStatusCodeError)(a.errorCode);else return a.result});return function(b){return a.apply(this,arguments)}}()).end();g.QueryGetPublicKey=a}),98);
__d("WAWebQueryGetSignedUserInfoJob",["WADeprecatedSendIq","WADeprecatedWapParser","WAWap","WAWebBackendErrors","WAWebCommsWapMd","WAWebDefinePersistedJob","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(a,b){return a==null?void 0:(a=a.maybeChild(b))==null?void 0:a.contentString()}var i=new(c("WADeprecatedWapParser"))("getSignedUserInfoResponse",function(a){a.assertTag("iq");a.assertFromServer();a=a.maybeChild("signed_user_info");return{phoneNumber:h(a,"phone_number"),phoneNumberSignatureExpiration:h(a,"ttl_timestamp"),phoneNumberSignature:h(a,"phone_number_signature"),businessDomain:h(a,"business_domain")}});a=d("WAWebDefinePersistedJob").defineWebPersistedJob().finalStep("sendStanza",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b;a=a.businessJid;b=(b=d("WAWap")).wap("iq",{to:b.S_WHATSAPP_NET,type:"get",xmlns:"w:biz:catalog",id:b.generateId()},b.wap("signed_user_info",{biz_jid:d("WAWebCommsWapMd").USER_JID(d("WAWebWidFactory").createWid(a))}));a=(yield d("WADeprecatedSendIq").deprecatedSendIq(b,i));if(!a.success)throw new(d("WAWebBackendErrors").ServerStatusCodeError)(a.errorCode);return a.result});return function(b){return a.apply(this,arguments)}}()).end();g.QueryGetSignedUserInfo=a}),98);
__d("WAWebBizCartConstants",[],(function(a,b,c,d,e,f){a=99;f.CART_ITEM_MAX_QUANTITY=a}),66);
__d("WAWebSyntheticCountryCode",["$InternalEnum"],(function(a,b,c,d,e,f){a=b("$InternalEnum")({NotApplicable:"NOT_APPLICABLE"});f.SyntheticCountryCode=a}),66);
__d("WAWebBizCatalogParseProduct",["WAWap","WAWebBizCartConstants","WAWebProductTypes.flow","WAWebSyntheticCountryCode"],(function(a,b,c,d,e,f,g){b=function(a){var b,c,e=a.child("id").contentString(),f=a.maybeChild("url"),g="";f&&f.hasContent()&&(g=f.contentString());f=a.child("name").contentString();b=(b=a.maybeAttrString("availability"))!=null?b:d("WAWebProductTypes.flow").ProductAvailability.UNKNOWN;var h=d("WAWebBizCartConstants").CART_ITEM_MAX_QUANTITY,j=a.maybeAttrString("max_available");j!=null&&(h=Number(j));j=a.maybeChild("max_available");j=j==null?void 0:j.contentString();j!=null&&(h=Number(j));j=a.maybeChild("description");j=j?j.contentString():"";var l=a.maybeChild("belongs_to");l=(l==null?void 0:l.contentString())==="true"||!1;var m=[],n=[],o=[],p=a.child("media"),q=!0;p.forEachChildWithTag("image",function(a){if(q)q=!1,m.push({key:"requested",value:a.child("request_image_url").contentString()}),m.push({key:"full",value:a.child("original_image_url").contentString()}),o.push(a.child("id").contentString());else{var b=[];b.push({key:"requested",value:a.child("request_image_url").contentString()});b.push({key:"full",value:a.child("original_image_url").contentString()});n.push(b);o.push(a.child("id").contentString())}});p=a.maybeChild("status_info");var r=(p==null?void 0:p.child("status").contentString())||"APPROVED";p=p==null?void 0:(p=p.maybeChild("can_appeal"))==null?void 0:p.contentString();r=[{key:"WHATSAPP",value:r}];var s=a.maybeChild("currency");s=s?s.contentString():void 0;var t=a.maybeChild("price");t=t==null?void 0:t.contentString();var u=a.maybeChild("retailer_id");u=u?u.contentString():"";var v=a.hasAttr("is_hidden")?a.attrString("is_hidden")==="true":!1,w=a.hasAttr("compliance_category")?d("WAWebProductTypes.flow").ProductComplianceCategory.cast(a.attrString("compliance_category")):d("WAWebProductTypes.flow").ProductComplianceCategory.Default,x=a.maybeChild("sale_price");c=x?babelHelpers["extends"]({sale_price:(c=x.maybeChild("price"))==null?void 0:c.contentString()},x.hasChild("start_date")&&x.hasChild("end_date")?{sale_start_date:x.child("start_date").contentString(),sale_end_date:x.child("end_date").contentString()}:null):null;x=babelHelpers["extends"]({id:e,is_hidden:v,url:g,name:f,description:j,availability:b,max_available:h,additional_image_cdn_urls:n,image_cdn_urls:m,capability_to_review_status:r,whatsapp_product_can_appeal:p==="true",image_hashes_for_whatsapp:o,currency:s,price:t,retailer_id:u,checkmark:l},c);e=a.maybeChild("compliance_info");w===d("WAWebProductTypes.flow").ProductComplianceCategory.CountryOriginExempt?x.compliance_info=k():e&&(x.compliance_info=i(e));return x};function a(a){var b,c,e=a.id?d("WAWap").wap("id",null,a.id.toString()):void 0,f=a.description?d("WAWap").wap("description",null,a.description):void 0,g=a.url?d("WAWap").wap("url",null,a.url):void 0,i=a.retailerId?d("WAWap").wap("retailer_id",null,a.retailerId):void 0,j=a.priceAmount1000!=null?d("WAWap").wap("currency",null,a.currency):void 0,k=a.priceAmount1000!=null?d("WAWap").wap("price",null,a.priceAmount1000.toString()):void 0;b=[d("WAWap").wap("image",null,d("WAWap").wap("url",null,a.imageCdnUrl))].concat((b=a.additionalImageCdnUrl)==null?void 0:b.map(function(a){return d("WAWap").wap("image",null,d("WAWap").wap("url",null,a))}));var l=h(a.complianceInfo);c=babelHelpers["extends"]({is_hidden:a.isHidden?"true":"false"},((c=a.complianceInfo)==null?void 0:c.countryCodeOrigin)===String(d("WAWebSyntheticCountryCode").SyntheticCountryCode.NotApplicable)?{compliance_category:d("WAWebProductTypes.flow").ProductComplianceCategory.CountryOriginExempt}:void 0);return d("WAWap").wap("product",c,e,d("WAWap").wap("name",null,a.name),f,g,i,d("WAWap").wap("media",null,b),k,j,l)}function h(a){var b=j(a),c=b.isExempt,e=b.hasCountryCodeOrigin,f=b.hasImporterName;b=b.hasImporterAddress;return!c&&(e||f||b)?d("WAWap").wap("compliance_info",null,e?d("WAWap").wap("country_code_origin",null,a==null?void 0:a.countryCodeOrigin):void 0,f?d("WAWap").wap("importer_name",null,a==null?void 0:a.importerName):void 0,b?d("WAWap").wap("importer_address",null,(a==null?void 0:(c=a.importerAddress)==null?void 0:c.street1)?d("WAWap").wap("street1",null,a.importerAddress.street1):void 0,(a==null?void 0:(e=a.importerAddress)==null?void 0:e.street2)?d("WAWap").wap("street2",null,a.importerAddress.street2):void 0,(a==null?void 0:(f=a.importerAddress)==null?void 0:f.city)?d("WAWap").wap("city",null,a.importerAddress.city):void 0,(a==null?void 0:(b=a.importerAddress)==null?void 0:b.region)?d("WAWap").wap("region",null,a.importerAddress.region):void 0,(a==null?void 0:(c=a.importerAddress)==null?void 0:c.postalCode)?d("WAWap").wap("postal_code",null,a.importerAddress.postalCode):void 0,(a==null?void 0:(e=a.importerAddress)==null?void 0:e.countryCode)?d("WAWap").wap("country_code",null,a.importerAddress.countryCode):void 0):void 0):void 0}function i(a){var b,c=a.child("country_code_origin").contentString();b=(b=a.maybeChild("importer_name"))==null?void 0:b.contentString();a=a.maybeChild("importer_address");c={country_code_origin:c,importer_name:b};if(a){c.importer_address={street1:a.child("street1").contentString(),street2:(b=a.maybeChild("street2"))==null?void 0:b.contentString(),postal_code:(b=a.maybeChild("postal_code"))==null?void 0:b.contentString(),city:a.child("city").contentString(),region:(b=a.maybeChild("region"))==null?void 0:b.contentString(),country_code:a.child("country_code").contentString()}}return c}function j(a){var b=(a==null?void 0:a.countryCodeOrigin)===String(d("WAWebSyntheticCountryCode").SyntheticCountryCode.NotApplicable),c=!b&&(a==null?void 0:a.countryCodeOrigin)!==void 0,e=!b&&(a==null?void 0:a.importerName)!==void 0;a=!b&&(a==null?void 0:a.importerAddress)!==void 0&&[a.importerAddress.street1,a.importerAddress.street2,a.importerAddress.city,a.importerAddress.region,a.importerAddress.postalCode,a.importerAddress.countryCode].some(function(a){return a});return{isExempt:b,hasImporterAddress:a,hasImporterName:e,hasCountryCodeOrigin:c}}function k(){return{country_code_origin:String(d("WAWebSyntheticCountryCode").SyntheticCountryCode.NotApplicable)}}g.parseProductNode=b;g.productModelToNode=a;g.scanComplianceInfoForMissingData=j}),98);
__d("WAWebBizParseProductGraphql_product.graphql",[],(function(a,b,c,d,e,f){"use strict";a=function(){var a={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},b={alias:null,args:null,kind:"ScalarField",name:"price",storageKey:null};return{argumentDefinitions:[],kind:"Fragment",metadata:{mask:!1},name:"WAWebBizParseProductGraphql_product",selections:[a,{alias:null,args:null,kind:"ScalarField",name:"retailer_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_hidden",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"product_availability",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_available",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"description",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"currency",storageKey:null},b,{alias:null,args:null,concreteType:"XWAProductCatalogProductStatusInfo",kind:"LinkedField",name:"status_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"can_appeal",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogProductSalePrice",kind:"LinkedField",name:"sale_price",plural:!1,selections:[b,{alias:null,args:null,kind:"ScalarField",name:"start_date",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"end_date",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogProductMedia",kind:"LinkedField",name:"media",plural:!1,selections:[{alias:null,args:null,concreteType:"XWAProductCatalogProductMediaImage",kind:"LinkedField",name:"images",plural:!0,selections:[a,{alias:null,args:null,kind:"ScalarField",name:"original_image_url",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"request_image_url",storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"belongs_to",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"compliance_category",storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogProductComplianceInfo",kind:"LinkedField",name:"compliance_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"country_code_origin",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"importer_name",storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogProductComplianceInfoImporterAddress",kind:"LinkedField",name:"importer_address",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"street1",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"street2",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"postal_code",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"city",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"region",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"country_code",storageKey:null}],storageKey:null}],storageKey:null}],type:"XWACatalogProduct",abstractKey:null}}();a.hash="1692ed525d746a2adf81bc0e9062a879";e.exports=a}),null);
__d("WAWebBizParseProductGraphql",["WANullthrows","WAWebBizCartConstants","WAWebBizParseProductGraphql_product.graphql","WAWebProductTypes.flow","WAWebSyntheticCountryCode","gkx"],(function(a,b,c,d,e,f,g){var h;c("gkx")("26260")&&(h!==void 0?h:h=b("WAWebBizParseProductGraphql_product.graphql"));var i={AVAILABLE_FOR_ANOTHER_POSTCODE:d("WAWebProductTypes.flow").ProductAvailability.AVAILABLE_FOR_ANOTHER_POSTCODE,IN_STOCK:d("WAWebProductTypes.flow").ProductAvailability.IN_STOCK,OUT_OF_STOCK:d("WAWebProductTypes.flow").ProductAvailability.OUT_OF_STOCK};function a(a){var b,e,f=a.status_info,g=a.sale_price,h=a.product_availability,j=a.compliance_info;a=babelHelpers.objectWithoutPropertiesLoose(a,["status_info","sale_price","product_availability","compliance_info"]);b=(b=(b=a.media)==null?void 0:b.images)!=null?b:[];var k=b[0];b=b.slice(1);e=babelHelpers["extends"]({id:c("WANullthrows")(a.id),retailer_id:(e=a.retailer_id)!=null?e:"",name:c("WANullthrows")(a.name),description:(e=a.description)!=null?e:"",url:(e=a.url)!=null?e:"",currency:a.currency,price:a.price,is_hidden:a.is_hidden==="ISHIDDEN_TRUE",max_available:(e=a.max_available)!=null?e:d("WAWebBizCartConstants").CART_ITEM_MAX_QUANTITY,availability:h&&h in i?i[h]:d("WAWebProductTypes.flow").ProductAvailability.UNKNOWN},(g==null?void 0:g.price)!=null?babelHelpers["extends"]({sale_price:g.price},g.start_date!=null&&g.end_date!=null?{sale_start_date:g.start_date,sale_end_date:g.end_date}:null):null,{checkmark:a.belongs_to==="true",image_hashes_for_whatsapp:((h=(e=a.media)==null?void 0:e.images)!=null?h:[]).map(function(a){return c("WANullthrows")(a.id)}),image_cdn_urls:k?[{key:"requested",value:c("WANullthrows")(k.request_image_url)},{key:"full",value:c("WANullthrows")(k.original_image_url)}]:[],additional_image_cdn_urls:b.map(function(a){return[{key:"requested",value:c("WANullthrows")(a.request_image_url)},{key:"full",value:c("WANullthrows")(a.original_image_url)}]}),whatsapp_product_can_appeal:(f==null?void 0:f.can_appeal)==="true",capability_to_review_status:[{key:"WHATSAPP",value:(g=f==null?void 0:f.status)!=null?g:"APPROVED"}]});if(j!=null){h=j.importer_address;e.compliance_info=a.compliance_category==="COMPLIANCECATEGORY_COUNTRYORIGINEXEMPT"?{country_code_origin:d("WAWebSyntheticCountryCode").SyntheticCountryCode.NotApplicable}:{country_code_origin:(k=j.country_code_origin)!=null?k:void 0,importer_name:(b=j.importer_name)!=null?b:void 0,importer_address:{street1:c("WANullthrows")(h==null?void 0:h.street1),street2:(f=h==null?void 0:h.street2)!=null?f:void 0,postal_code:(g=h==null?void 0:h.postal_code)!=null?g:void 0,city:c("WANullthrows")(h==null?void 0:h.city),region:(a=h==null?void 0:h.region)!=null?a:void 0,country_code:c("WANullthrows")(h==null?void 0:h.country_code)}}}return e}g.parseProductGraphQL=a}),98);
__d("WAWebWamEnumBusinessType",[],(function(a,b,c,d,e,f){a=Object.freeze({SMB:1,API_DC:2,API:3});f.BUSINESS_TYPE=a}),66);
__d("WAWebWamEnumGraphqlCatalogEndpoint",[],(function(a,b,c,d,e,f){a=Object.freeze({GET_CATALOG:1,GET_PRODUCT:2,GET_PRODUCT_LIST:3,GET_COLLECTIONS:4,GET_SINGLE_COLLECTION:5,GET_CATEGORIES:6,GET_VARIANTS:7,GET_PROMOTIONS:8});f.GRAPHQL_CATALOG_ENDPOINT=a}),66);
__d("WAWebWamEnumGraphqlRequestResult",[],(function(a,b,c,d,e,f){a=Object.freeze({SUCCESS:1,FAILURE:2});f.GRAPHQL_REQUEST_RESULT=a}),66);
__d("WAWebGraphqlCatalogRequestWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumBusinessType","WAWebWamEnumGraphqlCatalogEndpoint","WAWebWamEnumGraphqlRequestResult"],(function(a,b,c,d,e,f,g){a=d("WAWebWamCodegenUtils").defineEvents({GraphqlCatalogRequest:[3206,{businessJid:[4,d("WAWebWamCodegenUtils").TYPES.STRING],businessType:[5,d("WAWebWamEnumBusinessType").BUSINESS_TYPE],graphqlCatalogEndpoint:[1,d("WAWebWamEnumGraphqlCatalogEndpoint").GRAPHQL_CATALOG_ENDPOINT],graphqlErrorCode:[3,d("WAWebWamCodegenUtils").TYPES.INTEGER],graphqlRequestResult:[2,d("WAWebWamEnumGraphqlRequestResult").GRAPHQL_REQUEST_RESULT]},[1,1,1],"private",0]});g.GraphqlCatalogRequestWamEvent=a}),98);
__d("WAWebCatalogEventLogger",["WAWebGraphqlCatalogRequestWamEvent","WAWebWamEnumGraphqlCatalogEndpoint","WAWebWamEnumGraphqlRequestResult"],(function(a,b,c,d,e,f,g){a=function(a){var b=new(d("WAWebGraphqlCatalogRequestWamEvent").GraphqlCatalogRequestWamEvent)({graphqlCatalogEndpoint:a});return{success:function(){b.set({graphqlErrorCode:-1,graphqlRequestResult:d("WAWebWamEnumGraphqlRequestResult").GRAPHQL_REQUEST_RESULT.SUCCESS}),b.commit()},failure:function(a){a=a[0];b.set({graphqlErrorCode:a.code,graphqlRequestResult:d("WAWebWamEnumGraphqlRequestResult").GRAPHQL_REQUEST_RESULT.FAILURE});b.commit()}}};g.GRAPHQL_CATALOG_ENDPOINT=d("WAWebWamEnumGraphqlCatalogEndpoint").GRAPHQL_CATALOG_ENDPOINT;g.createCatalogEventLogger=a}),98);
__d("WAWebMaybeThrowCatalogErrors",["errorCode","WAWebBackendErrors"],(function(a,b,c,d,e,f,g,h){function a(a){var b=a.source.errors||[];b=b[0];switch(b==null?void 0:b.code){case 2498052:case 2498049:case 2498050:case 2498051:case 2498053:case 2498056:throw new(d("WAWebBackendErrors").ServerStatusCodeError)(400,a.message);case 2498048:throw new(d("WAWebBackendErrors").E451)();case 2498054:throw new(d("WAWebBackendErrors").ServerStatusCodeError)(421)}}g["default"]=a}),98);
__d("WAWebProductMessageListConstant",[],(function(a,b,c,d,e,f){a="DELETED";f.INVALID_PRODUCT_TOKEN=a}),66);
__d("WAWebQueryProductListCatalogJobQuery.graphql",[],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{defaultValue:null,kind:"LocalArgument",name:"request"}],b={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},c={alias:null,args:null,kind:"ScalarField",name:"price",storageKey:null};c=[{alias:null,args:[{kind:"Variable",name:"request",variableName:"request"}],concreteType:"XWAProductCatalogGetProductListResponseSuccess",kind:"LinkedField",name:"xwa_product_catalog_get_product_list",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogGetProductListResponseSuccessProductList",kind:"LinkedField",name:"product_list",plural:!1,selections:[{alias:null,args:null,concreteType:"XWACatalogProduct",kind:"LinkedField",name:"products",plural:!0,selections:[b,{alias:null,args:null,kind:"ScalarField",name:"retailer_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_hidden",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"product_availability",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_available",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"description",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"currency",storageKey:null},c,{alias:null,args:null,concreteType:"XWAProductCatalogProductStatusInfo",kind:"LinkedField",name:"status_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"can_appeal",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogProductSalePrice",kind:"LinkedField",name:"sale_price",plural:!1,selections:[c,{alias:null,args:null,kind:"ScalarField",name:"start_date",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"end_date",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogProductMedia",kind:"LinkedField",name:"media",plural:!1,selections:[{alias:null,args:null,concreteType:"XWAProductCatalogProductMediaImage",kind:"LinkedField",name:"images",plural:!0,selections:[b,{alias:null,args:null,kind:"ScalarField",name:"original_image_url",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"request_image_url",storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"belongs_to",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"compliance_category",storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogProductComplianceInfo",kind:"LinkedField",name:"compliance_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"country_code_origin",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"importer_name",storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogProductComplianceInfoImporterAddress",kind:"LinkedField",name:"importer_address",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"street1",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"street2",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"postal_code",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"city",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"region",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"country_code",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:a,kind:"Fragment",metadata:null,name:"WAWebQueryProductListCatalogJobQuery",selections:c,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:a,kind:"Operation",name:"WAWebQueryProductListCatalogJobQuery",selections:c},params:{id:"WAWebQueryProductListCatalogJobQuery",metadata:{},name:"WAWebQueryProductListCatalogJobQuery",operationKind:"query",text:null}}}();a.hash="5d3b936da25c831ffeb17f59668da9c4";e.exports=a}),null);
__d("WAWebQueryProductListCatalogJob",["WADeprecatedSendIq","WADeprecatedWapParser","WALogger","WANullthrows","WAWap","WAWapDeprecatedSmaxID","WAWebBackendErrors","WAWebBizCatalogParseProduct","WAWebBizGatingUtils","WAWebBizParseProductGraphql","WAWebCatalogEventLogger","WAWebCommsWapMd","WAWebDefinePersistedJob","WAWebGraphQLServerError","WAWebMaybeThrowCatalogErrors","WAWebProductMessageListConstant","WAWebQueryProductListCatalogJobQuery.graphql","WAWebRelayClient","WAWebWidFactory","asyncToGeneratorRuntime","filterNulls"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["GraphQL: Failed fetching xwa_product_catalog_get_product_list query. Falling back to IQ."]);i=function(){return a};return a}var j=new(c("WADeprecatedWapParser"))("productListResponse",function(a){a.assertTag("iq");a.assertFromServer();a=a.child("product_list");var b=[];a.forEachChildWithTag("product",function(a){var c=a.maybeChild("id");if(!c)return;var e=a.maybeChild("status");(e==null?void 0:e.contentString())===d("WAWebProductMessageListConstant").INVALID_PRODUCT_TOKEN?b.push({id:c.contentString(),status:d("WAWebProductMessageListConstant").INVALID_PRODUCT_TOKEN}):b.push(d("WAWebBizCatalogParseProduct").parseProductNode(a))});return b}),k=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b,e=a.catalogWid,f=a.productIds,g=a.width,h=a.height;a=a.directConnectionEncryptedInfo;e=(b=d("WAWap")).wap("iq",{to:b.S_WHATSAPP_NET,type:"get",smax_id:b.SMAX_ID(c("WAWapDeprecatedSmaxID").CatalogGetProductList),xmlns:"w:biz:catalog",id:b.generateId()},b.wap("product_list",{jid:d("WAWebCommsWapMd").USER_JID(d("WAWebWidFactory").createWid(e))},f.map(function(a){return d("WAWap").wap("product",null,d("WAWap").wap("id",null,a))}).concat(c("filterNulls")([b.wap("width",null,g.toString()),b.wap("height",null,h.toString()),a?d("WAWap").wap("direct_connection_encrypted_info",null,a):null]))));f=(yield d("WADeprecatedSendIq").deprecatedSendIq(e,j));if(!f.success)throw new(d("WAWebBackendErrors").ServerStatusCodeError)(f.errorCode);else return f.result});return function(b){return a.apply(this,arguments)}}(),l=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){try{var e=a.catalogWid,f=a.productIds,g=a.width,j=a.height,l=a.directConnectionEncryptedInfo;e=(yield d("WAWebRelayClient").fetchQuery(h!==void 0?h:h=b("WAWebQueryProductListCatalogJobQuery.graphql"),{request:{product_list:{jid:e.toString(),products:f.map(function(a){return{id:a}}),width:String(g),height:String(j),direct_connection_encrypted_info:l}}},{eventLogger:d("WAWebCatalogEventLogger").createCatalogEventLogger(d("WAWebCatalogEventLogger").GRAPHQL_CATALOG_ENDPOINT.GET_PRODUCT_LIST)}));return c("WANullthrows")(e==null?void 0:(f=e.xwa_product_catalog_get_product_list)==null?void 0:(g=f.product_list)==null?void 0:g.products.map(d("WAWebBizParseProductGraphql").parseProductGraphQL))}catch(b){b instanceof d("WAWebGraphQLServerError").GraphQLServerError&&c("WAWebMaybeThrowCatalogErrors")(b);d("WALogger").WARN(i());return k(a)}});return function(b){return a.apply(this,arguments)}}();a=function(a){return(d("WAWebBizGatingUtils").graphQLForCatalogM1Enabled()?l:k)(a)};e=d("WAWebDefinePersistedJob").defineWebPersistedJob().finalStep("sendStanza",a).end();g.QueryProductListCatalog=e}),98);
__d("WAWebSendRequestedKeyShareJob",["WALogger","WAWebDefinePersistedJob","WAWebWidFactory","WAWebWorkerSafeBackendApi","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: end sendRequestedKeyShare job"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: starting sendRequestedKeyShare job"]);i=function(){return a};return a}a=d("WAWebDefinePersistedJob").defineWebPersistedJob().finalStep("sendRequestedKeyShare",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.keys,c=a.orphanKeys;a=a.peerDeviceId;d("WALogger").DEV(i());b={type:"missing_key",keys:b,orphanKeys:c,peerDeviceId:d("WAWebWidFactory").createWid(a)};yield d("WAWebWorkerSafeBackendApi").workerSafeSendAndReceive("sendAppStateSyncKeyShare",{keyShare:b});d("WALogger").DEV(h())});return function(b){return a.apply(this,arguments)}}()).end();g.sendRequestedKeyShare=a}),98);
__d("WAWebSetAboutJob",["WADeprecatedSendIq","WADeprecatedWapParser","WAWap","WAWebDefinePersistedJob","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h=new(c("WADeprecatedWapParser"))("aboutResponse",function(a){a.assertAttr("type","result");return{id:a.attrInt("id")}});a=d("WAWebDefinePersistedJob").defineWebPersistedJob().finalStep("sendStanza",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b;a=a.content;b=(b=d("WAWap")).wap("iq",{to:b.S_WHATSAPP_NET,type:"set",xmlns:"status",id:b.generateId()},b.wap("status",null,a));a=(yield d("WADeprecatedSendIq").deprecatedSendIq(b,h));return!a.success?{status:a.errorCode}:{status:200}});return function(b){return a.apply(this,arguments)}}()).end();g.setAbout=a}),98);
__d("WAWebMexEventWamEvent",["WAWebWamCodegenUtils"],(function(a,b,c,d,e,f,g){b=(a=d("WAWebWamCodegenUtils")).defineEvents({MexEvent:[3782,{isMex:[1,a.TYPES.BOOLEAN],mexEventData:[2,a.TYPES.STRING],mexEventDurationT:[12,a.TYPES.TIMER],mexEventEndTime:[3,a.TYPES.INTEGER],mexEventEnvelopeResponseStatus:[13,a.TYPES.INTEGER],mexEventOperation:[7,a.TYPES.STRING],mexEventPayloadResponseStatus:[14,a.TYPES.INTEGER],mexEventRequestSize:[8,a.TYPES.INTEGER],mexEventResponseSize:[9,a.TYPES.INTEGER],mexEventRetries:[10,a.TYPES.INTEGER],mexEventStartTime:[11,a.TYPES.INTEGER]},[1,1,1],"regular"]});g.MexEventWamEvent=b}),98);
__d("WAWebMexExperiment",["WAWebABProps","WAWebMexEventWamEvent"],(function(a,b,c,d,e,f,g){a=function(){function a(b){this.$1=!1,this.$2="not provided",this.$3=-1,this.$4=-1,this.$5=-1,this.$6=-1,this.$7=-1,this.$2=b,this.$1=a.isGraphQLenabled()}var b=a.prototype;b.toUseGraphQL=function(){return this.$1};b.start=function(){this.$3=Date.now()};b.stop=function(){this.$4=Date.now()};b.logEvent=function(b){var c=b.envelopeResponseStatus;b=b.payloadResponseStatus;if(!a.isExperimentEnabled())return;new(d("WAWebMexEventWamEvent").MexEventWamEvent)({isMex:this.$1,mexEventOperation:this.$2,mexEventStartTime:this.$3,mexEventEndTime:this.$4,mexEventPayloadResponseStatus:b,mexEventEnvelopeResponseStatus:c,mexEventRequestSize:1}).commit()};a.isExperimentEnabled=function(){return d("WAWebABProps").getABPropConfigValue("mex_phase3_enabled")};a.isGraphQLenabled=function(){return a.isExperimentEnabled()&&a.isGraphQLFlagSet()};a.isGraphQLFlagSet=function(){return a.isFlagSet(1)};a.isFlagSet=function(a){var b=d("WAWebABProps").getABPropConfigValue("mex_phase3_status_flags");return(b&a)===a};return a}();g.GraphQlPerfTracker=a}),98);
__d("WAWebTextStatusParseUtils",["WAWebWidFactory"],(function(a,b,c,d,e,f,g){var h=0;function a(a){var b;return{id:d("WAWebWidFactory").createWid(a.jid),textStatusString:a.text,textStatusEmoji:(b=a.emoji)==null?void 0:b.content,textStatusEphemeralDuration:a.ephemeral_duration_sec,textStatusLastUpdateTime:a.last_update_time!=null?Number(a.last_update_time):void 0}}function b(a){return{jid:a.id.toJid(),last_update_time:(a=a.textStatusLastUpdateTime)==null?void 0:a.toString()}}function c(a){var b=a.textStatusString;a.textStatusString===""&&(b=null);var c=a.textStatusEphemeralDuration;c==null&&(c=h);b==null&&a.textStatusEmoji==null&&c!==h&&(c=h);var d;a.textStatusEmoji!=null&&(d={content:a.textStatusEmoji});return{text:b,emoji:d,ephemeral_duration_sec:c}}g.parseTextStatusServerResponse=a;g.createTextStatusObjectForGetRequest=b;g.createTextStatusObjectForUpdateRequest=c}),98);
__d("WAWebMexUpdateTextStatusJob",["WALogger","WAWebMexClient","WAWebMexUpdateTextStatusJobMutation.graphql","WAWebTextStatusParseUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[MEX][TEXTSTATUS] Updated text status via mex"]);i=function(){return a};return a}function a(a,b,c){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){var f=h!==void 0?h:h=b("WAWebMexUpdateTextStatusJobMutation.graphql");a=d("WAWebTextStatusParseUtils").createTextStatusObjectForUpdateRequest({textStatusString:a,textStatusEmoji:c,textStatusEphemeralDuration:e});c={input:a};e=(yield d("WAWebMexClient").fetchQuery(f,c));d("WALogger").DEV(i()).tags("GQL","MEX").devConsole({response:e});return e});return j.apply(this,arguments)}g.mexUpdateTextStatus=a}),98);
__d("WAWebUpdateTextStatusJob",["WALogger","WAWebMexExperiment","WAWebMexUpdateTextStatusJob","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["updateTextStatus:",""]);h=function(){return a};return a}function a(a,b,c,d){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){var f=new(d("WAWebMexExperiment").GraphQlPerfTracker)("update-text-status");f.start();f.toUseGraphQL();b=(yield d("WAWebMexUpdateTextStatusJob").mexUpdateTextStatus(b,c,e));e=(c=b.xwa2_update_text_status)==null?void 0:c.result;f.stop();d("WALogger").LOG(h(),a.toString()).devConsole(b);return{id:a,result:e}});return i.apply(this,arguments)}g.updateTextStatus=a}),98);
__d("WAWebSetTextStatusJob",["WAWebDefinePersistedJob","WAWebUpdateTextStatusJob","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){a=d("WAWebDefinePersistedJob").defineWebPersistedJob().finalStep("sendMex",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.id,c=a.text,e=a.emoji;a=a.ephemeralDurationSeconds;b=(yield d("WAWebUpdateTextStatusJob").updateTextStatus(b,c,e,a));return b});return function(b){return a.apply(this,arguments)}}()).end();g.setTextStatus=a}),98);
__d("WAWebVerifyPostcodeJob",["WADeprecatedSendIq","WADeprecatedWapParser","WAWap","WAWapDeprecatedSmaxID","WAWebBackendErrors","WAWebCommsWapMd","WAWebDefinePersistedJob","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h=new(c("WADeprecatedWapParser"))("productResponse",function(a){a.assertTag("iq");a.assertFromServer();var b=a.child("result_code");a=a.maybeChild("encrypted_location_name");a=a==null?void 0:a.contentString();b=b.contentString();return{resultCode:b,encryptedLocationName:a}});a=d("WAWebDefinePersistedJob").defineWebPersistedJob().finalStep("sendStanza",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b,e=a.businessJid;a=a.directConnectionEncryptedInfo;e=(b=d("WAWap")).wap("iq",{id:b.generateId(),xmlns:"w:biz:catalog",type:"get",to:b.S_WHATSAPP_NET,smax_id:b.SMAX_ID(c("WAWapDeprecatedSmaxID").CatalogVerifyPostcode)},b.wap("verify_postcode",{biz_jid:d("WAWebCommsWapMd").USER_JID(d("WAWebWidFactory").createWid(e))},b.wap("direct_connection_encrypted_info",null,a)));b=(yield d("WADeprecatedSendIq").deprecatedSendIq(e,h));if(!b.success)throw new(d("WAWebBackendErrors").ServerStatusCodeError)(b.errorCode);else return b.result});return function(b){return a.apply(this,arguments)}}()).end();g.VerifyPostcode=a}),98);
__d("WAWebPersistedJob",["Promise","WAWebDeleteAddonsJob","WAWebDeleteReactionsJob","WAWebJobDismissQuickPromotion","WAWebJobImpressionOnQuickPromotion","WAWebJobPrimaryActionClickInQuickPromotion","WAWebJobUserExposureToQuickPromotion","WAWebQueryAndUpdateGroupsMetadataByJidsJob","WAWebQueryGetPublicKeyJob","WAWebQueryGetSignedUserInfoJob","WAWebQueryProductListCatalogJob","WAWebRotateKeyJob","WAWebSendRequestedKeyShareJob","WAWebSetAboutJob","WAWebSetTextStatusJob","WAWebVerifyPostcodeJob"],(function(a,b,c,d,e,f){var g;function a(a){h(a,{rotateKey:function(){return(g||(g=b("Promise"))).resolve(b("WAWebRotateKeyJob").rotateKey)},setAbout:function(){return(g||(g=b("Promise"))).resolve(b("WAWebSetAboutJob").setAbout)},setTextStatus:function(){return(g||(g=b("Promise"))).resolve(b("WAWebSetTextStatusJob").setTextStatus)},queryProductList:function(){return(g||(g=b("Promise"))).resolve(b("WAWebQueryProductListCatalogJob").QueryProductListCatalog)},getPublicKey:function(){return(g||(g=b("Promise"))).resolve(b("WAWebQueryGetPublicKeyJob").QueryGetPublicKey)},getSignedUserInfo:function(){return(g||(g=b("Promise"))).resolve(b("WAWebQueryGetSignedUserInfoJob").QueryGetSignedUserInfo)},verifyPostcode:function(){return(g||(g=b("Promise"))).resolve(b("WAWebVerifyPostcodeJob").VerifyPostcode)},deleteReactions:function(){return(g||(g=b("Promise"))).resolve(b("WAWebDeleteReactionsJob").deleteReactions)},deleteReactionsV2:function(){return(g||(g=b("Promise"))).resolve(b("WAWebDeleteAddonsJob").deleteReactionsV2)},deleteAddOns:function(){return(g||(g=b("Promise"))).resolve(b("WAWebDeleteAddonsJob").deleteAddOns)},sendRequestedKeyShare:function(){return(g||(g=b("Promise"))).resolve(b("WAWebSendRequestedKeyShareJob").sendRequestedKeyShare)},dismissQuickPromotion:function(){return(g||(g=b("Promise"))).resolve(b("WAWebJobDismissQuickPromotion").dismissQuickPromotion)},primaryActionClickInQuickPromotion:function(){return(g||(g=b("Promise"))).resolve(b("WAWebJobPrimaryActionClickInQuickPromotion").primaryActionClickInQuickPromotion)},impressionOnQuickPromotion:function(){return(g||(g=b("Promise"))).resolve(b("WAWebJobImpressionOnQuickPromotion").impressionOnQuickPromotion)},userExposureToQuickPromotion:function(){return(g||(g=b("Promise"))).resolve(b("WAWebJobUserExposureToQuickPromotion").userExposureToQuickPromotion)},queryAndUpdateGroupsMetadataByJids:function(){return(g||(g=b("Promise"))).resolve(b("WAWebQueryAndUpdateGroupsMetadataByJidsJob").queryAndUpdateGroupsMetadataByJidsJob)}})}function h(a,b){Object.keys(b).forEach(function(c){Object.prototype.hasOwnProperty.call(b,c)&&a.addPersistedJobImplementation(c,b[c])})}f["default"]=a}),66);
__d("WAWebJobsStorageUtils",["invariant","Promise","WAWebIdb","WAWebStorage","err"],(function(a,b,c,d,e,f,g,h){var i,j="jobs-storage",k=null;function a(){var a=new(c("WAWebIdb"))(j);k=new(d("WAWebStorage").Storage)(a)}function e(){k!=null||h(0,56369);return k}function f(){return k==null?(i||(i=b("Promise"))).reject(c("err")("[jobs-storage] Storage should be created first before being destroyed")):k.purge().then(function(){k=null})["catch"](function(a){k=null;throw a})}g.DATABASE_NAME=j;g.createStorage=a;g.getStorage=e;g.destroyStorage=f}),98);
__d("WAWebJobsStorageVersions",["WAWebJobsStorageUtils"],(function(a,b,c,d,e,f,g){c=1;function a(){return d("WAWebJobsStorageUtils").getStorage().versions.version(0)}function b(){return d("WAWebJobsStorageUtils").getStorage().versions.version(1)}g.versionToRollout=c;g.jobsCreateV1Table=a;g.jobsCreateV2Table=b}),98);
__d("WAWebSchemaJobs",["WAWebJobsStorageUtils","WAWebJobsStorageVersions","WAWebStorageMutationBuilder"],(function(a,b,c,d,e,f,g){c=d("WAWebStorageMutationBuilder").columnBuilder();var h=c.addColumn,i=c.addAutoIncrementingPrimaryKey,j=c.addIndex,k=c.removeColumn;function a(){d("WAWebJobsStorageUtils").getStorage().add("jobs-store").version(d("WAWebJobsStorageVersions").jobsCreateV1Table(),[i("jobId"),h("type"),h("uniqKey"),j("uniqKey"),h("original"),h("current"),h("step"),h("startTime"),h("endTime"),h("stepHardStartCountAfterTimeout"),h("stepFirstStartTime"),h("waitUntil"),h("backedOffCount"),h("version")]).version(d("WAWebJobsStorageVersions").jobsCreateV2Table(),[h("stepUnexpectedErrorCount"),k("endTime")]).view(function(a){return{jobId:a.jobId,type:a.type,uniqKey:a.uniqKey,original:a.original,current:a.current,step:a.step,startTime:a.startTime,stepHardStartCountAfterTimeout:a.stepHardStartCountAfterTimeout,stepFirstStartTime:a.stepFirstStartTime,waitUntil:a.waitUntil,backedOffCount:a.backedOffCount,version:a.version,stepUnexpectedErrorCount:a.stepUnexpectedErrorCount}})}function b(){return d("WAWebJobsStorageUtils").getStorage().table("jobs-store")}g.addTable=a;g.getTable=b}),98);
__d("WAWebJobsStorage",["WALogger","WAWeb-dexie","WAWebDbRolloutUtil","WAWebDexieCastTypes","WAWebJobsStorageUtils","WAWebSchemaJobs","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Assertion failed!"]);h=function(){return a};return a}var i;function a(){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){i==null&&(yield d("WAWebDbRolloutUtil").loadSchemaVersions(),d("WAWebJobsStorageUtils").createStorage(),d("WAWebSchemaJobs").addTable(),i=d("WAWebJobsStorageUtils").getStorage().initialize()["catch"](function(a){d("WALogger").ERROR(h()).verbose().devConsole(a).tags("sad").sendLogs("Failed to initialize jobs storage");throw a}));return i});return j.apply(this,arguments)}function e(){return d("WAWebJobsStorageUtils").destroyStorage()["catch"](function(){return d("WAWebDexieCastTypes").dexieCastToPromise(new(c("WAWeb-dexie"))(d("WAWebJobsStorageUtils").DATABASE_NAME)["delete"]())})["finally"](function(){i=null})}g.initialize=a;g.destroy=e}),98);
__d("WAWebPersistedJobManager",["Promise","WAHex","WAPersistedJobManager","WATimeUtils","WAWebJobsStorage","WAWebPersistedJob","WAWebSchemaJobs","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){var h,i=null;function a(){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield d("WAWebJobsStorage").initialize();var a=d("WAWebSchemaJobs").getTable();i=new(d("WAPersistedJobManager").PersistedJobManager)({accessors:k(),unfinishedJobEntries:a.all(),isRestartAfterCrash:!1,listeners:{onJobStarted:function(){},onJobFinished:function(){return null}},deprecatedJobs:{}});c("WAWebPersistedJob")(i)});return j.apply(this,arguments)}function k(){return{deletePersistedJob:function(a){var b=d("WAWebSchemaJobs").getTable();return b.remove(a)},updatePersistedJob:function(a){var b=d("WAWebSchemaJobs").getTable();return b.createOrReplace(a)},readPersistedJob:function(a){var b=d("WAWebSchemaJobs").getTable();return b.get(a)},loadAllJobs:function(){var a=d("WAWebSchemaJobs").getTable();return a.all()},maybeCreateJob:l}}function l(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c,e=d("WAWebSchemaJobs").getTable();c=JSON.stringify([a.type,(c=a.uniqKey)!=null?c:d("WAHex").randomHex(32)]);c={type:a.type,uniqKey:c,startTime:d("WATimeUtils").unixTime(),version:(c=a.version)!=null?c:1,original:a.args,current:a.args,step:d("WAPersistedJobManager").UNSTARTED_JOB,waitUntil:null,stepFirstStartTime:null,stepHardStartCountAfterTimeout:0,stepUnexpectedErrorCount:0,backedOffCount:0};if(a.uniqKey==null)return e.createOrReplace(c).then(function(a){return{id:a,newlyCreated:!0}});a=(yield e.equals(["uniqKey"],[a.uniqKey]));if(a.length===0)return e.createOrReplace(c).then(function(a){return{id:a,newlyCreated:!0}});var f=[],g=null;for(a of a)a.step!==d("WAPersistedJobManager").FINISHED_JOB?g=a:f.push(e.remove(a.jobId));yield (h||(h=b("Promise"))).all(f);return g!=null?{id:g.jobId,newlyCreated:!1}:e.createOrReplace(c).then(function(a){return{id:a,newlyCreated:!0}})});return m.apply(this,arguments)}function e(){if(i==null)throw c("err")("jobs manager has not been initialized");return i}g.startWebPersistedJobManager=a;g.maybeCreateJob=l;g.getJobManager=e}),98);
__d("WAWebDBDeleteReactions",["WAWebModelStorageUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a){var c=[];return d("WAWebModelStorageUtils").getStorage().lock(["reactions"],function(){var d=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){b=b[0];var d=(yield b.equals(["parentMsgKey"],a));d.forEach(function(a){return c.push([a.parentMsgKey,a.senderUserJid])});return b.bulkRemove(c)});return function(a){return d.apply(this,arguments)}}())}function c(a){var c=[];return d("WAWebModelStorageUtils").getStorage().lock(["reactions"],function(){var d=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){b=b[0];var d=(yield b.anyOf(["parentMsgKey"],a));d.forEach(function(a){return c.push([a.parentMsgKey,a.senderUserJid])});yield b.bulkRemove(c);return d.map(function(a){return a.msgKey})});return function(a){return d.apply(this,arguments)}}())}function e(a){return d("WAWebModelStorageUtils").getStorage().lock(["reactions"],function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){b=b[0];yield b.bulkRemove(a)});return function(a){return c.apply(this,arguments)}}())}g.deleteReactionsByParentMessageKey=a;g.deleteReactionsByParentMessageKeys=c;g.deleteReactionsByRecords=e}),98);
__d("WAWebDeleteLastAddOnsPreview",["WAWebApiChat","WAWebMsgKey","WAWebShouldUpdateLastAddOnPreview","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=new Set(a.map(function(a){return c("WAWebMsgKey").fromString(a).remote.toString()}));b=(yield d("WAWebShouldUpdateLastAddOnPreview").bulkGetChatLastAddOnPreviewMap(Array.from(b)));var e=new Map();b.forEach(function(b,c){a.includes(b==null?void 0:b.parentMsgKey)&&e.set(c,void 0)});yield d("WAWebApiChat").bulkUpdateChatLastAddOnPreview(e)});return h.apply(this,arguments)}g.deleteLastAddOnsPreview=a}),98);
__d("WAWebDeleteAddonsJob",["Promise","WALogger","WAWebDBCRUDOperationsPinInChat","WAWebDBDeleteReactions","WAWebDBGetReactions","WAWebDBMessageDelete","WAWebDBPollsDeleteVotes","WAWebDefinePersistedJob","WAWebDeleteLastAddOnsPreview","WAWebMsgKey","WAWebPinMsgGatingUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Persisted: deletePins finished"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Persisted deletePins persisted job started for ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Persisted: deletePollVotes job finished for ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Persisted: deletePollVotes job started for ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Persisted: deleteReactionsV2 finished"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Persisted: Deleting reactions from Reactions table"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Persisted: Deleting reactions from Msg table"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["Persisted: deleteReactionsV2 finished, no reactionsMsgKeys"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["Persisted: deleteReactionsV2 persisted job started for ",""]);q=function(){return a};return a}a=d("WAWebDefinePersistedJob").defineWebPersistedJob().finalStep("deleteAddOns",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=a.chatId;a=a.parentMsgKeys;c=(yield (h||(h=b("Promise"))).allSettled([r({chatId:c,parentMsgKeys:a}),t({chatId:c,parentMsgKeys:a}),v({chatId:c,parentMsgKeys:a})]));for(a of c)if(a.status==="rejected")throw a.reason});return function(b){return a.apply(this,arguments)}}()).end();e=d("WAWebDefinePersistedJob").defineWebPersistedJob().finalStep("deleteReactionsV2",function(a){var b=a.chatId;a=a.parentMsgKeys;return r({chatId:b,parentMsgKeys:a})}).end();function r(a){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.chatId;a=a.parentMsgKeys;d("WALogger").LOG(q(),b);b=(yield d("WAWebDBGetReactions").getAllReactionsFromParentMsgs(a));var e=b.map(function(a){return a.msgKey});if(e.length===0){d("WALogger").LOG(p());return}var f=[];e.forEach(function(a){c("WAWebMsgKey").fromString(a).fromMe&&f.push(a)});f.length>0&&(d("WALogger").DEV(o()),yield d("WAWebDBMessageDelete").removeMessagesFromHistory(f));e=b.map(function(a){return[a.parentMsgKey,a.senderUserJid]});d("WALogger").DEV(n());yield d("WAWebDBDeleteReactions").deleteReactionsByRecords(e);yield d("WAWebDeleteLastAddOnsPreview").deleteLastAddOnsPreview(a);d("WALogger").LOG(m())});return s.apply(this,arguments)}function t(a){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.chatId;a=a.parentMsgKeys;d("WALogger").LOG(l(),b);yield d("WAWebDBPollsDeleteVotes").deleteVotesByParentMsgKeys(a);d("WALogger").LOG(k(),b)});return u.apply(this,arguments)}function v(a){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.chatId;a=a.parentMsgKeys;if(!d("WAWebPinMsgGatingUtils").isPinnedMessagesM1ReceiverEnabled())return;d("WALogger").LOG(j(),b);yield d("WAWebDBCRUDOperationsPinInChat").removePinInChatByParentMsgKeys(a);d("WALogger").LOG(i())});return w.apply(this,arguments)}g.deleteAddOns=a;g.deleteReactionsV2=e}),98);
__d("WAWebMarkAddOnsAsReadJob",["Promise","WAJobOrchestratorTypes","WAWebAddOnsMarkAddOnsAsReadDb","WAWebAddonMarkAsReadUtils","WAWebBackendApi","WAWebOrchestratorNonPersistedJob","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("markAddOnsAsRead",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("WAWebAddOnsMarkAddOnsAsReadDb").markAddOnsAsReadDb(a.updates),d("WAWebBackendApi").frontendFireAndForget("markAddOnsAsReadUi",{updatedMsgKeys:a.updates})});return function(b){return a.apply(this,arguments)}}(),{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.LOW}).waitUntilCompleted({updates:a})});return i.apply(this,arguments)}function c(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("markAddOnsAsReadUsingAddonInfra",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){return d("WAWebAddonMarkAsReadUtils").processMarkAsRead(a.addons)});return function(b){return a.apply(this,arguments)}}(),{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.LOW}).waitUntilCompleted({addons:a})});return j.apply(this,arguments)}function e(a){return a.length===0?(h||(h=b("Promise"))).resolve({updatedAddOns:new Map(),updatedOrphans:[]}):d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("markUnclassifiedAddOnsAsRead",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("WAWebAddOnsMarkAddOnsAsReadDb").markUnclassifiedAddOnsAsReadDb(a.msgKeys));d("WAWebBackendApi").frontendFireAndForget("markAddOnsAsReadUi",{updatedMsgKeys:a.updatedAddOns});return a});return function(b){return a.apply(this,arguments)}}(),{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION}).waitUntilCompleted({msgKeys:a})}g.markAddOnsAsReadJob=a;g.markAddOnsAsReadUsingAddonInfraJob=c;g.markUnclassifiedAddOnsAsReadJob=e}),98);
__d("WAWebIsSystemCapableOfVoip",["Promise"],(function(a,b,c,d,e,f){var g;function a(){return(g||(g=b("Promise"))).resolve(!1)}f["default"]=a}),66);
__d("WAWebWebcRawPlatformsWamEvent",["WAWebWamCodegenUtils"],(function(a,b,c,d,e,f,g){a=d("WAWebWamCodegenUtils").defineEvents({WebcRawPlatforms:[2416,{webcRawPlatform:[1,d("WAWebWamCodegenUtils").TYPES.STRING]},[1,1,1],"regular"]});g.WebcRawPlatformsWamEvent=a}),98);
__d("WAWebConnModel",["WALogger","WAWebBaseModel","WAWebCmd","WAWebIsSystemCapableOfVoip","WAWebL10N","WAWebL10NConstants","WAWebLazyLoadedMainRequires","WAWebMobilePlatforms","WAWebUserPrefsGeneral","WAWebUserPrefsMeUser","WAWebVoipGkUtils","WAWebWamEnumPlatformType","WAWebWamGlobals","WAWebWebcRawPlatformsWamEvent","gkx","lodash"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Conn: platform change: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Conn: updateVoipAvailability, getMaybeMeUser undefined"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Conn: updateVoipAvailability, isSystemCapableOfVoip false"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Conn: updateVoipAvailability, Voip initialized: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Conn: updateVoipAvailability, isSystemCapableOfVoip true"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Conn: updateVoipAvailability, Voip GK false"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Conn: updateVoipAvailability"]);n=function(){return a};return a}a=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,e;for(var f=arguments.length,g=new Array(f),h=0;h<f;h++)g[h]=arguments[h];return(b=e=a.call.apply(a,[this].concat(g))||this,e.id=d("WAWebBaseModel").prop(),e.ref=d("WAWebBaseModel").prop(),e.refTTL=d("WAWebBaseModel").prop(),e.refId=d("WAWebBaseModel").prop(),e.wid=d("WAWebBaseModel").prop(),e.connected=d("WAWebBaseModel").prop(),e.protoVersion=d("WAWebBaseModel").prop(),e.clientToken=d("WAWebBaseModel").prop(),e.serverToken=d("WAWebBaseModel").prop(),e.secret=d("WAWebBaseModel").prop(),e.isResponse=d("WAWebBaseModel").prop(),e.lc=d("WAWebBaseModel").prop(),e.lg=d("WAWebBaseModel").prop(),e.locales=d("WAWebBaseModel").prop(),e.is24h=d("WAWebBaseModel").prop(),e.platform=d("WAWebBaseModel").prop(),e.phone=d("WAWebBaseModel").prop(),e.tos=d("WAWebBaseModel").prop(),e.smbTos=d("WAWebBaseModel").prop(0),e.pushname=d("WAWebBaseModel").prop(),e.blockStoreAdds=d("WAWebBaseModel").session(!1),e.meReadyTriggered=d("WAWebBaseModel").session(!1),e.isVoipInitialized=d("WAWebBaseModel").session(!1),e.refExpiry=d("WAWebBaseModel").derived(function(){return Date.now()+this.refTTL},["ref","refTTL"]),e.locale=d("WAWebBaseModel").derived(function(){return this.formatLocale(this.lg,this.lc)},["lg","lc"]),e.localesList=d("WAWebBaseModel").derived(function(){return!this.locales||!this.locales.length?!this.lg?[]:[[this.lg,this.lc]]:this.locales.split(",").map(function(a){a=a.split("-");var b=a[0];a=a[1];return!b?null:[b,a]}).filter(Boolean)},["locales","lg","lc"]),e.allLocales=d("WAWebBaseModel").derived(function(){var a=this;return c("lodash").uniq(this.localesList.map(function(b){var c=b[0];b=b[1];return a.formatLocale(c,b)})).filter(Boolean)},["localesList"]),e.allLanguages=d("WAWebBaseModel").derived(function(){return c("lodash").uniq(this.localesList.map(function(a){var b=a[0];a[1];return b}))},["localesList"]),e.platformField=d("WAWebBaseModel").derived(function(){if(this.platform==="wp7")return d("WAWebWamEnumPlatformType").PLATFORM_TYPE.WP;else if(this.platform)return d("WAWebWamEnumPlatformType").PLATFORM_TYPE[this.platform.toUpperCase()]||d("WAWebWamEnumPlatformType").PLATFORM_TYPE.UNKNOWN;return d("WAWebWamEnumPlatformType").PLATFORM_TYPE.UNKNOWN},["platform"]),e.tosShowCallNotification=d("WAWebBaseModel").derived(function(){return!0},["tos"]),e.isSMB=d("WAWebBaseModel").derived(function(){return this.platform===d("WAWebMobilePlatforms").PLATFORMS.SMBA||this.platform===d("WAWebMobilePlatforms").PLATFORMS.SMBI},["platform"]),b)||babelHelpers.assertThisInitialized(e)}var e=b.prototype;e.initialize=function(){var a=this;d("WAWebBaseModel").BaseModel.prototype.initialize.call(this);this.listenTo(this,"change:locale",function(a,b){c("WAWebL10N").setLocale(b,d("WAWebL10NConstants").L10N_PRIORITY.PHONE)});this.listenTo(this,"change:phone",function(){o(a.phone)});this.listenTo(this,"change:platform",this.$ConnImpl1);this.listenTo(d("WAWebCmd").Cmd,"main_stream_mode_ready_legacy",this.updateVoipAvailability)};e["delete"]=function(){d("WAWebUserPrefsGeneral").setPushname(),this.clear()};e.canSetMyPushname=function(){return!this.isSMB};e.updateVoipAvailability=function(){var a=this;d("WALogger").LOG(n());d("WAWebLazyLoadedMainRequires").requireVoip().then(function(b){if(!c("WAWebVoipGkUtils").isVoiceCallEnabled()&&!c("WAWebVoipGkUtils").isVideoCallEnabled()){d("WALogger").LOG(m());b.cleanup();a.isVoipInitialized=!1;return}a.id&&d("WAWebUserPrefsMeUser").getMaybeMeUser()?c("WAWebIsSystemCapableOfVoip")().then(function(c){c?(d("WALogger").LOG(l()),b.init().then(function(c){d("WALogger").LOG(k(),c),a.isVoipInitialized=c,c&&b.updateAudioVideoSwitch()})):(d("WALogger").LOG(j()),b.cleanup(),a.isVoipInitialized=!1)}):(d("WALogger").LOG(i()),b.cleanup(),a.isVoipInitialized=!1)})};e.$ConnImpl1=function(){d("WALogger").LOG(h(),this.platform),this.platform&&d("WAWebWamGlobals").Global.set({webcPhonePlatform:this.platformField}),c("gkx")("26259")&&new(d("WAWebWebcRawPlatformsWamEvent").WebcRawPlatformsWamEvent)({webcRawPlatform:this.platform}).commit()};e.formatLocale=function(a,b){return!a?null:b?a.toLowerCase()+"-"+b.toUpperCase():a.toLowerCase()};e.shouldSaveToCache=function(){return!!d("WAWebUserPrefsMeUser").getMe()&&!!this.id};return b}(d("WAWebBaseModel").BaseModel);a.Proxy="conn";function o(a){a===void 0&&(a={});var b=a,c=b.mcc;b=b.mnc;c&&typeof c==="string"&&(c=parseInt(c,10));b&&typeof b==="string"&&(b=parseInt(b,10));d("WAWebWamGlobals").Global.set({mcc:c!=null?c:null,mnc:b!=null?b:null,webcPhoneDeviceManufacturer:a.device_manufacturer||null,webcPhoneDeviceModel:a.device_model||null,webcPhoneOsBuildNumber:a.os_build_number||null,webcPhoneOsVersion:a.os_version||null,webcPhoneAppVersion:a.wa_version||null})}b=d("WAWebBaseModel").defineModel(a);e=new b({id:"1"});g.ConnImpl=a;g.Conn=e}),98);
__d("WAWebABPropsSaga",["WAWebABProps","WAWebConnModel"],(function(a,b,c,d,e,f,g){function a(){return!d("WAWebConnModel").Conn.isSMB&&d("WAWebABProps").getABPropConfigValue("saga_enabled")}function b(){return!d("WAWebConnModel").Conn.isSMB&&d("WAWebABProps").getABPropConfigValue("saga_copy")}function c(){return!d("WAWebConnModel").Conn.isSMB&&d("WAWebABProps").getABPropConfigValue("saga_v1_test_enabled")}function e(){return d("WAWebConnModel").Conn.isSMB?0:d("WAWebABProps").getABPropConfigValue("saga_mvp_value")}function f(){return d("WAWebABProps").getABPropConfigValue("support_message_feedback_enabled")}g.getIsSagaEnabled=a;g.getIsSagaCopyEnabled=b;g.getIsSagaV1TestEnabled=c;g.getSagaMVPValue=e;g.getSagaFeedbackEnabled=f}),98);
__d("WAWebApiBusinessProfile",["WALogger","WAWebBotTypes","WAWebSchemaBusinessProfile","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["businessProfileFromDbRow: commands parsing failed"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["businessProfileFromDbRow: commands are not an array"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["businessProfileFromDbRow: prompts parsing failed"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["businessProfileFromDbRow: prompts are not an array"]);k=function(){return a};return a}function l(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){return d("WAWebSchemaBusinessProfile").getBusinessProfileTable().get(a)});return m.apply(this,arguments)}function a(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield l(a));return!a?null:p(a)});return n.apply(this,arguments)}function c(a){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=q(a);yield d("WAWebSchemaBusinessProfile").getBusinessProfileTable().createOrMerge(a.id,a)});return o.apply(this,arguments)}function p(a){var b=a.commandsDescription,c=d("WAWebWidFactory").createWid(a.id),e=d("WAWebBotTypes").BizBotAutomatedType.cast(a.automatedType),f=d("WAWebBotTypes").BotWelcomeMsgProtocolModeType.cast(a.welcomeMsgProtocolMode),g;if(a.prompts!=null)try{g=JSON.parse(a.prompts),Array.isArray(g)||(g=null,d("WALogger").ERROR(k()).sendLogs("businessProfileFromDbRow: prompts are not an array"))}catch(a){d("WALogger").ERROR(j()).sendLogs("businessProfileFromDbRow: prompts parsing failed")}var l;if(a.commands!=null)try{l=JSON.parse(a.commands),Array.isArray(l)||(l=null,d("WALogger").ERROR(i()).sendLogs("businessProfileFromDbRow: commands are not an array"))}catch(a){d("WALogger").ERROR(h()).sendLogs("businessProfileFromDbRow: commands parsing failed")}return{id:c,automatedType:e,welcomeMsgProtocolMode:f,prompts:g,commands:l,commandsDescription:b}}function q(a){var b=a.commandsDescription,c=a.id.toString(),d;a.automatedType&&(d=a.automatedType);var e;a.welcomeMsgProtocolMode&&(e=a.welcomeMsgProtocolMode);var f=a.prompts?JSON.stringify(a.prompts):void 0;a=a.commands?JSON.stringify(a.commands):void 0;return{id:c,automatedType:d,welcomeMsgProtocolMode:e,prompts:f,commandsDescription:b,commands:a}}g.getBusinessProfileRow=l;g.getBusinessProfileRecord=a;g.createOrMergeBusinessProfileRecord=c;g.businessProfileFromDbRow=p;g.businessProfileToDbRow=q}),98);
__d("WAWebApiOrphanTcToken",["WAWebSchemaOrphanTcToken"],(function(a,b,c,d,e,f,g){function a(a){return d("WAWebSchemaOrphanTcToken").getOrphanTcTokenTable().remove(a)}function b(a){return d("WAWebSchemaOrphanTcToken").getOrphanTcTokenTable().get(a)}function c(a,b){return d("WAWebSchemaOrphanTcToken").getOrphanTcTokenTable().createOrMerge(a,babelHelpers["extends"]({chatId:a},b))}g.removeOrphanTcToken=a;g.getOrphanTcToken=b;g.createOrUpdateOrphanTcToken=c}),98);
__d("WAWebApiVerifiedBusinessName",["$InternalEnum","WAWebHandleMsgTypes.flow","WAWebSchemaVerifiedBusinessName","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(){return d("WAWebSchemaVerifiedBusinessName").getVerifiedBusinessNameTable().all()}var h=b("$InternalEnum").Mirrored(["Replace","Merge"]);function i(a){return d("WAWebSchemaVerifiedBusinessName").getVerifiedBusinessNameTable().get(m(a))}function c(a,b,c){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){c===void 0&&(c=h.Replace);var e=d("WAWebSchemaVerifiedBusinessName").getVerifiedBusinessNameTable();a=m(a);b=babelHelpers["extends"]({},b,{id:a});c===h.Replace?yield e.createOrReplace(b):yield e.createOrMerge(a,b)});return j.apply(this,arguments)}function e(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield i(a));return(a==null?void 0:a.privacyMode)==null?null:l(a.privacyMode)});return k.apply(this,arguments)}function l(a){var b=d("WAWebHandleMsgTypes.flow").ActualActorsEnumType.cast(a.actualActors),c=d("WAWebHandleMsgTypes.flow").HostStorageEnumType.cast(a.hostStorage);return b==null||c==null?null:{actualActors:b,hostStorage:c,privacyModeTs:a.privacyModeTs}}function m(a){return a.isLid()?a.toString():a.user}g.getAllVerifiedNames=a;g.VerifiedBusinessNameUpdateType=h;g.getVerifiedBusinessNameRecord=i;g.createOrUpdateVerifiedBusinessName=c;g.getPrivacyMode=e;g.convertPrivacyModeFromStorageType=l}),98);
__d("WAWebChatOriginTypes",[],(function(a,b,c,d,e,f){a=new Set(["createChat","createChatOnNewMsg","debugOpenChatFlow","debugConvertToLidChat","debugCreateChat","jest","updateDeviceTableApi","fixturesChatFactory","securityCodeApi","restoreMessagesForChat","processUnreadMessage","loadLastMessagesFromDb","processPreviewMessageInChat","historyMsgHandlerAction","updateMessageUIAction","msgCollectionFindQuery","msgCollectionGetStarred","msgCollectionGetMessagesById","msgCollectionQueryVCard","msgCollectionIncrementalStarredUpdate","msgCollectionQueryMedia","msgCollectionSearch","msgCollectionGetContext","username_change_notification","username_contactless_search"]);b=new Set(["username_change_notification","username_contactless_search"]);f.VALID_LID_ORIGINS=a;f.VALID_USERNAME_ORIGINS=b}),66);
__d("WAWebFMXUtils",["WAWebABProps"],(function(a,b,c,d,e,f,g){function h(){return d("WAWebABProps").getABPropConfigValue("first_message_experience")}function i(){return h()&&d("WAWebABProps").getABPropConfigValue("first_message_experience_v2")}function a(){return i()&&d("WAWebABProps").getABPropConfigValue("fmx_ctwa_kill_switch")}g.supportsFMX=h;g.supportsFMXV2=i;g.fmxCTWAKillSwitchEnabled=a}),98);
__d("WAWebContactSystemMsg",["WATimeUtils","WAWebApiContact","WAWebFMXUtils","WAWebMsgKey","WAWebMsgType","WAWebUserPrefsMeUser","WAWebWidFactory","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){function a(a,b){var e=d("WAWebUserPrefsMeUser").getMeUser(),f=new(c("WAWebMsgKey"))({fromMe:b.equals(e),remote:a,id:c("WAWebMsgKey").newId_DEPRECATED()});return{id:f,t:d("WATimeUtils").unixTime(),type:"e2e_notification",kind:d("WAWebMsgType").MsgKind.E2eNotification,subtype:"identity",from:a,to:e,body:b.toString()}}function e(a,b,e,f){var g=d("WAWebUserPrefsMeUser").assertGetMe(),h=new(c("WAWebMsgKey"))({fromMe:b.equals(d("WAWebWidFactory").toUserWid(g)),remote:a,id:c("WAWebMsgKey").newId_DEPRECATED()}),i=h.fromMe&&e.includes(g.getDeviceId());return{id:h,t:d("WATimeUtils").unixTime(),type:"e2e_notification",kind:d("WAWebMsgType").MsgKind.E2eNotification,subtype:"device",from:a,to:d("WAWebWidFactory").toUserWid(g),body:b.toString(),devicesAdded:e.length,devicesRemoved:f.length,isThisDeviceAdded:i}}function f(a,b){b===void 0&&(b="encrypt");return m(a,{type:"e2e_notification",subtype:b,templateParams:[]})}function h(a,b,c){c===void 0&&(c=[]);return m(a,{type:"notification_template",subtype:b,templateParams:c})}function i(a,b,e){var f=e?d("WAWebUserPrefsMeUser").getMeUser():a;if(f==null)throw c("err")("Cannot set null initiator for DDM system message: "+a.toString()+" / "+String(e));return m(a,{type:"notification_template",subtype:"disappearing_mode",templateParams:[],ephemeralDuration:b,ephemeralSettingUser:f})}function j(a,b,c){return m(a,{type:"notification_template",subtype:"disappearing_mode_update",templateParams:[],ephemeralDuration:b,ephemeralSettingUser:c})}function k(a,b){return m(a,{type:"notification_template",subtype:"change_username",templateParams:b!=null?[b]:[""]})}function l(a){return m(a,{type:"notification_template",subtype:"disappearing_mode_unsupported",templateParams:[]})}function m(a,b){var e=d("WAWebUserPrefsMeUser").getMaybeMeLid(),f=d("WAWebUserPrefsMeUser").getMeUser(),g=new(c("WAWebMsgKey"))({fromMe:d("WAWebUserPrefsMeUser").isMeAccount(a),remote:a,id:c("WAWebMsgKey").newId_DEPRECATED()});return babelHelpers["extends"]({id:g,t:d("WATimeUtils").unixTime(),from:a,to:a.isLid()&&e!=null?e:f},b)}function n(a,b){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(!d("WAWebFMXUtils").supportsFMX())return null;if(b.isBiz&&!d("WAWebFMXUtils").supportsFMXV2()||!a.isUser()||b.isWASupportStartingChat||b.iAmStartingChat||b.isFromCTWA&&d("WAWebFMXUtils").fmxCTWAKillSwitchEnabled())return null;if(a.isBot())return null;b=(yield d("WAWebApiContact").isAddressBookContact(a.toJid()));return b?null:m(a,{type:"notification_template",subtype:"contact_info_card",templateParams:[a]})});return o.apply(this,arguments)}g.genSecurityCodeNotificationMsg=a;g.genDeviceNotificationMsg=e;g.genEncryptNotificationMsg=f;g.genNonE2ENotificationMsg=h;g.genDefaultDisappearingModeSystemMsg=i;g.genDisappearingModeUpdateSystemMsg=j;g.genUsernameChangeSystemMsg=k;g.genDisappearingModeUnsupportedSystemMsg=l;g.genNotificationMsg=m;g.genContactInfoCardMsg=n}),98);
__d("WAWebWamEnumFmxEntryPoint",[],(function(a,b,c,d,e,f){a=Object.freeze({FMX_CARD:0,SAFETY_TOOLS:1});f.FMX_ENTRY_POINT=a}),66);
__d("WAWebWamEnumFmxEvent",[],(function(a,b,c,d,e,f){a=Object.freeze({BLOCK:0,ADD_CONTACT:1,REPORT:2,SAFETY_TOOLS:3,COMMON_GROUPS:4,CONTACT_INFO:5,FMX_CARD_INSERTED:6,FMX_CARD_VIEWED:7,LEARN_MORE:8,HIGHLIGHT_GROUP_NAME:9});f.FMX_EVENT=a}),66);
__d("WAWebWamEnumHighlightGroupType",[],(function(a,b,c,d,e,f){a=Object.freeze({UNKNOWN:0,SINGLE:1,CREATOR:2,ADMIN:3,SAVED_CONTACTS:4,PARTICIPANTS:5,MORE:6});f.HIGHLIGHT_GROUP_TYPE=a}),66);
__d("WAWebFmxActionWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumFmxEntryPoint","WAWebWamEnumFmxEvent","WAWebWamEnumHighlightGroupType"],(function(a,b,c,d,e,f,g){b=(a=d("WAWebWamCodegenUtils")).defineEvents({FmxAction:[4444,{commonGroupNum:[1,a.TYPES.INTEGER],countryShown:[2,a.TYPES.BOOLEAN],fmxEntryPoint:[3,d("WAWebWamEnumFmxEntryPoint").FMX_ENTRY_POINT],fmxEvent:[4,d("WAWebWamEnumFmxEvent").FMX_EVENT],highlightGroupType:[6,d("WAWebWamEnumHighlightGroupType").HIGHLIGHT_GROUP_TYPE],isSenderSmb:[7,a.TYPES.BOOLEAN],notAContactShown:[5,a.TYPES.BOOLEAN]},[1,1,1],"regular"]});g.FmxActionWamEvent=b}),98);
__d("WAWebGetCTWAEligibilityFromConversion",["WAArrayBufferUtils"],(function(a,b,c,d,e,f,g){var h="fb_ads";function a(a){var b=a.conversionData;a=a.conversionSource;a=(a||"").toLocaleLowerCase();if(b!=null&&a===h)try{a=d("WAArrayBufferUtils").arrayBufferToString(b);return{data:a,source:h}}catch(a){return null}return null}g.SMB_DATA_SHARING_ALLOWED_SOURCE=h;g.getCTWAEligibilityFromConversion=a}),98);
__d("WAWebAdvHostedAccountTypeSystemMsg",["WATimeUtils","WAWebMsgKey","WAWebMsgType","WAWebProtobufsAdv.pb","WAWebUserPrefsMeUser"],(function(a,b,c,d,e,f,g){function a(a,b,c){return null}function b(a,b){return null}g.genAdvAccountTypeChangeNotificationMsg=a;g.genAdvMeAccountIsHostedNotificationMsg=b}),98);
__d("WAWebBotSystemMsg",["WAWebBackendApi","WAWebBotGating","WAWebCmd","WAWebContactSystemMsg","WAWebMsgType","WAWebSchemaChat","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h=new Map();function a(a){return d("WAWebContactSystemMsg").genNotificationMsg(a,{type:"notification_template",subtype:"bot_init",templateParams:[]})}function c(a,b){if(d("WAWebBotGating").isBotEnabled()&&!b.id.isBot()&&a.botMessageSecret!=null&&b.hasCreatedBotInvokeSystemMsg!==!0&&((a=a.invokedBotWid)==null?void 0:a.isBot())){a=j(b.id);return a}return null}function e(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(d("WAWebBotGating").isBotReceiveEnabled()&&(yield l(a))!==!0&&!a.isBot()){var b=j(a);h.set(a.toJid(),!0);return b}return null});return i.apply(this,arguments)}function j(a){return d("WAWebContactSystemMsg").genNotificationMsg(a,{type:d("WAWebMsgType").MSG_TYPE.NOTIFICATION_TEMPLATE,subtype:"bot_invoke_disclaimer",templateParams:[]})}function f(a){return d("WAWebContactSystemMsg").genNotificationMsg(a,{type:d("WAWebMsgType").MSG_TYPE.NOTIFICATION_TEMPLATE,subtype:"biz_bot_1p_disclosure",templateParams:[]})}function k(a){return d("WAWebContactSystemMsg").genNotificationMsg(a,{type:d("WAWebMsgType").MSG_TYPE.NOTIFICATION_TEMPLATE,subtype:"biz_bot_3p_disclosure",templateParams:[]})}function l(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=null;if(d("WAWebCmd").Cmd.isMainStreamReadyMd){var c=(yield d("WAWebBackendApi").frontendSendAndReceive("getChat",{chatId:a}));c&&(b=c.hasCreatedBotInvokeSystemMsg);return b}c=(yield d("WAWebSchemaChat").getChatTable().get(a.toString()));b=c==null?void 0:c.hasCreatedBotInvokeSystemMsg;h.set(a.toJid(),b);return b});return m.apply(this,arguments)}d("WAWebCmd").Cmd.on("logout",function(){h=new Map()});g.genBotInitSystemMsg=a;g.getMaybeSysMsgForBotInvoke=c;g.createSysMsgForIncomingBotInvoke=e;g.genBizBot1pDisclosureMessage=f;g.genBizBot3pDisclosureMessage=k}),98);
__d("WAWebPrivacyModeSystemMsg",["$InternalEnum","WAWebHandleMsgTypes.flow"],(function(a,b,c,d,e,f,g){var h=b("$InternalEnum").Mirrored(["E2EE","BSP","FB"]);function a(a){if(a==null||a.actualActors===d("WAWebHandleMsgTypes.flow").ActualActorsEnumType.Self&&a.hostStorage===d("WAWebHandleMsgTypes.flow").HostStorageEnumType.OnPremise)return h.E2EE;else if(a.hostStorage===d("WAWebHandleMsgTypes.flow").HostStorageEnumType.Facebook)return h.FB;return h.BSP}function c(a,b){if(a==null)return b;return b==null?a:a.privacyModeTs>b.privacyModeTs?a:b}function e(a,b){if(a==null&&b==null)return 0;if(b==null)return 1;return a==null?-1:a.privacyModeTs-b.privacyModeTs}function f(a){var b;b=(b=a.bizInfo)==null?void 0:b.verifiedName;return b==null?null:a.biz&&b.isApi===!0?b.privacyMode:null}g.ReducedPrivacyMode=h;g.getReducedPrivacyMode=a;g.getLatestPrivacyMode=c;g.comparePrivacyMode=e;g.getPrivacyModeFromQueryExistResponse=f}),98);
__d("WAWebInitialSystemMsg",["WALogger","WANullthrows","WAWebAdvHostedAccountTypeSystemMsg","WAWebApiDeviceList","WAWebBotSystemMsg","WAWebBotTos","WAWebBotTypes","WAWebContactSystemMsg","WAWebPrivacyModeSystemMsg","WAWebProtobufsAdv.pb","WAWebUserPrefsMultiDevice","WAWebWid","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(){var b=babelHelpers.taggedTemplateLiteralLoose(["[Hosted] inserting is me hosted notification msg"]);a=function(){return b};return b}function e(a,b,c){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){if(c("WAWebWid").isPSA(a))return[d("WAWebContactSystemMsg").genEncryptNotificationMsg(a,"chat_psa")];if(a.isBot())return[d("WAWebBotSystemMsg").genBotInitSystemMsg(a)];if(e===d("WAWebBotTypes").BizBotAutomatedType.FULL_3P)return[d("WAWebBotSystemMsg").genBizBot3pDisclosureMessage(a)];var f=[];b=d("WAWebPrivacyModeSystemMsg").getReducedPrivacyMode(b);switch(b){case d("WAWebPrivacyModeSystemMsg").ReducedPrivacyMode.E2EE:f.push(d("WAWebContactSystemMsg").genEncryptNotificationMsg(a));break;case d("WAWebPrivacyModeSystemMsg").ReducedPrivacyMode.BSP:f.push(d("WAWebContactSystemMsg").genNonE2ENotificationMsg(a,"biz_privacy_mode_init_bsp"));break;case d("WAWebPrivacyModeSystemMsg").ReducedPrivacyMode.FB:f.push(d("WAWebContactSystemMsg").genNonE2ENotificationMsg(a,"biz_privacy_mode_init_fb"));break}e===d("WAWebBotTypes").BizBotAutomatedType.PARTIAL_1P&&d("WAWebBotTos").hasAcceptedBizBotTos()&&f.push(d("WAWebBotSystemMsg").genBizBot1pDisclosureMessage(a));return f});return h.apply(this,arguments)}g["default"]=e}),98);
__d("WAWebMsgEphemerality",["WAWebEphemeralityTypes","WAWebMsgType"],(function(a,b,c,d,e,f,g){function a(a){var b;if(a.ephemeralDuration==null&&a.ephemeralSettingTimestamp==null&&a.disappearingModeInitiator==null)return null;b=(b=a.ephemeralDuration)!=null?b:0;var c=a.ephemeralSettingTimestamp,e=a.disappearingModeInitiator,f=a.disappearingModeTrigger,g=a.disappearingModeInitiatedByMe;a.subtype==="ephemeral_setting"&&(c=a.t,e=d("WAWebEphemeralityTypes").DisappearingModeInitiator.ChangedInChat);return{duration:b,settingTimestamp:c,initiator:e,disappearingModeTrigger:f,initiatedByMe:g}}var h=[(c=d("WAWebMsgType")).MSG_TYPE.CHAT,c.MSG_TYPE.IMAGE,c.MSG_TYPE.VIDEO,c.MSG_TYPE.AUDIO,c.MSG_TYPE.PTT,c.MSG_TYPE.DOCUMENT,c.MSG_TYPE.PRODUCT,c.MSG_TYPE.STICKER,c.MSG_TYPE.POLL_CREATION,c.MSG_TYPE.NEWSLETTER_ADMIN_INVITE,c.MSG_TYPE.GROUPS_V4_INVITE];function b(a){return h.includes(a)?!0:!1}g.getMsgEphemeralitySettings=a;g.ephemeralMessageTypes=h;g.messageSupportsEphemerality=b}),98);
__d("WAWebSagaSystemMsg",["WAWebContactSystemMsg"],(function(a,b,c,d,e,f,g){function a(a){return d("WAWebContactSystemMsg").genNotificationMsg(a,{type:"notification_template",subtype:"saga_init",templateParams:[]})}g.genSagaInitSystemMsg=a}),98);
__d("WAWebUpdateLidMetadataJob",["WAWebOrchestratorNonPersistedJob","WAWebUpdateLidMetadataApi"],(function(a,b,c,d,e,f,g){function a(a){a={updates:a};return d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("updateLidMetadata",function(a){return d("WAWebUpdateLidMetadataApi").updateLidMetadata(a)}).waitUntilCompleted(a)}function b(a,b){a={mappings:a,flushImmediately:b};return d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("createLidPnMappings",function(a){return d("WAWebUpdateLidMetadataApi").createLidPnMappings(a)}).waitUntilCompleted(a)}g.updateLidMetadataJob=a;g.createLidPnMappingsJob=b}),98);
__d("WAWebCreateChat",["Promise","WALogger","WAWebABProps","WAWebABPropsSaga","WAWebApiBusinessProfile","WAWebApiChat","WAWebApiContact","WAWebApiOrphanTcToken","WAWebApiVerifiedBusinessName","WAWebBackendApi","WAWebBotTypes","WAWebChatOriginTypes","WAWebContactSystemMsg","WAWebEphemeralityResolver","WAWebEphemeralityTypes","WAWebFmxActionWamEvent","WAWebGetCTWAEligibilityFromConversion","WAWebGetMessageCache","WAWebHandleMsgTypes.flow","WAWebHandleSingleMsg","WAWebInitialSystemMsg","WAWebMsgEphemerality","WAWebPrivacyModeSystemMsg","WAWebQueryBusinessProfile","WAWebSagaSystemMsg","WAWebSchemaContact","WAWebUpdateLidMetadataJob","WAWebUserPrefsMeUser","WAWebWamEnumFmxEntryPoint","WAWebWamEnumFmxEvent","WAWebWidFactory","WAWebWorkerSafeBackendApi","asyncToGeneratorRuntime","lodash"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[DMResolve] DM settings found for new chat"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["createChat: "," unexpected lid chat created"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["lid: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["createChat: "," trying to create new lid chat without abprop pnh_1on1_lid_expected"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["lid: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["createChat: "," trying to create new username chat when phone number is known."]);n=function(){return a};return a}function a(a,b,c,d){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f){f=(f=f)!=null?f:{};var g=f.forceUsync;g=g===void 0?!1:g;var h=f.firstIncomingMsg,o=f.nextPrivacyMode;f=f.createdOffline;f=f===void 0?!1:f;var s=a;if(a.isLid()){var u=d("WAWebApiContact").getPhoneNumber(a),v=b==null||!d("WAWebChatOriginTypes").VALID_LID_ORIGINS.has(b),w=b!=null&&d("WAWebChatOriginTypes").VALID_USERNAME_ORIGINS.has(b)&&a.isLid()&&u!=null,x=b==null||w;x?(w?d("WALogger").LOG(n(),b).sendLogs("unexpected-username-lid-chat"):(d("WALogger").LOG(m(),a.toLogString()),d("WALogger").ERROR(l(),b).sendLogs("create-lid-chat-without-pnh-1on1-lid-expected")),u!=null&&(s=u)):v&&(d("WALogger").LOG(k(),a.toLogString()),d("WALogger").ERROR(j(),b).sendLogs("unexpected-lid-chat"));x=(yield d("WAWebApiContact").getContactRecord(d("WAWebUserPrefsMeUser").assertGetMeUser()));b==="username_contactless_search"&&(x==null?void 0:x.username)==null&&(yield d("WAWebUpdateLidMetadataJob").updateLidMetadataJob([{lid:d("WAWebWidFactory").toUserWid(a),data:{shareOwnPn:!0}}]))}w=s.isUser()&&g?yield d("WAWebWorkerSafeBackendApi").workerSafeSendAndReceive("getOrQueryUsyncInfo",{wid:s}):null;u=w==null?s:w.wid;if(!s.equals(u)){v=(yield d("WAWebApiChat").getChatRecord(u));if(v!=null)return}b=!1;x=!1;g=null;if((w==null?void 0:w.bizInfo)!=null){b=(s=w.bizInfo)==null?void 0:s.verifiedName.isApi;x=(v=w.bizInfo)==null?void 0:v.verifiedName.isSmb;g=d("WAWebPrivacyModeSystemMsg").getPrivacyModeFromQueryExistResponse(w)}else if(w==null){s=(yield d("WAWebApiVerifiedBusinessName").getVerifiedBusinessNameRecord(u));s!=null&&(x=s.isSmb,b=s.isApi,g=s.privacyMode!=null?d("WAWebApiVerifiedBusinessName").convertPrivacyModeFromStorageType(s.privacyMode):null)}v=e!=null?babelHelpers["extends"]({},e,{id:u}):{id:u};w=(yield r(u,b,h));w!=null&&(d("WALogger").LOG(i()).devConsole(w),v.ephemeralDuration=w.duration,v.ephemeralSettingTimestamp=w.settingTimestamp,v.disappearingModeInitiator=w.initiator,d("WAWebABProps").getABPropConfigValue("dm_initiator_trigger")&&(v.disappearingModeTrigger=w.disappearingModeTrigger,v.disappearingModeInitiatedByMe=w.initiatedByMe));s=d("WAWebPrivacyModeSystemMsg").getLatestPrivacyMode(o,g);d("WAWebBackendApi").frontendFireAndForget("updateBusinessInfo",{contactId:u,businessInfo:{privacyMode:s}});var y;(h==null?void 0:h.subtype)!=="ephemeral_setting"&&(y=q(u,w==null?void 0:w.duration,w==null?void 0:w.initiator));var z;u.isCAPISupportAccount()&&d("WAWebABPropsSaga").getIsSagaEnabled()&&(z=d("WAWebSagaSystemMsg").genSagaInitSystemMsg(u));e=(h==null?void 0:h.ctwaContext)!=null&&d("WAWebGetCTWAEligibilityFromConversion").getCTWAEligibilityFromConversion({conversionData:h.ctwaContext.conversionData,conversionSource:h.ctwaContext.conversionSource});o=(yield d("WAWebContactSystemMsg").genContactInfoCardMsg(u,{isBiz:x||b,iAmStartingChat:h==null||h.id.fromMe,isWASupportStartingChat:h!=null&&u.isCAPISupportAccount(),isFromCTWA:e!=null}));o!=null&&new(d("WAWebFmxActionWamEvent").FmxActionWamEvent)({fmxEntryPoint:d("WAWebWamEnumFmxEntryPoint").FMX_ENTRY_POINT.FMX_CARD,fmxEvent:d("WAWebWamEnumFmxEvent").FMX_EVENT.FMX_CARD_INSERTED,isSenderSmb:x}).commit();var A;(x||b)&&(A=(yield t(u)));g=(yield c("WAWebInitialSystemMsg")(u,s,A));g.some(function(a){return a.subtype==="biz_bot_3p_disclosure"})?v.bizBotSystemMsgType=d("WAWebBotTypes").BizBotType.BIZ_3P:g.some(function(a){return a.subtype==="biz_bot_1p_disclosure"})&&(v.bizBotSystemMsgType=d("WAWebBotTypes").BizBotType.BIZ_1P);w=(yield d("WAWebApiOrphanTcToken").getOrphanTcToken(u.toString()));if(w){v.tcToken=(h=w.tcToken)!=null?h:null;v.tcTokenTimestamp=(e=w.tcTokenTimestamp)!=null?e:null;yield d("WAWebApiOrphanTcToken").removeOrphanTcToken(u.toString())}yield d("WAWebBackendApi").frontendFireAndForget("chatCollectionGadd",{chat:v});yield d("WAWebApiChat").createChatRecord(u,p(v));x=d("WAWebHandleMsgTypes.flow").MessageOverwriteOption.NO_OVERWRITE;b=!1;if(!f){s=[o].concat(g,[y,z]).filter(Boolean);for(h of s)yield d("WAWebHandleSingleMsg").handleSingleMsg(u,h,"createChat",x,b)}else{w=[o].concat(g,[y,z]).filter(Boolean);d("WAWebGetMessageCache").getMessageCache().addMessages(w.map(function(a){return{msg:a}}),!1)}if(a.isUser()){e=d("WAWebWidFactory").createUserWid(a.toString());v=e.toJid();f=d("WAWebApiContact").getContactHash(v);yield d("WAWebSchemaContact").getContactTable().createOrMerge(v,{id:v,contactHash:f})}});return o.apply(this,arguments)}function p(a){var b;b={id:a.id.toString(),t:a.t,isAutoMuted:!1,unreadCount:(b=a.unreadCount)!=null?b:0,notSpam:a.notSpam,ephemeralDuration:a.ephemeralDuration,ephemeralSettingTimestamp:a.ephemeralSettingTimestamp,disappearingModeInitiator:a.disappearingModeInitiator!=null?a.disappearingModeInitiator:a.disappearingModeInitiator,tcToken:(b=a.tcToken)!=null?b:void 0,tcTokenTimestamp:(b=a.tcTokenTimestamp)!=null?b:void 0,tcTokenSenderTimestamp:(b=a.tcTokenSenderTimestamp)!=null?b:void 0,bizBotSystemMsgType:a.bizBotSystemMsgType,lidOriginType:a.lidOriginType};if(d("WAWebABProps").getABPropConfigValue("dm_initiator_trigger")){var c;b.disappearingModeTrigger=a.disappearingModeTrigger!=null?a.disappearingModeTrigger:a.disappearingModeTrigger;b.disappearingModeInitiatedByMe=(c=a.disappearingModeInitiatedByMe)!=null?c:void 0}a.name!=null&&(b.name=a.name);a.isReadOnly!=null&&(b.isReadOnly=a.isReadOnly);a.muteExpiration!=null&&(b.muteExpiration=a.muteExpiration);return b}function e(a){a=p(a);return c("lodash").pickBy(a,function(a){return a!=null})}function q(a,b,c){var e=null;b!=null&&(c===d("WAWebEphemeralityTypes").DisappearingModeInitiator.ChangedInChat?e=d("WAWebContactSystemMsg").genDisappearingModeUpdateSystemMsg(a,b,null):e=d("WAWebContactSystemMsg").genDefaultDisappearingModeSystemMsg(a,b,c===d("WAWebEphemeralityTypes").DisappearingModeInitiator.InitiatedByMe));return e}function r(a,b,c){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){var f=(yield (h||(h=b("Promise"))).all([d("WAWebApiContact").getContactRecord(d("WAWebUserPrefsMeUser").assertGetMeUser()),d("WAWebApiContact").getContactRecord(a)])),g=f[0];f=f[1];if(!c&&a.isUser()&&!a.isPSA()){c=e==null||e.id.fromMe;if(c)return d("WAWebEphemeralityResolver").resolveNewChatDMSettings(g,f);a=d("WAWebEphemeralityResolver").getEphemeralDurationForUser(g);return d("WAWebEphemeralityResolver").resolveNewIncomingChatDMSettings(e?d("WAWebMsgEphemerality").getMsgEphemeralitySettings(e):null,a)}});return s.apply(this,arguments)}function t(a){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield d("WAWebApiBusinessProfile").getBusinessProfileRow(a.toString()));if(b)return d("WAWebBotTypes").BizBotAutomatedType.cast(b.automatedType);b=(yield d("WAWebQueryBusinessProfile").queryBusinessProfile([{wid:a}]));return(a=b[0])==null?void 0:(b=a.profile)==null?void 0:b.automated_type});return u.apply(this,arguments)}g.createChat=a;g.createChatObjectForStorage=p;g.createNewsletterObjectForStorage=e}),98);
__d("WAWebGroupApiConst",[],(function(a,b,c,d,e,f){a={superadmin:"superadmin",admin:"admin",participant:"participant"};f.GROUP_PARTICIPANT_TYPES=a}),66);
__d("WAWebGroupsQueryApi",["WADeprecatedSendIq","WADeprecatedWapParser","WALogger","WATimeUtils","WAWap","WAWebBackendErrors","WAWebCommsWapMd","WAWebGroupApiConst","WAWebJidToWid","WAWebSchemaGroupMetadata","WAWebWidFactory","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["queryGroup failed: ",":",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["parseBatchGroupInfoSmax: unexpected truncated group info received from server when querying dirty groups metadata"]);i=function(){return a};return a}function j(a){if(!a)return null;var b=a.bodyElementValue,c=a.id,e=a.participant;a=a.t;return{desc:b,descId:c,descOwner:e!=null?d("WAWebJidToWid").userJidToUserWid(e):void 0,descTime:d("WATimeUtils").castToUnixTime(a)}}function k(a){if(!a)return null;a=a.expiration;return{ephemeralDuration:a}}function l(a){if(a==null)return null;var b=a.expiration;a=a.type;return{growthLockExpiration:b,growthLockType:a}}function m(a){return a==null?null:{parentGroup:d("WAWebJidToWid").groupJidToWid(a.jid),parentGroupSubject:a.subject}}function n(a){return a.map(function(a){if(a.groupInfoParticipantMixins.name==="GroupInfoParticipantAdmin"){var b=a.groupInfoParticipantMixins.value,c=b.type;b=b.groupInfoParticipantAdminMixins;var e=c==="admin"||c==="superadmin";c=c==="superadmin";if(b.name==="ParticipantWithJid"||b.name==="ParticipantWithJidAndPn")return{isAdmin:e,isSuperAdmin:c,id:d("WAWebJidToWid").userJidToUserWid(b.value.jid),displayName:null,lid:null};else if(b.name==="ParticipantWithJidAndLid")return{isAdmin:e,isSuperAdmin:c,id:d("WAWebJidToWid").userJidToUserWid(b.value.jid),lid:d("WAWebJidToWid").userJidToUserWid(b.value.lid),displayName:null};b.name;return{isAdmin:e,isSuperAdmin:c,id:d("WAWebJidToWid").userJidToUserWid(b.value.jid),lid:d("WAWebJidToWid").userJidToUserWid(b.value.lid),displayName:b.value.displayName}}a.groupInfoParticipantMixins.name;e=a.groupInfoParticipantMixins.value.participantMixins;if(e.name==="ParticipantWithJid"||e.name==="ParticipantWithJidAndPn")return{isAdmin:!1,isSuperAdmin:!1,id:d("WAWebJidToWid").userJidToUserWid(e.value.jid),displayName:null,lid:null};else if(e.name==="ParticipantWithJidAndLid")return{isAdmin:!1,isSuperAdmin:!1,id:d("WAWebJidToWid").userJidToUserWid(e.value.jid),lid:d("WAWebJidToWid").userJidToUserWid(e.value.lid),displayName:null};else if(e.name==="ParticipantWithJidContainingLidAndDisplayName")return{isAdmin:!1,isSuperAdmin:!1,id:d("WAWebJidToWid").userJidToUserWid(e.value.jid),displayName:e.value.displayName,lid:null};e.name;return{isAdmin:!1,isSuperAdmin:!1,id:d("WAWebJidToWid").userJidToUserWid(e.value.jid),lid:d("WAWebJidToWid").userJidToUserWid(e.value.lid),displayName:e.value.displayName}})}function a(a,b){var c=[];b.forEach(function(b){b=b.groupInfoOrTruncatedGroupInfoOrGroupForbiddenOrGroupNotExistMixinGroup;a==="per_group_dirty_recovery"&&b.name==="TruncatedGroupInfo"&&d("WALogger").WARN(i()).sendLogs("unexpected-truncated-group-info-for-dirty-group-request");(b.name==="GroupInfo"||b.name==="TruncatedGroupInfo")&&c.push(o(b.value))});return c}function o(a){var b,e=a.groupAddressingModeMixin,f=a.creator,g=a.creation,h=a.id,i=a.hasLocked,o=a.hasAnnouncement,p=a.hasNoFrequentlyForwarded,q=a.hasSupport,r=a.hasSuspended,s=a.parent,t=a.hasDefaultSubGroup,u=a.hasGeneralChat,v=a.hasIncognito,w=a.membershipApprovalMode,x=a.membershipApprovalRequest,y=a.hasAllowAdminReports,z=a.ephemeral,A=a.growthLocked,B=a.linkedParent,C=a.description,D=a.descriptionGroupInfoDescriptionMixin,E=a.namedSubjectOrUnnamedSubjectFallbackMixinGroup,F=a.participant,G=a.sT,H=a.size,I=a.groupMemberAddModeMixin,J=a.hasAllowNonAdminSubGroupCreation;a=a.hasAutoAddDisabled;if(h==null)throw c("err")("parseGroupSmax: invalid group id");E=E==null?void 0:E.value.subject;if(E==null)throw c("err")("parseGroupSmax: invalid group subject");F=F!=null?n(F):[];b=(b=w==null?void 0:(b=w.membershipApprovalGroupJoinModeEnabledMixin)==null?void 0:b.state)!=null?b:w==null?void 0:w.state;I=d("WAWebSchemaGroupMetadata").MemberAddMode.cast(I==null?void 0:(w=I.memberAddModeAdminOrAllMembersOrUnknownAddModeMixinGroup)==null?void 0:w.value.elementValue);C=(w=C==null?void 0:C.groupInfoDescriptionMixin)!=null?w:D;D=babelHelpers["extends"]({id:d("WAWebWidFactory").createWid(h+"@g.us"),owner:f!=null?d("WAWebJidToWid").userJidToUserWid(f):void 0,creation:g,restrict:Boolean(i),announce:Boolean(o),noFrequentlyForwarded:Boolean(p),support:q,suspended:r,isParentGroup:s!=null,numSubgroups:s==null?void 0:s.numSubGroups,participants:F,isParentGroupClosed:(s==null?void 0:(w=s.parentGroupDefaultMembershipApprovalModeMixin)==null?void 0:w.defaultMembershipApprovalMode)==="request_required",defaultSubgroup:t,generalSubgroup:u,incognito:v,membershipApprovalMode:b==="on",reportToAdminMode:y,membershipApprovalRequest:x,isLidAddressingMode:(e==null?void 0:e.addressingMode)==="lid",memberAddMode:I,allowNonAdminSubGroupCreation:J},C&&j(C),z&&k(z),l(A),m(B),{subject:E,subjectTime:G,size:H,generalChatAutoAddDisabled:Boolean(a)});return D}function p(a){if(a.hasChild("description")){a=a.child("description");if(a.hasChild("body")){var b=a.child("body");if(b.hasContent()){b={desc:b.contentString(),descId:a.attrString("id")};a.hasAttr("participant")&&(b.descOwner=d("WAWebJidToWid").userJidToUserWid(a.attrUserJid("participant")));a.hasAttr("t")&&(b.descTime=a.attrTime("t"));return b}}}return null}function q(a){var b=a.attrString("subject");b={subject:b};a.hasAttr("s_o")&&(b.subjectOwner=d("WAWebJidToWid").userJidToUserWid(a.attrUserJid("s_o")));a.hasAttr("s_o_pn")&&(b.subjectOwnerPn=d("WAWebJidToWid").userJidToUserWid(a.attrPhoneUserJid("s_o_pn")));a.hasAttr("s_t")&&(b.subjectTime=a.attrTime("s_t"));return b}function r(a){if(a.hasChild("ephemeral")){a=a.child("ephemeral");if(a.hasAttr("expiration"))return{ephemeralDuration:a.attrInt("expiration")}}return null}function s(a){a=a.maybeChild("growth_locked");var b=a==null?void 0:a.maybeAttrInt("expiration");a=a==null?void 0:a.maybeAttrString("type");return b==null||a==null?null:{growthLockExpiration:b,growthLockType:a}}function t(a){a=a.maybeChild("linked_parent");var b=a==null?void 0:a.maybeAttrGroupJid("jid");return b==null?null:{parentGroup:d("WAWebJidToWid").groupJidToWid(b),parentGroupSubject:a==null?void 0:a.maybeAttrString("subject")}}function u(a){var b=p(a),e=q(a),f=r(a),g=s(a),h=t(a),i,j;try{i=d("WAWebWidFactory").createWid(a.attrString("id")+"@g.us")}catch(a){}if(i==null)throw c("err")("createGroupReplyParser: invalid group id");a.hasChild("member_add_mode")&&(j=d("WAWebSchemaGroupMetadata").MemberAddMode.cast(a.child("member_add_mode").contentString()));var k=a.mapChildrenWithTag("participant",function(a){var b=a.attrEnumOrDefault("type",d("WAWebGroupApiConst").GROUP_PARTICIPANT_TYPES,d("WAWebGroupApiConst").GROUP_PARTICIPANT_TYPES.participant),c=a.maybeAttrLidUserJid("lid"),e=a.maybeAttrPhoneUserJid("phone_number");return{displayName:a.maybeAttrString("display_name"),id:d("WAWebJidToWid").userJidToUserWid(a.attrUserJid("jid")),isSuperAdmin:b===d("WAWebGroupApiConst").GROUP_PARTICIPANT_TYPES.superadmin,isAdmin:b===d("WAWebGroupApiConst").GROUP_PARTICIPANT_TYPES.admin||b===d("WAWebGroupApiConst").GROUP_PARTICIPANT_TYPES.superadmin,lid:c!=null?d("WAWebJidToWid").userJidToUserWid(c):null,phoneNumber:e!=null?d("WAWebJidToWid").userJidToUserWid(e):null}});k=babelHelpers["extends"]({id:i,owner:a.hasAttr("creator")?d("WAWebJidToWid").userJidToUserWid(a.attrUserJid("creator")):void 0,creatorPn:a.hasAttr("creator_pn")?d("WAWebJidToWid").userJidToUserWid(a.attrPhoneUserJid("creator_pn")):void 0,creation:a.attrTime("creation"),restrict:a.hasChild("locked"),announce:a.hasChild("announcement"),noFrequentlyForwarded:a.hasChild("no_frequently_forwarded"),participants:k,support:a.hasChild("support"),size:a.hasAttr("size")?a.attrInt("size"):void 0,suspended:a.hasChild("suspended"),isParentGroup:(k=a.hasChild("parent"))!=null?k:void 0,isParentGroupClosed:((k=a.maybeChild("parent"))==null?void 0:k.maybeAttrString("default_membership_approval_mode"))==="request_required",numSubgroups:(k=(k=a.maybeChild("parent"))==null?void 0:k.maybeAttrInt("num_sub_groups"))!=null?k:0,defaultSubgroup:(k=a.hasChild("default_sub_group"))!=null?k:void 0,generalSubgroup:(k=a.hasChild("general_chat"))!=null?k:void 0,generalChatAutoAddDisabled:a.hasChild("auto_add_disabled"),incognito:a.hasChild("incognito"),isLidAddressingMode:a.maybeAttrString("addressing_mode")?a.attrString("addressing_mode")==="lid":!1,membershipApprovalMode:(a==null?void 0:(k=a.maybeChild("membership_approval_mode"))==null?void 0:(k=k.maybeChild("group_join"))==null?void 0:k.maybeAttrString("state"))==="on",memberAddMode:j,membershipApprovalRequest:a.hasChild("membership_approval_request"),reportToAdminMode:a.hasChild("allow_admin_reports"),allowNonAdminSubGroupCreation:a.hasChild("allow_non_admin_sub_group_creation")},b,f,g,e,h);a=k.defaultSubgroup&&k.incognito;b=k.isLidAddressingMode;a===!1&&b===!1&&(k.participants=k.participants.filter(function(a){a=a.id;return!a.isLid()}));return k}var v=new(c("WADeprecatedWapParser"))("queryGroupParser",function(a){return!a.hasChild("group")?{phashMatch:!0}:u(a.child("group"))});function e(a){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.groupWid,c=a.request;a=a.phash;b=d("WAWap").wap("iq",{to:d("WAWebCommsWapMd").GROUP_JID(b),type:"get",xmlns:"w:g2",id:d("WAWap").generateId()},d("WAWap").wap("query",{request:c||d("WAWap").DROP_ATTR,phash:d("WAWap").MAYBE_CUSTOM_STRING(a)}));c=(yield d("WADeprecatedSendIq").deprecatedSendIq(b,v));if(!c.success){d("WALogger").LOG(h(),c.errorCode,c.errorType);throw new(d("WAWebBackendErrors").ServerStatusCodeError)(c.errorCode,c.errorText)}return c.result});return w.apply(this,arguments)}g.parseBatchGroupInfoSmax=a;g.parseGroupSmax=o;g.extractDescription=p;g.extractLinkedParent=t;g.parseGroupNode=u;g.queryGroup=e}),98);
__d("WAWebGroupQueryGroupJob",["Promise","WALogger","WAWebApiParticipantStore","WAWebCreateOrReplaceDisplayNamesAndLidPnMappingsJob","WAWebDBGroupsGroupMetadata","WAWebGroupsParticipantsApi","WAWebGroupsQueryApi","WAWebOrchestratorNonPersistedJob","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["groupQueryJob: group "," does not exist"]);i=function(){return a};return a}function a(a,c,e){c={groupWid:a,request:c,phash:e};return d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("queryGroup",function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(c){var e=(yield d("WAWebDBGroupsGroupMetadata").getGroupMetadata(a));if(e!=null&&e.terminated){d("WALogger").DEV(i(),a);return}e=(yield d("WAWebGroupsQueryApi").queryGroup(c));if(e.id){c=e.participants.map(function(a){return{id:d("WAWebWidFactory").toUserWid(a.id),lid:a.lid?d("WAWebWidFactory").toUserWid(a.lid):null,displayName:a.displayName,phoneNumber:a.phoneNumber?d("WAWebWidFactory").toUserWid(a.phoneNumber):null}});var f=e.owner,g=e.creatorPn,j=e.subjectOwner,k=e.subjectOwnerPn;f&&g&&c.push({id:d("WAWebWidFactory").toUserWid(f),lid:d("WAWebWidFactory").toUserWid(f),phoneNumber:d("WAWebWidFactory").toUserWid(g)});j&&k&&c.push({id:d("WAWebWidFactory").toUserWid(j),lid:d("WAWebWidFactory").toUserWid(j),phoneNumber:d("WAWebWidFactory").toUserWid(k)});yield (h||(h=b("Promise"))).all([d("WAWebDBGroupsGroupMetadata").updateGroupMetadataTable({groupInfos:[e]}),d("WAWebGroupsParticipantsApi").updateParticipants({group:e.id,participants:e.participants,groupInfo:e}),d("WAWebCreateOrReplaceDisplayNamesAndLidPnMappingsJob").createOrReplaceDisplayNamesAndLidPnMappings(c,!0)]);d("WAWebApiParticipantStore").clearAdminshipCache(e.id.toString())}return e});return function(a){return c.apply(this,arguments)}}()).waitUntilCompleted(c)}g.queryGroupJob=a}),98);
__d("WASmaxInGroupsBatchGetGroupInfoClientErrors",["WAResultOrError","WASmaxInGroupsIQErrorBadRequestMixin","WASmaxInGroupsIQErrorRateOverlimitMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorBadRequest",value:b.value});var c=d("WASmaxInGroupsIQErrorRateOverlimitMixin").parseIQErrorRateOverlimitMixin(a);return c.success?d("WAResultOrError").makeResult({name:"IQErrorRateOverlimit",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorBadRequest","IQErrorRateOverlimit"],[b,c])}g.parseBatchGetGroupInfoClientErrors=a}),98);
__d("WASmaxInGroupsBatchGetGroupInfoResponseClientError",["WAResultOrError","WASmaxInGroupsBatchGetGroupInfoClientErrors","WASmaxInGroupsIQErrorResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInGroupsIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInGroupsBatchGetGroupInfoClientErrors").parseBatchGetGroupInfoClientErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorBatchGetGroupInfoClientErrors:b.value}))}g.parseBatchGetGroupInfoResponseClientError=a}),98);
__d("WASmaxInGroupsBatchGetGroupInfoResponseServerError",["WASmaxInGroupsBaseServerErrorMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxInGroupsBaseServerErrorMixin").parseBaseServerErrorMixin(a,b);return!c.success?c:c}g.parseBatchGetGroupInfoResponseServerError=a}),98);
__d("WASmaxInGroupsGroupForbiddenMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"group");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"id");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","403");return!a.success?a:d("WAResultOrError").makeResult({id:b.value,error:a.value})}g.parseGroupForbiddenMixin=a}),98);
__d("WASmaxInGroupsGroupNotExistMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"group");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"id");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"error","404");return!a.success?a:d("WAResultOrError").makeResult({id:b.value,error:a.value})}g.parseGroupNotExistMixin=a}),98);
__d("WASmaxInGroupsTruncatedGroupInfoMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"group");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"id");if(!b.success)return b;var c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"truncated","true");if(!c.success)return c;a=d("WASmaxParseUtils").attrIntRange(a,"size",0,19999);return!a.success?a:d("WAResultOrError").makeResult({id:b.value,truncated:c.value,size:a.value})}g.parseTruncatedGroupInfoMixin=a}),98);
__d("WASmaxInGroupsGroupInfoOrTruncatedGroupInfoOrGroupForbiddenOrGroupNotExistMixinGroup",["WAResultOrError","WASmaxInGroupsGroupForbiddenMixin","WASmaxInGroupsGroupInfoMixin","WASmaxInGroupsGroupNotExistMixin","WASmaxInGroupsTruncatedGroupInfoMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsGroupInfoMixin").parseGroupInfoMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"GroupInfo",value:b.value});var c=d("WASmaxInGroupsTruncatedGroupInfoMixin").parseTruncatedGroupInfoMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"TruncatedGroupInfo",value:c.value});var e=d("WASmaxInGroupsGroupForbiddenMixin").parseGroupForbiddenMixin(a);if(e.success)return d("WAResultOrError").makeResult({name:"GroupForbidden",value:e.value});var f=d("WASmaxInGroupsGroupNotExistMixin").parseGroupNotExistMixin(a);return f.success?d("WAResultOrError").makeResult({name:"GroupNotExist",value:f.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["GroupInfo","TruncatedGroupInfo","GroupForbidden","GroupNotExist"],[b,c,e,f])}g.parseGroupInfoOrTruncatedGroupInfoOrGroupForbiddenOrGroupNotExistMixinGroup=a}),98);
__d("WASmaxInGroupsBatchGetGroupInfoResponseSuccess",["WAResultOrError","WASmaxInGroupsDedupAttrsMixin","WASmaxInGroupsGroupInfoOrTruncatedGroupInfoOrGroupForbiddenOrGroupNotExistMixinGroup","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"group");if(!b.success)return b;b=d("WASmaxInGroupsDedupAttrsMixin").parseDedupAttrsMixin(a);a=d("WASmaxInGroupsGroupInfoOrTruncatedGroupInfoOrGroupForbiddenOrGroupNotExistMixinGroup").parseGroupInfoOrTruncatedGroupInfoOrGroupForbiddenOrGroupNotExistMixinGroup(a);return!a.success?a:d("WAResultOrError").makeResult({dedupAttrsMixin:b.success?b.value:null,groupInfoOrTruncatedGroupInfoOrGroupForbiddenOrGroupNotExistMixinGroup:a.value})}function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"groups");if(!c.success)return c;var e=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!e.success)return e;e=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",e.value);if(!e.success)return e;e=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","result");if(!e.success)return e;b=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",b.value);if(!a.success)return a;b=d("WASmaxParseUtils").mapChildrenWithTag(c.value,"group",1,1e4,h);return!b.success?b:d("WAResultOrError").makeResult({type:e.value,groupsGroup:b.value})}g.parseBatchGetGroupInfoResponseSuccessGroupsGroup=h;g.parseBatchGetGroupInfoResponseSuccess=a}),98);
__d("WASmaxOutGroupsBaseGetServerMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutGroupsBaseIQGetRequestMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxOutGroupsBaseIQGetRequestMixin").mergeBaseIQGetRequestMixin(d("WASmaxJsx").smax("iq",{to:d("WAWap").G_US,xmlns:"w:g2"}));return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBaseGetServerMixin=a}),98);
__d("WASmaxOutGroupsBatchGetGroupInfoRequest",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxOutGroupsBaseGetServerMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.groupJid;a=d("WASmaxJsx").smax("group",{jid:d("WAWap").GROUP_JID(a)});return a}function a(a){var b=a.groupArgs;a=a.queryContext;a=d("WASmaxOutGroupsBaseGetServerMixin").mergeBaseGetServerMixin(d("WASmaxJsx").smax("iq",null,d("WASmaxJsx").smax("query",{context:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,a)},d("WASmaxChildren").REPEATED_CHILD(h,b,1,1e4))));return a}g.makeBatchGetGroupInfoRequestQueryGroup=h;g.makeBatchGetGroupInfoRequest=a}),98);
__d("WASmaxGroupsBatchGetGroupInfoRPC",["WAComms","WASmaxInGroupsBatchGetGroupInfoResponseClientError","WASmaxInGroupsBatchGetGroupInfoResponseServerError","WASmaxInGroupsBatchGetGroupInfoResponseSuccess","WASmaxOutGroupsBatchGetGroupInfoRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,c){var e,f,g,h,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:e=d("WASmaxOutGroupsBatchGetGroupInfoRequest").makeBatchGetGroupInfoRequest(a);j.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(e,c));case 3:f=j.sent;g=d("WASmaxInGroupsBatchGetGroupInfoResponseSuccess").parseBatchGetGroupInfoResponseSuccess(f,e);if(!g.success){j.next=7;break}return j.abrupt("return",{name:"BatchGetGroupInfoResponseSuccess",value:g.value});case 7:h=d("WASmaxInGroupsBatchGetGroupInfoResponseClientError").parseBatchGetGroupInfoResponseClientError(f,e);if(!h.success){j.next=10;break}return j.abrupt("return",{name:"BatchGetGroupInfoResponseClientError",value:h.value});case 10:i=d("WASmaxInGroupsBatchGetGroupInfoResponseServerError").parseBatchGetGroupInfoResponseServerError(f,e);if(!i.success){j.next=13;break}return j.abrupt("return",{name:"BatchGetGroupInfoResponseServerError",value:i.value});case 13:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("BatchGetGroupInfo",{Success:g,ClientError:h,ServerError:i}));case 14:case"end":return j.stop()}},null,this)}g.sendBatchGetGroupInfoRPC=a}),98);
__d("WASmaxInGroupsIQErrorGoneMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","gone");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",410);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorGoneMixin=a}),98);
__d("WASmaxInGroupsIQErrorGrowthLockedMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"growth_locked");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","invite");if(!b.success)return b;a=d("WASmaxParseUtils").attrIntRange(a,"expiration",0,void 0);return!a.success?a:d("WAResultOrError").makeResult({type:b.value,expiration:a.value})}function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").optionalChildWithTag(a,"growth_locked",h);if(!b.success)return b;var c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","growth-locked");if(!c.success)return c;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",436);return!a.success?a:d("WAResultOrError").makeResult({text:c.value,code:a.value,growthLocked:b.value})}g.parseIQErrorGrowthLockedGrowthLocked=h;g.parseIQErrorGrowthLockedMixin=a}),98);
__d("WASmaxInGroupsGetInviteGroupInfoClientErrors",["WAResultOrError","WASmaxInGroupsIQErrorBadRequestMixin","WASmaxInGroupsIQErrorFallbackClientMixin","WASmaxInGroupsIQErrorGoneMixin","WASmaxInGroupsIQErrorGrowthLockedMixin","WASmaxInGroupsIQErrorItemNotFoundMixin","WASmaxInGroupsIQErrorLockedMixin","WASmaxInGroupsIQErrorNotAcceptableMixin","WASmaxInGroupsIQErrorNotAuthorizedMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorBadRequest",value:b.value});var c=d("WASmaxInGroupsIQErrorItemNotFoundMixin").parseIQErrorItemNotFoundMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"IQErrorItemNotFound",value:c.value});var e=d("WASmaxInGroupsIQErrorGoneMixin").parseIQErrorGoneMixin(a);if(e.success)return d("WAResultOrError").makeResult({name:"IQErrorGone",value:e.value});var f=d("WASmaxInGroupsIQErrorNotAuthorizedMixin").parseIQErrorNotAuthorizedMixin(a);if(f.success)return d("WAResultOrError").makeResult({name:"IQErrorNotAuthorized",value:f.value});var g=d("WASmaxInGroupsIQErrorNotAcceptableMixin").parseIQErrorNotAcceptableMixin(a);if(g.success)return d("WAResultOrError").makeResult({name:"IQErrorNotAcceptable",value:g.value});var h=d("WASmaxInGroupsIQErrorLockedMixin").parseIQErrorLockedMixin(a);if(h.success)return d("WAResultOrError").makeResult({name:"IQErrorLocked",value:h.value});var i=d("WASmaxInGroupsIQErrorGrowthLockedMixin").parseIQErrorGrowthLockedMixin(a);if(i.success)return d("WAResultOrError").makeResult({name:"IQErrorGrowthLocked",value:i.value});var j=d("WASmaxInGroupsIQErrorFallbackClientMixin").parseIQErrorFallbackClientMixin(a);return j.success?d("WAResultOrError").makeResult({name:"IQErrorFallbackClient",value:j.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorBadRequest","IQErrorItemNotFound","IQErrorGone","IQErrorNotAuthorized","IQErrorNotAcceptable","IQErrorLocked","IQErrorGrowthLocked","IQErrorFallbackClient"],[b,c,e,f,g,h,i,j])}g.parseGetInviteGroupInfoClientErrors=a}),98);
__d("WASmaxInGroupsGetInviteGroupInfoResponseClientError",["WAResultOrError","WASmaxInGroupsGetInviteGroupInfoClientErrors","WASmaxInGroupsIQErrorResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInGroupsIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInGroupsGetInviteGroupInfoClientErrors").parseGetInviteGroupInfoClientErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorGetInviteGroupInfoClientErrors:b.value}))}g.parseGetInviteGroupInfoResponseClientError=a}),98);
__d("WASmaxInGroupsGetInviteGroupInfoResponseServerError",["WASmaxInGroupsBaseServerErrorMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxInGroupsBaseServerErrorMixin").parseBaseServerErrorMixin(a,b);return!c.success?c:c}g.parseGetInviteGroupInfoResponseServerError=a}),98);
__d("WASmaxInGroupsInviteLinkGroupInfoMixin",["WAResultOrError","WASmaxInGroupsGroupInfoAttributesMixin","WASmaxInGroupsGroupInfoDescriptionMixin","WASmaxInGroupsGroupInfoParticipantMixin","WASmaxInGroupsMembershipApprovalGroupJoinModeEnabledMixin","WASmaxInGroupsNamedSubjectMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"participant");if(!b.success)return b;b=d("WASmaxInGroupsGroupInfoParticipantMixin").parseGroupInfoParticipantMixin(a);return!b.success?b:b}function i(a){var b=d("WASmaxParseUtils").assertTag(a,"parent");if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"num_sub_groups",1,1e3);return!b.success?b:d("WAResultOrError").makeResult({numSubGroups:b.value})}function j(a){var b=d("WASmaxParseUtils").assertTag(a,"linked_parent");if(!b.success)return b;b=d("WASmaxParseJid").attrGroupJid(a,"jid");if(!b.success)return b;a=d("WASmaxInGroupsNamedSubjectMixin").parseNamedSubjectMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({jid:b.value},a.value))}function k(a){var b=d("WASmaxParseUtils").assertTag(a,"membership_approval_mode");if(!b.success)return b;b=d("WASmaxInGroupsMembershipApprovalGroupJoinModeEnabledMixin").parseMembershipApprovalGroupJoinModeEnabledMixin(a);return!b.success?b:b}function l(a){var b=d("WASmaxParseUtils").assertTag(a,"membership_approval_request");if(!b.success)return b;b=d("WASmaxParseUtils").optionalLiteral(d("WASmaxParseUtils").attrString,a,"error","304");return!b.success?b:d("WAResultOrError").makeResult({error:b.value})}function a(a){var b=d("WASmaxParseUtils").assertTag(a,"group");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"description");if(!b.success)return b;var c=d("WASmaxParseUtils").optionalChildWithTag(a,"parent",i);if(!c.success)return c;var e=d("WASmaxParseUtils").optionalChildWithTag(a,"linked_parent",j);if(!e.success)return e;var f=d("WASmaxParseUtils").optionalChild(a,"default_sub_group");if(!f.success)return f;var g=d("WASmaxParseUtils").optionalChild(a,"general_chat");if(!g.success)return g;var m=d("WASmaxParseUtils").optionalChildWithTag(a,"membership_approval_mode",k);if(!m.success)return m;var n=d("WASmaxParseUtils").optionalChildWithTag(a,"membership_approval_request",l);if(!n.success)return n;var o=d("WASmaxParseUtils").attrIntRange(a,"size",0,19999);if(!o.success)return o;b=d("WASmaxInGroupsGroupInfoDescriptionMixin").parseGroupInfoDescriptionMixin(b.value);var p=d("WASmaxInGroupsGroupInfoAttributesMixin").parseGroupInfoAttributesMixin(a);if(!p.success)return p;a=d("WASmaxParseUtils").mapChildrenWithTag(a,"participant",0,19999,h);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({size:o.value,descriptionGroupInfoDescriptionMixin:b.success?b.value:null},p.value,{parent:c.value,linkedParent:e.value,hasDefaultSubGroup:f.value!=null,hasGeneralChat:g.value!=null,membershipApprovalMode:m.value,membershipApprovalRequest:n.value,participant:a.value}))}g.parseInviteLinkGroupInfoParticipant=h;g.parseInviteLinkGroupInfoParent=i;g.parseInviteLinkGroupInfoLinkedParent=j;g.parseInviteLinkGroupInfoMembershipApprovalMode=k;g.parseInviteLinkGroupInfoMembershipApprovalRequest=l;g.parseInviteLinkGroupInfoMixin=a}),98);
__d("WASmaxInGroupsGetInviteGroupInfoResponseSuccess",["WAResultOrError","WASmaxInGroupsInviteLinkGroupInfoMixin","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"group");if(!c.success)return c;var e=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!e.success)return e;e=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",e.value);if(!e.success)return e;e=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","result");if(!e.success)return e;b=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",b.value);if(!a.success)return a;b=d("WASmaxParseUtils").attrIntRange(c.value,"size",0,19999);if(!b.success)return b;a=d("WASmaxInGroupsInviteLinkGroupInfoMixin").parseInviteLinkGroupInfoMixin(c.value);return!a.success?a:d("WAResultOrError").makeResult({type:e.value,groupSize:b.value,groupInviteLinkGroupInfoMixin:a.value})}g.parseGetInviteGroupInfoResponseSuccess=a}),98);
__d("WASmaxOutGroupsGetInviteGroupInfoRequest",["WASmaxJsx","WASmaxOutGroupsBaseGetServerMixin","WAWap"],(function(a,b,c,d,e,f,g){function a(a){a=a.inviteCode;a=d("WASmaxOutGroupsBaseGetServerMixin").mergeBaseGetServerMixin(d("WASmaxJsx").smax("iq",null,d("WASmaxJsx").smax("invite",{code:d("WAWap").CUSTOM_STRING(a)})));return a}g.makeGetInviteGroupInfoRequest=a}),98);
__d("WASmaxGroupsGetInviteGroupInfoRPC",["WAComms","WASmaxInGroupsGetInviteGroupInfoResponseClientError","WASmaxInGroupsGetInviteGroupInfoResponseServerError","WASmaxInGroupsGetInviteGroupInfoResponseSuccess","WASmaxOutGroupsGetInviteGroupInfoRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,c){var e,f,g,h,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:e=d("WASmaxOutGroupsGetInviteGroupInfoRequest").makeGetInviteGroupInfoRequest(a);j.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(e,c));case 3:f=j.sent;g=d("WASmaxInGroupsGetInviteGroupInfoResponseSuccess").parseGetInviteGroupInfoResponseSuccess(f,e);if(!g.success){j.next=7;break}return j.abrupt("return",{name:"GetInviteGroupInfoResponseSuccess",value:g.value});case 7:h=d("WASmaxInGroupsGetInviteGroupInfoResponseClientError").parseGetInviteGroupInfoResponseClientError(f,e);if(!h.success){j.next=10;break}return j.abrupt("return",{name:"GetInviteGroupInfoResponseClientError",value:h.value});case 10:i=d("WASmaxInGroupsGetInviteGroupInfoResponseServerError").parseGetInviteGroupInfoResponseServerError(f,e);if(!i.success){j.next=13;break}return j.abrupt("return",{name:"GetInviteGroupInfoResponseServerError",value:i.value});case 13:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("GetInviteGroupInfo",{Success:g,ClientError:h,ServerError:i}));case 14:case"end":return j.stop()}},null,this)}g.sendGetInviteGroupInfoRPC=a}),98);
__d("WASmaxInGroupsIQErrorBadRequestOrRateOverlimitOrFallbackClientMixinGroup",["WAResultOrError","WASmaxInGroupsIQErrorBadRequestMixin","WASmaxInGroupsIQErrorFallbackClientMixin","WASmaxInGroupsIQErrorRateOverlimitMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorBadRequest",value:b.value});var c=d("WASmaxInGroupsIQErrorRateOverlimitMixin").parseIQErrorRateOverlimitMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"IQErrorRateOverlimit",value:c.value});var e=d("WASmaxInGroupsIQErrorFallbackClientMixin").parseIQErrorFallbackClientMixin(a);return e.success?d("WAResultOrError").makeResult({name:"IQErrorFallbackClient",value:e.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorBadRequest","IQErrorRateOverlimit","IQErrorFallbackClient"],[b,c,e])}g.parseIQErrorBadRequestOrRateOverlimitOrFallbackClientMixinGroup=a}),98);
__d("WASmaxInGroupsGetParticipatingGroupsResponseClientError",["WAResultOrError","WASmaxInGroupsIQErrorBadRequestOrRateOverlimitOrFallbackClientMixinGroup","WASmaxInGroupsIQErrorResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInGroupsIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInGroupsIQErrorBadRequestOrRateOverlimitOrFallbackClientMixinGroup").parseIQErrorBadRequestOrRateOverlimitOrFallbackClientMixinGroup(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorIQErrorBadRequestOrRateOverlimitOrFallbackClientMixinGroup:b.value}))}g.parseGetParticipatingGroupsResponseClientError=a}),98);
__d("WASmaxInGroupsGetParticipatingGroupsResponseServerError",["WASmaxInGroupsBaseServerErrorMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxInGroupsBaseServerErrorMixin").parseBaseServerErrorMixin(a,b);return!c.success?c:c}g.parseGetParticipatingGroupsResponseServerError=a}),98);
__d("WASmaxInGroupsGroupInfoOrTruncatedGroupInfoGroupInfoMixinGroup",["WAResultOrError","WASmaxInGroupsGroupInfoMixin","WASmaxInGroupsTruncatedGroupInfoMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsGroupInfoMixin").parseGroupInfoMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"GroupInfo",value:b.value});var c=d("WASmaxInGroupsTruncatedGroupInfoMixin").parseTruncatedGroupInfoMixin(a);return c.success?d("WAResultOrError").makeResult({name:"TruncatedGroupInfo",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["GroupInfo","TruncatedGroupInfo"],[b,c])}g.parseGroupInfoOrTruncatedGroupInfoGroupInfoMixinGroup=a}),98);
__d("WASmaxInGroupsGetParticipatingGroupsResponseSuccess",["WAResultOrError","WASmaxInGroupsDedupAttrsMixin","WASmaxInGroupsGroupInfoOrTruncatedGroupInfoGroupInfoMixinGroup","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"group");if(!b.success)return b;b=d("WASmaxInGroupsDedupAttrsMixin").parseDedupAttrsMixin(a);a=d("WASmaxInGroupsGroupInfoOrTruncatedGroupInfoGroupInfoMixinGroup").parseGroupInfoOrTruncatedGroupInfoGroupInfoMixinGroup(a);return!a.success?a:d("WAResultOrError").makeResult({dedupAttrsMixin:b.success?b.value:null,groupInfoOrTruncatedGroupInfoGroupInfoMixinGroup:a.value})}function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"groups");if(!c.success)return c;var e=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!e.success)return e;e=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",e.value);if(!e.success)return e;e=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","result");if(!e.success)return e;b=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",b.value);if(!a.success)return a;b=d("WASmaxParseUtils").mapChildrenWithTag(c.value,"group",0,1e4,h);return!b.success?b:d("WAResultOrError").makeResult({type:e.value,groupsGroup:b.value})}g.parseGetParticipatingGroupsResponseSuccessGroupsGroup=h;g.parseGetParticipatingGroupsResponseSuccess=a}),98);
__d("WASmaxOutGroupsGetParticipatingGroupsRequest",["WASmaxChildren","WASmaxJsx","WASmaxOutGroupsBaseGetServerMixin"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("participants",null);return a}function i(){var a=d("WASmaxJsx").smax("description",null);return a}function a(a){var b=a.hasParticipants;a=a.hasDescription;b=d("WASmaxOutGroupsBaseGetServerMixin").mergeBaseGetServerMixin(d("WASmaxJsx").smax("iq",null,d("WASmaxJsx").smax("participating",null,d("WASmaxChildren").HAS_OPTIONAL_CHILD(h,b),d("WASmaxChildren").HAS_OPTIONAL_CHILD(i,a))));return b}g.makeGetParticipatingGroupsRequestParticipatingParticipants=h;g.makeGetParticipatingGroupsRequestParticipatingDescription=i;g.makeGetParticipatingGroupsRequest=a}),98);
__d("WASmaxGroupsGetParticipatingGroupsRPC",["WAComms","WASmaxInGroupsGetParticipatingGroupsResponseClientError","WASmaxInGroupsGetParticipatingGroupsResponseServerError","WASmaxInGroupsGetParticipatingGroupsResponseSuccess","WASmaxOutGroupsGetParticipatingGroupsRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,c){var e,f,g,h,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:e=d("WASmaxOutGroupsGetParticipatingGroupsRequest").makeGetParticipatingGroupsRequest(a);j.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(e,c));case 3:f=j.sent;g=d("WASmaxInGroupsGetParticipatingGroupsResponseSuccess").parseGetParticipatingGroupsResponseSuccess(f,e);if(!g.success){j.next=7;break}return j.abrupt("return",{name:"GetParticipatingGroupsResponseSuccess",value:g.value});case 7:h=d("WASmaxInGroupsGetParticipatingGroupsResponseClientError").parseGetParticipatingGroupsResponseClientError(f,e);if(!h.success){j.next=10;break}return j.abrupt("return",{name:"GetParticipatingGroupsResponseClientError",value:h.value});case 10:i=d("WASmaxInGroupsGetParticipatingGroupsResponseServerError").parseGetParticipatingGroupsResponseServerError(f,e);if(!i.success){j.next=13;break}return j.abrupt("return",{name:"GetParticipatingGroupsResponseServerError",value:i.value});case 13:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("GetParticipatingGroups",{Success:g,ClientError:h,ServerError:i}));case 14:case"end":return j.stop()}},null,this)}g.sendGetParticipatingGroupsRPC=a}),98);
__d("WASmaxInGroupsGetMembershipApprovalRequestsClientErrors",["WAResultOrError","WASmaxInGroupsIQErrorBadRequestMixin","WASmaxInGroupsIQErrorFallbackClientMixin","WASmaxInGroupsIQErrorForbiddenMixin","WASmaxInGroupsIQErrorItemNotFoundMixin","WASmaxInGroupsIQErrorLockedMixin","WASmaxInGroupsIQErrorNotAuthorizedMixin","WASmaxInGroupsIQErrorRateOverlimitMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorBadRequest",value:b.value});var c=d("WASmaxInGroupsIQErrorItemNotFoundMixin").parseIQErrorItemNotFoundMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"IQErrorItemNotFound",value:c.value});var e=d("WASmaxInGroupsIQErrorNotAuthorizedMixin").parseIQErrorNotAuthorizedMixin(a);if(e.success)return d("WAResultOrError").makeResult({name:"IQErrorNotAuthorized",value:e.value});var f=d("WASmaxInGroupsIQErrorForbiddenMixin").parseIQErrorForbiddenMixin(a);if(f.success)return d("WAResultOrError").makeResult({name:"IQErrorForbidden",value:f.value});var g=d("WASmaxInGroupsIQErrorRateOverlimitMixin").parseIQErrorRateOverlimitMixin(a);if(g.success)return d("WAResultOrError").makeResult({name:"IQErrorRateOverlimit",value:g.value});var h=d("WASmaxInGroupsIQErrorLockedMixin").parseIQErrorLockedMixin(a);if(h.success)return d("WAResultOrError").makeResult({name:"IQErrorLocked",value:h.value});var i=d("WASmaxInGroupsIQErrorFallbackClientMixin").parseIQErrorFallbackClientMixin(a);return i.success?d("WAResultOrError").makeResult({name:"IQErrorFallbackClient",value:i.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorBadRequest","IQErrorItemNotFound","IQErrorNotAuthorized","IQErrorForbidden","IQErrorRateOverlimit","IQErrorLocked","IQErrorFallbackClient"],[b,c,e,f,g,h,i])}g.parseGetMembershipApprovalRequestsClientErrors=a}),98);
__d("WASmaxInGroupsGetMembershipApprovalRequestsResponseClientError",["WAResultOrError","WASmaxInGroupsGetMembershipApprovalRequestsClientErrors","WASmaxInGroupsIQErrorResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInGroupsIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInGroupsGetMembershipApprovalRequestsClientErrors").parseGetMembershipApprovalRequestsClientErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorGetMembershipApprovalRequestsClientErrors:b.value}))}g.parseGetMembershipApprovalRequestsResponseClientError=a}),98);
__d("WASmaxInGroupsGetMembershipApprovalRequestsResponseServerError",["WASmaxInGroupsBaseServerErrorMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxInGroupsBaseServerErrorMixin").parseBaseServerErrorMixin(a,b);return!c.success?c:c}g.parseGetMembershipApprovalRequestsResponseServerError=a}),98);
__d("WASmaxInGroupsMembershipRequestMethodAttributeMixin",["WAResultOrError","WASmaxInGroupsEnums","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").attrStringEnum(a,"request_method",d("WASmaxInGroupsEnums").ENUM_INVITELINK_LINKEDGROUPJOIN_NONADMINADD);return!a.success?a:d("WAResultOrError").makeResult({requestMethod:a.value})}g.parseMembershipRequestMethodAttributeMixin=a}),98);
__d("WASmaxInGroupsGetMembershipApprovalRequestsMembershipApprovalRequestMixin",["WAResultOrError","WASmaxInGroupsMembershipRequestMethodAttributeMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"membership_approval_request");if(!b.success)return b;b=d("WASmaxParseJid").attrUserJid(a,"jid");if(!b.success)return b;var c=d("WASmaxParseUtils").optional(d("WASmaxParseJid").attrUserJid,a,"requestor");if(!c.success)return c;var e=d("WASmaxParseUtils").optional(d("WASmaxParseJid").attrGroupJid,a,"parent_group_jid");if(!e.success)return e;var f=d("WASmaxParseUtils").attrIntRange(a,"request_time",0,void 0);if(!f.success)return f;a=d("WASmaxInGroupsMembershipRequestMethodAttributeMixin").parseMembershipRequestMethodAttributeMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({jid:b.value,requestor:c.value,parentGroupJid:e.value,requestTime:f.value},a.value))}g.parseGetMembershipApprovalRequestsMembershipApprovalRequestMixin=a}),98);
__d("WASmaxInGroupsGetMembershipApprovalRequestsRequestorFetchMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"requestor_fetch","true");return!a.success?a:d("WAResultOrError").makeResult({requestorFetch:a.value})}g.parseGetMembershipApprovalRequestsRequestorFetchMixin=a}),98);
__d("WASmaxInGroupsGetMembershipApprovalRequestsResponseSuccess",["WAResultOrError","WASmaxInGroupsGetMembershipApprovalRequestsMembershipApprovalRequestMixin","WASmaxInGroupsGetMembershipApprovalRequestsRequestorFetchMixin","WASmaxInGroupsGroupAddressingModeMixin","WASmaxInGroupsIQResultResponseMixin","WASmaxInGroupsPhoneNumberMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"membership_approval_request");if(!b.success)return b;b=d("WASmaxInGroupsGetMembershipApprovalRequestsMembershipApprovalRequestMixin").parseGetMembershipApprovalRequestsMembershipApprovalRequestMixin(a);if(!b.success)return b;a=d("WASmaxInGroupsPhoneNumberMixin").parsePhoneNumberMixin(a);return d("WAResultOrError").makeResult(babelHelpers["extends"]({},b.value,{phoneNumberMixin:a.success?a.value:null}))}function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"membership_approval_requests");if(!c.success)return c;var e=d("WASmaxInGroupsGetMembershipApprovalRequestsRequestorFetchMixin").parseGetMembershipApprovalRequestsRequestorFetchMixin(c.value);b=d("WASmaxInGroupsIQResultResponseMixin").parseIQResultResponseMixin(a,b);if(!b.success)return b;a=d("WASmaxInGroupsGroupAddressingModeMixin").parseGroupAddressingModeMixin(a);c=d("WASmaxParseUtils").mapChildrenWithTag(c.value,"membership_approval_request",0,19999,h);return!c.success?c:d("WAResultOrError").makeResult(babelHelpers["extends"]({membershipApprovalRequestsGetMembershipApprovalRequestsRequestorFetchMixin:e.success?e.value:null},b.value,{groupAddressingModeMixin:a.success?a.value:null,membershipApprovalRequestsMembershipApprovalRequest:c.value}))}g.parseGetMembershipApprovalRequestsResponseSuccessMembershipApprovalRequestsMembershipApprovalRequest=h;g.parseGetMembershipApprovalRequestsResponseSuccess=a}),98);
__d("WASmaxOutGroupsGetMembershipApprovalRequestsRequestorFetchMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("smax$any",{requestor_fetch:"true"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeGetMembershipApprovalRequestsRequestorFetchMixin=a}),98);
__d("WASmaxOutGroupsGetMembershipApprovalRequestsRequest",["WASmaxJsx","WASmaxMixins","WASmaxOutGroupsBaseGetGroupMixin","WASmaxOutGroupsGetMembershipApprovalRequestsRequestorFetchMixin"],(function(a,b,c,d,e,f,g){function a(a){var b=a.hasGetMembershipApprovalRequestsRequestorFetch;b=d("WASmaxOutGroupsBaseGetGroupMixin").mergeBaseGetGroupMixin(d("WASmaxJsx").smax("iq",null,d("WASmaxMixins").optionalMerge(d("WASmaxOutGroupsGetMembershipApprovalRequestsRequestorFetchMixin").mergeGetMembershipApprovalRequestsRequestorFetchMixin,d("WASmaxJsx").smax("membership_approval_requests",null),b)),a);return b}g.makeGetMembershipApprovalRequestsRequest=a}),98);
__d("WASmaxGroupsGetMembershipApprovalRequestsRPC",["WAComms","WASmaxInGroupsGetMembershipApprovalRequestsResponseClientError","WASmaxInGroupsGetMembershipApprovalRequestsResponseServerError","WASmaxInGroupsGetMembershipApprovalRequestsResponseSuccess","WASmaxOutGroupsGetMembershipApprovalRequestsRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,c){var e,f,g,h,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:e=d("WASmaxOutGroupsGetMembershipApprovalRequestsRequest").makeGetMembershipApprovalRequestsRequest(a);j.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(e,c));case 3:f=j.sent;g=d("WASmaxInGroupsGetMembershipApprovalRequestsResponseSuccess").parseGetMembershipApprovalRequestsResponseSuccess(f,e);if(!g.success){j.next=7;break}return j.abrupt("return",{name:"GetMembershipApprovalRequestsResponseSuccess",value:g.value});case 7:h=d("WASmaxInGroupsGetMembershipApprovalRequestsResponseClientError").parseGetMembershipApprovalRequestsResponseClientError(f,e);if(!h.success){j.next=10;break}return j.abrupt("return",{name:"GetMembershipApprovalRequestsResponseClientError",value:h.value});case 10:i=d("WASmaxInGroupsGetMembershipApprovalRequestsResponseServerError").parseGetMembershipApprovalRequestsResponseServerError(f,e);if(!i.success){j.next=13;break}return j.abrupt("return",{name:"GetMembershipApprovalRequestsResponseServerError",value:i.value});case 13:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("GetMembershipApprovalRequests",{Success:g,ClientError:h,ServerError:i}));case 14:case"end":return j.stop()}},null,this)}g.sendGetMembershipApprovalRequestsRPC=a}),98);
__d("WAWebApiMembershipApprovalRequestStore",["WAWebSchemaMembershipApprovalRequest","WAWebWidFactory"],(function(a,b,c,d,e,f,g){a=function(a){return d("WAWebSchemaMembershipApprovalRequest").getMembershipApprovalRequestTable().equals(["groupId"],a.toString()).then(function(a){return a.map(function(a){var b=a.id,c=a.t,e=a.addedBy,f=a.requestMethod;a=a.parentGroupId;return{id:d("WAWebWidFactory").createWid(b),t:c,addedBy:d("WAWebWidFactory").createWid(e),requestMethod:f,parentGroupId:a!=null?d("WAWebWidFactory").createWid(a):void 0}})})};b=function(a,b){b=b.map(function(b){var c=b.id,d=b.t,e=b.addedBy,f=b.requestMethod;b=b.parentGroupId;return{groupId:a.toString(),id:c.toString(),t:d,addedBy:e.toString(),requestMethod:f,parentGroupId:b==null?void 0:b.toString()}});return d("WAWebSchemaMembershipApprovalRequest").getMembershipApprovalRequestTable().bulkCreateOrReplace(b)};c=function(a,b){var c=a.toString();return d("WAWebSchemaMembershipApprovalRequest").getMembershipApprovalRequestTable().bulkRemove(b.map(function(a){return[c,a.toString()]}))};e=function(a){return d("WAWebSchemaMembershipApprovalRequest").getMembershipApprovalRequestTable().bulkRemoveByIndex(["groupId"],[a.toString()])};g.getMembershipApprovalRequests=a;g.addMembershipApprovalRequests=b;g.removeMembershipApprovalRequests=c;g.removeAllMembershipApprovalRequests=e}),98);
__d("WAWebRequestMethodType",["$InternalEnum"],(function(a,b,c,d,e,f){a=b("$InternalEnum").Mirrored(["NonAdminAdd","InviteLink","LinkedGroupJoin"]);f.RequestMethod=a}),66);
__d("WAWebGroupGetMembershipApprovalRequestsJob",["Promise","WALogger","WASmaxGroupsGetMembershipApprovalRequestsRPC","WAWebApiMembershipApprovalRequestStore","WAWebBackendApi","WAWebBackendErrors","WAWebJidToWid","WAWebRequestMethodType","WAWebWidToJid","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["queryMembershipApprovalRequests failed: ",":",""]);i=function(){return a};return a}function j(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("WASmaxGroupsGetMembershipApprovalRequestsRPC").sendGetMembershipApprovalRequestsRPC({iqTo:d("WAWebWidToJid").widToGroupJid(a)}));switch(a.name){case"GetMembershipApprovalRequestsResponseSuccess":return a.value.membershipApprovalRequestsMembershipApprovalRequest.map(function(a){var b=d("WAWebJidToWid").userJidToUserWid(a.jid);return{id:b,t:a.requestTime,addedBy:a.requestor!=null?d("WAWebJidToWid").userJidToUserWid(a.requestor):b,requestMethod:l(a.requestMethod),parentGroupId:a.parentGroupJid!=null?d("WAWebJidToWid").groupJidToWid(a.parentGroupJid):void 0}});case"GetMembershipApprovalRequestsResponseClientError":var b=a.value.errorGetMembershipApprovalRequestsClientErrors;return m(b.value);default:a.name;return m(a.value.errorServerErrors.value)}});return k.apply(this,arguments)}function l(a){switch(a){case"invite_link":return d("WAWebRequestMethodType").RequestMethod.InviteLink;case"linked_group_join":return d("WAWebRequestMethodType").RequestMethod.LinkedGroupJoin;case"non_admin_add":return d("WAWebRequestMethodType").RequestMethod.NonAdminAdd}}function m(a){var c=a.code;a=a.text;d("WALogger").LOG(i(),c,a);return(h||(h=b("Promise"))).reject(new(d("WAWebBackendErrors").ServerStatusCodeError)(Number(c),a))}function a(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield j(a)),c=(yield d("WAWebApiMembershipApprovalRequestStore").getMembershipApprovalRequests(a));c=c.filter(function(a){return!b.some(function(b){return b.id.equals(a.id)})});yield d("WAWebApiMembershipApprovalRequestStore").removeMembershipApprovalRequests(a,c.map(function(a){return a.id}));yield d("WAWebApiMembershipApprovalRequestStore").addMembershipApprovalRequests(a,b);d("WAWebBackendApi").frontendFireAndForget("removeMembershipApprovalRequests",{groupId:a,requestIds:c.map(function(a){return a.id})});d("WAWebBackendApi").frontendFireAndForget("addMembershipApprovalRequests",{groupId:a,requests:b})});return n.apply(this,arguments)}g.queryMembershipApprovalRequests=j;g.queryAndUpdateGroupMembershipApprovalRequests=a}),98);
__d("WAWebGroupQueryJob",["Promise","WALogger","WASmaxGroupsBatchGetGroupInfoRPC","WASmaxGroupsGetInviteGroupInfoRPC","WASmaxGroupsGetParticipatingGroupsRPC","WAWebABProps","WAWebApiChat","WAWebApiParticipantStore","WAWebBackendApi","WAWebBackendErrors","WAWebGroupDatabaseJob","WAWebGroupGetMembershipApprovalRequestsJob","WAWebGroupQueryGroupJob","WAWebGroupsQueryApi","WAWebUserPrefsMeUser","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["queryGroupsById failed: ",":",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["queryGroupsById failed: ",":",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["queryGroupsById: successfully received batch group info for ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["queryAndUpdateGroupMetadataById: skip update due to phash match"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["queryAndUpdateGroupMetadataById: unable to query group ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["queryGroupInvite failed: ",":",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["queryGroupInvite failed: ",":",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["queryAllGroups failed: ",":",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["queryAllGroups failed: ",":",""]);q=function(){return a};return a}function a(){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){d("WAWebApiParticipantStore").clearAdminshipCache();var a=(yield d("WASmaxGroupsGetParticipatingGroupsRPC").sendGetParticipatingGroupsRPC({hasParticipants:!0,hasDescription:!0}));switch(a.name){case"GetParticipatingGroupsResponseSuccess":return a.value.groupsGroup.map(function(a){a=a.groupInfoOrTruncatedGroupInfoGroupInfoMixinGroup;return d("WAWebGroupsQueryApi").parseGroupSmax(a.value)});case"GetParticipatingGroupsResponseClientError":var c=a.value.errorIQErrorBadRequestOrRateOverlimitOrFallbackClientMixinGroup.value,e=c.code;c=c.text;d("WALogger").LOG(q(),e,c);return(h||(h=b("Promise"))).reject(new(d("WAWebBackendErrors").ServerStatusCodeError)(Number(e),c));case"GetParticipatingGroupsResponseServerError":e=a.value.errorServerErrors.value;c=e.code;a=e.text;d("WALogger").LOG(p(),c,a);return(h||(h=b("Promise"))).reject(new(d("WAWebBackendErrors").ServerStatusCodeError)(Number(c),a))}});return r.apply(this,arguments)}function c(a){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("WASmaxGroupsGetInviteGroupInfoRPC").sendGetInviteGroupInfoRPC({inviteCode:a}));switch(a.name){case"GetInviteGroupInfoResponseSuccess":return d("WAWebGroupsQueryApi").parseGroupSmax(a.value.groupInviteLinkGroupInfoMixin);case"GetInviteGroupInfoResponseClientError":var c=a.value.errorGetInviteGroupInfoClientErrors.value,e=c.code;c=c.text;d("WALogger").LOG(o(),e,c);return(h||(h=b("Promise"))).reject(new(d("WAWebBackendErrors").ServerStatusCodeError)(Number(e),c));case"GetInviteGroupInfoResponseServerError":e=a.value.errorServerErrors.value;c=e.code;a=e.text;d("WALogger").LOG(n(),c,a);return(h||(h=b("Promise"))).reject(new(d("WAWebBackendErrors").ServerStatusCodeError)(Number(c),a))}});return s.apply(this,arguments)}function e(a,b){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){b=(yield d("WAWebGroupQueryGroupJob").queryGroupJob(a,b));if(b==null){d("WALogger").DEV(m(),a);return}if(b.phashMatch){d("WALogger").LOG(l());return}a=(yield d("WAWebApiParticipantStore").injectPastParticipantsFromDB([b]));b=a[0];yield d("WAWebGroupDatabaseJob").updateGroupParticipantTableWithoutDeviceSyncJob([b]);d("WAWebBackendApi").frontendFireAndForget("createOrUpdateGroupMetadataFromQuery",{groupInfo:b});yield u(b)});return t.apply(this,arguments)}function u(a){return v.apply(this,arguments)}function v(){v=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.membershipApprovalMode&&a.participants.some(function(a){return d("WAWebUserPrefsMeUser").isMeAccount(a.id)&&a.isAdmin})&&d("WAWebABProps").getABPropConfigValue("group_join_request_m2")){var b=(yield d("WAWebApiChat").getChatRecord(a.id));if(!b)return;return d("WAWebGroupGetMembershipApprovalRequestsJob").queryAndUpdateGroupMembershipApprovalRequests(a.id)}});return v.apply(this,arguments)}function f(a,b){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){var e=(yield d("WASmaxGroupsBatchGetGroupInfoRPC").sendBatchGetGroupInfoRPC({queryContext:c,groupArgs:a.map(function(a){return{groupJid:a}})}));switch(e.name){case"BatchGetGroupInfoResponseSuccess":d("WALogger").LOG(k(),a.length);return d("WAWebGroupsQueryApi").parseBatchGroupInfoSmax(c,e.value.groupsGroup);case"BatchGetGroupInfoResponseClientError":a=e.value.errorBatchGetGroupInfoClientErrors.value;c=a.code;a=a.text;d("WALogger").LOG(j(),c,a);return(h||(h=b("Promise"))).reject(new(d("WAWebBackendErrors").ServerStatusCodeError)(Number(c),a));case"BatchGetGroupInfoResponseServerError":c=e.value.errorServerErrors.value;a=c.code;e=c.text;d("WALogger").LOG(i(),a,e);return(h||(h=b("Promise"))).reject(new(d("WAWebBackendErrors").ServerStatusCodeError)(Number(a),e))}});return w.apply(this,arguments)}g.queryAllGroups=a;g.queryGroupInvite=c;g.queryAndUpdateGroupMetadataById=e;g.maybeQueryAndUpdateMembershipApprovalRequests=u;g.queryGroupsById=f}),98);
__d("WAWebSignalConst",[],(function(a,b,c,d,e,f){a={REG_ID:"signal_reg_id",STATIC_PUBKEY:"signal_static_pubkey",STATIC_PRIVKEY:"signal_static_privkey",NEXT_PK_ID:"signal_next_pk_id",LAST_SPK_ID:"signal_last_spk_id",FIRST_UNUPLOAD_PK_ID:"signal_first_unupload_pk_id",SERVER_HAS_KEY:"signal_sever_has_pre_keys",ADV_SIGNED_IDENTITY:"adv_signed_identity"};f.META_KEYS=a}),66);
__d("WAWebSignalStorageUtils",["invariant","Promise","WAWebIdb","WAWebStorage","err"],(function(a,b,c,d,e,f,g,h){var i,j="signal-storage",k=null;function a(){var a=new(c("WAWebIdb"))(j);k=new(d("WAWebStorage").Storage)(a)}function e(){k!=null||h(0,56356);return k}function f(){return k==null?(i||(i=b("Promise"))).reject(c("err")("[signal-storage] Storage should be created first before being destroyed")):k.purge().then(function(){k=null})["catch"](function(a){k=null;throw a})}g.DATABASE_NAME=j;g.createStorage=a;g.getStorage=e;g.destroyStorage=f}),98);
__d("WAWebSignalStorageVersions",["WAWebSignalStorageUtils"],(function(a,b,c,d,e,f,g){var h=6;function a(){return d("WAWebSignalStorageUtils").getStorage().versions.version(0)}function b(){return d("WAWebSignalStorageUtils").getStorage().versions.version(1)}function c(){return d("WAWebSignalStorageUtils").getStorage().versions.version(2)}function e(){return d("WAWebSignalStorageUtils").getStorage().versions.version(3)}function f(){return d("WAWebSignalStorageUtils").getStorage().versions.version(4)}function i(){return d("WAWebSignalStorageUtils").getStorage().versions.version(5)}function j(){return d("WAWebSignalStorageUtils").getStorage().versions.version(6)}g.versionToRollout=h;g.identityCreateTable=a;g.metaCreateTable=b;g.preKeyCreateTable=c;g.sessionCreateTable=e;g.signedPreKeyCreateTable=f;g.baseKeyCreateTable=i;g.senderKeyCreateTable=j}),98);
__d("WAWebSchemaBasekey",["WAWebSignalStorageUtils","WAWebSignalStorageVersions","WAWebStorageMutationBuilder"],(function(a,b,c,d,e,f,g){c=d("WAWebStorageMutationBuilder").columnBuilder();var h=c.addColumn,i=c.addAutoIncrementingPrimaryKey,j=c.addCompositeIndex;function a(){d("WAWebSignalStorageUtils").getStorage().add("baseKey-store").version(d("WAWebSignalStorageVersions").baseKeyCreateTable(),[i("id"),h("address"),h("originalMsgId"),h("baseKey"),j(["address","originalMsgId"])]).view(function(a){return{id:a.id,address:a.address,originalMsgId:a.originalMsgId,baseKey:a.baseKey}})}function b(){return d("WAWebSignalStorageUtils").getStorage().table("baseKey-store")}g.addTable=a;g.getTable=b}),98);
__d("WAWebSchemaIdentity",["WAWebSignalStorageUtils","WAWebSignalStorageVersions","WAWebStorageMutationBuilder"],(function(a,b,c,d,e,f,g){c=d("WAWebStorageMutationBuilder").columnBuilder();var h=c.addColumn,i=c.addUserDefinedPrimaryKey;function a(){d("WAWebSignalStorageUtils").getStorage().add("identity-store").version(d("WAWebSignalStorageVersions").identityCreateTable(),[i("identifier"),h("identityKey"),h("rowId"),h("sentAddonRowId")]).view(function(a){return{identifier:a.identifier,identityKey:a.identityKey,rowId:a.rowId,sentAddonRowId:a.sentAddonRowId}})}function b(){return d("WAWebSignalStorageUtils").getStorage().table("identity-store")}g.addTable=a;g.getTable=b}),98);
__d("WAWebSchemaMeta",["WAWebSignalStorageUtils","WAWebSignalStorageVersions","WAWebStorageMutationBuilder"],(function(a,b,c,d,e,f,g){c=d("WAWebStorageMutationBuilder").columnBuilder();var h=c.addColumn,i=c.addUserDefinedPrimaryKey;function a(){d("WAWebSignalStorageUtils").getStorage().add("signal-meta-store").version(d("WAWebSignalStorageVersions").metaCreateTable(),[i("key"),h("value")]).view(function(a){return{key:a.key,value:a.value}})}function b(){return d("WAWebSignalStorageUtils").getStorage().table("signal-meta-store")}g.addTable=a;g.getTable=b}),98);
__d("WAWebSchemaPrekey",["WAWebSignalStorageUtils","WAWebSignalStorageVersions","WAWebStorageMutationBuilder"],(function(a,b,c,d,e,f,g){c=d("WAWebStorageMutationBuilder").columnBuilder();var h=c.addColumn,i=c.addAutoIncrementingPrimaryKey;function a(){d("WAWebSignalStorageUtils").getStorage().add("prekey-store").version(d("WAWebSignalStorageVersions").preKeyCreateTable(),[i("keyId"),h("keyPair"),h("isDirectDistribution")]).view(function(a){return{keyId:a.keyId,keyPair:a.keyPair,isDirectDistribution:a.isDirectDistribution}})}function b(){return d("WAWebSignalStorageUtils").getStorage().table("prekey-store")}g.addTable=a;g.getTable=b}),98);
__d("WAWebSchemaSenderkey",["WAWebSignalStorageUtils","WAWebSignalStorageVersions","WAWebStorageMutationBuilder"],(function(a,b,c,d,e,f,g){c=d("WAWebStorageMutationBuilder").columnBuilder();var h=c.addColumn,i=c.addUserDefinedPrimaryKey,j=c.addIndex;function a(){d("WAWebSignalStorageUtils").getStorage().add("senderkey-store").version(d("WAWebSignalStorageVersions").senderKeyCreateTable(),[i("senderKeyName"),h("senderKey"),h("senderId"),j("senderId")]).view(function(a){return{senderKeyName:a.senderKeyName,senderKey:a.senderKey,senderId:a.senderId}})}function b(){return d("WAWebSignalStorageUtils").getStorage().table("senderkey-store")}g.addTable=a;g.getTable=b}),98);
__d("WAWebSchemaSession",["WAWebSignalStorageUtils","WAWebSignalStorageVersions","WAWebStorageMutationBuilder"],(function(a,b,c,d,e,f,g){c=d("WAWebStorageMutationBuilder").columnBuilder();var h=c.addColumn,i=c.addUserDefinedPrimaryKey;function a(){d("WAWebSignalStorageUtils").getStorage().add("session-store").version(d("WAWebSignalStorageVersions").sessionCreateTable(),[i("address"),h("session")]).view(function(a){return{address:a.address,session:a.session}})}function b(){return d("WAWebSignalStorageUtils").getStorage().table("session-store")}g.addTable=a;g.getTable=b}),98);
__d("WAWebSchemaSignedPrekey",["WAWebSignalStorageUtils","WAWebSignalStorageVersions","WAWebStorageMutationBuilder"],(function(a,b,c,d,e,f,g){c=d("WAWebStorageMutationBuilder").columnBuilder();var h=c.addColumn,i=c.addAutoIncrementingPrimaryKey;function a(){d("WAWebSignalStorageUtils").getStorage().add("signed-prekey-store").version(d("WAWebSignalStorageVersions").signedPreKeyCreateTable(),[i("keyId"),h("keyPair"),h("signature")]).view(function(a){return{keyId:a.keyId,keyPair:a.keyPair,signature:a.signature}})}function b(){return d("WAWebSignalStorageUtils").getStorage().table("signed-prekey-store")}g.addTable=a;g.getTable=b}),98);
__d("WAWebSignalStorage",["WALogger","WAWeb-dexie","WAWebDbRolloutUtil","WAWebDexieCastTypes","WAWebSchemaBasekey","WAWebSchemaIdentity","WAWebSchemaMeta","WAWebSchemaPrekey","WAWebSchemaSenderkey","WAWebSchemaSession","WAWebSchemaSignedPrekey","WAWebSignalStorageUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Assertion failed!"]);h=function(){return a};return a}var i;function a(){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){i==null&&(yield d("WAWebDbRolloutUtil").loadSchemaVersions(),d("WAWebSignalStorageUtils").createStorage(),d("WAWebSchemaBasekey").addTable(),d("WAWebSchemaIdentity").addTable(),d("WAWebSchemaMeta").addTable(),d("WAWebSchemaPrekey").addTable(),d("WAWebSchemaSenderkey").addTable(),d("WAWebSchemaSession").addTable(),d("WAWebSchemaSignedPrekey").addTable(),i=d("WAWebSignalStorageUtils").getStorage().initialize()["catch"](function(a){d("WALogger").ERROR(h()).verbose().devConsole(a).tags("sad").sendLogs("Failed to initialize signal storage");throw a}));return i});return j.apply(this,arguments)}function e(){return d("WAWebSignalStorageUtils").destroyStorage()["catch"](function(){return d("WAWebDexieCastTypes").dexieCastToPromise(new(c("WAWeb-dexie"))(d("WAWebSignalStorageUtils").DATABASE_NAME)["delete"]())})["finally"](function(){i=null})}g.getBaseKeyTable=d("WAWebSchemaBasekey").getTable;g.getIdentityTable=d("WAWebSchemaIdentity").getTable;g.getMetaTable=d("WAWebSchemaMeta").getTable;g.getPreKeyTable=d("WAWebSchemaPrekey").getTable;g.getSenderKeyTable=d("WAWebSchemaSenderkey").getTable;g.getSessionTable=d("WAWebSchemaSession").getTable;g.getSignedPreKeyTable=d("WAWebSchemaSignedPrekey").getTable;g.initialize=a;g.destroy=e}),98);
__d("WAWebSignalStoreApi",["Promise","WALogger","WAWebSignalCommonUtils","WAWebSignalConst","WAWebSignalStorage","WAWebSignalStorageUtils","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["getPreKeys: no prekey needs to be generated, available: ",", need: ",""]);i=function(){return a};return a}var j=1;a=function(){function a(){this.idToSignedPreKey=new Map()}var e=a.prototype;e.getMeta=function(a){var b=d("WAWebSignalStorage").getMetaTable();return b.get(a).then(function(a){return a?a.value:null})};e.putMeta=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=d("WAWebSignalStorage").getMetaTable();a=a.map(function(a){return c.createOrReplace(a)});yield (h||(h=b("Promise"))).all(a)});function c(b){return a.apply(this,arguments)}return c}();e.setServerHasPreKeys=function(a){this.putMeta([{key:d("WAWebSignalConst").META_KEYS.SERVER_HAS_KEY,value:a}])};e.getServerHasPreKeys=function(){return this.getMeta(d("WAWebSignalConst").META_KEYS.SERVER_HAS_KEY)};e.putADVSignedIdentity=function(a){return this.putMeta([{key:d("WAWebSignalConst").META_KEYS.ADV_SIGNED_IDENTITY,value:a}])};e.getADVSignedIdentity=function(){return this.getMeta(d("WAWebSignalConst").META_KEYS.ADV_SIGNED_IDENTITY)};e.getPreKeysByRange=function(a,b){var c=d("WAWebSignalStorage").getPreKeyTable();return c.greaterThan(["keyId"],a-1,{limit:b})};e.getPreKeyById=function(a){var b=d("WAWebSignalStorage").getPreKeyTable();return b.get(a)};e.removePreKeyById=function(a){var b=d("WAWebSignalStorage").getPreKeyTable();return b.remove(a)};e.bulkRemovePreKey=function(a){var b=d("WAWebSignalStorage").getPreKeyTable();return b.bulkRemove(a)};e.putPreKeys=function(a){var b=d("WAWebSignalStorage").getPreKeyTable();return b.bulkCreateOrReplace(a)};e.markPreKeyAsDirectDistribution=function(a){var b=d("WAWebSignalStorage").getPreKeyTable();return b.merge(a,{isDirectDistribution:1})};e.getSignedPreKey=function(){var a=this;return this.getMeta(d("WAWebSignalConst").META_KEYS.LAST_SPK_ID).then(function(b){return a.getSignedPreKeyById(b)})};e.getSignedPreKeyById=function(a){var c=this;if(this.idToSignedPreKey.has(a))return(h||(h=b("Promise"))).resolve(this.idToSignedPreKey.get(a));var e=d("WAWebSignalStorage").getSignedPreKeyTable();return e.get(a).then(function(b){c.idToSignedPreKey.set(a,b);return b})};e.putSignedPreKeys=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=d("WAWebSignalStorage").getSignedPreKeyTable();a=a.map(function(a){var b=a.keyId,d=a.keyPair,f=a.signature;return e.get(b).then(function(a){if(a)throw c("err")("signed preKey id "+b+" already exists");else{a={keyId:b,keyPair:d,signature:f};return e.create(a)}})});yield (h||(h=b("Promise"))).all(a)});function e(b){return a.apply(this,arguments)}return e}();e.putSession=function(a,b){var c=d("WAWebSignalStorage").getSessionTable();return c.createOrReplace({address:a,session:b})};e.bulkPutSession=function(a){var b=d("WAWebSignalStorage").getSessionTable();return b.bulkCreateOrReplace(a)};e.removeSession=function(a){var b=d("WAWebSignalStorage").getSessionTable();return b.remove(a)};e.bulkRemoveSession=function(a){var b=d("WAWebSignalStorage").getSessionTable();return b.bulkRemove(a)};e.getSession=function(a){var b=d("WAWebSignalStorage").getSessionTable();return b.get(a).then(function(a){return a?a.session:null})};e.bulkGetSession=function(a){var b=d("WAWebSignalStorage").getSessionTable();return b.bulkGet(a).then(function(a){return a.map(function(a){return a?a.session:null})})};e.putIdentity=function(a,b){var c=d("WAWebSignalStorage").getIdentityTable();return c.createOrReplace({identifier:a,identityKey:b})};e.bulkPutIdentity=function(a){var b=d("WAWebSignalStorage").getIdentityTable();return b.bulkCreateOrReplace(a)};e.bulkGetIdentity=function(a){var b=d("WAWebSignalStorage").getIdentityTable();return b.bulkGet(a).then(function(a){return a.map(function(a){return a?a.identityKey:null})})};e.getIdentity=function(a){var b=d("WAWebSignalStorage").getIdentityTable();return b.get(a).then(function(a){return a?a.identityKey:null})};e.removeIdentity=function(a){var b=d("WAWebSignalStorage").getIdentityTable();return b.remove(a)};e.bulkRemoveIdentity=function(a){var b=d("WAWebSignalStorage").getIdentityTable();return b.bulkRemove(a)};e.getIdentityKeyWithRowId=function(a){var b=d("WAWebSignalStorage").getIdentityTable();return b.get(a).then(function(a){return a?{identityKey:a.identityKey,rowId:a.rowId,sentAddonRowId:a.sentAddonRowId}:null})};e.bulkGetIdentityKeyWithRowId=function(a){var b=d("WAWebSignalStorage").getIdentityTable();return b.bulkGet(a).then(function(a){return a.map(function(a){return a?{identityKey:a.identityKey,rowId:a.rowId}:null})})};e.bulkPutIdentityKeyWithRowId=function(a){var b=d("WAWebSignalStorage").getIdentityTable();return b.bulkCreateOrReplace(a)};e.saveBaseKey=function(a,b,c){var e=d("WAWebSignalStorage").getBaseKeyTable();return e.createOrReplace({address:a,originalMsgId:b,baseKey:c})};e.loadBaseKey=function(a,b){var c=d("WAWebSignalStorage").getBaseKeyTable();return c.equals(["address","originalMsgId"],[a,b]).then(function(a){return a&&a.length!==0?a[0].baseKey:null})};e.deleteBaseKey=function(a,b){var c=d("WAWebSignalStorage").getBaseKeyTable();return c.equals(["address","originalMsgId"],[a,b]).then(function(a){if(a&&a.length!==0)return c.remove(a[0].id)})};e.putSenderKey=function(a,b,c){var e=d("WAWebSignalStorage").getSenderKeyTable();return e.createOrReplace({senderKeyName:a,senderId:b,senderKey:c})};e.bulkPutSenderKey=function(a){var b=d("WAWebSignalStorage").getSenderKeyTable();return b.bulkCreateOrReplace(a)};e.removeSenderKey=function(a){var b=d("WAWebSignalStorage").getSenderKeyTable();return b.remove(a)};e.getSenderKey=function(a){var b=d("WAWebSignalStorage").getSenderKeyTable();return b.get(a).then(function(a){return a?a.senderKey:null})};e.removeSenderKeyBySenderId=function(a){var b=d("WAWebSignalStorage").getSenderKeyTable();return b.equals(["senderId"],a).then(function(a){return b.bulkRemove(a.map(function(a){return a.senderKeyName}))})};e.clearCredential=function(){var a;a=[(a=d("WAWebSignalStorage")).getIdentityTable(),a.getMetaTable(),a.getPreKeyTable(),a.getSessionTable(),a.getSignedPreKeyTable()];return(h||(h=b("Promise"))).all(a.map(function(a){return a.clear()})).then(function(){})};e.getRegistrationInfo=function(){var a=this;return this.registrationInfo!=null?(h||(h=b("Promise"))).resolve(this.registrationInfo):(h||(h=b("Promise"))).all([this.getMeta(d("WAWebSignalConst").META_KEYS.REG_ID),this.getMeta(d("WAWebSignalConst").META_KEYS.STATIC_PUBKEY),this.getMeta(d("WAWebSignalConst").META_KEYS.STATIC_PRIVKEY)]).then(function(c){var e=c[0],f=c[1];c=c[2];if(!e||!f||!c)return;return(h||(h=b("Promise"))).all([d("WAWebSignalCommonUtils").decryptRegistrationMaterial(f),d("WAWebSignalCommonUtils").decryptRegistrationMaterial(c)]).then(function(b){var c=b[0];b=b[1];a.registrationInfo={registrationId:e,identityKeyPair:{pubKey:c,privKey:b}};return a.registrationInfo})})};e.setRegistrationInfo=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=this;yield (h||(h=b("Promise"))).all([d("WAWebSignalCommonUtils").encryptRegistrationMaterial(a.identityKeyPair.pubKey),d("WAWebSignalCommonUtils").encryptRegistrationMaterial(a.identityKeyPair.privKey)]).then(function(e){var f=e[0];e=e[1];return(h||(h=b("Promise"))).all([c.putMeta([{key:d("WAWebSignalConst").META_KEYS.REG_ID,value:a.registrationId},{key:d("WAWebSignalConst").META_KEYS.STATIC_PUBKEY,value:f},{key:d("WAWebSignalConst").META_KEYS.STATIC_PRIVKEY,value:e}])])})});function c(b){return a.apply(this,arguments)}return c}();e.getOrGenPreKeys=function(a,c){var e=this;return d("WAWebSignalStorageUtils").getStorage().lock(["signal-meta-store","prekey-store"],function(){return(h||(h=b("Promise"))).all([e.getMeta(d("WAWebSignalConst").META_KEYS.FIRST_UNUPLOAD_PK_ID),e.getMeta(d("WAWebSignalConst").META_KEYS.NEXT_PK_ID)]).then(function(f){var g=f[0];f=f[1];var l=g?g:j;g=f?f:j;f=g-l;var m=a-f;if(m<=0){d("WALogger").LOG(i(),f,a);return e.getPreKeysByRange(l,a)}f=k(g,g+m).map(function(a){return c(a)});return(h||(h=b("Promise"))).all(f).then(function(a){return e.savePreKeys(a)}).then(function(){return e.getPreKeysByRange(l,a)})})})};e.getOrGenSinglePreKey=function(a){return this.getOrGenPreKeys(1,a).then(function(a){if(a.length!==1)throw c("err")("Expected to get exactly one key but got "+a.length);return a[0]})};e.savePreKeys=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.length===0)return;var c=a[a.length-1];yield (h||(h=b("Promise"))).all([this.putMeta([{key:d("WAWebSignalConst").META_KEYS.NEXT_PK_ID,value:c.keyId+1}]),this.putPreKeys(a)])});function c(b){return a.apply(this,arguments)}return c}();e.markKeyAsUploaded=function(a){var e=this;return(h||(h=b("Promise"))).all([this.getMeta(d("WAWebSignalConst").META_KEYS.FIRST_UNUPLOAD_PK_ID),this.getMeta(d("WAWebSignalConst").META_KEYS.NEXT_PK_ID)]).then(function(b){var f=b[0];b=b[1];if(a<0||!b||a>=b)throw c("err")("markKeyAsUploaded: key "+a+" is out of boundary.");b=f?Math.max(f,a+1):a+1;return e.putMeta([{key:d("WAWebSignalConst").META_KEYS.FIRST_UNUPLOAD_PK_ID,value:b}])})};e.rotateSignedPreKey=function(a,b){var c=this;return d("WAWebSignalStorageUtils").getStorage().lock(["signal-meta-store","signed-prekey-store"],function(){return c.getMeta(d("WAWebSignalConst").META_KEYS.LAST_SPK_ID).then(function(e){var f=e==null?j:e+1;return b(a,f).then(function(a){c.putSignedPreKeys([a]);c.putMeta([{key:d("WAWebSignalConst").META_KEYS.LAST_SPK_ID,value:f}]);return a})})})};return a}();function k(a,b){var c=[];for(a=a;a<b;a++)c.push(a);return c}e=new a();g.waSignalStore=e}),98);
__d("WAWebDigestKeyJob",["Promise","WABase64","WADeprecatedSendIq","WADeprecatedWapParser","WALogger","WAWap","WAWebSignalStoreApi","WAWebUploadPreKeysJob","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["validateLocalKeyBundle: success"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["digestKey: validate key bundle failed, upload prekeys again"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["digestKey: server error ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["digestKey: service unavailable"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["digestKey: malformed request"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["digestKey: no record found for current user"]);n=function(){return a};return a}var o=32,p=new(c("WADeprecatedWapParser"))("digestResponseParser",function(a){a=a.child("digest");var b=a.child("skey");return{regId:a.child("registration").contentUint(4),type:a.child("type").contentUint(1),identity:a.child("identity").contentBytes(32),skey:{id:b.child("id").contentUint(3),pubkey:b.child("value").contentBytes(32),signature:b.child("signature").contentBytes(64)},keys:a.child("list").mapChildren(function(a){return a.contentUint(3)}),hash:a.child("hash").contentBytes(20)}});function a(){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a;a=(a=d("WAWap")).wap("iq",{xmlns:"encrypt",type:"get",to:a.S_WHATSAPP_NET,id:a.generateId()},a.wap("digest",null));a=(yield d("WADeprecatedSendIq").deprecatedSendIq(a,p));var b;if(a.success)try{yield r(a.result),b=!1}catch(a){b=!1}else{a=a.errorCode;a===404?(d("WALogger").WARN(n()),b=!0):a===406?(d("WALogger").WARN(m()),b=!1):a===503?(d("WALogger").WARN(l()),b=!1):(d("WALogger").WARN(k(),a),b=!1)}if(b!=null&&b){d("WALogger").LOG(j());return d("WAWebUploadPreKeysJob").uploadPreKeys()}});return q.apply(this,arguments)}function r(a){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=(yield (h||(h=b("Promise"))).all([d("WAWebSignalStoreApi").waSignalStore.getRegistrationInfo(),d("WAWebSignalStoreApi").waSignalStore.getSignedPreKey()])),f=e[0];e=e[1];if(!f||!e)throw c("err")("validateLocalKeyBundle: No registration info is available");if(a.regId!==f.registrationId)throw c("err")("validateLocalKeyBundle: registation id mismatch");f=f.identityKeyPair.pubKey;var g=e.keyPair.pubKey,j=f.byteLength+g.byteLength+e.signature.byteLength+a.keys.length*o,k=new Uint8Array(j),l=0;[f,g,e.signature].forEach(function(a){k.set(new Uint8Array(a),l),l+=a.byteLength});j=a.keys.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield d("WAWebSignalStoreApi").waSignalStore.getPreKeyById(a));if(!b)throw c("err")("validateLocalKeyBundle: missing prekey record for id "+a);return b.keyPair.pubKey});return function(b){return a.apply(this,arguments)}}());f=(yield h.all(j));f.forEach(function(a){k.set(new Uint8Array(a),l),l+=a.byteLength});g=(yield self.crypto.subtle.digest("SHA-1",k));e=d("WABase64").encodeB64(g);j=d("WABase64").encodeB64(a.hash);if(e!==j)throw c("err")("validateLocalKeyBundle: hash mismatch remote:"+j+" local:"+e);d("WALogger").LOG(i())});return s.apply(this,arguments)}g.digestKey=a}),98);
__d("WAWebGetIdentityKeysJob",["WADeprecatedSendIq","WADeprecatedWapParser","WALogger","WAWap","WAWebCommsWapMd","WAWebCryptoCurve25519","WAWebJidToWid","WAWebSignalCommonUtils","WAWebSignalProtocolStore","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["getAndStoreIdentityKeys: query "," missing keys for "," contacts"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["getAndStoreIdentityKeys: got 0 missing keys"]);i=function(){return a};return a}var j=new(c("WADeprecatedWapParser"))("identityKeysParser",function(a){return a.child("list").mapChildren(function(a){if(a.hasChild("error")){var b=a.child("error"),e=b.attrInt("code");b=b.attrString("text");throw c("err")("identityKeysParser bad response: "+e+" "+b)}else return{type:a.child("type").contentBytes(1),identity:a.child("identity").contentBytes(32),user:d("WAWebJidToWid").deviceJidToDeviceWid(a.attrDeviceJid("jid"))}})});function a(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield d("WAWebSignalProtocolStore").getPersistSignalProtocolStore().bulkLoadIdentityKey(a.map(function(a){return String(d("WAWebSignalCommonUtils").createSignalAddress(a))}))),c=a.filter(function(a,c){return b[c]==null});if(c.length===0){d("WALogger").LOG(i());return}d("WALogger").LOG(h(),c.length,a.length);a=(yield l(c));c=a.map(function(a){var b=a.identity;b=d("WAWebCryptoCurve25519").toSignalCurvePubKey(b.buffer.slice(b.byteOffset,b.byteLength+b.byteOffset));b=d("WAWebSignalCommonUtils").bufferToStr(b);a=d("WAWebSignalCommonUtils").createSignalAddress(a.user);return{identityKey:b,identifier:a.toString()}});return d("WAWebSignalProtocolStore").getPersistSignalProtocolStore().bulkCreateIdentity(c)});return k.apply(this,arguments)}function l(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b;a=a.map(function(a){return d("WAWap").wap("user",{jid:d("WAWebCommsWapMd").DEVICE_JID(a)})});b=(b=d("WAWap")).wap("iq",{xmlns:"encrypt",type:"get",to:b.S_WHATSAPP_NET,id:b.generateId()},b.wap("identity",null,a));a=(yield d("WADeprecatedSendIq").deprecatedSendIq(b,j));if(!a.success)throw c("err")("getIdentityKeys bad response "+String(a));return a.result});return m.apply(this,arguments)}g.getAndStoreIdentityKeys=a;g.getIdentityKeys=l}),98);
__d("WAWebRotateKeyJob",["WADeprecatedSendIq","WADeprecatedWapParser","WALogger","WAWap","WAWebCryptoCurve25519","WAWebDefinePersistedJob","WAWebDigestKeyJob","WAWebSignalKeyApi","WAWebSignalStoreApi","WAWebSignalUtilsApi","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["rotateKey unrecognized error ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["rotateKey server error ",", wait a day"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["skey does not pass server validation"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["rotateKey generated bad key"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["rotateKey: signedPreKey uploading"]);l=function(){return a};return a}var m=new(c("WADeprecatedWapParser"))("rotateKeyResponseParser",function(a){a.assertFromServer()});a=d("WAWebDefinePersistedJob").defineWebPersistedJob().step("uploadKeys",b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a,b=(yield d("WAWebSignalStoreApi").waSignalStore.getRegistrationInfo().then(function(a){if(!a)throw c("err")("No registration info is available");return d("WAWebSignalStoreApi").waSignalStore.rotateSignedPreKey(d("WAWebCryptoCurve25519").toSignalCurveKeyPair(a.identityKeyPair),d("WAWebSignalKeyApi").generateSignedKeyPair)}));d("WALogger").LOG(l());a=(a=d("WAWap")).wap("iq",{xmlns:"encrypt",type:"set",to:a.S_WHATSAPP_NET,id:a.generateId()},a.wap("rotate",null,d("WAWebSignalUtilsApi").xmppSignedPreKey(b)));b=(yield d("WADeprecatedSendIq").deprecatedSendIq(a,m));if(b.success)return{shouldDigestKey:!1};a=!1;b=b.errorCode;b===406?d("WALogger").WARN(k()):b===409?(d("WALogger").WARN(j()),a=!0):b>=500?d("WALogger").LOG(i(),b):(d("WALogger").LOG(h(),b),a=!0);return{shouldDigestKey:a}})).finalStep("maybeDigestKey",function(a){a=a.shouldDigestKey;if(a)return d("WAWebDigestKeyJob").digestKey()}).end();g.rotateKey=a}),98);
__d("WAWebUploadPreKeysJob",["Promise","WAComms","WADeprecatedSendIq","WADeprecatedWapParser","WALogger","WAPromiseRetryLoop","WAWap","WAWebConstantsDeprecated","WAWebServerPropsModel","WAWebSignalKeyApi","WAWebSignalStoreApi","WAWebSignalUtilsApi","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["_uploadPreKeys: disconnected, unclear if on server: "," (count: ",", size: ","b)"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["_uploadPreKeys: unrecognized error "," (count: ",", size: ","b)"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["_uploadPreKeys: uploaded invalid keys (count: ",", size: ","b)"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["_uploadPreKeys: server requested backoff "," (count: ",", size: ","b)"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["_uploadPreKeys: "," keys uploaded, raw stanza size: ","b"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["uploadPreKeys: retrying (after delay)"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["uploadPreKeys: done"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["uploadPreKeys: running"]);p=function(){return a};return a}var q={error:!1,result:!0},r=new(c("WADeprecatedWapParser"))("uploadPreKeyResParser",function(a){a.assertTag("iq");a.assertFromServer();var b=a.attrEnum("type",q);if(b)return{success:!0};b=a.child("error");return{errorCode:b.attrInt("code"),errorText:b.hasAttr("text")?b.attrString("text"):""}});function s(){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=d("WAWebServerPropsModel").ServerProps.maxKeys,e=(yield (h||(h=b("Promise"))).all([d("WAWebSignalStoreApi").waSignalStore.getRegistrationInfo(),d("WAWebSignalStoreApi").waSignalStore.getSignedPreKey()])),f=e[0],g=e[1];if(!f||!g)throw c("err")("No signal info is available");var n=f.registrationId,o=f.identityKeyPair;e=(yield d("WAWebSignalStoreApi").waSignalStore.getOrGenPreKeys(a,d("WAWebSignalKeyApi").generatePreKeyPair).then(function(a){if(a.length===0)throw c("err")("No preKey is available");return[d("WAWap").wap("iq",{id:d("WAWap").generateId(),xmlns:"encrypt",type:"set",to:d("WAWap").S_WHATSAPP_NET},d("WAWap").wap("registration",null,d("WAWap").BIG_ENDIAN_CONTENT(n)),d("WAWap").wap("type",null,c("WAWebConstantsDeprecated").KEY_BUNDLE_TYPE),d("WAWap").wap("identity",null,o.pubKey),d("WAWap").wap("list",null,a.map(d("WAWebSignalUtilsApi").xmppPreKey)),d("WAWebSignalUtilsApi").xmppSignedPreKey(g)),a[a.length-1].keyId]}));var p=e[0],q=e[1];try{f=(yield d("WAComms").waitForConnection().then(function(){return d("WAWebSignalStoreApi").waSignalStore.markKeyAsUploaded(q)}).then(function(){return d("WADeprecatedSendIq").deprecatedSendIqWithoutRetry(p,r)}));if(f.success){d("WAWebSignalStoreApi").waSignalStore.setServerHasPreKeys(!0);d("WALogger").LOG(m(),a,p.toString().length);return{success:!0}}e=f.errorCode;e>=500?d("WALogger").WARN(l(),e,a,p.toString().length):e===406?d("WALogger").WARN(k(),a,p.toString().length):d("WALogger").WARN(j(),e,a,p.toString().length);return{errorCode:f.errorCode,errorText:f.errorText}}catch(b){d("WALogger").WARN(i(),b,a,p.toString().length);return}});return t.apply(this,arguments)}var u={algo:{type:"fibonacci",first:1e3,second:2e3},max:61e4};function a(){var a=new(d("WAPromiseRetryLoop").PromiseRetryLoop)({name:"uploadPreKeys",timer:u,code:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WALogger").LOG(p());var b=(yield s());(b==null?void 0:b.success)===!0?(d("WALogger").LOG(o()),a()):d("WALogger").LOG(n())});function c(b){return a.apply(this,arguments)}return c}()});a.start();return a.promise()}g.uploadPreKeyResParser=r;g.uploadPreKeys=a}),98);
__d("WAWebSendAggregateDeliveryReceipts",["$InternalEnum","Promise","WAWebBackendApi","WAWebCmd","WAWebDBMsgUtils","WAWebHandleMsgMetaUtils","WAWebMsgProcessingApiUtils","WAWebPollsVotesSchema","WAWebSchemaReactions","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h,i=b("$InternalEnum").Mirrored(["Message","Reaction","PollVote","NotSupportedAddon"]),j=function(a){if(a.hasHideFailEnc){if(d("WAWebHandleMsgMetaUtils").isPollVoteMsgMeta(a.msgMeta))return i.PollVote;return d("WAWebHandleMsgMetaUtils").isReactionMsgMeta(a.msgMeta)?i.Reaction:i.NotSupportedAddon}return i.Message};function k(a){var b=new Map();a.forEach(function(a){var c,d=j(a);c=(c=b.get(d))!=null?c:b.set(d,[]).get(d);c==null?void 0:c.push(a)});return b}function l(a,b,c){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){a=a.map(function(a){a=a.msgInfo;return d("WAWebMsgProcessingApiUtils").messageInfoToKey(a)});b=d("WAWebCmd").Cmd.isMainStreamReadyMd?yield b(a):a.map(function(){return!1});var e=new Set(),f=[];for(b of b.entries()){var g=b[0],h=b[1];h?e.add(a[g].toString()):f.push(a[g].toString())}if(f.length===0)return e;h=(yield c(f));return new Set([].concat(Array.from(e),Array.from(h)))});return m.apply(this,arguments)}function n(a,b){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){switch(a){case i.Message:return l(c,function(a){return d("WAWebBackendApi").frontendSendAndReceive("hasMsgsInCollection",{msgKeys:a})},function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=new Set();return d("WAWebDBMsgUtils").getMsgsExistByMsgKey(a).then(function(c){for(c of c.entries()){var d=c[0],e=c[1];e&&b.add(a[d])}return b})});return function(b){return a.apply(this,arguments)}}());case i.Reaction:return l(c,function(a){return d("WAWebBackendApi").frontendSendAndReceive("hasReactionsInCollection",{msgKeys:a})},function(a){var b=new Set();return d("WAWebSchemaReactions").getReactionsTable().anyOf(["msgKey"],a).then(function(a){for(a of a)b.add(a.msgKey);return b})});case i.PollVote:return l(c,function(a){return d("WAWebBackendApi").frontendSendAndReceive("hasPollVotesInCollection",{msgKeys:a})},function(a){return d("WAWebPollsVotesSchema").getTable().anyOf(["msgKey"],a,{shouldDecrypt:!1}).then(function(a){var b=new Set();for(a of a)b.add(a.msgKey);return b})});case i.NotSupportedAddon:a=new Set();for(c of c){var e=c.msgInfo;a.add(d("WAWebMsgProcessingApiUtils").messageInfoToKey(e).toString())}return a}});return o.apply(this,arguments)}function p(a){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a[0];a=a[1];var c=(yield n(b,a));return a.map(function(a){return{isInDB:c.has(d("WAWebMsgProcessingApiUtils").messageInfoToKey(a.msgInfo).toString()),receipt:a}})});return q.apply(this,arguments)}function a(a){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c;a=k(a);a=(yield (h||(h=b("Promise"))).all(Array.from(a.entries()).map(p)));return(c=[]).concat.apply(c,a)});return r.apply(this,arguments)}g.aggregateDeliveryReceipts=a}),98);
__d("WAWebUnknownStanzaWamEvent",["WAWebWamCodegenUtils"],(function(a,b,c,d,e,f,g){a=d("WAWebWamCodegenUtils").defineEvents({UnknownStanza:[3448,{unknownStanzaTag:[1,d("WAWebWamCodegenUtils").TYPES.STRING],unknownStanzaType:[2,d("WAWebWamCodegenUtils").TYPES.STRING]},[1,1,1],"regular"]});g.UnknownStanzaWamEvent=a}),98);
__d("WAWebPostUnknownStanzaMetric",["WAWebUnknownStanzaWamEvent"],(function(a,b,c,d,e,f,g){function a(a){new(d("WAWebUnknownStanzaWamEvent").UnknownStanzaWamEvent)({unknownStanzaTag:a.tag,unknownStanzaType:(a=a.attrs.type)==null?void 0:a.toString()}).commit()}g.postUnknownStanzaMetric=a}),98);
__d("WAWebCreateNackFromStanza",["$InternalEnum","WALogger","WAWap","WAWebPostUnknownStanzaMetric"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendNack called with unsupported stanza tag: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["createNackFromStanza: failed with unhandled reason: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["createNackFromStanza: failed for class: '","' type: '","' id: '","' reason: '","'"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["createNackFromStanza: failed: 'id' or 'form' is null for class: '","' type: '","' reason: '","'"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["createNackFromStanza: class: '","' type: '","' id: '","' reason: '","'"]);l=function(){return a};return a}var m=b("$InternalEnum")({ParsingError:487,UnrecognizedStanza:488,UnrecognizedStanzaClass:489,UnrecognizedStanzaType:490,InvalidProtobuf:491,InvalidHostedCompanionStanza:493,MissingMessageSecret:495,SignalErrorOldCounter:496,MessageDeletedOnPeer:499,UnhandledError:500,UnsupportedAdminRevoke:550,UnsupportedLIDGroup:551,DBOperationFailed:552});function a(a,b){var c,e,f=a==null?void 0:a.tag;c=a==null?void 0:(c=a.attrs)==null?void 0:c.id;e=a==null?void 0:(e=a.attrs)==null?void 0:(e=e.type)==null?void 0:e.toString();var g=m.getName(b);try{var h;d("WALogger").LOG(l(),f,e,c,g);if(c!=null&&(a==null?void 0:(h=a.attrs)==null?void 0:h.from)!=null)return n(a,b);d("WALogger").ERROR(k(),f,e,g);d("WAWebPostUnknownStanzaMetric").postUnknownStanzaMetric(a)}catch(a){d("WALogger").ERROR(j(),f,e,c,g);d("WALogger").ERROR(i(),(h=a.message)!=null?h:a).sendLogs("send-nack-exception")}return"NO_ACK"}function n(a,b){var c=a.attrs;if(b===m.UnrecognizedStanza)return d("WAWap").wap("ack",{"class":a.tag,id:c.id,to:c.from,type:c.type||d("WAWap").DROP_ATTR,participant:c.participant||d("WAWap").DROP_ATTR,error:d("WAWap").INT(b)});switch(a.tag){case"notification":return d("WAWap").wap("ack",{"class":"notification",id:c.id,to:c.from,type:c.type||d("WAWap").DROP_ATTR,participant:c.participant||d("WAWap").DROP_ATTR,error:d("WAWap").INT(b)});case"message":return d("WAWap").wap("ack",{"class":"message",id:c.id,to:c.from,type:c.type||d("WAWap").DROP_ATTR,participant:c.participant||d("WAWap").DROP_ATTR,error:d("WAWap").INT(b)});case"receipt":return d("WAWap").wap("ack",{"class":"receipt",id:c.id,to:c.from,type:c.type||d("WAWap").DROP_ATTR,participant:c.participant||d("WAWap").DROP_ATTR,error:d("WAWap").INT(b)});default:d("WALogger").WARN(h(),a.tag).sendLogs("unsupported-nack");d("WAWebPostUnknownStanzaMetric").postUnknownStanzaMetric(a);return"NO_ACK"}}g.NackReason=m;g.createNackFromStanza=a}),98);
__d("WAWebHandleMsgSendAck",["WADeprecatedSendIq","WAWap","WAWebCommsWapMd","WAWebUserPrefsMeUser"],(function(a,b,c,d,e,f,g){function a(a,b,c,e){d("WADeprecatedSendIq").deprecatedCastStanza(d("WAWap").wap("ack",{id:d("WAWap").CUSTOM_STRING(a),"class":"message",from:d("WAWebCommsWapMd").DEVICE_JID(d("WAWebUserPrefsMeUser").assertGetMe()),to:b?d("WAWebCommsWapMd").JID(b):d("WAWap").DROP_ATTR,participant:e?d("WAWebCommsWapMd").DEVICE_JID(e):d("WAWap").DROP_ATTR,type:(a=c)!=null?a:d("WAWap").DROP_ATTR}))}function b(a,b,c,e,f){d("WADeprecatedSendIq").deprecatedCastStanza(d("WAWap").wap("ack",{id:d("WAWap").CUSTOM_STRING(a),"class":"message",from:d("WAWebCommsWapMd").DEVICE_JID(d("WAWebUserPrefsMeUser").assertGetMe()),to:b?d("WAWebCommsWapMd").JID(b):d("WAWap").DROP_ATTR,participant:e?d("WAWebCommsWapMd").DEVICE_JID(e):d("WAWap").DROP_ATTR,type:(a=c)!=null?a:d("WAWap").DROP_ATTR,error:d("WAWap").INT(f)}))}g.sendAck=a;g.sendNack=b}),98);
__d("WAWebOffdStorageUtils",["invariant","Promise","WAWebIdb","WAWebStorage","err"],(function(a,b,c,d,e,f,g,h){var i,j="offd-storage",k=null;function a(){var a=new(c("WAWebIdb"))(j);k=new(d("WAWebStorage").Storage)(a)}function e(){k!=null||h(0,56317);return k}function f(){return k==null?(i||(i=b("Promise"))).reject(c("err")("[offd-storage] Storage should be created first before being destroyed")):k.purge().then(function(){k=null})["catch"](function(a){k=null;throw a})}g.DATABASE_NAME=j;g.createStorage=a;g.getStorage=e;g.destroyStorage=f}),98);
__d("WAWebSchemaDanglingReceipt",["WAWebOffdStorageUtils","WAWebStorageMutationBuilder"],(function(a,b,c,d,e,f,g){c=d("WAWebStorageMutationBuilder").columnBuilder();var h=c.addColumn,i=c.addAutoIncrementingPrimaryKey;function a(){d("WAWebOffdStorageUtils").getStorage().add("dangling-receipt").version(d("WAWebOffdStorageUtils").getStorage().versions.version(1),[i("id"),h("receipts"),h("acks")]).view(function(a){return a})}function b(){return d("WAWebOffdStorageUtils").getStorage().table("dangling-receipt")}g.addTable=a;g.getTable=b}),98);
__d("WAWebCommsAckParser",["WAWebJidUtils","WAWebWidToJid"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WAWebJidUtils").extractJidFromJidWithType(d("WAWebWidToJid").widToJidWithType(a.from)),c=a.participant==null?void 0:d("WAWebWidToJid").widToDeviceJid(a.participant),e=a.recipient==null?void 0:d("WAWebWidToJid").widToUserJid(a.recipient);return babelHelpers["extends"]({},a,{from:b,participant:c,recipient:e})}g.toCoreAckTemplate=a}),98);
__d("WAWebSendReceiptJobCommon",["Promise","WADeprecatedSendIq","WADeprecatedWapParser","WALogger","WAWap","WAWebABProps","WAWebCommsAckParser","WAWebCommsWapMd","WAWebPrivacySettings","WAWebSchemaChat","WAWebUserPrefsGeneral","asyncToGeneratorRuntime","lodash"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[messaging] sendAggregateReceipts: Invalid ack from server"]);i=function(){return a};return a}var j=new Set(),k=Object.freeze({INACTIVE:"inactive",SENDER:"sender",DELIVERY:"delivery",READ:"read",READ_SELF:"read-self",PLAYED:"played",PLAYED_SELF:"played-self",HISTORY_SYNC_COMPLETION:"hist_sync",SERVER_ERROR:"server-error",PEER_MSG:"peer_msg"}),l=256,m=new(c("WADeprecatedWapParser"))("readReceiptAckParser",function(a){a.assertTag("ack");return{readReceipts:a.hasAttr("readreceipts")?a.attrEnum("readreceipts",d("WAWebPrivacySettings").ALL_NONE):null}});function n(a,b){b=c("lodash").flatten(Array.from(b.values()));var e=b[0];b=b.slice(1);b=b.length>0?d("WAWap").wap("list",null,b.map(function(a){return d("WAWap").wap("item",{id:d("WAWap").CUSTOM_STRING(a)})})):null;e=d("WAWap").wap("ack",{id:d("WAWap").CUSTOM_STRING(e),to:d("WAWebCommsWapMd").JID(a),"class":d("WAWap").CUSTOM_STRING("message"),type:d("WAWap").CUSTOM_STRING("text")},b);return d("WADeprecatedSendIq").deprecatedCastStanza(e)}function o(a,b,c,e){var f=a[0];a=a.slice(1);a=a.length>0?d("WAWap").wap("list",null,a.map(function(a){return d("WAWap").wap("item",{id:d("WAWap").CUSTOM_STRING(a)})})):null;f=d("WAWap").wap("ack",{id:d("WAWap").CUSTOM_STRING(f),to:d("WAWebCommsWapMd").JID(b),recipient:c!=null?d("WAWebCommsWapMd").USER_JID(c):d("WAWap").DROP_ATTR,participant:e!=null?d("WAWebCommsWapMd").USER_JID(e):d("WAWap").DROP_ATTR,"class":d("WAWap").CUSTOM_STRING("message"),type:d("WAWap").CUSTOM_STRING("text")},a);return d("WADeprecatedSendIq").deprecatedCastStanza(f)}function a(a){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=a.to,e=a.type,f=a.groupedReceipt,g=a.t,j=a.recipient;if(c.isNewsletter()&&e===k.DELIVERY)return n(c,f);var p=e===k.READ||e===k.PLAYED||e===k.READ_SELF||e===k.PLAYED_SELF||e===k.HISTORY_SYNC_COMPLETION,r=(yield q(c,e,k.DELIVERY));yield (h||(h=b("Promise"))).all(Array.from(f.keys()).map(function(a){var n=f.get(a);if(!n||n.length===0)return;var q=!c.isBot()&&a.isBot();if(e===k.DELIVERY&&q){var s,t;c.isUser()?(q=a,s=c):(q=c,t=a);o(n,q,s,t);return}var u=c.isUser()||c.isNewsletter()?null:a,v=c,w=j;w==null&&c.isUser()&&!c.isBot()&&a.isBot()&&(v=a,w=c);var x=[];q=function(){var a=n.splice(0,l),c=null;a.length>1&&(c=d("WAWap").wap("list",null,a.slice(1).map(function(a){return d("WAWap").wap("item",{id:d("WAWap").CUSTOM_STRING(a)})})));var f=d("WAWap").wap("receipt",{to:d("WAWebCommsWapMd").JID(v),type:e===k.DELIVERY?d("WAWap").DROP_ATTR:d("WAWap").CUSTOM_STRING(e),id:d("WAWap").CUSTOM_STRING(a[0]),t:g!=null?d("WAWap").CUSTOM_STRING(g):d("WAWap").DROP_ATTR,participant:u?d("WAWebCommsWapMd").DEVICE_JID(u):d("WAWap").DROP_ATTR,recipient:w?d("WAWebCommsWapMd").USER_JID(w):d("WAWap").DROP_ATTR,privacy_token:r?d("WAWap").CUSTOM_STRING("false"):d("WAWap").DROP_ATTR},c);if(p){c=function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b={id:a[0],from:v,"class":"receipt",type:e,participant:u,recipient:w};if(e===k.READ||e===k.READ_SELF){var c=(yield d("WADeprecatedSendIq").deprecatedSendStanzaAndReturnAck(f,d("WAWebCommsAckParser").toCoreAckTemplate(b)));c=m.parse(c);if(c.error)d("WALogger").ERROR(i()).sendLogs("Invalid-Receipt-Ack");else{c=c.success.readReceipts;c!=null&&d("WAWebUserPrefsGeneral").setUserPrivacySettings(babelHelpers["extends"]({},d("WAWebUserPrefsGeneral").getUserPrivacySettings(),{readReceipts:c}))}}else return d("WADeprecatedSendIq").deprecatedSendStanzaAndWaitForAck(f,d("WAWebCommsAckParser").toCoreAckTemplate(b))});return function(){return c.apply(this,arguments)}}();x.push(c())}else x.push(d("WADeprecatedSendIq").deprecatedCastStanza(f))};while(n.length>0)q();return(h||(h=b("Promise"))).all(x)}))});return p.apply(this,arguments)}function q(a,b,c){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){var e;if(!d("WAWebABProps").getABPropConfigValue("include_privacy_token_flag_in_delivery_receipt"))return!1;e=(e=(yield d("WAWebSchemaChat").getChatTable().get(a.toString())))==null?void 0:e.tcToken;b=a.isUser()&&b===c&&e==null&&!j.has(a);b&&j.add(a);e!=null&&j.has(a)&&j["delete"](a);return b});return r.apply(this,arguments)}function e(){j.clear()}g.sentTokenRequests=j;g.RECEIPT_TYPE=k;g.sendBotInvokeResponseAcks=o;g.sendAggregateReceipts=a;g.shouldRequestTcToken=q;g.resetRequestedTcTokens=e}),98);
__d("WAWebSendOfflineDeliveryReceiptJob",["Promise","WAComms","WALogger","WATimeUtils","WAWebCreateNackFromStanza","WAWebHandleMsgSendAck","WAWebPostIncomingMessageDropMetric","WAWebSchemaDanglingReceipt","WAWebSendAggregateDeliveryReceipts","WAWebSendReceiptJobCommon","WAWebUserPrefsMeUser","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendAggregateOfflineReceipts: duplicate message does not exist in the db: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendAggregateOfflineReceipts: duplicate message exists in the db: ",""]);j=function(){return a};return a}function k(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=[];if(a.length===0)return b;a=(yield d("WAWebSendAggregateDeliveryReceipts").aggregateDeliveryReceipts(a));for(a of a){var c=a.receipt,e=a.isInDB,f=c.externalId,g=c.from,h=c.author,k=c.msgMeta,l=c.msgInfo;c=c.enc;if(e)d("WALogger").LOG(j(),f),void d("WAWebPostIncomingMessageDropMetric").postIncomingMessageDropDuplicateMessage({msgMeta:k,msgInfo:l,enc:c}),b.push({externalId:f,from:g,author:h});else{d("WALogger").LOG(i(),f);void d("WAWebPostIncomingMessageDropMetric").postIncomingMessageDropOldCounter({msgMeta:k,msgInfo:l,enc:c});e=g.isUser()||g.isNewsletter()?null:h;d("WAWebHandleMsgSendAck").sendNack(f,g,k.type,e,d("WAWebCreateNackFromStanza").NackReason.SignalErrorOldCounter)}}return b});return l.apply(this,arguments)}function a(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=[],e=[];for(a of a){var f=a.receiptInfo,g=a.duplicateMsgReceiptInfo;g!=null&&e.push(g);f!=null&&c.push(f)}c=c.concat(yield k(e));var i=new Map(),j=[];c.forEach(function(a){var b=a.from,c=a.author;a=a.externalId;var d=i.get(b);d||(d=new Map(),i.set(b,d));var e=d.get(c);e||(e=[],d.set(c,e));e.push(a);j.push({from:String(b),author:String(c),externalId:a})});var l=d("WAWebUserPrefsMeUser").getMeUser(),m=String(d("WATimeUtils").unixTime());void (h||(h=b("Promise"))).all(Array.from(i.keys()).map(function(a){var b=i.get(a);if(!b)return;var c=a.isUser()&&l.equals(d("WAWebWidFactory").toUserWid(a));return d("WAWebSendReceiptJobCommon").sendAggregateReceipts({to:a,type:c?d("WAWebSendReceiptJobCommon").RECEIPT_TYPE.SENDER:d("WAWebSendReceiptJobCommon").RECEIPT_TYPE.DELIVERY,t:m,groupedReceipt:b,recipient:c?l:null})}));d("WAComms").cancelDeadSocketTimer();j.length>0&&(yield d("WAWebSchemaDanglingReceipt").getTable().create({receipts:j,acks:[]}))});return m.apply(this,arguments)}g.handleDuplicateMsgReceipts=k;g.sendAggregateOfflineReceipts=a}),98);
__d("WAWebReportingTokenUtils",["WABase64","WABinary","WACryptoHkdf","WACryptoHmac","WACryptoUtils","WALogger","WAUseCaseSecret","WAWap","WAWebMessagePluginGenerateReportingTokenContent","WAWebMessagingGatingUtils","WAWebMsgGetters","WAWebWidToJid","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["senderWid cannot be null for validating reporting token info"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["senderWid cannot be null for generating reporting token body"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["messageSecret cannot be null for generating reporting token body ","-",""]);j=function(){return a};return a}var k=32,l="Report Token",m={DEFAULT:0,HISTORY_SYNC:-1};function a(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=new(d("WABinary").Binary)(a).readByteArray();a=(yield d("WACryptoHkdf").extractAndExpand(new Uint8Array(a),l,k));return a});return n.apply(this,arguments)}function c(a){var b;if(a.encFilehash==null&&a.caption==null)return null;b=new Uint8Array(d("WABase64").decodeB64((b=a.encFilehash)!=null?b:""));a=new TextEncoder().encode((a=a.caption)!=null?a:"");var c=new Uint8Array(b.length+a.length);c.set(b);c.set(a,b.length);return self.crypto.getRandomValues(new Uint8Array(c.length))}function e(a,b){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(!(d("WAWebMessagingGatingUtils").isReportingTokenSendingEnabled()&&d("WAWebMessagePluginGenerateReportingTokenContent").isMsgTypeReportingTokenCompatible(a.type,a.subtype)))return null;b=(b=b.messageContextInfo)==null?void 0:b.messageSecret;var c=d("WAWebMsgGetters").getSender(a);if(b==null){d("WALogger").ERROR(j(),a.type,a.subtype).tags("messaging","wa-ice","report-token").sendLogs("report-token-null-message-secret");return null}if(c==null){d("WALogger").ERROR(i()).tags("messaging","wa-ice","report-token").sendLogs("report-token-null-sender");return null}b=(yield d("WAUseCaseSecret").createUseCaseSecret({messageSecret:b,stanzaId:a.id.id,parentMsgOriginalSender:d("WAWebWidToJid").widToUserJid(c),modificationSender:d("WAWebWidToJid").widToUserJid(c),modificationType:d("WAUseCaseSecret").UseCaseSecretModificationType.REPORT_TOKEN}));c=d("WAWebMessagePluginGenerateReportingTokenContent").generateReportingTokenContent(a);b=(yield d("WACryptoHmac").hmacSha256(new Uint8Array(b),(a=c)!=null?a:new Uint8Array(0)));return d("WAWap").wap("reporting",null,d("WAWap").wap("reporting_token",null,new Uint8Array(b)))});return o.apply(this,arguments)}function f(a,b){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c;if(!d("WAWebMessagingGatingUtils").isReportingTokenReceivingEnabled())return!0;if(b==null||Object.keys(b).length===0)return!0;if(b.reportingTag==null)return!0;b=b.reportingToken;if(b==null)return!0;if(!d("WAWebMessagePluginGenerateReportingTokenContent").isMsgTypeReportingTokenCompatible(a.type,a.subtype))return!0;var e=d("WAWebMsgGetters").getSender(a);if(e==null){d("WALogger").ERROR(h()).tags("messaging","wa-ice","report-token").sendLogs("report-token-null-sender");return!1}c=(yield d("WAUseCaseSecret").createUseCaseSecret({messageSecret:(c=a.messageSecret)!=null?c:b.subarray(32,64),stanzaId:a.id.id,parentMsgOriginalSender:d("WAWebWidToJid").widToUserJid(e),modificationSender:d("WAWebWidToJid").widToUserJid(e),modificationType:d("WAUseCaseSecret").UseCaseSecretModificationType.REPORT_TOKEN}));e=d("WAWebMessagePluginGenerateReportingTokenContent").generateReportingTokenContent(a);c=new Uint8Array(yield d("WACryptoHmac").hmacSha256(new Uint8Array(c),(a=e)!=null?a:new Uint8Array(0)));a=d("WACryptoUtils").uint8ArraysEqual(c,(e=b.subarray(0,32))!=null?e:new Uint8Array(0));return a});return p.apply(this,arguments)}g.REPORTING_TOKEN_VERSION=m;g.genReportingTokenKeyFromMessageSecret=a;g.getMediaReportingTokenContent=c;g.genReportingTokenBody=e;g.validateReportingTokenInfo=f}),98);
__d("WAWebSyncDeviceAdvDeviceListJob",["WAJobOrchestratorTypes","WAWebAdvSyncDeviceListApi","WAWebOrchestratorNonPersistedJob"],(function(a,b,c,d,e,f,g){function a(a,b,c){a={wids:a,context:b,phash:c};return d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("syncDeviceList",function(a){return d("WAWebAdvSyncDeviceListApi").syncDeviceList(a)}).waitUntilCompleted(a)}function b(){return d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("syncMyDeviceList",function(a){return d("WAWebAdvSyncDeviceListApi").syncMyDeviceList()},{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.SKIP}).waitUntilCompleted()}g.syncDeviceListJob=a;g.syncMyDeviceListJob=b}),98);
__d("WAWebSignalCommonErrors",["WACustomError"],(function(a,b,c,d,e,f,g){a=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}return b}(d("WACustomError").customError("SignalDecryptionError"));b=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}return b}(d("WACustomError").customError("SignalMessageCounterError"));g.SignalDecryptionError=a;g.SignalMessageCounterError=b}),98);
__d("WAWebWamEnumE2eCiphertextType",[],(function(a,b,c,d,e,f){a=Object.freeze({MESSAGE:0,PREKEY_MESSAGE:1,SENDER_KEY_MESSAGE:2,MESSAGE_SECRET_MESSAGE:3});f.E2E_CIPHERTEXT_TYPE=a}),66);
__d("WAWebWamEnumE2eDestination",[],(function(a,b,c,d,e,f){a=Object.freeze({INDIVIDUAL:0,GROUP:1,LIST:2,STATUS:3,CHANNEL:4,INTEROP:5});f.E2E_DESTINATION=a}),66);
__d("WAWebBackendJobsCommon",["WAJobOrchestratorTypes","WALogger","WAWap","WAWebAck","WAWebBackendJobs.flow","WAWebHandleMsgCommon","WAWebHandleMsgError","WAWebSendMsgCommonApi","WAWebSignalCommonErrors","WAWebWamEnumE2eCiphertextType","WAWebWamEnumE2eDestination","WAWebWamEnumEditType","WAWebWamEnumMediaType","WAWebWamEnumPlaceholderReasonType","err","gkx"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["getPlaceholderAddReason Other reason"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["getPlaceholderAddReason SignalBadMac reason"]);i=function(){return a};return a}var j=2;function a(a){switch(a){case d("WAWebBackendJobs.flow").CiphertextType.Skmsg:return d("WAWebWamEnumE2eCiphertextType").E2E_CIPHERTEXT_TYPE.SENDER_KEY_MESSAGE;case d("WAWebBackendJobs.flow").CiphertextType.Pkmsg:return d("WAWebWamEnumE2eCiphertextType").E2E_CIPHERTEXT_TYPE.PREKEY_MESSAGE;case d("WAWebBackendJobs.flow").CiphertextType.Msg:return d("WAWebWamEnumE2eCiphertextType").E2E_CIPHERTEXT_TYPE.MESSAGE;case d("WAWebBackendJobs.flow").CiphertextType.Msmsg:return d("WAWebWamEnumE2eCiphertextType").E2E_CIPHERTEXT_TYPE.MESSAGE_SECRET_MESSAGE}}function b(a){var b=a.encMediaType,c=a.msgType;a=a.msgPollType;if(c===d("WAWebHandleMsgCommon").STANZA_MSG_TYPES.reaction)return d("WAWebWamEnumMediaType").MEDIA_TYPE.REACTION;else if(a===d("WAWebHandleMsgCommon").POLL_TYPES.creation)return d("WAWebWamEnumMediaType").MEDIA_TYPE.POLL_CREATE;else if(a===d("WAWebHandleMsgCommon").POLL_TYPES.vote)return d("WAWebWamEnumMediaType").MEDIA_TYPE.POLL_VOTE;else if(b)switch(b){case d("WAWebBackendJobs.flow").EncMediaType.Image:return d("WAWebWamEnumMediaType").MEDIA_TYPE.PHOTO;case d("WAWebBackendJobs.flow").EncMediaType.Video:return d("WAWebWamEnumMediaType").MEDIA_TYPE.VIDEO;case d("WAWebBackendJobs.flow").EncMediaType.Ptv:return d("WAWebWamEnumMediaType").MEDIA_TYPE.PUSH_TO_VIDEO;case d("WAWebBackendJobs.flow").EncMediaType.Audio:return d("WAWebWamEnumMediaType").MEDIA_TYPE.AUDIO;case d("WAWebBackendJobs.flow").EncMediaType.Ptt:return d("WAWebWamEnumMediaType").MEDIA_TYPE.PTT;case d("WAWebBackendJobs.flow").EncMediaType.Location:return d("WAWebWamEnumMediaType").MEDIA_TYPE.LOCATION;case d("WAWebBackendJobs.flow").EncMediaType.VCard:return d("WAWebWamEnumMediaType").MEDIA_TYPE.CONTACT;case d("WAWebBackendJobs.flow").EncMediaType.Document:return d("WAWebWamEnumMediaType").MEDIA_TYPE.DOCUMENT;case d("WAWebBackendJobs.flow").EncMediaType.Url:return d("WAWebWamEnumMediaType").MEDIA_TYPE.URL;case d("WAWebBackendJobs.flow").EncMediaType.Call:return d("WAWebWamEnumMediaType").MEDIA_TYPE.CALL;case d("WAWebBackendJobs.flow").EncMediaType.Gif:return d("WAWebWamEnumMediaType").MEDIA_TYPE.GIF;case d("WAWebBackendJobs.flow").EncMediaType.Future:return d("WAWebWamEnumMediaType").MEDIA_TYPE.FUTURE;case d("WAWebBackendJobs.flow").EncMediaType.ContactArray:return d("WAWebWamEnumMediaType").MEDIA_TYPE.CONTACT_ARRAY;case d("WAWebBackendJobs.flow").EncMediaType.LiveLocation:return d("WAWebWamEnumMediaType").MEDIA_TYPE.LIVE_LOCATION;case d("WAWebBackendJobs.flow").EncMediaType.ProfilePic:return d("WAWebWamEnumMediaType").MEDIA_TYPE.PROFILE_PIC;case d("WAWebBackendJobs.flow").EncMediaType.Sticker:return d("WAWebWamEnumMediaType").MEDIA_TYPE.STICKER;case d("WAWebBackendJobs.flow").EncMediaType.Hsm:return d("WAWebWamEnumMediaType").MEDIA_TYPE.HSM;case d("WAWebBackendJobs.flow").EncMediaType.ProductImage:return d("WAWebWamEnumMediaType").MEDIA_TYPE.PRODUCT_IMAGE;case d("WAWebBackendJobs.flow").EncMediaType.Template:return d("WAWebWamEnumMediaType").MEDIA_TYPE.TEMPLATE;case d("WAWebBackendJobs.flow").EncMediaType.MdAppState:return d("WAWebWamEnumMediaType").MEDIA_TYPE.MD_APP_STATE;case d("WAWebBackendJobs.flow").EncMediaType.MdHistorySync:return d("WAWebWamEnumMediaType").MEDIA_TYPE.MD_HISTORY_SYNC;case d("WAWebBackendJobs.flow").EncMediaType.List:return d("WAWebWamEnumMediaType").MEDIA_TYPE.LIST;case d("WAWebBackendJobs.flow").EncMediaType.ListResponse:return d("WAWebWamEnumMediaType").MEDIA_TYPE.LIST_REPLY;case d("WAWebBackendJobs.flow").EncMediaType.Button:return d("WAWebWamEnumMediaType").MEDIA_TYPE.BUTTON_MESSAGE;case d("WAWebBackendJobs.flow").EncMediaType.ButtonResponse:return d("WAWebWamEnumMediaType").MEDIA_TYPE.BUTTON_RESPONSE_MESSAGE;case d("WAWebBackendJobs.flow").EncMediaType.Order:return d("WAWebWamEnumMediaType").MEDIA_TYPE.ORDER;case d("WAWebBackendJobs.flow").EncMediaType.Product:return d("WAWebWamEnumMediaType").MEDIA_TYPE.PRODUCT_IMAGE;case d("WAWebBackendJobs.flow").EncMediaType.NativeFlowResponse:return d("WAWebWamEnumMediaType").MEDIA_TYPE.INTERACTIVE_RESPONSE_NFM}return d("WAWebWamEnumMediaType").MEDIA_TYPE.NONE}function k(a){if(a.deviceSentMessage){var b=a.deviceSentMessage.message;return b?k(b):null}else if(a.ephemeralMessage){b=a.ephemeralMessage.message;return b?k(b):null}else if(a.groupMentionedMessage){b=a.groupMentionedMessage.message;return b?k(b):null}else if(a.viewOnceMessageV2Extension){b=a.viewOnceMessageV2Extension.message;return b?k(b):null}else if(a.viewOnceMessage){b=a.viewOnceMessage.message;return b?k(b):null}else if(a.documentWithCaptionMessage){b=a.documentWithCaptionMessage.message;return b?k(b):null}else if(a.botInvokeMessage){b=a.botInvokeMessage.message;return b?k(b):null}else if(a.imageMessage)return d("WAWebBackendJobs.flow").EncMediaType.Image;else if(a.stickerMessage)return d("WAWebBackendJobs.flow").EncMediaType.Sticker;else if(a.lottieStickerMessage)return d("WAWebBackendJobs.flow").EncMediaType.Sticker;else if(a.locationMessage)return a.locationMessage.isLive===!0?d("WAWebBackendJobs.flow").EncMediaType.LiveLocation:d("WAWebBackendJobs.flow").EncMediaType.Location;else if(a.contactMessage)return d("WAWebBackendJobs.flow").EncMediaType.VCard;else if(a.contactsArrayMessage)return d("WAWebBackendJobs.flow").EncMediaType.ContactArray;else if(a.documentMessage)return d("WAWebBackendJobs.flow").EncMediaType.Document;else if(a.audioMessage)return a.audioMessage.ptt?d("WAWebBackendJobs.flow").EncMediaType.Ptt:d("WAWebBackendJobs.flow").EncMediaType.Audio;else if(a.videoMessage)return a.videoMessage.gifPlayback?d("WAWebBackendJobs.flow").EncMediaType.Gif:d("WAWebBackendJobs.flow").EncMediaType.Video;else if(a.ptvMessage)return d("WAWebBackendJobs.flow").EncMediaType.Ptv;else if(a.buttonsMessage)return d("WAWebBackendJobs.flow").EncMediaType.Button;else if(a.buttonsResponseMessage)return d("WAWebBackendJobs.flow").EncMediaType.ButtonResponse;else if(a.listMessage)return d("WAWebBackendJobs.flow").EncMediaType.List;else if(a.listResponseMessage)return d("WAWebBackendJobs.flow").EncMediaType.ListResponse;else if(a.orderMessage)return d("WAWebBackendJobs.flow").EncMediaType.Order;else if(a.productMessage)return d("WAWebBackendJobs.flow").EncMediaType.Product;else if(a.groupInviteMessage)return d("WAWebBackendJobs.flow").EncMediaType.Url;else if(a.interactiveResponseMessage)return d("WAWebBackendJobs.flow").EncMediaType.NativeFlowResponse;else if(((b=a.extendedTextMessage)==null?void 0:b.canonicalUrl)!=null&&a.extendedTextMessage.canonicalUrl.trim()!=="")return d("WAWebBackendJobs.flow").EncMediaType.Url;return null}function e(a){var b=function(){switch(a){case d("WAWebBackendJobs.flow").EncMediaType.Image:return"image";case d("WAWebBackendJobs.flow").EncMediaType.Video:return"video";case d("WAWebBackendJobs.flow").EncMediaType.Ptv:return"ptv";case d("WAWebBackendJobs.flow").EncMediaType.Audio:return"audio";case d("WAWebBackendJobs.flow").EncMediaType.Ptt:return"ptt";case d("WAWebBackendJobs.flow").EncMediaType.VCard:return"vcard";case d("WAWebBackendJobs.flow").EncMediaType.Document:return"document";case d("WAWebBackendJobs.flow").EncMediaType.Gif:return"gif";case d("WAWebBackendJobs.flow").EncMediaType.ContactArray:return"contact_array";case d("WAWebBackendJobs.flow").EncMediaType.Location:return"location";case d("WAWebBackendJobs.flow").EncMediaType.LiveLocation:return"livelocation";case d("WAWebBackendJobs.flow").EncMediaType.Sticker:return"sticker";case d("WAWebBackendJobs.flow").EncMediaType.List:return"list";case d("WAWebBackendJobs.flow").EncMediaType.ListResponse:return"list_response";case d("WAWebBackendJobs.flow").EncMediaType.ButtonResponse:return"buttons_response";case d("WAWebBackendJobs.flow").EncMediaType.Order:return"order";case d("WAWebBackendJobs.flow").EncMediaType.Product:return"product";case d("WAWebBackendJobs.flow").EncMediaType.Url:return"url";case d("WAWebBackendJobs.flow").EncMediaType.NativeFlowResponse:return"native_flow_response";default:return null}};b=b();if(b)return d("WAWap").CUSTOM_STRING(b);throw c("err")("Unsupported type")}function f(a){return function(b){return b==null?d("WAWap").DROP_ATTR:a(b)}}e=f(e);function l(a){switch(a){case d("WAWebBackendJobs.flow").DecryptFailType.Show:return d("WAWap").DROP_ATTR;case d("WAWebBackendJobs.flow").DecryptFailType.Hide:return d("WAWap").CUSTOM_STRING("hide")}}function m(a){if(a.isUser())return d("WAWebWamEnumE2eDestination").E2E_DESTINATION.INDIVIDUAL;else if(a.isGroup())return d("WAWebWamEnumE2eDestination").E2E_DESTINATION.GROUP;else if(a.isStatusV3())return d("WAWebWamEnumE2eDestination").E2E_DESTINATION.STATUS;else if(a.isBroadcast())return d("WAWebWamEnumE2eDestination").E2E_DESTINATION.LIST;else if(a.isNewsletter())return d("WAWebWamEnumE2eDestination").E2E_DESTINATION.CHANNEL}function n(a){if(a instanceof d("WAWebHandleMsgError").UnknownDeviceMessageError)return d("WAWebWamEnumPlaceholderReasonType").PLACEHOLDER_REASON_TYPE.UNKNOWN_COMPANION_NO_PREKEY;if(a instanceof d("WAWebSignalCommonErrors").SignalDecryptionError){var b=c("gkx")("26258")?.001:.01;switch(a.message){case"errSignalNoSession":case"errLoadSenderKeySession":return d("WAWebWamEnumPlaceholderReasonType").PLACEHOLDER_REASON_TYPE.SIGNAL_NO_SESSION;case"errSignalInvalidMsg":return d("WAWebWamEnumPlaceholderReasonType").PLACEHOLDER_REASON_TYPE.SIGNAL_INVALID_MESSAGE;case"errSignalInvalidKey":return d("WAWebWamEnumPlaceholderReasonType").PLACEHOLDER_REASON_TYPE.SIGNAL_INVALID_KEY;case"errSignalTooManyMessagesInFuture":case"errSignalGrpTooManyMessagesInFuture":return d("WAWebWamEnumPlaceholderReasonType").PLACEHOLDER_REASON_TYPE.SIGNAL_FUTURE_MESSAGE;case"errInvalidMacWithDecryptedPlaintext":case"errInvalidMacInvalidCipherKey":case"errInvalidMacInvalidCipherKeyNewChain":var e="MsgPlaceholderBadMac-"+a.message;d("WALogger").ERROR(i()).sendLogs(e,b);return d("WAWebWamEnumPlaceholderReasonType").PLACEHOLDER_REASON_TYPE.SIGNAL_BAD_MAC}e="MsgPlaceholderOther-"+a.message;d("WALogger").ERROR(h()).sendLogs(e,b);return d("WAWebWamEnumPlaceholderReasonType").PLACEHOLDER_REASON_TYPE.OTHER}}function o(a){if(a.interactiveResponseMessage){return(a=a.interactiveResponseMessage.nativeFlowResponseMessage)==null?void 0:a.name}return null}f=f(function(a){return d("WAWap").CUSTOM_STRING(a)});function p(a){switch(a){case d("WAWebAck").EDIT_ATTR.SENDER_REVOKE:return d("WAWebWamEnumEditType").EDIT_TYPE.SENDER_REVOKE;case d("WAWebAck").EDIT_ATTR.ADMIN_REVOKE:return d("WAWebWamEnumEditType").EDIT_TYPE.ADMIN_REVOKE;case d("WAWebAck").EDIT_ATTR.MESSAGE_EDIT:return d("WAWebWamEnumEditType").EDIT_TYPE.EDITED;default:return d("WAWebWamEnumEditType").EDIT_TYPE.NOT_EDITED}}function q(a,b){return d("WAWebSendMsgCommonApi").isRevokeMsg(a)?b.subtype==="admin_revoke"?d("WAWebWamEnumEditType").EDIT_TYPE.ADMIN_REVOKE:d("WAWebWamEnumEditType").EDIT_TYPE.SENDER_REVOKE:d("WAWebSendMsgCommonApi").isEditMsg(a)?d("WAWebWamEnumEditType").EDIT_TYPE.EDITED:d("WAWebWamEnumEditType").EDIT_TYPE.NOT_EDITED}function r(a){return a?d("WAJobOrchestratorTypes").JOB_PRIORITY.OFFLINE:d("WAJobOrchestratorTypes").JOB_PRIORITY.LOW}g.CIPHERTEXT_VERSION=j;g.getMetricE2eCiphertextType=a;g.getMetricMediaType=b;g.mediaTypeFromProtobuf=k;g.encodeMaybeMediaType=e;g.encodeMaybeDecryptFail=l;g.getMetricE2eDestination=m;g.getPlaceholderAddReason=n;g.nativeFlowNameTypeFromProtobuf=o;g.encodeMaybeNativeFlowName=f;g.getMetricEditType=p;g.getMetricEditTypeFromMsg=q;g.getNonCriticalNotificationPriority=r}),98);
__d("WAWebAddOnsMarkAddOnsAsReadDb",["Promise","WANullthrows","WAWebDBAddOnProviders","WAWebDBMarkAsReadForTable","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var d=b("WAWebDBAddOnProviders"),e=d.getProviderForAddOnType;d=(yield (h||(h=b("Promise"))).allSettled(Array.from(a.entries()).map(function(a){var b=a[0];a=a[1];b=c("WANullthrows")(e(b));return b.markAsRead==null?void 0:b.markAsRead(a)})));for(a of d)if(a.status==="rejected")throw a.reason});return i.apply(this,arguments)}function e(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=new Map(),e=d("WAWebDBAddOnProviders").addOnProviders.map(function(){var d=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var d=(yield b.markAsRead==null?void 0:b.markAsRead(a));c.set(b.type,(b=d)!=null?b:[])});return function(a){return d.apply(this,arguments)}}()),f=[],g=d("WAWebDBMarkAsReadForTable").markAsReadForTable("message-orphans",a.map(String)).then(function(a){f.push.apply(f,a)});e=(yield (h||(h=b("Promise"))).allSettled([].concat(e,[g])));for(g of e)if(g.status==="rejected")throw g.reason;return{updatedAddOns:c,updatedOrphans:f}});return j.apply(this,arguments)}g.markAddOnsAsReadDb=a;g.markUnclassifiedAddOnsAsReadDb=e}),98);
__d("WAWebApiTasksScheduledTime",["WAWebModelStorageUtils","WAWebSchemaTasksScheduledTime"],(function(a,b,c,d,e,f,g){function a(a){return d("WAWebSchemaTasksScheduledTime").getTasksScheduledTimeTable().get(a).then(function(a){return a==null?void 0:a.time})}function b(a,b){return d("WAWebModelStorageUtils").getStorage().lock(["tasks-scheduled-time"],function(c){c=c[0];var d={taskName:a,time:b};return c.createOrReplace(d)})}g.getTaskScheduledTime=a;g.updateTaskScheduledTime=b}),98);
__d("WAWebLastADVCheckTimeApi",["Promise","WAWebApiTasksScheduledTime"],(function(a,b,c,d,e,f,g){var h,i;function a(){i==null&&(i=d("WAWebApiTasksScheduledTime").getTaskScheduledTime("advDeviceInfoCheck"));return i}function c(a){i=(h||(h=b("Promise"))).resolve(a)}g.getLastADVDeviceInfoCheckTime=a;g.setLastADVDeviceInfoCheckTime=c}),98);
__d("WAWebAdvHandlerApi",["Promise","WALogger","WAWebApiDeviceList","WAWebCryptoCurve25519","WAWebDeviceListPk","WAWebHandleAdvForMessageApi","WAWebHandleAdvForUsyncApi","WAWebIdentityUpdateDeviceTableApi","WAWebLastADVCheckTimeApi","WAWebSignalCommonUtils","WAWebSignalProtocolStore","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleADVDeviceSyncResultImpl: start to handling "," updates"]);i=function(){return a};return a}function a(a,b,c,d,e,f,g){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f,g,h){g===void 0&&(g=!1);var i=(yield d("WAWebLastADVCheckTimeApi").getLastADVDeviceInfoCheckTime());return d("WAWebHandleAdvForMessageApi").handleADVDeviceUpdateForMessage(a,b,c,e,f,g,i,h)});return j.apply(this,arguments)}function e(a){var d=a.wid,e=a.devices;a=a.type;return a==null?(h||(h=b("Promise"))).reject(c("err")("handleADVDeviceNotification: notification without type")):k(d,e,a)}function f(a){return m(a)}function k(a,b,c){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){var f=null;if(e==="add"){var g=(yield d("WAWebSignalProtocolStore").getPersistSignalProtocolStore().loadIdentityKey(d("WAWebSignalCommonUtils").createSignalAddress(a).toString()));f=g?d("WAWebCryptoCurve25519").toCurveKeyPubKey(d("WAWebSignalCommonUtils").strToBuffer(g)):null}g=(yield d("WAWebApiDeviceList").getDeviceRecord(a));var h=(yield d("WAWebLastADVCheckTimeApi").getLastADVDeviceInfoCheckTime()),i=b("WAWebHandleAdvForUsyncApi").handleDeviceNotification;i=i(a,e,c,f,g,h);if(i){if(i.clearRecord){yield d("WAWebIdentityUpdateDeviceTableApi").clearDeviceRecord(a,(g==null?void 0:g.devices)||[],!1,g==null?void 0:g.advAccountType,i==null?void 0:(e=i.update)==null?void 0:e.advAccountType)}return d("WAWebIdentityUpdateDeviceTableApi").bulkApplyDeviceUpdate([{wid:a,update:i.update,currentRecord:g}])}});return l.apply(this,arguments)}function m(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WALogger").LOG(i(),a.length).devConsole(a);var c=a.map(function(a){return a.wid}),e=a.filter(function(a){return(a=a.devices.keyIndex)==null?void 0:a.signedKeyIndexBytes}),f=(yield d("WAWebSignalProtocolStore").getPersistSignalProtocolStore().bulkLoadIdentityKey(e.map(function(a){return d("WAWebSignalCommonUtils").createSignalAddress(a.wid).toString()}))),g=new Map();e.forEach(function(a,b){g.set(d("WAWebDeviceListPk").createDeviceListPK(a.wid),f[b])});var j=(yield d("WAWebApiDeviceList").bulkGetDeviceRecord(c)),k=[],l=[],m=b("WAWebHandleAdvForUsyncApi").handleADVSyncResult;a.forEach(function(a,b){var c=g.get(d("WAWebDeviceListPk").createDeviceListPK(a.wid));c=c?d("WAWebCryptoCurve25519").toCurveKeyPubKey(d("WAWebSignalCommonUtils").strToBuffer(c)):null;b=j[b];c=m(a.wid,a.devices,c,b);if(c==null)return;if(c.clearRecord){var e;k.push({wid:a.wid,currentList:(b==null?void 0:b.devices)||[],currentAdvAccountType:b==null?void 0:b.advAccountType,incomingAdvAccountType:(e=c.update)==null?void 0:e.advAccountType});l.push({wid:a.wid,currentRecord:{id:d("WAWebDeviceListPk").createDeviceListPK(a.wid),deleted:!0},update:c.update})}else l.push({wid:a.wid,currentRecord:b,update:c.update})});yield (h||(h=b("Promise"))).all(k.map(function(a){var b=a.wid,c=a.currentList,e=a.currentAdvAccountType;a=a.incomingAdvAccountType;return d("WAWebIdentityUpdateDeviceTableApi").clearDeviceRecord(b,c,!1,e,a)}));yield d("WAWebIdentityUpdateDeviceTableApi").bulkApplyDeviceUpdate(l)});return n.apply(this,arguments)}g.handleADVDeviceUpdateForMessage=a;g.handleADVDeviceNotification=e;g.handleADVDeviceSyncResult=f}),98);
__d("WAWebAdvSignatureApi",["invariant","Promise","WABase64","WABinary","WAByteArray","WALogger","WAWebAdvHandlerApi","WAWebBackendJobs.flow","WAWebCryptoCurve25519","WAWebProtobufsAdv.pb","WAWebSignalCommonUtils","WAWebSignalProtocolStore","WAWebSignalStoreApi","WAWebSignalUtilsApi","WAWebUserPrefsMultiDevice","WAWebWidFactory","asyncToGeneratorRuntime","decodeProtobuf","encodeProtobuf","err"],(function(a,b,c,d,e,f,g,h){var i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["validateADVwithEncs: failed ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["validateADVwithEncs: start validate prekey msg "]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["validateADVIdentity: failed"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["validateADVIdentity: successfully verified accountSignature and deviceSignature"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["validateADVIdentity: process adv device identity failed"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["validateADVIdentity: invalid device signature"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["validateADVIdentity: invalid account signature"]);p=function(){return a};return a}function q(a,b,c,d){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){e===void 0&&(e=!1);var f=!1;try{var g=d("WAWebWidFactory").toUserWid(a);c=d("WAByteArray").uint8ArrayToBuffer(c);var i=(yield d("WAWebSignalProtocolStore").getSignalProtocolStore().loadIdentityKey(d("WAWebSignalCommonUtils").createSignalAddress(a).toString()));if(i){i=d("WAWebCryptoCurve25519").toCurveKeyPubKey(d("WAWebSignalCommonUtils").strToBuffer(i));if(d("WAWebSignalCommonUtils").bufferEqual(i,c))return!0}i=d("decodeProtobuf").decodeProtobuf(d("WAWebProtobufsAdv.pb").ADVSignedDeviceIdentitySpec,b);i!=null||h(0,56342);b=(yield d("WAWebSignalProtocolStore").getSignalProtocolStore().loadIdentityKey(d("WAWebSignalCommonUtils").createSignalAddress(g).toString()));g=b?d("WAWebCryptoCurve25519").toCurveKeyPubKey(d("WAWebSignalCommonUtils").strToBuffer(b)):null;if(!D(i,c,g)){d("WALogger").WARN(p());return!1}if(!J(i,c,g,f)){d("WALogger").WARN(o());return!1}b=d("decodeProtobuf").decodeProtobuf(d("WAWebProtobufsAdv.pb").ADVDeviceIdentitySpec,i.details);b!=null||h(0,56341);f=i.accountSignatureKey;try{yield d("WAWebAdvHandlerApi").handleADVDeviceUpdateForMessage(a,b,g,f,c,e,b.accountType)}catch(a){d("WALogger").WARN(n()).devConsole(a);return!1}d("WALogger").LOG(m());return!0}catch(a){d("WALogger").WARN(l()).devConsole(a);return!1}});return r.apply(this,arguments)}function a(a,b,c,d){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){e===void 0&&(e=!1);c=c.find(function(a){return a.e2eType===d("WAWebBackendJobs.flow").CiphertextType.Pkmsg});if(!c)return!0;d("WALogger").LOG(k());try{a!=null||h(0,56346);c=d("WAWebSignalUtilsApi").extractIdentityKey(c.ciphertext);c!=null||h(0,56345);a=(yield q(a,b,new Uint8Array(c),e));yield d("WAWebSignalProtocolStore").getSignalProtocolStore().flushBufferToDiskIfNotMemOnlyMode();return a}catch(a){d("WALogger").WARN(j(),a);return!1}});return s.apply(this,arguments)}var t=new Uint8Array([6,5]),u=new Uint8Array([6,6]),v=new Uint8Array([6,0]),w=new Uint8Array([6,1]),x=new Uint8Array([6,2]);function e(){return y.apply(this,arguments)}function y(){y=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=new Uint8Array(32);self.crypto.getRandomValues(a);a=d("WABase64").encodeB64(a);yield d("WAWebUserPrefsMultiDevice").setADVSecretKey(a);return a});return y.apply(this,arguments)}function f(){return z.apply(this,arguments)}function z(){z=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WAWebUserPrefsMultiDevice").getADVSecretKey());if(a==null)throw c("err")("MD secretKey is null or undefined");return a});return z.apply(this,arguments)}function A(a){if(a==null)return(i||(i=b("Promise"))).reject(c("err")("MD advSignedDeviceIdentity is null or undefined"));return a.deviceSignature==null?(i||(i=b("Promise"))).reject(c("err")("MD advSignedDeviceIdentity is missing deviceSignature")):d("WAWebSignalStoreApi").waSignalStore.putADVSignedIdentity(a)}function B(){return C.apply(this,arguments)}function C(){C=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WAWebSignalStoreApi").waSignalStore.getADVSignedIdentity());if(a==null)throw c("err")("MD advSignedDeviceIdentity is null or undefined");if(a.deviceSignature==null)throw c("err")("MD advSignedDeviceIdentity is missing deviceSignature");return d("encodeProtobuf").encodeProtobuf(d("WAWebProtobufsAdv.pb").ADVSignedDeviceIdentitySpec,a).readByteArray()});return C.apply(this,arguments)}function D(a,b,c){a=F(a,c);c=a.accountSignatureKey;var d=a.accountSignature;a=a.advDeviceIdentityDetails;return E(a,d,b,c)}function E(a,b,c,e){var f=v;e!=null||h(0,56344);b!=null||h(0,56295);f=d("WABinary").Binary.build(f,a,c).readByteArray();return d("WAWebCryptoCurve25519").verifySignature(new Uint8Array(e),f,new Uint8Array(b))}function F(a,b){var c=a.details;b=a.accountSignatureKey||b;b!=null||h(0,56344);a=a.accountSignature;a!=null||h(0,56295);c!=null||h(0,70451);return{accountSignatureKey:b,accountSignature:a,advDeviceIdentityDetails:c}}function G(a,b,c){a=a.details;a=d("WABinary").Binary.build(w,a,b.pubKey,c).readByteArray().buffer;return d("WAWebCryptoCurve25519").calculateSignature(b,a)}function H(a,b,c,e,f){c=w;c=d("WABinary").Binary.build(c,a,b,f).readByteArray();return d("WAWebCryptoCurve25519").verifySignature(new Uint8Array(b),c,new Uint8Array(e))}function I(a,b){var c=a.details,d=a.deviceSignature;d!=null||h(0,56343);a=a.accountSignatureKey||b;a!=null||h(0,56344);c!=null||h(0,70451);return{accountSignatureKey:a,deviceSignature:d,advDeviceIdentityDetails:c}}function J(a,b,c,e){e===void 0&&(e=!1);e=I(a,c);a=e.accountSignatureKey;c=e.deviceSignature;e=e.advDeviceIdentityDetails;var f=d("WAWebProtobufsAdv.pb").ADVEncryptionType.E2EE;return H(e,b,f,c,a)}function K(a){}function K(){return L.apply(this,arguments)}function L(){L=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield d("WAWebUserPrefsMultiDevice").setADVSecretKey(void 0)});return L.apply(this,arguments)}function M(a,b){var c=a.details;a=a.accountSignature;a!=null||h(0,56295);c=d("WABinary").Binary.build(x,c).readByteArray();return d("WAWebCryptoCurve25519").verifySignature(new Uint8Array(b),c,new Uint8Array(a))}function N(a,b,c){return!1}function O(a,b,c){return!1}g.validateADVwithIdentityKey=q;g.validateADVwithEncs=a;g.ADV_HOSTED_PREFIX_DEVICE_IDENTITY_ACCOUNT_SIGNATURE=t;g.generateADVSecretKey=e;g.getADVSecretKey=f;g.setADVSignedIdentity=A;g.getADVEncodedIdentity=B;g.verifyDeviceIdentityAccountSignature=D;g.generateDeviceSignature=G;g.clearADVSecretKey=K;g.verifyKeyIndexListAccountSignature=M;g.verifyHostedDeviceIdentityAccountSignature=N;g.verifyHostedDeviceSignature=O}),98);
__d("WAWebAdvExpectedTsApi",["WATimeUtils"],(function(a,b,c,d,e,f,g){function a(a,b,c){var d=b==null?void 0:b.timestamp;if(d==null)return{expectedTs:void 0,expectedTsLastDeviceJobTs:void 0,expectedTsUpdateTs:void 0};var e,f,g;b!=null&&!b.deleted&&(e=b.expectedTs,f=b.expectedTsLastDeviceJobTs,g=b.expectedTsUpdateTs);return h(a,d,c,e,f,g)}function h(a,b,c,e,f,g){f={expectedTs:e,expectedTsLastDeviceJobTs:f,expectedTsUpdateTs:g};if(b>=a||e!=null&&e>=a)return f;f.expectedTs=a;f.expectedTsLastDeviceJobTs=(g=c)!=null?g:void 0;(e==null||b>=e)&&(f.expectedTsUpdateTs=d("WATimeUtils").unixTimeWithoutClockSkewCorrection());return f}function b(a,b,c,d){if(c==null||c.deleted)return!1;if(c.expectedTs==null)return!1;if(a>=c.expectedTs)return!0;return a<c.expectedTs&&b===c.expectedTs&&d!=null&&(c.expectedTsLastDeviceJobTs==null||d>c.expectedTsLastDeviceJobTs)?!0:!1}g.computeExpectedTsForDeviceRecord=a;g.computeNewExpectedTs=h;g.shouldClearExpectedTs=b}),98);
__d("WAWebBizCoexOfflineICDCHandledCache",["WAWebCmd"],(function(a,b,c,d,e,f,g){var h=new Set();function a(a){h.add(a)}function b(a){h["delete"](a)}function c(a){return h.has(a)}d("WAWebCmd").Cmd.on("offline_delivery_end",function(){h.clear()});g.addToOfflineBizHostedSenderICDCProcessedCache=a;g.removeFromOfflineBizHostedSenderICDCProcessedCache=b;g.hasOfflineBizHostedSenderICDCProcessedForSender=c}),98);
__d("WAWebIcdcHandlerApi",["Promise","WAJids","WALogger","WALongInt","WAPromiseQueue","WATimeUtils","WAWebAdvExpectedTsApi","WAWebApiDeviceList","WAWebApiPendingDeviceSync","WAWebBizCoexGatingUtils","WAWebBizCoexOfflineICDCHandledCache","WAWebCmd","WAWebHandleAdvForUsyncApi","WAWebIdentityUpdateDeviceTableApi","WAWebLastADVCheckTimeApi","WAWebProtobufsAdv.pb","WAWebSyncDeviceAdvDeviceListJob","WAWebUserPrefsMeUser","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleICDCData: old values: ",", new expected values record ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleICDCData: update expectd timestamp for ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["get empty device list metadata"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleHostedIcdcMetadataInline: skip processing since already processed for currentl offline resume session"]);l=function(){return a};return a}var m=new(d("WAPromiseQueue").PromiseQueue)();function a(a,c,d){return d==null?(h||(h=b("Promise"))).resolve():m.enqueue(function(){return o(a,c,d)})}function c(a,b,c){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){var e={hostedBizEncMismatch:!1,senderOrRecipientAccountTypeHosted:!1};if(!d("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled())return e;if(a.isSameAccount(d("WAWebUserPrefsMeUser").getMeUser()))return e;if(!a.isUser())return e;c=c==null?void 0:c.deviceListMetadata;if(c==null)return e;var f=b.isSameAccount(d("WAWebUserPrefsMeUser").getMeUser()),g=f?c.receiverAccountType:c.senderAccountType;f=f?a:b;if(g==null)return e;if(g===d("WAWebProtobufsAdv.pb").ADVEncryptionType.E2EE){d("WAWebBizCoexOfflineICDCHandledCache").removeFromOfflineBizHostedSenderICDCProcessedCache(f);return e}if(g!==d("WAWebProtobufsAdv.pb").ADVEncryptionType.HOSTED)return e;if(d("WAWebBizCoexOfflineICDCHandledCache").hasOfflineBizHostedSenderICDCProcessedForSender(f)){d("WALogger").DEV(l());return{hostedBizEncMismatch:!1,senderOrRecipientAccountTypeHosted:!0}}d("WAWebBizCoexOfflineICDCHandledCache").addToOfflineBizHostedSenderICDCProcessedCache(f);a=(yield d("WAWebApiDeviceList").getDeviceRecord(f));g=d("WALongInt").numberOrThrowIfTooLarge((b=c.senderTimestamp)!=null?b:0);b=(c=a==null?void 0:a.timestamp)!=null?c:0;if(g>b&&(a==null?void 0:a.advAccountType)!==d("WAWebProtobufsAdv.pb").ADVEncryptionType.HOSTED){yield d("WAWebIdentityUpdateDeviceTableApi").clearDeviceRecord(f,(c=a==null?void 0:a.devices)!=null?c:[],!d("WAWebCmd").Cmd.isOfflineDeliveryEnd,d("WAWebProtobufsAdv.pb").ADVEncryptionType.E2EE,d("WAWebProtobufsAdv.pb").ADVEncryptionType.HOSTED);d("WAWebCmd").Cmd.isOfflineDeliveryEnd?void d("WAWebSyncDeviceAdvDeviceListJob").syncDeviceListJob([f],null,null):yield d("WAWebApiPendingDeviceSync").addUserToPendingDeviceSync([f.toString()]);return{hostedBizEncMismatch:!0,senderOrRecipientAccountTypeHosted:!0}}return e});return n.apply(this,arguments)}function o(a,b,c){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){c=c.deviceListMetadata;if(c==null){d("WALogger").LOG(k()).tags("handleICDCData");return}if((a.device==null||a.device===d("WAJids").DEFAULT_DEVICE_ID)&&(c.senderTimestamp!=null&&c.senderKeyHash==null)){var e=d("WALongInt").numberOrThrowIfTooLarge(c.senderTimestamp)+1;d("WAWebHandleAdvForUsyncApi").handleADVSyncResult(a,{deviceList:[{id:d("WAJids").DEFAULT_DEVICE_ID,keyIndex:0}],keyIndex:{ts:d("WATimeUtils").castToUnixTime(e),signedKeyIndexBytes:null}},null,null);return}var f=[];e=a.user===d("WAWebUserPrefsMeUser").getMeUser().user;f.push({id:a,ts:c.senderTimestamp});e&&b!=null&&f.push({id:b,ts:c.recipientTimestamp});var g=(yield d("WAWebLastADVCheckTimeApi").getLastADVDeviceInfoCheckTime());a=(yield d("WAWebApiDeviceList").bulkGetDeviceRecord(f.map(function(a){return a.id})));var h=[];a.forEach(function(a,b){b=f[b].ts;if(a==null||a.deleted||b==null)return;b=d("WAWebAdvExpectedTsApi").computeExpectedTsForDeviceRecord(d("WALongInt").numberOrThrowIfTooLarge(b),a,g);(b.expectedTs!==a.expectedTs||b.expectedTsLastDeviceJobTs!==a.expectedTsLastDeviceJobTs||a.expectedTsUpdateTs!==a.expectedTsUpdateTs)&&(d("WALogger").LOG(j(),a.id),d("WALogger").DEV(i(),JSON.stringify(a),JSON.stringify(b)),h.push(babelHelpers["extends"]({},a,b)))});if(h.length>0)return d("WAWebApiDeviceList").bulkCreateOrReplaceDeviceRecord(h)});return p.apply(this,arguments)}g.handleICDCData=a;g.handleHostedIcdcMetadataInline=c}),98);
__d("WAWebHandleAdvForMessageApi",["invariant","WAJids","WAWebApiDeviceList","WAWebHandleAdvListResetApi","WAWebHandleAdvNoListResetApi","WAWebSignalCommonUtils","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g,h){function a(a,b,c,d,e,f,g,h){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f,g,i,j){g===void 0&&(g=!1);var k=b.rawId,l=b.timestamp;b=b.keyIndex;k!=null||h(0,56258);l!=null||h(0,56257);b!=null||h(0,56256);l={rawId:k,timestamp:l,keyIndex:b};b=a.device;b!=null&&b!==d("WAJids").DEFAULT_DEVICE_ID||h(0,56259);b=d("WAWebWidFactory").toUserWid(a);b=(yield d("WAWebApiDeviceList").getDeviceRecord(b));c=c==null||e!=null&&!d("WAWebSignalCommonUtils").bufferEqual(c,e);return!b||b.deleted||b.rawId!==k||c?d("WAWebHandleAdvListResetApi").handleListReset(a,l,c?e:null,f,b,g,i,j):d("WAWebHandleAdvNoListResetApi").handleNoListReset(a,l,f,b,g,i,j)});return i.apply(this,arguments)}g.handleADVDeviceUpdateForMessage=a}),98);
__d("WAWebHandleAdvListResetApi",["invariant","WAJids","WALongInt","WATimeUtils","WAWebABProps","WAWebAdvExpectedTsApi","WAWebCryptoCurve25519","WAWebDeviceListPk","WAWebIdentityUpdateDeviceTableApi","WAWebSignalCommonUtils","WAWebSignalProtocolStore","WAWebWidFactory","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g,h){function a(a,b,c,d,e,f,g,h){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g,i,j,k){var l;i===void 0&&(i=!1);k=b.rawId;var m=b.timestamp;b=b.keyIndex;m=d("WALongInt").numberOrThrowIfTooLarge(m);var n=a.device;n!=null&&n!==d("WAJids").DEFAULT_DEVICE_ID||h(0,56259);var o=d("WAWebWidFactory").toUserWid(a),p=0;p=(l=g==null?void 0:g.timestamp)!=null?l:d("WATimeUtils").pastUnixTime((d("WAWebABProps").getABPropConfigValue("num_days_key_index_list_expiration")-1)*d("WATimeUtils").DAY_SECONDS);if(g!=null&&!g.deleted){if(g.timestamp>m)throw c("err")("handleADVDeviceIdentity: out-of-order timestamp detected");yield d("WAWebIdentityUpdateDeviceTableApi").clearDeviceRecord(o,g.devices,i)}e&&(yield d("WAWebSignalProtocolStore").getSignalProtocolStore().saveIdentity(d("WAWebSignalCommonUtils").createSignalAddress(o).toString(),d("WAWebCryptoCurve25519").toSignalCurvePubKey(e)));l={id:d("WAWebDeviceListPk").createDeviceListPK(a),rawId:k,timestamp:p,devices:[{id:n,keyIndex:b},{id:d("WAJids").DEFAULT_DEVICE_ID,keyIndex:0}],validIndexes:null,currentIndex:null,deleted:!1};g=d("WAWebAdvExpectedTsApi").computeExpectedTsForDeviceRecord(m,l,j);l.expectedTs=g.expectedTs;l.expectedTsLastDeviceJobTs=g.expectedTsLastDeviceJobTs;l.expectedTsUpdateTs=g.expectedTsUpdateTs;yield d("WAWebIdentityUpdateDeviceTableApi").bulkApplyDeviceUpdate([{wid:o,update:l,currentRecord:null}],i);yield d("WAWebSignalProtocolStore").getSignalProtocolStore().saveIdentity(d("WAWebSignalCommonUtils").createSignalAddress(a).toString(),d("WAWebCryptoCurve25519").toSignalCurvePubKey(f))});return i.apply(this,arguments)}g.handleListReset=a}),98);
__d("WAWebHandleAdvNoListResetApi",["invariant","WAJids","WALongInt","WAWebAdvExpectedTsApi","WAWebCryptoCurve25519","WAWebIdentityUpdateDeviceTableApi","WAWebSignalCommonUtils","WAWebSignalProtocolStore","WAWebWidFactory","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g,h){function a(a,b,c,d,e,f,g){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g,i,j){g===void 0&&(g=!1);j=b.timestamp;b=b.keyIndex;j=d("WALongInt").numberOrThrowIfTooLarge(j);var k=a.device;k!=null&&k!==d("WAJids").DEFAULT_DEVICE_ID||h(0,56259);if(f.timestamp>=j&&f.validIndexes&&!f.validIndexes.includes(b))throw c("err")("handleADVDeviceIdentity: out-of-order timestamp detected");var l=new Map(f.devices.map(function(a){return[a.id,a.keyIndex]}));if(!l.has(k)||l.get(k)!==b){l.set(k,b);k=Array.from(l.entries()).map(function(a){var b=a[0];a=a[1];return{id:b,keyIndex:a}});b=babelHelpers["extends"]({},f,{devices:k,deleted:!1});l=d("WAWebAdvExpectedTsApi").computeExpectedTsForDeviceRecord(j,b,i);b.expectedTs=l.expectedTs;b.expectedTsLastDeviceJobTs=l.expectedTsLastDeviceJobTs;b.expectedTsUpdateTs=l.expectedTsUpdateTs;yield d("WAWebIdentityUpdateDeviceTableApi").bulkApplyDeviceUpdate([{wid:d("WAWebWidFactory").toUserWid(a),update:b,currentRecord:f}],g);yield d("WAWebSignalProtocolStore").getSignalProtocolStore().saveIdentity(d("WAWebSignalCommonUtils").createSignalAddress(a).toString(),d("WAWebCryptoCurve25519").toSignalCurvePubKey(e))}});return i.apply(this,arguments)}g.handleNoListReset=a}),98);
__d("WAWebHandleAdvDeviceNotificationApi",["WAJids","WALogger","WALongInt","WAWebAdvExpectedTsApi","WAWebBizCoexGatingUtils","WAWebBizCoexUtils","WAWebDeviceListPk","WAWebHandleAdvDeviceNotificationUtils"],(function(a,b,c,d,e,f,g){function a(){var b=babelHelpers.taggedTemplateLiteralLoose(["Clear record due to mismatch between local ADV account type and incoming ADV account type of ",""]);a=function(){return b};return b}function b(a,b,c,e,f,g,h){if(!g||g.deleted){d("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()&&d("WAWebBizCoexUtils").triggerUsyncForCoexDeviceAdd(b,a);return null}if(c<g.timestamp)return null;if(f==null)return null;f=d("WAWebHandleAdvDeviceNotificationUtils").decodeSignedKeyIndexBytes(f,e);if(!f)return null;e=f.rawId;var i=d("WALongInt").numberOrThrowIfTooLarge(f.timestamp),j=null;if(i!==c)return null;j=!1;c=null;var k=g.timestamp;g.rawId!==e?j=!0:c=g.devices;var l=new Set(f.validIndexes),m=f.currentIndex||0,n=c==null?[]:c.filter(function(a){return a.id!==d("WAJids").DEFAULT_DEVICE_ID&&(l.has(a.keyIndex)||a.keyIndex>m)});b.forEach(function(a){var b=a.id;a=a.keyIndex;b!==d("WAJids").DEFAULT_DEVICE_ID&&a!=null&&l.has(a)&&n.push({id:b,keyIndex:a})});n.push({id:d("WAJids").DEFAULT_DEVICE_ID,keyIndex:0});g={id:d("WAWebDeviceListPk").createDeviceListPK(a),rawId:e,timestamp:k,validIndexes:Array.from(l),devices:n,currentIndex:f.currentIndex,deleted:!1};c=d("WAWebAdvExpectedTsApi").computeExpectedTsForDeviceRecord(i,g,h);g.expectedTs=c.expectedTs;g.expectedTsLastDeviceJobTs=c.expectedTsLastDeviceJobTs;g.expectedTsUpdateTs=c.expectedTsUpdateTs;return{update:g,clearRecord:j}}function c(a,b,c){if(c==null||c.deleted)return null;if(b<c.timestamp)return null;var e=new Map(a.map(function(a){return[a.id,a.keyIndex]}));b=c.devices.filter(function(a){if(a.id!==d("WAJids").DEFAULT_DEVICE_ID){var b=e.get(a.id);return b==null||b!==a.keyIndex}return!1});b.push({id:d("WAJids").DEFAULT_DEVICE_ID,keyIndex:0});return{update:babelHelpers["extends"]({},c,{devices:b}),clearRecord:!1}}g.handleDeviceAddNotification=b;g.handleDeviceRemoveNotification=c}),98);
__d("WAWebHandleAdvDeviceNotificationUtils",["WAWebAdvSignatureApi","WAWebProtobufsAdv.pb","decodeProtobuf"],(function(a,b,c,d,e,f,g){function a(a,b){var c;try{c=d("decodeProtobuf").decodeProtobuf(d("WAWebProtobufsAdv.pb").ADVSignedKeyIndexListSpec,b)}catch(a){return null}if(!d("WAWebAdvSignatureApi").verifyKeyIndexListAccountSignature(c,a))return null;var e;try{e=d("decodeProtobuf").decodeProtobuf(d("WAWebProtobufsAdv.pb").ADVKeyIndexListSpec,c.details)}catch(a){return null}b=e;a=b.timestamp;var f=b.rawId,g=b.validIndexes,h=b.currentIndex;b=b.accountType;if(a==null)return null;return f==null?null:{timestamp:a,rawId:f,validIndexes:g,currentIndex:h,accountType:b}}g.decodeSignedKeyIndexBytes=a}),98);
__d("WAWebHandleAdvOmittedResultApi",["WAJids","WAWebAdvExpectedTsApi"],(function(a,b,c,d,e,f,g){function a(a,b,c,e){if(!b||b.deleted)return null;if(a!=null&&a<b.timestamp)return null;var f=babelHelpers["extends"]({},b);a!=null&&(f.timestamp=a,d("WAWebAdvExpectedTsApi").shouldClearExpectedTs(a,c,b,e)&&(f.expectedTs=void 0,f.expectedTsLastDeviceJobTs=void 0,f.expectedTsUpdateTs=void 0));f.devices=[{id:d("WAJids").DEFAULT_DEVICE_ID,keyIndex:0}];return{update:f,clearRecord:!1}}g.handleOmittedResult=a}),98);
__d("WAWebHandleAdvForUsyncApi",["invariant","WAJids","WALogger","WAWebHandleAdvDeviceNotificationApi","WAWebHandleAdvKeyIndexResultApi","WAWebHandleAdvOmittedResultApi"],(function(a,b,c,d,e,f,g,h){function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["processADVSyncResult: drop response with companion device but no keyIndexbytes"]);i=function(){return a};return a}function a(a,b,c,e,f){var g=b.deviceList;b=b.keyIndex;if(b==null||b.signedKeyIndexBytes==null){if(g!=null&&g.some(function(a){return a.id!==d("WAJids").DEFAULT_DEVICE_ID})){d("WALogger").LOG(i());return}return d("WAWebHandleAdvOmittedResultApi").handleOmittedResult(b==null?void 0:b.ts,e,b==null?void 0:b.expectedTs,f)}var h=b.ts,j=b.expectedTs;b=b.signedKeyIndexBytes;return d("WAWebHandleAdvKeyIndexResultApi").handleKeyIndexResult(a,g,h,b,c,e,f,j)}function b(a,b,c,e,f,g){var i=c.deviceList;c=c.keyIndex;i!=null||h(0,75739,b);c!=null||h(0,75740,b);var j=c.ts,k=c.signedKeyIndexBytes;if(b==="add"){k!=null||h(0,75741,b);return d("WAWebHandleAdvDeviceNotificationApi").handleDeviceAddNotification(a,i,j,k,e,f,g)}if(b==="remove")return d("WAWebHandleAdvDeviceNotificationApi").handleDeviceRemoveNotification(i,c.ts,f)}g.handleADVSyncResult=a;g.handleDeviceNotification=b}),98);
__d("WAWebHandleAdvKeyIndexResultApi",["invariant","WAJids","WALogger","WALongInt","WAWebAdvExpectedTsApi","WAWebDeviceListPk","WAWebHandleAdvDeviceNotificationUtils","WAWebProtobufsAdv.pb"],(function(a,b,c,d,e,f,g,h){function a(){var b=babelHelpers.taggedTemplateLiteralLoose(["Clear record to force hosted notification update"]);a=function(){return b};return b}function b(){var a=babelHelpers.taggedTemplateLiteralLoose(["Clear record due to mismatch between local ADV account type and incoming ADV account type of ",""]);b=function(){return a};return a}e=99;function c(a,b,c,e,f,g,h,i){if((g==null?void 0:g.timestamp)!=null&&c<g.timestamp)return null;if(f==null)return null;f=d("WAWebHandleAdvDeviceNotificationUtils").decodeSignedKeyIndexBytes(f,e);if(!f)return null;e=f.rawId;var j=d("WALongInt").numberOrThrowIfTooLarge(f.timestamp),k=null;if(j!==c)return null;c=!1;var l=null;b=b;g&&!g.deleted&&(b==null&&(b=g.devices),g.rawId!==e?c=!0:l=g.devices);var m=new Map(),n=new Set(f.validIndexes),o=f.currentIndex||0;b&&b.forEach(function(a){a.keyIndex!=null&&n.has(a.keyIndex)&&m.set(a.id,a.keyIndex)});l!=null&&l.forEach(function(a){a.keyIndex>o&&m.set(a.id,a.keyIndex)});m.set(d("WAJids").DEFAULT_DEVICE_ID,0);b=Array.from(m.entries()).map(function(a){var b=a[0];a=a[1];return{id:b,keyIndex:a}});l=j;a={id:d("WAWebDeviceListPk").createDeviceListPK(a),rawId:e,timestamp:l,validIndexes:Array.from(n),devices:b,currentIndex:f.currentIndex,deleted:!1,advAccountType:k};!c&&!d("WAWebAdvExpectedTsApi").shouldClearExpectedTs(j,i,g,h)&&(g&&!g.deleted&&(a.expectedTs=g.expectedTs,a.expectedTsLastDeviceJobTs=g.expectedTsLastDeviceJobTs,a.expectedTsUpdateTs=g.expectedTsUpdateTs));return{update:a,clearRecord:c}}g.handleKeyIndexResult=c}),98);
__d("WAWebGroupsParticipantsApi",["WAWebAdvSyncDeviceListApi","WAWebDBGroupParticipant","WAWebDBParticipantTypes","WAWebGroupType","WAWebOfflineDeviceCache","WAWebPnhCagIncognito","WAWebSchemaGroupMetadata","WAWebSchemaParticipant","WAWebUserPrefsMeUser","WAWebWidFactory","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.group,c=a.participants,e=a.isOffline,f=a.groupInfo;a=a.skipDeviceSync;a=a===void 0?!1:a;var g=[];c.forEach(function(a){a.isAdmin&&g.push(a.id)});var h=d("WAWebUserPrefsMeUser").getMaybeMeUser(),i=g.some(function(a){return h&&h.equals(a)}),j=!1;f!=null&&(j=Boolean(f.incognito)&&Boolean(f.defaultSubgroup));j=j?d("WAWebPnhCagIncognito").augmentedCagGroupParticipantList(i,c):c.map(function(a){a=a.id;return a});a?i=j:i=(yield o(j,e));return d("WAWebDBGroupParticipant").replaceParticipants({group:b,participants:c,admins:g,deviceIds:i,groupInfo:f})});return h.apply(this,arguments)}function e(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.group,e=a.participants,f=a.isOffline;a=a.reason;var g=!1,h=b.toString(),i=!1,j=[],k=d("WAWebUserPrefsMeUser").assertGetMeUser(),l=(yield d("WAWebSchemaGroupMetadata").getGroupMetadataTable().get(h));if(l==null)throw c("err")("addParticipants: groupMetadataRecord is null");var m=l.isLidAddressingMode===!0,n=e.some(function(a){return a.id.isLid()});h=(yield d("WAWebSchemaParticipant").getParticipantTable().get(h));h!=null&&(g=Boolean(l.incognito)&&Boolean(l.defaultSubgroup),j=h.admins.map(function(a){return d("WAWebWidFactory").createWid(a)}),i=j.some(function(a){return k&&k.equals(a)})||a===d("WAWebGroupType").ADD_REASON.DEFAULT_SUBGROUP_PROMOTE);if(n&&!g&&!m)return;h=e.map(function(a){a=a.id;return a});g&&(h=a===d("WAWebGroupType").ADD_REASON.DEFAULT_SUBGROUP_PROMOTE?[].concat(j,h,[k]):d("WAWebPnhCagIncognito").augmentedCagGroupParticipantList(i,e));n=(yield o(h,f));return d("WAWebDBGroupParticipant").updateDBParticipants(b,{action:d("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.ADD,participants:e,deviceIds:n},l,f)});return i.apply(this,arguments)}function f(a){var b=a.group,c=a.participants,e=a.timestamp,f=a.author,g=a.reason,h=a.groupMetadata;a=a.isOffline;return d("WAWebDBGroupParticipant").updateDBParticipants(b,{action:d("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.REMOVE,participants:c,timestamp:e,author:f,reason:g},h,a)}function j(a){var b=a.group,c=a.participants,e=a.groupMetadata;a=a.isOffline;return d("WAWebDBGroupParticipant").updateDBParticipants(b,{action:d("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.DEMOTE,participants:c},e,a)}function k(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.group,c=a.participants,e=a.groupMetadata;a=a.isOffline;var f=b.toString(),g=d("WAWebUserPrefsMeUser").assertGetMeUser(),h=c.some(function(a){return g.equals(a.id)}),i;if(h){h=(yield d("WAWebSchemaParticipant").getParticipantTable().get(f));h!=null&&(f=Boolean(e.incognito)&&Boolean(e.defaultSubgroup),f&&(f=h.admins.map(function(a){return d("WAWebWidFactory").createWid(a)}),i=(yield o([].concat(f,[g]),a))))}return d("WAWebDBGroupParticipant").updateDBParticipants(b,{action:d("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.PROMOTE,participants:c,deviceIds:i},e,a)});return l.apply(this,arguments)}function m(a){var b=a.group,c=a.participants;a=a.isOffline;return d("WAWebDBGroupParticipant").updateCommunityParticipants(b,{action:d("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.LINKED_GROUP_PROMOTE,participants:c},a)}function n(a){var b=a.group,c=a.participants;a=a.isOffline;return d("WAWebDBGroupParticipant").updateCommunityParticipants(b,{action:d("WAWebDBParticipantTypes").PARTICIPANT_OPERATION.LINKED_GROUP_DEMOTE,participants:c},a)}function o(a,b){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){b===void 0&&(b=!1);if(b){a.forEach(function(a){d("WAWebOfflineDeviceCache").OfflinePendingDeviceCache.addOfflinePendingDevice(String(a))});return a}b=(yield d("WAWebAdvSyncDeviceListApi").syncAndGetDeviceList(a));var c=[];b.forEach(function(b,e){if(!b)c.push(a[e]);else{var f=b.id;e=b.devices;c=c.concat(e.map(function(a){return d("WAWebWidFactory").createDeviceWidFromDeviceListPk(f,a.id,a.isHosted)}))}});return c});return p.apply(this,arguments)}function q(a){return d("WAWebSchemaParticipant").getParticipantTable().bulkGet(a.map(function(a){return a.toString()}))}function r(a){return d("WAWebSchemaParticipant").getParticipantTable().get(a.toString())}function s(a){a=a==null?void 0:a.participants;if(a==null)return!1;var b=d("WAWebUserPrefsMeUser").getMaybeMeUser();if(b!=null&&a.includes(b.toString()))return!0;b=d("WAWebUserPrefsMeUser").getMaybeMeLidUser();return b!=null&&a.includes(b.toString())?!0:!1}function t(a){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){return s(yield r(a))});return u.apply(this,arguments)}function v(a){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){return(yield q(a)).map(s)});return w.apply(this,arguments)}g.updateParticipants=a;g.addParticipants=e;g.removeParticipants=f;g.demoteParticipants=j;g.promoteParticipants=k;g.promoteCommmunityParticipants=m;g.demoteCommmunityParticipants=n;g.bulkGetParticipants=q;g.getParticipants=r;g.checkMyMembership=t;g.bulkCheckMyMembership=v}),98);
__d("WAWebMessagePluginParseProtobuf",["WALogger","WAWebMessagePluginParseProtobufRegistry","WAWebMultipleMessageParserPluginParseProtobuf"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["parseProtoPlugins: Matched more than 1 plugin types ",""]);h=function(){return a};return a}function a(a){var b=d("WAWebMultipleMessageParserPluginParseProtobuf").parseProtobufWithMultipleMessageParserPlugin(a),e=b.result;b=b.pluginsMatched;for(var f=c("WAWebMessagePluginParseProtobufRegistry"),g=Array.isArray(f),i=0,f=g?f:f[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var j;if(g){if(i>=f.length)break;j=f[i++]}else{i=f.next();if(i.done)break;j=i.value}j=j;j=j(a);if(j!=null){var k;b.push(j.msgData.type+":"+((k=j.msgData.subtype)!=null?k:"null"));e==null&&(e=j)}}if(b.length>1){d("WALogger").ERROR(h(),b.join(",")).sendLogs("parse-protobuf-unexpected-plugin-match");return null}return e}g.parseProtobuf=a}),98);
__d("WAWebEventsGatingUtils",["WAWebABProps","gkx"],(function(a,b,c,d,e,f,g){function h(){return d("WAWebABProps").getABPropConfigValue("events_create")}function a(){return!c("gkx")("26255")&&(d("WAWebABProps").getABPropConfigValue("events_view")||h())}function b(){return d("WAWebABProps").getABPropConfigValue("event_name_length_limit")}function e(){return d("WAWebABProps").getABPropConfigValue("event_description_length_limit")}function f(){return d("WAWebABProps").getABPropConfigValue("event_wa_call_max_days_in_advance")}function i(){return d("WAWebABProps").getABPropConfigValue("events_edit_send")}function j(){return d("WAWebABProps").getABPropConfigValue("events_edit_receive")||i()}g.isEventsCreationEnabled=h;g.isEventsReceivingEnabled=a;g.getEventsNameLengthLimit=b;g.getEventsDescriptionLengthLimit=e;g.getEventsCallLinkMaxDaysInAdvance=f;g.isEventsEditSendingEnabled=i;g.isEventsEditReceivingEnabled=j}),98);
__d("WAWebEventsValidationError",["$InternalEnum","WAWebHandleMsgError"],(function(a,b,c,d,e,f,g){a=b("$InternalEnum")({MISSING_MESSAGE_SECRET:"missing_message_secret",INVALID_MESSAGE_SECRET:"invalid_message_secret",EVENT_CREATION_INVALID_NAME:"event_creation_invalid_name",EVENT_CREATION_INVALID_DESCRIPTION:"event_creation_invalid_description",EVENT_CREATION_INVALID_CANCELED_STATUS:"event_creation_invalid_canceled_status",EVENT_CREATION_MISSING_DATE:"event_creation_missing_date",EVENT_CREATION_INVALID_LOCATION:"event_creation_invalid_location",EVENT_CREATION_MISSING_MESSAGE_SENDER:"event_creation_missing_message_sender"});c=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.name="EventCreationValidationError",b)||babelHelpers.assertThisInitialized(c)}return b}(d("WAWebHandleMsgError").MessageValidationError);e=b("$InternalEnum")({EVENT_RESPONSE_MISSING_MESSAGE_KEY:"event_response_missing_message_key",EVENT_RESPONSE_MISSING_ENC_IV:"event_response_missing_enc_iv",EVENT_RESPONSE_INVALID_SIZE_ENC_IV:"event_response_invalid_size_enc_iv",EVENT_RESPONSE_MISSING_ENC_PAYLOAD:"event_response_missing_enc_payload",EVENT_RESPONSE_MISSING_MESSAGE_SENDER:"event_response_missing_message_sender"});f=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.name="EncryptedEventResponseValidationError",b)||babelHelpers.assertThisInitialized(c)}return b}(d("WAWebHandleMsgError").MessageValidationError);b=b("$InternalEnum")({EVENT_EDIT_MISSING_TARGET_MESSAGE_KEY:"event_edit_missing_target_message_key",EVENT_EDIT_MISSING_ENC_IV:"event_edit_missing_enc_iv",EVENT_EDIT_INVALID_SIZE_ENC_IV:"event_edit_invalid_size_enc_iv",EVENT_EDIT_MISSING_ENC_PAYLOAD:"event_edit_missing_enc_payload",EVENT_EDIT_MISSING_MESSAGE_SENDER:"event_edit_missing_message_sender"});d=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.name="EncryptedEventEditValidationError",b)||babelHelpers.assertThisInitialized(c)}return b}(d("WAWebHandleMsgError").MessageValidationError);g.EventCreationValidationErrorCode=a;g.EventCreationValidationError=c;g.EncryptedEventResponseValidationErrorCode=e;g.EncryptedEventResponseValidationError=f;g.EncryptedEventEditValidationErrorCode=b;g.EncryptedEventEditValidationError=d}),98);
__d("WAWebEventsParseEventCreationMessageProto",["WALongInt","WAWebEventsGatingUtils","WAWebEventsValidationError","WAWebMsgType","WAWebWamEnumE2eFailureReason"],(function(a,b,c,d,e,f,g){function a(a){var b=a.messageProtobuf,c=a.baseMessage;a=a.msgContext;var e=b.eventMessage;if(e==null)return null;if(!d("WAWebEventsGatingUtils").isEventsReceivingEnabled())return{msgData:babelHelpers["extends"]({},c,{type:d("WAWebMsgType").MSG_TYPE.UNKNOWN,kind:d("WAWebMsgType").MsgKind.Unknown,futureproofType:d("WAWebMsgType").MSG_TYPE.EVENT_CREATION}),contextInfo:null};var f=e.contextInfo,g=e.isCanceled,h=e.name,i=e.description,j=e.joinLink,k=e.startTime;e=e.location;k=d("WALongInt").maybeNumberOrThrowIfTooLarge(k);if(h==null||h===""||h.length>d("WAWebEventsGatingUtils").getEventsNameLengthLimit())throw new(d("WAWebEventsValidationError").EventCreationValidationError)(d("WAWebEventsValidationError").EventCreationValidationErrorCode.EVENT_CREATION_INVALID_NAME,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(k==null)throw new(d("WAWebEventsValidationError").EventCreationValidationError)(d("WAWebEventsValidationError").EventCreationValidationErrorCode.EVENT_CREATION_MISSING_DATE,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(a==="quoted"||a==="history_quoted"){a=babelHelpers["extends"]({},c,{type:d("WAWebMsgType").MSG_TYPE.EVENT_CREATION,kind:d("WAWebMsgType").MsgKind.EventCreation,eventName:h,eventStartTime:k,eventDescription:i,eventJoinLink:j,isEventCanceled:Boolean(g),eventLocation:e});return{msgData:a,contextInfo:f}}b=(a=b.messageContextInfo)==null?void 0:a.messageSecret;if(b==null)throw new(d("WAWebEventsValidationError").EventCreationValidationError)(d("WAWebEventsValidationError").EventCreationValidationErrorCode.MISSING_MESSAGE_SECRET,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.MISSING_MESSAGE_SECRET);if(b.byteLength!==32)throw new(d("WAWebEventsValidationError").EventCreationValidationError)(d("WAWebEventsValidationError").EventCreationValidationErrorCode.INVALID_MESSAGE_SECRET,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.MESSAGE_SECRET_INVALID);if(i!=null&&i.length>d("WAWebEventsGatingUtils").getEventsDescriptionLengthLimit())throw new(d("WAWebEventsValidationError").EventCreationValidationError)(d("WAWebEventsValidationError").EventCreationValidationErrorCode.EVENT_CREATION_INVALID_DESCRIPTION,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(g==null)throw new(d("WAWebEventsValidationError").EventCreationValidationError)(d("WAWebEventsValidationError").EventCreationValidationErrorCode.EVENT_CREATION_INVALID_CANCELED_STATUS,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if((e==null?void 0:e.degreesLatitude)==null&&(e==null?void 0:e.degreesLongitude)!=null||(e==null?void 0:e.degreesLatitude)!=null&&(e==null?void 0:e.degreesLongitude)==null)throw new(d("WAWebEventsValidationError").EventCreationValidationError)(d("WAWebEventsValidationError").EventCreationValidationErrorCode.EVENT_CREATION_INVALID_LOCATION,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);a=babelHelpers["extends"]({},c,{type:d("WAWebMsgType").MSG_TYPE.EVENT_CREATION,kind:d("WAWebMsgType").MsgKind.EventCreation,eventName:h,eventDescription:i,eventJoinLink:j,eventStartTime:k,isEventCanceled:Boolean(g),eventLocation:e});return{msgData:a,contextInfo:f}}g["default"]=a}),98);
__d("WAWebEventsParseEventEditEncryptedMessageProto",["WAWebE2EProtoUtils","WAWebEventsGatingUtils","WAWebEventsValidationError","WAWebMsgType","WAWebProtobufsE2E.pb","WAWebWamEnumE2eFailureReason"],(function(a,b,c,d,e,f,g){function a(a){var b=a.messageProtobuf,c=a.baseMessage;a.msgContext;a=b.secretEncryptedMessage;if(a==null||a.secretEncType!==d("WAWebProtobufsE2E.pb").Message$SecretEncryptedMessage$SecretEncType.EVENT_EDIT)return;if(!d("WAWebEventsGatingUtils").isEventsEditReceivingEnabled())return{msgData:babelHelpers["extends"]({},c,{type:d("WAWebMsgType").MSG_TYPE.UNKNOWN,kind:d("WAWebMsgType").MsgKind.Unknown,futureproofType:d("WAWebMsgType").MSG_TYPE.EVENT_EDIT_ENCRYPTED}),contextInfo:null};b=a.targetMessageKey;var e=a.encPayload;a=a.encIv;b=d("WAWebE2EProtoUtils").translateRegularMessageKeyToLocalReference(b,c);if(b==null)throw new(d("WAWebEventsValidationError").EncryptedEventEditValidationError)(d("WAWebEventsValidationError").EncryptedEventEditValidationErrorCode.EVENT_EDIT_MISSING_TARGET_MESSAGE_KEY,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(a==null)throw new(d("WAWebEventsValidationError").EncryptedEventEditValidationError)(d("WAWebEventsValidationError").EncryptedEventEditValidationErrorCode.EVENT_EDIT_MISSING_ENC_IV,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(a.byteLength!==12)throw new(d("WAWebEventsValidationError").EncryptedEventEditValidationError)(d("WAWebEventsValidationError").EncryptedEventEditValidationErrorCode.EVENT_EDIT_INVALID_SIZE_ENC_IV,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(e==null)throw new(d("WAWebEventsValidationError").EncryptedEventEditValidationError)(d("WAWebEventsValidationError").EncryptedEventEditValidationErrorCode.EVENT_EDIT_MISSING_ENC_PAYLOAD,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);return{msgData:babelHelpers["extends"]({},c,{type:d("WAWebMsgType").MSG_TYPE.EVENT_EDIT_ENCRYPTED,kind:d("WAWebMsgType").MsgKind.EventEditEncrypted,encIv:a,encPayload:e,targetMessageKey:b}),contextInfo:null}}g["default"]=a}),98);
__d("WAWebEventsParseEventResponseMessageProto",["WAWebE2EProtoUtils","WAWebEventsGatingUtils","WAWebEventsValidationError","WAWebMsgType","WAWebWamEnumE2eFailureReason"],(function(a,b,c,d,e,f,g){function a(a){var b=a.messageProtobuf;a=a.baseMessage;b=b.encEventResponseMessage;if(b==null)return null;if(!d("WAWebEventsGatingUtils").isEventsReceivingEnabled())return{msgData:babelHelpers["extends"]({},a,{type:d("WAWebMsgType").MSG_TYPE.UNKNOWN,kind:d("WAWebMsgType").MsgKind.Unknown,futureproofType:d("WAWebMsgType").MSG_TYPE.EVENT_RESPONSE}),contextInfo:null};var c=b.eventCreationMessageKey,e=b.encPayload;b=b.encIv;c=d("WAWebE2EProtoUtils").translateRegularMessageKeyToLocalReference(c,a);if(c==null)throw new(d("WAWebEventsValidationError").EncryptedEventResponseValidationError)(d("WAWebEventsValidationError").EncryptedEventResponseValidationErrorCode.EVENT_RESPONSE_MISSING_MESSAGE_KEY,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(b==null)throw new(d("WAWebEventsValidationError").EncryptedEventResponseValidationError)(d("WAWebEventsValidationError").EncryptedEventResponseValidationErrorCode.EVENT_RESPONSE_MISSING_ENC_IV,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(b.byteLength!==12)throw new(d("WAWebEventsValidationError").EncryptedEventResponseValidationError)(d("WAWebEventsValidationError").EncryptedEventResponseValidationErrorCode.EVENT_RESPONSE_INVALID_SIZE_ENC_IV,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(e==null)throw new(d("WAWebEventsValidationError").EncryptedEventResponseValidationError)(d("WAWebEventsValidationError").EncryptedEventResponseValidationErrorCode.EVENT_RESPONSE_MISSING_ENC_PAYLOAD,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);return{msgData:babelHelpers["extends"]({},a,{type:d("WAWebMsgType").MSG_TYPE.EVENT_RESPONSE,kind:d("WAWebMsgType").MsgKind.EventResponseEncrypted,addonEncrypted:!0,encIv:b,encPayload:e,targetMessageKey:c}),contextInfo:null}}g["default"]=a}),98);
__d("WAWebBizContentPlaceholderMsgData.flow",["$InternalEnum"],(function(a,b,c,d,e,f,g){a=b("$InternalEnum")({MASK_LINKED_DEVICES:0});g.BizContentPlaceholderType=a}),98);
__d("WAWebParseBizContentPlaceholderProto",["WAWebBizContentPlaceholderMsgData.flow","WAWebMsgType","WAWebProtobufsE2E.pb"],(function(a,b,c,d,e,f,g){function a(a){var b=a.messageProtobuf;a=a.baseMessage;b=b.placeholderMessage;if(b==null||b.type==null)return;b=h(b.type);return{msgData:babelHelpers["extends"]({},a,{type:d("WAWebMsgType").MSG_TYPE.BIZ_CONTENT_PLACEHOLDER,kind:d("WAWebMsgType").MsgKind.BizContentPlaceholder,bizContentPlaceholderType:b}),contextInfo:void 0}}function h(a){switch(a){case d("WAWebProtobufsE2E.pb").Message$PlaceholderMessage$PlaceholderType.MASK_LINKED_DEVICES:return d("WAWebBizContentPlaceholderMsgData.flow").BizContentPlaceholderType.MASK_LINKED_DEVICES}}g["default"]=a}),98);
__d("WAWebParseBotFeedbackProtocolMessageProto",["WAWebBotTypes","WAWebE2EProtoUtils","WAWebMsgType","WAWebProtobufsE2E.pb"],(function(a,b,c,d,e,f,g){function a(a){var b=a.messageProtobuf;a=a.baseMessage;b=b.protocolMessage;if(b==null)return;var c=b.type;b=b.botFeedbackMessage;if(c!==d("WAWebProtobufsE2E.pb").Message$ProtocolMessage$Type.BOT_FEEDBACK_MESSAGE)return;if(b==null)return;c=b.messageKey;var e=b.kind;b=b.text;if(c==null)return;if(e==null)return;var f;switch(e){case d("WAWebProtobufsE2E.pb").Message$BotFeedbackMessage$BotFeedbackKind.BOT_FEEDBACK_POSITIVE:f=d("WAWebBotTypes").BotFeedbackKind.POSITIVE;break;case d("WAWebProtobufsE2E.pb").Message$BotFeedbackMessage$BotFeedbackKind.BOT_FEEDBACK_NEGATIVE_GENERIC:f=d("WAWebBotTypes").BotFeedbackKind.NEGATIVE_GENERIC;break;case d("WAWebProtobufsE2E.pb").Message$BotFeedbackMessage$BotFeedbackKind.BOT_FEEDBACK_NEGATIVE_HELPFUL:f=d("WAWebBotTypes").BotFeedbackKind.NEGATIVE_HELPFUL;break;case d("WAWebProtobufsE2E.pb").Message$BotFeedbackMessage$BotFeedbackKind.BOT_FEEDBACK_NEGATIVE_INTERESTING:f=d("WAWebBotTypes").BotFeedbackKind.NEGATIVE_INTERESTING;break;case d("WAWebProtobufsE2E.pb").Message$BotFeedbackMessage$BotFeedbackKind.BOT_FEEDBACK_NEGATIVE_ACCURATE:f=d("WAWebBotTypes").BotFeedbackKind.NEGATIVE_ACCURATE;break;case d("WAWebProtobufsE2E.pb").Message$BotFeedbackMessage$BotFeedbackKind.BOT_FEEDBACK_NEGATIVE_SAFE:f=d("WAWebBotTypes").BotFeedbackKind.NEGATIVE_SAFE;break;case d("WAWebProtobufsE2E.pb").Message$BotFeedbackMessage$BotFeedbackKind.BOT_FEEDBACK_NEGATIVE_OTHER:f=d("WAWebBotTypes").BotFeedbackKind.NEGATIVE_OTHER;break;case d("WAWebProtobufsE2E.pb").Message$BotFeedbackMessage$BotFeedbackKind.BOT_FEEDBACK_NEGATIVE_REFUSED:f=d("WAWebBotTypes").BotFeedbackKind.NEGATIVE_REFUSED;break;case d("WAWebProtobufsE2E.pb").Message$BotFeedbackMessage$BotFeedbackKind.BOT_FEEDBACK_NEGATIVE_NOT_VISUALLY_APPEALING:f=d("WAWebBotTypes").BotFeedbackKind.NEGATIVE_NOT_VISUALLY_APPEALING;break;case d("WAWebProtobufsE2E.pb").Message$BotFeedbackMessage$BotFeedbackKind.BOT_FEEDBACK_NEGATIVE_NOT_RELEVANT_TO_TEXT:f=d("WAWebBotTypes").BotFeedbackKind.NEGATIVE_NOT_RELEVANT_TO_TEXT;break}if(f==null)return;return{msgData:babelHelpers["extends"]({},a,{type:d("WAWebMsgType").MSG_TYPE.PROTOCOL,kind:d("WAWebMsgType").MsgKind.Protocol,subtype:"bot_feedback",protocolMessageKey:d("WAWebE2EProtoUtils").translateRegularMessageKeyToLocalReference(c,a),botFeedbackKind:f,botFeedbackText:b}),contextInfo:null}}g["default"]=a}),98);
__d("WAWebParseBotRequestWelcomeMessageProto",["WAWebMsgType","WAWebProtobufsE2E.pb"],(function(a,b,c,d,e,f,g){function a(a){var b=a.messageProtobuf;a=a.baseMessage;if(((b=b.protocolMessage)==null?void 0:b.type)!==d("WAWebProtobufsE2E.pb").Message$ProtocolMessage$Type.REQUEST_WELCOME_MESSAGE)return;return{msgData:babelHelpers["extends"]({},a,{type:d("WAWebMsgType").MSG_TYPE.PROTOCOL,kind:d("WAWebMsgType").MsgKind.Protocol,subtype:"bot_request_welcome"}),contextInfo:null}}g["default"]=a}),98);
__d("WAWebParseButtonsResponseMessageProto",["WAWebE2EProtoUtils","WAWebMsgType","WAWebProtobufsE2E.pb"],(function(a,b,c,d,e,f,g){function a(a){var b=a.messageProtobuf;a=a.baseMessage;b=b.buttonsResponseMessage;if(b==null)return;if(b.type===d("WAWebProtobufsE2E.pb").Message$ButtonsResponseMessage$Type.DISPLAY_TEXT){var c=babelHelpers["extends"]({},a,{type:d("WAWebMsgType").MSG_TYPE.BUTTONS_RESPONSE,kind:d("WAWebMsgType").MsgKind.ButtonsResponse,selectedButtonId:b.selectedButtonId,body:d("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis(b.selectedDisplayText)});return{msgData:c,contextInfo:b.contextInfo}}return{msgData:babelHelpers["extends"]({},a,{type:d("WAWebMsgType").MSG_TYPE.UNKNOWN,kind:d("WAWebMsgType").MsgKind.Unknown}),contextInfo:b.contextInfo}}g["default"]=a}),98);
__d("WAWebParseCancelPaymentMessageProto",["WAWebE2EProtoUtils","WAWebMsgKey","WAWebMsgType","WAWebUserPrefsMeUser","err"],(function(a,b,c,d,e,f,g){function a(a){var b=a.messageProtobuf;a=a.baseMessage;b=b.cancelPaymentRequestMessage;if(b==null)return;b=b.key;if(b==null)return;b=h(b,a);return{msgData:babelHelpers["extends"]({},a,{type:d("WAWebMsgType").MSG_TYPE.UNKNOWN,kind:d("WAWebMsgType").MsgKind.Unknown,subtype:"payment_transaction_request_cancelled",paymentRequestMessageKey:b}),contextInfo:null}}function h(a,b){if(!a)throw c("err")("parseProtocolMessageProto: no message key is defined for cancel payment request message");var e=a.id;if(!e)throw c("err")("parseProtocolMessageProto: no message id is defined for cancel payment request message");var f=void 0;if(b.id.remote.isGroup()){f=b.id.participant;if(b.id.fromMe)f=d("WAWebE2EProtoUtils").decodeJid(b.from);else if(!((a=d("WAWebE2EProtoUtils").decodeJid(a.participant))==null?void 0:a.equals(d("WAWebUserPrefsMeUser").getMeUser())))return null}a=new(c("WAWebMsgKey"))({id:e,fromMe:b.id.fromMe,remote:b.id.remote,participant:f});return a}g["default"]=a}),98);
__d("WAWebMmsMediaTypes",["WAWebInteractiveMessageHeaderMediaType","WAWebMsgGetters","WAWebMsgType","err","lodash"],(function(a,b,c,d,e,f,g){var h=Object.freeze({AUDIO:"audio",DOCUMENT:"document",GIF:"gif",IMAGE:"image",NATIVE_FLOW:"native_flow",PPIC:"ppic",PRODUCT:"product",PTT:"ptt",STICKER:"sticker",VIDEO:"video",PTV:"ptv",TEMPLATE:"template",THUMBNAIL_DOCUMENT:"thumbnail-document",THUMBNAIL_IMAGE:"thumbnail-image",THUMBNAIL_VIDEO:"thumbnail-video",THUMBNAIL_LINK:"thumbnail-link",HISTORY_SYNC:"md-msg-hist",MD_APP_STATE:"md-app-state",PRODUCT_CATALOG_IMAGE:"product-catalog-image",PAYMENT_BG_IMAGE:"payment-bg-image",BIZ_COVER_PHOTO:"biz-cover-photo",PREVIEW:"preview",NEWSLETTER_AUDIO:"newsletter-audio",NEWSLETTER_DOCUMENT:"newsletter-document",NEWSLETTER_IMAGE:"newsletter-image",NEWSLETTER_GIF:"newsletter-gif",NEWSLETTER_PTT:"newsletter-ptt",NEWSLETTER_STICKER:"newsletter-sticker",NEWSLETTER_THUMBNAIL_LINK:"newsletter-thumbnail-link",NEWSLETTER_VIDEO:"newsletter-video"});e=c("lodash").values(h);function a(a){var b;if(a==null)b=h.DOCUMENT;else if(a in h)b=h[a];else throw c("err")("castToV4: unexpected mmsv3 type "+a);return b}function i(a){var b=a.type,e=a.isGif,f=a.interactiveHeader;a=a.isNewsletter;switch(b){case d("WAWebMsgType").MSG_TYPE.IMAGE:return a?h.NEWSLETTER_IMAGE:h.IMAGE;case d("WAWebMsgType").MSG_TYPE.VIDEO:return a?e===!0?h.NEWSLETTER_GIF:h.NEWSLETTER_VIDEO:e===!0?h.GIF:h.VIDEO;case d("WAWebMsgType").MSG_TYPE.AUDIO:return a?h.NEWSLETTER_AUDIO:h.AUDIO;case d("WAWebMsgType").MSG_TYPE.PTT:return a?h.NEWSLETTER_PTT:h.PTT;case d("WAWebMsgType").MSG_TYPE.PTV:return h.PTV;case d("WAWebMsgType").MSG_TYPE.DOCUMENT:return h.DOCUMENT;case d("WAWebMsgType").MSG_TYPE.STICKER:return a?h.NEWSLETTER_STICKER:h.STICKER;case d("WAWebMsgType").MSG_TYPE.PRODUCT:return h.PRODUCT;case d("WAWebMsgType").MSG_TYPE.NATIVE_FLOW:return h.NATIVE_FLOW;case d("WAWebMsgType").MSG_TYPE.INTERACTIVE:if((f==null?void 0:f.mediaType)!=null)switch(f.mediaType){case d("WAWebInteractiveMessageHeaderMediaType").InteractiveMessageHeaderMediaType.DOCUMENT:return h.DOCUMENT;case d("WAWebInteractiveMessageHeaderMediaType").InteractiveMessageHeaderMediaType.VIDEO:return h.VIDEO;case d("WAWebInteractiveMessageHeaderMediaType").InteractiveMessageHeaderMediaType.IMAGE:return h.IMAGE}break}throw c("err")("msg is not a media msg: "+b+", isGif="+String(e))}function b(a){return i({type:a.type,interactiveHeader:a.interactiveHeader,isGif:a.type===d("WAWebMsgType").MSG_TYPE.VIDEO?a.isGif:!1,isNewsletter:d("WAWebMsgGetters").getIsNewsletterMsg(a)})}g.MEDIA_TYPES=h;g.MEDIA_TYPE_VALUES=e;g.castToV4=a;g.msgToMediaType=i;g.getMsgMediaType=b}),98);
__d("WAWebMediaCryptoEligibilityUtils",["WAWebMmsMediaTypes","WAWebMsgGetters"],(function(a,b,c,d,e,f,g){function a(a){return a.isNewsletter?!1:!0}function b(a){return d("WAWebMsgGetters").getIsNewsletterMsg(a)?!1:!0}var h=new Set([(f=d("WAWebMmsMediaTypes")).MEDIA_TYPES.NEWSLETTER_AUDIO,f.MEDIA_TYPES.NEWSLETTER_DOCUMENT,f.MEDIA_TYPES.NEWSLETTER_GIF,f.MEDIA_TYPES.NEWSLETTER_IMAGE,f.MEDIA_TYPES.NEWSLETTER_PTT,f.MEDIA_TYPES.NEWSLETTER_STICKER,f.MEDIA_TYPES.NEWSLETTER_THUMBNAIL_LINK,f.MEDIA_TYPES.NEWSLETTER_VIDEO]);function i(a){return h.has(a)}function c(a){return i(a)?!1:!0}function e(a){return i(a)?!1:!0}g.isMediaCryptoExpectedForChat=a;g.isMediaCryptoExpectedForMsg=b;g.isMediaCryptoExpectedForMediaType=c;g.isRmrSupportedForMediaType=e}),98);
__d("WAWebE2EProtoParserApi",["WABase64","WALogger","WAWebGroupType","WAWebMediaCryptoEligibilityUtils","WAWebProtobufsE2E.pb","WAWebWid","gkx"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["mediaKey is missing from msg type ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["url(deprecatedMms3Url) is missing from msg type ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["fileEncSha256 missing from msg type ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["directPath missing from msg type ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["directPath and fileEncSha256 missing from msg type ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["directPath missing from msg type ",""]);m=function(){return a};return a}function a(a){switch(a){case d("WAWebProtobufsE2E.pb").Message$ExtendedTextMessage$InviteLinkGroupType.PARENT:return d("WAWebGroupType").GroupType.COMMUNITY;case d("WAWebProtobufsE2E.pb").Message$ExtendedTextMessage$InviteLinkGroupType.SUB:return d("WAWebGroupType").GroupType.LINKED_SUBGROUP;case d("WAWebProtobufsE2E.pb").Message$ExtendedTextMessage$InviteLinkGroupType.DEFAULT_SUB:return d("WAWebGroupType").GroupType.LINKED_ANNOUNCEMENT_GROUP;default:return d("WAWebGroupType").GroupType.DEFAULT}}function b(a){return a&&!a.includes("/u/")?a:void 0}function e(a){return a?d("WABase64").encodeB64(a):void 0}function f(a,b){if(!n(a,b))return;var c=a.type;if(!d("WAWebMediaCryptoEligibilityUtils").isMediaCryptoExpectedForMsg(a)){b.directPath==null&&d("WALogger").LOG(m(),c).sendLogs(c+"-unencrypted-message-missing-direct-path");return}b.directPath==null&&b.fileEncSha256==null?d("WALogger").LOG(l(),c).sendLogs(c+"-message-missing-direct-path-and-file-enc"):b.directPath==null?d("WALogger").LOG(k(),c).sendLogs(c+"-message-missing-direct-path"):b.fileEncSha256==null&&d("WALogger").LOG(j(),c).sendLogs(c+"-message-missing-file-enc");b.url==null&&d("WALogger").LOG(i(),c).sendLogs(c+"-message-missing-mms3-url");b.mediaKey==null&&d("WALogger").LOG(h(),c).sendLogs(c+"-message-missing-media-key")}function n(a,b){var d;if(c("gkx")("26258")&&Math.random()>.001)return!1;if(!a.id)return!1;return((d=a.id.remote)==null?void 0:d.user)==="status"&&c("WAWebWid").isPSA(a.author)&&b.staticUrl==null?!1:!0}g.parseInviteGrpType=a;g.decodeUrl=b;g.decodeBytes=e;g.validateRequiredMediaProperties=f;g.shouldLogE2eProtoValidation=n}),98);
__d("WAWebParseExtendedTextMessageProtoUtils",["WALongInt","WAWebE2EProtoParserApi","WAWebE2EProtoUtils","WAWebMsgType","WAWebProtobufsE2E.pb"],(function(a,b,c,d,e,f,g){function a(a){return Boolean(a==null?void 0:a.matchedText)||Boolean(a==null?void 0:a.canonicalUrl)||Boolean(a==null?void 0:a.description)||Boolean(a==null?void 0:a.title)}function b(a){var b=a.messageProtobuf;a=a.baseMessage;b=b.extendedTextMessage;if(b==null)return;var c=d("WAWebProtobufsE2E.pb").Message$ExtendedTextMessage$FontType,e;if((b==null?void 0:b.font)!=null)switch(b.font){case c.SYSTEM:case c.SYSTEM_TEXT:case c.FB_SCRIPT:case c.SYSTEM_BOLD:case c.MORNINGBREEZE_REGULAR:case c.CALISTOGA_REGULAR:case c.EXO2_EXTRABOLD:case c.COURIERPRIME_BOLD:e=b.font;break}c=babelHelpers["extends"]({},a,{type:d("WAWebMsgType").MSG_TYPE.CHAT,kind:d("WAWebMsgType").MsgKind.Chat,body:d("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis((b==null?void 0:b.text)||""),matchedText:b==null?void 0:b.matchedText,description:b==null?void 0:b.description,title:b==null?void 0:b.title,thumbnail:d("WAWebE2EProtoParserApi").decodeBytes(b==null?void 0:b.jpegThumbnail)||"",richPreviewType:b==null?void 0:b.previewType,doNotPlayInline:b==null?void 0:b.doNotPlayInline,textColor:b==null?void 0:b.textArgb,backgroundColor:b==null?void 0:b.backgroundArgb,mediaKey:d("WAWebE2EProtoParserApi").decodeBytes(b==null?void 0:b.mediaKey),mediaKeyTimestamp:(b==null?void 0:b.mediaKeyTimestamp)!=null?d("WALongInt").numberOrThrowIfTooLarge(b.mediaKeyTimestamp):a.mediaKeyTimestamp,thumbnailDirectPath:b==null?void 0:b.thumbnailDirectPath,thumbnailSha256:d("WAWebE2EProtoParserApi").decodeBytes(b==null?void 0:b.thumbnailSha256),thumbnailEncSha256:d("WAWebE2EProtoParserApi").decodeBytes(b==null?void 0:b.thumbnailEncSha256),thumbnailHeight:b==null?void 0:b.thumbnailHeight,thumbnailWidth:b==null?void 0:b.thumbnailWidth,inviteGrpType:(b==null?void 0:b.inviteLinkGroupTypeV2)!=null?d("WAWebE2EProtoParserApi").parseInviteGrpType(b==null?void 0:b.inviteLinkGroupTypeV2):a.inviteGrpType,font:e!=null?e:a.font});return{msgData:c,contextInfo:b==null?void 0:b.contextInfo}}g.isUrlExtendedTextMessage=a;g.parseExtendedTextMessageProto=b}),98);
__d("WAWebParseChatMessageProto",["WAWebE2EProtoUtils","WAWebMsgType","WAWebParseExtendedTextMessageProtoUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=a.messageProtobuf,c=a.baseMessage;a=a.msgContext;var e=b.conversation,f=b.extendedTextMessage;if(e==null&&f==null)return;if(e!=null)return{msgData:babelHelpers["extends"]({},c,{type:d("WAWebMsgType").MSG_TYPE.CHAT,kind:d("WAWebMsgType").MsgKind.Chat,body:d("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis(e)}),contextInfo:void 0};if(d("WAWebParseExtendedTextMessageProtoUtils").isUrlExtendedTextMessage(f))return;return d("WAWebParseExtendedTextMessageProtoUtils").parseExtendedTextMessageProto({messageProtobuf:b,baseMessage:c,msgContext:a})}g["default"]=a}),98);
__d("WAWebParseDeclinePaymentMessageProto",["WAWebE2EProtoUtils","WAWebMsgKey","WAWebMsgType","WAWebUserPrefsMeUser","err"],(function(a,b,c,d,e,f,g){function a(a){var b=a.messageProtobuf;a=a.baseMessage;b=b.declinePaymentRequestMessage;if(b==null)return;b=h(b.key,a);return{msgData:babelHelpers["extends"]({},a,{type:"unknown",kind:d("WAWebMsgType").MsgKind.Unknown,subtype:"payment_action_request_declined",paymentRequestMessageKey:b}),contextInfo:null}}function h(a,b){if(!a)throw c("err")("parseProtocolMessageProto: no message key is defined for decline payment request message");var e=a.id;if(!e)throw c("err")("parseProtocolMessageProto: no message id is defined for decline payment request message");var f;if(b.id.remote.isGroup()){var g;if(b.id.fromMe||((g=d("WAWebE2EProtoUtils").decodeJid(a.participant))==null?void 0:g.equals(d("WAWebUserPrefsMeUser").getMeUser()))||b.subtype==="send")f=d("WAWebE2EProtoUtils").decodeJid(a.participant);else return null}g=new(c("WAWebMsgKey"))({fromMe:!b.id.fromMe,remote:b.id.remote,id:e,participant:f});return g}g["default"]=a}),98);
__d("WAWebMediaCleanFileName",["WALogger"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["cleanIncomingFilename:extension: ",""]);h=function(){return a};return a}function i(a){if(!a)return a;a=a.replace(/[\u202a-\u202e\u2066-\u2069\u200E\u200F\u061C]/g,"\ufffd");var b=a.split(".");if(b.length===1)return a;for(var c=b.length-1;c>0;c--){var d=b[c].trim();if(d.length)return b.slice(0,c).join(".")+"."+d}return a}function a(a){if(!a)return a;var b=i(a);if(a!==b&&b){a=["bat","exe","cmd","com","lnk","pif","scr","vb","vbe","vbs","wsh","js","ps1","hta","sh","csh","msi","app","scpt","applescript","reg","vbe","wsf","sct"];var c=b.split(".");c=c.length>=2&&c.pop();a.includes(c)&&d("WALogger").LOG(h(),c||"").verbose()}return b}g.cleanFilename=i;g.cleanIncomingFilename=a}),98);
__d("WAWebLottieStickersGatingUtils",["WAWebABProps"],(function(a,b,c,d,e,f,g){function a(){return d("WAWebABProps").getABPropConfigValue("gimmick_phase_two_receiver_enabled")}function b(){return d("WAWebABProps").getABPropConfigValue("gimmick_phase_two_sender_enabled")}g.isLottieStickerReceivingEnabled=a;g.isLottieStickerSendingEnabled=b}),98);
__d("WAWebStickerMimeUtils",["WAWebLottieStickersGatingUtils"],(function(a,b,c,d,e,f,g){var h="application/was",i="image/webp";function a(){return d("WAWebLottieStickersGatingUtils").isLottieStickerReceivingEnabled()?new Set([i,h]):new Set([i])}g.WhatsAppLottieStickerMimeType=h;g.getValidStickerMimeTypes=a}),98);
__d("WAWebMediaMessageGetValidatedProperties",["$InternalEnum","WALogger","WALongInt","WAWebABProps","WAWebHandleMsgError","WAWebMsgType","WAWebNewsletterIsNewsletterMsg","WAWebStickerMimeUtils","WAWebURLUtils","WAWebWamEnumE2eFailureReason"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Invalid file length "," with a type "," for "," message"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unexpected "," for "," message"]);i=function(){return a};return a}var j=b("$InternalEnum")({MISSING_MEDIA_KEY:"missing_media_key",INVALID_SHA256:"invalid_sha256",INVALID_ENC_SHA256:"invalid_enc_sha256",INVALID_URL:"invalid_url",INVALID_MIME_TYPE:"invalid_mime_type",INVALID_MEDIA_KEY:"invalid_media_key",INVALID_FILE_LENGTH:"invalid_file_length"}),k=function(b){babelHelpers.inheritsLoose(a,b);function a(a,c,d,e){c=String(c)+" for "+a+" message";a=b.call(this,c,d,e)||this;a.name="MediaMessageValidationError";return a}return a}(d("WAWebHandleMsgError").MessageValidationError),l="audio/ogg; codecs=opus",m="audio/mp4",n="audio/mpeg",o="audio/aac",p="audio/amr",q="image/jpeg",r="image/png",s="image/webp",t="video/mp4",u="video/3gpp",v="video/",w="image/";function a(a){return a.startsWith(v)||a.startsWith(w)}function x(a){var b,c;c=(b={},b[(c=d("WAWebMsgType")).MSG_TYPE.IMAGE]=new Set([q,r,s]),b[c.MSG_TYPE.STICKER]=d("WAWebStickerMimeUtils").getValidStickerMimeTypes(),b[c.MSG_TYPE.VIDEO]=new Set([t,u]),b[c.MSG_TYPE.AUDIO]=new Set([l,m,n,o,p]),b[c.MSG_TYPE.PTT]=new Set([l,m,n,o,p]),b);return c[a]}function y(){return d("WAWebABProps").getABPropConfigValue("web_invalid_media_message_validation")}function z(a){a=c("WAWebURLUtils").hostname(a);return a.endsWith(".whatsapp.net")||a==="whatsapp.net"}var A=function(a){return a.id==null};function e(a,b,e,f){var g=a.mediaKey,l=a.fileSha256,m=a.fileEncSha256,n=a.fileLength,o=a.url;a=a.mimetype;var p;e==="relay"?p=d("WAWebHandleMsgError").isMessageDropValidationEnabled(e)&&y():p=d("WAWebHandleMsgError").isMessageDropValidationEnabled(e);if(!p){return{mediaKey:g,fileSha256:l,fileEncSha256:m,fileLength:d("WALongInt").numberOrThrowIfTooLarge((e=n)!=null?e:0),url:o,mimetype:a}}if(A(b)){return{mediaKey:g,fileSha256:l,fileEncSha256:m,fileLength:d("WALongInt").numberOrThrowIfTooLarge((p=n)!=null?p:0),url:o,mimetype:a}}if(!c("WAWebNewsletterIsNewsletterMsg")({from:b.from,to:b.to})){if(g==null)throw new k(f,j.MISSING_MEDIA_KEY,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_IMAGE_MEDIA_KEY);if(g.byteLength!==32)throw new k(f,j.INVALID_MEDIA_KEY,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_IMAGE_MEDIA_KEY);if(m!=null&&m.byteLength!==32)throw new k(f,j.INVALID_ENC_SHA256,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_IMAGE_FILE_SHA256)}if((l==null?void 0:l.byteLength)!==32)throw new k(f,j.INVALID_SHA256,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_IMAGE_FILE_SHA256);if(o!=null&&(!c("WAWebURLUtils").isHttps(o)||!z(o)))throw new k(f,j.INVALID_URL,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_IMAGE_MEDIA_URL);if(a==null)throw new k(f,j.INVALID_MIME_TYPE,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_IMAGE_MIME_TYPE);if(d("WAWebABProps").getABPropConfigValue("web_validate_media_mime_type")){e=x(f);if(e!=null&&!e.has(a)){d("WALogger").LOG(i(),a,f);throw new k(f,j.INVALID_MIME_TYPE,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_IMAGE_MIME_TYPE)}}var q;f===d("WAWebMsgType").MSG_TYPE.STICKER?n!=null?(q=d("WALongInt").numberOrThrowIfTooLarge(n),p=q>=0):p=!0:f===d("WAWebMsgType").MSG_TYPE.DOCUMENT?n==null?p=!1:(q=d("WALongInt").numberOrThrowIfTooLarge(n),p=q>=0):n==null?p=!1:(q=d("WALongInt").numberOrThrowIfTooLarge(n),p=q>0);if(!p){d("WALogger").LOG(h(),n,typeof n,f);throw new k(f,j.INVALID_FILE_LENGTH,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_IMAGE_FILE_LENGTH)}return{mediaKey:g,fileSha256:l,fileEncSha256:m,fileLength:q,url:o,mimetype:a}}function f(a){var b;if(a==null||!((b=x(d("WAWebMsgType").MSG_TYPE.IMAGE))==null?void 0:b.has(a)))throw new k(d("WAWebMsgType").MSG_TYPE.IMAGE,j.INVALID_MIME_TYPE,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_IMAGE_MIME_TYPE)}g.MediaMessageValidationError=k;g.isMediaMimeType=a;g.getValidMimeTypes=x;g.isMediaMessageValidationEnabled=y;g.isWhatsAppSubdomain=z;g.getValidatedMediaMessageProperties=e;g.validateImageMimetype=f}),98);
__d("WAWebParseDocumentMessageProto",["WALongInt","WATimeUtils","WAWebE2EProtoParserApi","WAWebE2EProtoUtils","WAWebMediaCleanFileName","WAWebMediaMessageGetValidatedProperties","WAWebMsgType","WAWebServerPropConstants"],(function(a,b,c,d,e,f,g){function a(a){var b=a.messageProtobuf,c=a.baseMessage;a=a.msgContext;b=b.documentMessage;if(b==null)return;a=d("WAWebMediaMessageGetValidatedProperties").getValidatedMediaMessageProperties(b,c,a,d("WAWebMsgType").MSG_TYPE.DOCUMENT);var e=a.mediaKey,f=a.fileSha256,g=a.fileEncSha256,h=a.fileLength;h=h===void 0?0:h;a=a.url;var i=d("WAWebMediaCleanFileName").cleanIncomingFilename(b.fileName||b.title),j=b.caption!=null&&b.caption!=="",k=j?d("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis(b.caption):i;c=babelHelpers["extends"]({},c,{type:d("WAWebMsgType").MSG_TYPE.DOCUMENT,kind:d("WAWebMsgType").MsgKind.Document,deprecatedMms3Url:d("WAWebE2EProtoParserApi").decodeUrl(a),directPath:b.directPath,mimetype:b.mimetype,filehash:d("WAWebE2EProtoParserApi").decodeBytes(f),encFilehash:d("WAWebE2EProtoParserApi").decodeBytes(g),size:h,pageCount:b.pageCount||0,mediaKey:d("WAWebE2EProtoParserApi").decodeBytes(e),mediaKeyTimestamp:b.mediaKeyTimestamp!=null?d("WALongInt").numberOrThrowIfTooLarge(b.mediaKeyTimestamp):d("WATimeUtils").unixTime(),filename:i,isCaptionByUser:j,caption:k,body:d("WAWebE2EProtoParserApi").decodeBytes(b.jpegThumbnail)||"",isVcardOverMmsDocument:Boolean(b.contactVcard)&&h<=d("WAWebServerPropConstants").VCARD_MAX_SIZE_KB*1024,thumbnailDirectPath:b.thumbnailDirectPath,thumbnailSha256:d("WAWebE2EProtoParserApi").decodeBytes(b.thumbnailSha256),thumbnailEncSha256:d("WAWebE2EProtoParserApi").decodeBytes(b.thumbnailEncSha256),thumbnailHeight:b.thumbnailHeight,thumbnailWidth:b.thumbnailWidth});return{msgData:c,contextInfo:b.contextInfo}}g["default"]=a}),98);
__d("WAWebCommentMessageValidationError",["$InternalEnum","WAWebHandleMsgError"],(function(a,b,c,d,e,f,g){a=b("$InternalEnum")({MISSING_COMMENT_ENC_IV:"comment_missing_enc_iv",MISSING_COMMENT_ENC_PAYLOAD:"comment_missing_enc_payload",MISSING_COMMENT_MESSAGE_KEY:"comment_missing_target_message_key",INVALID_COMMENT_ENC_IV:"comment_invalid_enc_iv",MISSING_COMMENT_SENDER:"comment_missing_sender",MISSING_MESSAGE_SECRET:"comment_missing_message_secret",MISSING_ORIGINAL_MESSAGE_SENDER:"comment_missing_original_message_sender",MISSING_COMMENT_CONTENT:"comment_missing_comment_content"});c=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.name="CommentMessageValidationError",b)||babelHelpers.assertThisInitialized(c)}return b}(d("WAWebHandleMsgError").MessageValidationError);g.CommentMessageValidationErrorCode=a;g.CommentMessageValidationError=c}),98);
__d("WAWebParseEncCommentMessageProto",["WAWebCommentMessageValidationError","WAWebCommunityGatingUtils","WAWebE2EProtoUtils","WAWebMsgType","WAWebWamEnumE2eFailureReason"],(function(a,b,c,d,e,f,g){function a(a){var b=a.messageProtobuf;a=a.baseMessage;b=b.encCommentMessage;if(b==null)return;if(!d("WAWebCommunityGatingUtils").isCommentMessageReceiverEnabled())return{msgData:babelHelpers["extends"]({},a,{type:d("WAWebMsgType").MSG_TYPE.UNKNOWN,kind:d("WAWebMsgType").MsgKind.Unknown,futureproofType:d("WAWebMsgType").MSG_TYPE.COMMENT}),contextInfo:null};var c=b.encIv,e=b.encPayload;b=b.targetMessageKey;if(c==null)throw new(d("WAWebCommentMessageValidationError").CommentMessageValidationError)(d("WAWebCommentMessageValidationError").CommentMessageValidationErrorCode.MISSING_COMMENT_ENC_IV,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(e==null)throw new(d("WAWebCommentMessageValidationError").CommentMessageValidationError)(d("WAWebCommentMessageValidationError").CommentMessageValidationErrorCode.MISSING_COMMENT_ENC_PAYLOAD,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);b=d("WAWebE2EProtoUtils").translateRegularMessageKeyToLocalReference(b,a);if(b==null)throw new(d("WAWebCommentMessageValidationError").CommentMessageValidationError)(d("WAWebCommentMessageValidationError").CommentMessageValidationErrorCode.MISSING_COMMENT_MESSAGE_KEY,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(c.byteLength!==12)throw new(d("WAWebCommentMessageValidationError").CommentMessageValidationError)(d("WAWebCommentMessageValidationError").CommentMessageValidationErrorCode.INVALID_COMMENT_ENC_IV,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);return{msgData:babelHelpers["extends"]({},a,{type:d("WAWebMsgType").MSG_TYPE.COMMENT,kind:d("WAWebMsgType").MsgKind.CommentEncrypted,addonEncrypted:!0,encIv:c,encPayload:e,targetMessageKey:b}),contextInfo:null}}g["default"]=a}),98);
__d("WAWebParseEphemeralSyncResponseMessageProto",["WALogger","WALongInt","WANullthrows","WAWebE2EProtoUtils","WAWebMsgType","WAWebProtobufsE2E.pb"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["EPHEMERAL_SYNC_RESPONSE msg does not contain all fields"]);h=function(){return a};return a}function a(a){var b=a.messageProtobuf,e=a.baseMessage;a=a.msgContext;b=b.protocolMessage;if(b==null||a!=="relay"||b.type!==d("WAWebProtobufsE2E.pb").Message$ProtocolMessage$Type.EPHEMERAL_SYNC_RESPONSE)return;a=b.ephemeralExpiration;var f=b.ephemeralSettingTimestamp,g=b.disappearingMode;if(a==null||f==null||g==null){d("WALogger").WARN(h()).devConsole({protocolMessage:b});return}var i;b.disappearingMode!=null&&(i=d("WAWebE2EProtoUtils").protoToDisappearingMode(b,b.disappearingMode));return{msgData:babelHelpers["extends"]({},e,{type:d("WAWebMsgType").MSG_TYPE.PROTOCOL,kind:d("WAWebMsgType").MsgKind.Protocol,subtype:"ephemeral_sync_response",ephemeralDuration:a,ephemeralSettingTimestamp:d("WALongInt").numberOrThrowIfTooLarge(f),disappearingModeInitiator:c("WANullthrows")(d("WAWebE2EProtoUtils").protoToDisappearingModeInitiator(e,g)),disappearingModeTrigger:(b=i)==null?void 0:b.disappearingModeTrigger,disappearingModeInitiatedByMe:(a=i)==null?void 0:a.initiatedByMe}),contextInfo:null}}g["default"]=a}),98);
__d("WAWebParseExtendedTextUrlChatMessageProto",["WAWebMsgType","WAWebParseExtendedTextMessageProtoUtils","WAWebURLUtils","lodash"],(function(a,b,c,d,e,f,g){function a(a){var b=a.messageProtobuf,e=a.baseMessage,f=a.rcat;a=a.msgContext;var g=b.extendedTextMessage;if(g==null)return;if(!d("WAWebParseExtendedTextMessageProtoUtils").isUrlExtendedTextMessage(g))return;var h=c("lodash").memoize(function(a){return c("WAWebURLUtils").hostname(a)}),i=h((g==null?void 0:g.canonicalUrl)||"");h=h((g==null?void 0:g.matchedText)||"");i=i===h||i==="";b=d("WAWebParseExtendedTextMessageProtoUtils").parseExtendedTextMessageProto({messageProtobuf:b,baseMessage:e,msgContext:a});a=babelHelpers["extends"]({},e,b==null?void 0:b.msgData,{type:d("WAWebMsgType").MSG_TYPE.CHAT,kind:d("WAWebMsgType").MsgKind.Chat,subtype:"url",canonicalUrl:i?g==null?void 0:g.canonicalUrl:h,rcat:f});return{msgData:a,contextInfo:g==null?void 0:g.contextInfo}}g["default"]=a}),98);
__d("WAWebParseGroupInviteMessageProto",["WAWebMsgType"],(function(a,b,c,d,e,f,g){function a(a){var b=a.messageProtobuf;a=a.baseMessage;b=b.groupInviteMessage;if(b==null)return;var c=b.caption,e=b.inviteCode,f=b.inviteExpiration,g=b.groupJid,h=b.groupName;b=b.contextInfo;a=babelHelpers["extends"]({},a,{type:d("WAWebMsgType").MSG_TYPE.GROUPS_V4_INVITE,kind:d("WAWebMsgType").MsgKind.GroupsV4Invite,comment:c,inviteCode:e,inviteCodeExp:f==null?void 0:f.toString(),inviteGrp:g,inviteGrpName:h});return{msgData:a,contextInfo:b}}g["default"]=a}),98);
__d("WAWebParseHsmMessageProto",["WAWebE2EProtoUtils","WAWebMsgType"],(function(a,b,c,d,e,f,g){function a(a){var b=a.messageProtobuf;a=a.baseMessage;b=b.highlyStructuredMessage;if(b==null)return;b=(b=b.hydratedHsm)==null?void 0:b.hydratedTemplate;return{msgData:babelHelpers["extends"]({},a,{type:d("WAWebMsgType").MSG_TYPE.HSM,kind:d("WAWebMsgType").MsgKind.Hsm,body:b?d("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis(b.hydratedContentText):a.body}),contextInfo:void 0}}g["default"]=a}),98);
__d("WAWebParseImageMessageProto",["WALongInt","WATimeUtils","WAWebE2EProtoParserApi","WAWebE2EProtoUtils","WAWebMediaMessageGetValidatedProperties","WAWebMsgType"],(function(a,b,c,d,e,f,g){function a(a){var b=a.messageProtobuf,c=a.baseMessage;a=a.msgContext;b=b.imageMessage;if(b==null)return;var e=b.directPath,f=b.staticUrl,g=b.mimetype,h=b.caption,i=b.height,j=b.width,k=b.mediaKeyTimestamp,l=b.jpegThumbnail,m=b.interactiveAnnotations,n=b.scanLengths,o=b.scansSidecar,p=b.viewOnce,q=b.thumbnailDirectPath,r=b.thumbnailSha256,s=b.thumbnailEncSha256,t=b.contextInfo,u=b.annotations;a=d("WAWebMediaMessageGetValidatedProperties").getValidatedMediaMessageProperties(b,c,a,d("WAWebMsgType").MSG_TYPE.IMAGE);var v=a.mediaKey,w=a.fileSha256,x=a.fileEncSha256,y=a.fileLength;a=a.url;c=babelHelpers["extends"]({},c,{type:d("WAWebMsgType").MSG_TYPE.IMAGE,kind:d("WAWebMsgType").MsgKind.Image,deprecatedMms3Url:d("WAWebE2EProtoParserApi").decodeUrl(a),directPath:e||"",staticUrl:f||"",mimetype:g||"",caption:d("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis(h),filehash:d("WAWebE2EProtoParserApi").decodeBytes(w),encFilehash:d("WAWebE2EProtoParserApi").decodeBytes(x),size:y,height:i||0,width:j||0,mediaKey:d("WAWebE2EProtoParserApi").decodeBytes(v),mediaKeyTimestamp:k!=null?d("WALongInt").numberOrThrowIfTooLarge(k):d("WATimeUtils").unixTime(),body:d("WAWebE2EProtoParserApi").decodeBytes(l)||"",interactiveAnnotations:(u==null?void 0:u.length)>0?u:m,scanLengths:n,scansSidecar:o,isViewOnce:p===!0,thumbnailDirectPath:q,thumbnailSha256:d("WAWebE2EProtoParserApi").decodeBytes(r),thumbnailEncSha256:d("WAWebE2EProtoParserApi").decodeBytes(s)});d("WAWebE2EProtoParserApi").validateRequiredMediaProperties(c,b);d("WAWebMediaMessageGetValidatedProperties").validateImageMimetype(g);return{msgData:c,contextInfo:t}}g["default"]=a}),98);
__d("WAWebBizOrderDetailsParams",["$InternalEnum"],(function(a,b,c,d,e,f){e=b("$InternalEnum")({PIX_STATIC_CODE:"pix_static_code"});function a(a){return JSON.parse(a)}function c(a){return JSON.stringify(a)}function d(a){return JSON.stringify(a)}f.PaymentSettingType=e;f.parse=a;f.stringify=c;f.stringifyPaymentStatus=d}),66);
__d("WAWebOrderDetails",["WAWebBizOrderDetailsParams","WAWebInteractiveMessageType","WAWebInteractiveMessagesNativeFlowName","WAWebMsgType","filterNulls"],(function(a,b,c,d,e,f,g){function h(a){var b=a==null?void 0:a.value;if(b==null)return;a=(a=a==null?void 0:a.offset)!=null?a:1;return parseFloat((b=b)!=null?b:0)/parseInt(a,10)}function i(a){return a==null?null:c("filterNulls")(a.map(function(a){return(a==null?void 0:a.type)!=null?babelHelpers["extends"]({type:a.type},a.payment_instruction!=null?{paymentInstruction:a.payment_instruction}:{}):null}))}var j=function(){return"custom-item"},k=function(a,b){var c;if(a!=="review_and_pay"||b==null)return null;a=d("WAWebBizOrderDetailsParams").parse(b);b=a.order;var e=a.currency,f=a.reference_id,g=a.external_payment_configurations,k=h(a.total_amount);c=(c=b==null?void 0:b.items)!=null?c:[];var l=c.map(function(a){var b;return{id:(b=(b=a==null?void 0:a.product_id)!=null?b:a==null?void 0:a.retailer_id)!=null?b:"",name:(b=a==null?void 0:a.name)!=null?b:"",amount:h(a==null?void 0:a.amount),quantity:parseInt((b=a==null?void 0:a.quantity)!=null?b:0,10),isCustomItem:(b=a==null?void 0:a.isCustomItem)!=null?b:(a==null?void 0:(b=a.retailer_id)==null?void 0:b.indexOf(j()))===0,isQuantitySet:(b=a==null?void 0:a.isQuantitySet)!=null?b:!0}}),m=l.reduce(function(a,b){return a+b.quantity},0);c=(c=c[0])==null?void 0:c.name;if(c==null||f==null||e==null||k==null)return null;var n=h(b==null?void 0:b.shipping),o=h(b==null?void 0:b.tax),p=h(b==null?void 0:b.discount);b=h(b==null?void 0:b.subtotal);g=i(g);return babelHelpers["extends"]({title:c,referenceId:f,currency:e,quantity:m,shipping:n,tax:o,discount:p,subtotal:b,totalAmount:k,items:l,type:a.type},g!=null?{externalPaymentConfigurations:g}:{})};a=function(a){var b;if(a.nativeFlowName!==c("WAWebInteractiveMessagesNativeFlowName").ORDER_DETAILS)return null;if(a.type===d("WAWebMsgType").MSG_TYPE.INTERACTIVE&&a.interactiveType===c("WAWebInteractiveMessageType").NATIVE_FLOW&&((b=a.interactivePayload)==null?void 0:b.buttons)){b=a.interactivePayload.buttons[0];var e=b.name;b=b.buttonParamsJson;return k(e,b)}else if(a.type===d("WAWebMsgType").MSG_TYPE.NATIVE_FLOW){b=((e=a.nativeFlowButtons)!=null?e:[])[0].nativeFlowInfo;return k(b==null?void 0:b.name,b==null?void 0:b.paramsJson)}};g.getCustomItemIdPrefix=j;g.paramsJsonToOrderInfo=k;g.getOrderInfo=a}),98);
__d("WAWebOrderPaymentStatus",["$InternalEnum","WAWebE2EProtoUtils","WAWebInteractiveMessageType","WAWebMsgType","lodash"],(function(a,b,c,d,e,f,g){var h=-1e3;a=b("$InternalEnum")({Pending:"pending",Captured:"captured"});e=b("$InternalEnum")({Confirm:"confirm",PaymentInstruction:"payment_instruction"});f=b("$InternalEnum")({CPI:"cpi",PIX:"pix"});var i=function(a){var b={};try{b=JSON.parse(a)}catch(a){return null}if(b==null)return null;a=b;b=a.reference_id;var c=a.payment_method;a=a.payment_status;return b==null||a==null&&c==null?null:{refId:b,paymentMethod:c,paymentStatus:a}},j=function(a){var b;if(a.type===d("WAWebMsgType").MSG_TYPE.INTERACTIVE&&a.interactiveType===c("WAWebInteractiveMessageType").NATIVE_FLOW&&d("WAWebE2EProtoUtils").isOrderNativeFlow(a.nativeFlowName)&&((b=a.interactivePayload)==null?void 0:b.buttons)){b=a.interactivePayload;a=b.buttons[0].buttonParamsJson;if(a!=null)return i(a)}return null},k=function(a){var b;return a.type===d("WAWebMsgType").MSG_TYPE.INTERACTIVE&&a.interactiveType===c("WAWebInteractiveMessageType").NATIVE_FLOW&&d("WAWebE2EProtoUtils").isOrderNativeFlow(a.nativeFlowName)&&((b=a.interactivePayload)==null?void 0:b.buttons)?a.interactivePayload.buttons[0]:null},l=function(a){a=k(a);if(a==null)return null;var b=a.name;a=a.buttonParamsJson;return b!=null&&a!=null?i(a):null};b=function(a,b){a=a.msgs.getModelsArray().slice(h);var e=null;a=c("lodash").findLast(a,function(a){if(a.type===d("WAWebMsgType").MSG_TYPE.UNKNOWN&&a.subtype==="phone_only_feature"&&a.quotedMsg!=null){var f;e=j(a.quotedMsg);if(((f=e)==null?void 0:f.refId)===b)return!0}else if(a.type===d("WAWebMsgType").MSG_TYPE.INTERACTIVE&&a.interactiveType===c("WAWebInteractiveMessageType").NATIVE_FLOW&&d("WAWebE2EProtoUtils").isOrderNativeFlow(a.nativeFlowName)){e=l(a);if(((f=e)==null?void 0:f.refId)===b)return!0}return!1});return a!=null&&e!=null?e:null};g.MESSAGE_LOOKUP_OFFSET=h;g.OrderPaymentStatus=a;g.OrderPaymentMethod=e;g.OrderAcceptedPaymentMethods=f;g.paramsJsonToOrderPaymentInfo=i;g.getOrderPaymentStatusInfo=j;g.getButtonNativeFlowFromInteractiveMsg=k;g.getOrderPaymentStatusInfoFromNativeFlow=l;g.findLastOrderPaymentStatusInfo=b}),98);
__d("WAWebOrderStatus",["$InternalEnum","WAWebBizGatingUtils","WAWebE2EProtoUtils","WAWebInteractiveMessageType","WAWebInteractiveMessagesNativeFlowName","WAWebMsgType","WAWebOrderDetails","lodash"],(function(a,b,c,d,e,f,g){var h=b("$InternalEnum")({Pending:"pending",Processing:"processing",PartiallyShipped:"partially_shipped",Shipped:"shipped",Complete:"completed",Canceled:"canceled",PaymentRequested:"payment_requested",PreparingToShip:"preparing_to_ship",Delivered:"delivered"}),i=function(a){if(a==null)return null;try{a=JSON.parse(a);var b=a.order;a=a.reference_id;b=h.cast(b==null?void 0:b.status);return b==null||a==null?null:{refId:a,status:b}}catch(a){return null}},j=function(a){var b;if(!d("WAWebE2EProtoUtils").isOrderNativeFlow(a.nativeFlowName))return null;if(a.type===d("WAWebMsgType").MSG_TYPE.INTERACTIVE&&a.interactiveType===c("WAWebInteractiveMessageType").NATIVE_FLOW&&((b=a.interactivePayload)==null?void 0:b.buttons)){b=a.interactivePayload.buttons[0].buttonParamsJson;return i(b)}else if(a.type===d("WAWebMsgType").MSG_TYPE.NATIVE_FLOW){a=((b=a.nativeFlowButtons)!=null?b:[])[0].nativeFlowInfo;return i(a==null?void 0:a.paramsJson)}};a=function(a,b){a=a.msgs.getModelsArray().slice(-1e3);a=(a=c("lodash").findLast(a,function(a){return a.nativeFlowName===c("WAWebInteractiveMessagesNativeFlowName").ORDER_DETAILS&&((a=d("WAWebOrderDetails").getOrderInfo(a))==null?void 0:a.referenceId)===b}))==null?void 0:a.safe();return a};var k=function(a,b){a=a.msgs.getModelsArray().slice(-1e3);a=(a=c("lodash").findLast(a,function(a){return d("WAWebE2EProtoUtils").isOrderNativeFlow(a.nativeFlowName)&&((a=j(a))==null?void 0:a.refId)===b}))==null?void 0:a.safe();return a},l=function(){return d("WAWebBizGatingUtils").isOrderStatusM1Enabled()?h.PaymentRequested:h.Pending};e=function(a,b){a=k(a,b);b=a!=null?j(a):null;return(a=b==null?void 0:b.status)!=null?a:l()};g.OrderStatus=h;g.paramsJsonToOrderStatusInfo=i;g.getOrderStatusInfo=j;g.findOrderDetailsMessage=a;g.findOrderStatusMessage=k;g.getDefaultOrderStatus=l;g.findOrderStatus=e}),98);
__d("WAWebNativeFlowValidation",["WAWebBizGatingUtils","WAWebInteractiveMessageType","WAWebInteractiveMessagesNativeFlowName","WAWebMsgType","WAWebOrderDetails","WAWebOrderPaymentStatus","WAWebOrderStatus"],(function(a,b,c,d,e,f,g){function a(a,b,e){if(a.nativeFlowName==null)return!1;switch(a.nativeFlowName){case c("WAWebInteractiveMessagesNativeFlowName").ORDER_DETAILS:return d("WAWebOrderDetails").getOrderInfo(a)!=null;case c("WAWebInteractiveMessagesNativeFlowName").ORDER_STATUS:return d("WAWebOrderStatus").getOrderStatusInfo(a)!=null;case c("WAWebInteractiveMessagesNativeFlowName").PAYMENT_STATUS:return d("WAWebOrderPaymentStatus").getOrderPaymentStatusInfoFromNativeFlow(a)!=null;case c("WAWebInteractiveMessagesNativeFlowName").PAYMENT_METHOD:return d("WAWebOrderPaymentStatus").getOrderPaymentStatusInfoFromNativeFlow(a)!=null;case c("WAWebInteractiveMessagesNativeFlowName").MESSAGE_WITH_LINK:return h(a)!==!1;case c("WAWebInteractiveMessagesNativeFlowName").MESSAGE_WITH_LINK_STATUS:return d("WAWebBizGatingUtils").isMessageWithLinkNfmEnabled();case c("WAWebInteractiveMessagesNativeFlowName").CTA_CALL:return d("WAWebBizGatingUtils").isInteractiveCtaMessageEnabled(c("WAWebInteractiveMessagesNativeFlowName").CTA_CALL,e,b)&&i(a)!=null;case c("WAWebInteractiveMessagesNativeFlowName").CTA_URL:return d("WAWebBizGatingUtils").isInteractiveCtaMessageEnabled(c("WAWebInteractiveMessagesNativeFlowName").CTA_URL,e,b)&&i(a)!=null;case c("WAWebInteractiveMessagesNativeFlowName").QUICK_REPLY:return d("WAWebBizGatingUtils").isInteractiveCtaMessageEnabled(c("WAWebInteractiveMessagesNativeFlowName").QUICK_REPLY,e,b)&&i(a)!=null;case c("WAWebInteractiveMessagesNativeFlowName").CTA_CATALOG:return d("WAWebBizGatingUtils").isInteractiveCtaMessageEnabled(c("WAWebInteractiveMessagesNativeFlowName").CTA_CATALOG,e,b)&&i(a)!=null}}function h(a){if(d("WAWebBizGatingUtils").isMessageWithLinkNfmEnabled()){if(a.nativeFlowName!==c("WAWebInteractiveMessagesNativeFlowName").MESSAGE_WITH_LINK||a.type!==d("WAWebMsgType").MSG_TYPE.INTERACTIVE||a.interactiveType!==c("WAWebInteractiveMessageType").NATIVE_FLOW||a.interactivePayload==null)return!1;a=a.interactivePayload;if((a==null?void 0:a.buttons)&&a.buttons.length>0){a=a.buttons[0];var b=a.name;a=a.buttonParamsJson;if(b==="open_webview"&&a!=null)return!0}}return!1}function i(a){var b;a.type===d("WAWebMsgType").MSG_TYPE.INTERACTIVE&&a.interactiveType===c("WAWebInteractiveMessageType").NATIVE_FLOW&&(a.nativeFlowName===c("WAWebInteractiveMessagesNativeFlowName").QUICK_REPLY||a.nativeFlowName===c("WAWebInteractiveMessagesNativeFlowName").CTA_CALL||a.nativeFlowName===c("WAWebInteractiveMessagesNativeFlowName").CTA_URL||a.nativeFlowName===c("WAWebInteractiveMessagesNativeFlowName").CTA_CATALOG)&&((b=a.interactivePayload)==null?void 0:b.buttons)!=null&&a.interactivePayload.buttons.forEach(function(a){a=j(a);if(a)return!0});return!1}function j(a){return a.name==="cta_url"||a.name==="cta_call"||a.name==="cta_catalog"?!0:!1}g.isValidNativeFlowMessage=a;g.isOpenMsgWithLinkAction=h;g.isNativeFlowCtasFromInteractiveMsg=i;g.isCtaButton=j}),98);
__d("WAWebParseVideoMessageProto",["WALongInt","WATimeUtils","WAWebE2EProtoParserApi","WAWebE2EProtoUtils","WAWebMediaMessageGetValidatedProperties","WAWebMsgType"],(function(a,b,c,d,e,f,g){function a(a){var b=a.messageProtobuf,c=a.baseMessage;a=a.msgContext;b=b.videoMessage;if(b==null)return;var e=b.directPath,f=b.staticUrl,g=b.mimetype,h=b.caption,i=b.height,j=b.width,k=b.mediaKeyTimestamp,l=b.jpegThumbnail,m=b.interactiveAnnotations,n=b.viewOnce,o=b.thumbnailDirectPath,p=b.thumbnailSha256,q=b.thumbnailEncSha256,r=b.contextInfo,s=b.gifPlayback,t=b.gifAttribution,u=b.seconds,v=b.streamingSidecar,w=b.annotations;a=d("WAWebMediaMessageGetValidatedProperties").getValidatedMediaMessageProperties(b,c,a,d("WAWebMsgType").MSG_TYPE.VIDEO);var x=a.mediaKey,y=a.fileSha256,z=a.fileEncSha256,A=a.fileLength;a=a.url;c=babelHelpers["extends"]({},c,{type:d("WAWebMsgType").MSG_TYPE.VIDEO,kind:d("WAWebMsgType").MsgKind.Video,deprecatedMms3Url:d("WAWebE2EProtoParserApi").decodeUrl(a),directPath:e,staticUrl:f||"",mimetype:g,caption:d("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis(h),filehash:d("WAWebE2EProtoParserApi").decodeBytes(y),encFilehash:d("WAWebE2EProtoParserApi").decodeBytes(z),size:A,height:i,width:j,mediaKey:d("WAWebE2EProtoParserApi").decodeBytes(x),mediaKeyTimestamp:k!=null?d("WALongInt").numberOrThrowIfTooLarge(k):d("WATimeUtils").unixTime(),duration:""+(u||0),body:d("WAWebE2EProtoParserApi").decodeBytes(l)||"",interactiveAnnotations:(w==null?void 0:w.length)>0?w:m,isViewOnce:n===!0,thumbnailDirectPath:o,thumbnailSha256:d("WAWebE2EProtoParserApi").decodeBytes(p),thumbnailEncSha256:d("WAWebE2EProtoParserApi").decodeBytes(q),isGif:s,gifAttribution:t,streamingSidecar:v});d("WAWebE2EProtoParserApi").validateRequiredMediaProperties(c,b);return{msgData:c,contextInfo:r}}g["default"]=a}),98);
__d("WAWebParseInteractiveMessageProto",["WAWebE2EProtoParserApi","WAWebE2EProtoUtils","WAWebInteractiveMessageHeaderMediaType","WAWebInteractiveMessageType","WAWebInteractiveMessagesNativeFlowName","WAWebMsgKey","WAWebMsgType","WAWebNativeFlowValidation","WAWebParseDocumentMessageProto","WAWebParseImageMessageProto","WAWebParseVideoMessageProto","filterNulls"],(function(a,b,c,d,e,f,g){function a(a){var b=a.messageProtobuf,e=a.baseMessage,f=a.bizInfo,g=a.bizSource;a=a.msgContext;b=b.interactiveMessage;if(b==null)return;var j=d("WAWebE2EProtoUtils").getInteractiveMessageTypeForProto(b);if(!j||!d("WAWebE2EProtoUtils").isInteractiveMessageTypeEnabled(j))return k(e,b);var l=b.body,m=b.footer,n=d("WAWebE2EProtoUtils").getInteractiveMessageFieldNameForType(j);l={type:d("WAWebMsgType").MSG_TYPE.INTERACTIVE,kind:d("WAWebMsgType").MsgKind.Interactive,caption:(l=d("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis(l==null?void 0:l.text))!=null?l:"",interactiveType:j,interactivePayload:b[n],pmCampaignId:f==null?void 0:f.campaignId,bizSource:g};if(!d("WAWebE2EProtoUtils").isSupportedInteractiveMessageVersion(j,b[n]))return k(e,b);n=null;var o=b.carouselMessage;if(o!=null){n=i(e,o,a,f,g);if(n==null)return k(e,b)}if(j===c("WAWebInteractiveMessageType").NATIVE_FLOW){o=c("WAWebInteractiveMessagesNativeFlowName").cast(d("WAWebE2EProtoUtils").getBizNativeFlowName({interactiveMessage:b}));l=babelHelpers["extends"]({},l,{nativeFlowName:o});if(!d("WAWebE2EProtoUtils").isValidNativeFlowName(o,f)||!d("WAWebNativeFlowValidation").isValidNativeFlowMessage(l,g,e==null?void 0:(j=e.id)==null?void 0:j.fromMe))return k(e,b)}o=b.header!=null?h(b.header,e,a):void 0;return{msgData:babelHelpers["extends"]({},e,(f=o==null?void 0:o.headerMessage)!=null?f:{},l,{interactiveHeader:o==null?void 0:o.interactiveHeader,footer:m?d("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis(m.text):e.footer,carouselCardsParsed:(g=n)!=null?g:void 0}),contextInfo:b.contextInfo}}function h(a,b,e){var f=function(){if(a.imageMessage){var f;return{headerMessage:(f=c("WAWebParseImageMessageProto")({messageProtobuf:{imageMessage:a.imageMessage},baseMessage:b,msgContext:e}))==null?void 0:f.msgData,mediaType:d("WAWebInteractiveMessageHeaderMediaType").InteractiveMessageHeaderMediaType.IMAGE}}if(a.documentMessage){return{headerMessage:(f=c("WAWebParseDocumentMessageProto")({messageProtobuf:{documentMessage:a.documentMessage},baseMessage:b,msgContext:e}))==null?void 0:f.msgData,mediaType:d("WAWebInteractiveMessageHeaderMediaType").InteractiveMessageHeaderMediaType.DOCUMENT}}if(a.videoMessage){return{headerMessage:(f=c("WAWebParseVideoMessageProto")({messageProtobuf:{videoMessage:a.videoMessage},baseMessage:b,msgContext:e}))==null?void 0:f.msgData,mediaType:d("WAWebInteractiveMessageHeaderMediaType").InteractiveMessageHeaderMediaType.VIDEO}}};f=a.hasMediaAttachment===!0?f():void 0;return{headerMessage:f==null?void 0:f.headerMessage,interactiveHeader:{title:d("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis(a.title),subtitle:d("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis(a.subtitle),thumbnail:d("WAWebE2EProtoParserApi").decodeBytes(a.jpegThumbnail),hasMediaAttachment:Boolean(a.hasMediaAttachment),mediaType:f==null?void 0:f.mediaType}}}function i(a,b,d,e,f){b=b.cards.map(function(b){return j(b,a,d,e,f)});b=c("filterNulls")(b);return b.length===0?null:b}function j(a,b,e,f,g){var i=a.body,j=a.header,k=d("WAWebE2EProtoUtils").getInteractiveMessageTypeForProto(a);if(!k||!d("WAWebE2EProtoUtils").isInteractiveMessageTypeEnabled(k))return null;i=babelHelpers["extends"]({},j,{type:d("WAWebMsgType").MSG_TYPE.INTERACTIVE,kind:d("WAWebMsgType").MsgKind.Interactive,caption:(i=d("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis(i==null?void 0:i.text))!=null?i:"",interactiveType:k,interactivePayload:a.nativeFlowMessage,pmCampaignId:f==null?void 0:f.campaignId,bizSource:g});k=j!=null?h(j,b,e):void 0;a=k==null?void 0:k.headerMessage;if(k==null||a==null)return null;f=babelHelpers["extends"]({},k.interactiveHeader,{title:null,subtitle:null});g=new(c("WAWebMsgKey"))({fromMe:a.id.fromMe,remote:a.id.remote,participant:a.id.participant,id:c("WAWebMsgKey").newId_DEPRECATED()});if(a.type===d("WAWebMsgType").MSG_TYPE.VIDEO)return babelHelpers["extends"]({},a,i,{id:g,interactiveHeader:f,footer:null,isCarouselCard:!0,parentMsgId:b.id.clone()});if(a.type===d("WAWebMsgType").MSG_TYPE.IMAGE)return babelHelpers["extends"]({},a,i,{id:g,interactiveHeader:f,footer:null,isCarouselCard:!0,parentMsgId:b.id.clone()})}function k(a,b){return{msgData:babelHelpers["extends"]({},a,{type:d("WAWebMsgType").MSG_TYPE.UNKNOWN,kind:d("WAWebMsgType").MsgKind.Unknown,subtype:"phone_only_feature"}),contextInfo:b.contextInfo}}g["default"]=a}),98);
__d("WAWebParseInteractiveResponseMessageProto",["WAWebBizGatingUtils","WAWebE2EProtoUtils","WAWebMsgType"],(function(a,b,c,d,e,f,g){function a(a){var b=a.messageProtobuf,c=a.baseMessage;a=a.bizInfo;b=b.interactiveResponseMessage;if(b==null)return;var e=d("WAWebE2EProtoUtils").getInteractiveResponseMessageTypeForProto(b);if(!d("WAWebBizGatingUtils").interactiveNativeFlowResponseMessagesEnabled()||!e||!d("WAWebE2EProtoUtils").isInteractiveResponseMessageTypeEnabled(e))return{msgData:babelHelpers["extends"]({},c,{type:d("WAWebMsgType").MSG_TYPE.UNKNOWN,kind:d("WAWebMsgType").MsgKind.Unknown,subtype:"phone_only_feature"}),contextInfo:b.contextInfo};try{var f;return{msgData:babelHelpers["extends"]({},c,{type:d("WAWebMsgType").MSG_TYPE.INTERACTIVE_RESPONSE,kind:d("WAWebMsgType").MsgKind.InteractiveResponse,body:(f=d("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis((f=b.body)==null?void 0:f.text))!=null?f:"",interactivePayload:d("WAWebE2EProtoUtils").getInteractiveResponsePayload(e,b,a)}),contextInfo:b.contextInfo}}catch(a){return{msgData:babelHelpers["extends"]({},c,{type:d("WAWebMsgType").MSG_TYPE.UNKNOWN,kind:d("WAWebMsgType").MsgKind.Unknown,subtype:"phone_only_feature"}),contextInfo:b.contextInfo}}}g["default"]=a}),98);
__d("WAWebParseKeepInChatMessageProto",["WALongInt","WAWebE2EProtoUtils","WAWebMsgType"],(function(a,b,c,d,e,f,g){function a(a){var b=a.messageProtobuf;a=a.baseMessage;b=b.keepInChatMessage;if(b==null)return;var c=b.key,e=b.keepType;b=b.timestampMs;c=babelHelpers["extends"]({},a,{keptMessageKey:d("WAWebE2EProtoUtils").translateRegularMessageKeyToLocalReference(c,a),type:d("WAWebMsgType").MSG_TYPE.KEEP_IN_CHAT,kind:d("WAWebMsgType").MsgKind.KeepInChat,keepType:e,senderTimestampMs:d("WALongInt").maybeNumberOrThrowIfTooLarge(b)});return{msgData:c,contextInfo:null}}g["default"]=a}),98);
__d("WAWebParseListMessageProto",["WAWebMsgType","WAWebProtobufsE2E.pb"],(function(a,b,c,d,e,f,g){function a(a){var b=a.messageProtobuf;a=a.baseMessage;b=b.listMessage;if(b==null)return;var c=b.listType;if(c===d("WAWebProtobufsE2E.pb").Message$ListMessage$ListType.SINGLE_SELECT||c===d("WAWebProtobufsE2E.pb").Message$ListMessage$ListType.PRODUCT_LIST){c=a.businessOwnerJid;var e=a.productListItemCount;if(b.listType===d("WAWebProtobufsE2E.pb").Message$ListMessage$ListType.PRODUCT_LIST){var f;c=(f=b.productListInfo)==null?void 0:f.businessOwnerJid;e=(f=b.productListInfo)==null?void 0:f.productSections.reduce(function(a,b){return a+b.products.length},0)}f=babelHelpers["extends"]({},a,{businessOwnerJid:c,productListItemCount:e,type:d("WAWebMsgType").MSG_TYPE.LIST,kind:d("WAWebMsgType").MsgKind.List,list:b,footer:b.footerText})}else f=babelHelpers["extends"]({},a,{type:d("WAWebMsgType").MSG_TYPE.UNKNOWN,kind:d("WAWebMsgType").MsgKind.Unknown});return{msgData:f,contextInfo:b.contextInfo}}g["default"]=a}),98);
__d("WAWebParseListResponseMessageProto",["WAWebE2EProtoUtils","WAWebMsgType","WAWebProtobufsE2E.pb"],(function(a,b,c,d,e,f,g){function a(a){var b=a.messageProtobuf;a=a.baseMessage;b=b.listResponseMessage;if(b==null)return;if(b.listType===d("WAWebProtobufsE2E.pb").Message$ListResponseMessage$ListType.SINGLE_SELECT){var c=babelHelpers["extends"]({},b,{contextInfo:void 0}),e=b.title||"";b.description!=null&&b.description!==""&&(e+="\n"+b.description);a=babelHelpers["extends"]({},a,{type:d("WAWebMsgType").MSG_TYPE.LIST_RESPONSE,kind:d("WAWebMsgType").MsgKind.ListResponse,listResponse:c,body:d("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis(e)});return{msgData:a,contextInfo:b.contextInfo}}}g["default"]=a}),98);
__d("WAWebParseLocationMessageProto",["WALongInt","WAWebE2EProtoParserApi","WAWebE2EProtoUtils","WAWebMsgType"],(function(a,b,c,d,e,f,g){function h(a,b){var c;c=((c=a.name)!=null?c:"")||((c=a.address)!=null?c:"");a.name!=null&&a.name!==""&&a.address!=null&&a.address!==""&&(c=a.name+"\n"+a.address);var e=a.degreesLatitude!==void 0?a.degreesLatitude:void 0,f=a.degreesLongitude!==void 0?a.degreesLongitude:void 0;b=babelHelpers["extends"]({},b,{type:d("WAWebMsgType").MSG_TYPE.LOCATION,kind:d("WAWebMsgType").MsgKind.Location,loc:c,lat:e,lng:f,body:d("WAWebE2EProtoParserApi").decodeBytes(a.jpegThumbnail)||"",clientUrl:a.url});return{msgData:b,contextInfo:a.contextInfo}}function i(a,b,c){var e={};c&&(e={finalLat:c.degreesLatitude,finalLng:c.degreesLongitude,finalThumbnail:d("WAWebE2EProtoParserApi").decodeBytes(c.jpegThumbnail)||"",finalAccuracy:c.accuracyInMeters,finalSpeed:c.speedInMps,finalDegrees:c.degreesClockwiseFromMagneticNorth,finalTimeOffset:c.timeOffset});c=babelHelpers["extends"]({},b,e,{type:d("WAWebMsgType").MSG_TYPE.LOCATION,kind:d("WAWebMsgType").MsgKind.LocationLive,isLive:!0,lat:a.degreesLatitude,lng:a.degreesLongitude,body:d("WAWebE2EProtoParserApi").decodeBytes(a.jpegThumbnail)||"",accuracy:a.accuracyInMeters,speed:a.speedInMps,degrees:a.degreesClockwiseFromMagneticNorth,comment:d("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis(a.caption),sequence:d("WALongInt").maybeNumberOrThrowIfTooLarge(a.sequenceNumber)});return{msgData:c,contextInfo:a.contextInfo}}function a(a){var b=a.messageProtobuf,c=a.baseMessage;a=a.finalLocation;var d=b.locationMessage;b=b.liveLocationMessage;var e=null;d!=null&&(e=h(d,c));b!=null&&(e=i(b,c,a));return e}g["default"]=a}),98);
__d("WAWebMultiVcardMessageValidationError",["$InternalEnum","WAWebHandleMsgError"],(function(a,b,c,d,e,f,g){a=b("$InternalEnum")({EMPTY_LIST:"contacts_array_empty_list",INVALID_LIST_SIZE:"contacts_array_invalid_list_size"});c=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.name="MultiVcardMessageValidationError",b)||babelHelpers.assertThisInitialized(c)}return b}(d("WAWebHandleMsgError").MessageValidationError);g.MultiVcardValidationErrorCode=a;g.MultiVcardMessageValidationError=c}),98);
__d("WAWebParseMultiVcardMessageProto",["WAWebHandleMsgError","WAWebMsgType","WAWebMultiVcardMessageValidationError","WAWebWamEnumE2eFailureReason"],(function(a,b,c,d,e,f,g){function a(a){var b=a.messageProtobuf,c=a.baseMessage;a=a.msgContext;b=b.contactsArrayMessage;if(b==null)return;var e=b.contacts,f=b.contextInfo;b=b.displayName;if(d("WAWebHandleMsgError").isMessageDropValidationEnabled(a)&&(e==null||e.length===0))throw new(d("WAWebMultiVcardMessageValidationError").MultiVcardMessageValidationError)(d("WAWebMultiVcardMessageValidationError").MultiVcardValidationErrorCode.EMPTY_LIST,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_PROTOCOL_BUFFER);a=babelHelpers["extends"]({},c,{type:d("WAWebMsgType").MSG_TYPE.MULTI_VCARD,kind:d("WAWebMsgType").MsgKind.MultiVcard,vcardFormattedName:b,vcardList:Array.isArray(e)?e.map(function(a){return{displayName:a.displayName,vcard:a.vcard,isMultiVcard:!1}}):[]});return{msgData:a,contextInfo:f}}g["default"]=a}),98);
__d("WAWebButtonsMessageProtoUtils",["WAWebE2EProtoUtils","WAWebMsgType","WAWebParseDocumentMessageProto","WAWebParseImageMessageProto","WAWebParseLocationMessageProto","WAWebParseVideoMessageProto","WAWebProtobufsE2E.pb"],(function(a,b,c,d,e,f,g){function a(a){var b=a.buttonsMessage,e=a.baseMessage,f=a.msgContext,g=b.documentMessage,h=b.imageMessage,i=b.locationMessage,j=b.videoMessage,k=b.contentText;a=b.footerText;var l=b.text;b=b.headerType;var m=function(){var a=babelHelpers["extends"]({},e,{type:d("WAWebMsgType").MSG_TYPE.CHAT,kind:d("WAWebMsgType").MsgKind.Chat,title:l==null?e.title:d("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis(l),body:k==null?e.body:d("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis(k)});if(h){var b;return(b=(b=c("WAWebParseImageMessageProto")({messageProtobuf:{imageMessage:h},baseMessage:e,msgContext:f}))==null?void 0:b.msgData)!=null?b:a}if(g){return(b=(b=c("WAWebParseDocumentMessageProto")({messageProtobuf:{documentMessage:g},baseMessage:e,msgContext:f}))==null?void 0:b.msgData)!=null?b:a}if(i){return(b=(b=c("WAWebParseLocationMessageProto")({messageProtobuf:{locationMessage:babelHelpers["extends"]({},i,{name:void 0,address:void 0})},baseMessage:e,msgContext:f}))==null?void 0:b.msgData)!=null?b:a}if(j){return(b=(b=c("WAWebParseVideoMessageProto")({messageProtobuf:{videoMessage:j},baseMessage:e,msgContext:f}))==null?void 0:b.msgData)!=null?b:a}return a};m=m();return babelHelpers["extends"]({},m,{headerType:b,caption:k!=null?d("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis(k):m.caption,footer:a!=null?d("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis(a):m.footer})}function b(a,b,c){var e=a.documentMessage,f=a.imageMessage,g=a.locationMessage,h=a.videoMessage;if(b.isForwarded&&(e||f||g||h))return a;a={buttons:b.isForwarded===!0?void 0:b.dynamicReplyButtons,footerText:b.footer,contextInfo:c};e?(a.documentMessage=e,a.headerType=d("WAWebProtobufsE2E.pb").Message$ButtonsMessage$HeaderType.DOCUMENT,a.contentText=b.caption):f?(a.imageMessage=f,a.headerType=d("WAWebProtobufsE2E.pb").Message$ButtonsMessage$HeaderType.IMAGE,a.contentText=b.caption):g?(a.locationMessage=g,a.headerType=d("WAWebProtobufsE2E.pb").Message$ButtonsMessage$HeaderType.LOCATION,a.contentText=b.caption):h?(a.videoMessage=h,a.headerType=d("WAWebProtobufsE2E.pb").Message$ButtonsMessage$HeaderType.VIDEO,a.contentText=b.caption):b.title?(a.text=b.title,a.headerType=d("WAWebProtobufsE2E.pb").Message$ButtonsMessage$HeaderType.TEXT,a.contentText=b.body):(a.contentText=b.body,a.headerType=d("WAWebProtobufsE2E.pb").Message$ButtonsMessage$HeaderType.EMPTY);return{buttonsMessage:a}}g.parseButtonsMessageProto=a;g.createDynamicReplyButtonsMessage=b}),98);
__d("WAWebParseNativeFlowButtonsMessageProto",["WAWebButtonsMessageProtoUtils","WAWebE2EProtoUtils","WAWebInteractiveMessagesNativeFlowName","WAWebMsgType","WAWebNativeFlowValidation","WAWebProtobufsE2E.pb"],(function(a,b,c,d,e,f,g){function a(a){var b=a.messageProtobuf,e=a.baseMessage,f=a.bizInfo,g=a.bizSource;a=a.msgContext;b=b.buttonsMessage;if(b==null)return;var h=b.buttons;h=h===void 0?[]:h;var i=b.headerType,j=c("WAWebInteractiveMessagesNativeFlowName").cast(d("WAWebE2EProtoUtils").getBizNativeFlowName({buttonsMessage:b}));if(j==null&&(f==null?void 0:f.nativeFlowName)==null)return;if(!d("WAWebE2EProtoUtils").shouldParseNFM(j,f)||d("WAWebE2EProtoUtils").hasUnsupportedButtons(h))return{msgData:babelHelpers["extends"]({},e,{type:d("WAWebMsgType").MSG_TYPE.UNKNOWN,kind:d("WAWebMsgType").MsgKind.Unknown,subtype:"phone_only_feature"}),contextInfo:b.contextInfo};if(i===d("WAWebProtobufsE2E.pb").Message$ButtonsMessage$HeaderType.UNKNOWN||!new Set(d("WAWebProtobufsE2E.pb").Message$ButtonsMessage$HeaderType.members()).has(i))return{msgData:babelHelpers["extends"]({},e,{type:d("WAWebMsgType").MSG_TYPE.UNKNOWN,kind:d("WAWebMsgType").MsgKind.Unknown,subtype:void 0}),contextInfo:b.contextInfo};f=d("WAWebButtonsMessageProtoUtils").parseButtonsMessageProto({buttonsMessage:b,baseMessage:e,msgContext:a});if(j==null)return;i=babelHelpers["extends"]({},f,{type:d("WAWebMsgType").MSG_TYPE.NATIVE_FLOW,kind:d("WAWebMsgType").MsgKind.NativeFlow,nativeFlowName:c("WAWebInteractiveMessagesNativeFlowName").cast(j),nativeFlowButtons:h});return!i.nativeFlowName||!d("WAWebNativeFlowValidation").isValidNativeFlowMessage(i,g)?{msgData:babelHelpers["extends"]({},e,{type:d("WAWebMsgType").MSG_TYPE.UNKNOWN,kind:d("WAWebMsgType").MsgKind.Unknown,subtype:"phone_only_feature"}),contextInfo:b.contextInfo}:{msgData:i,contextInfo:b.contextInfo}}g["default"]=a}),98);
__d("WAWebNewsletterAdminInviteMessageValidationError",["$InternalEnum","WAWebHandleMsgError"],(function(a,b,c,d,e,f,g){a=b("$InternalEnum")({MISSING_NEWSLETTER_JID:"newsletter_admin_invite_missing_newsletter_jid",MISSING_NEWSLETTER_NAME:"newsletter_admin_invite_missing_newsletter_name",MISSING_INVITE_EXPIRATION:"newsletter_admin_invite_missing_invite_expiration",INVALID_NEWSLETTER_JID:"newsletter_admin_invite_invalid_newsletter_jid"});c=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.name="NewsletterAdminInviteMessageValidationError",b)||babelHelpers.assertThisInitialized(c)}return b}(d("WAWebHandleMsgError").MessageValidationError);g.NewsletterAdminInviteMessageValidationErrorCode=a;g.NewsletterAdminInviteMessageValidationError=c}),98);
__d("WAWebParseNewsletterAdminInviteMessageProto",["WATimeUtils","WAWebE2EProtoUtils","WAWebMsgType","WAWebNewsletterAdminInviteMessageValidationError","WAWebNewsletterGatingUtils","WAWebWamEnumE2eFailureReason","WAWebWidFactory"],(function(a,b,c,d,e,f,g){function a(a){var b=a.messageProtobuf;a=a.baseMessage;b=b.newsletterAdminInviteMessage;if(b==null)return;if(!d("WAWebNewsletterGatingUtils").isNewsletterMultiAdminReceiverEnabled())return{msgData:babelHelpers["extends"]({},a,{type:d("WAWebMsgType").MSG_TYPE.UNKNOWN,kind:d("WAWebMsgType").MsgKind.Unknown,futureproofType:d("WAWebMsgType").MSG_TYPE.NEWSLETTER_ADMIN_INVITE}),contextInfo:b.contextInfo};var c=b.caption,e=b.inviteExpiration,f=b.newsletterJid,g=b.newsletterName;b=b.contextInfo;if(f==null)throw new(d("WAWebNewsletterAdminInviteMessageValidationError").NewsletterAdminInviteMessageValidationError)(d("WAWebNewsletterAdminInviteMessageValidationError").NewsletterAdminInviteMessageValidationErrorCode.MISSING_NEWSLETTER_JID,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(g==null)throw new(d("WAWebNewsletterAdminInviteMessageValidationError").NewsletterAdminInviteMessageValidationError)(d("WAWebNewsletterAdminInviteMessageValidationError").NewsletterAdminInviteMessageValidationErrorCode.MISSING_NEWSLETTER_NAME,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(e==null)throw new(d("WAWebNewsletterAdminInviteMessageValidationError").NewsletterAdminInviteMessageValidationError)(d("WAWebNewsletterAdminInviteMessageValidationError").NewsletterAdminInviteMessageValidationErrorCode.MISSING_NEWSLETTER_JID,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);f=d("WAWebE2EProtoUtils").strictDecodeJid(f);if(f==null)throw new(d("WAWebNewsletterAdminInviteMessageValidationError").NewsletterAdminInviteMessageValidationError)(d("WAWebNewsletterAdminInviteMessageValidationError").NewsletterAdminInviteMessageValidationErrorCode.INVALID_NEWSLETTER_JID,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);return{msgData:babelHelpers["extends"]({},a,{type:d("WAWebMsgType").MSG_TYPE.NEWSLETTER_ADMIN_INVITE,kind:d("WAWebMsgType").MsgKind.NewsletterAdminInvite,newsletterAdminInviteInfo:{newsletterId:d("WAWebWidFactory").toNewsletterWid(f),newsletterName:g,inviteExpiration:d("WATimeUtils").castLongIntToUnixTime(e),inviteMessage:(a=c)!=null?a:"",pictureThumbnail:null}}),contextInfo:b}}g["default"]=a}),98);
__d("WAWebParseOrderMessageProto",["WALongInt","WAWebE2EProtoParserApi","WAWebMsgType"],(function(a,b,c,d,e,f,g){function a(a){var b=a.messageProtobuf;a=a.baseMessage;b=b.orderMessage;if(b==null)return;var c=b.thumbnail,e=b.message,f=b.orderId,g=b.itemCount,h=b.status,i=b.surface,j=b.sellerJid,k=b.orderTitle,l=b.token,m=b.totalAmount1000,n=b.totalCurrencyCode;b=b.contextInfo;c=babelHelpers["extends"]({},a,{type:d("WAWebMsgType").MSG_TYPE.ORDER,kind:d("WAWebMsgType").MsgKind.Order,thumbnail:d("WAWebE2EProtoParserApi").decodeBytes(c),message:e||"",orderId:f,itemCount:g||0,status:h,surface:i,sellerJid:j,orderTitle:k||"",token:l||"",totalAmount1000:d("WALongInt").numberOrThrowIfTooLarge((a=m)!=null?a:0),totalCurrencyCode:n,body:""});return{msgData:c,contextInfo:b}}g["default"]=a}),98);
__d("WAWebParsePaymentInviteMessageProto",["WALogger","WALongInt","WAWebMsgType","WAWebProtobufsE2E.pb"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[payment-invite] render payment invite of type ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[payment-invite] parsePaymentInviteMessageProto: does not support novi transactions"]);i=function(){return a};return a}function a(a){var b=a.messageProtobuf;a=a.baseMessage;b=b.paymentInviteMessage;if(b==null)return;if(b.serviceType===d("WAWebProtobufsE2E.pb").Message$PaymentInviteMessage$ServiceType.NOVI){d("WALogger").LOG(i());return{msgData:babelHelpers["extends"]({},a,{kind:d("WAWebMsgType").MsgKind.Unknown,subtype:"phone_only_feature"}),contextInfo:null}}d("WALogger").LOG(h(),b.serviceType);return{msgData:babelHelpers["extends"]({},a,{type:d("WAWebMsgType").MSG_TYPE.PAYMENT,kind:d("WAWebMsgType").MsgKind.Payment,subtype:"invite",paymentExpiryTimestamp:d("WALongInt").maybeNumberOrThrowIfTooLarge(b.expiryTimestamp),paymentInviteServiceType:b.serviceType}),contextInfo:null}}g["default"]=a}),98);
__d("WAWebPinInChatValidationError",["$InternalEnum","WAWebHandleMsgError"],(function(a,b,c,d,e,f,g){a=b("$InternalEnum")({INVALID_PIN_IN_CHAT_EXPIRY_DURATION:"pin_in_chat_invalid_expiry_duration",INVALID_PIN_IN_CHAT_MSG_REMOTE:"pin_in_chat_invalid_msg_remote",MISSING_TYPE:"pin_in_chat_missing_type",MISSING_SENDER_TIMESTAMP:"pin_in_chat_missing_timestamp"});c=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.name="PinInChatValidationError",b)||babelHelpers.assertThisInitialized(c)}return b}(d("WAWebHandleMsgError").MessageValidationError);g.PinInChatValidationErrorCode=a;g.PinInChatValidationError=c}),98);
__d("WAWebParsePinMessageProto",["WALongInt","WATimeUtils","WAWebE2EProtoUtils","WAWebMsgType","WAWebPinInChatValidationError","WAWebPinMsgGatingUtils","WAWebWamEnumE2eFailureReason"],(function(a,b,c,d,e,f,g){function a(a){var b=a.messageProtobuf;a=a.baseMessage;var c=b.pinInChatMessage;if(c==null)return;if(!d("WAWebPinMsgGatingUtils").isPinnedMessagesM1ReceiverEnabled())return{msgData:babelHelpers["extends"]({},a,{type:d("WAWebMsgType").MSG_TYPE.UNKNOWN,kind:d("WAWebMsgType").MsgKind.Unknown,futureproofType:d("WAWebMsgType").MSG_TYPE.PIN_MESSAGE}),contextInfo:null};var e=d("WAWebE2EProtoUtils").translateRegularMessageKeyToLocalReference(c.key,a);if(e==null||a.id.remote.toString()!==e.remote.toString())throw new(d("WAWebPinInChatValidationError").PinInChatValidationError)(d("WAWebPinInChatValidationError").PinInChatValidationErrorCode.INVALID_PIN_IN_CHAT_MSG_REMOTE,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);b=(b=b.messageContextInfo)==null?void 0:b.messageAddOnDurationInSecs;if(b!=null){var f=60*d("WATimeUtils").DAY_SECONDS;if(b<0||b>f)throw new(d("WAWebPinInChatValidationError").PinInChatValidationError)(d("WAWebPinInChatValidationError").PinInChatValidationErrorCode.INVALID_PIN_IN_CHAT_EXPIRY_DURATION,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE)}f=c.type;if(f==null)throw new(d("WAWebPinInChatValidationError").PinInChatValidationError)(d("WAWebPinInChatValidationError").PinInChatValidationErrorCode.MISSING_TYPE,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);c=d("WALongInt").maybeNumberOrThrowIfTooLarge(c.senderTimestampMs);if(c==null)throw new(d("WAWebPinInChatValidationError").PinInChatValidationError)(d("WAWebPinInChatValidationError").PinInChatValidationErrorCode.MISSING_SENDER_TIMESTAMP,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);a=babelHelpers["extends"]({},a,{type:d("WAWebMsgType").MSG_TYPE.PIN_MESSAGE,kind:d("WAWebMsgType").MsgKind.PinInChat,pinParentKey:e,pinMessageType:f,pinSenderTimestampMs:c,pinExpiryDuration:b});return{msgData:a,contextInfo:null}}g["default"]=a}),98);
__d("WAWebParseProductMessageProto",["WALongInt","WAWebMsgType","WAWebParseImageMessageProto"],(function(a,b,c,d,e,f,g){function a(a){var b=a.messageProtobuf,e=a.baseMessage;a=a.msgContext;b=b.productMessage;if(b==null)return;var f=b.product,g=b.businessOwnerJid,h=b.body,i=b.footer;b=b.contextInfo;if(f==null)return;var j=f.productImage,k=f.productId,l=f.currencyCode,m=f.priceAmount1000,n=f.salePriceAmount1000,o=f.retailerId,p=f.url,q=f.productImageCount,r=f.title;f=f.description;var s={};if(j!=null){j=c("WAWebParseImageMessageProto")({messageProtobuf:{imageMessage:j},baseMessage:e,msgContext:a});if(j!=null){a=j.msgData;s={deprecatedMms3Url:a.deprecatedMms3Url,directPath:a.directPath,staticUrl:a.staticUrl,mimetype:a.mimetype,filehash:a.filehash,encFilehash:a.encFilehash,size:a.size,height:a.height,width:a.width,mediaKey:a.mediaKey,mediaKeyTimestamp:a.mediaKeyTimestamp,body:a.body,interactiveAnnotations:a.interactiveAnnotations,scanLengths:a.scanLengths,scansSidecar:a.scansSidecar,isViewOnce:a.isViewOnce,thumbnailDirectPath:a.thumbnailDirectPath,thumbnailSha256:a.thumbnailSha256,thumbnailEncSha256:a.thumbnailEncSha256}}}e=babelHelpers["extends"]({},e,{type:d("WAWebMsgType").MSG_TYPE.PRODUCT,kind:d("WAWebMsgType").MsgKind.Product,businessOwnerJid:g,productId:k,currencyCode:l,priceAmount1000:d("WALongInt").numberOrThrowIfTooLarge((j=m)!=null?j:0)||void 0,salePriceAmount1000:d("WALongInt").numberOrThrowIfTooLarge((a=n)!=null?a:0)||void 0,retailerId:o,url:p,productImageCount:q,title:r,description:f,caption:h,footer:i},s);return{msgData:e,contextInfo:b}}g["default"]=a}),98);
__d("WAWebProtocolRevokeMessageUtils",["WALogger","WAWebAck","WAWebE2EProtoUtils","WAWebHandleMsgError","WAWebHandleMsgMetaUtils","WAWebMsgType","WAWebProtobufsE2E.pb","WAWebWamEnumE2eFailureReason"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["parseProtocolRevokeMessageProto: error:",", stack: ",""]);h=function(){return a};return a}var i=function(b){babelHelpers.inheritsLoose(a,b);function a(){var a,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(a=c=b.call.apply(b,[this].concat(e))||this,c.name="ProtocolRevokeMessageValidationError",a)||babelHelpers.assertThisInitialized(c)}return a}(d("WAWebHandleMsgError").MessageValidationError);function a(a){var b=a.messageProtobuf,c=a.baseMessage,e=a.editAttr,f=a.msgContext;a=a.msgMeta;b=b.protocolMessage;if(b==null)return;var g=b.type;b=b.key;if(f!=="relay"&&g!==d("WAWebProtobufsE2E.pb").Message$ProtocolMessage$Type.EPHEMERAL_SETTING)return;if(g!==d("WAWebProtobufsE2E.pb").Message$ProtocolMessage$Type.REVOKE)return;((f=c.author)==null?void 0:f.isLid())&&d("WAWebHandleMsgMetaUtils").isCommentMsgMeta(a)?g=d("WAWebE2EProtoUtils").translateAddonMessageKeyToLocalReference(b,c):g=d("WAWebE2EProtoUtils").translateRegularMessageKeyToLocalReference(b,c);if(g==null)throw new i("protocol_revoke_missing_key",d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_PROTOCOL_BUFFER);if(e===d("WAWebAck").EDIT_ATTR.ADMIN_REVOKE)f="admin_revoke";else if(e===d("WAWebAck").EDIT_ATTR.SENDER_REVOKE)f="sender_revoke";else throw new i("protocol_revoke_missing_edit_attr",d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_PROTOCOL_BUFFER);try{return{msgData:babelHelpers["extends"]({},c,{type:d("WAWebMsgType").MSG_TYPE.PROTOCOL,kind:d("WAWebMsgType").MsgKind.ProtocolRevoke,subtype:f,protocolMessageKey:g}),contextInfo:null}}catch(a){d("WALogger").WARN(h(),a==null?void 0:a.name,a==null?void 0:a.stack).tags("messaging").sendLogs("ProtocolRevokeParseError");throw a}}g.ProtocolRevokeMessageValidationError=i;g.parseProtocolRevokeMessageProto=a}),98);
__d("WAWebParseProtocolAdminRevokeMessageProto",["WAWebAck","WAWebProtocolRevokeMessageUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=a.messageProtobuf,c=a.baseMessage,e=a.editAttr,f=a.msgContext;a=a.msgMeta;if(e!==d("WAWebAck").EDIT_ATTR.ADMIN_REVOKE)return;return d("WAWebProtocolRevokeMessageUtils").parseProtocolRevokeMessageProto({messageProtobuf:b,baseMessage:c,editAttr:e,msgContext:f,msgMeta:a})}g["default"]=a}),98);
__d("WAWebParseProtocolEphemeralSettingMessageProto",["WAWebE2EProtoUtils","WAWebMsgType","WAWebProtobufsE2E.pb"],(function(a,b,c,d,e,f,g){function a(a){var b=a.messageProtobuf;a=a.baseMessage;b=b.protocolMessage;if(b==null)return;if(b.type!==d("WAWebProtobufsE2E.pb").Message$ProtocolMessage$Type.EPHEMERAL_SETTING)return;var c;b.disappearingMode!=null&&(c=d("WAWebE2EProtoUtils").protoToDisappearingMode(a,b.disappearingMode));a=babelHelpers["extends"]({},a,{type:d("WAWebMsgType").MSG_TYPE.PROTOCOL,kind:d("WAWebMsgType").MsgKind.Protocol,subtype:"ephemeral_setting",ephemeralDuration:b.ephemeralExpiration,disappearingModeTrigger:(a=c)==null?void 0:a.disappearingModeTrigger,disappearingModeInitiatedByMe:(b=c)==null?void 0:b.initiatedByMe});return{msgData:a,contextInfo:void 0}}g["default"]=a}),98);
__d("WAWebParseProtocolHistorySyncNotificationMessageProto",["WAWebE2EProtoParserApi","WAWebMsgType","WAWebProtobufsE2E.pb"],(function(a,b,c,d,e,f,g){function a(a){var b=a.messageProtobuf,c=a.baseMessage;a=a.msgContext;b=b.protocolMessage;if(b==null)return;if(a!=="relay")return;if(b.type!==d("WAWebProtobufsE2E.pb").Message$ProtocolMessage$Type.HISTORY_SYNC_NOTIFICATION)return;a=b.historySyncNotification;if(a==null)return;var e={directPath:a.directPath,encFilehash:d("WAWebE2EProtoParserApi").decodeBytes(a.fileEncSha256),filehash:d("WAWebE2EProtoParserApi").decodeBytes(a.fileSha256),mediaKey:d("WAWebE2EProtoParserApi").decodeBytes(a.mediaKey),type:"md-msg-hist"};a=babelHelpers["extends"]({},c,{type:d("WAWebMsgType").MSG_TYPE.PROTOCOL,kind:d("WAWebMsgType").MsgKind.Protocol,subtype:"history_sync_notification",historySyncMetaData:{historySyncNotification:a,downloadOptions:e,progress:(b==null?void 0:(c=b.historySyncNotification)==null?void 0:c.progress)||0}});return{msgData:a,contextInfo:void 0}}g["default"]=a}),98);
__d("WAWebParseProtocolSenderRevokeMessageProto",["WAWebAck","WAWebProtocolRevokeMessageUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=a.messageProtobuf,c=a.baseMessage,e=a.editAttr,f=a.msgContext;a=a.msgMeta;if(e!==d("WAWebAck").EDIT_ATTR.SENDER_REVOKE)return;return d("WAWebProtocolRevokeMessageUtils").parseProtocolRevokeMessageProto({messageProtobuf:b,baseMessage:c,editAttr:e,msgContext:f,msgMeta:a})}g["default"]=a}),98);
__d("WAWebParseProtocolSharePhoneNumberMessageProto",["WAWebMsgType","WAWebProtobufsE2E.pb"],(function(a,b,c,d,e,f,g){function a(a){var b=a.messageProtobuf;a=a.baseMessage;b=b.protocolMessage;if(b==null)return;if(b.type!==d("WAWebProtobufsE2E.pb").Message$ProtocolMessage$Type.SHARE_PHONE_NUMBER)return;b=babelHelpers["extends"]({},a,{type:d("WAWebMsgType").MSG_TYPE.PROTOCOL,kind:d("WAWebMsgType").MsgKind.Protocol,subtype:"share_phone_number"});return{msgData:b,contextInfo:void 0}}g["default"]=a}),98);
__d("WAWebParseRequestPhoneNumberMessageProto",["WAWebMsgType"],(function(a,b,c,d,e,f,g){function a(a){var b=a.messageProtobuf;a=a.baseMessage;b=b.requestPhoneNumberMessage;if(b==null)return;b=b.contextInfo;a=babelHelpers["extends"]({},a,{type:d("WAWebMsgType").MSG_TYPE.REQUEST_PHONE_NUMBER,kind:d("WAWebMsgType").MsgKind.RequestPhoneNumber});return{msgData:a,contextInfo:b}}g["default"]=a}),98);
__d("WAWebParseTemplateButtonReplyMessageProto",["WAWebE2EProtoUtils","WAWebMsgType"],(function(a,b,c,d,e,f,g){function a(a){var b=a.messageProtobuf;a=a.baseMessage;b=b.templateButtonReplyMessage;if(b==null)return;a=babelHelpers["extends"]({},a,{type:d("WAWebMsgType").MSG_TYPE.TEMPLATE_BUTTON_REPLY,kind:d("WAWebMsgType").MsgKind.TemplateButtonReply,body:d("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis(b.selectedDisplayText),selectedIndex:b.selectedIndex,selectedId:b.selectedId,selectedCarouselCardIndex:b.selectedCarouselCardIndex});return{msgData:a,contextInfo:b.contextInfo}}g["default"]=a}),98);
__d("WAWebParseVcardMessageProto",["WAWebMsgType"],(function(a,b,c,d,e,f,g){function a(a){var b=a.messageProtobuf;a=a.baseMessage;b=b.contactMessage;if(b==null)return;var c=b.contextInfo,e=b.displayName;b=b.vcard;a=babelHelpers["extends"]({},a,{type:d("WAWebMsgType").MSG_TYPE.VCARD,kind:d("WAWebMsgType").MsgKind.Vcard,body:b,vcardFormattedName:e});return{msgData:a,contextInfo:c}}g["default"]=a}),98);
__d("WAWebPollsGatingUtils",["WAWebABProps","WAWebMobilePlatforms","WAWebNewsletterGatingUtils","WAWebPrimaryFeatures","WAWebWid"],(function(a,b,c,d,e,f,g){function h(){if(d("WAWebMobilePlatforms").isSMB()&&!d("WAWebABProps").getABPropConfigValue("parent_group_view_enabled_for_smb_on_web"))return!1;return!d("WAWebPrimaryFeatures").primaryFeatureEnabled("poll_creation_cag")?!1:d("WAWebABProps").getABPropConfigValue("poll_creation_cag_enabled")}function a(){return h()?!0:d("WAWebABProps").getABPropConfigValue("poll_receiving_cag_enabled")}function b(){return Math.min(d("WAWebABProps").getABPropConfigValue("poll_name_length"),500)}function e(){return 5e3}function f(){return Math.min(d("WAWebABProps").getABPropConfigValue("poll_option_length"),255)}function i(){return 2500}function j(){return Math.min(d("WAWebABProps").getABPropConfigValue("poll_option_count"),20)}function k(){return d("WAWebABProps").getABPropConfigValue("poll_result_details_view_enabled")}function l(){return d("WAWebABProps").getABPropConfigValue("polls_fast_follow_enabled")}function m(){return l()}function n(){return l()}function o(){return l()}function p(){return d("WAWebABProps").getABPropConfigValue("polls_single_option_control_enabled")}function q(a){return c("WAWebWid").isNewsletter(a)===!0?d("WAWebNewsletterGatingUtils").isNewsletterPollsSingleOptionEnabled():p()||d("WAWebABProps").getABPropConfigValue("polls_single_option_sender_control_enabled")}function r(a){return q(a)||d("WAWebABProps").getABPropConfigValue("polls_single_option_receiver_control_enabled")}function s(){return d("WAWebABProps").getABPropConfigValue("polls_notification_enabled")}g.isPollsCreationEnabledInCags=h;g.isPollsReceivingEnabledInCags=a;g.getMaxPollNameLength=b;g.getMaxPollNameLengthForIncomingMessages=e;g.getMaxPollOptionLength=f;g.getMaxPollOptionLengthForIncomingMessages=i;g.getMaxPollOptionCount=j;g.isPollResultDetailsViewEnabled=k;g.arePollsFastFollowsEnabled=l;g.isPrefillPollQuestionEnabled=m;g.isPollsCancelationPromptEnabled=n;g.isPollsChatlistPreviewEnabled=o;g.isSingleOptionPollsSendingEnabled=q;g.isSingleOptionPollsReceivingEnabled=r;g.arePollsNotificationsEnabled=s}),98);
__d("WAWebPollsParsePollCreationMessageProto",["WALogger","WAWebMessageSecretErrorsWamEvent","WAWebMsgType","WAWebNewsletterIsNewsletterMsg","WAWebPollsGatingUtils","WAWebPollsValidationError","WAWebWamEnumE2eFailureReason","WAWebWamEnumMessageSecretAllowedType","WAWebWamEnumMessageSecretErrorType"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["PollCreationValidationWarning: ",""]);h=function(){return a};return a}function a(a){var b=a.messageProtobuf,e=a.baseMessage;a=a.msgContext;var f=b.pollCreationMessage,g=b.pollCreationMessageV2,i=b.pollCreationMessageV3;f=(f=(f=f)!=null?f:g)!=null?f:i;var j=!c("WAWebNewsletterIsNewsletterMsg")({from:e.from,to:e.to});if(f==null)return null;if(f===g&&!d("WAWebPollsGatingUtils").isPollsReceivingEnabledInCags())return null;if(f===i&&!d("WAWebPollsGatingUtils").isSingleOptionPollsReceivingEnabled())return null;g=f.name;i=f.options;var k=f.selectableOptionsCount;f=f.contextInfo;if(g==null)throw new(d("WAWebPollsValidationError").PollCreationValidationError)(d("WAWebPollsValidationError").PollCreationValidationErrorCode.MISSING_NAME,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(g.length===0||g.length>d("WAWebPollsGatingUtils").getMaxPollNameLengthForIncomingMessages())throw new(d("WAWebPollsValidationError").PollCreationValidationError)(d("WAWebPollsValidationError").PollCreationValidationErrorCode.INVALID_NAME,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(a==="quoted"||a==="history_quoted"){a=babelHelpers["extends"]({},e,{type:d("WAWebMsgType").MSG_TYPE.POLL_CREATION,kind:d("WAWebMsgType").MsgKind.PollCreation,pollName:g,pollOptions:null,pollSelectableOptionsCount:null});return{msgData:a,contextInfo:f}}b=(a=b.messageContextInfo)==null?void 0:a.messageSecret;if(j&&b==null){new(d("WAWebMessageSecretErrorsWamEvent").MessageSecretErrorsWamEvent)({messageSecretAllowedList:d("WAWebWamEnumMessageSecretAllowedType").MESSAGE_SECRET_ALLOWED_TYPE.MESSAGE_POLL,messageSecretError:d("WAWebWamEnumMessageSecretErrorType").MESSAGE_SECRET_ERROR_TYPE.MISSING_MESSAGE_SECRET}).commit();throw new(d("WAWebPollsValidationError").PollCreationValidationError)(d("WAWebPollsValidationError").PollCreationValidationErrorCode.MISSING_MESSAGE_SECRET,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.MISSING_MESSAGE_SECRET)}if(j&&(b==null?void 0:b.byteLength)!==32){new(d("WAWebMessageSecretErrorsWamEvent").MessageSecretErrorsWamEvent)({messageSecretAllowedList:d("WAWebWamEnumMessageSecretAllowedType").MESSAGE_SECRET_ALLOWED_TYPE.MESSAGE_POLL,messageSecretError:d("WAWebWamEnumMessageSecretErrorType").MESSAGE_SECRET_ERROR_TYPE.WRONG_LENGTH}).commit();throw new(d("WAWebPollsValidationError").PollCreationValidationError)(d("WAWebPollsValidationError").PollCreationValidationErrorCode.INVALID_MESSAGE_SECRET,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.MESSAGE_SECRET_INVALID)}if(i==null)throw new(d("WAWebPollsValidationError").PollCreationValidationError)(d("WAWebPollsValidationError").PollCreationValidationErrorCode.MISSING_OPTIONS,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(k==null)throw new(d("WAWebPollsValidationError").PollCreationValidationError)(d("WAWebPollsValidationError").PollCreationValidationErrorCode.MISSING_SELECTABLE_OPTIONS_COUNT,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);var l=new Set();a=i.map(function(a){a=a.optionName;if(a==null||a.length===0||a.length>d("WAWebPollsGatingUtils").getMaxPollOptionLengthForIncomingMessages())throw new(d("WAWebPollsValidationError").PollCreationValidationError)(d("WAWebPollsValidationError").PollCreationValidationErrorCode.INVALID_OPTION,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(l.has(a)){d("WALogger").WARN(h(),d("WAWebPollsValidationError").PollCreationValidationWarningCode.DUPLICATE_OPTIONS).tags("polls").sendLogs(d("WAWebPollsValidationError").PollCreationValidationWarningCode.DUPLICATE_OPTIONS);return null}var b=l.size;l.add(a);return{name:a,localId:b}}).filter(Boolean);if(a.length<2||a.length>d("WAWebPollsGatingUtils").getMaxPollOptionCount())throw new(d("WAWebPollsValidationError").PollCreationValidationError)(d("WAWebPollsValidationError").PollCreationValidationErrorCode.INVALID_OPTIONS_COUNT,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(k<0||k>a.length)throw new(d("WAWebPollsValidationError").PollCreationValidationError)(d("WAWebPollsValidationError").PollCreationValidationErrorCode.INVALID_SELECTABLE_OPTIONS_COUNT,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);j=babelHelpers["extends"]({},e,{type:d("WAWebMsgType").MSG_TYPE.POLL_CREATION,kind:d("WAWebMsgType").MsgKind.PollCreation,pollName:g,pollOptions:a,pollSelectableOptionsCount:k});return{msgData:j,contextInfo:f}}g["default"]=a}),98);
__d("WAWebPollsParsePollVoteMessageProto",["WALongInt","WAWebE2EProtoUtils","WAWebMsgType","WAWebPollsValidationError","WAWebWamEnumE2eFailureReason"],(function(a,b,c,d,e,f,g){function a(a){var b=a.messageProtobuf;a=a.baseMessage;b=b.pollUpdateMessage;if(!b)return null;var c=b.$$unknownFieldCount;c=c===void 0?0:c;var e=b.vote,f=b.senderTimestampMs;b=b.pollCreationMessageKey;if(c>0)return null;if(b==null)throw new(d("WAWebPollsValidationError").PollUpdateValidationError)(d("WAWebPollsValidationError").PollUpdateValidationErrorCode.MISSING_POLL_MESSAGE_KEY,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);c=d("WAWebE2EProtoUtils").translateRegularMessageKeyToLocalReference(b,a);if(c==null)throw new(d("WAWebPollsValidationError").PollUpdateValidationError)(d("WAWebPollsValidationError").PollUpdateValidationErrorCode.MISSING_POLL_MESSAGE_KEY,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(f==null)throw new(d("WAWebPollsValidationError").PollUpdateValidationError)(d("WAWebPollsValidationError").PollUpdateValidationErrorCode.MISSING_SENDER_TIMESTAMP,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(e==null)throw new(d("WAWebPollsValidationError").PollUpdateValidationError)(d("WAWebPollsValidationError").PollUpdateValidationErrorCode.MISSING_UPDATE,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);b=e.encPayload;e=e.encIv;if(b==null)throw new(d("WAWebPollsValidationError").PollUpdateValidationError)(d("WAWebPollsValidationError").PollUpdateValidationErrorCode.MISSING_VOTE_ENC_PAYLOAD,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(e==null)throw new(d("WAWebPollsValidationError").PollUpdateValidationError)(d("WAWebPollsValidationError").PollUpdateValidationErrorCode.MISSING_VOTE_ENC_IV,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(e.byteLength!==12)throw new(d("WAWebPollsValidationError").PollUpdateValidationError)(d("WAWebPollsValidationError").PollUpdateValidationErrorCode.INVALID_VOTE_ENC_IV,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);return{msgData:babelHelpers["extends"]({},a,{type:d("WAWebMsgType").MSG_TYPE.POLL_UPDATE,kind:d("WAWebMsgType").MsgKind.PollVoteEncrypted,subtype:"poll_vote",addonEncrypted:!0,pollUpdateParentKey:c,encPollVote:{encPayload:b,encIv:e},senderTimestampMs:d("WALongInt").numberOrThrowIfTooLarge(f)}),contextInfo:null}}g["default"]=a}),98);
__d("WAWebAudioMessageProtoUtils",["WALogger","WAWebE2EProtoParserApi"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["fileLength is missing from msg type ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["seconds is 0 in msg type ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["seconds is missing from msg type ",""]);j=function(){return a};return a}function a(a,b){if(!d("WAWebE2EProtoParserApi").shouldLogE2eProtoValidation(a,b))return;a=a.type;b.seconds==null?d("WALogger").LOG(j(),a).sendLogs(a+"-message-missing-seconds"):b.seconds===0&&d("WALogger").LOG(i(),a).sendLogs(a+"-message-incorrect-seconds");b.fileLength==null&&d("WALogger").LOG(h(),a).sendLogs(a+"-message-missing-fileLength")}function b(a){return a.byteLength>=64&&a.byteLength<=192}g.validateRequiredAudioProperties=a;g.validateWaveform=b}),98);
__d("WAWebPttParseAudioMessageProto",["WALongInt","WATimeUtils","WAWebAudioMessageProtoUtils","WAWebE2EProtoParserApi","WAWebMediaMessageGetValidatedProperties","WAWebMsgType"],(function(a,b,c,d,e,f,g){function a(a){var b=a.messageProtobuf,c=a.baseMessage;a=a.msgContext;b=b.audioMessage;if(b==null)return;var e=b.ptt;if(e===!0)return;e=b.contextInfo;var f=b.directPath,g=b.mimetype,h=b.seconds,i=b.mediaKeyTimestamp,j=b.streamingSidecar,k=b.waveform,l=b.backgroundArgb,m=b.viewOnce;a=d("WAWebMediaMessageGetValidatedProperties").getValidatedMediaMessageProperties(b,c,a,d("WAWebMsgType").MSG_TYPE.AUDIO);var n=a.mediaKey,o=a.fileSha256,p=a.fileEncSha256,q=a.fileLength;a=a.url;c=babelHelpers["extends"]({},c,{type:d("WAWebMsgType").MSG_TYPE.AUDIO,kind:d("WAWebMsgType").MsgKind.Audio,deprecatedMms3Url:d("WAWebE2EProtoParserApi").decodeUrl(a),directPath:f,mimetype:g,filehash:d("WAWebE2EProtoParserApi").decodeBytes(o),encFilehash:d("WAWebE2EProtoParserApi").decodeBytes(p),size:q,duration:""+(h||0),mediaKey:d("WAWebE2EProtoParserApi").decodeBytes(n),mediaKeyTimestamp:i!=null?d("WALongInt").numberOrThrowIfTooLarge(i):d("WATimeUtils").unixTime(),streamingSidecar:j,waveform:k&&d("WAWebAudioMessageProtoUtils").validateWaveform(k)?new Uint8Array(k):void 0,backgroundColor:l,isViewOnce:m===!0});d("WAWebE2EProtoParserApi").validateRequiredMediaProperties(c,b);d("WAWebAudioMessageProtoUtils").validateRequiredAudioProperties(c,b);return{msgData:c,contextInfo:e}}g["default"]=a}),98);
__d("WAWebPttParsePttMessageProto",["WALongInt","WATimeUtils","WAWebAudioMessageProtoUtils","WAWebE2EProtoParserApi","WAWebMediaMessageGetValidatedProperties","WAWebMsgType"],(function(a,b,c,d,e,f,g){function a(a){var b=a.messageProtobuf,c=a.baseMessage;a=a.msgContext;b=b.audioMessage;if(b==null)return;var e=b.ptt;if(e!==!0)return;e=b.contextInfo;var f=b.directPath,g=b.mimetype,h=b.seconds,i=b.mediaKeyTimestamp,j=b.streamingSidecar,k=b.waveform,l=b.backgroundArgb,m=b.viewOnce;a=d("WAWebMediaMessageGetValidatedProperties").getValidatedMediaMessageProperties(b,c,a,d("WAWebMsgType").MSG_TYPE.PTT);var n=a.mediaKey,o=a.fileSha256,p=a.fileEncSha256,q=a.fileLength;a=a.url;c=babelHelpers["extends"]({},c,{type:d("WAWebMsgType").MSG_TYPE.PTT,kind:d("WAWebMsgType").MsgKind.Ptt,deprecatedMms3Url:d("WAWebE2EProtoParserApi").decodeUrl(a),directPath:f,mimetype:g,filehash:d("WAWebE2EProtoParserApi").decodeBytes(o),encFilehash:d("WAWebE2EProtoParserApi").decodeBytes(p),size:q,duration:""+(h||0),mediaKey:d("WAWebE2EProtoParserApi").decodeBytes(n),mediaKeyTimestamp:i!=null?d("WALongInt").numberOrThrowIfTooLarge(i):d("WATimeUtils").unixTime(),streamingSidecar:j,waveform:k&&d("WAWebAudioMessageProtoUtils").validateWaveform(k)?new Uint8Array(k):void 0,backgroundColor:l,isViewOnce:m===!0});d("WAWebE2EProtoParserApi").validateRequiredMediaProperties(c,b);d("WAWebAudioMessageProtoUtils").validateRequiredAudioProperties(c,b);return{msgData:c,contextInfo:e}}g["default"]=a}),98);
__d("WAWebPtvGatingUtils",["WAWebABProps"],(function(a,b,c,d,e,f,g){function a(){return d("WAWebABProps").getABPropConfigValue("ptv_sending_enabled")}function b(){return d("WAWebABProps").getABPropConfigValue("ptv_receiving_enabled")}function c(){return d("WAWebABProps").getABPropConfigValue("ptv_autoplay_enabled")}function e(){var a=d("WAWebABProps").getABPropConfigValue("ptv_autoplay_loop_limit");return a===0?Infinity:a}function f(){return d("WAWebABProps").getABPropConfigValue("ptv_max_duration_seconds")}g.isPtvSendingEnabled=a;g.isPtvReceivingEnabled=b;g.isPtvAutoplayEnabled=c;g.getPtvAutoplayLoopLimit=e;g.getPtvMaxDurationSeconds=f}),98);
__d("WAWebPtvParsePtvMessageProto",["WALongInt","WATimeUtils","WAWebE2EProtoParserApi","WAWebE2EProtoUtils","WAWebMsgType","WAWebPtvGatingUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=a.messageProtobuf;a=a.baseMessage;b=b.ptvMessage;if(b==null)return;if(!d("WAWebPtvGatingUtils").isPtvReceivingEnabled())return{msgData:babelHelpers["extends"]({},a,{type:d("WAWebMsgType").MSG_TYPE.UNKNOWN,kind:d("WAWebMsgType").MsgKind.Unknown,futureproofType:d("WAWebMsgType").MSG_TYPE.PTV}),contextInfo:b==null?void 0:b.contextInfo};var c=b.url,e=b.directPath,f=b.staticUrl,g=b.mimetype,h=b.caption,i=b.fileSha256,j=b.fileEncSha256,k=b.fileLength,l=b.height,m=b.width,n=b.mediaKey,o=b.mediaKeyTimestamp,p=b.jpegThumbnail,q=b.interactiveAnnotations,r=b.viewOnce,s=b.thumbnailDirectPath,t=b.thumbnailSha256,u=b.thumbnailEncSha256,v=b.contextInfo,w=b.gifPlayback,x=b.gifAttribution,y=b.seconds,z=b.streamingSidecar;a=babelHelpers["extends"]({},a,{type:d("WAWebMsgType").MSG_TYPE.PTV,kind:d("WAWebMsgType").MsgKind.Ptv,deprecatedMms3Url:d("WAWebE2EProtoParserApi").decodeUrl(c),directPath:e,staticUrl:f||"",mimetype:g,caption:d("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis(h),filehash:d("WAWebE2EProtoParserApi").decodeBytes(i),encFilehash:d("WAWebE2EProtoParserApi").decodeBytes(j),size:d("WALongInt").numberOrThrowIfTooLarge(k||0),height:l,width:m,mediaKey:d("WAWebE2EProtoParserApi").decodeBytes(n),mediaKeyTimestamp:o!=null?d("WALongInt").numberOrThrowIfTooLarge(o):d("WATimeUtils").unixTime(),duration:""+(y||0),body:d("WAWebE2EProtoParserApi").decodeBytes(p)||"",interactiveAnnotations:q,isViewOnce:r===!0,thumbnailDirectPath:s,thumbnailSha256:d("WAWebE2EProtoParserApi").decodeBytes(t),thumbnailEncSha256:d("WAWebE2EProtoParserApi").decodeBytes(u),isGif:w,gifAttribution:x,streamingSidecar:z});d("WAWebE2EProtoParserApi").validateRequiredMediaProperties(a,b);return{msgData:a,contextInfo:v}}g["default"]=a}),98);
__d("WAWebReactionsParseReactionEncMessageProto",["WAWebE2EProtoUtils","WAWebMsgType","WAWebReactionEncMessageValidationError","WAWebWamEnumE2eFailureReason"],(function(a,b,c,d,e,f,g){function a(a){var b=a.messageProtobuf;a=a.baseMessage;b=b.encReactionMessage;if(b==null)return;var c=b.encIv,e=b.encPayload;b=d("WAWebE2EProtoUtils").translateRegularMessageKeyToLocalReference(b.targetMessageKey,a);if(b==null)throw new(d("WAWebReactionEncMessageValidationError").ReactionEncMessageValidationError)(d("WAWebReactionEncMessageValidationError").ReactionEncValidationErrorCode.MISSING_TARGET_MSG_KEY,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_PROTOCOL_BUFFER);if(c==null)throw new(d("WAWebReactionEncMessageValidationError").ReactionEncMessageValidationError)(d("WAWebReactionEncMessageValidationError").ReactionEncValidationErrorCode.INVALID_ENC_IV,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_PROTOCOL_BUFFER);if(e==null)throw new(d("WAWebReactionEncMessageValidationError").ReactionEncMessageValidationError)(d("WAWebReactionEncMessageValidationError").ReactionEncValidationErrorCode.INVALID_ENC_PAYLOAD,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_PROTOCOL_BUFFER);return{msgData:babelHelpers["extends"]({},a,{type:d("WAWebMsgType").MSG_TYPE.REACTION_ENC,kind:d("WAWebMsgType").MsgKind.ReactionEncrypted,encIv:c,encPayload:e,targetMessageKey:b}),contextInfo:null}}g["default"]=a}),98);
__d("WAWebReactionsParseReactionMessageProto",["WALongInt","WAWebConstantsDeprecated","WAWebE2EProtoUtils","WAWebMsgType","WAWebReactionsBEUtils","WAWebReactionsValidationError","WAWebWamEnumE2eFailureReason"],(function(a,b,c,d,e,f,g){function a(a){var b=a.messageProtobuf;a=a.baseMessage;b=b.reactionMessage;if(b==null)return;var c=h(b),e=d("WAWebE2EProtoUtils").translateRegularMessageKeyToLocalReference(b.key,a);b=d("WALongInt").maybeNumberOrThrowIfTooLarge(b.senderTimestampMs);if(e==null)throw new(d("WAWebReactionsValidationError").ReactionValidationError)(d("WAWebReactionsValidationError").ReactionValidationErrorCode.MISSING_PARENT_MSG_KEY,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(b==null)throw new(d("WAWebReactionsValidationError").ReactionValidationError)(d("WAWebReactionsValidationError").ReactionValidationErrorCode.MISSING_TIMESTAMP,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);return{msgData:babelHelpers["extends"]({},a,{type:d("WAWebMsgType").MSG_TYPE.REACTION,kind:d("WAWebMsgType").MsgKind.ReactionDecrypted,reactionParentKey:e,reactionText:c,reactionTimestamp:b}),contextInfo:null}}function h(a){a=a.text;if(a!=null&&a.length>c("WAWebConstantsDeprecated").REACTION_CONTENT_MAX_LENGTH)throw new(d("WAWebReactionsValidationError").ReactionValidationError)(d("WAWebReactionsValidationError").ReactionValidationErrorCode.INVALID_REACTION_TEXT_LENGTH,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_REACTION_TEXT);return(a=d("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis(a))!=null?a:d("WAWebReactionsBEUtils").REVOKED_REACTION_TEXT}g["default"]=a}),98);
__d("WABase64Sanitize",["WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["base64 sanitized due to extra whitespace"]);h=function(){return a};return a}function a(a){if(a==null)return null;var b=a.replace(/\s+$/,"");a!==b&&Math.random()<1e-5&&d("WALogger").WARN(h()).sendLogs("media-key-sanitize");return b}g["default"]=a}),98);
__d("WAWebStickersParseStickerMessageProto",["WABase64Sanitize","WALongInt","WATimeUtils","WAWebE2EProtoParserApi","WAWebLottieStickersGatingUtils","WAWebMediaMessageGetValidatedProperties","WAWebMsgType"],(function(a,b,c,d,e,f,g){function a(a){var b=a.messageProtobuf,e=a.baseMessage;a=a.msgContext;var f=b==null?void 0:b.lottieStickerMessage;f=f==null?void 0:(f=f.message)==null?void 0:f.stickerMessage;b=b==null?void 0:b.stickerMessage;if(f!=null){if(!d("WAWebLottieStickersGatingUtils").isLottieStickerReceivingEnabled())return{msgData:babelHelpers["extends"]({},e,{type:d("WAWebMsgType").MSG_TYPE.UNKNOWN,kind:d("WAWebMsgType").MsgKind.Unknown,futureproofType:d("WAWebMsgType").MSG_TYPE.STICKER}),contextInfo:f==null?void 0:f.contextInfo};b=f}if(b==null)return;f=d("WAWebMediaMessageGetValidatedProperties").getValidatedMediaMessageProperties(b,e,a,d("WAWebMsgType").MSG_TYPE.STICKER);a=f.mediaKey;var g=f.fileSha256,h=f.fileEncSha256;f=f.url;e=babelHelpers["extends"]({},e,{type:d("WAWebMsgType").MSG_TYPE.STICKER,kind:d("WAWebMsgType").MsgKind.Sticker,deprecatedMms3Url:d("WAWebE2EProtoParserApi").decodeUrl(f),directPath:b.directPath||"",mimetype:b.mimetype||"",filehash:d("WAWebE2EProtoParserApi").decodeBytes(g),encFilehash:d("WAWebE2EProtoParserApi").decodeBytes(h),mediaKey:c("WABase64Sanitize")(d("WAWebE2EProtoParserApi").decodeBytes(a)),mediaKeyTimestamp:b.mediaKeyTimestamp!=null?d("WALongInt").numberOrThrowIfTooLarge(b.mediaKeyTimestamp):d("WATimeUtils").unixTime(),height:b.height||0,width:b.width||0,firstFrameLength:b.firstFrameLength,firstFrameSidecar:b.firstFrameSidecar,isAnimated:b.isAnimated,isLottie:b.isLottie,stickerSentTs:d("WALongInt").maybeNumberOrThrowIfTooLarge(b.stickerSentTs),isAvatar:b.isAvatar});d("WAWebE2EProtoParserApi").validateRequiredMediaProperties(e,b);return{msgData:e,contextInfo:b.contextInfo}}g["default"]=a}),98);
__d("WAWebMessagePluginParseProtobufRegistry",["WAWebEventsParseEventCreationMessageProto","WAWebEventsParseEventEditEncryptedMessageProto","WAWebEventsParseEventResponseMessageProto","WAWebParseBizContentPlaceholderProto","WAWebParseBotFeedbackProtocolMessageProto","WAWebParseBotRequestWelcomeMessageProto","WAWebParseButtonsResponseMessageProto","WAWebParseCancelPaymentMessageProto","WAWebParseChatMessageProto","WAWebParseDeclinePaymentMessageProto","WAWebParseDocumentMessageProto","WAWebParseEncCommentMessageProto","WAWebParseEphemeralSyncResponseMessageProto","WAWebParseExtendedTextUrlChatMessageProto","WAWebParseGroupInviteMessageProto","WAWebParseHsmMessageProto","WAWebParseImageMessageProto","WAWebParseInteractiveMessageProto","WAWebParseInteractiveResponseMessageProto","WAWebParseKeepInChatMessageProto","WAWebParseListMessageProto","WAWebParseListResponseMessageProto","WAWebParseLocationMessageProto","WAWebParseMultiVcardMessageProto","WAWebParseNativeFlowButtonsMessageProto","WAWebParseNewsletterAdminInviteMessageProto","WAWebParseOrderMessageProto","WAWebParsePaymentInviteMessageProto","WAWebParsePinMessageProto","WAWebParseProductMessageProto","WAWebParseProtocolAdminRevokeMessageProto","WAWebParseProtocolEphemeralSettingMessageProto","WAWebParseProtocolHistorySyncNotificationMessageProto","WAWebParseProtocolMessageEditProto","WAWebParseProtocolSenderRevokeMessageProto","WAWebParseProtocolSharePhoneNumberMessageProto","WAWebParseRequestPaymentMessageProto","WAWebParseRequestPhoneNumberMessageProto","WAWebParseSendPaymentMessageProto","WAWebParseTemplateButtonReplyMessageProto","WAWebParseVcardMessageProto","WAWebParseVideoMessageProto","WAWebPollsParsePollCreationMessageProto","WAWebPollsParsePollVoteMessageProto","WAWebPttParseAudioMessageProto","WAWebPttParsePttMessageProto","WAWebPtvParsePtvMessageProto","WAWebReactionsParseReactionEncMessageProto","WAWebReactionsParseReactionMessageProto","WAWebStickersParseStickerMessageProto"],(function(a,b,c,d,e,f,g){a=[c("WAWebEventsParseEventCreationMessageProto"),c("WAWebEventsParseEventEditEncryptedMessageProto"),c("WAWebEventsParseEventResponseMessageProto"),c("WAWebParseBizContentPlaceholderProto"),c("WAWebParseBotFeedbackProtocolMessageProto"),c("WAWebParseBotRequestWelcomeMessageProto"),c("WAWebParseButtonsResponseMessageProto"),c("WAWebParseCancelPaymentMessageProto"),c("WAWebParseChatMessageProto"),c("WAWebParseDeclinePaymentMessageProto"),c("WAWebParseDocumentMessageProto"),c("WAWebParseEncCommentMessageProto"),c("WAWebParseEphemeralSyncResponseMessageProto"),c("WAWebParseExtendedTextUrlChatMessageProto"),c("WAWebParseGroupInviteMessageProto"),c("WAWebParseHsmMessageProto"),c("WAWebParseImageMessageProto"),c("WAWebParseInteractiveMessageProto"),c("WAWebParseInteractiveResponseMessageProto"),c("WAWebParseKeepInChatMessageProto"),c("WAWebParseListMessageProto"),c("WAWebParseListResponseMessageProto"),c("WAWebParseLocationMessageProto"),c("WAWebParseMultiVcardMessageProto"),c("WAWebParseNativeFlowButtonsMessageProto"),c("WAWebParseNewsletterAdminInviteMessageProto"),c("WAWebParseOrderMessageProto"),c("WAWebParsePaymentInviteMessageProto"),c("WAWebParsePinMessageProto"),c("WAWebParseProductMessageProto"),c("WAWebParseProtocolAdminRevokeMessageProto"),c("WAWebParseProtocolEphemeralSettingMessageProto"),c("WAWebParseProtocolHistorySyncNotificationMessageProto"),c("WAWebParseProtocolMessageEditProto"),c("WAWebParseProtocolSenderRevokeMessageProto"),c("WAWebParseProtocolSharePhoneNumberMessageProto"),c("WAWebParseRequestPaymentMessageProto"),c("WAWebParseRequestPhoneNumberMessageProto"),c("WAWebParseSendPaymentMessageProto"),c("WAWebParseTemplateButtonReplyMessageProto"),c("WAWebParseVcardMessageProto"),c("WAWebParseVideoMessageProto"),c("WAWebPollsParsePollCreationMessageProto"),c("WAWebPollsParsePollVoteMessageProto"),c("WAWebPttParseAudioMessageProto"),c("WAWebPttParsePttMessageProto"),c("WAWebPtvParsePtvMessageProto"),c("WAWebReactionsParseReactionEncMessageProto"),c("WAWebReactionsParseReactionMessageProto"),c("WAWebStickersParseStickerMessageProto")];g["default"]=a}),98);
__d("WAWebMultipleMessageParserPluginParseProtobuf",["WAWebMultipleMessageParserPluginParseProtobufRegistry"],(function(a,b,c,d,e,f,g){function a(a){var b=[],d;for(var e=c("WAWebMultipleMessageParserPluginParseProtobufRegistry"),f=Array.isArray(e),g=0,e=f?e:e[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var h;if(f){if(g>=e.length)break;h=e[g++]}else{g=e.next();if(g.done)break;h=g.value}h=h;h=h(a);if(h!=null){var i;b.push(h.msgData.type+":"+((i=h.msgData.subtype)!=null?i:"null"));d==null&&(d=h)}}return{result:d,pluginsMatched:b}}g.parseProtobufWithMultipleMessageParserPlugin=a}),98);
__d("WAWebParseNonNFMButtonsMessageProto",["WAWebButtonsMessageProtoUtils","WAWebE2EProtoUtils","WAWebInteractiveMessagesNativeFlowName","WAWebMsgType","WAWebProtobufsE2E.pb"],(function(a,b,c,d,e,f,g){function a(a){var b=a.messageProtobuf,e=a.baseMessage,f=a.bizInfo;a=a.msgContext;b=b.buttonsMessage;if(b==null)return;var g=b.buttons;g=g===void 0?[]:g;var h=b.headerType,i=c("WAWebInteractiveMessagesNativeFlowName").cast(d("WAWebE2EProtoUtils").getBizNativeFlowName({buttonsMessage:b}));if(i!=null||(f==null?void 0:f.nativeFlowName)!=null)return;if(d("WAWebE2EProtoUtils").hasUnsupportedButtons(g))return{msgData:babelHelpers["extends"]({},e,{type:d("WAWebMsgType").MSG_TYPE.UNKNOWN,kind:d("WAWebMsgType").MsgKind.Unknown,subtype:"phone_only_feature"}),contextInfo:b.contextInfo};if(h===d("WAWebProtobufsE2E.pb").Message$ButtonsMessage$HeaderType.UNKNOWN||!new Set(d("WAWebProtobufsE2E.pb").Message$ButtonsMessage$HeaderType.members()).has(h))return{msgData:babelHelpers["extends"]({},e,{type:d("WAWebMsgType").MSG_TYPE.UNKNOWN,kind:d("WAWebMsgType").MsgKind.Unknown}),contextInfo:b.contextInfo};i=d("WAWebButtonsMessageProtoUtils").parseButtonsMessageProto({buttonsMessage:b,baseMessage:e,msgContext:a});return g.length?{msgData:babelHelpers["extends"]({},i,{isDynamicReplyButtonsMsg:!0,dynamicReplyButtons:g}),contextInfo:b.contextInfo}:{msgData:i,contextInfo:b.contextInfo}}g["default"]=a}),98);
__d("WAWebTemplateButtonSubtype",[],(function(a,b,c,d,e,f){a={QUICK_REPLY:"quick_reply",CALL:"call",URL:"url"};f.TEMPLATE_BUTTON_SUBTYPE=a}),66);
__d("WAWebParseTemplateMessageProto",["WANullthrows","WAWebE2EProtoUtils","WAWebMsgType","WAWebParseDocumentMessageProto","WAWebParseImageMessageProto","WAWebParseInteractiveMessageProto","WAWebParseLocationMessageProto","WAWebParseVideoMessageProto","WAWebTemplateButtonSubtype"],(function(a,b,c,d,e,f,g){var h=3,i=function(a){var b="";a.callButton!=null?b=d("WAWebTemplateButtonSubtype").TEMPLATE_BUTTON_SUBTYPE.CALL:a.quickReplyButton!=null?b=d("WAWebTemplateButtonSubtype").TEMPLATE_BUTTON_SUBTYPE.QUICK_REPLY:a.urlButton!=null&&(b=d("WAWebTemplateButtonSubtype").TEMPLATE_BUTTON_SUBTYPE.URL);return b},j=function(a){if(a.length>h)return!0;if(a.length>0){var b=i(a[0]);if(!a.slice(1).every(function(a){a=i(a);if(b===d("WAWebTemplateButtonSubtype").TEMPLATE_BUTTON_SUBTYPE.QUICK_REPLY)return a===b;if(b===d("WAWebTemplateButtonSubtype").TEMPLATE_BUTTON_SUBTYPE.URL||b===d("WAWebTemplateButtonSubtype").TEMPLATE_BUTTON_SUBTYPE.CALL)return a===d("WAWebTemplateButtonSubtype").TEMPLATE_BUTTON_SUBTYPE.URL||a===d("WAWebTemplateButtonSubtype").TEMPLATE_BUTTON_SUBTYPE.CALL}))return!0}return!1};function a(a){var b=a.messageProtobuf,e=a.baseMessage,f=a.msgContext;a=b.templateMessage;if(a==null)return;b=a.interactiveMessageTemplate;if(b)return k(e,f,b,a.templateId);b=(b=a.hydratedTemplate)!=null?b:c("WANullthrows")(a.hydratedFourRowTemplate);var g=b.documentMessage,h=b.imageMessage,i=b.locationMessage,l=b.videoMessage;a=b.hydratedButtons;var m=b.hydratedContentText,n=b.hydratedFooterText,o=b.hydratedTitleText;b=b.templateId;var p=function(){var a=babelHelpers["extends"]({},e,{type:d("WAWebMsgType").MSG_TYPE.CHAT,kind:d("WAWebMsgType").MsgKind.Chat},Boolean(m)&&{body:d("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis(m)});if(h){var b;return(b=(b=c("WAWebParseImageMessageProto")({messageProtobuf:{imageMessage:h},baseMessage:e,msgContext:f}))==null?void 0:b.msgData)!=null?b:a}if(g){return(b=(b=c("WAWebParseDocumentMessageProto")({messageProtobuf:{documentMessage:g},baseMessage:e,msgContext:f}))==null?void 0:b.msgData)!=null?b:a}if(i){return(b=(b=c("WAWebParseLocationMessageProto")({messageProtobuf:{locationMessage:i},baseMessage:e,msgContext:f}))==null?void 0:b.msgData)!=null?b:a}if(l){return(b=(b=c("WAWebParseVideoMessageProto")({messageProtobuf:{videoMessage:l},baseMessage:e,msgContext:f}))==null?void 0:b.msgData)!=null?b:a}return a};if(j(a))return{msgData:babelHelpers["extends"]({},e,{type:d("WAWebMsgType").MSG_TYPE.UNKNOWN,kind:d("WAWebMsgType").MsgKind.Unknown,subtype:"phone_only_feature"}),contextInfo:void 0};p=p();return{msgData:babelHelpers["extends"]({},p,{templateId:b,isFromTemplate:!0,caption:Boolean(m)?d("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis(m):p.caption,footer:Boolean(n)?d("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis(n):p.footer,title:Boolean(o)?d("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis(o):p.title},a.length>0&&{hydratedButtons:a}),contextInfo:void 0}}function k(a,b,e,f){var g;g=babelHelpers["extends"]({},a,{type:d("WAWebMsgType").MSG_TYPE.CHAT,kind:d("WAWebMsgType").MsgKind.Chat},Boolean((g=e.body)==null?void 0:g.text)&&{body:d("WAWebE2EProtoUtils").convertToTextWithoutSpecialEmojis((g=e.body)==null?void 0:g.text)});a=(b=(e=c("WAWebParseInteractiveMessageProto")({messageProtobuf:{interactiveMessage:e},baseMessage:a,msgContext:b,bizSource:a.bizSource||""}))==null?void 0:e.msgData)!=null?b:g;return{msgData:babelHelpers["extends"]({},a,{templateId:f,isFromTemplate:!0,caption:a.caption,footer:a.footer,title:a.title}),contextInfo:void 0}}g["default"]=a}),98);
__d("WAWebMultipleMessageParserPluginParseProtobufRegistry",["WAWebParseHistorySyncProtocolMessageEditProto","WAWebParseNonNFMButtonsMessageProto","WAWebParseTemplateMessageProto"],(function(a,b,c,d,e,f,g){a=[c("WAWebParseHistorySyncProtocolMessageEditProto"),c("WAWebParseNonNFMButtonsMessageProto"),c("WAWebParseTemplateMessageProto")];g["default"]=a}),98);
__d("WAWebParseForwardedNewsletterMessageInfo",["WALogger","WAWebChatEntryPoint","WAWebE2EProtoUtils","WAWebProtobufsE2E.pb","WAWebWidFactory"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Did not receive content type from newsletter annotation"]);h=function(){return a};return a}function a(a){var b=a.newsletterJid,c=a.newsletterName;a=a.serverMessageId;b=d("WAWebE2EProtoUtils").strictDecodeJid(b);return{newsletterId:b!=null?d("WAWebWidFactory").toNewsletterWid(b):void 0,newsletterName:c,serverMessageId:a}}function b(a){var b;b=a==null?void 0:(b=a.newsletter)==null?void 0:b.contentType;if(b==null){var c;d("WALogger").WARN(h()).tags("newsletter-logging").devConsole(a).sendLogs("Missing content type in newsletter annotation");return(a==null?void 0:(c=a.newsletter)==null?void 0:c.serverMessageId)==null?d("WAWebChatEntryPoint").ChatEntryPoint.NewsletterLinkCard:d("WAWebChatEntryPoint").ChatEntryPoint.NewsletterPostLinkCard}return b===d("WAWebProtobufsE2E.pb").ContextInfo$ForwardedNewsletterMessageInfo$ContentType.LINK_CARD?a.shouldSkipConfirmation===!0?d("WAWebChatEntryPoint").ChatEntryPoint.NewsletterLinkCardButton:d("WAWebChatEntryPoint").ChatEntryPoint.NewsletterLinkCard:d("WAWebChatEntryPoint").ChatEntryPoint.NewsletterPostLinkCard}g.parseForwardedNewsletterMessageInfo=a;g.getChatEntryPointFromNewsletterLinkAnnotation=b}),98);
__d("WAWebViewOnceGatingUtils",["WAWebABProps"],(function(a,b,c,d,e,f,g){function a(){return d("WAWebABProps").getABPropConfigValue("view_once_sp_receiver")}function b(){return d("WAWebABProps").getABPropConfigValue("enable_soox_message_receiving")}function c(){return d("WAWebABProps").getABPropConfigValue("enable_soox_message_sending")}g.isViewOnceSunsetEnabled=a;g.isReceivingViewOnceV2Enabled=b;g.isSendingViewOnceV2Enabled=c}),98);
__d("WAWebE2EProtoParser",["WALogger","WANullthrows","WAWebBotGating","WAWebE2EProtoParserApi","WAWebE2EProtoUtils","WAWebLinkify","WAWebMessagePluginParseProtobuf","WAWebMsgType","WAWebParseForwardedNewsletterMessageInfo","WAWebViewOnceGatingUtils"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["parseContextInfoProto: failed to parse forwarded newsletter info"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["parseContextInfoProto: payment not supported"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["drop: not Message"]);j=function(){return a};return a}function k(a,b,c,e,f,g,h,i,k,n,o){a||d("WALogger").ERROR(j()).devConsole(a,b).sendLogs("null-message");var p=a.messageContextInfo;a=l(a,b,c,e,f,g,h,i,k,n,o);b=a.contextInfo;e=a.msgData;m(e,b,c,g);r(e,p);return e}function l(a,b,c,e,f,g,h,i,j,k,l){var m,n=a.viewOnceMessage,o=a.viewOnceMessageV2,r=a.viewOnceMessageV2Extension,s=a.ephemeralMessage,t=a.documentWithCaptionMessage,u=a.groupMentionedMessage,v=a.editedMessage,w=a.botInvokeMessage;e=d("WAWebMessagePluginParseProtobuf").parseProtobuf({messageProtobuf:a,baseMessage:b,msgContext:c,paymentInfo:e,quotedPaymentInfo:g,editAttr:i,bizInfo:h,finalLocation:f,rcat:j,bizSource:k,msgMeta:l});if(e)return e;u&&q(b,u,c);t&&q(b,t,c);n&&q(b,n,c);d("WAWebViewOnceGatingUtils").isViewOnceSunsetEnabled()&&(o&&q(b,o,c),r&&d("WAWebViewOnceGatingUtils").isReceivingViewOnceV2Enabled()&&q(b,r,c));s&&q(b,s,c);v&&q(b,v,c);g=a.deviceSentMessage;g&&p(b,g,c);w&&d("WAWebBotGating").isBotResponseFutureproofMsgEnabled()&&q(b,w,c);return{contextInfo:m,msgData:b}}function m(a,b,c,d){if(!b)return;n(a,b,c,d);o(a,b)}function n(a,b,c,e){var f=b.quotedMessage,g=b.mentionedJid,j=b.groupMentions;if(f!=null&&d("WAWebE2EProtoUtils").isQuotedSupported(f)){var l=a.selectedCarouselCardIndex!=null;a.quotedMsg=k(f,{type:d("WAWebMsgType").MSG_TYPE.UNKNOWN},c==="history"?"history_quoted":"quoted",null,null,null,null,null,null,l?"quoted_carousel_card":null)}a.quotedMsg&&a.quotedMsg.type==="payment"&&e&&d("WALogger").LOG(i());a.quotedStanzaID=b.stanzaId;a.quotedParticipant=d("WAWebE2EProtoUtils").decodeJid(b.participant);a.quotedRemoteJid=d("WAWebE2EProtoUtils").decodeJid(b.remoteJid);a.quotedGroupSubject=d("WAWebE2EProtoUtils").decodeJid(b.groupSubject);a.quotedParentGroupJid=d("WAWebE2EProtoUtils").decodeJid(b.parentGroupJid);a.mentionedJidList=Array.isArray(g)?g.map(d("WAWebE2EProtoUtils").decodeJid):g;a.groupMentions=Array.isArray(j)?j.map(function(a){return{groupSubject:a.groupSubject,groupJid:d("WAWebE2EProtoUtils").decodeJid(a.groupJid)}}):j;a.isForwarded=b.isForwarded;a.forwardingScore=b.forwardingScore;b.expiration!=null&&(a.ephemeralDuration=b.expiration);b.ephemeralSettingTimestamp!=null&&(a.ephemeralSettingTimestamp=b.ephemeralSettingTimestamp);b.ephemeralSharedSecret!=null&&(a.ephemeralSharedSecret=b.ephemeralSharedSecret);f=b.disappearingMode;if(f!=null){c=d("WAWebE2EProtoUtils").protoToDisappearingModeInitiator(a,f);c!=null&&(a.disappearingModeInitiator=c);l=d("WAWebE2EProtoUtils").protoToDisappearingMode(a,f);l!=null&&(a.disappearingModeTrigger=l.disappearingModeTrigger,a.disappearingModeInitiatedByMe=l.initiatedByMe)}b.actionLink!=null&&(a.actionLink=b.actionLink);b.smbClientCampaignId!=null&&(a.smbClientCampaignId=b.smbClientCampaignId);if(b.forwardedNewsletterMessageInfo!=null)try{a.forwardedNewsletterMessageInfo=d("WAWebParseForwardedNewsletterMessageInfo").parseForwardedNewsletterMessageInfo(b.forwardedNewsletterMessageInfo)}catch(a){d("WALogger").ERROR(h()).devConsole(a).sendLogs("Failed to parse Forwarded Newsletter Message Info.")}}function o(a,b){var c=b.externalAdReply;if(!c)return;var e=d("WAWebLinkify").findLink(c.sourceUrl||"",!1,a.from);a.ctwaContext={conversionSource:b.conversionSource,conversionData:b.conversionData,sourceUrl:c.sourceUrl,description:c.body,title:c.title,thumbnail:c.thumbnail?d("WAWebE2EProtoParserApi").decodeBytes(c.thumbnail):null,thumbnailUrl:c.thumbnailUrl,mediaType:c.mediaType,mediaUrl:c.mediaUrl,isSuspiciousLink:(e==null?void 0:e.suspiciousCharacters)&&e.suspiciousCharacters.size>0}}function p(a,b,c){var e=d("WAWebE2EProtoUtils").decodeJid(b.destinationJid);a.id.remote=e;a.to=e;Object.assign(a,k(b.message,a,c))}function q(a,b,d){Object.assign(a,k(c("WANullthrows")(b.message),a,d))}function r(a,b){var c;if(!b)return;b.messageSecret!=null&&(a.messageSecret=new Uint8Array(b.messageSecret));if(d("WAWebBotGating").isBotReceiveEnabled()&&(((c=a.id)==null?void 0:(c=c.participant)==null?void 0:c.isBot())||((c=a.id)==null?void 0:(c=c.remote)==null?void 0:c.isBot()))){(b==null?void 0:(c=b.botMetadata)==null?void 0:(c=c.pluginMetadata)==null?void 0:c.pluginType)!=null?a.botPluginType=b.botMetadata.pluginMetadata.pluginType:(b==null?void 0:(c=b.botMetadata)==null?void 0:c.pluginMetadata)!=null&&(a.botPluginMaybeParent=!0);(b==null?void 0:(c=b.botMetadata)==null?void 0:(c=c.pluginMetadata)==null?void 0:c.referenceIndex)!=null&&(a.botPluginReferenceIndex=b.botMetadata.pluginMetadata.referenceIndex);(b==null?void 0:(c=b.botMetadata)==null?void 0:(c=c.pluginMetadata)==null?void 0:c.provider)!=null&&(a.botPluginSearchProvider=b.botMetadata.pluginMetadata.provider);(b==null?void 0:(c=b.botMetadata)==null?void 0:(c=c.pluginMetadata)==null?void 0:c.searchProviderUrl)!=null&&(a.botPluginSearchUrl=b.botMetadata.pluginMetadata.searchProviderUrl);(b==null?void 0:(c=b.botMetadata)==null?void 0:(c=c.pluginMetadata)==null?void 0:c.thumbnailCdnUrl)!=null&&(a.botReelPluginThumbnailCdnUrl=b.botMetadata.pluginMetadata.thumbnailCdnUrl)}}g.parseMsgProto=k;g.parseContextInfoProto=n;g.parseMessageContextInfoProto=r}),98);
__d("WAWebParseHistorySyncProtocolMessageEditProto",["WALogger","WALongInt","WANullthrows","WAWebE2EProtoParser","WAWebE2EProtoUtils","WAWebMessageEditGatingUtils","WAWebMsgType","WAWebProtobufsE2E.pb"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["parseHistorySyncEditedMessageProto: error:",", stack: ",""]);h=function(){return a};return a}function a(a){var b=a.messageProtobuf,e=a.baseMessage;a=a.msgContext;b=b.protocolMessage;if(b==null||(b==null?void 0:b.type)!==d("WAWebProtobufsE2E.pb").Message$ProtocolMessage$Type.MESSAGE_EDIT)return;if(a==="relay")return;try{if(!d("WAWebMessageEditGatingUtils").receiveTextEditEnabled())return{msgData:babelHelpers["extends"]({},e,{type:d("WAWebMsgType").MSG_TYPE.UNKNOWN,kind:d("WAWebMsgType").MsgKind.Unknown,subtype:"message_edit",futureproofType:d("WAWebMsgType").MSG_TYPE.PROTOCOL,futureproofSubtype:"message_edit"}),contextInfo:null};a=babelHelpers["extends"]({},e,{latestEditSenderTimestampMs:d("WALongInt").maybeNumberOrThrowIfTooLarge(b.timestampMs),latestEditMsgKey:e.id});Object.assign(a,d("WAWebE2EProtoParser").parseMsgProto(c("WANullthrows")(b.editedMessage),a));a.id=d("WAWebE2EProtoUtils").protobufToMsgKey(c("WANullthrows")(b.key),a.author);return{msgData:a,contextInfo:null}}catch(a){d("WALogger").WARN(h(),a==null?void 0:a.name,a==null?void 0:a.stack).tags("messaging").sendLogs("parseHistorySyncEditedMessageProto: EditParseError");throw a}}g["default"]=a}),98);
__d("WAWebFutureproofingEdit",["WAWebMsgType"],(function(a,b,c,d,e,f,g){function a(a){return babelHelpers["extends"]({},a,{type:d("WAWebMsgType").MSG_TYPE.UNKNOWN,kind:d("WAWebMsgType").MsgKind.Unknown,subtype:"message_edit",futureproofType:d("WAWebMsgType").MSG_TYPE.PROTOCOL,futureproofSubtype:"message_edit"})}g.futureproofEdit=a}),98);
__d("WAWebParseProtocolMessageEditProto",["WALogger","WALongInt","WANullthrows","WAWebE2EProtoParser","WAWebE2EProtoUtils","WAWebFutureproofingEdit","WAWebMessageEditGatingUtils","WAWebMsgType","WAWebProtobufsE2E.pb"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["parseProtocolMessageEditProto: error:",", stack: ",""]);h=function(){return a};return a}function a(a){var b=a.messageProtobuf,c=a.baseMessage;a=a.msgContext;b=b.protocolMessage;if(b==null||(b==null?void 0:b.type)!==d("WAWebProtobufsE2E.pb").Message$ProtocolMessage$Type.MESSAGE_EDIT)return;if(a!=="relay")return;try{a=(a=i(c,b))!=null?a:j(c,b);return!a?null:a}catch(a){d("WALogger").WARN(h(),a==null?void 0:a.name,a==null?void 0:a.stack).tags("messaging").sendLogs("parseProtocolMessageEditProto: EditParseError");throw a}}function i(a,b){var e;e=(e=(e=b.editedMessage)==null?void 0:(e=e.groupMentionedMessage)==null?void 0:e.message)!=null?e:b.editedMessage;var f=Boolean(e==null?void 0:e.conversation)||Boolean(e==null?void 0:e.extendedTextMessage);if(!f)return null;if(!d("WAWebMessageEditGatingUtils").receiveTextEditEnabled())return{msgData:d("WAWebFutureproofingEdit").futureproofEdit(a),contextInfo:null};f=d("WAWebE2EProtoUtils").translateRegularMessageKeyToLocalReference(b.key,a);e=babelHelpers["extends"]({},d("WAWebE2EProtoParser").parseMsgProto(c("WANullthrows")(e),a),{type:d("WAWebMsgType").MSG_TYPE.PROTOCOL,kind:d("WAWebMsgType").MsgKind.Protocol,subtype:"message_edit",editMsgType:d("WAWebMsgType").MSG_TYPE.CHAT,latestEditSenderTimestampMs:d("WALongInt").maybeNumberOrThrowIfTooLarge(b.timestampMs),latestEditMsgKey:a.id,protocolMessageKey:f});return{msgData:e,contextInfo:null}}function j(a,b){var c;c=(c=(c=b.editedMessage)==null?void 0:(c=c.groupMentionedMessage)==null?void 0:c.message)!=null?c:b.editedMessage;var e,f,g;if(c==null?void 0:c.imageMessage)e=d("WAWebMsgType").MSG_TYPE.IMAGE,f=c.imageMessage.caption,g=c.imageMessage.contextInfo;else if(c==null?void 0:c.videoMessage)e=d("WAWebMsgType").MSG_TYPE.VIDEO,f=c.videoMessage.caption,g=c.videoMessage.contextInfo;else if(c==null?void 0:c.documentMessage)e=d("WAWebMsgType").MSG_TYPE.DOCUMENT,f=c.documentMessage.caption,g=c.documentMessage.contextInfo;else if(c==null?void 0:c.documentWithCaptionMessage){var h;e=d("WAWebMsgType").MSG_TYPE.DOCUMENT;f=(h=c.documentWithCaptionMessage)==null?void 0:(h=h.message)==null?void 0:(h=h.documentMessage)==null?void 0:h.caption;g=(h=c.documentWithCaptionMessage)==null?void 0:(c=h.message)==null?void 0:(h=c.documentMessage)==null?void 0:h.contextInfo}if(!e||f===""||f==null)return null;if(!d("WAWebMessageEditGatingUtils").receiveCaptionEditEnabled())return{msgData:d("WAWebFutureproofingEdit").futureproofEdit(a),contextInfo:null};c=babelHelpers["extends"]({},a,{type:d("WAWebMsgType").MSG_TYPE.PROTOCOL,kind:d("WAWebMsgType").MsgKind.Protocol,subtype:"message_edit",editMsgType:e,caption:f,latestEditSenderTimestampMs:d("WALongInt").maybeNumberOrThrowIfTooLarge(b.timestampMs),latestEditMsgKey:a.id,protocolMessageKey:d("WAWebE2EProtoUtils").translateRegularMessageKeyToLocalReference(b.key,a)});return{msgData:c,contextInfo:g}}g["default"]=a}),98);
__d("WAWebParseRequestPaymentMessageProto",["WALogger","WALongInt","WANullthrows","WAWebE2EProtoParser","WAWebE2EProtoUtils","WAWebMsgType","WAWebProtobufsWeb.pb"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["parseRequestPaymentMessageProto: does not support novi transactions"]);h=function(){return a};return a}function a(a){var b,e=a.messageProtobuf,f=a.baseMessage,g=a.paymentInfo;a=a.msgContext;e=e.requestPaymentMessage;if(e==null)return;b=(b=e.noteMessage)==null?void 0:(b=b.extendedTextMessage)==null?void 0:b.contextInfo;if((g==null?void 0:g.futureproofed)||d("WAWebE2EProtoUtils").hasUnsupportedCurrency(g)){d("WALogger").LOG(h());return{msgData:babelHelpers["extends"]({},f,{type:d("WAWebMsgType").MSG_TYPE.PAYMENT,kind:d("WAWebMsgType").MsgKind.Payment,subtype:"phone_only_feature"}),contextInfo:b}}var i=e.background,j=e.noteMessage,k=(j==null?void 0:j.extendedTextMessage)!=null||(j==null?void 0:j.conversation)!=null||(j==null?void 0:j.stickerMessage)!=null;j=j&&k?d("WAWebE2EProtoParser").parseMsgProto(j,{},a):void 0;a=g!=null?d("WAWebE2EProtoUtils").parseMsgPaymentInfo(g):{};if(e.amount==null)e.currencyCodeIso4217!=null&&a.paymentCurrency==null&&(a.paymentCurrency=e.currencyCodeIso4217),e.amount1000!=null&&a.paymentAmount1000==null&&(a.paymentAmount1000=d("WALongInt").numberOrThrowIfTooLarge(e.amount1000));else{e.amount.currencyCode!=null&&a.paymentCurrency==null&&(a.paymentCurrency=e.amount.currencyCode);if(e.amount.value!=null&&a.paymentAmount1000==null){g=e.amount;var l=g.offset==null||g.offset===0?1e3:g.offset;a.paymentAmount1000=parseFloat(g.value)*1e3/l}}e.requestFrom!=null&&(a==null?void 0:a.paymentMessageReceiverJid)==null&&(a.paymentMessageReceiverJid=d("WAWebE2EProtoUtils").decodeJid(e.requestFrom));((a==null?void 0:a.paymentStatus)==null||(a==null?void 0:a.paymentTxnStatus)==null)&&d("WAWebE2EProtoUtils").isEitherSenderOrReceiverOfPaymentMessage(f.id,c("WANullthrows")(a.paymentMessageReceiverJid))&&(a.paymentStatus=d("WAWebProtobufsWeb.pb").PaymentInfo$Status.WAITING,a.paymentTxnStatus=d("WAWebProtobufsWeb.pb").PaymentInfo$TxnStatus.COLLECT_INIT);e.expiryTimestamp!=null&&(a==null?void 0:a.paymentExpiryTimestamp)==null&&(a.paymentExpiryTimestamp=d("WALongInt").numberOrThrowIfTooLarge(e.expiryTimestamp));return!k?{msgData:babelHelpers["extends"]({},f,{type:d("WAWebMsgType").MSG_TYPE.PAYMENT,kind:d("WAWebMsgType").MsgKind.Payment,subtype:"futureproof"},a,{paymentBackground:i}),contextInfo:b}:{msgData:babelHelpers["extends"]({},f,{type:d("WAWebMsgType").MSG_TYPE.PAYMENT,kind:d("WAWebMsgType").MsgKind.Payment,subtype:"request"},a,{paymentBackground:i,paymentNoteMsg:j}),contextInfo:b}}g["default"]=a}),98);
__d("WAWebParseSendPaymentMessageProto",["WALogger","WAWebE2EProtoParser","WAWebE2EProtoUtils","WAWebMsgKey","WAWebMsgType","WAWebUserPrefsMeUser","err"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["getPaymentRequestMessageKey: no message id is defined"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["parseSendPaymentMessageProto: does not support novi transactions"]);i=function(){return a};return a}function a(a){var b,c=a.messageProtobuf,e=a.baseMessage,f=a.paymentInfo;a=a.msgContext;c=c.sendPaymentMessage;if(c==null)return;b=(b=c.noteMessage)==null?void 0:(b=b.extendedTextMessage)==null?void 0:b.contextInfo;if((f==null?void 0:f.futureproofed)===!0||d("WAWebE2EProtoUtils").hasUnsupportedCurrency(f)){d("WALogger").LOG(i());return{msgData:babelHelpers["extends"]({},e,{type:"unknown",kind:d("WAWebMsgType").MsgKind.Unknown,subtype:"phone_only_feature"}),contextInfo:b}}var g=c.background,h=c.noteMessage;c=c.requestMessageKey;var k=(h==null?void 0:h.extendedTextMessage)!=null||(h==null?void 0:h.conversation)!=null||(h==null?void 0:h.stickerMessage)!=null,l=k?"send":"futureproof";h=h&&k?d("WAWebE2EProtoParser").parseMsgProto(h,{},a):void 0;a=f!=null?d("WAWebE2EProtoUtils").parseMsgPaymentInfo(f):null;f=c?j(c,e.id,l):null;return!k?{msgData:babelHelpers["extends"]({},e,{type:d("WAWebMsgType").MSG_TYPE.PAYMENT,kind:d("WAWebMsgType").MsgKind.Payment,subtype:"futureproof"},a,{paymentBackground:g,paymentRequestMessageKey:f}),contextInfo:b}:{msgData:babelHelpers["extends"]({},e,{type:d("WAWebMsgType").MSG_TYPE.PAYMENT,kind:d("WAWebMsgType").MsgKind.Payment,subtype:"send"},a,{paymentBackground:g,paymentRequestMessageKey:f,paymentNoteMsg:h}),contextInfo:b}}function j(a,b,e){if(!a)throw c("err")("getPaymentRequestMessageKey: no message key is defined");var f=a.id;if(!f)throw c("err")("getPaymentRequestMessageKey: no key id is defined");if(!b){d("WALogger").WARN(h());return null}var g;if(b.remote.isGroup()){var i;if(b.fromMe||((i=d("WAWebE2EProtoUtils").decodeJid(a.participant))==null?void 0:i.equals(d("WAWebUserPrefsMeUser").getMeUser()))||e==="send")g=d("WAWebE2EProtoUtils").decodeJid(a.participant);else return null}i=new(c("WAWebMsgKey"))({fromMe:!b.fromMe,remote:b.remote,id:f,participant:g});return i}g["default"]=a}),98);
__d("WAWebEphemeralKeepInChat",["WANullthrows","WAWebEphemeralKeepInChatUtils","WAWebMsgKey","WAWebWidFactory","err"],(function(a,b,c,d,e,f,g){function a(a){a=a.keepInChat;if(a!=null&&a.key!=null){var b=a.key,e=b.id,f=b.remoteJid,g=b.participant;b=b.fromMe;var h=a.keepType;a=a.serverTimestampMs;if(e==null||h==null||a==null||f==null)throw c("err")("parseKeepInChatHistorySyncMessage: malformed KIC WebMessageInfo");h=d("WAWebEphemeralKeepInChatUtils").parseKeepTypeToKicState(h);if(h==null)throw c("err")("parseKeepInChatHistorySyncMessage: KeepType has unsupported value");return{kicKey:new(c("WAWebMsgKey"))({fromMe:c("WANullthrows")(b),id:c("WANullthrows")(e),remote:c("WANullthrows")(d("WAWebWidFactory").createWidFromWidLike(f)),participant:g!=null?d("WAWebWidFactory").createWidFromWidLike(g):void 0}),kicState:h,kicTimestampMs:parseInt(a,10)}}}g.parseKeepInChatHistorySyncMessage=a}),98);
__d("WAWebParseWebMessageInfoApi",["WAJids","WALogger","WANullthrows","WAWebABProps","WAWebBizCoexGatingUtils","WAWebBotTypes","WAWebE2EProtoParser","WAWebE2EProtoParserApi","WAWebE2EProtoUtils","WAWebEphemeralKeepInChat","WAWebMessagingGatingUtils","WAWebMsgKey","WAWebMsgType","WAWebProtobufsWeb.pb","WAWebReportingTokenUtils","WAWebUserPrefsMeUser","WAWebWid","WAWebWidFactory"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["ProtocolParser: admin revoke came without admin JID"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["parseWebMessageInfo: KIC fields are malformed"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["drop: broadcast"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["drop: cannot create MsgKey: ",""]);k=function(){return a};return a}function l(a,b){var e=d("WAWebE2EProtoUtils").decodeJid(b.remoteJid),f=d("WAWebE2EProtoUtils").decodeJid(b.participant),g=d("WAWebUserPrefsMeUser").getMaybeMeUser(),h=d("WAWebE2EProtoUtils").decodeJid(a.participant);f==null&&e!=null&&c("WAWebWid").isWid(e)&&e===d("WAWebWidFactory").createWid(d("WAJids").PSA_JID)&&(f=d("WAWebWidFactory").createWid(d("WAJids").PSA_JID));(c("WAWebWid").isGroup(e)||c("WAWebWid").isStatusV3(e))&&(f==null&&(a.participant!=null?f=d("WAWebE2EProtoUtils").decodeJid(a.participant):b.fromMe&&(f=g)),h=h||f);try{a=new(c("WAWebMsgKey"))({fromMe:c("WANullthrows")(b.fromMe),remote:e,id:c("WANullthrows")(b.id),participant:f});return{msgKey:a,author:h}}catch(a){d("WALogger").WARN(k(),a.stack);return}}function a(a){var b=a.key,c=d("WAWebE2EProtoUtils").decodeJid(b.remoteJid),e=d("WAWebUserPrefsMeUser").getMaybeMeUser(),f=b.fromMe?c:e,g=b.fromMe?e:c,h=l(a,b);if(h==null)return;var k=h.msgKey;h=h.author;var n="in";e.equals(c)&&(n=b.fromMe?"out":"in");if(f==="broadcast"){d("WALogger").WARN(j()).devConsole(a);return}e=!1;e=a.reactions.some(function(a){return a.text!=null});k={id:k,from:g,to:f,self:n,participant:k.participant,type:d("WAWebMsgType").MSG_TYPE.UNKNOWN,t:a.messageTimestamp||0,ack:a.status-1,author:h,invis:!!a.ignore,star:!!a.starred,broadcast:b.fromMe&&a.broadcast,notifyName:a.pushName||"",encFilehash:d("WAWebE2EProtoParserApi").decodeBytes(a.mediaCiphertextSha256),shareDuration:a.duration,labels:a.labels,ephemeralStartTimestamp:a.ephemeralStartTimestamp,ephemeralOutOfSync:a.ephemeralOutOfSync,bizPrivacyStatus:a.bizPrivacyStatus,verifiedBizName:a.verifiedBizName,reactions:a.reactions,hasReaction:e,agentId:a.agentId,revokeTimestamp:a.revokeMessageTimestamp,kicKey:void 0,kicState:void 0,pollInvalidated:((c=a.pollAdditionalMetadata)==null?void 0:c.pollInvalidated)===!0,eventInvalidated:((g=a.eventAdditionalMetadata)==null?void 0:g.isStale)===!0,originalSelfAuthor:d("WAWebE2EProtoUtils").decodeJid(a.originalSelfAuthorUserJidString),kicTimestampMs:void 0,pinInChat:a.pinInChat,pmCampaignId:(f=a.premiumMessageInfo)==null?void 0:f.serverCampaignId,bizSource:((n=a.premiumMessageInfo)==null?void 0:n.serverCampaignId)!=null?"smb_promo":void 0,bizBotType:a.is1PBizBotMessage===!0?d("WAWebBotTypes").BizBotType.BIZ_1P:null,botTargetSenderJid:a.botMessageInvokerJid!=null?d("WAWebE2EProtoUtils").decodeJid(a.botMessageInvokerJid):null};if(d("WAWebMessagingGatingUtils").isReportingTagSyncingEnabled()){k.reportingTokenInfo=a.reportingTokenInfo!=null?{reportingTag:(h=a.reportingTokenInfo)==null?void 0:h.reportingTag,version:d("WAWebReportingTokenUtils").REPORTING_TOKEN_VERSION.HISTORY_SYNC}:null}if(a.keepInChat!=null)try{b=d("WAWebEphemeralKeepInChat").parseKeepInChatHistorySyncMessage(a);b!=null&&Object.assign(k,b)}catch(a){d("WALogger").WARN(i()).devConsole(a)}return a.message?d("WAWebE2EProtoParser").parseMsgProto(a.message,k,"history",a.paymentInfo,a.finalLiveLocation,a.quotedPaymentInfo,null,null,null,k.bizSource):m(a,k)}function m(a,b){if(a.messageStubType==null)return;var c=d("WAWebProtobufsWeb.pb").WebMessageInfo$StubType;switch(a.messageStubType){case c.REVOKE:b.type="revoked";b.subtype="sender";return b;case c.CIPHERTEXT:b.type="ciphertext";return b;case c.OVERSIZED:b.type="oversized";return b;case c.FUTUREPROOF:b.subtype="phone";return b;default:return n(a,b)}}function n(a,b){if(a.messageStubType==null)return;var e=d("WAWebProtobufsWeb.pb").WebMessageInfo$StubType;b.type="notification_template";b.templateParams=Array.isArray(a.messageStubParameters)?a.messageStubParameters.map(function(b){return a.messageStubType===e.GROUP_CREATE||a.messageStubType===e.GROUP_CHANGE_SUBJECT?b:d("WAWebE2EProtoUtils").decodeJid(b)}):void 0;if(a.messageStubType==null){b.templateParams=void 0;return b}switch(a.messageStubType){case e.NON_VERIFIED_TRANSITION:b.subtype="non_verified_transition";break;case e.UNVERIFIED_TRANSITION:b.subtype="unverified_transition";break;case e.VERIFIED_TRANSITION:b.subtype="verified_transition";break;case e.VERIFIED_LOW_UNKNOWN:b.subtype="verified_low_unknown";break;case e.VERIFIED_HIGH:b.subtype="verified_high";break;case e.VERIFIED_INITIAL_UNKNOWN:b.subtype="verified_initial_unknown";break;case e.VERIFIED_INITIAL_LOW:b.subtype="verified_initial_low";break;case e.VERIFIED_INITIAL_HIGH:b.subtype="verified_initial_high";break;case e.VERIFIED_TRANSITION_ANY_TO_NONE:b.subtype="verified_transition_any_to_none";break;case e.VERIFIED_TRANSITION_ANY_TO_HIGH:b.subtype="verified_transition_any_to_high";break;case e.VERIFIED_TRANSITION_HIGH_TO_LOW:b.subtype="verified_transition_high_to_low";break;case e.VERIFIED_TRANSITION_HIGH_TO_UNKNOWN:b.subtype="verified_transition_high_to_unknown";break;case e.VERIFIED_TRANSITION_UNKNOWN_TO_LOW:b.subtype="verified_transition_unknown_to_low";break;case e.VERIFIED_TRANSITION_LOW_TO_UNKNOWN:b.subtype="verified_transition_low_to_unknown";break;case e.VERIFIED_TRANSITION_NONE_TO_LOW:b.subtype="verified_transition_none_to_low";break;case e.VERIFIED_TRANSITION_NONE_TO_UNKNOWN:b.subtype="verified_transition_none_to_unknown";break;case e.GROUP_CREATE:b.type="gp2";b.subtype="create";b.body=b.templateParams[0];b.templateParams=void 0;break;case e.REPORT_TO_ADMIN_ENABLED_STATUS:b.type="gp2";b.subtype="allow_admin_reports";break;case e.GROUP_DELETE:b.type="gp2";b.subtype="delete";b.templateParams=void 0;break;case e.GROUP_CHANGE_SUBJECT:b.type="gp2";b.subtype="subject";b.body=b.templateParams[0];b.templateParams=void 0;break;case e.GROUP_CHANGE_ICON:b.type="gp2";b.subtype="picture";b.body=b.templateParams[0];b.templateParams=void 0;break;case e.GROUP_CHANGE_INVITE_LINK:b.type="gp2";b.subtype="revoke_invite";break;case e.GROUP_CHANGE_DESCRIPTION:b.type="gp2";b.subtype="description";b.body=b.templateParams[0];break;case e.GROUP_CHANGE_RESTRICT:b.type="gp2";b.subtype="restrict";b.body=b.templateParams[0];break;case e.GROUP_CHANGE_ANNOUNCE:b.type="gp2";b.subtype="announce";b.body=b.templateParams[0];break;case e.GROUP_CHANGE_NO_FREQUENTLY_FORWARDED:b.type="gp2";b.subtype="no_frequently_forwarded";b.body=b.templateParams[0];break;case e.GROUP_ANNOUNCE_MODE_MESSAGE_BOUNCE:b.type="gp2";b.subtype="announce_msg_bounce";b.templateParams=void 0;break;case e.GROUP_PARTICIPANT_ADD:b.type="gp2";b.subtype="add";b.recipients=b.templateParams;b.templateParams=void 0;Array.isArray(b.recipients)&&b.recipients.length===1&&b.author===b.recipients[0]&&(b.author=void 0);break;case e.GROUP_PARTICIPANT_REMOVE:b.type="gp2";b.subtype="remove";b.recipients=b.templateParams;b.templateParams=void 0;break;case e.GROUP_PARTICIPANT_PROMOTE:b.type="gp2";b.subtype="promote";b.recipients=b.templateParams;b.templateParams=void 0;break;case e.GROUP_PARTICIPANT_DEMOTE:b.type="gp2";b.subtype="demote";b.recipients=b.templateParams;b.templateParams=void 0;break;case e.GROUP_PARTICIPANT_INVITE:b.type="gp2";b.subtype="invite";b.recipients=b.templateParams;b.templateParams=void 0;break;case e.GROUP_PARTICIPANT_LEAVE:b.type="gp2";b.subtype="leave";b.recipients=b.templateParams;b.templateParams=void 0;break;case e.GROUP_PARTICIPANT_CHANGE_NUMBER:b.type="gp2";b.subtype="modify";b.recipients=b.templateParams;b.templateParams=void 0;break;case e.GROUP_V4_ADD_INVITE_SENT:b.type="gp2";b.subtype="v4_add_invite_sent";b.recipients=b.templateParams;b.templateParams=void 0;break;case e.GROUP_PARTICIPANT_ADD_REQUEST_JOIN:b.type="gp2";b.subtype="v4_add_invite_join";b.recipients=b.templateParams;b.templateParams=void 0;break;case e.GROUP_INVITE_LINK_GROWTH_LOCKED:b.type="gp2";b.subtype=b.templateParams[0]==="true"?"growth_locked":"growth_unlocked";b.body="invite";b.templateParams=void 0;break;case e.GROUP_PARTICIPANT_LINKED_GROUP_JOIN:b.type="gp2";b.subtype="linked_group_join";b.recipients=b.templateParams;b.templateParams=void 0;break;case e.BROADCAST_CREATE:b.type="broadcast_notification";b.subtype="create";b.body=b.templateParams[0]||"0";b.templateParams=void 0;break;case e.BROADCAST_ADD:b.type="broadcast_notification";b.subtype="add";b.recipients=b.templateParams;b.templateParams=void 0;break;case e.BROADCAST_REMOVE:b.type="broadcast_notification";b.subtype="remove";b.recipients=b.templateParams;b.templateParams=void 0;break;case e.GENERIC_NOTIFICATION:b.type="notification";b.body=b.templateParams[0];b.templateParams=void 0;break;case e.E2E_IDENTITY_CHANGED:b.type="e2e_notification";b.subtype="identity";b.body=b.templateParams[0]instanceof c("WAWebWid")?b.templateParams[0].toString():b.templateParams[0];b.templateParams=void 0;break;case e.E2E_IDENTITY_UNAVAILABLE:b.type="e2e_notification";b.subtype="e2e_identity_unavailable";break;case e.CHAT_PSA:b.type="e2e_notification";b.subtype="chat_psa";break;case e.E2E_DEVICE_CHANGED:b.type="e2e_notification";b.subtype="device";b.body=b.templateParams[0]instanceof c("WAWebWid")?b.templateParams[0].toString():b.templateParams[0];b.devicesAdded=parseInt(b.templateParams[1],10);b.devicesRemoved=parseInt(b.templateParams[2],10);b.templateParams=void 0;break;case e.E2E_ENCRYPTED:b.type="e2e_notification";b.subtype="encrypt";break;case e.E2E_ENCRYPTED_NOW:b.type="e2e_notification";b.subtype="encrypt_now";break;case e.CALL_MISSED_VOICE:b.type="call_log";b.subtype="miss";break;case e.CALL_MISSED_VIDEO:b.type="call_log";b.subtype="miss_video";break;case e.CALL_MISSED_GROUP_VOICE:b.type="call_log";b.subtype="miss_group";break;case e.CALL_MISSED_GROUP_VIDEO:b.type="call_log";b.subtype="miss_group_video";break;case e.SILENCED_UNKNOWN_CALLER_AUDIO:case e.SILENCED_UNKNOWN_CALLER_VIDEO:b.type="call_log";b.subtype="silence";break;case e.INDIVIDUAL_CHANGE_NUMBER:b.subtype="change_number";break;case e.SENDER_INVITE:b.subtype="sender_invite";break;case e.RECEIVER_INVITE:b.subtype="receiver_invite";break;case e.MASKED_THREAD_CREATED:b.subtype="masked_thread_created";break;case e.CAG_MASKED_THREAD_CREATED:b.subtype="cag_masked_thread_created";break;case e.CHANGE_EPHEMERAL_SETTING:b.type="gp2";b.subtype="ephemeral";b.author=b.templateParams[1];break;case e.PAYMENT_CIPHERTEXT:b.type="payment";b.subtype="ciphertext";if(a.paymentInfo!=null){var f=d("WAWebE2EProtoUtils").parseMsgPaymentInfo(a.paymentInfo);b.paymentStatus=f.paymentStatus;b.paymentTxnStatus=f.paymentTxnStatus;b.paymentCurrency=f.paymentCurrency;b.paymentAmount1000=f.paymentAmount1000;b.paymentMessageReceiverJid=f.paymentMessageReceiverJid;b.paymentExpiryTimestamp=f.paymentExpiryTimestamp;b.paymentTransactionTimestamp=f.paymentTransactionTimestamp}break;case e.PAYMENT_FUTUREPROOF:b.type="payment";b.subtype="futureproof";if(a.paymentInfo!=null){f=d("WAWebE2EProtoUtils").parseMsgPaymentInfo(a.paymentInfo);b.paymentStatus=f.paymentStatus;b.paymentTxnStatus=f.paymentTxnStatus;b.paymentCurrency=f.paymentCurrency;b.paymentAmount1000=f.paymentAmount1000;b.paymentMessageReceiverJid=f.paymentMessageReceiverJid;b.paymentExpiryTimestamp=f.paymentExpiryTimestamp;b.paymentTransactionTimestamp=f.paymentTransactionTimestamp}break;case e.PAYMENT_ACTION_REQUEST_CANCELLED:b.subtype="payment_transaction_request_cancelled";break;case e.PAYMENT_TRANSACTION_STATUS_UPDATE_FAILED:b.subtype="payment_transaction_status_update_failed";break;case e.PAYMENT_TRANSACTION_STATUS_UPDATE_REFUNDED:b.subtype="payment_transaction_status_update_refunded";break;case e.PAYMENT_TRANSACTION_STATUS_UPDATE_REFUND_FAILED:b.subtype="payment_transaction_status_update_refund_failed";break;case e.PAYMENT_TRANSACTION_STATUS_RECEIVER_PENDING_SETUP:b.subtype="payment_transaction_status_receiver_pending_setup";break;case e.PAYMENT_TRANSACTION_STATUS_RECEIVER_SUCCESS_AFTER_HICCUP:b.subtype="payment_transaction_status_receiver_success_after_hiccup";break;case e.PAYMENT_ACTION_ACCOUNT_SETUP_REMINDER:b.subtype="payment_action_account_setup_reminder";break;case e.PAYMENT_ACTION_SEND_PAYMENT_REMINDER:b.subtype="payment_action_send_payment_reminder";break;case e.PAYMENT_ACTION_SEND_PAYMENT_INVITATION:b.subtype="payment_action_send_payment_invitation";break;case e.PAYMENT_ACTION_REQUEST_DECLINED:b.subtype="payment_action_request_declined";break;case e.PAYMENT_ACTION_REQUEST_EXPIRED:b.subtype="payment_action_request_expired";break;case e.BIZ_VERIFIED_TRANSITION_TOP_TO_BOTTOM:b.subtype="biz_verified_transition_top_to_bottom";break;case e.BIZ_VERIFIED_TRANSITION_BOTTOM_TO_TOP:b.subtype="biz_verified_transition_bottom_to_top";break;case e.BIZ_INTRO_TOP:b.subtype="biz_intro_top";break;case e.BIZ_INTRO_BOTTOM:b.subtype="biz_intro_bottom";break;case e.BIZ_NAME_CHANGE:b.subtype="biz_name_change";break;case e.BIZ_MOVE_TO_CONSUMER_APP:b.subtype="biz_move_to_consumer_app";break;case e.BIZ_TWO_TIER_MIGRATION_TOP:b.subtype="biz_two_tier_migration_top";break;case e.BIZ_TWO_TIER_MIGRATION_BOTTOM:b.subtype="biz_two_tier_migration_bottom";break;case e.BLUE_MSG_BSP_FB_TO_BSP_PREMISE:b.subtype="blue_msg_bsp_fb_to_bsp_premise";break;case e.BLUE_MSG_BSP_FB_TO_SELF_FB:b.subtype="blue_msg_bsp_fb_to_self_fb";break;case e.BLUE_MSG_BSP_FB_TO_SELF_PREMISE:b.subtype="blue_msg_bsp_fb_to_self_premise";break;case e.BLUE_MSG_BSP_FB_UNVERIFIED:b.subtype="blue_msg_bsp_fb_unverified";break;case e.BLUE_MSG_BSP_FB_UNVERIFIED_TO_BSP_PREMISE_VERIFIED:b.subtype="blue_msg_bsp_fb_unverified_to_bsp_premise_verified";break;case e.BLUE_MSG_BSP_FB_UNVERIFIED_TO_SELF_FB_VERIFIED:b.subtype="blue_msg_bsp_fb_unverified_to_self_fb_verified";break;case e.BLUE_MSG_BSP_FB_UNVERIFIED_TO_SELF_PREMISE_VERIFIED:b.subtype="blue_msg_bsp_fb_unverified_to_self_premise_verified";break;case e.BLUE_MSG_BSP_FB_VERIFIED:b.subtype="blue_msg_bsp_fb_verified";break;case e.BLUE_MSG_BSP_FB_VERIFIED_TO_BSP_PREMISE_UNVERIFIED:b.subtype="blue_msg_bsp_fb_verified_to_bsp_premise_unverified";break;case e.BLUE_MSG_BSP_FB_VERIFIED_TO_SELF_FB_UNVERIFIED:b.subtype="blue_msg_bsp_fb_verified_to_self_fb_unverified";break;case e.BLUE_MSG_BSP_FB_VERIFIED_TO_SELF_PREMISE_UNVERIFIED:b.subtype="blue_msg_bsp_fb_verified_to_self_premise_unverified";break;case e.BLUE_MSG_BSP_PREMISE_TO_SELF_PREMISE:b.subtype="blue_msg_bsp_premise_to_self_premise";break;case e.BLUE_MSG_BSP_PREMISE_UNVERIFIED:b.subtype="blue_msg_bsp_premise_unverified";break;case e.BLUE_MSG_BSP_PREMISE_UNVERIFIED_TO_SELF_PREMISE_VERIFIED:b.subtype="blue_msg_bsp_premise_unverified_to_self_premise_verified";break;case e.BLUE_MSG_BSP_PREMISE_VERIFIED:b.subtype="blue_msg_bsp_premise_verified";break;case e.BLUE_MSG_BSP_PREMISE_VERIFIED_TO_SELF_PREMISE_UNVERIFIED:b.subtype="blue_msg_bsp_premise_verified_to_self_premise_unverified";break;case e.BLUE_MSG_CONSUMER_TO_BSP_FB_UNVERIFIED:b.subtype="blue_msg_consumer_to_bsp_fb_unverified";break;case e.BLUE_MSG_CONSUMER_TO_BSP_PREMISE_UNVERIFIED:b.subtype="blue_msg_consumer_to_bsp_premise_unverified";break;case e.BLUE_MSG_CONSUMER_TO_SELF_FB_UNVERIFIED:b.subtype="blue_msg_consumer_to_self_fb_unverified";break;case e.BLUE_MSG_CONSUMER_TO_SELF_PREMISE_UNVERIFIED:b.subtype="blue_msg_consumer_to_self_premise_unverified";break;case e.BLUE_MSG_SELF_FB_TO_BSP_PREMISE:b.subtype="blue_msg_self_fb_to_bsp_premise";break;case e.BLUE_MSG_SELF_FB_TO_SELF_PREMISE:b.subtype="blue_msg_self_fb_to_self_premise";break;case e.BLUE_MSG_SELF_FB_UNVERIFIED:b.subtype="blue_msg_self_fb_unverified";break;case e.BLUE_MSG_SELF_FB_UNVERIFIED_TO_BSP_PREMISE_VERIFIED:b.subtype="blue_msg_self_fb_unverified_to_bsp_premise_verified";break;case e.BLUE_MSG_SELF_FB_UNVERIFIED_TO_SELF_PREMISE_VERIFIED:b.subtype="blue_msg_self_fb_unverified_to_self_premise_verified";break;case e.BLUE_MSG_SELF_FB_VERIFIED:b.subtype="blue_msg_self_fb_verified";break;case e.BLUE_MSG_SELF_FB_VERIFIED_TO_BSP_PREMISE_UNVERIFIED:b.subtype="blue_msg_self_fb_verified_to_bsp_premise_unverified";break;case e.BLUE_MSG_SELF_FB_VERIFIED_TO_SELF_PREMISE_UNVERIFIED:b.subtype="blue_msg_self_fb_verified_to_self_premise_unverified";break;case e.BLUE_MSG_SELF_PREMISE_TO_BSP_PREMISE:b.subtype="blue_msg_self_premise_to_bsp_premise";break;case e.BLUE_MSG_SELF_PREMISE_UNVERIFIED:b.subtype="blue_msg_self_premise_unverified";break;case e.BLUE_MSG_SELF_PREMISE_VERIFIED:b.subtype="blue_msg_self_premise_verified";break;case e.BLUE_MSG_TO_BSP_FB:b.subtype="blue_msg_to_bsp_fb";break;case e.BLUE_MSG_TO_CONSUMER:b.subtype="blue_msg_to_consumer";break;case e.BLUE_MSG_TO_SELF_FB:b.subtype="blue_msg_to_self_fb";break;case e.BLUE_MSG_UNVERIFIED_TO_BSP_FB_VERIFIED:b.subtype="blue_msg_unverified_to_bsp_fb_verified";break;case e.BLUE_MSG_UNVERIFIED_TO_BSP_PREMISE_VERIFIED:b.subtype="blue_msg_unverified_to_bsp_premise_verified";break;case e.BLUE_MSG_UNVERIFIED_TO_SELF_FB_VERIFIED:b.subtype="blue_msg_unverified_to_self_fb_verified";break;case e.BLUE_MSG_UNVERIFIED_TO_VERIFIED:b.subtype="blue_msg_unverified_to_verified";break;case e.BLUE_MSG_VERIFIED_TO_BSP_FB_UNVERIFIED:b.subtype="blue_msg_verified_to_bsp_fb_unverified";break;case e.BLUE_MSG_VERIFIED_TO_BSP_PREMISE_UNVERIFIED:b.subtype="blue_msg_verified_to_bsp_premise_unverified";break;case e.BLUE_MSG_VERIFIED_TO_SELF_FB_UNVERIFIED:b.subtype="blue_msg_verified_to_self_fb_unverified";break;case e.BLUE_MSG_VERIFIED_TO_UNVERIFIED:b.subtype="blue_msg_verified_to_unverified";break;case e.BIZ_PRIVACY_MODE_INIT_FB:b.subtype="biz_privacy_mode_init_fb";((f=b.id)==null?void 0:(f=f.remote)==null?void 0:f.isBot())&&(b.subtype="bot_init");break;case e.BIZ_PRIVACY_MODE_INIT_BSP:b.subtype="biz_privacy_mode_init_bsp";break;case e.BIZ_PRIVACY_MODE_TO_FB:b.subtype="biz_privacy_mode_to_fb";((f=b.id)==null?void 0:(f=f.remote)==null?void 0:f.isBot())&&(b.subtype="bot_init");break;case e.BIZ_PRIVACY_MODE_TO_BSP:b.subtype="biz_privacy_mode_to_bsp";break;case e.DISAPPEARING_MODE:b.subtype="disappearing_mode";break;case e.BLOCK_CONTACT:b.subtype="block_contact";break;case e.ADMIN_REVOKE:b.type="revoked";b.subtype="admin";b.revokeSender=b.templateParams[1]instanceof c("WAWebWid")?b.templateParams[1]:void 0;b.revokeSender||d("WALogger").LOG(h()).devConsole(b.templateParams);b.templateParams=void 0;break;case e.COMMUNITY_LINK_PARENT_GROUP:b.type="gp2";b.subtype="parent_group_link";break;case e.COMMUNITY_LINK_SIBLING_GROUP:b.type="gp2";b.subtype="sibling_group_link";break;case e.COMMUNITY_LINK_SUB_GROUP:b.type="gp2";b.subtype="sub_group_link";break;case e.COMMUNITY_CREATE:b.type="gp2";b.subtype="community_create";break;case e.COMMUNITY_UNLINK_PARENT_GROUP:b.type="gp2";b.subtype="parent_group_unlink";break;case e.INTEGRITY_UNLINK_PARENT_GROUP:b.type="gp2";b.subtype="integrity_parent_group_unlink";break;case e.COMMUNITY_UNLINK_SIBLING_GROUP:b.type="gp2";b.subtype="sibling_group_unlink";break;case e.COMMUNITY_UNLINK_SUB_GROUP:b.type="gp2";b.subtype="sub_group_unlink";break;case e.COMMUNITY_PARTICIPANT_PROMOTE:b.type="gp2";b.subtype="linked_group_promote";b.recipients=b.templateParams;b.templateParams=void 0;break;case e.COMMUNITY_PARTICIPANT_DEMOTE:b.type="gp2";b.subtype="linked_group_demote";b.recipients=b.templateParams;b.templateParams=void 0;break;case e.EPHEMERAL_KEEP_IN_CHAT:b.type="gp2";b.subtype="ephemeral_keep_in_chat";break;case e.GROUP_MEMBERSHIP_JOIN_APPROVAL_MODE:b.type="gp2";b.subtype="membership_approval_mode";break;case e.GROUP_MEMBER_ADD_MODE:if(!d("WAWebABProps").getABPropConfigValue("web_anyone_can_add_group_setting_enabled")){b.templateParams=void 0;break}b.type="gp2";b.subtype="member_add_mode";break;case e.GROUP_MEMBERSHIP_JOIN_APPROVAL_REQUEST_NON_ADMIN_ADD:b.type="gp2";b.recipients=b.templateParams;b.subtype="created_membership_requests";break;case e.GROUP_MEMBERSHIP_JOIN_APPROVAL_REQUEST:b.type="gp2";b.subtype="membership_approval_request";break;case e.COMMUNITY_LINK_PARENT_GROUP_MEMBERSHIP_APPROVAL:b.type="gp2";b.subtype="parent_group_link_membership_approval";break;case e.GROUP_PARTICIPANT_JOINED_GROUP_AND_PARENT_GROUP:b.type="gp2";b.subtype="auto_add";break;case e.COMMUNITY_PARENT_GROUP_DELETED:b.type="gp2";b.subtype="delete_parent_group";break;case e.BIZ_CHAT_ASSIGNMENT:b.subtype="chat_assignment";break;case e.BIZ_CHAT_ASSIGNMENT_UNASSIGN:b.subtype="chat_assignment_unassign";break;case e.COMMUNITY_PARENT_GROUP_SUBJECT_CHANGED:b.type="gp2";b.subtype="subject";b.body=b.templateParams[1];break;case e.CAG_INVITE_AUTO_ADD:b.type="gp2";b.subtype="invite_auto_add";b.recipients=[d("WAWebUserPrefsMeUser").getMaybeMeUser()];break;case e.CAG_INVITE_AUTO_JOINED:b.type="gp2";b.subtype="invite_auto_add";b.recipients=b.templateParams;b.templateParams=void 0;break;case e.COMMUNITY_PARTICIPANT_ADD_RICH:b.type="gp2";b.subtype="community_participant_add_rich";break;case e.SUB_GROUP_PARTICIPANT_ADD_RICH:b.type="gp2";b.subtype="sub_group_participant_add_rich";break;case e.SUB_GROUP_INVITE_RICH:b.type="gp2";b.subtype="sub_group_invite_rich";b.author=void 0;break;case e.COMMUNITY_INVITE_AUTO_ADD_RICH:b.type="gp2";b.subtype="community_invite_auto_add_rich";b.author=void 0;break;case e.COMMUNITY_INVITE_RICH:b.type="gp2";b.subtype="community_invite_rich";b.author=void 0;break;case e.COMMUNITY_LINK_PARENT_GROUP_RICH:b.type="gp2";b.subtype="community_link_parent_group_rich";break;case e.COMMUNITY_CHANGE_DESCRIPTION:b.type="gp2";b.subtype="parent_group_description";b.body=b.templateParams[0];break;case e.PINNED_MESSAGE_IN_CHAT:b.type="pinned_message";break;case e.COMMUNITY_ALLOW_MEMBER_ADDED_GROUPS:b.type="gp2";b.subtype="allow_non_admin_sub_group_creation";break;case e.EMPTY_SUBGROUP_CREATE:b.type="gp2";b.subtype="empty_subgroup_create";break;case e.SUGGESTED_SUBGROUP_ANNOUNCE:b.type="gp2";b.subtype="created_subgroup_suggestion";break;case e.SUBGROUP_ADMIN_TRIGGERED_AUTO_ADD_RICH:b.type="gp2";b.subtype="subgroup_admin_triggered_auto_add";break;case e.GENERAL_CHAT_ADD:b.type="gp2";b.subtype="general_chat_add";break;case e.GENERAL_CHAT_AUTO_ADD_DISABLED:b.type="gp2";b.subtype="general_chat_auto_add_disabled";break;case e.BIZ_BOT_1P_MESSAGING_ENABLED:b.type=d("WAWebMsgType").MSG_TYPE.NOTIFICATION_TEMPLATE;b.subtype="biz_bot_1p_disclosure";break;case e.BIZ_BOT_3P_MESSAGING_ENABLED:b.type=d("WAWebMsgType").MSG_TYPE.NOTIFICATION_TEMPLATE;b.subtype="biz_bot_3p_disclosure";break;case e.CHANGE_USERNAME:b.subtype="change_username";break;case e.BIZ_COEX_PRIVACY_INIT_SELF:if(!d("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()){b.templateParams=void 0;break}b.type=d("WAWebMsgType").MSG_TYPE.NOTIFICATION_TEMPLATE;b.subtype="biz_me_account_type_is_hosted";break;case e.BIZ_COEX_PRIVACY_TRANSITION_SELF:if(!d("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()){b.templateParams=void 0;break}b.type=d("WAWebMsgType").MSG_TYPE.NOTIFICATION_TEMPLATE;b.subtype="biz_me_account_type_is_hosted_transition";break;case e.BIZ_COEX_PRIVACY_INIT:if(!d("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()){b.templateParams=void 0;break}b.type=d("WAWebMsgType").MSG_TYPE.NOTIFICATION_TEMPLATE;b.subtype="biz_account_type_is_hosted";break;case e.BIZ_COEX_PRIVACY_TRANSITION:if(!d("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()){b.templateParams=void 0;break}b.type=d("WAWebMsgType").MSG_TYPE.NOTIFICATION_TEMPLATE;b.subtype="biz_account_type_changed_to_hosted";break;case e.SUPPORT_AI_EDUCATION:b.type=d("WAWebMsgType").MSG_TYPE.NOTIFICATION_TEMPLATE;b.subtype="saga_init";break;default:b.templateParams=void 0;break}return b}g.buildMsgKey=l;g.parseWebMessageInfo=a;g.parseMsgStubProto=m;g.parseMsgStubTemplate=n}),98);
__d("WAWebAdvDeviceNotificationApi",["Promise","WAJids","WALogger","WAWebABProps","WAWebAdvHostedAccountTypeSystemMsg","WAWebContactSystemMsg","WAWebDBStoreMessage","WAWebSchemaChat","WAWebSchemaParticipant","WAWebUserPrefsMeUser","WAWebUserPrefsNotifications","WAWebWidFactory","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){var h;function a(){var b=babelHelpers.taggedTemplateLiteralLoose(["get chats failed during generateAdvAccountTypeChangeNotifications"]);a=function(){return b};return b}function e(){var a=babelHelpers.taggedTemplateLiteralLoose(["get all from chat table failed during generateAdvAccountTypeChangeNotifications"]);e=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["get chats failed"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["get all from chat table failed"]);j=function(){return a};return a}function k(a,b,c){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){var f={notifications:[],chatIds:[]};if(!d("WAWebUserPrefsNotifications").getGlobalSecurityNotifications())return f;if(d("WAWebABProps").getABPropConfigValue("adv_v2_m6"))return f;if(!(b.length>0||e.length>0))return f;var g=[];if(a.equals(d("WAWebUserPrefsMeUser").getMeUser()))try{var h=(yield d("WAWebSchemaChat").getChatTable().all());h.forEach(function(a){a.id!==d("WAJids").STATUS_JID&&g.push(d("WAWebWidFactory").createWid(a.id))})}catch(a){d("WALogger").ERROR(j()).verbose().devConsole(a).sendLogs("get all from chat table failed when creating device notification");throw c("err")("get all from chat table failed")}else try{h=(yield d("WAWebSchemaChat").getChatTable().get(String(a),!1));var k=(yield d("WAWebSchemaParticipant").getParticipantTable().equals(["participants"],String(a)));g=k.map(function(a){return d("WAWebWidFactory").createWid(a.groupId)});h&&g.push(d("WAWebWidFactory").createWid(h.id))}catch(a){d("WALogger").ERROR(i()).verbose().devConsole(a).sendLogs("get chats failed when creating device notification");throw c("err")("get chays failed")}k=g.map(function(c){return d("WAWebContactSystemMsg").genDeviceNotificationMsg(c,a,b,e)});f.notifications=k;f.chatIds=g.map(String);return f});return l.apply(this,arguments)}function f(a,b){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a={notifications:[],chatIds:[]};return a});return m.apply(this,arguments)}function n(a,b,c){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){a=(yield k(a,c,e));c=a.notifications;yield (h||(h=b("Promise"))).all(c.map(function(a){return d("WAWebDBStoreMessage").storeMessageInTransaction([a])}))});return o.apply(this,arguments)}function p(a){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=[],e=new Set();if(d("WAWebUserPrefsNotifications").getGlobalSecurityNotifications()){a=(yield (h||(h=b("Promise"))).all(a.map(function(a){var c=a.wid,d=a.added,e=a.removed;a=a.isNewRecord;return a?(h||(h=b("Promise"))).resolve(null):k(c,d,e)})));a.forEach(function(a){a&&(c=c.concat(a.notifications),a.chatIds.forEach(function(a){return e.add(a)}))})}return c.length>0?{notifications:c,chatIds:Array.from(e)}:{notifications:[],chatIds:[]}});return q.apply(this,arguments)}function r(a){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){throw c("err")("hosted system msg gen: unexpected env");var e=[],f=new Set(),g=(yield (h||(h=b("Promise"))).all(a.map(function(a){var c=a.wid,e=a.added,f=a.removed,g=a.isNewRecord,i=a.newAdvAccountType;if(i!=null)return generateAdvAccountTypeChangeNotifications(c,i);else if(d("WAWebUserPrefsNotifications").getGlobalSecurityNotifications())return g?(h||(h=b("Promise"))).resolve(null):k(c,e,f)})));g.forEach(function(a){a&&(e=e.concat(a.notifications),a.chatIds.forEach(function(a){return f.add(a)}))});return e.length>0?{notifications:e,chatIds:Array.from(f)}:{notifications:[],chatIds:[]}});return s.apply(this,arguments)}g.generateDeviceNotifications=k;g.generateAdvAccountTypeChangeNotifications=f;g.createAndStoreDeviceNotifications=n;g.bulkGenerateDeviceNotifications=p;g.bulkGenerateDeviceAndAdvAccountTypeChangeNotifications=r}),98);
__d("WAWebAdvUpdateParticipantApi",["WAJids","WALogger","WAWebPostSenderKeyExpiredMetric","WAWebSchemaParticipant","WAWebUserPrefsMeUser","WAWebWamEnumExpiryReason","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["bulkUpdateGroupParticipantsInTransaction: error: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["updateGroupParticipantsInTransaction: error: ",""]);i=function(){return a};return a}function a(a,b,c){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){var e;try{e=(yield d("WAWebSchemaParticipant").getParticipantTable().equals(["participants"],String(a)))}catch(a){a.toString().includes("Failed to read large IndexedDB value")&&d("WALogger").ERROR(i(),a).sendLogs("indexeddb-participant-read-large-value");throw a}var f=e.map(function(e){var f=e.rotateKey,g=new Map(e.senderKey);c.forEach(function(b){var c;b=String(d("WAWebWidFactory").createDeviceWidFromUserAndDevice(a.user,a.server,b));f=f||((c=g.get(b))!=null?c:!1);g["delete"](b)});f&&g.forEach(function(a,b){return g.set(b,!1)});b.forEach(function(b){g.set(String(d("WAWebWidFactory").createDeviceWidFromUserAndDevice(a.user,a.server,b)),!1)});l(a,f,e,b,c);return babelHelpers["extends"]({},e,{senderKey:g,rotateKey:f})});return d("WAWebSchemaParticipant").getParticipantTable().bulkCreateOrReplace(f)});return j.apply(this,arguments)}function c(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.length===0)return;var b;try{b=(yield d("WAWebSchemaParticipant").getParticipantTable().anyOf(["participants"],a.map(function(a){return String(a.wid)})))}catch(a){a.toString().includes("Failed to read large IndexedDB value")&&d("WALogger").ERROR(h(),a).sendLogs("indexeddb-participant-bulk-read-large-value");throw a}if(b.length===0)return;var c=new Map();a.forEach(function(a){c.set(String(a.wid),a)});a=b.map(function(a){var b=a.rotateKey,e=new Map(a.senderKey);a.participants.forEach(function(f){var g=c.get(f);if(!g)return;f=g.wid;var h=g.added,i=g.removed;i.forEach(function(a){var c;a=String(d("WAWebWidFactory").createDeviceWidFromUserAndDevice(g.wid.user,g.wid.server,a));b=b||((c=e.get(a))!=null?c:!1);e["delete"](a)});b&&e.forEach(function(a,b){return e.set(b,!1)});h.forEach(function(a){e.set(String(d("WAWebWidFactory").createDeviceWidFromUserAndDevice(g.wid.user,g.wid.server,a)),!1)});l(f,b,a,h,i)});return babelHelpers["extends"]({},a,{senderKey:e,rotateKey:b})});return d("WAWebSchemaParticipant").getParticipantTable().bulkCreateOrReplace(a)});return k.apply(this,arguments)}function l(a,b,c,e,f){if(b&&!c.rotateKey){f.includes(d("WAJids").DEFAULT_DEVICE_ID)&&e.includes(d("WAJids").DEFAULT_DEVICE_ID)?b=d("WAWebWamEnumExpiryReason").EXPIRY_REASON.IDENTITY_CHANGE:((f=d("WAWebUserPrefsMeUser").getMaybeMeUser())==null?void 0:f.equals(a))?b=d("WAWebWamEnumExpiryReason").EXPIRY_REASON.PEER_COMPANION_UNPAIR:b=d("WAWebWamEnumExpiryReason").EXPIRY_REASON.OTHER_DEVICE_UNPAIR;d("WAWebPostSenderKeyExpiredMetric").postSenderKeyExpiredMetric({chatId:c.groupId,deviceCount:c.senderKey.size,expiryReason:b})}}g.updateGroupParticipantsInTransaction=a;g.bulkUpdateGroupParticipantsInTransaction=c}),98);
__d("WAWebSetPrivacyTokensJob",["$InternalEnum","WADeprecatedSendIq","WADeprecatedWapParser","WAWap","WAWebBackendErrors","WAWebCommsWapMd","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h=new(c("WADeprecatedWapParser"))("setPrivacyTokensParser",function(a){a={stanzaId:a.attrString("id")};return a});e=b("$InternalEnum")({TrustedContact:"trusted_contact"});function a(a,b,c){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){var e;b=b.map(function(b){return d("WAWap").wap("token",{jid:d("WAWebCommsWapMd").USER_JID(a),t:d("WAWap").CUSTOM_STRING(String(c)),type:d("WAWap").CUSTOM_STRING(b)})});e=(yield d("WADeprecatedSendIq").deprecatedSendIq((e=d("WAWap")).wap("iq",{to:e.S_WHATSAPP_NET,type:"set",xmlns:"privacy",id:e.generateId()},e.wap("tokens",null,b)),h));if(!e.success)throw new(d("WAWebBackendErrors").ServerStatusCodeError)(e.errorCode,e.errorText)});return i.apply(this,arguments)}g.TokenType=e;g.setPrivacyTokens=a}),98);
__d("WAWebSendTcTokenWhenDeviceIdentityChange",["WALogger","WATimeUtils","WAWebABProps","WAWebApiChat","WAWebBackendApi","WAWebRuntimeEnvironmentUtils","WAWebSetPrivacyTokensJob","WAWebTrustedContactsUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendTcTokenWhenDeviceIdentityChange failed - ",""]);h=function(){return a};return a}function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b;d("WAWebRuntimeEnvironmentUtils").isWorker()||d("WAWebABProps").getABPropConfigValue("web_tc_token_db_read_enabled")?b=(yield d("WAWebApiChat").getChatRecord(a)):b=(yield d("WAWebBackendApi").frontendSendAndReceive("getChat",{chatId:a}));if(b==null)return;b=b.tcTokenSenderTimestamp;if(b==null)return;if(d("WAWebTrustedContactsUtils").isTokenExpired(b,d("WAWebTrustedContactsUtils").TcTokenMode.Sender))return;try{yield d("WAWebSetPrivacyTokensJob").setPrivacyTokens(a,[d("WAWebSetPrivacyTokensJob").TokenType.TrustedContact],d("WATimeUtils").castToUnixTime(b))}catch(a){d("WALogger").WARN(h(),a).verbose().devConsole(a).sendLogs("send-tc-token-device-identity-change-failed")}});return i.apply(this,arguments)}g.sendTcTokenWhenDeviceIdentityChange=a}),98);
__d("WAWebIdentityChangeApi",["Promise","WAJids","WANullthrows","WAWebAdvDeviceNotificationApi","WAWebAdvUpdateParticipantApi","WAWebApiContact","WAWebApiDeviceList","WAWebBizCoexGatingUtils","WAWebContactSystemMsg","WAWebDeviceListPk","WAWebGetDefaultExport","WAWebHandleMsgTypes.flow","WAWebHandleSingleMsg","WAWebModelStorageUtils","WAWebOfflineDeviceCache","WAWebProtobufsAdv.pb","WAWebSecurityCodeApi","WAWebSendTcTokenWhenDeviceIdentityChange","WAWebSignal","WAWebVoip","WAWebWidFactory","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){var h;function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e;a=d("WAWebWidFactory").widFromSignalAddress(a);e=(e=a.device)!=null?e:d("WAJids").DEFAULT_DEVICE_ID;var f=d("WAWebWidFactory").toUserWid(a);if(e===d("WAJids").DEFAULT_DEVICE_ID){if(!c("gkx")("26254")){var g=c("WAWebGetDefaultExport")(b("WAWebVoip"));g.Voip.notifyDeviceIdentityChangedOrDeleted(a,!0)}g=b("WAWebSecurityCodeApi").addSecurityCodeChangedNotifications;yield j(f);yield g(f);void d("WAWebSendTcTokenWhenDeviceIdentityChange").sendTcTokenWhenDeviceIdentityChange(f)}else yield d("WAWebAdvDeviceNotificationApi").createAndStoreDeviceNotifications(f,[e],[e])});return i.apply(this,arguments)}function j(a,b){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){e===void 0&&(e=!1);var f=[d("WAJids").DEFAULT_DEVICE_ID],g=[d("WAJids").DEFAULT_DEVICE_ID],i=!1;if(e)d("WAWebOfflineDeviceCache").OfflinePendingDeviceCache.addOfflinePendingDevice(String(a),null),yield d("WAWebModelStorageUtils").getStorage().lock(["participant"],function(){return d("WAWebAdvUpdateParticipantApi").updateGroupParticipantsInTransaction(a,g,f)});else{e=(yield d("WAWebApiDeviceList").getDeviceRecord(a));e&&!e.deleted&&(e.devices.forEach(function(a){a.id!==d("WAJids").DEFAULT_DEVICE_ID&&f.push(a.id)}),d("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()&&e.advAccountType===d("WAWebProtobufsAdv.pb").ADVEncryptionType.HOSTED&&(i=!0));var j=b("WAWebSignal").Session;(h||(h=b("Promise"))).all(f.map(function(c){return c===d("WAJids").DEFAULT_DEVICE_ID?(h||(h=b("Promise"))).resolve():j.deleteRemoteInfo(d("WAWebWidFactory").createDeviceWidFromUserAndDevice(a.user,a.server,c))}));yield h.all([d("WAWebModelStorageUtils").getStorage().lock(["participant"],function(){return d("WAWebAdvUpdateParticipantApi").updateGroupParticipantsInTransaction(a,g,f)}),d("WAWebApiDeviceList").createOrReplaceDeviceRecord({id:d("WAWebDeviceListPk").createDeviceListPK(a),deleted:!0})]);if(d("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()&&i===!0){yield d("WAWebApiContact").updateContactAdvHostedType(a,d("WAWebProtobufsAdv.pb").ADVEncryptionType.E2EE);e=d("WAWebContactSystemMsg").genNotificationMsg(a,{type:"e2e_notification",subtype:"encrypt_now",templateParams:[]});yield d("WAWebHandleSingleMsg").handleSingleMsg(c("WANullthrows")(e.from),e,"bizStateChangeNotification",d("WAWebHandleMsgTypes.flow").MessageOverwriteOption.NO_OVERWRITE)}}});return k.apply(this,arguments)}g.handleNewIdentity=a;g.clearDeviceRecordForIdentityChange=j}),98);
__d("WAWebApiGetDeviceUpdateLock",["WAWebModelStorageUtils"],(function(a,b,c,d,e,f,g){function a(a,b,c,e){c===void 0&&(c=!1);e===void 0&&(e=!1);e=["participant","device-list"];b&&(e=[].concat(e,["message"]));c&&(e=[].concat(e,["missing-keys"]));return d("WAWebModelStorageUtils").getStorage().lock(e,function(){return a()})}g.getDeviceUpdateLock=a}),98);
__d("WAWebIdentityUpdateDeviceTableApi",["Promise","WAJids","WALogger","WASyncdStoreMissingKeys","WAWebAdvDeviceNotificationApi","WAWebAdvUpdateParticipantApi","WAWebApiContact","WAWebApiDeviceList","WAWebApiGetDeviceUpdateLock","WAWebBackendApi","WAWebDBEncryptMultipleMsgs","WAWebDBStoreEncryptedMsgs","WAWebDeviceListPk","WAWebGetMessageCache","WAWebProtobufsAdv.pb","WAWebSignalSessionApi","WAWebUserPrefsMeUser","WAWebWidFactory","asyncToGeneratorRuntime","err","lodash"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleDevicesNotification: failed to clean the signal info for ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: updateMissingKeyDevices failed with error:\n        ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["bulkCreateOrReplace into device list table failed"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["remove from device list table failed"]);l=function(){return a};return a}function m(a,b){if(b===d("WAWebProtobufsAdv.pb").ADVEncryptionType.HOSTED)throw c("err")("Unexpected account type");return null}function a(a,b,c,d,e){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g,i){f===void 0&&(f=!1);yield (h||(h=b("Promise"))).all(e.filter(function(a){return a.id!==d("WAJids").DEFAULT_DEVICE_ID}).map(function(b){return r(d("WAWebWidFactory").createDeviceWidFromUserAndDevice(a.user,a.server,b.id))}));var j=[],k=e.map(function(a){return a.id}).filter(function(a){return a!==d("WAJids").DEFAULT_DEVICE_ID});e=m(g,i);g=(yield p([{wid:a,added:j,removed:k,isNewRecord:!1,newAdvAccountType:e}],f,!0));var n=g.encryptedNotifications,o=g.chatIds;yield d("WAWebApiGetDeviceUpdateLock").getDeviceUpdateLock(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=n.length>0?d("WAWebDBStoreEncryptedMsgs").storeEncryptedDBMessages(n,o,!1):(h||(h=b("Promise"))).resolve(),f=d("WAWebAdvUpdateParticipantApi").updateGroupParticipantsInTransaction(a,j,k),g=d("WAWebApiDeviceList").createOrReplaceDeviceRecord({id:d("WAWebDeviceListPk").createDeviceListPK(a),deleted:!0})["catch"](function(a){d("WALogger").ERROR(l()).verbose().devConsole(a).sendLogs("remove from device list table failed when clearing device record");throw c("err")("remove from device list table failed")}),i=(h||(h=b("Promise"))).resolve();yield h.all([e,f,g,i])}),n.length>0,!1,e!=null)});return n.apply(this,arguments)}function e(a,b){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){e===void 0&&(e=!1);var f=[],g=[],i=!1;a.forEach(function(a){var b=a.wid,e=a.update;a=a.currentRecord;e=e.devices;e=e.map(function(a){return a.id});var h=a&&!a.deleted?a.devices.map(function(a){return a.id}):[],j=c("lodash").difference(e,h).filter(function(a){return a!==d("WAJids").DEFAULT_DEVICE_ID});h=c("lodash").difference(h,e).filter(function(a){return a!==d("WAJids").DEFAULT_DEVICE_ID});e=a==null;f.push({wid:b,added:j,removed:h,isNewRecord:e,newAdvAccountType:null});h.forEach(function(a){g.push(d("WAWebWidFactory").createDeviceWidFromUserAndDevice(b.user,b.server,a))});d("WAWebDeviceListPk").createDeviceListPK(b)===d("WAWebDeviceListPk").createDeviceListPK(d("WAWebUserPrefsMeUser").getMeUser())&&h.length>0&&(i=!0)});e=(yield p(f,e));var l=e.encryptedNotifications,m=e.chatIds;(h||(h=b("Promise"))).all(g.map(function(a){return r(a)}));yield d("WAWebApiGetDeviceUpdateLock").getDeviceUpdateLock(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=l.length>0?d("WAWebDBStoreEncryptedMsgs").storeEncryptedDBMessages(l,m,!1):(h||(h=b("Promise"))).resolve(),g=d("WAWebAdvUpdateParticipantApi").bulkUpdateGroupParticipantsInTransaction(f),n=d("WAWebApiDeviceList").bulkCreateOrReplaceDeviceRecord(a.map(function(a){return a.update}))["catch"](function(a){d("WALogger").ERROR(k()).verbose().devConsole(a).sendLogs("bulkCreateOrReplace into device list table failed when applying device update");throw c("err")("bulkCreateOrReplace into device list table failed")}),o=i?n.then(function(){return d("WASyncdStoreMissingKeys").updateMissingKeyDevices()["catch"](function(a){d("WALogger").WARN(j(),a)})}):(h||(h=b("Promise"))).resolve();yield (h||(h=b("Promise"))).all([e,g,n,o])}),l.length>0,i)});return o.apply(this,arguments)}function p(a,b,c){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){c===void 0&&(c=!1);c=(yield d("WAWebAdvDeviceNotificationApi").bulkGenerateDeviceNotifications(a));a=c.notifications;c=c.chatIds;if(!b){b=(yield d("WAWebDBEncryptMultipleMsgs").encryptMultipleDBMsgs(a));t(a);return{chatIds:c,encryptedNotifications:b}}d("WAWebGetMessageCache").getMessageCache().addMessages(a.map(function(a){return{msg:a}}),!1);return{chatIds:[],encryptedNotifications:[]}});return q.apply(this,arguments)}function r(a){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=b("WAWebSignalSessionApi"),e=c.deleteDeviceSenderKey;c=c.deleteRemoteInfo;try{yield (h||(h=b("Promise"))).all([c(a),e(a)])}catch(b){d("WALogger").LOG(i(),a.user)}});return s.apply(this,arguments)}function t(a){return(h||(h=b("Promise"))).all(a.map(function(a){return d("WAWebBackendApi").frontendSendAndReceive("processMultipleMessages",{chatId:a.from,msgObjs:[babelHelpers["extends"]({},a,{recvFresh:!0,isNewMsg:!0})],meta:{add:"after",isHistory:!1},processMessagesOrigin:"updateDeviceTableApi"})}))}g.getAdvAccountTypeIfChanged=m;g.clearDeviceRecord=a;g.bulkApplyDeviceUpdate=e}),98);
__d("WAWebSecurityCodeApi",["WALogger","WAWebBackendApi","WAWebContactSystemMsg","WAWebDBEncryptMultipleMsgs","WAWebDBStoreEncryptedMsgs","WAWebGetMessageCache","WAWebSchemaChat","WAWebSchemaGroupMetadata","WAWebSchemaParticipant","WAWebUserPrefsNotifications","WAWebWidFactory","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["get chats failed"]);h=function(){return a};return a}function a(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){b===void 0&&(b=!1);if(a.isBot())return;a=(yield j(a));var c=a.notifications;a=a.chatIds;if(c.length===0)return;if(!b){c=c.map(function(a){return babelHelpers["extends"]({},a,{recvFresh:!0,isNewMsg:!0})});for(b of c)d("WAWebBackendApi").frontendSendAndReceive("processMultipleMessages",{chatId:b.from,msgObjs:[b],meta:{add:"after",isHistory:!1},processMessagesOrigin:"securityCodeApi"});b=(yield d("WAWebDBEncryptMultipleMsgs").encryptMultipleDBMsgs(c));return d("WAWebDBStoreEncryptedMsgs").storeEncryptedDBMessages(b,a,!1)}d("WAWebGetMessageCache").getMessageCache().addMessages(c.map(function(a){return{msg:a}}),!1)});return i.apply(this,arguments)}function j(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b={notifications:[],chatIds:[]};if(!d("WAWebUserPrefsNotifications").getGlobalSecurityNotifications())return b;var e=[];try{var f=(yield d("WAWebSchemaChat").getChatTable().get(a.toString(),!1));f&&e.push(d("WAWebWidFactory").createWid(f.id));f=(yield d("WAWebSchemaParticipant").getParticipantTable().equals(["participants"],String(a)));var g=new Map();if(f.length>0){var i=f.map(function(a){return a.groupId});(yield d("WAWebSchemaGroupMetadata").getGroupMetadataTable().bulkGet(i)).forEach(function(a){a!=null&&g.set(a.id,a)})}f.forEach(function(b){var c=g.get(b.groupId);if(Boolean(c==null?void 0:c.defaultSubgroup)===!0&&a.isLid())return;e.push(d("WAWebWidFactory").createWid(b.groupId))})}catch(a){d("WALogger").ERROR(h()).verbose().devConsole(a).sendLogs("get chats failed when creating device notification");throw c("err")("get chats failed")}i=e.map(function(b){return d("WAWebContactSystemMsg").genSecurityCodeNotificationMsg(b,a)});b.notifications=i;b.chatIds=e.map(String);return b});return k.apply(this,arguments)}g.addSecurityCodeChangedNotifications=a;g.generateSecurityCodeChangedNotifications=j}),98);
__d("WAWebDeviceSentMessageProtoUtils",[],(function(a,b,c,d,e,f){function a(a,b){b={deviceSentMessage:{destinationJid:b.toString({legacy:!0}),message:a}};a=a==null?void 0:(a=a.messageContextInfo)==null?void 0:a.messageSecret;a!=null&&(b.messageContextInfo={messageSecret:a});return b}function b(a){var b,c;b=a==null?void 0:(b=a.deviceSentMessage)==null?void 0:b.message;a=a==null?void 0:(a=a.messageContextInfo)==null?void 0:a.messageSecret;return b==null||a==null||((c=b.messageContextInfo)==null?void 0:c.messageSecret)!=null?b:babelHelpers["extends"]({},b,{messageContextInfo:babelHelpers["extends"]({},b.messageContextInfo,{messageSecret:a})})}f.wrapDeviceSentMessage=a;f.unwrapDeviceSentMessage=b}),66);
__d("WAWebProtobufsEphemeral.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.internalSpec={duration:[1,d("WAProtoConst").TYPES.SFIXED32],timestamp:[2,d("WAProtoConst").TYPES.SFIXED64]};g.EphemeralSettingSpec=a}),98);
__d("WAWebEphemeralDecodeBroadcastSetting",["WABase64","WABinary","WATimeUtils","WAWebProtobufsEphemeral.pb","asyncToGeneratorRuntime","decodeProtobuf","err"],(function(a,b,c,d,e,f,g){var h=new Uint8Array(32);function i(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=(yield self.crypto.subtle.importKey("raw",a,"HKDF",!1,["deriveKey"]));b=(yield self.crypto.subtle.deriveKey({name:"HKDF",hash:"SHA-256",salt:h,info:b},a,{name:"HMAC",hash:"SHA-256"},!0,["verify"]));return self.crypto.subtle.exportKey("raw",b)});return j.apply(this,arguments)}function k(a,b,c){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){var d=a.slice(0,12);a=a.slice(12,44);a=(yield self.crypto.subtle.importKey("raw",a,"AES-GCM",!1,["decrypt"]));return self.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(d),additionalData:c},a,b)});return l.apply(this,arguments)}function a(a,b,c,d,e){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g){a=a.toString({legacy:!0});b=b.toString({legacy:!0});e=e.toString({legacy:!0});b="Ephemeral "+b+" "+a;a=d("WABinary").Binary.build(b).readByteArray();b=new Uint8Array(g);g=d("WABase64").decodeB64(f);f=d("WABinary").Binary.build(e).readBuffer();e=(yield i(b,a));b=(yield k(e,g,f));a=d("decodeProtobuf").decodeProtobuf(d("WAWebProtobufsEphemeral.pb").EphemeralSettingSpec,b);e=a.duration;g=a.timestamp;if(e==null||g==null)throw c("err")("ephSetting decoded into malformed proto");return{ephemeralDuration:e,ephemeralSettingTimestamp:d("WATimeUtils").castLongIntToUnixTime(g)}});return m.apply(this,arguments)}g.decodeBroadcastEphemeralSetting=a}),98);
__d("WAWebGroupMsgReceiveUtils",["WAWebGroupType","WAWebMessageEditGatingUtils","WAWebSchemaGroupMetadata","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("WAWebSchemaGroupMetadata").getGroupMetadataTable().get(a.toString()));if(!a)return!1;a=d("WAWebGroupType").getGroupTypeFromGroupMetadata(a);return a===d("WAWebGroupType").GroupType.LINKED_ANNOUNCEMENT_GROUP?!d("WAWebMessageEditGatingUtils").receiveCagMsgEditEnabled():!1});return h.apply(this,arguments)}g.futureproofEditInCAG=a}),98);
__d("WAWebProcessBaseMsgInfo",["WALogger","WANullthrows","err"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["msgData: type:"," error:",""]);h=function(){return a};return a}a=function(a){var b;b={id:a.id,from:a.from,to:a.to,type:a.type,t:a.t,ack:a.ack,count:null,author:a.author,notifyName:a.notifyName,invis:(b=a.invis)!=null?b:!1,subtype:a.subtype};return b};var i=function(a){var b;return{id:a.id,from:a.from,to:a.to,type:a.type,t:c("WANullthrows")(a.t,"t"),ack:c("WANullthrows")(a.ack,"ack"),count:null,author:a.author,notifyName:a.notifyName,invis:(b=a.invis)!=null?b:!1,subtype:a.subtype}};b=function(a){try{return i(a)}catch(b){d("WALogger").WARN(h(),a.type,b).tags("messaging").sendLogs("BaseMsgInfo: MsgData doesn't have required fields");throw c("err")("Invalid MsgData object")}};g.msgToBaseMsgInfo=a;g.msgDataToBaseMsgInfo=b}),98);
__d("WAWebMsgProcessingApiUtils",["Promise","WAJids","WALogger","WANullthrows","WATimeUtils","WAWebAck","WAWebBackendJobs.flow","WAWebBizCoexGatingUtils","WAWebBotGating","WAWebDBProcessMessage","WAWebDeviceSentMessageProtoUtils","WAWebE2EProtoParser","WAWebEphemeralDecodeBroadcastSetting","WAWebFutureproofingEdit","WAWebGetMessageCache","WAWebGroupMsgReceiveUtils","WAWebHandleMessageTypes.flow","WAWebHandleMsgError","WAWebHandleMsgTypes.flow","WAWebMessagePluginGenerateReportingTokenContent","WAWebMessagingGatingUtils","WAWebMsgKey","WAWebMsgKeyUtils","WAWebMsgType","WAWebProcessBaseMsgInfo","WAWebReportingTokenUtils","WAWebUserPrefsMeUser","WAWebWamEnumDeviceType","WAWebWamEnumDsmError","WAWebWamMsgUtils","WAWebWid","WAWebWidFactory","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["drop: cannot create MsgKey: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["protocol message: wid error in type ",""]);j=function(){return a};return a}function k(a){var b,c="";((b=a.protocolMessage)==null?void 0:b.historySyncNotification)!=null?c="historySyncNotification":((b=a.protocolMessage)==null?void 0:b.initialSecurityNotificationSettingSync)!=null?c="initialSecurityNotificationSettingSync":((b=a.protocolMessage)==null?void 0:b.appStateSyncKeyRequest)!=null?c="appStateSyncKeyRequest":((b=a.protocolMessage)==null?void 0:b.appStateSyncKeyShare)!=null?c="appStateSyncKeyShare":((b=a.protocolMessage)==null?void 0:b.peerDataOperationRequestResponseMessage)!=null?c="peerDataOperationRequestResponseMessage":((b=a.protocolMessage)==null?void 0:b.peerDataOperationRequestMessage)!=null&&(c="peerDataOperationRequestMessage");d("WALogger").ERROR(j(),c).sendLogs("wid error")}function l(a){var b=a.info,e=a.msgProtobuf,f=a.paymentInfo,g=a.bizInfo;a=a.msgBotInfo;var h,i=H(b);if(!d("WAWebUserPrefsMeUser").isMeAccountNonLid(i)){k(e);return}if(((i=e.protocolMessage)==null?void 0:i.historySyncNotification)!=null){i=d("WAWebE2EProtoParser").parseMsgProto(e,B(b),"relay",f,void 0,void 0,g);C(i,a);h={history:c("WANullthrows")(i.historySyncMetaData)}}else if(((b=e.protocolMessage)==null?void 0:b.initialSecurityNotificationSettingSync)!=null){h={securityNotificationEnabled:{isEnabled:(f=e.protocolMessage.initialSecurityNotificationSettingSync.securityNotificationEnabled)!=null?f:!0}}}else if(((g=e.protocolMessage)==null?void 0:g.appStateSyncKeyShare)!=null)h={appStateSyncKeyShare:e.protocolMessage.appStateSyncKeyShare};else if(((a=e.protocolMessage)==null?void 0:a.appStateSyncKeyRequest)!=null)h={appStateSyncKeyRequest:e.protocolMessage.appStateSyncKeyRequest};else if(((i=e.protocolMessage)==null?void 0:i.peerDataOperationRequestResponseMessage)!=null){h={peerDataOperationRequestResponseMessage:(b=e.protocolMessage)==null?void 0:b.peerDataOperationRequestResponseMessage}}else if(((f=e.protocolMessage)==null?void 0:f.peerDataOperationRequestMessage)!=null){h={peerDataOperationRequestMessage:(g=e.protocolMessage)==null?void 0:g.peerDataOperationRequestMessage}}return h}function a(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b,e=a.msgProtobuf,f=a.info;if(((b=e.protocolMessage)==null?void 0:b.historySyncNotification)!=null||((b=e.protocolMessage)==null?void 0:b.initialSecurityNotificationSettingSync)!=null||((b=e.protocolMessage)==null?void 0:b.appStateSyncKeyShare)!=null||((b=e.protocolMessage)==null?void 0:b.appStateSyncKeyRequest)!=null||((b=e.protocolMessage)==null?void 0:b.peerDataOperationRequestResponseMessage)!=null||((b=e.protocolMessage)==null?void 0:b.peerDataOperationRequestMessage)!=null)return l({info:f,msgProtobuf:e,paymentInfo:a.paymentInfo,bizInfo:a.bizInfo,hsmInfo:a.hsmInfo});switch(f.type){case d("WAWebHandleMsgTypes.flow").MESSAGE_TYPE.CHAT:return d("WAWebUserPrefsMeUser").isMeAccount(f.author)?p(a):t(a);case d("WAWebHandleMsgTypes.flow").MESSAGE_TYPE.GROUP:return d("WAWebUserPrefsMeUser").isMeAccount(f.author)&&f.isDirect?p(a):t(a);case d("WAWebHandleMsgTypes.flow").MESSAGE_TYPE.PEER_BROADCAST:if(a.ciphertextType===d("WAWebBackendJobs.flow").CiphertextType.Skmsg){if(!f.bclHashValidated)throw c("err")("parseMessage: participants for peer broadcast message is not validated");return t(a)}return r(a);case d("WAWebHandleMsgTypes.flow").MESSAGE_TYPE.OTHER_BROADCAST:return t(a);case d("WAWebHandleMsgTypes.flow").MESSAGE_TYPE.DIRECT_PEER_STATUS:return f.isDirect===!0?n(a):r(a);case d("WAWebHandleMsgTypes.flow").MESSAGE_TYPE.OTHER_STATUS:return t(a);default:throw c("err")("Unrecognized MESSAGE_TYPE")}});return m.apply(this,arguments)}function n(a){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){try{return yield p(a)}catch(c){if(c instanceof d("WAWebHandleMsgError").DeviceSentMessageError){var b=Object.keys(a.msgProtobuf).filter(function(a){return a!=="$$unknownFieldCount"&&a!=="messageContextInfo"});if(b.length===1&&b[0]==="senderKeyDistributionMessage")return t(a)}throw c}});return o.apply(this,arguments)}function p(a){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.msgProtobuf;a=babelHelpers.objectWithoutPropertiesLoose(a,["msgProtobuf"]);var c=b.deviceSentMessage;if(c==null)throw new(d("WAWebHandleMsgError").DeviceSentMessageError)(G(a.info.author),d("WAWebWamEnumDsmError").DSM_ERROR.MISSING_DSM);if(c.destinationJid==null)throw new(d("WAWebHandleMsgError").DeviceSentMessageError)(G(a.info.author),d("WAWebWamEnumDsmError").DSM_ERROR.INVALID_DSM);c=c.destinationJid;b=(yield v(d("WAWebDeviceSentMessageProtoUtils").unwrapDeviceSentMessage(b),a));return babelHelpers["extends"]({deviceSent:{destination:d("WAWebWidFactory").createWid(c)}},b)});return q.apply(this,arguments)}function r(a){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.msgProtobuf;a=babelHelpers.objectWithoutPropertiesLoose(a,["msgProtobuf"]);var c=a.info,e=b.deviceSentMessage;if(e==null)throw new(d("WAWebHandleMsgError").DeviceSentMessageError)(G(c.author),d("WAWebWamEnumDsmError").DSM_ERROR.MISSING_DSM);if(e.phash==null)throw new(d("WAWebHandleMsgError").DeviceSentMessageError)(G(c.author),d("WAWebWamEnumDsmError").DSM_ERROR.INVALID_DSM);e=e.phash;b=(yield v(d("WAWebDeviceSentMessageProtoUtils").unwrapDeviceSentMessage(b),a));return babelHelpers["extends"]({deviceSent:{phash:e,info:c}},b)});return s.apply(this,arguments)}function t(a){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.msgProtobuf;a=babelHelpers.objectWithoutPropertiesLoose(a,["msgProtobuf"]);if(b.deviceSentMessage!=null)throw new(d("WAWebHandleMsgError").DeviceSentMessageError)(G(a.info.author),d("WAWebWamEnumDsmError").DSM_ERROR.INVALID_SENDER);b=(yield v(b,a));return babelHelpers["extends"]({deviceSent:null},b)});return u.apply(this,arguments)}function v(a,b){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e=b.info,f=b.paymentInfo,g=b.bizInfo,h=b.hidePlaceholder,i=b.processDecryptedProtoParams,j=b.hsmInfo,k=b.msgBotInfo;b=b.reportingTokenInfo;if(a==null)return{senderKey:null,storeMsg:null,renderableMsgs:[]};g=babelHelpers["extends"]({},d("WAWebE2EProtoParser").parseMsgProto(a,B(e),"relay",f,void 0,void 0,g,e.edit,i==null?void 0:i.rcat,i==null?void 0:(f=i.msgMeta)==null?void 0:f.bizSource,i==null?void 0:i.msgMeta));C(g,k,i==null?void 0:(f=i.msgMeta)==null?void 0:f.targetSenderJid,i==null?void 0:(k=i.msgMeta)==null?void 0:k.targetId);if(b!=null&&d("WAWebMessagingGatingUtils").isReportingTokenReceivingEnabled()){d("WAWebGetMessageCache").getMessageCache().addAdditionalInfo({type:d("WAWebHandleMessageTypes.flow").MsgAdditionalInfoType.ReportingTokenInfo,data:{id:g.id.toString(),reportingTag:b.reportingTag,reportingTokenContent:b.reportingToken!=null?d("WAWebMessagePluginGenerateReportingTokenContent").generateReportingTokenContent(g):null,version:b.reportingToken!=null?(k=(f=a.messageContextInfo)==null?void 0:f.reportingTokenVersion)!=null?k:d("WAWebReportingTokenUtils").REPORTING_TOKEN_VERSION.DEFAULT:null,ts:d("WATimeUtils").unixTimeMs()}})}j!=null&&(g.hsmTag=j.tag,g.hsmCategory=j.category);if((i==null?void 0:(b=i.msgMeta)==null?void 0:b.bizSource)!=null){g.bizSource=i==null?void 0:(f=i.msgMeta)==null?void 0:f.bizSource}k=a.senderKeyDistributionMessage!=null?x(e,a.senderKeyDistributionMessage):null;if(g.subtype==="message_edit"&&g.futureproofSubtype!=="message_edit"&&(yield d("WAWebGroupMsgReceiveUtils").futureproofEditInCAG(e.chat))){j=d("WAWebProcessBaseMsgInfo").msgDataToBaseMsgInfo(g);g=babelHelpers["extends"]({},d("WAWebFutureproofingEdit").futureproofEdit(j))}b=g.type===d("WAWebMsgType").MSG_TYPE.UNKNOWN&&k==null;f=g.type===d("WAWebMsgType").MSG_TYPE.UNKNOWN&&k!=null;a=null;if(b&&i!=null){j=i.decrypted;i.reparsing;b=babelHelpers.objectWithoutPropertiesLoose(i,["decrypted","reparsing"]);g.futureproofParams=b;g.futureproofBuffer=j}e.type===d("WAWebHandleMsgTypes.flow").MESSAGE_TYPE.OTHER_STATUS&&(g.campaignId=e.campaignId,g.campaignDuration=e.campaignDuration);e.type===d("WAWebHandleMsgTypes.flow").MESSAGE_TYPE.PEER_BROADCAST&&(g.broadcastId=e.chat,g.broadcastParticipants=e.bclParticipants,g.broadcastEphSettings=e.bclEphSettings,a=g);if(e.type===d("WAWebHandleMsgTypes.flow").MESSAGE_TYPE.OTHER_BROADCAST){g.broadcastId=e.chat;i=e.ephSetting;b=g.ephemeralSharedSecret;if(i!=null&&b!=null){j=(yield d("WAWebEphemeralDecodeBroadcastSetting").decodeBroadcastEphemeralSetting(e.chat,e.author.isLid()?c("WANullthrows")(d("WAWebUserPrefsMeUser").getMaybeMeLidUser()):d("WAWebUserPrefsMeUser").getMeUser(),e.author,i,b));i=j.ephemeralDuration;b=j.ephemeralSettingTimestamp;g.ephemeralDuration=i;g.ephemeralSettingTimestamp=b}}j=[];i=g.type===d("WAWebMsgType").MSG_TYPE.UNKNOWN;b=f||i&&h===!0&&g.futureproofType==null;b||(e.type===d("WAWebHandleMsgTypes.flow").MESSAGE_TYPE.PEER_BROADCAST?j=(yield D(g,e.bclParticipants,e.bclEphSettings)):(g.subtype==="payment_transaction_request_cancelled"||g.subtype==="payment_action_request_declined")&&g.paymentRequestMessageKey==null||(j=[g]));return{senderKey:k,storeMsg:a,renderableMsgs:j}});return w.apply(this,arguments)}function x(a,b){if(!a.chat.isGroup()&&!a.chat.isBroadcast())throw c("err")("should not have senderkey");var d=b.groupId;b=b.axolotlSenderKeyDistributionMessage;if(d==null||a.chat.toString({legacy:!0})!==d)throw c("err")("senderKeyDistributionMessage: from "+a.chat.toString()+" mismatched to "+(d||"null"));if(!b)throw c("err")("senderKeyDistributionMessage: from "+a.author.toString()+" has no content");return{groupId:d,key:b}}function y(a){return a.edit===d("WAWebAck").EDIT_ATTR.SENDER_REVOKE&&a.type!==d("WAWebHandleMsgTypes.flow").MESSAGE_TYPE.PEER_BROADCAST?!1:!0}function e(a,b,c){return z.apply(this,arguments)}function z(){z=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){if(!y(a))return[];var e=null;switch(b){case d("WAWebHandleMsgTypes.flow").PlaceholderType.E2E:e=void 0;break;case d("WAWebHandleMsgTypes.flow").PlaceholderType.BOT_UNAVAILABLE_FANOUT:e="bot_unavailable_fanout";break;case d("WAWebHandleMsgTypes.flow").PlaceholderType.HOSTED_UNAVAILABLE_FANOUT:e="hosted_unavailable_fanout";break;default:e="fanout"}b=babelHelpers["extends"]({},B(a),{type:d("WAWebMsgType").MSG_TYPE.CIPHERTEXT,kind:d("WAWebMsgType").MsgKind.Ciphertext,subtype:e,e2eSenderType:d("WAWebWamMsgUtils").getWamE2eSenderType(a.author),placeholderAddReason:c,broadcastParticipants:a.type===d("WAWebHandleMsgTypes.flow").MESSAGE_TYPE.PEER_BROADCAST?a.bclParticipants:void 0,broadcastEphSettings:a.type===d("WAWebHandleMsgTypes.flow").MESSAGE_TYPE.PEER_BROADCAST?a.bclEphSettings:void 0});if(a.type===d("WAWebHandleMsgTypes.flow").MESSAGE_TYPE.PEER_BROADCAST){d("WAWebDBProcessMessage").storeMessages([b],b.id.remote);return a.edit===d("WAWebAck").EDIT_ATTR.SENDER_REVOKE?[]:D(b,a.bclParticipants)}return[b]});return z.apply(this,arguments)}function f(a,b){a=babelHelpers["extends"]({},B(a),{type:d("WAWebMsgType").MSG_TYPE.DEBUG_PLACEHOLDER,kind:d("WAWebMsgType").MsgKind.DebugPlaceholder,body:b.toString()});return a}function A(a,b){if(d("WAWebBotGating").isBotMsgParseEnabledForFutureproofOrFullRecv()&&b.botParticipant!=null)return b.botParticipant;if(!a.fromMe&&c("WAWebWid").isGroup(a.remote)||c("WAWebWid").isStatusV3(a.remote))return a.participant;return!d("WAWebUserPrefsMeUser").isMeDevice(b.author)&&d("WAWebUserPrefsMeUser").isMeAccount(b.author)?b.author:void 0}function B(a){var b=F(a),e=d("WAWebUserPrefsMeUser").getMeUser(),f=d("WAWebUserPrefsMeUser").getMaybeMeLidUser();b.fromMe&&c("WAWebWid").isGroup(b.remote)&&a.author.isLid()&&f!=null?f=f:f=e;f=b.fromMe?f:b.remote;f={id:b,from:f,to:b.fromMe?b.remote:e,type:d("WAWebMsgType").MSG_TYPE.UNKNOWN,t:a.ts||0,ack:d("WAWebMsgKeyUtils").isNoteToSelf(b)?d("WAWebAck").ACK.READ:d("WAWebAck").ACK.SENT,author:A(b,a),notifyName:a.pushname||"",invis:!1,count:a.count};d("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()&&a.hostedBizEncStateMismatch===!0&&(f.hostedBizEncStateMismatch=!0);d("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()&&a.senderOrRecipientAccountTypeHosted===!0&&(f.senderOrRecipientAccountTypeHosted=!0);return f}function C(a,b,c,e){if(b!=null&&d("WAWebBotGating").isBotMsgParseEnabledForFutureproofOrFullRecv()){a=a;Object.assign(a,{botEditTargetId:b.botEditTargetId,botEditType:b.botEditType,bizBotType:b.bizBotType,botTargetSenderJid:c,botResponseTargetId:e})}}function D(a,b,c){return E.apply(this,arguments)}function E(){E=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){e=(yield (h||(h=b("Promise"))).all(e.map(function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var e;try{e=new(c("WAWebMsgKey"))({remote:b,fromMe:!0,id:a.id.id})}catch(a){d("WALogger").WARN(i(),a.stack);return null}var g,h,j=f?f[b.toString()]:null,k=a.ephemeralSharedSecret,l=a.broadcastId;if(l!=null&&j!=null&&k!=null){l=(yield d("WAWebEphemeralDecodeBroadcastSetting").decodeBroadcastEphemeralSetting(l,b,b.isLid()?c("WANullthrows")(d("WAWebUserPrefsMeUser").getMaybeMeLidUser()):d("WAWebUserPrefsMeUser").getMeUser(),j,k));g=l.ephemeralDuration;h=l.ephemeralSettingTimestamp}j=babelHelpers["extends"]({},a,{id:e,from:d("WAWebUserPrefsMeUser").getMeUser(),to:b,broadcast:!0,ephemeralDuration:g,ephemeralSettingTimestamp:h,protocolMessageKey:a.protocolMessageKey==null?void 0:new(c("WAWebMsgKey"))({remote:b,fromMe:!0,id:a.protocolMessageKey.id})});return j});return function(a){return e.apply(this,arguments)}}())));return e.filter(Boolean)});return E.apply(this,arguments)}function F(a){if(a.type===d("WAWebHandleMsgTypes.flow").MESSAGE_TYPE.OTHER_BROADCAST)return new(c("WAWebMsgKey"))({remote:d("WAWebWidFactory").toUserWid(a.author),fromMe:!1,id:a.externalId});else if(a.type===d("WAWebHandleMsgTypes.flow").MESSAGE_TYPE.CHAT)return d("WAWebBotGating").isBotMsgParseEnabledForFutureproofOrFullRecv()&&a.botParticipant!=null?new(c("WAWebMsgKey"))({remote:a.chat,fromMe:d("WAWebUserPrefsMeUser").isMeAccount(a.author),id:a.externalId,participant:d("WAWebWidFactory").toUserWid(c("WANullthrows")(a.botParticipant))}):new(c("WAWebMsgKey"))({remote:a.chat,fromMe:d("WAWebUserPrefsMeUser").isMeAccount(a.author),id:a.externalId});return new(c("WAWebMsgKey"))({remote:a.chat,fromMe:d("WAWebUserPrefsMeUser").isMeAccount(a.author),participant:d("WAWebWidFactory").toUserWid(a.author),id:a.externalId})}function G(a){return a.device==null||a.device===d("WAJids").DEFAULT_DEVICE_ID?d("WAWebWamEnumDeviceType").DEVICE_TYPE.PRIMARY:d("WAWebWamEnumDeviceType").DEVICE_TYPE.COMPANION}function H(a){return a.type===d("WAWebHandleMsgTypes.flow").MESSAGE_TYPE.CHAT?a.author:a.chat}g.parseProtocolMessage=l;g.parseMessage=a;g.placeholderCheck=y;g.genPlaceholderMsg=e;g.genDebugPlaceholderMsg=f;g.generateBaseMsg=B;g.messageInfoToKey=F;g.getDeviceType=G;g.getFrom=H}),98);
__d("WAWebWamEnumMessageDropReasonType",[],(function(a,b,c,d,e,f){a=Object.freeze({SYNCD_DELETION:1,ADMIN_REVOKE_NOT_ENABLED:2,RECEIVED_WITH_OLD_COUNTER:3,INVALID_STANZA:4,INVALID_PROTOBUF:5,MESSAGE_SECRET_ERROR:6,INVALID_LID_ADDRESSED_MESSAGE:7,UNKNOWN_MESSAGE_TYPE:8,DB_OPERATION_FAILED:9,INTERNAL_ERROR:10,EXPIRED:11,INVALID_HOSTED_COMPANION_STANZA:12,MESSAGE_REVOKED:13,PAYMENT_MESSAGE_REVOKED:14,DUPLICATE_MESSAGE:15,DUPLICATE_DELIVERY:16});f.MESSAGE_DROP_REASON_TYPE=a}),66);
__d("WAWebIncomingMessageDropWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumAgentEngagementEnumType","WAWebWamEnumBotType","WAWebWamEnumE2eCiphertextType","WAWebWamEnumE2eDestination","WAWebWamEnumE2eFailureReason","WAWebWamEnumE2eSenderType","WAWebWamEnumInvisibleMessageCategoryType","WAWebWamEnumMediaType","WAWebWamEnumMessageDropReasonType","WAWebWamEnumRevokeType","WAWebWamEnumTypeOfGroupEnum"],(function(a,b,c,d,e,f,g){b=(a=d("WAWebWamCodegenUtils")).defineEvents({IncomingMessageDrop:[3724,{agentEngagementType:[12,d("WAWebWamEnumAgentEngagementEnumType").AGENT_ENGAGEMENT_ENUM_TYPE],botType:[14,d("WAWebWamEnumBotType").BOT_TYPE],e2eCiphertextType:[1,d("WAWebWamEnumE2eCiphertextType").E2E_CIPHERTEXT_TYPE],e2eDestination:[2,d("WAWebWamEnumE2eDestination").E2E_DESTINATION],e2eFailureReason:[9,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON],e2eSenderType:[3,d("WAWebWamEnumE2eSenderType").E2E_SENDER_TYPE],invisibleMessageCategory:[13,d("WAWebWamEnumInvisibleMessageCategoryType").INVISIBLE_MESSAGE_CATEGORY_TYPE],messageDropReason:[4,d("WAWebWamEnumMessageDropReasonType").MESSAGE_DROP_REASON_TYPE],messageMediaType:[5,d("WAWebWamEnumMediaType").MEDIA_TYPE],offline:[6,a.TYPES.BOOLEAN],offlineCount:[11,a.TYPES.INTEGER],retryCount:[7,a.TYPES.INTEGER],revokeType:[8,d("WAWebWamEnumRevokeType").REVOKE_TYPE],typeOfGroup:[10,d("WAWebWamEnumTypeOfGroupEnum").TYPE_OF_GROUP_ENUM]},[1,1,1],"regular"]});g.IncomingMessageDropWamEvent=b}),98);
__d("WAWebPostIncomingMessageDropMetric",["WADeprecatedWapParser","WAWebAck","WAWebBackendJobs.flow","WAWebBackendJobsCommon","WAWebDBMessageSerialization","WAWebHandleMsgCommon","WAWebIncomingMessageDropWamEvent","WAWebJidToWid","WAWebMsgGetters","WAWebMsgProcessingApiUtils","WAWebWamEnumAgentEngagementEnumType","WAWebWamEnumBotType","WAWebWamEnumE2eDestination","WAWebWamEnumMessageDropReasonType","WAWebWamEnumRevokeType","WAWebWamMsgUtils"],(function(a,b,c,d,e,f,g){var h=new(c("WADeprecatedWapParser"))("incomingMsgParserForMetric",function(a){var b={};try{b.type=a.attrEnum("type",d("WAWebHandleMsgCommon").STANZA_MSG_TYPES)}catch(a){}try{b.pollType=b.type===d("WAWebHandleMsgCommon").STANZA_MSG_TYPES.poll?a.child("meta").attrEnumOrNullIfUnknown("polltype",d("WAWebHandleMsgCommon").POLL_TYPES):null}catch(a){}try{var c;b.from=d("WAWebJidToWid").jidWithTypeToWid(a.attrJidWithType("from"));((c=b.from)==null?void 0:c.isUser())?b.author=b.from:((c=b.from)==null?void 0:c.isGroup())&&(b.author=a.hasAttr("participant")?d("WAWebJidToWid").deviceJidToDeviceWid(a.attrDeviceJid("participant")):null)}catch(a){}try{b.offline=a.attrString("offline")!==""}catch(a){}try{b.edit=a.attrInt("edit")}catch(a){}try{c=a.attrString("category");c=d("WAWebWamMsgUtils").getWamInvisibleMessageCatgoryType(c);c!=null&&(b.invisibleMessageCategoryType=c)}catch(a){}c=a.maybeChild("enc");if(c!=null){try{b.e2eType=c.attrEnumValues("type",d("WAWebBackendJobs.flow").CiphertextType.members())}catch(a){}try{b.encMediaType=d("WAWebBackendJobs.flow").EncMediaType.cast(c.maybeAttrString("mediatype"))}catch(a){}try{b.retryCount=c.attrInt("count")}catch(a){}}try{b.botType=d("WAWebWamEnumBotType").BOT_TYPE.UNKNOWN;if((c=b.author)==null?void 0:c.isBot())b.botType=d("WAWebWamEnumBotType").BOT_TYPE.METABOT;else{a=(c=a.maybeChild("bot"))==null?void 0:c.maybeAttrString("biz_bot");a==="1"?b.botType=d("WAWebWamEnumBotType").BOT_TYPE.BOT_1P_BIZ:a==="3"&&(b.botType=d("WAWebWamEnumBotType").BOT_TYPE.BOT_3P_BIZ)}}catch(a){}return b});function i(a){var b=a.messageDropReason;a=a.stanza;var c=null;try{c=h.parse(a).success}catch(a){}b=new(d("WAWebIncomingMessageDropWamEvent").IncomingMessageDropWamEvent)({messageDropReason:b,offline:(b=(a=c)==null?void 0:a.offline)!=null?b:!1,messageMediaType:d("WAWebBackendJobsCommon").getMetricMediaType({encMediaType:(a=c)==null?void 0:a.encMediaType,msgType:(b=c)==null?void 0:b.type,msgPollType:(a=c)==null?void 0:a.pollType})});if(((a=c)==null?void 0:a.from)!=null){a=d("WAWebBackendJobsCommon").getMetricE2eDestination(c.from);a!=null&&(b.e2eDestination=a)}if(((a=c)==null?void 0:a.author)!=null){a=d("WAWebWamMsgUtils").getWamE2eSenderType(c.author);a!=null&&(b.e2eSenderType=a)}((a=c)==null?void 0:a.e2eType)!=null&&(b.e2eCiphertextType=d("WAWebBackendJobsCommon").getMetricE2eCiphertextType(c.e2eType));((a=c)==null?void 0:a.retryCount)!=null&&(b.retryCount=c.retryCount);((a=c)==null?void 0:a.edit)===d("WAWebAck").EDIT_ATTR.ADMIN_REVOKE?b.revokeType=d("WAWebWamEnumRevokeType").REVOKE_TYPE.ADMIN:((a=c)==null?void 0:a.edit)===d("WAWebAck").EDIT_ATTR.SENDER_REVOKE&&(b.revokeType=d("WAWebWamEnumRevokeType").REVOKE_TYPE.SENDER);if(((a=c)==null?void 0:a.from)!=null&&((a=c)==null?void 0:a.author)!=null){if(((a=c)==null?void 0:(a=a.author)==null?void 0:a.isBot())===!0){((a=c)==null?void 0:(a=a.from)==null?void 0:a.isBot())===!0?b.agentEngagementType=d("WAWebWamEnumAgentEngagementEnumType").AGENT_ENGAGEMENT_ENUM_TYPE.DIRECT_CHAT:b.agentEngagementType=d("WAWebWamEnumAgentEngagementEnumType").AGENT_ENGAGEMENT_ENUM_TYPE.INVOKED}}if((a=c)==null?void 0:a.botType){b.botType=(a=c)==null?void 0:a.botType}((a=c)==null?void 0:a.invisibleMessageCategoryType)!=null&&(b.invisibleMessageCategory=c.invisibleMessageCategoryType);b.commit()}function a(a){i({messageDropReason:d("WAWebWamEnumMessageDropReasonType").MESSAGE_DROP_REASON_TYPE.INVALID_STANZA,stanza:a})}function b(a){i({messageDropReason:d("WAWebWamEnumMessageDropReasonType").MESSAGE_DROP_REASON_TYPE.UNKNOWN_MESSAGE_TYPE,stanza:a})}function e(a){i({messageDropReason:d("WAWebWamEnumMessageDropReasonType").MESSAGE_DROP_REASON_TYPE.INTERNAL_ERROR,stanza:a})}function f(a){i({messageDropReason:d("WAWebWamEnumMessageDropReasonType").MESSAGE_DROP_REASON_TYPE.DB_OPERATION_FAILED,stanza:a})}function j(a){i({messageDropReason:d("WAWebWamEnumMessageDropReasonType").MESSAGE_DROP_REASON_TYPE.INVALID_HOSTED_COMPANION_STANZA,stanza:a})}function k(a,b){var c=a.msgInfo,e=a.msgMeta,f=a.enc;a=a.error;b=new(d("WAWebIncomingMessageDropWamEvent").IncomingMessageDropWamEvent)({messageDropReason:b,e2eCiphertextType:d("WAWebBackendJobsCommon").getMetricE2eCiphertextType(f.e2eType),messageMediaType:d("WAWebBackendJobsCommon").getMetricMediaType({encMediaType:f.encMediaType,msgType:e.type,msgPollType:e.pollType}),retryCount:f.retryCount,offline:c.offline!=null,e2eFailureReason:a==null?void 0:a.e2eFailureReason});e=d("WAWebMsgProcessingApiUtils").getFrom(c);f=d("WAWebBackendJobsCommon").getMetricE2eDestination(e);f&&(b.e2eDestination=f);if(e){a=d("WAWebWamMsgUtils").getWamE2eSenderType(e);a!=null&&(b.e2eSenderType=a)}c.edit===d("WAWebAck").EDIT_ATTR.ADMIN_REVOKE?b.revokeType=d("WAWebWamEnumRevokeType").REVOKE_TYPE.ADMIN:c.edit===d("WAWebAck").EDIT_ATTR.SENDER_REVOKE&&(b.revokeType=d("WAWebWamEnumRevokeType").REVOKE_TYPE.SENDER);f=d("WAWebWamMsgUtils").getWamInvisibleMessageCatgoryType(c.category);f!=null&&(b.invisibleMessageCategory=f);b.commit()}function l(a){k(a,d("WAWebWamEnumMessageDropReasonType").MESSAGE_DROP_REASON_TYPE.RECEIVED_WITH_OLD_COUNTER)}function m(a){k(a,d("WAWebWamEnumMessageDropReasonType").MESSAGE_DROP_REASON_TYPE.DUPLICATE_MESSAGE)}function n(a){k(a,d("WAWebWamEnumMessageDropReasonType").MESSAGE_DROP_REASON_TYPE.INVALID_PROTOBUF)}function o(a){k(a,d("WAWebWamEnumMessageDropReasonType").MESSAGE_DROP_REASON_TYPE.INVALID_STANZA)}function p(a){k(a,d("WAWebWamEnumMessageDropReasonType").MESSAGE_DROP_REASON_TYPE.EXPIRED)}function q(a){for(var b=0;b<a.length;b++){var c=a[b];c=d("WAWebDBMessageSerialization").messageFromDbRow(c);var e=new(d("WAWebIncomingMessageDropWamEvent").IncomingMessageDropWamEvent)({messageDropReason:d("WAWebWamEnumMessageDropReasonType").MESSAGE_DROP_REASON_TYPE.DB_OPERATION_FAILED,messageMediaType:d("WAWebWamMsgUtils").getWamMediaType(c)}),f=d("WAWebMsgGetters").getTo(c),g=d("WAWebMsgGetters").getFrom(c);f!=null&&g!=null&&(f.isStatusV3()?e.e2eDestination=d("WAWebWamEnumE2eDestination").E2E_DESTINATION.STATUS:d("WAWebMsgGetters").getBroadcastId(c)!=null?e.e2eDestination=d("WAWebWamEnumE2eDestination").E2E_DESTINATION.LIST:g.isGroup()?e.e2eDestination=d("WAWebWamEnumE2eDestination").E2E_DESTINATION.GROUP:g.isUser()&&(e.e2eDestination=d("WAWebWamEnumE2eDestination").E2E_DESTINATION.INDIVIDUAL));e.commit()}}g.postIncomingMessageDropInvalidStanza=a;g.postIncomingMessageDropUnknownMessageType=b;g.postIncomingMessageDropInternalError=e;g.postIncomingMessageDropDBOperationFailed=f;g.postIncomingMessageDropInvalidHostedCompanionStanza=j;g.postIncomingMessageDropOldCounter=l;g.postIncomingMessageDropDuplicateMessage=m;g.postIncomingMessageDropInvalidProtobuf=n;g.postIncomingMessageDropInvalidStanzaFromDecryptedMessageInfo=o;g.postIncomingMessageDropExpired=p;g.postIncomingMessageDropDBOperationFailedForMsgRows=q}),98);
__d("WAWebGetMessageCache",["WAWebMessageProcessorCache"],(function(a,b,c,d,e,f){var g=null;function a(){g==null&&(g=b("WAWebMessageProcessorCache").messageProcessorCache);return g}f.getMessageCache=a}),66);
__d("WAWebCommsSendPing",["WAComms","WATimeUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield d("WAComms").sendPing()});return h.apply(this,arguments)}function c(a){d("WATimeUtils").setClockSkew(a)}g.blockSendPing=a;g.updateClockSkew=c}),98);
__d("WAWebOfflineResumePreAckHandler",["WABatcher","WADeprecatedSendIq","WALogger","WAWap","WAWebCommsWapMd","WAWebSchemaDanglingReceipt","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to send offline pre-ack for envelope: "," with error: ",""]);h=function(){return a};return a}var i=d("WAWap").S_WHATSAPP_NET.toString();function a(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b,c,d,e=a.attrs["class"].toString();if(e!=="notification"&&e!=="receipt")return;var f=a.attrs.id.toString(),g=a.tag,h=a.attrs.to.toString();b=(b=a.attrs.participant)==null?void 0:b.toString();c=(c=a.attrs.type)==null?void 0:c.toString();a=((d=a.attrs)==null?void 0:d.error)?parseInt((d=a.attrs)==null?void 0:d.error.toString(),10):void 0;void l({ackClass:e,ackId:f,to:h,tag:g,participant:b,type:c,error:a})});return j.apply(this,arguments)}function c(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){try{var b;b=d("WAWap").wap("ack",{id:d("WAWap").CUSTOM_STRING(a.ackId),"class":a.ackClass,to:a.to===i?d("WAWap").S_WHATSAPP_NET:d("WAWebCommsWapMd").JID(d("WAWebWidFactory").createWidFromWidLike(a.to)),type:(b=a.type)!=null?b:d("WAWap").DROP_ATTR,participant:a.participant!=null?d("WAWebCommsWapMd").DEVICE_JID(d("WAWebWidFactory").createWid(a.participant)):d("WAWap").DROP_ATTR,error:a.error!=null?d("WAWap").INT(a.error):d("WAWap").DROP_ATTR});return d("WADeprecatedSendIq").deprecatedCastStanza(b,{preAck:!0})}catch(b){d("WALogger").ERROR(h(),a.ackClass,b).sendLogs("offline-pre-ack")}});return k.apply(this,arguments)}var l=function(){return d("WABatcher").batch({delayMs:3e3,maxSize:400},function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("WAWebSchemaDanglingReceipt").getTable().create({receipts:[],acks:a});return[]});return function(b){return a.apply(this,arguments)}}())}();g.parseAndSerializeOfflinePreAck=a;g.sendOfflinePreAck=c}),98);
__d("WAWebWamEnumOfflineResumeModes",[],(function(a,b,c,d,e,f){a=Object.freeze({RESUME_FROM_RESTART:1,RESUME_FROM_OPEN_TAB:2,UNKNOWN:3,CONNECT_REASON_USER:4,CONNECT_REASON_PUSH:5,CONNECT_REASON_BACKOFF:6});f.OFFLINE_RESUME_MODES=a}),66);
__d("WAWebWamEnumOfflineResumeStages",[],(function(a,b,c,d,e,f){a=Object.freeze({PAGE_LOAD:1,SOCKET_CONNECT:2,PROCESS_COMPLETE:3,SCREEN_LOAD:4,OFFLINE_PREVIEW:5,OFFLINE_COMPLETE_RECEIVED:6,PREACKS_SENT:7});f.OFFLINE_RESUME_STAGES=a}),66);
__d("WAWebOfflineResumeStageWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumOfflineResumeModes","WAWebWamEnumOfflineResumeStages"],(function(a,b,c,d,e,f,g){b=(a=d("WAWebWamCodegenUtils")).defineEvents({OfflineResumeStage:[3536,{attemptId:[13,a.TYPES.INTEGER],chatThreadCount:[4,a.TYPES.INTEGER],currentOfflineStage:[1,d("WAWebWamEnumOfflineResumeStages").OFFLINE_RESUME_STAGES],isResumeInForeground:[5,a.TYPES.BOOLEAN],isResumeStartedInForeground:[14,a.TYPES.BOOLEAN],lastPushTimestampMs:[12,a.TYPES.INTEGER],mailboxAge:[6,a.TYPES.INTEGER],offlineCallCount:[15,a.TYPES.INTEGER],offlineDecryptErrorCount:[7,a.TYPES.INTEGER],offlineMessageCount:[8,a.TYPES.INTEGER],offlineNotificationCount:[9,a.TYPES.INTEGER],offlineReceiptCount:[10,a.TYPES.INTEGER],offlineResumeMode:[11,d("WAWebWamEnumOfflineResumeModes").OFFLINE_RESUME_MODES],offlineSessionId:[2,a.TYPES.STRING],offlineSizeBytes:[16,a.TYPES.INTEGER],offlineStageTimestampMs:[3,a.TYPES.INTEGER],passiveModeT:[17,a.TYPES.TIMER]},[1,1,1],"regular"]});g.OfflineResumeStageWamEvent=b}),98);
__d("WAWebWamEnumOfflineResumeResultType",[],(function(a,b,c,d,e,f){a=Object.freeze({COMPLETE:1,INCOMPLETE_UNKNOWN_ERROR:2,INCOMPLETE_DISCONNECT:3,INCOMPLETE_APP_RESTART:4});f.OFFLINE_RESUME_RESULT_TYPE=a}),66);
__d("WAWebOfflineResumeWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumOfflineResumeResultType"],(function(a,b,c,d,e,f,g){b=(a=d("WAWebWamCodegenUtils")).defineEvents({OfflineResume:[3112,{affectedBySleepMode:[35,a.TYPES.BOOLEAN],chatThreadCount:[1,a.TYPES.INTEGER],expectedOfflineCallCount:[23,a.TYPES.INTEGER],expectedOfflineMessageCount:[17,a.TYPES.INTEGER],expectedOfflineNotificationCount:[18,a.TYPES.INTEGER],expectedOfflineReceiptCount:[19,a.TYPES.INTEGER],isOfflineCompleteMissed:[2,a.TYPES.BOOLEAN],isResumeInForeground:[13,a.TYPES.BOOLEAN],isRunningFromServiceExtension:[22,a.TYPES.BOOLEAN],lastStanzaT:[3,a.TYPES.TIMER],mailboxAge:[14,a.TYPES.INTEGER],mainScreenLoadT:[4,a.TYPES.TIMER],offlineCallCount:[24,a.TYPES.INTEGER],offlineDecryptErrorCount:[5,a.TYPES.INTEGER],offlineMessageCount:[6,a.TYPES.INTEGER],offlineNotificationCount:[7,a.TYPES.INTEGER],offlinePreviewT:[8,a.TYPES.TIMER],offlineProcessingT:[20,a.TYPES.TIMER],offlineReceiptCount:[9,a.TYPES.INTEGER],offlineResumeResult:[21,d("WAWebWamEnumOfflineResumeResultType").OFFLINE_RESUME_RESULT_TYPE],offlineSizeBytes:[10,a.TYPES.INTEGER],onTrickleMode:[15,a.TYPES.BOOLEAN],pageLoadT:[11,a.TYPES.TIMER],passiveModeT:[25,a.TYPES.TIMER],preackCallCount:[26,a.TYPES.INTEGER],preackMessageCount:[27,a.TYPES.INTEGER],preackNotificationCount:[28,a.TYPES.INTEGER],preackReceiptCount:[29,a.TYPES.INTEGER],processedCallCount:[30,a.TYPES.INTEGER],processedMessageCount:[31,a.TYPES.INTEGER],processedNotificationCount:[32,a.TYPES.INTEGER],processedReceiptCount:[33,a.TYPES.INTEGER],socketConnectT:[12,a.TYPES.TIMER],transientOfflineSessionId:[34,a.TYPES.STRING]},[1,1,1],"regular"]});g.OfflineResumeWamEvent=b}),98);
__d("WAWebWamOfflineResumeReporter",["$InternalEnum","WAHex","WALogger","WAQplTypes","WATimeUtils","WAWebABProps","WAWebDBTableUsage","WAWebOfflineResumeStageWamEvent","WAWebOfflineResumeWamEvent","WAWebQplQuickPerformanceLoggerMarkerIds","WAWebQplQuickPerformanceLoggerModule","WAWebUserPrefsGeneral","WAWebUserPrefsMultiDevice","WAWebWamEnumOfflineResumeModes","WAWebWamEnumOfflineResumeStages","WAWebWamEnumWebScenarioCode","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume] decryption error count exceeding product requirement, count ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume] loading time exceeding product requirement, time ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume] offline resume completes\n        ============== offline resume perf ================\n        message: ","\n        receipt: ","\n        notification: ","\n        chatThreadCount: ","\n        offlineSizeBytes: ","\n        decryptError: ","\n        preackMessageCount: ","\n        preackReceiptCount: ","\n        lastStanzaT: ","\n        pageLoadT: ","\n        connectionT: ","\n        passiveModeT: ","\n        offlinePreviewT: ","\n        screenLoadT: ","\n        isResumeInForeground: ","\n        mailboxAge: ","\n        ===================================================\n        "]);j=function(){return a};return a}var k=b("$InternalEnum").Mirrored(["ResumeFromRestart","ResumeFromOpentab"]),l=function(){function a(a){this._mode=a}var b=a.prototype;b.start=function(){if(!d("WAWebABProps").getABPropConfigValue("web_offline_resume_qpl_enabled"))return;this.drop();this._qplEvent=d("WAWebQplQuickPerformanceLoggerModule").QPL.markerStart(d("WAWebQplQuickPerformanceLoggerMarkerIds").QuickLogMarkerId.OFFLINE_RESUME,{annotations:{string:{mode:k.getName(this._mode)}}})};b.end=function(){var a;(a=this._qplEvent)==null?void 0:a.end(d("WAQplTypes").QuickLogActionType.SUCCESS)};b.drop=function(){var a;(a=this._qplEvent)==null?void 0:a.drop();this._qplEvent=void 0};b._addPoint=function(a,b){var c;b=b!=null?{data:b}:{};(c=this._qplEvent)==null?void 0:c.addPoint(a,b)};b.markOfflinePreviewReceived=function(){this._addPoint("offlinePreviewReceived")};b.markMainScreenLoad=function(){this._addPoint("mainScreenLoad")};b.markSocketConnect=function(){this._addPoint("socketConnect")};b.setAnnotations=function(a){var b;(b=this._qplEvent)==null?void 0:b.annotate({"int":{messageCount:a.messageCount,receiptCount:a.receiptCount,notificationCount:a.notificationCount,sizeBytes:a.sizeBytes,chatThreadCount:a.chatThreadCount,decryptErrorCount:a.decryptErrorCount}})};return a}(),m=function(){function a(a,b){this._sessionId=b,this._offlineStartT=self.performance.now(),this._resuemMode=a}var b=a.prototype;b._commitOfflineStage=function(a){a=new(d("WAWebOfflineResumeStageWamEvent").OfflineResumeStageWamEvent)({offlineSessionId:this._sessionId,offlineResumeMode:this._resuemMode===k.ResumeFromOpentab?d("WAWebWamEnumOfflineResumeModes").OFFLINE_RESUME_MODES.RESUME_FROM_OPEN_TAB:d("WAWebWamEnumOfflineResumeModes").OFFLINE_RESUME_MODES.RESUME_FROM_RESTART,offlineStageTimestampMs:Math.floor(self.performance.now()-this._offlineStartT),currentOfflineStage:a});this._addOfflineMetadata(a);a.commit()};b.logOfflineStart=function(){this._offlineStartT=self.performance.now()};b.logSocketConnect=function(){this._commitOfflineStage(d("WAWebWamEnumOfflineResumeStages").OFFLINE_RESUME_STAGES.SOCKET_CONNECT)};b.logProcessComplete=function(){this._commitOfflineStage(d("WAWebWamEnumOfflineResumeStages").OFFLINE_RESUME_STAGES.PROCESS_COMPLETE)};b.logScreenLoad=function(){this._commitOfflineStage(d("WAWebWamEnumOfflineResumeStages").OFFLINE_RESUME_STAGES.SCREEN_LOAD)};b.logOfflinePreview=function(){this._commitOfflineStage(d("WAWebWamEnumOfflineResumeStages").OFFLINE_RESUME_STAGES.OFFLINE_PREVIEW)};b.logOfflineCount=function(a){this._offlineMessageCount=(this._offlineMessageCount||0)+a.message,this._offlineReceiptCount=(this._offlineReceiptCount||0)+a.receipt,this._offlineNotificationCount=(this._offlineNotificationCount||0)+a.notification};b.logOfflineDecryptionErrorCount=function(a){this._offlineDecryptErrorCount=a};b.logOfflineChatThreadCount=function(a){this._chatThreadCount=a};b.logOldestStanzaTime=function(a){(this._oldestStanzaTs==null||this._oldestStanzaTs>a)&&(this._oldestStanzaTs=a)};b.setLastPushCompleteTimestamp=function(){this._lastPushCompleteTimestampMs=d("WAWebUserPrefsGeneral").getLastPushCompleteTimestamp()};b._addOfflineMetadata=function(a){this._offlineMessageCount!=null&&(a.offlineMessageCount=n(this._offlineMessageCount,10)),this._offlineReceiptCount!=null&&(a.offlineReceiptCount=n(this._offlineReceiptCount,10)),this._offlineNotificationCount!=null&&(a.offlineNotificationCount=n(this._offlineNotificationCount,10)),this._oldestStanzaTs!=null&&(a.mailboxAge=o(this._oldestStanzaTs)),this._offlineDecryptErrorCount!=null&&(a.offlineDecryptErrorCount=this._offlineDecryptErrorCount),this._chatThreadCount!=null&&(a.chatThreadCount=n(this._chatThreadCount,10)),this._lastPushCompleteTimestampMs!=null&&a.currentOfflineStage===d("WAWebWamEnumOfflineResumeStages").OFFLINE_RESUME_STAGES.SOCKET_CONNECT&&(a.lastPushTimestampMs=this._lastPushCompleteTimestampMs,void d("WAWebUserPrefsGeneral").clearLastPushCompleteTimestamp(),this._lastPushCompleteTimestampMs=null)};return a}();a=function(){function a(){this._initEvents(k.ResumeFromRestart)}var e=a.prototype;e._initEvents=function(a){this.isInitialSync=!1;this.oldestStanzaTs=0;this.offlineResume=new(d("WAWebOfflineResumeWamEvent").OfflineResumeWamEvent)();this.offlineResume.offlineMessageCount=0;this.offlineResume.offlineReceiptCount=0;this.offlineResume.offlineNotificationCount=0;this.offlineResume.offlineDecryptErrorCount=0;this.offlineResume.offlineSizeBytes=0;this.offlineResume.chatThreadCount=0;this.offlineResume.preackMessageCount=0;this.offlineResume.preackReceiptCount=0;this.offlineResume.isOfflineCompleteMissed=!1;this.qpl=new l(a);var b=this._generateOfflineSessionId();this.offlineStage=new m(a,b);this.endTableUsageMetric=d("WAWebDBTableUsage").beginDBTableUsage(d("WAWebWamEnumWebScenarioCode").WEB_SCENARIO_CODE.OFFLINE_RESUME,new Set(["message","chat","participant","group-metadata"]),b)};e.logOldestStanzaTime=function(a){this.offlineStage.logOldestStanzaTime(a);if(this.offlineResume==null)return;(this.oldestStanzaTs===0||this.oldestStanzaTs>a)&&(this.oldestStanzaTs=a)};e.logOfflineCount=function(a){this.offlineStage.logOfflineCount(a);this.offlineStage.logOfflinePreview();if(!this.offlineResume)return;this.offlineResume.offlineMessageCount+=a.message;this.offlineResume.offlineReceiptCount+=a.receipt;this.offlineResume.offlineNotificationCount+=a.notification};e.logOfflineDecryptionErrorCount=function(a){this.offlineStage.logOfflineDecryptionErrorCount(a);if(!this.offlineResume)return;this.offlineResume.offlineDecryptErrorCount=a};e.logAddOfflineSizeBytes=function(a){if(!this.offlineResume)return;this.offlineResume.offlineSizeBytes+=a};e.logOfflineChatThreadCount=function(a){this.offlineStage.logOfflineChatThreadCount(a);a=n(a,10);if(!this.offlineResume)return;this.offlineResume.chatThreadCount=a};e.logOfflinePreackCount=function(a,b){b===void 0&&(b=!1),this.offlineResume&&(b===!0?this.offlineResume.preackMessageCount+=a:this.offlineResume.preackReceiptCount+=a)};e.logOfflinePassiveT=function(){var a;if(((a=this.offlineResume)==null?void 0:a.passiveModeT)!=null)return;this._logPerformanceT("passiveModeT")};e._logPerformanceT=function(a){var b=Math.floor(self.performance.now());if(this.offlineResume==null)return;this.offlineResume[a]=b};e.logLastStanzaT=function(){var a;if(((a=this.offlineResume)==null?void 0:a.lastStanzaT)!=null)return;this._logPerformanceT("lastStanzaT");this.isInitialSync||this.offlineStage.logProcessComplete()};e.logMainScreenLoadT=function(){this._logPerformanceT("mainScreenLoadT"),this.qpl.markMainScreenLoad(),this.isInitialSync||this.offlineStage.logScreenLoad()};e.logOfflinePreviewT=function(){this._logPerformanceT("offlinePreviewT"),this.qpl.markOfflinePreviewReceived()};e.logOfflineStartT=function(){this.qpl.start(),this._logPerformanceT("pageLoadT"),this.offlineStage.logOfflineStart(),window.document&&this.offlineResume&&(this.offlineResume.isResumeInForeground=!document.hidden,document.addEventListener("visibilitychange",this.logResumeInBackground))};e.logSocketConnectT=function(){this._logPerformanceT("socketConnectT"),this.qpl.markSocketConnect(),this.isInitialSync||this.offlineStage.logSocketConnect()};e.logMissedOfflineComplete=function(){if(!this.offlineResume)return;this.offlineResume.isOfflineCompleteMissed=!0};e.setIsInitialSync=function(){this.isInitialSync=!0};e.logResumeInBackground=function(){if(!this.offlineResume)return;document.hidden&&(this.offlineResume.isResumeInForeground=!1)};e.setLastPushCompleteTimestamp=function(){return this.offlineStage.setLastPushCompleteTimestamp()};e.commit=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=this.offlineResume;if(!a)return;a.offlineSizeBytes=n(a.offlineSizeBytes,1e3);a.offlineMessageCount=n(a.offlineMessageCount,10);a.offlineReceiptCount=n(a.offlineReceiptCount,10);a.offlineNotificationCount=n(a.offlineNotificationCount,10);a.mailboxAge=o(this.oldestStanzaTs);yield d("WAWebUserPrefsMultiDevice").setRecentMailboxAgeDays(a.mailboxAge);d("WALogger").LOG(j(),a.offlineMessageCount,a.offlineReceiptCount,a.offlineNotificationCount,a.chatThreadCount,a.offlineSizeBytes,a.offlineDecryptErrorCount,a.preackMessageCount,a.preackReceiptCount,a.lastStanzaT,a.pageLoadT,a.socketConnectT,a.passiveModeT,a.offlinePreviewT,a.mainScreenLoadT,a.isResumeInForeground,a.mailboxAge);if(!this.isInitialSync){a.commit();this.qpl.setAnnotations({messageCount:a.offlineMessageCount,receiptCount:a.offlineReceiptCount,notificationCount:a.offlineNotificationCount,chatThreadCount:a.chatThreadCount,decryptErrorCount:a.offlineDecryptErrorCount,sizeBytes:a.offlineSizeBytes});this.qpl.end();this.endTableUsageMetric();if(!c("gkx")("26258")){var b=3*60*1e3,e=10,f=Math.max(a.mainScreenLoadT,a.lastStanzaT);f-a.socketConnectT>b&&d("WALogger").ERROR(i(),a.mainScreenLoadT).sendLogs("slow-offline-resume");a.offlineDecryptErrorCount>e&&d("WALogger").ERROR(h(),a.offlineDecryptErrorCount).sendLogs("slow-offline-resume")}}else this.qpl.drop();this.offlineResume=null;window.document&&document.removeEventListener("visibilitychange",this.logResumeInBackground)});function e(){return a.apply(this,arguments)}return e}();e.resetEvent=function(){this.offlineResume==null&&(this._initEvents(k.ResumeFromOpentab),this.logOfflineStartT())};e._generateOfflineSessionId=function(){return""+d("WAHex").randomHex(4)+d("WATimeUtils").unixTimeWithoutClockSkewCorrection()};return a}();function n(a,b){return c("gkx")("26258")?Math.round(a/b)*b:a}function o(a){if(a===0)return 0;a=d("WATimeUtils").unixTime()-a;return Math.round(a/d("WATimeUtils").DAY_SECONDS)}e=new a();g.roundUp=n;g.countDays=o;g.OfflineResumeReporter=e}),98);
__d("WAWebClearDanglingReceipts",["Promise","WALogger","WATimeUtils","WAWebCommsSendPing","WAWebNetworkStatus","WAWebOfflineResumePreAckHandler","WAWebSchemaDanglingReceipt","WAWebSendReceiptJobCommon","WAWebWamOfflineResumeReporter","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["clearDanglingReceipts: starting clean receipts"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["clearDanglingReceipts: starting sending ping"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][utils] clearDanglingReceipts: skip due to offline."]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendAndClearDanglingReceipts: complete"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendAndClearDanglingReceipts: complete sending  "," preAcks"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendAndClearDanglingReceipts: complete sending "," receipts"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendAndClearDanglingReceipts: starting sending "," receipts,  "," preAcks"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendAndClearDanglingReceipts: get "," danglingRecords"]);p=function(){return a};return a}function a(){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a,c=(yield d("WAWebSchemaDanglingReceipt").getTable().all());(a=d("WALogger")).LOG(p(),c.length);var e=new Map(),f=[],g=0;c.forEach(function(a){g+=a.receipts.length;var b=a.receipts;a=a.acks;b.forEach(function(a){var b=d("WAWebWidFactory").createWid(a.from),c=d("WAWebWidFactory").createWid(a.author),f=e.get(b);f||(f=new Map(),e.set(b,f));b=f.get(c);b||(b=[],f.set(c,b));b.push(a.externalId)});f=f.concat(a)});var i=String(d("WATimeUtils").unixTime());c=Array.from(e.keys()).map(function(a){var b=e.get(a);if(!b)return;return d("WAWebSendReceiptJobCommon").sendAggregateReceipts({to:a,type:d("WAWebSendReceiptJobCommon").RECEIPT_TYPE.DELIVERY,t:i,groupedReceipt:b})});var j=f.map(function(a){return d("WAWebOfflineResumePreAckHandler").sendOfflinePreAck(a)});a.LOG(o(),c.length,j.length);yield (h||(h=b("Promise"))).all(c);d("WALogger").LOG(n(),c.length);yield h.all(j);d("WALogger").LOG(m(),j.length);yield r();d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.logOfflinePreackCount(g);d("WALogger").LOG(l())});return q.apply(this,arguments)}function r(){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(!c("WAWebNetworkStatus").online){d("WALogger").LOG(k());return(h||(h=b("Promise"))).resolve()}d("WALogger").LOG(j());yield d("WAWebCommsSendPing").blockSendPing();d("WALogger").LOG(i());yield d("WAWebSchemaDanglingReceipt").getTable().clear()});return s.apply(this,arguments)}g.sendAndClearDanglingReceipts=a;g.clearDanglingReceipts=r}),98);
__d("WAWebLogoutReasonConstants",["$InternalEnum"],(function(a,b,c,d,e,f){a=b("$InternalEnum")({UserInitiated:"user_initiated",SyncdFailure:"syncd_failure",InvalidAdvStatus:"invalid_adv_status",CriticalSyncTimeout:"critical_sync_timeout",SyncdTimeout:"syncd_timeout",HistorySyncTimeout:"history_sync_timeout",AccountSyncTimeout:"account_sync_timeout",MDOptOut:"md_opt_out",UnknownCompanion:"unknown_companion",ClientVersionOutdated:"client_version_outdated",SyncdErrorDuringBootstrap:"syncd_error_during_bootstrap",AccountSyncError:"account_sync_error",ClientFatalError:"client_fatal_error",StorageQuotaExceeded:"storage_quota_exceeded",PrimaryIdentityKeyChange:"primary_identity_key_change",MissingEncSalt:"missing_enc_salt",MissingScreenLockSalt:"missing_screen_lock_salt",AccountLocked:"account_locked",MacElectronDeprecationSoftMigration:"mac_electron_deprecation_soft_migration",MacElectronDeprecationAppExpiry:"mac_electron_deprecation_app_expiry",MacElectronUnsupportedOsHardExpiry:"mac_electron_unsupported_os_hard_expiry"});c={CLIENT_FATAL:"0",SYNC_FAIL:"1",INITIAL_HISTORY_SYNC_TIMEOUT:"2",ACCOUNT_LOCKED:"3"};f.LogoutReason=a;f.LOGOUT_REASON_CODE=c}),66);
__d("WAWebPwaDocumentMetadataUtils",["WAWebRuntimeEnvironmentUtils","gkx"],(function(a,b,c,d,e,f,g){var h="",i=-1,j;!c("gkx")("26263")&&!d("WAWebRuntimeEnvironmentUtils").isWorker()&&(h=document.title);function a(a){a===void 0&&(a=null),a!=null&&(h=a),k(h)}function k(a){l()?document.title=" ":(self.clearTimeout(j),document.title+=" ",j=self.setTimeout(function(){document.title=a},0))}function b(a){a!=null&&(i=a),c("gkx")("26264")&&(l==null?void 0:l())&&"setAppBadge"in navigator&&(i===-1||i===0?navigator.clearAppBadge()["catch"](function(a){}):navigator.setAppBadge(i)["catch"](function(a){}))}function l(){if(c("gkx")("26263"))return!1;return"matchMedia"in self?window.matchMedia("(display-mode: standalone)").matches:!1}g.setDocumentTitle=a;g.setAppBadge=b;g.isCurrentWebSessionInsidePwa=l}),98);
__d("WAWebPushNotificationsGatingUtils",["WAWebABProps","WAWebPwaDocumentMetadataUtils","WAWebRuntimeEnvironmentUtils","WAWebUA","gkx"],(function(a,b,c,d,e,f,g){function a(){return h()&&d("WAWebABProps").getABPropConfigValue("web_push_notifications")}function h(){try{var a=d("WAWebUA").UA.isSafari&&Number(d("WAWebUA").UA.browserVersion.split(".")[0])<16;return c("gkx")("26262")&&c("gkx")("26254")&&!a}catch(a){return!1}}function b(){return!d("WAWebRuntimeEnvironmentUtils").isWorker()&&i()&&d("WAWebPwaDocumentMetadataUtils").isCurrentWebSessionInsidePwa()&&d("WAWebABProps").getABPropConfigValue("web_pwa_background_sync")}function i(){try{var a=d("WAWebUA").UA.isSafari||d("WAWebUA").UA.browser===d("WAWebUA").BROWSER_TYPE.FIREFOX||d("WAWebUA").UA.isChrome&&Number(d("WAWebUA").UA.browserVersion.split(".")[0])<80;return c("gkx")("26262")&&!a}catch(a){return!1}}g.canEnableOfflineNotifications=a;g.canSupportOfflineNotifications=h;g.canEnablePeriodicBackgroundSync=b;g.canSupportPeriodicBackgroundSync=i}),98);
__d("WAWebPushNotificationsOfflineBbApi",["WAWebPushNotificationsGatingUtils","WAWebUserPrefsNotifications"],(function(a,b,c,d,e,f,g){var h=10*1e3,i=!0,j=null;function a(){d("WAWebPushNotificationsGatingUtils").canSupportOfflineNotifications()&&(i=!1,j=self.performance.now())}function b(){d("WAWebPushNotificationsGatingUtils").canSupportOfflineNotifications()&&!i&&j!=null&&self.performance.now()-j>h&&d("WAWebUserPrefsNotifications").setOfflineNotificationsBBStatus({isLongResumeTime:!0})}g.setStartCommsT=a;g.setMainStreamModeReadyT=b}),98);
__d("WAWebSocketLogoutJob",["Promise","WALogger","WAWebBackendApi","WAWebRuntimeEnvironmentUtils","WAWebUserPrefsGeneral","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Socket logout failed, err: ",""]);i=function(){return a};return a}function a(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(d("WAWebRuntimeEnvironmentUtils").isServiceWorker())try{yield (h||(h=b("Promise"))).all([d("WAWebUserPrefsGeneral").setOfflinePushDisabled(!0),d("WAWebUserPrefsGeneral").setLogoutReason({reason:a})])}catch(a){d("WALogger").ERROR(i(),a).sendLogs("sw-socket-logout-failed");return}d("WAWebBackendApi").frontendFireAndForget("socketLogout",{reason:a})});return j.apply(this,arguments)}g.socketLogout=a}),98);
__d("WAWebOfflineResumeUtils",["Promise","WABackoffUtils","WALogger","WAPromiseDelays","WAPromiseLoop","WAWebABProps","WAWebClearDanglingReceipts","WAWebCmd","WAWebGetMessageCache","WAWebLogoutReasonConstants","WAWebMessageReceiptBatcher","WAWebNetworkStatus","WAWebOffdStorageUpdateOfflinePeerReceipts","WAWebOfflineDeviceCache","WAWebPageLoadLogging","WAWebPruneExpiredMessagesWithAddOns","WAWebPushNotificationsOfflineBbApi","WAWebSocketLogoutJob","WAWebWamOfflineResumeReporter","WAWebWorkerSafeBackendApi","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume] loadMainScreen complete"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume] loadMainScreen: pruneExpiredMessages message failed with error: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume] restoreDataFromStorage failed with error ","."]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume] restoreDataFromStorage."]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][utils] runReceiptCleanUpLoop: Gave up clean up receipts "," tries"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][utils] runReceiptCleanUpLoop: failed with error ","."]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][utils] runReceiptCleanUpLoop: done."]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][utils] runReceiptCleanUpLoop: skip due to offline."]);p=function(){return a};return a}var q={MIN_MESSAGE:20,LIMIT_WITH_MESSAGE:50,MAX_STANZA:200};function a(){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){d("WAWebGetMessageCache").getMessageCache().createSnapshot();d("WAWebOfflineDeviceCache").OfflinePendingDeviceCache.createSnapshot();var a=[d("WAWebGetMessageCache").getMessageCache().checkpointQueue.wait(),d("WAWebOfflineDeviceCache").OfflinePendingDeviceCache.checkpointQueue.wait()];a.push(d("WAWebMessageReceiptBatcher").receiptBatcher.runActiveBatches());yield (h||(h=b("Promise"))).all(a)});return r.apply(this,arguments)}function e(){if(d("WAWebABProps").getABPropConfigValue("web_enable_open_tab_pre_ack")&&!c("WAWebNetworkStatus").online){d("WALogger").LOG(p());return(h||(h=b("Promise"))).resolve()}return d("WAPromiseLoop").promiseLoop(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){b=d("WAPromiseDelays").delayMs(d("WABackoffUtils").expBackoff(c,12e4,1e3,.1));try{yield d("WAWebClearDanglingReceipts").clearDanglingReceipts();d("WALogger").LOG(o());return a()}catch(e){d("WALogger").LOG(n(),e);if(c>3){d("WALogger").WARN(m(),c);return a()}return b}});return function(b,c,d){return a.apply(this,arguments)}}())}function f(){if(c("gkx")("26255")){var a=window.Native.ipcRenderer;a.invoke("refresh-electron-window-when-active")}else{((a=window.location)==null?void 0:a.reload)&&window.location.reload()}}function s(a){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WAWebPageLoadLogging").startPageLoadQplMeasure("restoreDataFromStorage");try{var c=a.shouldUpdateReceipts;c=c===void 0?!1:c;a=a.shouldRestoreChatsAndMsgs;var e=a===void 0?!0:a;d("WALogger").LOG(l());a=c?d("WAWebOffdStorageUpdateOfflinePeerReceipts").updatePeerReceipts():(h||(h=b("Promise"))).resolve();c=a.then(function(){return e?d("WAWebWorkerSafeBackendApi").workerSafeSendAndReceive("restoreChatsAndMessages"):(h||(h=b("Promise"))).resolve()});a=d("WAWebWorkerSafeBackendApi").workerSafeSendAndReceive("restoreGroupsAndContacts");var f=d("WAWebWorkerSafeBackendApi").workerSafeSendAndReceive("restoreProfilePictures");yield (h||(h=b("Promise"))).all([c,a,f])}catch(a){d("WALogger").ERROR(k(),a).verbose().tags("logout").sendLogs("offline-resume-fatal-error"),void d("WAWebSocketLogoutJob").socketLogout(d("WAWebLogoutReasonConstants").LogoutReason.ClientFatalError)}d("WAWebPageLoadLogging").endPageLoadQplMeasure("restoreDataFromStorage")});return t.apply(this,arguments)}function u(a){return v.apply(this,arguments)}function v(){v=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){try{yield d("WAWebPruneExpiredMessagesWithAddOns").pruneExpiredMessagesWithAddOns()}catch(a){d("WALogger").ERROR(j(),a);throw a}yield s(a);w();d("WAWebCmd").Cmd.readyForProcessOffline();d("WALogger").LOG(i())});return v.apply(this,arguments)}function w(){d("WAWebCmd").Cmd.readyForMainStreamMode(),d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.logMainScreenLoadT(),d("WAWebPushNotificationsOfflineBbApi").setMainStreamModeReadyT()}function x(a,b){return a+b>q.MAX_STANZA||a>q.MIN_MESSAGE&&a+b>q.LIMIT_WITH_MESSAGE}g.clearOfflineSnapShot=a;g.runReceiptCleanUpLoop=e;g.refreshWindow=f;g.restoreDataFromStorage=s;g.loadMainScreen=u;g.exceedResumeWithOpenTabLimit=x}),98);
__d("WAWebPruneExpiredMessagesWithAddOns",["WALogger","WAWebBackendApi","WAWebDBEphemeralMessage","WAWebMsgKey","WAWebPageLoadLogging","WAWebPersistedJobDefinitions","WAWebPersistedJobManager","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][utils] pruneExpiredMessagesWithAddOns: pruneExpiredMessages pruned "," msg(s)"]);h=function(){return a};return a}function a(){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){d("WAWebPageLoadLogging").startPageLoadQplMeasure("pruneExpiredMessagesWithAddOns");var a=(yield d("WAWebDBEphemeralMessage").pruneExpiredMessages()),e=a.length;if(e>0){var f=b("WAWebPersistedJobManager").getJobManager,g=[],i=new Set();a.forEach(function(a){a=a.id.toString();i.add(c("WAWebMsgKey").fromString(a).remote.toString());g.push(a)});a=Array.from(i.values()).join(",").toString();d("WAWebBackendApi").frontendFireAndForget("deleteModelsForLastAddOnPreview",{messagesIds:g});yield f().waitUntilPersisted(d("WAWebPersistedJobDefinitions").jobSerializers.deleteAddOns(a,g));d("WALogger").LOG(h(),e)}d("WAWebPageLoadLogging").endPageLoadQplMeasure("pruneExpiredMessagesWithAddOns")});return i.apply(this,arguments)}g.pruneExpiredMessagesWithAddOns=a}),98);
__d("WAWebSendMsgTypes",[],(function(a,b,c,d,e,f){a=Object.freeze({Message:"message",Addon:"addon"});f.SendMessageRecordType=a}),66);
__d("WAWebSendMsgCommonApi",["WADeprecatedWapParser","WAJids","WALogger","WAWap","WAWebABProps","WAWebAck","WAWebAddonRetryRequestUtils","WAWebDeviceListPk","WAWebProtobufsE2E.pb","WAWebReactionsBEUtils","WAWebSchemaMessage","WAWebSendMsgTypes","WAWebSignalCommonUtils","WAWebSignalProtocolStore","WAWebWidFactory","asyncToGeneratorRuntime","encodeProtobuf","err"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["filterDeviceWithChangedIdentity: cannot determine rowId for message: ",", type: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["filterDeviceWithChangedIdentity: message not found: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["filterDeviceWithChangedIdentity: addon not found: ",""]);j=function(){return a};return a}var k=5;function a(){return(d("WAWebABProps").getABPropConfigValue("web_e2e_backfill_expire_time")||k)*60}function e(a){a=d("encodeProtobuf").encodeProtobuf(d("WAWebProtobufsE2E.pb").MessageSpec,a);d("WAWebSignalCommonUtils").writeRandomPadMax16(a);return a.readByteArray()}function l(a){return a.protocolMessage!=null&&a.protocolMessage.type===d("WAWebProtobufsE2E.pb").Message$ProtocolMessage$Type.REVOKE}function m(a){return a.reactionMessage!=null&&a.reactionMessage.text===d("WAWebReactionsBEUtils").REVOKED_REACTION_TEXT}function n(a){var b;a=(b=(b=a.protocolMessage)==null?void 0:b.type)!=null?b:(b=a.editedMessage)==null?void 0:(a=b.message)==null?void 0:(b=a.protocolMessage)==null?void 0:b.type;return a===d("WAWebProtobufsE2E.pb").Message$ProtocolMessage$Type.MESSAGE_EDIT}function o(a){return a.pinInChatMessage!=null}function p(a){return a.keepInChatMessage!=null&&a.keepInChatMessage.key!=null&&a.keepInChatMessage.key.fromMe===!0&&a.keepInChatMessage.keepType===d("WAWebProtobufsE2E.pb").KeepType.UNDO_KEEP_FOR_ALL}function f(a,b){if(l(a)){b=b==="admin_revoke"?d("WAWebAck").EDIT_ATTR.ADMIN_REVOKE:d("WAWebAck").EDIT_ATTR.SENDER_REVOKE;return d("WAWap").CUSTOM_STRING(String(b))}else if(m(a))return d("WAWap").CUSTOM_STRING(String(d("WAWebAck").EDIT_ATTR.SENDER_REVOKE));else if(p(a))return d("WAWap").CUSTOM_STRING(String(d("WAWebAck").EDIT_ATTR.SENDER_REVOKE));else if(n(a))return d("WAWap").CUSTOM_STRING(String(d("WAWebAck").EDIT_ATTR.MESSAGE_EDIT));else if(o(a))return d("WAWap").CUSTOM_STRING(String(d("WAWebAck").EDIT_ATTR.PIN_IN_CHAT));return d("WAWap").DROP_ATTR}var q=new(c("WADeprecatedWapParser"))("sendMsgAckSyncParser",function(a){a.assertTag("ack");return{t:a.attrTime("t"),sync:a.hasAttr("sync")?a.attrString("sync"):null,phash:a.hasAttr("phash")?a.attrString("phash"):null,addressingMode:a.hasAttr("addressing_mode")?a.attrString("addressing_mode"):null,count:a.hasAttr("count")?a.attrInt("count"):null,error:a.hasAttr("error")?a.attrInt("error"):null}});function r(a){return a.device==null||a.device===d("WAJids").DEFAULT_DEVICE_ID}function s(a,b){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=a.data.id;if(a.type===d("WAWebSendMsgTypes").SendMessageRecordType.Addon){var e=(yield d("WAWebAddonRetryRequestUtils").hasSentAddonMsg(c));if(e!=null)return d("WAWebSignalProtocolStore").getPersistSignalProtocolStore().updateIdentityRangeAfterEncryption("sentAddonRowId",e.rowId,b.map(function(a){return d("WAWebSignalCommonUtils").createSignalAddress(a).toString()}))}else if(a.type===d("WAWebSendMsgTypes").SendMessageRecordType.Message){e=(yield d("WAWebSchemaMessage").getMessageTable().get(String(c),!1));a=e==null?void 0:e.rowId;if(a!=null)return d("WAWebSignalProtocolStore").getPersistSignalProtocolStore().updateIdentityRangeAfterEncryption("rowId",a,b.map(function(a){return d("WAWebSignalCommonUtils").createSignalAddress(a).toString()}))}});return t.apply(this,arguments)}function u(a){return v.apply(this,arguments)}function v(){v=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.data.id;if(a.type===d("WAWebSendMsgTypes").SendMessageRecordType.Addon){var c=(yield d("WAWebAddonRetryRequestUtils").hasSentAddonMsg(b));c||d("WALogger").WARN(j(),b);return c==null?void 0:c.rowId}else if(a.type===d("WAWebSendMsgTypes").SendMessageRecordType.Message){c=(yield d("WAWebSchemaMessage").getMessageTable().get(String(b),!1));c||d("WALogger").WARN(i(),b);return c==null?void 0:c.rowId}});return v.apply(this,arguments)}function w(a,b){return x.apply(this,arguments)}function x(){x=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e=(yield u(a));if(e==null){d("WALogger").WARN(h(),a.data.id,a.data.type);throw c("err")("filterDeviceWithChangedIdentity: cannot determine message rowId")}var f=new Map();b.forEach(function(a){f.set(d("WAWebDeviceListPk").createDeviceListPK(a),a)});var g=Array.from(f.values()).map(function(a){return d("WAWebWidFactory").createDeviceWidFromUserAndDevice(a.user,a.server,d("WAJids").DEFAULT_DEVICE_ID)}),i=(yield d("WAWebSignalProtocolStore").getPersistSignalProtocolStore().bulkGetIdentityWithRowId(g.map(function(a){return d("WAWebSignalCommonUtils").createSignalAddress(a).toString()}))),j=new Set();i.forEach(function(b,c){b=a.type===d("WAWebSendMsgTypes").SendMessageRecordType.Addon?b==null?void 0:b.sentAddonRowId:b==null?void 0:b.rowId;c=g[c];(b==null||b>e)&&j.add(d("WAWebDeviceListPk").createDeviceListPK(c))});return b.filter(function(a){return!j.has(d("WAWebDeviceListPk").createDeviceListPK(a))})});return x.apply(this,arguments)}g.getResendTimeoutInSeconds=a;g.encodeAndPad=e;g.isRevokeMsg=l;g.isEditMsg=n;g.editAttribute=f;g.sendMsgAckSyncParser=q;g.isPrimaryDevice=r;g.updateIdentityRange=s;g.filterDeviceWithChangedIdentity=w}),98);
__d("WAWebSignal",["WAWebSignalCipherApi","WAWebSignalSessionApi"],(function(a,b,c,d,e,f,g){g.Cipher=d("WAWebSignalCipherApi"),g.Session=d("WAWebSignalSessionApi")}),98);
__d("WAWebSignalCipherApi",["Promise","WAWebCryptoLibrary","WAWebSignalCommonErrors","asyncToGeneratorRuntime","cr:4533","gkx"],(function(a,b,c,d,e,f,g){var h;function a(a,b,c){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){if(!c("gkx")("26258")){var g=b("cr:4533")==null?void 0:b("cr:4533").getDebugDecryptFail();if(g!=null&&g>0){b("cr:4533")==null?void 0:b("cr:4533").setDebugDecryptFail(g-1);return(h||(h=b("Promise"))).reject(new(d("WAWebSignalCommonErrors").SignalDecryptionError)())}}return d("WAWebCryptoLibrary").decryptSignalProto(a,e,f)});return i.apply(this,arguments)}function e(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){return d("WAWebCryptoLibrary").encryptSignalProto(a,b)});return j.apply(this,arguments)}function f(a,b,c){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){return d("WAWebCryptoLibrary").decryptGroupSignalProto(a,b,c)});return k.apply(this,arguments)}function l(a,b,c){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){return d("WAWebCryptoLibrary").encryptSenderKeyMsgSignalProto(a,b,c)});return m.apply(this,arguments)}g.decryptSignalProto=a;g.encryptSignalProto=e;g.decryptGroupSignalProto=f;g.encryptSenderKeyMsgSignalProto=l}),98);
__d("WAWebCryptoLibrarySignalGroupUtilsApi",[],(function(a,b,c,d,e,f){var g="v1";function a(a,b,c,d){return{signatureKey:a,chainKey:b,keyId:c,messageKeys:d==null?[]:d}}function b(a){return{sessions:a,version:g}}function c(a){return a}function d(a,b){return{counter:a,key:b}}function e(a,b){return b!=null?{pubKey:a,privKey:b}:a}f.makeLibsignalSenderKeyState=a;f.makeNewLibsignalSenderKeySession=b;f.makeLibsignalSenderKeyMsgKey=c;f.makeLibsignalSenderKeyChainKey=d;f.makeLibsignalSenderKeySignatureKey=e}),66);
__d("WAWebCryptoLibrarySenderkeySessionConversionApi",["invariant","WAByteArray","WAPromiseReduce","WASignalGroupSession","WASignalOther","WAWebCryptoLibrarySignalGroupUtilsApi","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g,h){function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.sessions;a=(yield d("WAPromiseReduce").promiseReduce(a,function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){c=(yield j(b));return a==null?d("WASignalGroupSession").makeNewSenderKeySession(c):d("WASignalGroupSession").updateSessionWithNewSenderKeyState(a,c)});return function(b,c,d){return a.apply(this,arguments)}}(),null));a!=null||h(0,72944);return a});return i.apply(this,arguments)}function j(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.signatureKey.pubKey!==void 0?new Uint8Array(a.signatureKey.pubKey):new Uint8Array(a.signatureKey),c=a.signatureKey.privKey?d("WASignalOther").ensureSize(new Uint8Array(a.signatureKey.privKey),32):void 0,e=d("WASignalGroupSession").makeSenderKeyChainKey(a.chainKey.counter,d("WASignalOther").ensureSize(new Uint8Array(a.chainKey.key),32)),f=a.keyId,g=[],h=function*(b){if(a.messageKeys[b]){var c=a.messageKeys[b];c=(yield d("WASignalOther").hkdf(new Uint8Array(c),null,"WhisperGroup",50).then(function(a){return d("WASignalGroupSession").makeSenderKeyMsgKey(b,a)}));g.push(c)}};for(var i=0;i<a.messageKeys.length;i++)yield* h(i);h=g;i=d("WASignalGroupSession").makeSenderKeyState(b,c,e,f,h);return i});return k.apply(this,arguments)}function l(a){var b=[],c=d("WAWebCryptoLibrarySignalGroupUtilsApi").makeLibsignalSenderKeyChainKey(a.senderKeyChainKey.nextMsgIndex,d("WAByteArray").uint8ArrayToBuffer(a.senderKeyChainKey.chainKey)),e=a.senderKeyId,f=a.senderSigningKeyPrivate;f=f!=null?d("WAWebCryptoLibrarySignalGroupUtilsApi").makeLibsignalSenderKeySignatureKey(d("WAByteArray").uint8ArrayToBuffer(a.senderSigningKeyPublic),d("WAByteArray").uint8ArrayToBuffer(f)):d("WAWebCryptoLibrarySignalGroupUtilsApi").makeLibsignalSenderKeySignatureKey(d("WAByteArray").uint8ArrayToBuffer(a.senderSigningKeyPublic));a=d("WAWebCryptoLibrarySignalGroupUtilsApi").makeLibsignalSenderKeyState(f,c,e,b);return a}function c(a){a=a.senderKeyStates;a=a.map(function(a){return l(a)});return d("WAWebCryptoLibrarySignalGroupUtilsApi").makeNewLibsignalSenderKeySession(a)}g.toCryptoManagerSenderKeySession=a;g.toSignalSenderKeyState=l;g.toSignalSenderKeySession=c}),98);
__d("WAWebCryptoLibrarySessionConversionApi",["WAArrayBufferUtils","WALogger","WASignalKeys","WASignalOther","WASignalSessions","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["toCryptoManagerSession: "," "]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["toLibsignalSession: prevSendChainHighestIndex: ",", sendChainCounter: ",""]);i=function(){return a};return a}function a(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=m(a);c=(yield k(c,b));var e=[];for(var f in a.sessions)if(a.sessions[f].indexInfo.closed!==-1){var g=(yield k(a.sessions[f],b));g=d("WASignalSessions").detachSession(g);e.push(g)}return d("WASignalSessions").setPrevSessions(c,e)});return j.apply(this,arguments)}function k(a,b){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){try{var c=[];if(a.currentRatchet.lastRemoteEphemeralKey){var e=a[d("WAArrayBufferUtils").arrayBufferToString(a.currentRatchet.lastRemoteEphemeralKey)];if(e){var f=[],g=function*(a){var b=e.messageKeys[a];b=(yield d("WASignalOther").hkdf(new Uint8Array(b),null,"WhisperMessageKeys",80).then(function(b){return d("WASignalSessions").splitMsgKey(a,b)}));f.push(b)};for(var j=0;j<e.messageKeys.length;j++)yield* g(j);g=a.currentRatchet.lastRemoteEphemeralKey;j=e.chainKey.key;if(g!=null&&j!=null){g=d("WASignalSessions").makeRecvChain(d("WASignalKeys").castToSerializedPubKey(new Uint8Array(g)),e.chainKey.counter+1,d("WASignalOther").toBytes(j,32),f);c.push(g)}}}j=a[d("WAArrayBufferUtils").arrayBufferToString(a.currentRatchet.ephemeralKeyPair.pubKey)];g=d("WASignalKeys").castToSerializedPubKey(new Uint8Array(a.currentRatchet.ephemeralKeyPair.pubKey));var k=j.chainKey.key,l=d("WASignalOther").toBytes(a.currentRatchet.ephemeralKeyPair.privKey,32);l=d("WASignalKeys").makeSerializedKeyPairFrom(l,g);g=d("WASignalSessions").makeSendChain(l,j.chainKey.counter+1,d("WASignalOther").toBytes(k,32));l=b&&{regId:b.registrationId,pubKey:d("WASignalKeys").serializeIdentity(new Uint8Array(b.identityKeyPair.pubKey))};j=b&&{regId:a.registrationId,pubKey:new Uint8Array(a.indexInfo.remoteIdentityKey)};k=a.indexInfo.baseKey&&d("WASignalKeys").castToSerializedPubKey(new Uint8Array(a.indexInfo.baseKey));b=a.currentRatchet.previousCounter;b===-1&&d("WALogger").DEV(i(),b,g.nextMsgIndex);var m=d("WASignalOther").toBytes(a.currentRatchet.rootKey,32),n;a.pendingPreKey!=null&&(n=d("WASignalSessions").makeInitialExchangeInfo(a.pendingPreKey.preKeyId,a.pendingPreKey.signedKeyId,d("WASignalKeys").castToSerializedPubKey(new Uint8Array(a.pendingPreKey.baseKey))));a=[];l=d("WASignalSessions").makeSession(l,j,m,c,g,n,Math.max(b,0),a,k);return l}catch(a){d("WALogger").DEV(h(),a);throw a}});return l.apply(this,arguments)}function m(a){a=a.sessions;for(var b in a)if(a[b].indexInfo.closed===-1)return a[b];throw c("err")("getOpenSession: There are no open session")}g.toCryptoLibrarySessionPrevSessions=a;g.toCryptoManagerSession=k}),98);
__d("WAWebSignalConvertApi",["Promise","WALogger","WAWebCryptoCurve25519","WAWebCryptoLibrarySenderkeySessionConversionApi","WAWebCryptoLibrarySessionConversionApi","WAWebSignalProtocolStore","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["maybeConvertSession: failed with error ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["maybeConvertSession: converting to crypto library"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["maybeConvertSenderKey: failed with error ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["maybeConvertSenderKey: converting to crypto library"]);l=function(){return a};return a}function m(a){return a.sessions!=null}function a(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){try{if(a==null||!m(a))return a;var e=(yield (h||(h=b("Promise"))).all([d("WAWebSignalProtocolStore").getSignalProtocolStore().getIdentityKeyPair(),d("WAWebSignalProtocolStore").getSignalProtocolStore().getLocalRegistrationId()])),f=e[0];e=e[1];if(!f||e==null)throw c("err")("Attempted to loadSession without registration info");f={identityKeyPair:d("WAWebCryptoCurve25519").toCurveKeyPair(f),registrationId:e};d("WALogger").LOG(j()).sendLogs("libsignal-to-cryptolib-session",0);return d("WAWebCryptoLibrarySessionConversionApi").toCryptoLibrarySessionPrevSessions(a,f)}catch(a){d("WALogger").ERROR(i(),a).sendLogs("session-convert-error");throw a}});return n.apply(this,arguments)}function o(a){return a.sessions!=null}function e(a){try{if(a==null||!o(a))return a;d("WALogger").LOG(l()).sendLogs("libsignal-to-cryptolib-senderkey",0);return d("WAWebCryptoLibrarySenderkeySessionConversionApi").toCryptoManagerSenderKeySession(a)}catch(a){d("WALogger").ERROR(k(),a).sendLogs("senderkey-convert-error");throw a}}g.shouldConvertSession=m;g.maybeConvertSession=a;g.shouldConvertSenderKey=o;g.maybeConvertSenderKey=e}),98);
__d("WAWebSignalKeyApi",["WAWebCryptoCurve25519","WAWebCryptoLibraryUtilsApi","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=c("WAWebCryptoLibraryUtilsApi").makePreKey(a);var b=a.preKeyId,d=a.privKey;a=a.pubKey;d={privKey:d,pubKey:a};return{keyId:b,keyPair:d,isDirectDistribution:0}});return h.apply(this,arguments)}function e(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=c("WAWebCryptoLibraryUtilsApi").makeSignedPreKey(d("WAWebCryptoCurve25519").toCurveKeyPair(a),b);b=a.preKeyId;var e=a.privKey,f=a.pubKey;a=a.signature;e={privKey:e,pubKey:f};return{keyId:b,keyPair:d("WAWebCryptoCurve25519").toCurveKeyPair(e),signature:a}});return i.apply(this,arguments)}function f(){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){return c("WAWebCryptoLibraryUtilsApi").makeKeyPair()});return j.apply(this,arguments)}g.generatePreKeyPair=a;g.generateSignedKeyPair=e;g.generateIdentityKeyPair=f}),98);
__d("WAWebSignalSessionApi",["Promise","WABinary","WAJids","WALogger","WAWebAdvSignatureApi","WAWebCryptoCurve25519","WAWebCryptoLibrary","WAWebCryptoLibraryDbCallbacksApi","WAWebCryptoLibrarySessionApi","WAWebCryptoLibraryUtilsApi","WAWebSignalCommonUtils","WAWebSignalProtocolStore","WAWebSignalStoreApi","WAWebWidFactory","asyncToGeneratorRuntime","err","gkx"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["hasSameBaseKey: MsgId: ",", savedBaseKey and sessionBaseKey is same"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["hasSameBaseKey: MsgId: ",", savedBaseKey and sessionBaseKey is different "]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["hasSameBaseKey: MsgId: ",", no session has been saved locally "]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["hasSameBaseKey: MsgId: ",", no base key has been saved locally "]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["saveSessionBaseKey: for ",", no basekey provided"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Assertion failed!"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Assertion failed!"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["Assertion failed!"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["Signal::createSignalSession with ",""]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["Signal::createSignalSession"]);r=function(){return a};return a}function a(a){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.wid,e=a.identity,f=a.deviceIdentity;c("gkx")("26258")?d("WALogger").LOG(r()):d("WALogger").LOG(q(),b.toString({legacy:!0}));if(b.device!=null&&b.device!==d("WAJids").DEFAULT_DEVICE_ID){if(!f)throw c("err")("Signal::createSignalSession: expected device-identity in keyBundle for companion device");f=(yield d("WAWebAdvSignatureApi").validateADVwithIdentityKey(b,f,e));if(!f)throw c("err")("Signal::createSignalSession: invalid identityKey fetched")}var g,h,i;try{g=d("WAWebCryptoCurve25519").toSignalCurvePubKey(new(d("WABinary").Binary)(a.identity).readBuffer())}catch(a){d("WALogger").ERROR(p()).sendLogs("Signal::createSignalSession: invalid identityKey fetched");throw a}try{h=d("WAWebCryptoCurve25519").toSignalCurvePubKey(new(d("WABinary").Binary)(a.skey.pubkey).readBuffer())}catch(a){d("WALogger").ERROR(o()).sendLogs("Signal::createSignalSession: invalid signedPreKey fetched");throw a}if(a.key)try{i=d("WAWebCryptoCurve25519").toSignalCurvePubKey(new(d("WABinary").Binary)(a.key.pubkey).readBuffer())}catch(a){d("WALogger").ERROR(n()).sendLogs("Signal::createSignalSession: invalid preKey fetched")}e={registrationId:a.regId,identityKey:g,signedPreKey:{keyId:a.skey.id,publicKey:h,signature:new(d("WABinary").Binary)(a.skey.signature).readBuffer()}};a.key&&i&&(e.preKey={keyId:a.key.id,publicKey:i});return d("WAWebCryptoLibrarySessionApi").createSignalSession(e,b)});return s.apply(this,arguments)}function e(a){return d("WAWebSignalProtocolStore").getPersistSignalProtocolStore().containSessions(a.map(function(a){return d("WAWebSignalCommonUtils").createSignalAddress(a).toString()}))}function f(a){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){return d("WAWebCryptoLibrarySessionApi").getRemoteRegId(a)});return t.apply(this,arguments)}function u(a){return v.apply(this,arguments)}function v(){v=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=d("WAWebSignalCommonUtils").createSignalAddress(a).toString();yield (h||(h=b("Promise"))).all([d("WAWebSignalProtocolStore").getSignalProtocolStore().removeIdentity(a),d("WAWebSignalProtocolStore").getSignalProtocolStore().removeSession(a)])});return v.apply(this,arguments)}function w(a){a=d("WAWebSignalCommonUtils").createSignalAddress(a).toString();return d("WAWebSignalProtocolStore").getSignalProtocolStore().removeSession(a)}function x(a){a=d("WAWebSignalCommonUtils").createSignalAddress(a).toString();return d("WAWebSignalProtocolStore").getPersistSignalProtocolStore().maybeCleanUpUnconvertedSession(a)}function y(a){return z.apply(this,arguments)}function z(){z=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=d("WAJids").unsafeCoerceToDeviceJid(a.toJid());a=(yield c("WAWebCryptoLibraryUtilsApi").getSessionAliceBaseKey(a,d("WAWebCryptoLibraryDbCallbacksApi").getCryptoDbCallbacks().loadSession));return a.success===!0?a.value:null});return z.apply(this,arguments)}function A(a,b){return B.apply(this,arguments)}function B(){B=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=d("WAWebSignalCommonUtils").createSignalAddress(a);a=(yield y(a));!a?d("WALogger").LOG(m(),b):yield d("WAWebSignalStoreApi").waSignalStore.saveBaseKey(c.toString(),b,a)});return B.apply(this,arguments)}function C(a,b){return D.apply(this,arguments)}function D(){D=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){var e=d("WAWebSignalCommonUtils").createSignalAddress(a);a=(yield (h||(h=b("Promise"))).all([y(a),d("WAWebSignalStoreApi").waSignalStore.loadBaseKey(e.toString(),c)]));e=a[0];a=a[1];if(!a){d("WALogger").LOG(l(),c);return!1}if(!e){d("WALogger").LOG(k(),c);return!1}if(!d("WAWebSignalCommonUtils").bufferEqual(a,e)){d("WALogger").LOG(j(),c);return!1}d("WALogger").LOG(i(),c);return!0});return D.apply(this,arguments)}function E(a,b,c){return F.apply(this,arguments)}function F(){F=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){return d("WAWebCryptoLibrarySessionApi").createGroupSenderSignalSession(d("WAWebWidFactory").createWid(b),a,c)});return F.apply(this,arguments)}function G(a,b){return H.apply(this,arguments)}function H(){H=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){return d("WAWebCryptoLibrary").getGroupSenderKeyInfo(a,b)});return H.apply(this,arguments)}function I(a,b){b=d("WAWebSignalCommonUtils").createSignalAddress(b);a=a.toString({legacy:!0})+"::"+b.toString();return d("WAWebSignalStoreApi").waSignalStore.removeSenderKey(a)}function J(a){a=String(d("WAWebSignalCommonUtils").createSignalAddress(a));return d("WAWebSignalStoreApi").waSignalStore.removeSenderKeyBySenderId(a)}g.createSignalSession=a;g.hasSignalSessions=e;g.getRemoteRegId=f;g.deleteRemoteInfo=u;g.deleteRemoteSession=w;g.maybeDeleteUnconvertedSession=x;g.saveSessionBaseKey=A;g.hasSameBaseKey=C;g.createGroupSignalSession=E;g.getGroupSenderKeyInfo=G;g.deleteGroupSenderKeyInfo=I;g.deleteDeviceSenderKey=J}),98);
__d("WAWebSignalUtilsApi",["WAWap","WAWebCryptoCurve25519","WAWebCryptoLibraryUtilsApi"],(function(a,b,c,d,e,f,g){function a(a){var b;return(b=d("WAWap")).wap("skey",null,b.wap("id",null,b.BIG_ENDIAN_CONTENT(a.keyId,3)),b.wap("value",null,a.keyPair.pubKey),b.wap("signature",null,a.signature))}function b(a){var b;return(b=d("WAWap")).wap("key",null,b.wap("id",null,b.BIG_ENDIAN_CONTENT(a.keyId,3)),b.wap("value",null,a.keyPair.pubKey))}function e(a){a=c("WAWebCryptoLibraryUtilsApi").extractIdentityKey(a);return a.success===!0?d("WAWebCryptoCurve25519").toCurveKeyPubKey(a.value):null}g.xmppSignedPreKey=a;g.xmppPreKey=b;g.extractIdentityKey=e}),98);
__d("WAWebCryptoLibrary",["Promise","WAByteArray","WACryptoLibrary","WAJids","WALogger","WASignalKeys","WAWebBackendJobs.flow","WAWebCryptoLibraryDbCallbacksApi","WAWebCryptoLibraryUtilsApi","WAWebSignalCommonErrors","WAWebWidToJid","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["CryptoLibrarySignal::getGroupSenderKeyInfo failed with error ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["CryptoLibrarySignal::getGroupSenderKeyInfo"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["CryptoLibrarySignal::encryptGroupMessage failed with error ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["CryptoLibrarySignal::encryptGroupMessage no sender key, generating a new one"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["CryptoLibrarySignal::decryptSignalProto failed to decrypt: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["CryptoLibrarySignal::decryptMessage failed with error ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["CryptoLibrarySignal::decryptSignalProto"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["CryptoLibrarySignal::createSignalSession failed with error ",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["CryptoLibrarySignal::createSignalSession"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["CryptoLibrarySignal::decryptGroupSignalProto failed to decrypt: ",""]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["CryptoLibrarySignal::decryptGroupMessage failed ",""]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["CryptoLibrarySignal::decryptGroupSignalProto"]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["CryptoLibrarySignal::processSenderKeyDistributionMsg failed with error ",""]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["CryptoLibrarySignal::processSenderKeyDistributionMsg"]);v=function(){return a};return a}function w(){var a=babelHelpers.taggedTemplateLiteralLoose(["CryptoLibrarySignal::encryptSignalProto:failed with error ",""]);w=function(){return a};return a}function x(){var a=babelHelpers.taggedTemplateLiteralLoose(["CryptoLibrarySignal::encryptSignalProto"]);x=function(){return a};return a}var y=d("WAWebCryptoLibraryDbCallbacksApi").getCryptoDbCallbacks();function z(){var a;return{establishOutgoingSession:(a=d("WACryptoLibrary")).establishOutgoingSession,decryptContent:a.decryptContent,encryptContent:a.encryptContent,encryptGroupContent:a.encryptGroupContent,decryptGroupContent:a.decryptGroupContent,saveSenderKeySession:a.saveSenderKeySession,rotateGroupSenderKey:a.rotateGroupSenderKey}}function a(a,b){return A.apply(this,arguments)}function A(){A=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){d("WALogger").LOG(q());var e=(yield y.getRegistrationInfo());if(!e)throw c("err")("No registration info found");return z().establishOutgoingSession({handleNewSession:y.handleNewSession},e,d("WAWebWidToJid").widToDeviceJid(a),b).then(function(a){if(!a.success){d("WALogger").WARN(p(),a.error);throw c("err")(a.error)}})});return A.apply(this,arguments)}function e(a,b,c){return B.apply(this,arguments)}function B(){B=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){d("WALogger").LOG(o());e=e===d("WAWebBackendJobs.flow").CiphertextType.Pkmsg?"pkmsg":"msg";var g,i=(yield y.getRegistrationInfo());return!i?(h||(h=b("Promise"))).reject(c("err")("No registration info found")):z().decryptContent({handleNewSession:y.handleNewSession,loadOneTimePreKey:y.loadOneTimePreKey,loadSession:y.loadSession,loadSignedPreKey:y.loadSignedPreKey},i,d("WAWebWidToJid").widToDeviceJid(a),{ciphertext:f,type:e},function(a){g=d("WAByteArray").uint8ArrayToBuffer(a);return(h||(h=b("Promise"))).resolve()}).then(function(a){if(a.success){if(g==null)throw new(d("WAWebSignalCommonErrors").SignalDecryptionError)("Null result on successful decryption");return g}a=a.error;d("WALogger").WARN(n(),a);if(a==="errDuplicateMsg")throw new(d("WAWebSignalCommonErrors").SignalMessageCounterError)(a);else throw new(d("WAWebSignalCommonErrors").SignalDecryptionError)(a)})["catch"](function(a){if(a instanceof d("WAWebSignalCommonErrors").SignalDecryptionError||a instanceof d("WAWebSignalCommonErrors").SignalMessageCounterError)throw a;d("WALogger").ERROR(m(),a.stack);throw new(d("WAWebSignalCommonErrors").SignalDecryptionError)("Unexpected decryption error")})});return B.apply(this,arguments)}function f(a,b){d("WALogger").LOG(x());return z().encryptContent({handleNewSession:y.handleNewSession,loadSession:y.loadSession},d("WAWebWidToJid").widToDeviceJid(a),b,null).then(function(a){if(a.success){var b=a.value,e=b.type;b=b.ciphertext;return{type:(e=d("WAWebBackendJobs.flow").CiphertextType.cast(e))!=null?e:d("WAWebBackendJobs.flow").CiphertextType.Msg,ciphertext:d("WAByteArray").uint8ArrayToBuffer(b)}}d("WALogger").WARN(w(),a.error);throw c("err")(a.error)})}function C(a){return D.apply(this,arguments)}function D(){D=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield y.loadSession(d("WAWebWidToJid").widToDeviceJid(a)));return a==null?void 0:a.remote});return D.apply(this,arguments)}function E(a,b,c){return F.apply(this,arguments)}function F(){F=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){var f;a=d("WAWebWidToJid").widToMulticastJid(a);f=(f=d("WAJids").validateGroupJid(a))!=null?f:d("WAJids").validateStatusJid(a);if(f==null)throw c("err")("Broadcast JIDs are not supported by WACryptoManager yet.");a=d("WAWebWidToJid").widToDeviceJid(b);b=(yield z().encryptGroupContent({loadSenderKeySession:y.loadSenderKeySession,saveSenderKeySession:y.saveSenderKeySession},f,a,e));if(!b.success&&b.error==="errLoadSenderKeySession"){b.error;d("WALogger").LOG(l());var g=(yield d("WASignalKeys").makeKeyPair());yield z().rotateGroupSenderKey({saveSenderKeySession:y.saveSenderKeySession},f,a,g);b=(yield z().encryptGroupContent({loadSenderKeySession:y.loadSenderKeySession,saveSenderKeySession:y.saveSenderKeySession},f,a,e))}if(b.success){g=b.value.ciphertext.ciphertext;f=b.value.senderKeyDistributionProto;return{ciphertext:d("WAByteArray").uint8ArrayToBuffer(g),senderKeyBytes:d("WAByteArray").uint8ArrayToBuffer(f)}}d("WALogger").WARN(k(),b.error);throw c("err")(b.error)});return F.apply(this,arguments)}function G(a,b,e){d("WALogger").LOG(v());return z().saveSenderKeySession({loadSenderKeySession:y.loadSenderKeySession,saveSenderKeySession:y.saveSenderKeySession},a,d("WAWebWidToJid").widToDeviceJid(b),new Uint8Array(e)).then(function(a){if(!a.success){d("WALogger").WARN(u(),a.error);throw c("err")(a.error)}})}function H(a,c,e){d("WALogger").LOG(t());var f=null;return z().decryptGroupContent({loadSenderKeySession:y.loadSenderKeySession,saveSenderKeySession:y.saveSenderKeySession},d("WAWebWidToJid").widToMulticastJid(a),d("WAWebWidToJid").widToDeviceJid(c),e,function(a){f=d("WAByteArray").uint8ArrayToBuffer(a);return(h||(h=b("Promise"))).resolve()}).then(function(a){if(a.success){if(f==null)throw new(d("WAWebSignalCommonErrors").SignalDecryptionError)("Null result on successful decryption of group msg");return f}a=a.error;d("WALogger").WARN(s(),a);if(a==="errDuplicateMsg")throw new(d("WAWebSignalCommonErrors").SignalMessageCounterError)(a);else throw new(d("WAWebSignalCommonErrors").SignalDecryptionError)(a)})["catch"](function(a){if(a instanceof d("WAWebSignalCommonErrors").SignalDecryptionError||a instanceof d("WAWebSignalCommonErrors").SignalMessageCounterError)throw a;d("WALogger").ERROR(r(),a);throw new(d("WAWebSignalCommonErrors").SignalDecryptionError)("Unexpected decryption error")})}function I(a,b){return J.apply(this,arguments)}function J(){J=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){d("WALogger").LOG(j());a=(yield c("WAWebCryptoLibraryUtilsApi").createSenderKeyDistributionMsg(y.loadSenderKeySession,y.saveSenderKeySession,d("WAJids").toGroupJid(a.toString({legacy:!0})),d("WAWebWidToJid").widToDeviceJid(b)));if(a.success)return d("WAByteArray").uint8ArrayToBuffer(a.value);d("WALogger").WARN(i(),a.error);throw c("err")(a.error)});return J.apply(this,arguments)}g.getCryptoLibModule=z;g.createSignalSession=a;g.decryptSignalProto=e;g.encryptSignalProto=f;g.getRemoteRegId=C;g.encryptSenderKeyMsgSignalProto=E;g.processSenderKeyDistributionMsg=G;g.decryptGroupSignalProto=H;g.getGroupSenderKeyInfo=I}),98);
__d("WAWebCryptoLibraryDbCallbacksApi",["Promise","WAByteArray","WAResultOrError","WASignalKeys","WASignalLocalStorageProtocol.pb","WASignalOther","WAWebSignalCommonUtils","WAWebSignalProtocolStore","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function a(){var a=function(a,b,c){a=d("WAWebSignalCommonUtils").createSignalLikeSenderKeyName(a,d("WAWebWidFactory").createDeviceWid(b));return d("WAWebSignalProtocolStore").getSignalProtocolStore().storeSenderKey(a,c)},c=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=d("WAWebSignalCommonUtils").createSignalAddress(d("WAWebWidFactory").createDeviceWid(a));a=(yield d("WAWebSignalProtocolStore").getSignalProtocolStore().loadSession(a));return(a=a)!=null?a:null});return function(b){return a.apply(this,arguments)}}();return{loadSession:c,handleNewSession:function(a,c,e,f,g){g=d("WAWebSignalCommonUtils").createSignalAddress(d("WAWebWidFactory").createDeviceWid(a));return(h||(h=b("Promise"))).all([d("WAWebSignalProtocolStore").getSignalProtocolStore().storeSession(g,c),e&&d("WAWebSignalProtocolStore").getSignalProtocolStore().saveIdentity(g,d("WAByteArray").uint8ArrayToBuffer(e)),f!=null&&d("WAWebSignalProtocolStore").getSignalProtocolStore().removePreKey(f)]).then(function(){return d("WAResultOrError").makeResult()})},loadSignedPreKey:function(a){return d("WAWebSignalProtocolStore").getSignalProtocolStore().loadSignedPreKey(a).then(function(b){if(b==null)return null;var c=d("WASignalKeys").makeKeyPairFromArrayBuffers(b.pubKey,b.privKey);c=d("WASignalOther").encodeSignalProto(d("WASignalLocalStorageProtocol.pb").SignedPreKeyRecordStructureSpec,{id:a,publicKey:d("WASignalKeys").serializePubKey(c),privateKey:c.privateKey,signature:new Uint8Array(b.signature),timestamp:0});return d("WASignalOther").castToByteEncoded(c)})},loadOneTimePreKey:function(a){return d("WAWebSignalProtocolStore").getSignalProtocolStore().loadPreKey(a).then(function(b){if(b==null)return null;b=d("WASignalKeys").makeKeyPairFromArrayBuffers(b.pubKey,b.privKey);b=d("WASignalOther").encodeSignalProto(d("WASignalLocalStorageProtocol.pb").PreKeyRecordStructureSpec,{id:a,publicKey:d("WASignalKeys").serializePubKey(b),privateKey:b.privateKey});return d("WASignalOther").castToByteEncoded(b)})},loadSenderKeySession:function(a,b){a=d("WAWebSignalCommonUtils").createSignalLikeSenderKeyName(a,d("WAWebWidFactory").createDeviceWid(b));return d("WAWebSignalProtocolStore").getSignalProtocolStore().loadSenderKey(a).then(function(a){if(a==null)return d("WAResultOrError").makeError("errLoadSenderKeySession");a=a;return d("WAResultOrError").makeResult(a)})},saveSenderKeySession:a,getRegistrationInfo:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WAWebSignalProtocolStore").getSignalProtocolStore().getLocalRegistrationId()),b=(yield d("WAWebSignalProtocolStore").getSignalProtocolStore().getIdentityKeyPair());if(a==null||b==null)return;if(a&&b)return{regId:d("WASignalOther").castRegistrationId(a),staticKeyPair:d("WASignalKeys").makeKeyPairFromArrayBuffers(b.pubKey.slice(1),b.privKey)}});function c(){return a.apply(this,arguments)}return c}()}}g.getCryptoDbCallbacks=a}),98);
__d("WAWebCryptoLibrarySessionApi",["WALogger","WAWebCryptoLibrary"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["CryptoLibrarySignal::createGroupSenderSignalSession"]);h=function(){return a};return a}function a(a){return d("WAWebCryptoLibrary").getRemoteRegId(a).then(function(a){return a==null?void 0:a.regId})}function b(a,b){var c;c={identity:new Uint8Array(a.identityKey),oneTimeKey:a.preKey&&{id:(c=a.preKey)==null?void 0:c.keyId,publicKey:((c=a.preKey)==null?void 0:c.publicKey)&&new Uint8Array((c=a.preKey)==null?void 0:c.publicKey)},regId:a.registrationId,signedKey:{id:a.signedPreKey.keyId,publicKey:new Uint8Array(a.signedPreKey.publicKey),signature:new Uint8Array(a.signedPreKey.signature)}};return d("WAWebCryptoLibrary").createSignalSession(b,c)}function c(a,b,c){d("WALogger").DEV(h());return d("WAWebCryptoLibrary").processSenderKeyDistributionMsg(a,b,c)}g.getRemoteRegId=a;g.createSignalSession=b;g.createGroupSenderSignalSession=c}),98);
__d("WAWebCryptoLibraryUtilsApi",["WACryptoPrimitives","WALogger","WAResultOrError","WASignalCipher","WASignalGroupCipher","WASignalGroupSession","WASignalKeys","WASignalOther","WASignalSessions","WASignalSignatures","WASignalWhisperTextProtocol.pb","WATimeUtils","WAWebCryptoLibrary","asyncToGeneratorRuntime","decodeProtobuf"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["extractIdentityKey: parse proto failed"]);h=function(){return a};return a}a=function(){function a(){}var c=a.prototype;c.createSenderKeyDistributionMsg=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){var f=(yield a(c,e));if(!f.success&&f.error==="errLoadSenderKeySession"){var g=(yield d("WASignalKeys").makeKeyPair());yield d("WAWebCryptoLibrary").getCryptoLibModule().rotateGroupSenderKey({saveSenderKeySession:b},c,e,g);f=(yield a(c,e))}if(f.success){b=f.value.senderKeyStates.slice(-1);if(b.length>0)return d("WAResultOrError").makeResult(d("WASignalGroupCipher").createSenderKeyDistributionProto(d("WASignalGroupSession").convertFromRawToSenderKeyState(b[0])))}return d("WAResultOrError").makeError("errGetSenderKeyProto")});function c(b,c,d,e){return a.apply(this,arguments)}return c}();c.getSessionAliceBaseKey=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){b=(yield b(a));return(b==null?void 0:b.aliceBaseKey)?d("WAResultOrError").makeResult(d("WASignalOther").toBuffer(b.aliceBaseKey)):d("WAResultOrError").makeError("errSessionExists")});function c(b,c){return a.apply(this,arguments)}return c}();c.extractIdentityKey=function(a){a=d("WASignalCipher").readContent(a,d("WASignalSessions").FORMAT_VERSION,0);if(!a.success)return a;try{a=d("decodeProtobuf").decodeProtobuf(d("WASignalWhisperTextProtocol.pb").PreKeySignalMessageSpec,a.value);var b=a.registrationId,c=a.signedPreKeyId,e=a.baseKey,f=a.identityKey;a=a.message;if(b==null||c==null||e==null||f==null||a==null)return d("WAResultOrError").makeError("errSignalDeserializePkInvalidProtoFormat");d("WASignalOther").ensureSize(new Uint8Array(f),33);return d("WAResultOrError").makeResult(f)}catch(a){d("WALogger").WARN(h()).devConsole(a);return d("WAResultOrError").makeError("errSignalDeserializePkKeyBadFormat")}};c.verifySignature=function(a,b,c){a=d("WASignalSignatures").convertPublicKeyToSerializedPubKey(a);c=d("WASignalOther").ensureSize(c,64);return d("WASignalSignatures").verifyMsgSignalVariant(a,b,c)};c.signMsg=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){a=d("WASignalKeys").makeKeyPairFromArrayBuffers(a,b);b=(yield d("WASignalSignatures").signMsg(a,new Uint8Array(c)));return d("WASignalOther").toBuffer(b)});function c(b,c,d){return a.apply(this,arguments)}return c}();c.makePreKey=function(a){a=d("WASignalKeys").makePreKeys(a,1);a=a[0].plainObject;var b=a.id;a=a.keyPair;return{preKeyId:b,privKey:d("WASignalOther").toBuffer(a.privateKey),pubKey:d("WASignalOther").toBuffer(a.publicKey)}};c.makeSignedPreKey=function(a,b){a=d("WASignalKeys").makeKeyPairFromArrayBuffers(a.pubKey,a.privKey);b=d("WASignalSignatures").makeSignedPreKey(b,d("WATimeUtils").unixTimeMs(),a);return{preKeyId:b.id,signature:d("WASignalOther").toBuffer(b.signature),pubKey:d("WASignalOther").toBuffer(b.keyPair.publicKey),privKey:d("WASignalOther").toBuffer(b.keyPair.privateKey)}};c.makeKeyPair=function(){var a=d("WASignalKeys").makeKeyPair(),b=a.privateKey;a=a.publicKey;return{privKey:d("WASignalOther").toBuffer(b),pubKey:d("WASignalOther").toBuffer(a)}};return a}();a.prototype.verify=d("WACryptoPrimitives").verify;a.prototype.makeRegistrationId=d("WASignalOther").makeRegistrationId;a.prototype.makeSenderKeyId=d("WASignalOther").makeSenderKeyId;c=new a();e=c;g["default"]=e}),98);
__d("WAWebSignalProtocolStore",["WAWebSignalProtocolStoreUnifiedApi"],(function(a,b,c,d,e,f,g){function a(){return c("WAWebSignalProtocolStoreUnifiedApi")}function b(){return c("WAWebSignalProtocolStoreUnifiedApi")}function d(){c("WAWebSignalProtocolStoreUnifiedApi").switchToMemMode()}function e(){c("WAWebSignalProtocolStoreUnifiedApi").switchToPersistMode()}g.getSignalProtocolStore=a;g.getPersistSignalProtocolStore=b;g.enableMemSignalStore=d;g.enablePersistSignalStore=e}),98);
__d("WAWebProtocolStoreCommonApi",["WAWebSignalCommonUtils"],(function(a,b,c,d,e,f,g){function a(a){return a instanceof ArrayBuffer?d("WAWebSignalCommonUtils").bufferToStr(a):a}g.stringifyIdentityKey=a}),98);
__d("WAWebSignalProtocolStoreCacheApi",["WALogger","WASemaphore","lodash"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Signal]signalSnapshot: get dirty updates for\n  session: ","\n  senderKey: ","\n  identity: ",";\n  preKeyRemove: ","\n  sessionRemove: ","\n  identityRemove: ","\n"]);h=function(){return a};return a}a=function(){function a(){var a;this.RegistrationInfo=null;this.SignedPreKeyStore=new Map();this.PrekeyStore=new Map();this.SessionStore=new Map();this.IdentityStore=new Map();this.SenderKeyStore=new Map();this.Mutex={session:new((a=d("WASemaphore")).Semaphore)(),identity:new a.Semaphore(),senderKey:new a.Semaphore(),preKey:new a.Semaphore()};this.Dirty={session:new Set(),identity:new Set(),senderKey:new Set(),preKey:new Set()}}var b=a.prototype;b.$1=function(){var a=this,b=[],d=[];this.Dirty.session.forEach(function(e){var f=a.SessionStore.get(e);if(!f)return;!f.deleted?b.push({address:e,session:c("lodash").cloneDeep(f.session)}):d.push(e)});return{update:b,remove:d}};b.$2=function(){var a=this,b=[];this.Dirty.senderKey.forEach(function(d){var e=a.SenderKeyStore.get(d);if(e){var f=d.split("::");f.length===2&&b.push({senderKeyName:d,senderId:f[1],senderKey:c("lodash").cloneDeep(e)})}});return b};b.$3=function(){var a=this,b=[],c=[];this.Dirty.identity.forEach(function(d){var e=a.IdentityStore.get(d);if(!e)return;!e.deleted?b.push({identifier:d,identityKey:e.identityKey,rowId:e.rowId,sentAddonRowId:e.sentAddonRowId}):c.push(d)});return{update:b,remove:c}};b.$4=function(){var a=this,b=[];this.Dirty.preKey.forEach(function(c){var d=a.PrekeyStore.get(c);(d==null?void 0:d.deleted)&&b.push(parseInt(c,10))});return b};b.generateCacheUpdate=function(){var a=this.$3(),b=this.$1();b={sessionUpdate:b.update,sessionRemove:b.remove,identityUpdate:a.update,identityRemove:a.remove,senderKeyUpdate:this.$2(),preKeyRemove:this.$4()};i(b);return b};b.clearDirty=function(){this.Dirty={session:new Set(),identity:new Set(),senderKey:new Set(),preKey:new Set()}};b.clear=function(){this.RegistrationInfo=null,this.SignedPreKeyStore.clear(),this.PrekeyStore.clear(),this.SessionStore.clear(),this.IdentityStore.clear(),this.SenderKeyStore.clear(),this.clearDirty()};return a}();function i(a){d("WALogger").DEV(h(),a.sessionUpdate.map(function(a){return a.address}).join(",")||"[]",a.senderKeyUpdate.map(function(a){return a.senderKeyName}).join(",")||"[]",a.identityUpdate.map(function(a){return a.identifier}).join(",")||"[]",a.preKeyRemove.join(",")||"[]",a.sessionRemove.join(",")||"[]",a.identityRemove.join(",")||"[]").tags("unified-store")}g.SignalStoreCache=a}),98);
__d("WAWebSignalProtocolStoreUnifiedApi",["$InternalEnum","Promise","WALogger","WAWebApiContact","WAWebBackendApi","WAWebCryptoCurve25519","WAWebIdentityChangeApi","WAWebProtocolStoreCommonApi","WAWebSignalCommonUtils","WAWebSignalConvertApi","WAWebSignalProtocolStoreCacheApi","WAWebSignalStorageUtils","WAWebSignalStoreApi","WAWebUserPrefsMeUser","WAWebWidFactory","asyncToGeneratorRuntime","err","gkx"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Signal]maybeCleanUpUnconvertedSession: delete unconverted session"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Signal]updateIdentityRangeAfterEncryption: "," updated"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Signal]updateIdentityRangeAfterEncryption: updates: "," to rowId: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Signal]updateIdentityRangeAfterEncryption: start"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Signal]flushBufferToDiskIfNotMemOnlyMode: done"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Signal]flushBufferToDiskIfNotMemOnlyMode: lock complete"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Signal]flushBufferToDiskIfNotMemOnlyMode: start"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Signal]flushBufferToDiskIfNotMemOnlyMode: skip for memory mode"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Signal]deleteAllCache"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Signal][storeSenderKey][unified] senderKeyName: "," keyId:"," chainCounter: ",""]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Signal][storeSenderKey][unified] senderKeyName: "," keyId:"," chainCounter: ",""]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Signal]bulkCreateIdentity: store "," value(s) (new: ","): end"]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Signal]bulkCreateIdentity: store "," value(s): start"]);u=function(){return a};return a}var v=b("$InternalEnum").Mirrored(["Persist","Memory"]);a=function(){function a(){this.Direction={SENDING:1,RECEIVING:2},this._cache=new(d("WAWebSignalProtocolStoreCacheApi").SignalStoreCache)(),this._mode=v.Persist}var e=a.prototype;e.getIdentityKeyPair=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a;this._cache.RegistrationInfo||(this._cache.RegistrationInfo=(yield d("WAWebSignalStoreApi").waSignalStore.getRegistrationInfo()));return((a=this._cache.RegistrationInfo)==null?void 0:a.identityKeyPair)?d("WAWebCryptoCurve25519").toSignalCurveKeyPair(this._cache.RegistrationInfo.identityKeyPair):void 0});function c(){return a.apply(this,arguments)}return c}();e.getLocalRegistrationId=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a;this._cache.RegistrationInfo||(this._cache.RegistrationInfo=(yield d("WAWebSignalStoreApi").waSignalStore.getRegistrationInfo()));return((a=this._cache.RegistrationInfo)==null?void 0:a.registrationId)||void 0});function c(){return a.apply(this,arguments)}return c}();e.isTrustedIdentity=function(a,c){return(h||(h=b("Promise"))).resolve(!0)};e._loadIdentityKeyImpl=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a==null)throw c("err")("Tried to get identity key for undefined/null key");if(!this._cache.IdentityStore.has(a)){var b=(yield d("WAWebSignalStoreApi").waSignalStore.getIdentityKeyWithRowId(a));this._cache.IdentityStore.set(a,b)}return((b=this._cache.IdentityStore.get(a))==null?void 0:b.identityKey)||void 0});function a(b){return a.apply(this,arguments)}return a}();e.loadIdentityKey=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield this._cache.Mutex.identity.acquire());try{return yield this._loadIdentityKeyImpl(a)}finally{b.release()}});function c(b){return a.apply(this,arguments)}return c}();e._putIdentityImpl=function(a,b){this._cache.IdentityStore.set(a,{identityKey:b}),this._cache.Dirty.identity.add(a)};e.putIdentity=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=(yield this._cache.Mutex.identity.acquire());try{this._putIdentityImpl(a,b)}finally{c.release()}});function c(b,c){return a.apply(this,arguments)}return c}();e._saveIdentity=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){b=d("WAWebProtocolStoreCommonApi").stringifyIdentityKey(b);var c=(yield this.loadIdentityKey(a));if(c&&c===b)return;else if(c){if(a===d("WAWebSignalCommonUtils").createSignalAddress(d("WAWebUserPrefsMeUser").getMeUser()).toString()){d("WAWebBackendApi").frontendFireAndForget("handleSelfPrimaryIdentityChange",{});return}a!=null&&(yield d("WAWebIdentityChangeApi").handleNewIdentity(a))}yield this.putIdentity(a,b)});function a(b,c){return a.apply(this,arguments)}return a}();e.saveIdentity=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(a==null)throw c("err")("Tried to put identity key for undefined/null key");yield this._saveIdentity(a,b);if(a!==d("WAWebSignalCommonUtils").createSignalAddress(d("WAWebUserPrefsMeUser").getMeUser()).toString()){a=d("WAWebWidFactory").widFromSignalAddress(a);a=d("WAWebApiContact").getAlternateDeviceWid(a);a=a!=null?d("WAWebSignalCommonUtils").createSignalAddress(a).toString():null;a!=null&&(yield this._saveIdentity(a,b))}});function e(b,c){return a.apply(this,arguments)}return e}();e.getIdentityWithRowId=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a==null)throw c("err")("Tried to get identity key for undefined/null key");yield this.loadIdentityKey(a);a=this._cache.IdentityStore.get(a);if(a==null||a.deleted!==void 0)return;return a});function d(b){return a.apply(this,arguments)}return d}();e.bulkGetIdentityWithRowId=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=this;if(a==null)throw c("err")("Tried to get identity key for undefined/null key");if(a.length===0)return[];yield this.bulkLoadIdentityKey(a);return a.map(function(a){a=b._cache.IdentityStore.get(a);if(a==null||a.deleted!==void 0)return;return a})});function d(b){return a.apply(this,arguments)}return d}();e._bulkLoadIdentityKeyImpl=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=this;if(a==null)throw c("err")("Tried to get identity key for undefined/null key");if(a.length===0)return[];var e=new Array(a.length),f=[];a.forEach(function(a,c){if(b._cache.IdentityStore.has(a)){var d;e[c]=(d=b._cache.IdentityStore.get(a))==null?void 0:d.identityKey}else f.push({id:a,pos:c})});if(f.length>0){a=(yield d("WAWebSignalStoreApi").waSignalStore.bulkGetIdentityKeyWithRowId(f.map(function(a){return a.id})));a.forEach(function(a,c){c=f[c];b._cache.IdentityStore.set(c.id,a);e[c.pos]=a==null?void 0:a.identityKey})}return e});function a(b){return a.apply(this,arguments)}return a}();e.bulkLoadIdentityKey=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield this._cache.Mutex.identity.acquire());try{return yield this._bulkLoadIdentityKeyImpl(a)}finally{b.release()}});function c(b){return a.apply(this,arguments)}return c}();e.expandNewIdentitiesList=function(a){var b=new Map();a.forEach(function(a){b.set(a.identifier,{identifier:a.identifier,identityKey:a.identityKey})});a.forEach(function(a){var c=d("WAWebWidFactory").widFromSignalAddress(a.identifier);c=d("WAWebApiContact").getAlternateDeviceWid(c);if(c==null)return;c=d("WAWebSignalCommonUtils").createSignalAddress(c).toString();b.set(c,{identifier:c,identityKey:a.identityKey})});return Array.from(b.values())};e._bulkCreateIdentityImpl=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=this;if(a==null)throw c("err")("Tried to bulk put identity key with undefined/null");d("WALogger").LOG(u(),a.length).tags("unified-store");yield d("WAWebSignalStorageUtils").getStorage().lock(["identity-store"],b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=a.map(function(a){return a.identifier}),c=(yield e._bulkLoadIdentityKeyImpl(b));b=a.filter(function(a,b){return!c[b]});b.length>0&&(b=e.expandNewIdentitiesList(b),yield d("WAWebSignalStoreApi").waSignalStore.bulkPutIdentity(b),b.forEach(function(a){var b=a.identifier;a=a.identityKey;e._cache.IdentityStore.set(b,{identityKey:a})}));d("WALogger").LOG(t(),a.length,b.length).tags("unified-store")}))});function a(b){return a.apply(this,arguments)}return a}();e.bulkCreateIdentity=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield this._cache.Mutex.identity.acquire());try{yield this._bulkCreateIdentityImpl(a)}finally{b.release()}});function c(b){return a.apply(this,arguments)}return c}();e._removeIdentityImpl=function(a){this._cache.IdentityStore.set(a,{deleted:!0}),this._cache.Dirty.identity.add(a)};e.removeIdentity=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a==null)return(h||(h=b("Promise"))).reject(c("err")("Tried to remove identity key for undefined/null key"));var d=(yield this._cache.Mutex.identity.acquire());try{yield this._removeIdentityImpl(a)}finally{d.release()}});function d(b){return a.apply(this,arguments)}return d}();e._loadPreKeyImpl=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a==null)return void 0;if(!this._cache.PrekeyStore.has(a)){var b;b=(b=(yield d("WAWebSignalStoreApi").waSignalStore.getPreKeyById(a)))==null?void 0:b.keyPair;this._cache.PrekeyStore.set(a,{keyPair:b})}b=this._cache.PrekeyStore.get(a);return(b==null?void 0:b.keyPair)||void 0});function a(b){return a.apply(this,arguments)}return a}();e.loadPreKey=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield this._cache.Mutex.preKey.acquire());try{return yield this._loadPreKeyImpl(a)}finally{b.release()}});function c(b){return a.apply(this,arguments)}return c}();e._removePreKeyImpl=function(a){if(a==null)return(h||(h=b("Promise"))).reject(c("err")("Tried to remove pre key without keyId"));this._cache.PrekeyStore.set(a,{deleted:!0});this._cache.Dirty.preKey.add(a);return(h||(h=b("Promise"))).resolve()};e.removePreKey=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield this._cache.Mutex.preKey.acquire());try{yield this._removePreKeyImpl(a)}finally{b.release()}});function c(b){return a.apply(this,arguments)}return c}();e.loadSignedPreKey=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a==null)return void 0;if(!this._cache.SignedPreKeyStore.has(a)){var b=(yield d("WAWebSignalStoreApi").waSignalStore.getSignedPreKeyById(a));b=b?{pubKey:b.keyPair.pubKey,privKey:b.keyPair.privKey,signature:b.signature}:null;this._cache.SignedPreKeyStore.set(a,b)}return this._cache.SignedPreKeyStore.get(a)||void 0});function c(b){return a.apply(this,arguments)}return c}();e._loadSessionImpl=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a==null)return void 0;if(!this._cache.SessionStore.has(a)){var b=(yield d("WAWebSignalStoreApi").waSignalStore.getSession(a));this._cache.SessionStore.set(a,b?{session:b}:void 0)}return(yield d("WAWebSignalConvertApi").maybeConvertSession((b=this._cache.SessionStore.get(a))==null?void 0:b.session))||void 0});function a(b){return a.apply(this,arguments)}return a}();e.loadSession=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield this._cache.Mutex.session.acquire());try{return yield this._loadSessionImpl(a)}finally{b.release()}});function c(b){return a.apply(this,arguments)}return c}();e._storeSessionImpl=function(a,b){if(a==null)throw c("err")("Tried to put session without identifier");this._cache.SessionStore.set(a,{session:b});this._cache.Dirty.session.add(a)};e.storeSession=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=(yield this._cache.Mutex.session.acquire());try{this._storeSessionImpl(a,b)}finally{c.release()}});function c(b,c){return a.apply(this,arguments)}return c}();e._removeSessionImpl=function(a){if(a==null)throw c("err")("Tried to remove session without identifier");this._cache.SessionStore.set(a,{deleted:!0});this._cache.Dirty.session.add(a)};e.removeSession=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield this._cache.Mutex.session.acquire());try{this._removeSessionImpl(a)}finally{b.release()}});function c(b){return a.apply(this,arguments)}return c}();e._containSessionsImpl=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=this,c=[];for(var e of a)this._cache.SessionStore.has(e)||c.push(e);if(c.length>0){e=(yield d("WAWebSignalStoreApi").waSignalStore.bulkGetSession(c));e.forEach(function(a,d){d=c[d];b._cache.SessionStore.set(d,a?{session:a}:void 0)})}return a.map(function(a){a=b._cache.SessionStore.get(a);return a!=null&&!(a==null?void 0:a.deleted)})});function a(b){return a.apply(this,arguments)}return a}();e.containSessions=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield this._cache.Mutex.session.acquire());try{return yield this._containSessionsImpl(a)}finally{b.release()}});function c(b){return a.apply(this,arguments)}return c}();e._storeSenderKeyImpl=function(a,e){if(a==null)return(h||(h=b("Promise"))).reject(c("err")("Tried to put session without identifier"));if(!c("gkx")("26258"))if(Array.isArray(e==null?void 0:e.sessions)){var f=e.sessions[e.sessions.length-1];d("WALogger").DEV(s(),a,f==null?void 0:f.keyId,f==null?void 0:(f=f.chainKey)==null?void 0:f.counter)}else{f=e==null?void 0:(f=e.senderKeyStates)==null?void 0:f[0];d("WALogger").DEV(r(),a,f==null?void 0:f.senderKeyId,f==null?void 0:(f=f.senderKeyChainKey)==null?void 0:f.nextMsgIndex)}this._cache.SenderKeyStore.set(a,e);this._cache.Dirty.senderKey.add(a);return(h||(h=b("Promise"))).resolve()};e.storeSenderKey=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=(yield this._cache.Mutex.senderKey.acquire());try{yield this._storeSenderKeyImpl(a,b)}finally{c.release()}});function c(b,c){return a.apply(this,arguments)}return c}();e._loadSenderKeyImpl=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a==null)return void 0;if(!this._cache.SenderKeyStore.has(a)){var b=(yield d("WAWebSignalStoreApi").waSignalStore.getSenderKey(a));this._cache.SenderKeyStore.set(a,b)}return d("WAWebSignalConvertApi").maybeConvertSenderKey(this._cache.SenderKeyStore.get(a))||void 0});function a(b){return a.apply(this,arguments)}return a}();e.loadSenderKey=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield this._cache.Mutex.senderKey.acquire());try{return yield this._loadSenderKeyImpl(a)}finally{b.release()}});function c(b){return a.apply(this,arguments)}return c}();e.switchToMemMode=function(){this._mode=v.Memory};e.switchToPersistMode=function(){this._mode=v.Persist};e.generateSnapshot=function(){if(this._mode===v.Memory)return this._cache.generateCacheUpdate()};e.deleteAllCache=function(){d("WALogger").LOG(q()).tags("unified-store"),this._cache.clear()};e.flushBufferToDiskIfNotMemOnlyMode=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(this._mode===v.Memory){d("WALogger").LOG(p()).tags("unified-store");return(h||(h=b("Promise"))).resolve()}d("WALogger").LOG(o()).tags("unified-store");var a=[yield this._cache.Mutex.identity.acquire(),yield this._cache.Mutex.session.acquire(),yield this._cache.Mutex.senderKey.acquire(),yield this._cache.Mutex.preKey.acquire()];d("WALogger").LOG(n()).tags("unified-store");var c=this._cache.generateCacheUpdate();try{yield d("WAWebSignalStorageUtils").getStorage().lock(["session-store","identity-store","prekey-store","senderkey-store"],b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield (h||(h=b("Promise"))).all([d("WAWebSignalStoreApi").waSignalStore.bulkPutSession(c.sessionUpdate),d("WAWebSignalStoreApi").waSignalStore.bulkPutIdentityKeyWithRowId(c.identityUpdate),d("WAWebSignalStoreApi").waSignalStore.bulkPutSenderKey(c.senderKeyUpdate),d("WAWebSignalStoreApi").waSignalStore.bulkRemovePreKey(c.preKeyRemove),d("WAWebSignalStoreApi").waSignalStore.bulkRemoveSession(c.sessionRemove),d("WAWebSignalStoreApi").waSignalStore.bulkRemoveIdentity(c.identityRemove)])})),this._cache.clearDirty()}finally{a.forEach(function(a){return a.release()})}d("WALogger").LOG(m()).tags("unified-store")});function c(){return a.apply(this,arguments)}return c}();e._updateIdentityRangeAfterEncryptionImpl=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){var e=this;d("WALogger").LOG(l()).tags("unified-store");yield this._bulkLoadIdentityKeyImpl(c);var f=[];c.forEach(function(c){var d=e._cache.IdentityStore.get(c);if(d&&!d.deleted&&(d[a]==null||d[a]>b)){d=babelHelpers["extends"]({},d);d[a]=b;e._cache.IdentityStore.set(c,d);e._cache.Dirty.identity.add(c);f.push(c)}});d("WALogger").DEV(k(),JSON.stringify(f),b).tags("unified-store");d("WALogger").LOG(j(),f.length).tags("unified-store")});function a(b,c,d){return a.apply(this,arguments)}return a}();e.updateIdentityRangeAfterEncryption=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){var d=(yield this._cache.Mutex.identity.acquire());try{yield this._updateIdentityRangeAfterEncryptionImpl(a,b,c)}finally{d.release()}});function c(b,c,d){return a.apply(this,arguments)}return c}();e._maybeCleanUpUnconvertedSessionAfterEncryption=function(a){if(a==null)return(h||(h=b("Promise"))).resolve();var c=this._cache.SessionStore.get(a);c&&d("WAWebSignalConvertApi").shouldConvertSession(c.session)&&(d("WALogger").LOG(i()).tags("unified-store"),this._removeSessionImpl(a));return(h||(h=b("Promise"))).resolve()};e.maybeCleanUpUnconvertedSession=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield this._cache.Mutex.session.acquire());try{return yield this._maybeCleanUpUnconvertedSessionAfterEncryption(a)}finally{b.release()}});function c(b){return a.apply(this,arguments)}return c}();return a}();e=new a();g["default"]=e}),98);
__d("WAWebUsyncBackoff",["Promise","WALogger"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["usync: "," protocol: ","ms backoff ended"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["usync: "," protocol: ","ms backoff started"]);j=function(){return a};return a}var k=new Map();function a(a,c){d("WALogger").LOG(j(),a,c),k.set(a,new(h||(h=b("Promise")))(function(a){return self.setTimeout(a,c)}).then(function(){d("WALogger").LOG(i(),a,c)}))}function c(a){return!l(a)?(h||(h=b("Promise"))).resolve():(h||(h=b("Promise"))).all(a.protocols.map(function(a){return k.get(a.getName())}))}function l(a){if(a.context==="interactive")return!1;var b=a.protocols.map(function(a){return a.getName()});return b.includes("devices")&&(a.context==="message"||a.context==="voip")?!1:!0}g.setProtocolBackoffMs=a;g.waitForBackoff=c}),98);
__d("WAWebUsyncBotProfile",["WAWap"],(function(a,b,c,d,e,f,g){function a(a){var b;a.assertTag("bot");var c=a.maybeChild("error");if(c)return{errorCode:c.attrInt("code"),errorText:c.attrString("text")};c=a.child("profile");a=c.child("name");a=a.contentString();var d=c.child("attributes");d=d.contentString();var e=c.child("description");e=e.contentString();var f=c.child("category");f=f.contentString();var g=c.maybeChild("default");g=(g==null?void 0:g.contentString())==="true";var j=c.maybeChild("prompts");j=h(j);b=(b=c.maybeAttrString("persona_id"))!=null?b:"";c=c.maybeChild("commands");c=i(c);var k=c.commands;c=c.commandsDescription;return{name:a,attributes:d,description:e,category:f,isDefault:g,prompts:j,personaId:b,commands:k,commandsDescription:c}}function h(a){if(a==null)return[];var b=[];a.forEachChildWithTag("prompt",function(a){var c=a.maybeChild("emoji");c=(c=c==null?void 0:c.contentString())!=null?c:"";a=a.maybeChild("text");a=(a=a==null?void 0:a.contentString())!=null?a:"";b.push({emoji:c,text:a})});return b}function i(a){if(a==null)return{commands:[],commandsDescription:""};var b=[],c=a.maybeChild("description");c=(c=c==null?void 0:c.contentString())!=null?c:"";a.forEachChildWithTag("command",function(a){var c=a.maybeChild("name");c=(c=c==null?void 0:c.contentString())!=null?c:"";a=a.maybeChild("description");a=(a=a==null?void 0:a.contentString())!=null?a:"";b.push({name:c,description:a})});return{commands:b,commandsDescription:c}}b=function(){function a(){}var b=a.prototype;b.getName=function(){return"bot"};b.getQueryElement=function(){return d("WAWap").wap("bot",null,d("WAWap").wap("profile",{v:"1"}))};b.getUserElement=function(a){a=a.getPersonaId();return d("WAWap").wap("bot",null,d("WAWap").wap("profile",{persona_id:a!=null?d("WAWap").CUSTOM_STRING(a):d("WAWap").DROP_ATTR}))};return a}();g.botProfileParser=a;g.USyncBotProfileProtocol=b}),98);
__d("WAWebNonEmptyString",[],(function(a,b,c,d,e,f){function a(a){if(a!=="")return a}f.asMaybeNonEmptyString=a}),66);
__d("WAWebProtobufsVnameCert.pb",["$InternalEnum","WAProtoConst"],(function(a,b,c,d,e,f,g){c=(a=b("$InternalEnum"))({ENTERPRISE:0});e=a({ON_PREMISE:0,FACEBOOK:1});f=a({SELF:0,BSP:1});b=a({ON_PREMISE:0,FACEBOOK:1});a=a({UNKNOWN:0,LOW:1,HIGH:2});var h={},i={},j={},k={},l={},m={};h.internalSpec={lg:[1,(d=d("WAProtoConst")).TYPES.STRING],lc:[2,d.TYPES.STRING],verifiedName:[3,d.TYPES.STRING]};i.internalSpec={details:[1,d.TYPES.BYTES],signature:[2,d.TYPES.BYTES],serverSignature:[3,d.TYPES.BYTES]};j.internalSpec={serial:[1,d.TYPES.UINT64],issuer:[2,d.TYPES.STRING],verifiedName:[4,d.TYPES.STRING],localizedNames:[8,d.FLAGS.REPEATED|d.TYPES.MESSAGE,h],issueTime:[10,d.TYPES.UINT64]};k.internalSpec={vnameCert:[1,d.TYPES.MESSAGE,i],bizAcctLinkInfo:[2,d.TYPES.BYTES]};l.internalSpec={whatsappBizAcctFbid:[1,d.TYPES.UINT64],whatsappAcctNumber:[2,d.TYPES.STRING],issueTime:[3,d.TYPES.UINT64],hostStorage:[4,d.TYPES.ENUM,e],accountType:[5,d.TYPES.ENUM,c]};m.internalSpec={vlevel:[1,d.TYPES.ENUM,a],vnameCert:[2,d.TYPES.MESSAGE,i],signed:[3,d.TYPES.BOOL],revoked:[4,d.TYPES.BOOL],hostStorage:[5,d.TYPES.ENUM,b],actualActors:[6,d.TYPES.ENUM,f],privacyModeTs:[7,d.TYPES.UINT64],featureControls:[8,d.TYPES.UINT64]};g.BizAccountLinkInfo$AccountType=c;g.BizAccountLinkInfo$HostStorageType=e;g.BizIdentityInfo$ActualActorsType=f;g.BizIdentityInfo$HostStorageType=b;g.BizIdentityInfo$VerifiedLevelValue=a;g.LocalizedNameSpec=h;g.VerifiedNameCertificateSpec=i;g.VerifiedNameCertificate$DetailsSpec=j;g.BizAccountPayloadSpec=k;g.BizAccountLinkInfoSpec=l;g.BizIdentityInfoSpec=m}),98);
__d("WAWebValidateBusinessCertificate",["WAWebProtobufsVnameCert.pb","decodeProtobuf","err"],(function(a,b,c,d,e,f,g){var h="ent:wa",i="smb:wa";function a(a){return{serial:a.serial,name:a.verifiedName,isApi:a.issuer===h,isSmb:a.issuer===i}}function b(a){if(!a)return null;a=d("decodeProtobuf").decodeProtobuf(d("WAWebProtobufsVnameCert.pb").VerifiedNameCertificateSpec,a);if(!a.details)throw c("err")("verifyCertificate cert missing details");var b=d("decodeProtobuf").decodeProtobuf(d("WAWebProtobufsVnameCert.pb").VerifiedNameCertificate$DetailsSpec,a.details);return{cert:a,details:b}}g.extractCertificateDetailsParams=a;g.getParsedProtoObjects=b}),98);
__d("WAWebCommonParsersVerifiedName",["WAWebHandleMsgCommon","WAWebHandleMsgTypes.flow","WAWebNonEmptyString","WAWebValidateBusinessCertificate"],(function(a,b,c,d,e,f,g){function h(a){a=d("WAWebValidateBusinessCertificate").getParsedProtoObjects(a);if(a==null?void 0:a.details){a=d("WAWebValidateBusinessCertificate").extractCertificateDetailsParams(a.details);var b=a.name,c=a.serial,e=a.isApi;a=a.isSmb;return{name:b,serial:String(c),isApi:e,isSmb:a}}}function a(a){var b=a.attrEnum("verified_level",d("WAWebHandleMsgCommon").MSG_VERIFIED_LEVEL),c=a.hasContent()?a.contentBytes():null,e=d("WAWebNonEmptyString").asMaybeNonEmptyString(a.maybeAttrString("serial"));c=c&&h(c)||{};var f=c.serial,g=c.name,i=c.isApi;c=c.isSmb;var j=d("WAWebHandleMsgTypes.flow").ActualActorsEnumType.cast(a.maybeAttrInt("actual_actors")),k=d("WAWebHandleMsgTypes.flow").HostStorageEnumType.cast(a.maybeAttrInt("host_storage"));a=a.maybeAttrInt("privacy_mode_ts");j=j!=null&&k!=null&&a!=null?{actualActors:j,hostStorage:k,privacyModeTs:a}:null;return{level:b,serial:e!=null?e:f,name:g,isApi:i===!0,isSmb:c===!0,privacyMode:j}}g["default"]=a}),98);
__d("WAWebUsyncBusiness",["WAWap","WAWebCommonParsersVerifiedName"],(function(a,b,c,d,e,f,g){function a(a){a.assertTag("business");var b=a.maybeChild("error");if(b)return{errorCode:b.attrInt("code"),errorText:b.attrString("text")};b=a.maybeChild("verified_name");a=b?c("WAWebCommonParsersVerifiedName")(b):null;return{verifiedName:a}}b=function(){function a(){}var b=a.prototype;b.getName=function(){return"business"};b.getQueryElement=function(){return d("WAWap").wap("business",null,d("WAWap").wap("verified_name",null))};b.getUserElement=function(a){return null};return a}();g.businessParser=a;g.USyncBusinessProtocol=b}),98);
__d("WAWebUsyncContact",["WAWap"],(function(a,b,c,d,e,f,g){function a(a){a.assertTag("contact");var b=a.maybeChild("error");if(b)return{errorCode:b.attrInt("code"),errorText:b.attrString("text")};b={type:a.attrString("type")};var c=a.hasAttr("username");c&&(b.username=a.attrString("username"));return b}b=function(){function a(){}var b=a.prototype;b.getName=function(){return"contact"};b.getQueryElement=function(){return d("WAWap").wap("contact",null)};b.getUserElement=function(a){var b=a.getPhone(),c=a.getUsername();a=a.getType();if(b!=null)return d("WAWap").wap("contact",null,b);else if(c!=null)return d("WAWap").wap("contact",{username:d("WAWap").CUSTOM_STRING(c)});else if(a!=null)return d("WAWap").wap("contact",{type:d("WAWap").CUSTOM_STRING(a)});return null};return a}();g.contactParser=a;g.USyncContactProtocol=b}),98);
__d("WAWebUsyncDevice",["WAWap"],(function(a,b,c,d,e,f,g){var h=2;function a(a){a.assertTag("devices");var b=a.maybeChild("error");if(b)return{errorCode:b.attrInt("code"),errorText:b.attrString("text")};b=a.maybeChild("key-index-list");a=a.maybeChild("device-list");b=b==null?null:{ts:b.attrTime("ts"),signedKeyIndexBytes:b.hasContent()?b.contentBytes():null,expectedTs:b.hasAttr("expected_ts")?b.attrTime("expected_ts"):void 0};a=a==null?void 0:a.mapChildrenWithTag("device",function(a){a={id:a.attrInt("id"),keyIndex:a.hasAttr("key-index")?a.attrInt("key-index"):null};return a});return{deviceList:a,keyIndex:b}}b=function(){function a(){}var b=a.prototype;b.getName=function(){return"devices"};b.getQueryElement=function(){return d("WAWap").wap("devices",{version:d("WAWap").CUSTOM_STRING(String(h))})};b.getUserElement=function(a){var b=a.getDeviceHash(),c=a.getTs();a=a.getExpectedTs();return!b&&c==null&&a==null?null:d("WAWap").wap("devices",{device_hash:b?d("WAWap").CUSTOM_STRING(b):d("WAWap").DROP_ATTR,ts:c!=null?d("WAWap").INT(c):d("WAWap").DROP_ATTR,expected_ts:a!=null?d("WAWap").INT(a):d("WAWap").DROP_ATTR})};return a}();g.deviceParser=a;g.USyncDeviceProtocol=b}),98);
__d("WAWebUsyncDisappearingMode",["WAWap"],(function(a,b,c,d,e,f,g){function a(a){a.assertTag("disappearing_mode");var b=a.maybeChild("error");if(b)return{errorCode:b.attrInt("code"),errorText:b.attrString("text")};b=a.attrInt("duration",0);a=a.attrInt("t");return{duration:b,t:a}}b=function(){function a(){}var b=a.prototype;b.getName=function(){return"disappearing_mode"};b.getQueryElement=function(){return d("WAWap").wap("disappearing_mode",null)};b.getUserElement=function(a){return null};return a}();g.disappearingModeParser=a;g.USyncDisappearingModeProtocol=b}),98);
__d("WAWebUsyncFeature",["WAWap","err"],(function(a,b,c,d,e,f,g){var h={document:(b=d("WAWap")).wap("document",null),encrypt:b.wap("encrypt",null),encrypt_blist:b.wap("encrypt_blist",null),encrypt_contact:b.wap("encrypt_contact",null),encrypt_group_gen2:b.wap("encrypt_group_gen2",null),encrypt_image:b.wap("encrypt_image",null),encrypt_location:b.wap("encrypt_location",null),encrypt_url:b.wap("encrypt_url",null),encrypt_v2:b.wap("encrypt_v2",null),voip:b.wap("voip",null),multi_agent:b.wap("multi_agent",null)};function a(a){a.assertTag("feature");var b=a.maybeChild("error");if(b)return{errorCode:b.attrInt("code"),errorText:b.attrString("text")};var c={};Object.keys(h).forEach(function(b){var d=a.maybeChild(b);d&&(c[b]=d.attrString("value"))});return c}e=function(){var a=b.prototype;a.getName=function(){return"picture"};function b(a){this.queries=a;if(a.length===0)throw c("err")("must specify at least one query")}a.getQueryElement=function(){return d("WAWap").wap("feature",null,this.queries&&this.queries.map(function(a){return h[a]}))};a.getUserElement=function(a){return null};return b}();g.featureParser=a;g.USyncFeaturesProtocol=e}),98);
__d("WAWebUsyncLid",["WAWap","WAWebCommsWapMd"],(function(a,b,c,d,e,f,g){function a(a){a.assertTag("lid");var b=a.maybeChild("error");return b?{errorCode:b.attrInt("code"),errorText:b.attrString("text")}:a.maybeAttrLidUserJid("val")}b=function(){function a(){}var b=a.prototype;b.getName=function(){return"lid"};b.getQueryElement=function(){return d("WAWap").wap("lid",null)};b.getUserElement=function(a){a=a.getLid();return!a?null:d("WAWap").wap("lid",{jid:a?d("WAWebCommsWapMd").USER_JID(a):d("WAWap").DROP_ATTR})};return a}();g.lidParser=a;g.USyncLidProtocol=b}),98);
__d("WAWebUsyncPicture",["WAWap"],(function(a,b,c,d,e,f,g){function a(a){a.assertTag("picture");var b=a.maybeChild("error");return b?{errorCode:b.attrInt("code"),errorText:b.attrString("text")}:{id:a.attrInt("id")}}b=function(){function a(){}var b=a.prototype;b.getName=function(){return"picture"};b.getQueryElement=function(){return d("WAWap").wap("picture",null)};b.getUserElement=function(a){return null};return a}();g.pictureParser=a;g.USyncPictureProtocol=b}),98);
__d("WAWebUsyncStatus",["WAWap"],(function(a,b,c,d,e,f,g){var h=null;function a(a){a.assertTag("status");var b=a.maybeChild("error");if(b)return{errorCode:b.attrInt("code"),errorText:b.attrString("text")};return!a.hasContent()?a.hasAttr("code")&&a.attrInt("code")===401?"":h:a.contentString().length!==0?a.contentString():h}b=function(){function a(){}var b=a.prototype;b.getName=function(){return"status"};b.getQueryElement=function(){return d("WAWap").wap("status",null)};b.getUserElement=function(a){return null};return a}();g.statusParser=a;g.USyncStatusProtocol=b}),98);
__d("WAWebUsyncTextStatus",["WAWap"],(function(a,b,c,d,e,f,g){function a(a){a.assertTag("text_status");var b=a.maybeChild("error");if(b)return{errorCode:b.attrInt("code"),errorText:b.attrString("text")};b=a.hasAttr("text")?a.attrString("text"):void 0;var c=a.hasChild("emoji")?a.child("emoji"):void 0;c=(c==null?void 0:c.hasAttr("content"))?c==null?void 0:c.attrString("content"):void 0;var d=a.hasAttr("ephemeral_duration_sec")?a.attrInt("ephemeral_duration_sec"):void 0;a=a.hasAttr("last_update_time")?a.attrString("last_update_time"):void 0;return{text:b,emoji:c,ephemeralDurationSeconds:d,lastUpdateTime:a}}b=function(){function a(){}var b=a.prototype;b.getName=function(){return"text_status"};b.getQueryElement=function(){return d("WAWap").wap("text_status",null)};b.getUserElement=function(a){return null};return a}();g.textStatusParser=a;g.USyncTextStatusProtocol=b}),98);
__d("WAWebUsyncUsername",["WAWap"],(function(a,b,c,d,e,f,g){function a(a){a.assertTag("username");var b=a.maybeChild("error");if(b)return{errorCode:b.attrInt("code"),errorText:b.attrString("text")};return a.hasContent()?a.contentString():null}b=function(){function a(){}var b=a.prototype;b.getName=function(){return"username"};b.getQueryElement=function(){return d("WAWap").wap("username",null)};b.getUserElement=function(a){return null};return a}();g.usernameParser=a;g.USyncUsernameProtocol=b}),98);
__d("WAWebUsync",["WADeprecatedSendIq","WADeprecatedWapParser","WALogger","WAWap","WAWebCommsWapMd","WAWebJidToWid","WAWebUsyncBackoff","WAWebUsyncBotProfile","WAWebUsyncBusiness","WAWebUsyncContact","WAWebUsyncDevice","WAWebUsyncDisappearingMode","WAWebUsyncFeature","WAWebUsyncLid","WAWebUsyncPicture","WAWebUsyncStatus","WAWebUsyncTextStatus","WAWebUsyncUsername","WAWebWid","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Usync success:"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["usync: ready to query for ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Usync warning: a usync query must have at least one user"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["usync query success!"]);k=function(){return a};return a}var l={FEATURE:"feature",DEVICE:"devices",CONTACT:"contact",PICTURE:"picture",STATUS:"status",BUSINESS:"business",DISAPPEARING_MODE:"disappearing_mode",LID:"lid",BOT:"bot",USERNAME:"username",TEXT_STATUS:"text_status"},m={feature:d("WAWebUsyncFeature").featureParser,devices:d("WAWebUsyncDevice").deviceParser,contact:d("WAWebUsyncContact").contactParser,picture:d("WAWebUsyncPicture").pictureParser,status:d("WAWebUsyncStatus").statusParser,business:d("WAWebUsyncBusiness").businessParser,disappearing_mode:d("WAWebUsyncDisappearingMode").disappearingModeParser,lid:d("WAWebUsyncLid").lidParser,bot:d("WAWebUsyncBotProfile").botProfileParser,username:d("WAWebUsyncUsername").usernameParser,text_status:d("WAWebUsyncTextStatus").textStatusParser};function n(a){var b=[];a.forEachChildWithTag("user",function(a){var c={};if(!a.hasAttr("jid"))return;Object.keys(l).forEach(function(b){b=l[b];var d=a.maybeChild(b);d&&m[b]&&(c[b]=m[b](d))});c.id=d("WAWebJidToWid").deviceJidToUserWid(a.attrDeviceJid("jid"));b.push(c)});return b}var o=new(c("WADeprecatedWapParser"))("usyncParser",function(a){a.assertAttr("type","result");var b={error:{},refresh:{},list:[],sideList:[]};a=a.child("usync");var c=a.child("result"),e=a.child("list");a=a.maybeChild("side_list");Object.keys(l).forEach(function(a){a=l[a];var d=c.maybeChild(a);if(d){var e=d.maybeChild("error");e?b.error[a]={errorCode:e.attrInt("code"),errorText:e.attrString("text"),errorBackoff:e.attrInt("backoff")}:d.hasAttr("refresh")&&(b.refresh[a]=d.attrInt("refresh",0))}});b.list=n(e);a&&(b.sideList=n(a));d("WALogger").LOG(k());return b});a=function(){function a(){this.context="interactive",this.mode="query",this.protocols=[],this.users=[]}var e=a.prototype;e.withMode=function(a){this.mode=a;return this};e.withContext=function(a){this.context=a;return this};e.withContactProtocol=function(){this.protocols.push(new(d("WAWebUsyncContact").USyncContactProtocol)());return this};e.withBusinessProtocol=function(){this.protocols.push(new(d("WAWebUsyncBusiness").USyncBusinessProtocol)());return this};e.withDeviceProtocol=function(){this.protocols.push(new(d("WAWebUsyncDevice").USyncDeviceProtocol)());return this};e.withDisappearingModeProtocol=function(){this.protocols.push(new(d("WAWebUsyncDisappearingMode").USyncDisappearingModeProtocol)());return this};e.withPictureProtocol=function(){this.protocols.push(new(d("WAWebUsyncPicture").USyncPictureProtocol)());return this};e.withStatusProtocol=function(){this.protocols.push(new(d("WAWebUsyncStatus").USyncStatusProtocol)());return this};e.withTextStatusProtocol=function(){this.protocols.push(new(d("WAWebUsyncTextStatus").USyncTextStatusProtocol)());return this};e.withFeaturesProtocol=function(a){this.protocols.push(new(d("WAWebUsyncFeature").USyncFeaturesProtocol)(a));return this};e.withLidProtocol=function(){this.protocols.push(new(d("WAWebUsyncLid").USyncLidProtocol)());return this};e.withBotProfileProtocol=function(){this.protocols.push(new(d("WAWebUsyncBotProfile").USyncBotProfileProtocol)());return this};e.withUser=function(a){this.users.push(a);return this};e.withUsernameProtocol=function(){this.protocols.push(new(d("WAWebUsyncUsername").USyncUsernameProtocol)());return this};e.$1=function(){var a=this;if(this.protocols.length===0)throw c("err")("a usync query must have at least one protocol");var b=this.users.filter(function(a){var b=a.getId();return b&&c("WAWebWid").isServer(b)?!1:a.validate()});b.length===0&&d("WALogger").WARN(j());var e=d("WAWap").wap("query",null,this.protocols.map(function(a){return a.getQueryElement()}));b=b.map(function(b){var c=b.getId();return d("WAWap").wap("user",{jid:c?d("WAWebCommsWapMd").USER_JID(c):d("WAWap").DROP_ATTR},a.protocols.map(function(a){return a.getUserElement(b)}))});b=d("WAWap").wap("list",null,b);return d("WAWap").wap("iq",{to:d("WAWap").S_WHATSAPP_NET,xmlns:"usync",type:"get",id:d("WAWap").generateId()},d("WAWap").wap("usync",{sid:d("WAWap").generateId(),index:"0",last:"true",mode:d("WAWap").CUSTOM_STRING(this.mode),context:d("WAWap").CUSTOM_STRING(this.context)},e,b))};e.execute=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=this.$1();d("WALogger").DEV(i(),this.protocols.map(function(a){return a.getName()}));yield d("WAWebUsyncBackoff").waitForBackoff(this);a=(yield d("WADeprecatedSendIq").deprecatedSendIq(a,o));if(a.success){d("WALogger").DEV(h()).devConsole(a.result);p(a.result);return a.result}return{error:{all:{errorCode:a.errorCode,errorText:a.errorText,errorType:a.errorType}},refresh:{},list:[]}});function c(){return a.apply(this,arguments)}return c}();return a}();function p(a){Object.values(l).forEach(function(b){var c=a.error[b];if(c==null)return;c.errorBackoff!=null&&d("WAWebUsyncBackoff").setProtocolBackoffMs(b,c.errorBackoff*1e3)})}g.USyncQuery=a}),98);
__d("WAWebUsyncUser",["WALogger","WAWebWidValidator","err"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["USync user created with invalid jid: ",""]);h=function(){return a};return a}a=function(){function a(){}var b=a.prototype;b.withId=function(a){this.$1=a;return this};b.withLid=function(a){this.$2=a;return this};b.withDeviceHash=function(a){this.$4=a;return this};b.withTs=function(a){this.$5=a;return this};b.withExpectedTs=function(a){this.$6=a;return this};b.withPhone=function(a){this.$3=a;return this};b.withPersonaId=function(a){this.$7=a;return this};b.withUsername=function(a){this.$8=a;return this};b.withType=function(a){this.$9=a;return this};b.getDeviceHash=function(){return this.$4};b.getPhone=function(){return this.$3};b.getId=function(){return this.$1};b.getLid=function(){return this.$2};b.getTs=function(){return this.$5};b.getExpectedTs=function(){return this.$6};b.getPersonaId=function(){return this.$7};b.getUsername=function(){return this.$8};b.getType=function(){return this.$9};b.validate=function(){var a=this.$1,b=this.$3,e=this.$8;if(a==null&&b==null&&e==null)throw c("err")("user must have an id, phone or a username");else if(a){b=d("WAWebWidValidator").validateWid(a.toString());b||d("WALogger").WARN(h(),a.toString());return b}return!0};return a}();g.USyncUser=a}),98);
__d("WAWebAdvSyncDeviceListApi",["Promise","WALogger","WAWebAdvHandlerApi","WAWebApiDeviceList","WAWebDeviceListPk","WAWebGetIdentityKeysJob","WAWebPhashUtils","WAWebUserPrefsMeUser","WAWebUsync","WAWebUsyncUser","WAWebWidFactory","asyncToGeneratorRuntime","err","lodash"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncDeviceList: skipping "," out of "," records"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncDeviceList: error ",": ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["adv: sync my device list complete"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["adv: sync my device list begin"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to sync device list with error: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["adv: begin syncDeviceList for ",""]);n=function(){return a};return a}var o=new Map();function p(a){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=a.wids,f=a.context;a=a.phash;d("WALogger").DEV(n(),e.slice(0,3).join(",")+(e.length>3?"...":""));if(a!=null){var g=(yield d("WAWebApiDeviceList").getDeviceIds(e));g=g.map(function(a){return a==null?[]:a.devices.map(function(b){return d("WAWebWidFactory").createDeviceWidFromDeviceListPk(a.id,b.id,b.isHosted)})});g=c("lodash").flatMap(g,function(a){return a});g=(yield d("WAWebPhashUtils").phashV2(g));if(a===g)return}var i=new Set(),j=[];e.forEach(function(a){var b=o.get(d("WAWebDeviceListPk").createDeviceListPK(a));b?i.add(b):j.push(a)});if(j.length===0){yield (h||(h=b("Promise"))).all(Array.from(i));return}var k=r(j,f);j.map(function(a){o.set(d("WAWebDeviceListPk").createDeviceListPK(a),k)});yield (h||(h=b("Promise"))).all([k].concat(Array.from(i)))});return q.apply(this,arguments)}function r(a,b){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){try{var e=(yield d("WAWebApiDeviceList").getDeviceInfoForSync(a)),f=e.map(function(a){return a==null?[]:a.devices.map(function(b){return d("WAWebWidFactory").createDeviceWidFromDeviceListPk(a.id,b.id,b.isHosted)})}),g=(yield (h||(h=b("Promise"))).all(f.map(function(a){return a.length===0?"":d("WAWebPhashUtils").phashV2(a)})));f=a.map(function(a,b){return{id:a,hash:g[b],ts:(a=e[b])==null?void 0:a.timestamp,expectedTs:(a=e[b])==null?void 0:a.expectedTs}});return v(f,c)}catch(a){d("WALogger").ERROR(m(),a)}finally{a.map(function(a){o["delete"](d("WAWebDeviceListPk").createDeviceListPK(a))})}});return s.apply(this,arguments)}function a(){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){d("WALogger").DEV(l()),yield p({wids:d("WAWebUserPrefsMeUser").getMePNandLIDWids(),context:null,phash:null}),d("WALogger").DEV(k())});return t.apply(this,arguments)}function e(a){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield p({wids:a,context:null,phash:null});return d("WAWebApiDeviceList").getDeviceIds(a)});return u.apply(this,arguments)}function v(a,b){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(a.length===0)return;var e=new(d("WAWebUsync").USyncQuery)().withContext(b||"interactive").withDeviceProtocol();a.forEach(function(a){a.id.user!==0&&e.withUser(new(d("WAWebUsyncUser").USyncUser)().withId(a.id).withDeviceHash(String(a.hash)).withTs(a.ts).withExpectedTs(a.expectedTs))});b=(yield e.execute());if(b.error.all)throw c("err")("syncDeviceList: error "+b.error.all.errorCode+": "+b.error.all.errorText);b.error.devices&&d("WALogger").WARN(j(),b.error.devices.errorCode,b.error.devices.errorText);a=b.list.filter(function(a){return!("errorCode"in a.devices)});a=a.map(function(a){return{wid:a.id,devices:a.devices}});var f=a.filter(function(a){return(a=a.devices.keyIndex)==null?void 0:a.signedKeyIndexBytes}).map(function(a){return a.wid});d("WALogger").LOG(i(),b.list.length-f.length,b.list.length);yield d("WAWebGetIdentityKeysJob").getAndStoreIdentityKeys(f);return d("WAWebAdvHandlerApi").handleADVDeviceSyncResult(a)});return w.apply(this,arguments)}g.syncDeviceList=p;g.syncMyDeviceList=a;g.syncAndGetDeviceList=e}),98);
__d("WAWebHandlePrivacyModeChange",["WALogger","WAWebApiChat","WAWebApiVerifiedBusinessName","WAWebBackendApi","WAWebBizUpdateVerifiedInfoAction","WAWebBusinessProfileTypes","WAWebCreateChat","WAWebHandlePrivacyModeUpdateMsgAction","WAWebMiscGatingUtils","WAWebPnhGatingUtils","WAWebPrivacyModeSystemMsg","WAWebRuntimeEnvironmentUtils","WAWebUserPrefsMeUser","WAWebWorkerSafeBackendApi","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["handlePrivacyModeChange for ",", failed with error: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handlePrivacyModeChange for ",", unable to restore chat from DB"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["handlePrivacyModeChange for ",", failed with error: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["handlePrivacyModeChange: failed to update biz privacy status with error ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["query contact info on new chat failed"]);l=function(){return a};return a}function a(a,b,c,d){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e,f){var g=c.chat;if(!g.isUser())return;d("WAWebPnhGatingUtils").isMatFullyEnabled()&&(g=(yield d("WAWebApiChat").getMatChat(g)));var h=(yield s(g)),i=d("WAWebPrivacyModeSystemMsg").getLatestPrivacyMode(e.privacyMode,h.privacyMode),m=function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield d("WAWebCreateChat").createChat(g,"createChatOnNewMsg",{createdLocally:!1,lidOriginType:g.isLid()&&(f==null?void 0:f.origin)!=null?f==null?void 0:f.origin:void 0},{firstIncomingMsg:a[0],nextPrivacyMode:i})});return function(){return c.apply(this,arguments)}}();m=(yield q(g,m));var n=m!==!0||d("WAWebMiscGatingUtils").queryVerifiedNameWhenMsgDiffers()&&h.verifiedLevel!==d("WAWebBusinessProfileTypes").convertLevel(e.verifiedLevel);try{m&&i!=null&&(yield d("WAWebHandlePrivacyModeUpdateMsgAction").handlePrivacyModeTransition(g,i));h=function(){n&&d("WAWebBizUpdateVerifiedInfoAction").queryAndUpdateContactPropertiesOnNewChat(g)["catch"](function(a){d("WALogger").WARN(l())}),!d("WAWebUserPrefsMeUser").isMeAccount(c.author)&&i!=null&&d("WAWebWorkerSafeBackendApi").workerSafeSendAndReceive("updateBizPrivacyStatus",{msgIds:a.map(function(a){return a.id}),privacyMode:i})["catch"](function(a){d("WALogger").ERROR(k(),a)})};return h}catch(a){d("WALogger").ERROR(j(),g.toLogString(),a).tags("messaging","non-sad").sendLogs("handlePrivacyModeChange failed",.001)}});return m.apply(this,arguments)}function n(a){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){return!d("WAWebRuntimeEnvironmentUtils").isWorker()?d("WAWebBackendApi").frontendSendAndReceive("hasChat",{chatId:a}):(yield d("WAWebApiChat").getChatRecord(a))!=null});return o.apply(this,arguments)}var p=new Map();function q(a,b){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){var e=a.toString(),f=p.get(e);f!=null&&(yield f);f=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=(yield n(a));if(b!==!0)try{yield c()}catch(b){if(!d("WAWebRuntimeEnvironmentUtils").isWorker()&&b instanceof d("WAWebApiChat").CreateChatDuplicateError){var f=(yield d("WAWebApiChat").getChatRecord(a));if(f!=null){yield d("WAWebBackendApi").frontendFireAndForget("chatCollectionGadd",{chat:babelHelpers["extends"]({},f,{id:a})});f=(yield n(a));f||d("WALogger").ERROR(i(),a.toLogString()).tags("messaging").sendLogs("handlePrivacyModeChange failed to restore chat",.01);return f}}d("WALogger").ERROR(h(),a.toLogString(),b).tags("messaging").sendLogs("handlePrivacyModeChange failed",.001)}p["delete"](e);return b})();p.set(e,f);return f});return r.apply(this,arguments)}function s(a){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(!d("WAWebRuntimeEnvironmentUtils").isWorker())return d("WAWebWorkerSafeBackendApi").workerSafeSendAndReceive("getChatPrivacyInfoOnNewMsg",{chatId:a});a=(yield d("WAWebApiVerifiedBusinessName").getVerifiedBusinessNameRecord(a));return{privacyMode:(a==null?void 0:a.privacyMode)!=null?d("WAWebApiVerifiedBusinessName").convertPrivacyModeFromStorageType(a.privacyMode):null,verifiedLevel:d("WAWebBusinessProfileTypes").convertLevel(a==null?void 0:a.level)}});return t.apply(this,arguments)}g.handlePrivacyModeChangeAndCreateChat=a}),98);
__d("WAWebWamEnumOfflineProcessRunReasons",[],(function(a,b,c,d,e,f){a=Object.freeze({PUSH_NOTIFICATION:1,PERIODIC_BACKGROUND_SYNC:2});f.OFFLINE_PROCESS_RUN_REASONS=a}),66);
__d("WAWebWamEnumOfflineProcessStages",[],(function(a,b,c,d,e,f){a=Object.freeze({PAGE_LOAD:1,SOCKET_CONNECT:2,OFFLINE_PREVIEW:3,PROCESSING:4,PROCESS_COMPLETE:5,PROCESS_INTERRUPTED:6});f.OFFLINE_PROCESS_STAGES=a}),66);
__d("WAWebWebcOfflineNotificationProcessWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumOfflineProcessRunReasons","WAWebWamEnumOfflineProcessStages"],(function(a,b,c,d,e,f,g){b=(a=d("WAWebWamCodegenUtils")).defineEvents({WebcOfflineNotificationProcess:[4222,{currentOfflineProcessStage:[4,d("WAWebWamEnumOfflineProcessStages").OFFLINE_PROCESS_STAGES],offlineProcessDecryptErrorCount:[5,a.TYPES.INTEGER],offlineProcessMailboxAge:[6,a.TYPES.INTEGER],offlineProcessMessageCount:[7,a.TYPES.INTEGER],offlineProcessNotificationCount:[8,a.TYPES.INTEGER],offlineProcessSessionId:[9,a.TYPES.STRING],offlineProcessStageTimestampMs:[10,a.TYPES.INTEGER],runReason:[12,d("WAWebWamEnumOfflineProcessRunReasons").OFFLINE_PROCESS_RUN_REASONS],swVersion:[11,a.TYPES.STRING]},[1,1,1],"regular"]});g.WebcOfflineNotificationProcessWamEvent=b}),98);
__d("WAWebWamWorkerOfflineProcessReporter",["WAHex","WALogger","WAShiftTimer","WATimeUtils","WAWebBuildConstants","WAWebRuntimeEnvironmentUtils","WAWebUserPrefsGeneral","WAWebUserPrefsMultiDevice","WAWebWamEnumOfflineProcessRunReasons","WAWebWamEnumOfflineProcessStages","WAWebWamOfflineResumeReporter","WAWebWebcOfflineNotificationProcessWamEvent","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][worker] worker offline processing ends\n        ========= worker offline processing perf ==========\n        message: ","\n        receipt: ","\n        notification: ","\n        ProcessedMessage: ","\n        ProcessedNotification: ","\n        decryptError: ","\n        pageLoadT: 0\n        socketConnectT: ","\n        offlinePreviewT: ","\n        processCompleteT: ","\n        mailboxAge: ","\n        isInterrupted: ","\n        runReason: ","\n        ===================================================\n        "]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose([" [offline-resume][worker] worker offline processing takes too long"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][worker] worker offline processing progress updates\n          ======= worker offline processing update ========\n          ProcessedMessage: ","\n          ProcessedNotification: ","\n          currentProcessingT: ","\n          =================================================\n         "]);j=function(){return a};return a}var k=1e4,l=12e4;a=function(){function a(){this.$7=null,this.$1=this.$13(),this.$2=d("WAWebWamEnumOfflineProcessRunReasons").OFFLINE_PROCESS_RUN_REASONS.PUSH_NOTIFICATION,this.pageLoadT=self.performance.now(),this.$3=0,this.$4=0,this.$5=0,this.$6=0,this.$8=0,this.$9=0,this.$10=0}var c=a.prototype;c.$13=function(){return""+d("WAHex").randomHex(4)+d("WATimeUtils").unixTimeWithoutClockSkewCorrection()};c.$14=function(a,b){b=new(d("WAWebWebcOfflineNotificationProcessWamEvent").WebcOfflineNotificationProcessWamEvent)({offlineProcessSessionId:this.$1,offlineProcessStageTimestampMs:b,currentOfflineProcessStage:a,swVersion:d("WAWebBuildConstants").VERSION_BASE,runReason:this.$2});(a===d("WAWebWamEnumOfflineProcessStages").OFFLINE_PROCESS_STAGES.PROCESSING||a===d("WAWebWamEnumOfflineProcessStages").OFFLINE_PROCESS_STAGES.PROCESS_COMPLETE||a===d("WAWebWamEnumOfflineProcessStages").OFFLINE_PROCESS_STAGES.PROCESS_INTERRUPTED)&&this.$15(b);a===d("WAWebWamEnumOfflineProcessStages").OFFLINE_PROCESS_STAGES.PROCESS_COMPLETE||a===d("WAWebWamEnumOfflineProcessStages").OFFLINE_PROCESS_STAGES.PROCESS_INTERRUPTED?void b.commitAndWaitForFlush(!0):b.commit()};c.$15=function(a){var b;a.offlineProcessMessageCount=d("WAWebWamOfflineResumeReporter").roundUp((b=this.$9)!=null?b:0,10);a.offlineProcessNotificationCount=d("WAWebWamOfflineResumeReporter").roundUp((b=this.$10)!=null?b:0,10);a.offlineProcessMailboxAge=d("WAWebWamOfflineResumeReporter").countDays((b=this.$6)!=null?b:0);a.offlineProcessDecryptErrorCount=(b=this.$8)!=null?b:0};c.$16=function(){var a=this;this.$7==null&&(this.$7=new(d("WAShiftTimer").ShiftTimer)(function(){if(a.$11!==d("WAWebWamEnumOfflineProcessStages").OFFLINE_PROCESS_STAGES.PROCESSING)return;var b=Math.floor(self.performance.now()-a.pageLoadT);d("WALogger").LOG(j(),a.$9,a.$10,b);if(b>l){d("WALogger").ERROR(i()).sendLogs("worker-offline-process-takes-too-long");return}a.$14(d("WAWebWamEnumOfflineProcessStages").OFFLINE_PROCESS_STAGES.PROCESSING,b);a.$16()}));this.$7.onOrAfter(k)};c.$17=function(){var a;this.$11=d("WAWebWamEnumOfflineProcessStages").OFFLINE_PROCESS_STAGES.PROCESSING;(a=this.$7)==null?void 0:a.cancel();this.$16()};c.$18=function(a){a===void 0&&(a=-1),d("WALogger").LOG(h(),this.$3,this.$4,this.$5,this.$9,this.$10,this.$8,this.socketConnectT,this.offlinePreviewT,this.processCompleteT,a,this.$11===d("WAWebWamEnumOfflineProcessStages").OFFLINE_PROCESS_STAGES.PROCESS_INTERRUPTED,this.$2)};c.getCurrentStage=function(){return this.$11};c.updateOldestStanzaTime=function(a){(this.$6==null||this.$6>a)&&(this.$6=a)};c.updateOfflineCount=function(a){this.$3=a.message,this.$4=a.receipt,this.$5=a.notification};c.updateOfflineDecryptionErrorCount=function(a){this.$8=a};c.updateProcessedMessageCount=function(){d("WAWebRuntimeEnvironmentUtils").isWorker()&&(this.$9+=1)};c.updateProcessedNotificationCount=function(){d("WAWebRuntimeEnvironmentUtils").isWorker()&&(this.$10+=1)};c.logWorkerInitialized=function(a){this.$11=d("WAWebWamEnumOfflineProcessStages").OFFLINE_PROCESS_STAGES.PAGE_LOAD,this.$2=a,this.$14(d("WAWebWamEnumOfflineProcessStages").OFFLINE_PROCESS_STAGES.PAGE_LOAD,0)};c.logSocketConnect=function(){this.$11=d("WAWebWamEnumOfflineProcessStages").OFFLINE_PROCESS_STAGES.SOCKET_CONNECT;var a=Math.floor(self.performance.now()-this.pageLoadT);this.socketConnectT=a;this.$14(d("WAWebWamEnumOfflineProcessStages").OFFLINE_PROCESS_STAGES.SOCKET_CONNECT,a)};c.logOfflinePreview=function(){this.$11=d("WAWebWamEnumOfflineProcessStages").OFFLINE_PROCESS_STAGES.OFFLINE_PREVIEW;var a=Math.floor(self.performance.now()-this.pageLoadT);this.offlinePreviewT=a;this.$14(d("WAWebWamEnumOfflineProcessStages").OFFLINE_PROCESS_STAGES.OFFLINE_PREVIEW,a);this.$17()};c.logProcessComplete=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a;if(this.$11===d("WAWebWamEnumOfflineProcessStages").OFFLINE_PROCESS_STAGES.PROCESS_COMPLETE||this.$11===d("WAWebWamEnumOfflineProcessStages").OFFLINE_PROCESS_STAGES.PROCESS_INTERRUPTED)return;this.$11=d("WAWebWamEnumOfflineProcessStages").OFFLINE_PROCESS_STAGES.PROCESS_COMPLETE;(a=this.$7)==null?void 0:a.cancel();this.$7=null;a=d("WAWebWamOfflineResumeReporter").countDays(this.$6);yield d("WAWebUserPrefsMultiDevice").setRecentMailboxAgeDays(a);var b=Math.floor(self.performance.now()-this.pageLoadT);this.processCompleteT=b;this.$18(a);this.$14(d("WAWebWamEnumOfflineProcessStages").OFFLINE_PROCESS_STAGES.PROCESS_COMPLETE,b);void d("WAWebUserPrefsGeneral").setLastPushCompleteTimestamp(d("WATimeUtils").unixTimeMs())});function c(){return a.apply(this,arguments)}return c}();c.logProcessInterrupted=function(){var a;if(this.$11==null||this.$11===d("WAWebWamEnumOfflineProcessStages").OFFLINE_PROCESS_STAGES.PROCESS_COMPLETE||this.$11===d("WAWebWamEnumOfflineProcessStages").OFFLINE_PROCESS_STAGES.PROCESS_INTERRUPTED)return;this.$11=d("WAWebWamEnumOfflineProcessStages").OFFLINE_PROCESS_STAGES.PROCESS_INTERRUPTED;(a=this.$7)==null?void 0:a.cancel();this.$7=null;a=Math.floor(self.performance.now()-this.pageLoadT);this.processCompleteT=a;this.$18();this.$14(d("WAWebWamEnumOfflineProcessStages").OFFLINE_PROCESS_STAGES.PROCESS_INTERRUPTED,a)};return a}();c=new a();g.WorkerOfflineResumeReporter=c}),98);
__d("WAWebMessageProcessPlaceholder",["Promise","WALogger","WAWebApiDeviceList","WAWebBackendApi","WAWebBizCoexGatingUtils","WAWebCmd","WAWebHandleMsgCommon","WAWebHandleMsgTypes.flow","WAWebMessageProcessorCache","WAWebMsgProcessingApiUtils","WAWebMsgType","WAWebPnhGatingUtils","WAWebProcessMatMessages","WAWebProtobufsAdv.pb","WAWebWamWorkerOfflineProcessReporter","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["processPlaceholderMsg: msgId::",", failed with error: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[unify][message] processing placeholders in cache completed"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["processPlaceHolderMessage: msgId:",", skip placeholder for peer message"]);k=function(){return a};return a}function a(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=a.msgInfo;if(c.category===d("WAWebHandleMsgCommon").CATEGORY_PEER){d("WALogger").LOG(k(),c.externalId).tags("messaging");return}var e=c.offline!=null;try{var f;if(d("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()&&((f=c.chat)==null?void 0:f.isUser())&&a.placeholderType===d("WAWebHandleMsgTypes.flow").PlaceholderType.E2E){f=(yield d("WAWebApiDeviceList").getDeviceRecord(c.author));(f==null?void 0:f.advAccountType)===d("WAWebProtobufsAdv.pb").ADVEncryptionType.HOSTED&&(c.placeholderCreatedWhenAccountIsHosted=!0)}if(a.type===d("WAWebMsgType").MSG_TYPE.CIPHERTEXT){f=(yield d("WAWebMsgProcessingApiUtils").genPlaceholderMsg(c,a.placeholderType,a.placeholderAddReason));if(f.length===0)return}else f=[d("WAWebMsgProcessingApiUtils").genDebugPlaceholderMsg(c,a.nackReason)];a=d("WAWebPnhGatingUtils").isMatFullyEnabled()?yield d("WAWebProcessMatMessages").processRenderableMatMessages(f):f;f=d("WAWebMessageProcessorCache").messageProcessorCache.addMessages(a.map(function(a){return{msg:a}}),!e).then(function(){d("WALogger").DEV(j()),d("WAWebWamWorkerOfflineProcessReporter").WorkerOfflineResumeReporter.updateProcessedMessageCount()});d("WAWebCmd").Cmd.isMainStreamReadyMd&&(d("WAWebCmd").Cmd.isOfflineDeliveryEnd&&(yield f),yield (h||(h=b("Promise"))).all(a.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.id.remote;yield d("WAWebBackendApi").frontendSendAndReceive("updateMessageUI",{chatId:b,msg:a})});return function(b){return a.apply(this,arguments)}}())))}catch(a){d("WALogger").ERROR(i(),c.externalId,a).tags("messaging").sendLogs("handle_msg: error storing/processing single message")}});return l.apply(this,arguments)}g.processPlaceholderMessage=a}),98);
__d("WAWebGetPrivacyModeWhenSent",["WAWebApiVerifiedBusinessName","WAWebHandleMsgTypes.flow","WAWebPrivacyModeSystemMsg","WAWebRuntimeEnvironmentUtils","WAWebUserPrefsMeUser","WAWebWorkerSafeBackendApi","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,b){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(a.type!==d("WAWebHandleMsgTypes.flow").MESSAGE_TYPE.CHAT)return;if(!d("WAWebUserPrefsMeUser").isMeAccount(a.author))return b.privacyMode;b=b.privacyMode;a=d("WAWebRuntimeEnvironmentUtils").isWorker()?yield d("WAWebApiVerifiedBusinessName").getPrivacyMode(a.chat):yield d("WAWebWorkerSafeBackendApi").workerSafeSendAndReceive("getPrivacyMode",{id:a.chat});return d("WAWebPrivacyModeSystemMsg").getLatestPrivacyMode(a,b)});return h.apply(this,arguments)}g.getPrivacyModeWhenSent=a}),98);
__d("WAWebHandleBizBotMsgs",["Promise","WAWebBotSystemMsg","WAWebBotTypes","WAWebModelStorageUtils","WAWebRuntimeEnvironmentUtils","WAWebSchemaChat","WAWebWidFactory","WAWebWorkerSafeBackendApi","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=new Map();a.forEach(function(b){var a=b.from.toJid();a!=null&&!c.has(a)&&b.bizBotType&&c.set(a,b.bizBotType)});a=Array.from(c.keys());a=(yield j(a));var e=[],f=[];for(var g of c.entries()){var i,k=g[0],l=g[1];i=(i=a.get(k))==null?void 0:i.bizBotSystemMsgType;l===d("WAWebBotTypes").BizBotType.BIZ_1P&&i!==d("WAWebBotTypes").BizBotType.BIZ_1P?(e.push(d("WAWebBotSystemMsg").genBizBot1pDisclosureMessage(d("WAWebWidFactory").createWid(k))),f.push({id:k,bizBotSystemMsgType:d("WAWebBotTypes").BizBotType.BIZ_1P})):l===d("WAWebBotTypes").BizBotType.BIZ_3P&&i!==d("WAWebBotTypes").BizBotType.BIZ_3P&&(e.push(d("WAWebBotSystemMsg").genBizBot3pDisclosureMessage(d("WAWebWidFactory").createWid(k))),f.push({id:k,bizBotSystemMsgType:d("WAWebBotTypes").BizBotType.BIZ_3P}))}if(!e.length)return[];yield d("WAWebModelStorageUtils").getStorage().lock(["chat"],function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a[0];yield (h||(h=b("Promise"))).all([a.bulkCreateOrMerge(f)])});return function(b){return a.apply(this,arguments)}}());return e});return i.apply(this,arguments)}function j(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(!d("WAWebRuntimeEnvironmentUtils").isWorker())return d("WAWebWorkerSafeBackendApi").workerSafeSendAndReceive("getBizBotData",{chatIds:a.map(d("WAWebWidFactory").createWid)});var b=new Map();a=(yield d("WAWebSchemaChat").getChatTable().bulkGet(a));a.map(function(a){if(!a)return;b.set(a.id,{bizBotSystemMsgType:a.bizBotSystemMsgType})});return b});return k.apply(this,arguments)}g.handleBizBotMsgs=a}),98);
__d("WAWebMessagePostProcessBatcher",["Promise","WABatcher","WAWebBackendApi","WAWebMsgType","WAWebWorkerSafeBackendApi"],(function(a,b,c,d,e,f,g){var h,i={delayMs:1e3};a=function(){function a(){var a=this;this.$1=d("WABatcher").createSimpleBatcher(i,function(c){a.$2(c);return(h||(h=b("Promise"))).resolve([])})}var c=a.prototype;c.acceptMessage=function(a){return this.$1.accept(a)};c.runActiveBatches=function(){return this.$1.runActiveBatch().then(function(){})};c.$2=function(a){d("WAWebBackendApi").frontendFireAndForget("processOrphanReadReceipts",{msgIds:a.map(function(a){return a.id})});a=a.filter(function(a){return a.type===d("WAWebMsgType").MSG_TYPE.PAYMENT&&a.subtype==="send"});a.length>0&&d("WAWebWorkerSafeBackendApi").workerSafeFireAndForget("processOrphanPaymentNotifications",{msgs:a})};return a}();c=new a();g.messagePostProcessBatcher=c}),98);
__d("WAWebMessagePostprocessRenderable",["Promise","WALogger","WAWebBackendApi","WAWebMessagePostProcessBatcher","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[unify][message] UI update completed"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[unify][message] UI update started"]);j=function(){return a};return a}function a(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=a.msgInfo,e=a.messageOverwriteOption,f=a.preprocessedMessages,g=a.handlePrivacyModeChangeAfterMsgProcessing,k=a.isOffline;d("WALogger").DEV(j());yield (h||(h=b("Promise"))).all(f.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("WAWebBackendApi").frontendSendAndReceive("updateMessageUI",{chatId:a.id.remote,msg:a,messageOverwriteOption:e}),void d("WAWebMessagePostProcessBatcher").messagePostProcessBatcher.acceptMessage(a),k||void d("WAWebMessagePostProcessBatcher").messagePostProcessBatcher.runActiveBatches()});return function(b){return a.apply(this,arguments)}}()));g&&g();d("WALogger").DEV(i());return d("WAWebBackendApi").frontendSendAndReceive("updateUnattributedMessages",{messageInfo:c,messages:f})});return k.apply(this,arguments)}g.postprocessRenderableMessages=a}),98);
__d("WAWebMsmsgMsgSecretCache",["WAWebCmd"],(function(a,b,c,d,e,f,g){a=function(){function a(){var a=this;this.cache=new Map();d("WAWebCmd").Cmd.on("logout",function(){return a.clearCache()})}var b=a.prototype;b.addMsmsgMsgSecretToCache=function(a,b){this.cache.set(a,b)};b.getMsmsgMsgSecretFromCache=function(a){return this.cache.get(a)};b.clearCache=function(){this.cache=new Map()};return a}();b=new a();g.msmsgMsgSecretCache=b}),98);
__d("WAWebChatEphemeralExemptionCache",[],(function(a,b,c,d,e,f){a=function(){function a(){this.chatEphemeralExemptionMap=new Map()}var b=a.prototype;b.has=function(a){return this.chatEphemeralExemptionMap.has(a)};b.get=function(a){return(a=this.chatEphemeralExemptionMap.get(a))!=null?a:null};b.add=function(a,b){this.chatEphemeralExemptionMap.set(a,b)};b.clear=function(){this.chatEphemeralExemptionMap.clear()};return a}();b=new a();f["default"]=b}),66);
__d("WAWebDBUpdateChatTable",["WALogger","WAWebMiscErrors","WAWebSchemaChat","err"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["updateChatTable: failed to update in storage"]);h=function(){return a};return a}function a(a,b){return d("WAWebSchemaChat").getChatTable().merge(a.toString(),b)["catch"](function(a){if(a instanceof d("WAWebMiscErrors").DbOnLogoutAbort)throw a;d("WALogger").ERROR(h()).verbose().devConsole(a).sendLogs("updateChatTable failed");throw c("err")("updateChatTable failed")})}g.updateChatTable=a}),98);
__d("WAWebDBChatEphemeralExemptionData",["WALogger","WAWebChatEphemeralExemptionCache","WAWebDBUpdateChatTable","WAWebSchemaChat","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to update chat.ephemeralDisplayedExemptions: ",""]);h=function(){return a};return a}function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.toString();if(c("WAWebChatEphemeralExemptionCache").has(b))return c("WAWebChatEphemeralExemptionCache").get(b);a=(yield d("WAWebSchemaChat").getChatTable().get(a.toString(),!1));a=a==null?null:{id:b,ephemeralDuration:a==null?void 0:a.ephemeralDuration,ephemeralDisplayedExemptions:a==null?void 0:a.ephemeralDisplayedExemptions};c("WAWebChatEphemeralExemptionCache").add(b,a);return a});return i.apply(this,arguments)}function e(a,b,e){var f=a.toString();c("WAWebChatEphemeralExemptionCache").add(f,{id:f,ephemeralDuration:b,ephemeralDisplayedExemptions:e});d("WAWebDBUpdateChatTable").updateChatTable(a,{ephemeralDisplayedExemptions:e})["catch"](function(){d("WALogger").DEV(h(),d("WAWebDBUpdateChatTable").updateChatTable)})}function f(a,b){a=a.toString();var d=c("WAWebChatEphemeralExemptionCache").get(a);d={id:a,ephemeralDuration:b,ephemeralDisplayedExemptions:(b=d==null?void 0:d.ephemeralDisplayedExemptions)!=null?b:null};c("WAWebChatEphemeralExemptionCache").add(a,d)}g.getChatEphemeralExemptionDataFromChat=a;g.persistsEphemeralDisplayedExemptions=e;g.updateEphemeralDurationCache=f}),98);
__d("WAWebDBEphemeralDisplayedExemptions",["$InternalEnum"],(function(a,b,c,d,e,f){a=b("$InternalEnum")({UNSET:0,ORDERS_AND_PAYMENTS:1});f.EphemeralExemptionType=a}),66);
__d("WAWebOrderEphemeralExemptionUtil",["WAWebBizGatingUtils","WAWebDBEphemeralDisplayedExemptions","WAWebInteractiveMessageType","WAWebInteractiveMessagesNativeFlowName","WAWebMsgType"],(function(a,b,c,d,e,f,g){function a(a,b,e){return d("WAWebBizGatingUtils").inOrderMessagesEphemeralExceptionEnabled()&&a===d("WAWebMsgType").MSG_TYPE.INTERACTIVE&&b===c("WAWebInteractiveMessageType").NATIVE_FLOW&&(e===c("WAWebInteractiveMessagesNativeFlowName").ORDER_DETAILS||e===c("WAWebInteractiveMessagesNativeFlowName").ORDER_STATUS||e===c("WAWebInteractiveMessagesNativeFlowName").PAYMENT_METHOD||e===c("WAWebInteractiveMessagesNativeFlowName").PAYMENT_STATUS)}function b(a){var b=a.id,c=a.ephemeralDuration;a=a.ephemeralDisplayedExemptions;return b!=null&&c!==0&&c!=null&&d("WAWebDBEphemeralDisplayedExemptions").EphemeralExemptionType.ORDERS_AND_PAYMENTS!==a}function e(a){var b=a.id,c=a.ephemeralDuration;a=a.ephemeralDisplayedExemptions;return b!=null&&(c===0||c==null)&&d("WAWebDBEphemeralDisplayedExemptions").EphemeralExemptionType.ORDERS_AND_PAYMENTS===a}g.isMessageTypeExemptedFromDisappearing=a;g.shouldShowOrderExemptionSystemMessage=b;g.shouldUnsetChatEphemeralDisplayedExemption=e}),98);
__d("WAWebOrderSystemMsg",["WAWebContactSystemMsg"],(function(a,b,c,d,e,f,g){function a(a){return d("WAWebContactSystemMsg").genNotificationMsg(a,{type:"notification_template",subtype:"order_ephemeral_exemption",templateParams:[]})}g.getOrderEphemeralExemptionSystemMsg=a}),98);
__d("WAWebPreProcessOrderEphemeralExemption",["WAWebBizGatingUtils","WAWebDBChatEphemeralExemptionData","WAWebDBEphemeralDisplayedExemptions","WAWebOrderEphemeralExemptionUtil","WAWebOrderSystemMsg","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b;if(!d("WAWebBizGatingUtils").inOrderMessagesEphemeralExceptionEnabled())return a;var c=a.findIndex(function(a){var b=a.nativeFlowName,c=a.interactiveType;a=a.type;return d("WAWebOrderEphemeralExemptionUtil").isMessageTypeExemptedFromDisappearing(a,c,b)});if(c===-1||((b=a.at(c))==null?void 0:(b=b.id)==null?void 0:b.remote)==null)return a;b=(b=a.at(c))==null?void 0:(b=b.id)==null?void 0:b.remote;if(b==null)return a;var e=(yield d("WAWebDBChatEphemeralExemptionData").getChatEphemeralExemptionDataFromChat(b));if(e!=null&&d("WAWebOrderEphemeralExemptionUtil").shouldShowOrderExemptionSystemMessage(e)){var f;d("WAWebDBChatEphemeralExemptionData").persistsEphemeralDisplayedExemptions(b,(f=e.ephemeralDuration)!=null?f:0,d("WAWebDBEphemeralDisplayedExemptions").EphemeralExemptionType.ORDERS_AND_PAYMENTS);f=a.slice(0,c);var g=d("WAWebOrderSystemMsg").getOrderEphemeralExemptionSystemMsg(b);c=a.slice(c,a.length);return[].concat(f,[g],c)}else if(e!=null&&d("WAWebOrderEphemeralExemptionUtil").shouldUnsetChatEphemeralDisplayedExemption(e)){d("WAWebDBChatEphemeralExemptionData").persistsEphemeralDisplayedExemptions(b,(f=e.ephemeralDuration)!=null?f:0,d("WAWebDBEphemeralDisplayedExemptions").EphemeralExemptionType.UNSET)}return a});return h.apply(this,arguments)}g.preProcessOrderEphemeralExemption=a}),98);
__d("WAWebEventsWaitForOfflineDeliveryEnd",["Promise","WAWebCmd","WAWebEventsWaitForBbEvent","err"],(function(a,b,c,d,e,f,g){var h,i;function a(){if(i)return;i=c("WAWebEventsWaitForBbEvent")(d("WAWebCmd").Cmd,"offline_delivery_end");d("WAWebCmd").Cmd.on("offline_delivery_start",function(){i=c("WAWebEventsWaitForBbEvent")(d("WAWebCmd").Cmd,"offline_delivery_end")})}function e(){if(d("WAWebCmd").Cmd.isOfflineDeliveryEnd)return(h||(h=b("Promise"))).resolve();return!i?(h||(h=b("Promise"))).reject(c("err")("waitForOfflineDeliveryEnd called before init")):i}g.initWaitForOfflineDeliveryEnd=a;g.waitForOfflineDeliveryEnd=e}),98);
__d("WAWebQueryBotWaitlistState",["WADeprecatedSendIq","WADeprecatedWapParser","WALogger","WATimeUtils","WAWap","WAWebBotGating","WAWebCmd","WAWebEventsWaitForOfflineDeliveryEnd","WAWebProtobufsHistorySync.pb","WAWebRuntimeEnvironmentUtils","WAWebUserPrefsBot","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Ad hoc Bot Available state query returned result : ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Could not send IQ in queryBotWaitlistState"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Ad hoc Bot Available skipped, state is already available"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Ad hoc Bot Available skipped, interval less than threshold"]);k=function(){return a};return a}var l=!0;e=null;var m=d("WATimeUtils").HOUR_SECONDS*1e3,n=new(c("WADeprecatedWapParser"))("botWaitlistStateQueryParser",function(a){var b=!1;a=a.maybeChild("user");if(a){a=a.maybeAttrString("state");a==="AI available"&&(b=!0)}return{isBotAvailable:b}});function a(a){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b;a===void 0&&(a=!1);if(l===!1&&!a){d("WALogger").LOG(k());return}l=!1;e=self.setTimeout(function(){l=!0},m);if(d("WAWebUserPrefsBot").getBotWaitlistState()===d("WAWebProtobufsHistorySync.pb").HistorySync$BotAIWaitListState.AI_AVAILABLE){d("WALogger").LOG(j());self.clearTimeout(e);return}yield d("WAWebEventsWaitForOfflineDeliveryEnd").waitForOfflineDeliveryEnd();a=d("WAWap").wap("iq",{to:d("WAWap").S_WHATSAPP_NET,xmlns:"bot",type:"get",id:d("WAWap").generateId()},d("WAWap").wap("user_state",null));a=(yield d("WADeprecatedSendIq").deprecatedSendIq(a,n));if(!a.success){d("WALogger").ERROR(i());return}d("WALogger").LOG(h(),(b=a.result)==null?void 0:b.isBotAvailable);((b=a.result)==null?void 0:b.isBotAvailable)===!0&&(yield d("WAWebUserPrefsBot").setBotWaitlistState(d("WAWebProtobufsHistorySync.pb").HistorySync$BotAIWaitListState.AI_AVAILABLE),!d("WAWebRuntimeEnvironmentUtils").isWorker()&&d("WAWebBotGating").isBotEnabled()&&d("WAWebCmd").Cmd.botWaitlistStateUpdated())});return o.apply(this,arguments)}g.queryBotWaitlistState=a}),98);
__d("WAWebSendStatusGatingUtils",["WAWebABProps","WAWebPrimaryFeatures","gkx"],(function(a,b,c,d,e,f,g){function a(){return d("WAWebPrimaryFeatures").primaryFeatureEnabled("post_status_in_companion")&&c("gkx")("26254")&&d("WAWebABProps").getABPropConfigValue("web_status_posting_enabled")}function b(){return d("WAWebABProps").getABPropConfigValue("web_status_drawer_enabled")}function e(){return d("WAWebABProps").getABPropConfigValue("web_status_muting_enabled")}g.isStatusPostingEnabled=a;g.isStatusDrawerEnabled=b;g.isStatusMutingEnabled=e}),98);
__d("WAWebMessageProcessRenderable",["Promise","WALogger","WAWebApiOrphanRevoke","WAWebBotGating","WAWebBotSystemMsg","WAWebCmd","WAWebDBProcessOrphansForNewMsg","WAWebGetPrivacyModeWhenSent","WAWebHandleBizBotMsgs","WAWebHandleMsgTypes.flow","WAWebHandlePrivacyModeChange","WAWebMessagePostprocessRenderable","WAWebMessageProcessorCache","WAWebMsgGetters","WAWebMsmsgMsgSecretCache","WAWebPnhGatingUtils","WAWebPreProcessOrderEphemeralExemption","WAWebProcessMatMessages","WAWebProtobufsHistorySync.pb","WAWebQueryBotWaitlistState","WAWebSendStatusGatingUtils","WAWebStatusDBMessageInfo","WAWebUserPrefsBot","WAWebWamEnumPlaceholderPopulationType","WAWebWamWorkerOfflineProcessReporter","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["processRenderableMessage: msgId:",", failed with error: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["processRenderableMessages write to DB from cache, failed with error: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[unify][message] processing messages in cache completed"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[unify][message] processing "," "," message(s)"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["processRenderableMessages: skip for empty msg list"]);m=function(){return a};return a}function n(a,b,c,d){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){var f=a;d("WAWebPnhGatingUtils").isMatFullyEnabled()&&(f=(yield d("WAWebProcessMatMessages").processRenderableMatMessages(a)));var g=(yield d("WAWebGetPrivacyModeWhenSent").getPrivacyModeWhenSent(b,c)),h=q(e);h!=null&&(f=f.map(function(a){return babelHelpers["extends"]({},a,{placeholderPopulationType:h})}));f=g==null?f:f.map(function(a){return babelHelpers["extends"]({},a,{privacyModeWhenSent:g})});var i=b.addressingMode;f=i==null?f:f.map(function(a){return babelHelpers["extends"]({},a,{groupAddressingMode:i})});f=(yield d("WAWebPreProcessOrderEphemeralExemption").preProcessOrderEphemeralExemption(f));d("WAWebBotGating").isBotReceiveEnabled()&&(f=f.map(function(a){var b;b=a.messageSecret!=null?(b=a.mentionedJidList)==null?void 0:b.find(function(a){return a.isBot()}):null;return b!=null?babelHelpers["extends"]({},a,{invokedBotWid:b}):a}));return d("WAWebApiOrphanRevoke").applyOrphanRevokes(f)});return o.apply(this,arguments)}function a(a,b,c,d,e,f,g){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g,o,p,q){if(a.length===0){d("WALogger").DEV(m());return}try{var r=e.offline!=null&&!q;f="online";q?f="reparsing":r&&(f="offline");d("WALogger").DEV(l(),a.length,f);var s=(yield n(a,e,g,p));if(d("WAWebBotGating").isBotReceiveEnabled()){f=null;var t=(yield d("WAWebUserPrefsBot").getBotWaitlistStateFromIdb())===d("WAWebProtobufsHistorySync.pb").HistorySync$BotAIWaitListState.AI_AVAILABLE;s.forEach(function(a){var b,g,h=a.messageSecret;b=Boolean(h&&((b=a.id.remote)==null?void 0:b.isBot()));g=(g=(g=a.invokedBotWid)==null?void 0:g.isBot())!=null?g:!1;h&&(b||g)&&a.isForwarded!==!0&&(g&&(f=a.id.remote),d("WAWebMsmsgMsgSecretCache").msmsgMsgSecretCache.addMsmsgMsgSecretToCache(a.id.toString(),h),!t&&a.id.fromMe===!0&&void d("WAWebQueryBotWaitlistState").queryBotWaitlistState());d("WAWebSendStatusGatingUtils").isStatusPostingEnabled()&&a.id.fromMe&&void c("WAWebStatusDBMessageInfo").updatePeerStatusReceiptInfo(a.id,r,e.statusSetting)});if(f){a=(yield d("WAWebBotSystemMsg").createSysMsgForIncomingBotInvoke(f));a&&s.unshift(a)}}if(d("WAWebBotGating").isBotEnabled()){a=s.filter(function(a){return Boolean(a.bizBotType)&&!d("WAWebMsgGetters").getIsCAPISupport(a)});if(a.length){a=(yield d("WAWebHandleBizBotMsgs").handleBizBotMsgs(a));s.unshift.apply(s,a)}}a=(yield d("WAWebHandlePrivacyModeChange").handlePrivacyModeChangeAndCreateChat(s,e,g,o));g=d("WAWebMessageProcessorCache").messageProcessorCache.addMessages(s.map(function(a){return{msg:a}}),!r).then(function(){d("WALogger").DEV(k());d("WAWebWamWorkerOfflineProcessReporter").WorkerOfflineResumeReporter.updateProcessedMessageCount();if(!r)return(h||(h=b("Promise"))).all(s.map(function(a){return d("WAWebDBProcessOrphansForNewMsg").processOrphansForNewMsg(a,e)}))})["catch"](function(a){d("WALogger").ERROR(j(),a).tags("messaging").sendLogs("processRenderableMessages write to DB from cache, failed")});if(d("WAWebCmd").Cmd.isMainStreamReadyMd||q){d("WAWebCmd").Cmd.isOfflineDeliveryEnd&&(yield g);return d("WAWebMessagePostprocessRenderable").postprocessRenderableMessages({msgInfo:e,messageOverwriteOption:p,preprocessedMessages:s,handlePrivacyModeChangeAfterMsgProcessing:a,isOffline:r})}}catch(a){d("WALogger").ERROR(i(),e.externalId,a).tags("messaging").sendLogs("handle_msg: error storing/processing single message")}return(h||(h=b("Promise"))).resolve()});return p.apply(this,arguments)}function q(a){switch(a){case d("WAWebHandleMsgTypes.flow").MessageOverwriteOption.NO_OVERWRITE:case d("WAWebHandleMsgTypes.flow").MessageOverwriteOption.FUTURE_PROOF:return null;case d("WAWebHandleMsgTypes.flow").MessageOverwriteOption.RETRY:return d("WAWebWamEnumPlaceholderPopulationType").PLACEHOLDER_POPULATION_TYPE.RETRY;case d("WAWebHandleMsgTypes.flow").MessageOverwriteOption.PEER_RETRY:return d("WAWebWamEnumPlaceholderPopulationType").PLACEHOLDER_POPULATION_TYPE.PEER_MESSAGE}}g.processRenderableMessages=a}),98);
__d("WAWebMessageProcessor",["WAWebMessageProcessPlaceholder","WAWebMessageProcessReaction","WAWebMessageProcessRenderable"],(function(a,b,c,d,e,f){a=importNamespace("WAWebMessageProcessPlaceholder").processPlaceholderMessage;b=importNamespace("WAWebMessageProcessRenderable").processRenderableMessages;c=importNamespace("WAWebMessageProcessReaction").processReactionMessage;f.processPlaceholderMessage=a;f.processRenderableMessages=b;f.processReactionMessage=c}),66);
__d("WAWebMessageProcessorCache",["Promise","WALogger","WANullthrows","WAPromiseQueue","WAShiftTimer","WAWebABProps","WAWebDBReportingTokenUtils","WAWebGetGroupAddressingMode","WAWebGroupDatabaseJob","WAWebGroupHandleAddressingModeMismatch","WAWebHandleMessageTypes.flow","WAWebSendOfflineDeliveryReceiptJob","WAWebSignalProtocolStore","WAWebSignalStorageUtils","WAWebSignalStoreApi","WAWebStoreMsgs","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[unify][message-cache]: aggregated receipts sent for "," - ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[unify][message-cache]: signal key store updated for "," - ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[unify][message-cache]: messages added to table for "," - ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["MessageProcessorCache: missing doneFn"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[unify][message-cache]: creating snapshot for "," - "," messages"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[unify][message-cache]: flushing due to max size reached, ","}"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[unify][offline][message-cache]: adding to cache (current length: ",", next checkpoint index: ","): ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[unify][online][message-cache]: flushing immediately"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["[unify][message-cache]: flushing cache due to timer tick"]);q=function(){return a};return a}function r(){return d("WAWebABProps").getABPropConfigValue("web_message_processing_cache_size")}a=function(){function a(){var a=this;this.cache=[];this.additionalInfoCache=[];this.checkpointQueue=new(d("WAPromiseQueue").PromiseQueue)();this.nextCheckpointIndex=0;this.snapshotTimer=new(d("WAShiftTimer").ShiftTimer)(function(){d("WALogger").DEV(q()),a.createSnapshot()});this.checkpointPromises=new Map();this.flushImmediately=!1}var e=a.prototype;e.addMessages=function(a,b){var c;b===void 0&&(b=!1);(c=this.cache).push.apply(c,a);c=this.$1();if(b){d("WALogger").DEV(p());this.flushImmediately=!0;this.createSnapshot();return c}this.flushImmediately=!1;d("WALogger").DEV(o(),this.cache.length,this.nextCheckpointIndex,a.map(function(a){var b;return a.msg!=null?"msg "+((b=a.msg)==null?void 0:(b=b.id)==null?void 0:b.toString()):"receipt "+(((b=a.receiptInfo)==null?void 0:b.externalId)||"")}));if(this.cache.length>=r()){d("WALogger").DEV(n(),this.cache.length);this.createSnapshot();return c}return c};e.addAdditionalInfo=function(a){this.additionalInfoCache.push(a)};e.pullGroupInfoForChangedAddressingMode=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=new Map();a.forEach(function(b){b=b.msg;if(b!=null&&b.id.remote.isGroup()){var a=b==null?void 0:b.groupAddressingMode;a!=null&&c.set(b.id.remote.toString(),a)}});var e=(yield d("WAWebGetGroupAddressingMode").bulkGetGroupAddressingMode(Array.from(c.keys()).map(d("WAWebWidFactory").createWid)));a=[];for(var f of c.entries()){var g=f[0],i=f[1];e.get(g)!==i&&a.push(d("WAWebWidFactory").createWid(g))}this.flushImmediately||(yield d("WAWebGroupDatabaseJob").bulkMarkGroupParticipantStaleJob(a));yield (h||(h=b("Promise"))).all(a.map(function(a){return d("WAWebGroupHandleAddressingModeMismatch").handleAddressingModeMismatch(a,{localAddressingMode:e.get(String(a)),serverAddressingMode:c.get(String(a)),mismatchOrigin:d("WAWebGroupHandleAddressingModeMismatch").MISMATCH_ORIGIN_TYPE.INCOMING_GROUP_MESSAGE})}))});function c(b){return a.apply(this,arguments)}return c}();e.$1=function(){var a=this;if(!this.checkpointPromises.has(this.nextCheckpointIndex)){var d,e=function(a){return void 0};this.checkpointPromises.set(this.nextCheckpointIndex,{promise:new(h||(h=b("Promise")))(function(a,b){d=a,e=b}),markCheckpointDone:function(b){a.checkpointPromises["delete"](a.nextCheckpointIndex);if(b!=null){e(b);return}d()}})}return c("WANullthrows")(this.checkpointPromises.get(this.nextCheckpointIndex)).promise};e.$2=function(a){var b=[];a.forEach(function(a){a=a.msg;a!=null&&b.push(a)});return d("WAWebStoreMsgs").storeMsgs(b)};e.$3=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.filter(function(a){return a.type===d("WAWebHandleMessageTypes.flow").MsgAdditionalInfoType.ReportingTokenInfo}).map(function(a){return a.data});void d("WAWebDBReportingTokenUtils").handleAddReportingTokenInfos(a)});function c(b){return a.apply(this,arguments)}return c}();e.createSnapshot=function(){var a,c=this,e=this.cache,f=this.additionalInfoCache;this.cache=[];this.additionalInfoCache=[];this.snapshotTimer.isScheduled()&&this.snapshotTimer.cancel();var g=this.nextCheckpointIndex,n=g+e.length;this.nextCheckpointIndex=n;d("WALogger").LOG(m(),g,n);if(e.length===0)return;var o=(a=(a=this.checkpointPromises.get(g))==null?void 0:a.markCheckpointDone)!=null?a:function(a){d("WALogger").ERROR(l()).sendLogs("message-cache-missing-doneFn")},p=d("WAWebSignalProtocolStore").getSignalProtocolStore().generateSnapshot();this.checkpointQueue.enqueue(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{yield c.$2(e),d("WALogger").LOG(k(),g,n),p!=null&&(yield d("WAWebSignalStorageUtils").getStorage().lock(["session-store","identity-store","prekey-store","senderkey-store"],b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield (h||(h=b("Promise"))).all([d("WAWebSignalStoreApi").waSignalStore.bulkPutSession(p.sessionUpdate),d("WAWebSignalStoreApi").waSignalStore.bulkPutIdentityKeyWithRowId(p.identityUpdate),d("WAWebSignalStoreApi").waSignalStore.bulkPutSenderKey(p.senderKeyUpdate),d("WAWebSignalStoreApi").waSignalStore.bulkRemovePreKey(p.preKeyRemove),d("WAWebSignalStoreApi").waSignalStore.bulkRemoveSession(p.sessionRemove),d("WAWebSignalStoreApi").waSignalStore.bulkRemoveIdentity(p.identityRemove)])})),d("WALogger").LOG(j(),g,n)),yield d("WAWebSendOfflineDeliveryReceiptJob").sendAggregateOfflineReceipts(e),yield c.$3(f),d("WALogger").LOG(i(),g,n)}catch(a){o(a);return}o()}));d("WAWebABProps").getABPropConfigValue("lid_groups_handle_server_addressing_mode")&&void this.pullGroupInfoForChangedAddressingMode(e)};return a}();e=new a();g.messageProcessorCache=e}),98);
__d("WAWebApiMessageInfoStore",["WAJids","WALogger","WAWebAck","WAWebModelStorageUtils","WAWebMsgKey","WAWebSchemaMessage","WAWebSchemaMessageInfo","WAWebUserPrefsMeUser","WAWebWid","WAWebWidFactory","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["queryMsgInfo: targetedMsgInfoKey: ",", ack count: ",", receiver: ",",\n        played: ",", read: ",", delivery: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["MessageInfoStore: ",", ",":"," has been delivered"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["MessageInfoStore: ",", ",":",": primary identity change after message has been delivered"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["MessageInfoStore: ",", ",":",": companion identity changed"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["MessageInfoStore: missing record for ",", ",""]);l=function(){return a};return a}var m=[d("WAWebAck").ACK_STRING.PLAYED,d("WAWebAck").ACK_STRING.READ,d("WAWebAck").ACK_STRING.DELIVERY],n=Object.freeze({ELIGIBLE:"ELGIBLE",INELIGIBLE_RECORD_MISSING:"INELIGIBLE_RECORD_MISSING",INELIGIBLE_ALREADY_DELIVERED:"INELIGIBLE_ALREADY_DELIVERED",INELIGIBLE_NOT_MD:"INELIGIBLE_NOT_MD",INELIGIBLE_CHANGED_IDENTITY:"INELIGIBLE_CHANGED_IDENTITY"});function a(a){var c=new Map();a.forEach(function(a){var b=a.msgKey;a=a.receiverId;var e=d("WAWebWidFactory").toUserWid(a).toString();b=b.toString();var f=b+","+e;a=(a=a.device)!=null?a:d("WAJids").DEFAULT_DEVICE_ID;var g=c.get(f);!g?c.set(f,{msgKey:b,receiverUserJid:e,deviceDelivered:[],deviceNotDelivered:[a]}):g.deviceNotDelivered.push(a)});return d("WAWebModelStorageUtils").getStorage().lock(["message-info"],function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a[0];var b=Array.from(c.values()).map(function(a){return[a.msgKey,a.receiverUserJid]});a=(yield a.anyOf(["msgKey","receiverUserJid"],b));a.forEach(function(a){var b=a.msgKey+","+a.receiverUserJid,d=c.get(b);d&&c.set(b,babelHelpers["extends"]({},a,{deviceNotDelivered:[].concat(a.deviceNotDelivered,d.deviceNotDelivered)}))});return d("WAWebSchemaMessageInfo").getMessageInfoTable().bulkCreateOrReplace(Array.from(c.values()))});return function(b){return a.apply(this,arguments)}}())}function e(a,b,c,e){var f=d("WAWebWidFactory").toUserWid(b).toString(),g=b.device||0;return d("WAWebSchemaMessageInfo").getMessageInfoTable().get([a.toString(),f]).then(function(h){if(!h){d("WALogger").LOG(l(),a.toString(),f);return n.INELIGIBLE_RECORD_MISSING}else if(h.deviceNotDelivered.includes(g)){if(c!=null&&e>=c)return n.ELIGIBLE;if(b.device!=null&&b.device!==d("WAJids").DEFAULT_DEVICE_ID){d("WALogger").LOG(k(),a.toString(),f,g);return n.INELIGIBLE_CHANGED_IDENTITY}else if(h.delivery!=null){d("WALogger").LOG(j(),a.toString(),f,g);return n.INELIGIBLE_CHANGED_IDENTITY}return n.ELIGIBLE}d("WALogger").LOG(i(),a.toString(),f,g);return n.INELIGIBLE_ALREADY_DELIVERED})}function f(a){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield p([a]));b=b.get(a.toString());if(!b)throw c("err")("No message info found for "+a.toString());return b});return o.apply(this,arguments)}function p(a){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield d("WAWebSchemaMessage").getMessageTable().bulkGet(a.map(function(a){return a.toString()}))),c=new Map(),e=new Map();for(var f=0;f<a.length;f++){var g,h=a[f].toString();g=(g=(g=b[f])==null?void 0:g.latestEditMsgKey)!=null?g:h;e.set(g,h);h=b[f]?b[f].count:null;c.set(g,{messageInfoRecords:[],ackReceiver:h})}g=(yield d("WAWebSchemaMessageInfo").getMessageInfoTable().anyOf(["msgKey"],Array.from(c.keys())));g.forEach(function(a){var b;(b=c.get(a.msgKey))==null?void 0:b.messageInfoRecords.push(a)});h=r(c);f=new Map();for(b of h){a=b[0];g=b[1];h=e.get(a);h!=null&&f.set(h,g)}return f});return q.apply(this,arguments)}function r(a){var b=new Map(),e=function(a){var e=a[0];a=a[1];var f=a.ackReceiver;a=a.messageInfoRecords;var g=0,i={delivery:[],deliveryRemaining:0,played:[],playedRemaining:0,read:[],readRemaining:0},j=!1;a.forEach(function(a){var b=d("WAWebWidFactory").createWid(a.receiverUserJid);if(d("WAWebUserPrefsMeUser").getMeUser().equals(b))return;s(a);for(var f=0;f<m.length;f++){var h=m[f],k=a[h];if(k!=null){i[h].push({id:b,t:k});k=c("WAWebWid").isGroup(c("WAWebMsgKey").fromString(e).remote);k&&h==="read"&&(b==null?void 0:b.isBot())&&(j=!0);if(k)break}}a.delivery!=null&&a.deliveryPrivacyMode!=null&&(i.deliveryPrivacyMode=a.deliveryPrivacyMode);g+=1});a=f!=null&&f!==0?f:g;j&&a++;d("WALogger").LOG(h(),e,f,a,i.played.length,i.read.length,i.delivery.length);i.playedRemaining=a-i.played.length;i.readRemaining=i.playedRemaining-i.read.length;i.deliveryRemaining=i.readRemaining-i.delivery.length;b.set(e,i)};for(a of a.entries())e(a);return b}function s(a){var b=a.read;b!=null&&(a.delivery==null||a.delivery>b)&&(a.delivery=b)}function t(a){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=new Map(),c=(yield p(a));for(a of a){var e=c.get(a.toString());if(e==null)continue;var f=void 0;e.playedRemaining===0&&e.played.length>0?f=d("WAWebAck").ACK.PLAYED:e.readRemaining===0&&e.read.length>0?f=d("WAWebAck").ACK.READ:e.deliveryRemaining===0&&e.delivery.length>0&&(f=d("WAWebAck").ACK.RECEIVED);f!=null&&b.set(a.toString(),f)}return b});return u.apply(this,arguments)}g.RetryEligibilityResult=n;g.createOrMergeReceiptRecords=a;g.isRetryEligible=e;g.queryMsgInfo=f;g.queryMsgInfos=p;g.getHighestMsgAcks=t}),98);
__d("WAWebDBBulkGetRootMsgs",["WALogger","WAWebApiChat","WAWebMsgKey","WAWebPnhGatingUtils","WAWebSchemaMessage","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["bulkGetRootMsgs: missing original idx for msgkey"]);h=function(){return a};return a}function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield l(a));yield j(a,b);return b});return i.apply(this,arguments)}function j(a,b){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e=new Map();for(var f=0;f<b.length;f++)b[f]==null&&e.set(a[f],f);if(e.size===0||!d("WAWebPnhGatingUtils").isMatFullyEnabled())return;f=Array.from(e.keys()).map(function(a){return c("WAWebMsgKey").from(a)});var g=(yield d("WAWebApiChat").getMatChatBulk(f.map(function(a){return a.remote})));a=f.map(function(a){var b=g.get(a.remote);return b==null||!a.remote.isUser()||a.remote.equals(b)?null:[a.toString(),new(c("WAWebMsgKey"))({fromMe:a.fromMe,remote:b,id:a.id})]}).filter(Boolean);if(a.length===0)return;f=(yield l(a.map(function(a){a=a[1];return a.toString()})));for(var i=0;i<f.length;i++)if(f[i]!=null){var j=a[i][0];j=e.get(j);j!=null?b[j]=f[i]:d("WALogger").DEV(h())}});return k.apply(this,arguments)}function l(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield d("WAWebSchemaMessage").getMessageTable().bulkGet(a)),c=new Map();for(var e=0;e<a.length;e++)(b[e]==null||b[e].subtype==="message_edit")&&(c.set(a[e],e),b[e]=null);e=(yield d("WAWebSchemaMessage").getMessageTable().anyOf(["latestEditMsgKey"],Array.from(c.keys())));for(a of e){if(a.latestEditMsgKey==null||a.subtype==="message_edit")continue;e=c.get(a.latestEditMsgKey);if(e==null)continue;b[e]=a}return b});return m.apply(this,arguments)}g.bulkGetRootMsgs=a}),98);
__d("WAWebSchemaPeerReadReceipt",["WAWebOffdStorageUtils","WAWebStorageMutationBuilder"],(function(a,b,c,d,e,f,g){c=d("WAWebStorageMutationBuilder").columnBuilder();var h=c.addColumn,i=c.addAutoIncrementingPrimaryKey;function a(){d("WAWebOffdStorageUtils").getStorage().add("peer-read-receipt").version(d("WAWebOffdStorageUtils").getStorage().versions.version(2),[i("id"),h("msgKeys"),h("ts"),h("ack")]).view(function(a){return a})}function b(){return d("WAWebOffdStorageUtils").getStorage().table("peer-read-receipt")}g.addTable=a;g.getTable=b}),98);
__d("WAWebMessageReceiptBatcher",["Promise","WABatcher","WAJids","WALogger","WAPromiseMap","WAWebAck","WAWebApiMessageInfoStore","WAWebBackendApi","WAWebDBBulkGetRootMsgs","WAWebHandleMsgReceiptCommon","WAWebHandlePrivacyModeUpdateMsgAction","WAWebModelStorageUtils","WAWebMsgKey","WAWebSchemaMessage","WAWebSchemaMessageInfo","WAWebSchemaPeerReadReceipt","WAWebUserPrefsMeUser","WAWebWidFactory","WAWebWorkerSafeBackendApi","asyncToGeneratorRuntime","lodash"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[unify][batcher]: process peer receipts batch: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["_processOtherReceipts: failed to process privacy mode updates"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[unify][batcher] process other receipts batch: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[unify][batcher]: receipt has unsupported ack type ",""]);l=function(){return a};return a}var m=Object.freeze((a={},a[(e=d("WAWebAck")).ACK.SENT]=e.ACK_STRING.DELIVERY,a[e.ACK.RECEIVED]=e.ACK_STRING.DELIVERY,a[e.ACK.READ]=e.ACK_STRING.READ,a[e.ACK.PLAYED]=e.ACK_STRING.PLAYED,a[e.ACK.INACTIVE]=e.ACK_STRING.INACTIVE,a)),n={delayMs:1e3};f=function(){function a(){var a=this;this.$1=d("WABatcher").createSimpleBatcher(n,function(b){return a.$2(b).then(function(){return[]})});this.$3=d("WABatcher").createSimpleBatcher(n,function(b){return a.$4(b).then(function(){return[]})})}var e=a.prototype;e.acceptPeerReceipt=function(a){return this.$1.accept(a)};e.acceptOtherReceipt=function(a){return this.$3.accept(a)};e.runActiveBatches=function(){return(h||(h=b("Promise"))).all([this.$1.runActiveBatch(),this.$3.runActiveBatch()]).then(function(){})};e.$5=function(a){var b=[];for(a of a){var e=a.ack,f=a.privacyMode,g=a.msgKeys,h=a.receiverId;e===d("WAWebAck").ACK.RECEIVED&&f!=null&&b.push({remote:h,deliveryPrivacyMode:f,msgKeys:g.map(function(a){return c("WAWebMsgKey").from(a)})})}return b};e.$6=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("WAPromiseMap").promiseMap(a,function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("WAWebHandlePrivacyModeUpdateMsgAction").handlePrivacyModeTransition(a.remote,a.deliveryPrivacyMode),yield d("WAWebWorkerSafeBackendApi").workerSafeSendAndReceive("updateBizPrivacyStatus",{msgIds:a.msgKeys,privacyMode:a.deliveryPrivacyMode})});return function(b){return a.apply(this,arguments)}}())});function c(b){return a.apply(this,arguments)}return c}();e.$7=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=this.$8(a);b=b.map(function(a){return c("WAWebMsgKey").from(a)}).filter(function(a){return a.remote.isGroup()||a.remote.isStatusV3()||a.remote.isBot()});b=(yield d("WAWebApiMessageInfoStore").getHighestMsgAcks(b));for(b of b.entries()){var e=b[0],f=b[1];a.set(e,f)}return a});function e(b,c){return a.apply(this,arguments)}return e}();e.$8=function(a){var b=new Map();for(a of a){var d=a.msgKeys,e=a.ack,f=a.isBotInvoke,g=a.isSender;for(d of d)if(c("WAWebMsgKey").from(d).remote.isUser()&&f!==!0&&g!==!0){var h;b.set(d,Math.max(e,(h=b.get(d))!=null?h:Number.NEGATIVE_INFINITY))}}return b};e.$9=function(a){var b=new Map();a.forEach(function(a){var c=a.ack,e=a.ts,f=a.receiverId;a=a.msgKeys;var g=f.isNewsletter()?f.toJid():d("WAWebWidFactory").toUserWid(f).toString(),h=(f=f.device)!=null?f:d("WAJids").DEFAULT_DEVICE_ID;a.forEach(function(a){var f=m[c];if(f==null){d("WALogger").WARN(l(),c);return}a=a+","+g;var i=b.get(a);if(!i){b.set(a,(a={},a[f]=e,a.deviceDelivered=new Set([h]),a))}else f!==m[d("WAWebAck").ACK.INACTIVE]&&(i[f]=q(i[f],e)),i.deviceDelivered.add(h)})});return Array.from(b,function(a){var b=a[0];a=a[1];b=b.split(",");var c=b[0];b=b[1];return[[c,b],a]})};e.$4=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=this,f=this.$9(a),g=Array.from(new Set(c("lodash").flatMap(a,function(a){return a.msgKeys}))),i=(yield d("WAWebModelStorageUtils").getStorage().lock(["message-info","message","chat"],b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var i=(yield (h||(h=b("Promise"))).all([d("WAWebSchemaMessageInfo").getMessageInfoTable().bulkGet(f.map(function(a){var b=a[0];a[1];return b})),d("WAWebDBBulkGetRootMsgs").bulkGetRootMsgs(g)])),j=i[0],l=i[1],m=new Map(g.map(function(a,b){return[a,l[b]]}));i=j.map(function(a,b){b=f[b];var c=b[0],d=c[0];c=c[1];b=b[1];if(!b)return null;if(!a)return{delivery:b.delivery,read:b.read,played:b.played,msgKey:d,receiverUserJid:c,deviceDelivered:Array.from(b.deviceDelivered),deviceNotDelivered:[]};var e=b.deviceDelivered;a.deviceDelivered.forEach(function(a){return e.add(a)});return{delivery:q(a.delivery,b.delivery),read:q(a.read,b.read),played:q(a.played,b.played),msgKey:a.msgKey,receiverUserJid:a.receiverUserJid,deviceDelivered:Array.from(e),deviceNotDelivered:a.deviceNotDelivered.filter(function(a){return!e.has(a)})}}).filter(Boolean);d("WALogger").DEV(k(),JSON.stringify(i));yield d("WAWebSchemaMessageInfo").getMessageInfoTable().bulkCreateOrReplace(i);j=(yield e.$7(a,g));i=Array.from(j.entries()).map(function(a){var b=a[0];a=a[1];var d=c("WAWebMsgKey").fromString(b);d=d.remote;if(d.isUser()||d.isGroup()||d.isStatusV3()){d=m.get(b);if(d==null)return;if(a>((b=d.ack)!=null?b:Number.NEGATIVE_INFINITY))return{id:d.id.toString(),ack:a}}}).filter(Boolean);return{ackUpdates:i,receiptMsgKeyToMsg:m}})));yield d("WAWebSchemaMessage").getMessageTable().bulkCreateOrMerge(i.ackUpdates);d("WAWebBackendApi").frontendFireAndForget("updateMsgModelAcks",{updates:i.ackUpdates.map(function(a){var b=a.id;a=a.ack;return{id:c("WAWebMsgKey").from(b),ack:a}})});d("WAWebBackendApi").frontendFireAndForget("updateMsgInfo",{updates:c("lodash").flatMap(a,function(a){var b=a.msgKeys,e=a.ack,f=a.ts,g=a.receiverId;return b.map(function(a){a=i.receiptMsgKeyToMsg.get(a);if(a==null)return;a=c("WAWebMsgKey").from(a.id);if(!a.fromMe)return;if(!(a.remote.isUser()||a.remote.isGroup()||a.remote.isStatusV3()))return;var b=d("WAWebWidFactory").toUserWid(g);if(b.equals(d("WAWebUserPrefsMeUser").getMeUser()))return;return{msgKey:a,ts:f,participant:b,ack:e}})}).filter(Boolean)});this.$6(this.$5(a))["catch"](function(){d("WALogger").ERROR(j())})});function e(b){return a.apply(this,arguments)}return e}();e.$2=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WALogger").DEV(i(),JSON.stringify(a));var b=a.some(function(a){return!a.isOffline});if(b){yield d("WAPromiseMap").promiseMap(a,o);return}b=a.map(function(a){var b=a.ts,c=a.msgKeys;a=a.ack;return{ts:b,msgKeys:c,ack:a}});yield d("WAWebSchemaPeerReadReceipt").getTable().bulkCreate(b)});function c(b){return a.apply(this,arguments)}return c}();return a}();function o(a){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.msgKeys.map(function(a){return c("WAWebMsgKey").from(a)});if(a.remote.isStatusV3()){d("WAWebBackendApi").frontendFireAndForget("handleReadStatus",{msgKeys:b});return d("WAWebBackendApi").frontendSendAndReceive("updateMsgPeerAcks",{msgKeys:b,ack:d("WAWebAck").ACK.READ,t:a.ts})}if((a.remote.isUser()||a.remote.isGroup()||a.remote.isNewsletter())&&a.ack>=d("WAWebAck").ACK.RECEIVED)if(a.ack===d("WAWebAck").ACK.READ)return d("WAWebHandleMsgReceiptCommon").updateChatPeerRead(a.remote,b);else if(a.ack===d("WAWebAck").ACK.PLAYED)return d("WAWebBackendApi").frontendSendAndReceive("updateMsgPeerAcks",{msgKeys:b,ack:a.ack,t:a.ts})});return p.apply(this,arguments)}function q(a,b){if(a!=null&&b!=null)return Math.min(a,b);a=(a=a)!=null?a:b;return(b=a)!=null?b:void 0}e=new f();g.receiptBatcher=e}),98);
__d("WAWebAddonPluginProcessor",["WANullthrows","WAWebMessagePluginProcessAsAddonRegistry"],(function(a,b,c,d,e,f,g){function a(){var a=new Map();for(var b=c("WAWebMessagePluginProcessAsAddonRegistry"),d=Array.isArray(b),e=0,b=d?b:b[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f;if(d){if(e>=b.length)break;f=b[e++]}else{e=b.next();if(e.done)break;f=e.value}f=f;var g=f.type;f=f.processor;f!=null&&a.set(g,f)}return a}var h=a();function b(){return h}function d(a){return c("WANullthrows")(h.get(a))}function e(a){return Boolean(h.get(a))}g.getAddonProcessorsMap=b;g.getAddonProcessor=d;g.hasAddonProcessor=e}),98);
__d("WAWebPluginCreateRegistryLookup",[],(function(a,b,c,d,e,f){function a(a){var b=new Map();for(var a=a,c=Array.isArray(a),d=0,a=c?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var e,f;if(c){if(d>=a.length)break;f=a[d++]}else{d=a.next();if(d.done)break;f=d.value}f=f;var g=f.type;e=(e=f.subtype)!=null?e:null;var h=b.get(g);h==null&&(h=new Map(),b.set(g,h));h.set(e,f)}return function(a,c){return(a=b.get(a))==null?void 0:a.get((a=c)!=null?a:null)}}f.createMsgTypeRegistryLookup=a}),66);
__d("WAWebMessagePluginGenerateReportingTokenContent",["WAWebMessagePluginGenerateReportingTokenContentRegistry","WAWebPluginCreateRegistryLookup"],(function(a,b,c,d,e,f,g){var h=d("WAWebPluginCreateRegistryLookup").createMsgTypeRegistryLookup(c("WAWebMessagePluginGenerateReportingTokenContentRegistry"));function a(a){var b;return(b=h(a.type,a.subtype))==null?void 0:b.generateReportingTokenContent==null?void 0:b.generateReportingTokenContent(a)}function b(a,b){return Boolean((a=h(a,b))==null?void 0:a.generateReportingTokenContent)}g.generateReportingTokenContent=a;g.isMsgTypeReportingTokenCompatible=b}),98);
__d("WAWebGenerateChatReportingTokenContent",[],(function(a,b,c,d,e,f){function a(a){a=new TextEncoder().encode((a=a.body)!=null?a:"");return self.crypto.getRandomValues(new Uint8Array(a.length))}f["default"]=a}),66);
__d("WAWebMessagePluginGenerateReportingTokenContentRegistry",["WAWebGenerateAudioOrPttReportingTokenContent","WAWebGenerateChatReportingTokenContent","WAWebGenerateDocumentReportingTokenContent","WAWebGenerateImageReportingTokenContent","WAWebGenerateInteractiveResponseReportingTokenContent","WAWebGeneratePtvReportingTokenContent","WAWebGenerateStickerReportingTokenContent","WAWebGenerateVideoReportingTokenContent"],(function(a,b,c,d,e,f,g){a=[{type:"audio",subtype:void 0,generateReportingTokenContent:c("WAWebGenerateAudioOrPttReportingTokenContent")},{type:"biz_content_placeholder",subtype:void 0,generateReportingTokenContent:null},{type:"buttons_response",subtype:void 0,generateReportingTokenContent:null},{type:"chat",subtype:"url",generateReportingTokenContent:c("WAWebGenerateChatReportingTokenContent")},{type:"chat",subtype:void 0,generateReportingTokenContent:c("WAWebGenerateChatReportingTokenContent")},{type:"ciphertext",subtype:"bot_unavailable_fanout",generateReportingTokenContent:null},{type:"ciphertext",subtype:"fanout",generateReportingTokenContent:null},{type:"ciphertext",subtype:"hosted_unavailable_fanout",generateReportingTokenContent:null},{type:"ciphertext",subtype:void 0,generateReportingTokenContent:null},{type:"comment",subtype:void 0,generateReportingTokenContent:null},{type:"debug_placeholder",subtype:void 0,generateReportingTokenContent:null},{type:"document",subtype:void 0,generateReportingTokenContent:c("WAWebGenerateDocumentReportingTokenContent")},{type:"event_creation",subtype:void 0,generateReportingTokenContent:null},{type:"event_edit_encrypted",subtype:void 0,generateReportingTokenContent:null},{type:"event_response",subtype:void 0,generateReportingTokenContent:null},{type:"groups_v4_invite",subtype:void 0,generateReportingTokenContent:null},{type:"hsm",subtype:void 0,generateReportingTokenContent:null},{type:"image",subtype:void 0,generateReportingTokenContent:c("WAWebGenerateImageReportingTokenContent")},{type:"interactive",subtype:void 0,generateReportingTokenContent:c("WAWebGenerateInteractiveResponseReportingTokenContent")},{type:"interactive_response",subtype:void 0,generateReportingTokenContent:null},{type:"keep_in_chat",subtype:void 0,generateReportingTokenContent:null},{type:"list",subtype:void 0,generateReportingTokenContent:null},{type:"list_response",subtype:void 0,generateReportingTokenContent:null},{type:"location",subtype:void 0,generateReportingTokenContent:null},{type:"multi_vcard",subtype:void 0,generateReportingTokenContent:null},{type:"native_flow",subtype:void 0,generateReportingTokenContent:null},{type:"newsletter_admin_invite",subtype:void 0,generateReportingTokenContent:null},{type:"notification_template",subtype:"contact_info_card",generateReportingTokenContent:null},{type:"order",subtype:void 0,generateReportingTokenContent:null},{type:"payment",subtype:"ciphertext",generateReportingTokenContent:null},{type:"payment",subtype:"futureproof",generateReportingTokenContent:null},{type:"payment",subtype:"invite",generateReportingTokenContent:null},{type:"payment",subtype:"request",generateReportingTokenContent:null},{type:"payment",subtype:"send",generateReportingTokenContent:null},{type:"pin_message",subtype:void 0,generateReportingTokenContent:null},{type:"pinned_message",subtype:void 0,generateReportingTokenContent:null},{type:"poll_creation",subtype:void 0,generateReportingTokenContent:null},{type:"poll_update",subtype:"poll_vote",generateReportingTokenContent:null},{type:"product",subtype:void 0,generateReportingTokenContent:null},{type:"protocol",subtype:"admin_revoke",generateReportingTokenContent:null},{type:"protocol",subtype:"bot_feedback",generateReportingTokenContent:null},{type:"protocol",subtype:"bot_request_welcome",generateReportingTokenContent:null},{type:"protocol",subtype:"ephemeral_setting",generateReportingTokenContent:null},{type:"protocol",subtype:"ephemeral_sync_response",generateReportingTokenContent:null},{type:"protocol",subtype:"history_sync_notification",generateReportingTokenContent:null},{type:"protocol",subtype:"message_edit",generateReportingTokenContent:null},{type:"protocol",subtype:"sender_revoke",generateReportingTokenContent:null},{type:"protocol",subtype:"share_phone_number",generateReportingTokenContent:null},{type:"ptt",subtype:void 0,generateReportingTokenContent:c("WAWebGenerateAudioOrPttReportingTokenContent")},{type:"ptv",subtype:void 0,generateReportingTokenContent:c("WAWebGeneratePtvReportingTokenContent")},{type:"reaction",subtype:void 0,generateReportingTokenContent:null},{type:"reaction_enc",subtype:void 0,generateReportingTokenContent:null},{type:"request_phone_number",subtype:void 0,generateReportingTokenContent:null},{type:"revoked",subtype:"admin",generateReportingTokenContent:null},{type:"revoked",subtype:"sender",generateReportingTokenContent:null},{type:"sticker",subtype:void 0,generateReportingTokenContent:c("WAWebGenerateStickerReportingTokenContent")},{type:"template_button_reply",subtype:void 0,generateReportingTokenContent:null},{type:"unknown",subtype:"payment_action_request_declined",generateReportingTokenContent:null},{type:"unknown",subtype:"payment_transaction_request_cancelled",generateReportingTokenContent:null},{type:"unknown",subtype:"phone",generateReportingTokenContent:null},{type:"unknown",subtype:"phone_only_feature",generateReportingTokenContent:null},{type:"unknown",subtype:void 0,generateReportingTokenContent:null},{type:"vcard",subtype:void 0,generateReportingTokenContent:null},{type:"video",subtype:void 0,generateReportingTokenContent:c("WAWebGenerateVideoReportingTokenContent")}];g["default"]=a}),98);
__d("WAWebProcessEncryptedEventEditMsgs",["Promise","WALogger","WAWebAddOnEncryption","WAWebAddonInfraError","WAWebEventsValidationError","WAWebMsgGetters","WAWebMsgType","WAWebProtobufsE2E.pb","WAWebWamEnumE2eFailureReason","WAWebWidFactory","asyncToGeneratorRuntime","decodeProtobuf"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Processing encrypted event edit failed: ","\n",""],["Processing encrypted event edit failed: ","\\n",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Processing encrypted event edit failed: ",""]);j=function(){return a};return a}function a(a,b){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){var e=new Map();a.forEach(function(a){if(a.kind!==d("WAWebMsgType").MsgKind.EventEditEncrypted)throw new(d("WAWebAddonInfraError").AddonInfraError)(d("WAWebAddonInfraError").AddonInfraErrorCode.UnexpectedMsgType);var b=c.get(a.targetMessageKey.toString());if(b==null)throw new(d("WAWebAddonInfraError").AddonInfraError)(d("WAWebAddonInfraError").AddonInfraErrorCode.MissingParentMsg);e.set(a,b)});if(e.size===0)return[];a=(yield (h||(h=b("Promise"))).allSettled(Array.from(e.entries()).map(function(a){var b=a[0];a=a[1];return l(b,a)})));return a.map(function(a){switch(a.status){case"fulfilled":return a.value;case"rejected":a=a.reason;if(a instanceof d("WAWebEventsValidationError").EventCreationValidationError||a instanceof d("WAWebEventsValidationError").EncryptedEventEditValidationError){d("WALogger").ERROR(j(),a.code).sendLogs(a.code);return}d("WALogger").ERROR(i(),a.message,a.stack).sendLogs("event_edit_unknown_error")}}).filter(Boolean)});return k.apply(this,arguments)}function l(a,b){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=a.encIv,e=a.encPayload,f=b.messageSecret,g=d("WAWebMsgGetters").getOriginalSender(b);a=d("WAWebMsgGetters").getSender(a);if(a==null)throw new(d("WAWebEventsValidationError").EncryptedEventEditValidationError)(d("WAWebEventsValidationError").EncryptedEventEditValidationErrorCode.EVENT_EDIT_MISSING_MESSAGE_SENDER,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(g==null)throw new(d("WAWebEventsValidationError").EventCreationValidationError)(d("WAWebEventsValidationError").EventCreationValidationErrorCode.EVENT_CREATION_MISSING_MESSAGE_SENDER,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(c==null)throw new(d("WAWebEventsValidationError").EncryptedEventEditValidationError)(d("WAWebEventsValidationError").EncryptedEventEditValidationErrorCode.EVENT_EDIT_MISSING_ENC_IV,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(e==null)throw new(d("WAWebEventsValidationError").EncryptedEventEditValidationError)(d("WAWebEventsValidationError").EncryptedEventEditValidationErrorCode.EVENT_EDIT_MISSING_ENC_PAYLOAD,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(f==null)throw new(d("WAWebEventsValidationError").EventCreationValidationError)(d("WAWebEventsValidationError").EventCreationValidationErrorCode.MISSING_MESSAGE_SECRET,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.MISSING_MESSAGE_SECRET);e={type:"event_edit_encrypted",encryptedAddOn:e};a=d("WAWebWidFactory").toUserWid(a);e=(yield d("WAWebAddOnEncryption").decryptAddOn(e,{messageSecret:f,iv:c,stanzaId:b.id.id,originalMessageSender:g,addOnSender:a}));f=d("decodeProtobuf").decodeProtobuf(d("WAWebProtobufsE2E.pb").MessageSpec,e);return f});return m.apply(this,arguments)}g.processEncryptedEventEditMsgs=a}),98);
__d("WAWebEventEditAddonMessageProcessor",["Promise","WAWebAddonCreateMsgProcessor","WAWebEventsGatingUtils","WAWebProcessEncryptedEventEditMsgs","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;a=d("WAWebAddonCreateMsgProcessor").createAddonMsgProcessor({isEnabled:d("WAWebEventsGatingUtils").isEventsEditReceivingEnabled,convert:{fromHistorySyncMsg:function(){return(h||(h=b("Promise"))).resolve([])}},parentKey:"targetMessageKey",updateCollection:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){});function c(){return a.apply(this,arguments)}return c}(),beforeUpsert:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){yield d("WAWebProcessEncryptedEventEditMsgs").processEncryptedEventEditMsgs(a,c);return(h||(h=b("Promise"))).resolve({result:[],upsert:[]})});function c(b,c){return a.apply(this,arguments)}return c}(),afterUpsert:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){});function c(){return a.apply(this,arguments)}return c}()});c=a;g["default"]=c}),98);
__d("WAWebAddOnParseWebMsgInfo",["WALongInt","WANullthrows","WAWebE2EProtoUtils","WAWebMsgKey","WAWebUserPrefsMeUser","WAWebWidFactory"],(function(a,b,c,d,e,f,g){function a(a,b,e){var f=!!a.fromMe,g=d("WAWebE2EProtoUtils").decodeJid(a.remoteJid),h;f?g!=null&&typeof g!=="string"&&!g.isUser()&&(b===!0?h=d("WAWebUserPrefsMeUser").getMaybeMeLidUser():h=d("WAWebUserPrefsMeUser").getMeUser()):h=e!=null?d("WAWebE2EProtoUtils").decodeJid(e):d("WAWebE2EProtoUtils").decodeJid(a.participant);if(typeof g==="string"||g==null)return null;h!=null&&typeof h!=="string"?e=new(c("WAWebMsgKey"))({id:c("WANullthrows")(a.id),fromMe:f,remote:g,participant:h}):e=new(c("WAWebMsgKey"))({id:c("WANullthrows")(a.id),fromMe:f,remote:g});a=b===!0?c("WANullthrows")(d("WAWebUserPrefsMeUser").getMaybeMeLidUser()):d("WAWebUserPrefsMeUser").getMeUser();g=e.participant||e.remote;b=d("WAWebWidFactory").toUserWid(f===!0?a:g);return{msgKey:e,sender:b}}function b(a){return a==null?null:Math.floor(d("WALongInt").numberOrThrowIfTooLarge(a)/1e3)}g.buildAddonMsgKey=a;g.getAddonServerTimestamp=b}),98);
__d("WAWebEventResponseMsgDataConversion",["WANullthrows","WAWebE2EProtoUtils","WAWebMsgKeyUtils","WAWebMsgType"],(function(a,b,c,d,e,f,g){function a(a){var b;return babelHelpers["extends"]({id:a.id},d("WAWebMsgKeyUtils").msgKeyToTargetInfo(a.id,d("WAWebE2EProtoUtils").TranslateMsgKeyType.Addon),{type:d("WAWebMsgType").MSG_TYPE.EVENT_RESPONSE,kind:d("WAWebMsgType").MsgKind.EventResponseDecrypted,parentMsgKey:a.parentMsgKey,eventResponse:c("WANullthrows")(a.responseProtobuf.response,"eventResponse"),senderTimestampMs:a.senderTimestampMs,t:(b=a.t)!=null?b:void 0,read:a.read,ack:(b=a.ack)!=null?b:void 0})}g.protobufToEventResponseMsgData=a}),98);
__d("WAWebEventsParseWebMsgInfoEventResponse",["WALogger","WALongInt","WANullthrows","WAWebAddOnParseWebMsgInfo","WAWebEventResponseMsgDataConversion","WAWebMsgType","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[history sync] parseWebMsgInfoEventResponses failed with error "," "," and stack ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[history sync] Failed to parse eventResponse with error ",""]);i=function(){return a};return a}function a(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.webMsgInfo,e=a.parsedWebMsgInfo,f=a.isFromCag;try{if(!(b==null?void 0:b.eventResponses)||!e||e.type!==d("WAWebMsgType").MSG_TYPE.EVENT_CREATION)return[];var g=e;return b.eventResponses.map(function(a){try{var b,e=(b=c("WANullthrows"))(a.eventResponseMessageKey,"eventResponseMessageKey"),h=b(a.eventResponseMessage,"eventResponseMessage");e=b(d("WAWebAddOnParseWebMsgInfo").buildAddonMsgKey(e,f));e=e.msgKey;return d("WAWebEventResponseMsgDataConversion").protobufToEventResponseMsgData({responseProtobuf:h,id:e,parentMsgKey:g.id,senderTimestampMs:d("WALongInt").numberOrThrowIfTooLarge(b(h.timestampMs,"senderTimestampMs")),t:d("WAWebAddOnParseWebMsgInfo").getAddonServerTimestamp(a.timestampMs),ack:null,read:a.unread!==!0})}catch(a){d("WALogger").ERROR(i(),a.message).devConsole(a).sendLogs("parseWebMsgInfoEventResponses-responses-parse-error");return null}}).filter(Boolean)}catch(a){d("WALogger").ERROR(h(),a==null?void 0:a.name,a==null?void 0:a.code,a==null?void 0:a.stack).sendLogs("parseWebMsgInfoEventResponses-error");return[]}});return j.apply(this,arguments)}g.parseWebMsgInfoEventResponses=a}),98);
__d("WAWebPrepareEventResponsesToUpsert",["WANullthrows","WAWebAddonDBTable","WAWebMaxPerGroup","WAWebMsgGetters","WAWebMsgType","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(a){return a.parentMsgKey.toString()+"-"+c("WANullthrows")(d("WAWebMsgGetters").getSender(a)).toString()}function i(a){return d("WAWebMaxPerGroup").maxPerGroup(a,function(a){return a.senderTimestampMs},h)}function a(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.map(function(a){return[a.parentMsgKey,c("WANullthrows")(d("WAWebMsgGetters").getSender(a))]});a=i(a);b=(yield d("WAWebAddonDBTable").addonDBTable.bulkGetByParentAndSender(d("WAWebMsgType").MSG_TYPE.EVENT_RESPONSE,b));var e=new Map();b.forEach(function(a){a.kind===d("WAWebMsgType").MsgKind.EventResponseDecrypted&&e.set(h(a),a)});var f=[];a.forEach(function(a){var b=e.get(h(a));if(b!=null&&b.senderTimestampMs>a.senderTimestampMs)return;var c=b!=null&&b.eventResponse===a.eventResponse;b=(b=b==null?void 0:b.read)!=null?b:!1;c=c&&b&&a.read!==b?babelHelpers["extends"]({},a,{read:!0}):a;f.push(c)});return f});return j.apply(this,arguments)}g.getNewestEventResponses=i;g.prepareEventResponsesToUpsert=a}),98);
__d("WAWebProcessEncryptedEventResponseMsgs",["Promise","WALogger","WALongInt","WANullthrows","WAWebAddOnEncryption","WAWebAddonInfraError","WAWebEventResponseMsgDataConversion","WAWebEventsValidationError","WAWebMsgGetters","WAWebProtobufsE2E.pb","WAWebUserPrefsMeUser","WAWebWamEnumE2eFailureReason","WAWebWidFactory","asyncToGeneratorRuntime","decodeProtobuf"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Processing encrypted event response failed: ","\n",""],["Processing encrypted event response failed: ","\\n",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Processing encrypted event response failed: ",""]);j=function(){return a};return a}function a(a,b){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){var e=[],f=new Map();a.forEach(function(a){if(a.addonEncrypted){var b=c.get(a.targetMessageKey.toString());if(b==null)throw new(d("WAWebAddonInfraError").AddonInfraError)(d("WAWebAddonInfraError").AddonInfraErrorCode.MissingParentMsg);f.set(a,b)}else e.push(a)});if(f.size===0)return e;a=(yield (h||(h=b("Promise"))).allSettled(Array.from(f.entries()).map(function(a){var b=a[0];a=a[1];return l(b,a)})));return e.concat(a.map(function(a){switch(a.status){case"fulfilled":return a.value;case"rejected":a=a.reason;if(a instanceof d("WAWebEventsValidationError").EventCreationValidationError||a instanceof d("WAWebEventsValidationError").EncryptedEventResponseValidationError){d("WALogger").ERROR(j(),a.code).sendLogs(a.code);return}d("WALogger").ERROR(i(),a.message,a.stack).sendLogs("unknown-error")}}).filter(Boolean))});return k.apply(this,arguments)}function l(a,b){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e=a.encIv,f=a.encPayload,g=b.messageSecret,h=d("WAWebMsgGetters").getOriginalSender(b),i=d("WAWebMsgGetters").getSender(a);if(i==null)throw new(d("WAWebEventsValidationError").EncryptedEventResponseValidationError)(d("WAWebEventsValidationError").EncryptedEventResponseValidationErrorCode.EVENT_RESPONSE_MISSING_MESSAGE_SENDER,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(h==null)throw new(d("WAWebEventsValidationError").EventCreationValidationError)(d("WAWebEventsValidationError").EventCreationValidationErrorCode.EVENT_CREATION_MISSING_MESSAGE_SENDER,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(e==null)throw new(d("WAWebEventsValidationError").EncryptedEventResponseValidationError)(d("WAWebEventsValidationError").EncryptedEventResponseValidationErrorCode.EVENT_RESPONSE_MISSING_ENC_IV,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(f==null)throw new(d("WAWebEventsValidationError").EncryptedEventResponseValidationError)(d("WAWebEventsValidationError").EncryptedEventResponseValidationErrorCode.EVENT_RESPONSE_MISSING_ENC_PAYLOAD,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(g==null)throw new(d("WAWebEventsValidationError").EventCreationValidationError)(d("WAWebEventsValidationError").EventCreationValidationErrorCode.MISSING_MESSAGE_SECRET,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.MISSING_MESSAGE_SECRET);f={type:"event_response",encryptedAddOn:f};i=d("WAWebWidFactory").toUserWid(i);f=(yield d("WAWebAddOnEncryption").decryptAddOn(f,{messageSecret:g,iv:e,stanzaId:b.id.id,originalMessageSender:h,addOnSender:i}));g=d("decodeProtobuf").decodeProtobuf(d("WAWebProtobufsE2E.pb").Message$EventResponseMessageSpec,f);return d("WAWebEventResponseMsgDataConversion").protobufToEventResponseMsgData({responseProtobuf:g,parentMsgKey:a.targetMessageKey,id:a.id,senderTimestampMs:d("WALongInt").numberOrThrowIfTooLarge(c("WANullthrows")(g.timestampMs)),t:d("WAWebMsgGetters").getT(a),ack:(e=a.ack)!=null?e:null,read:d("WAWebUserPrefsMeUser").isMeAccount(i)})});return m.apply(this,arguments)}g.processEncryptedEventResponseMsgs=a}),98);
__d("WAWebEventResponseAddonMessageProcessor",["Promise","WAWebAddonCreateMsgProcessor","WAWebBackendApi","WAWebEventsGatingUtils","WAWebEventsParseWebMsgInfoEventResponse","WAWebPrepareEventResponsesToUpsert","WAWebProcessEncryptedEventResponseMsgs","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;a=d("WAWebAddonCreateMsgProcessor").createAddonMsgProcessor({isEnabled:d("WAWebEventsGatingUtils").isEventsReceivingEnabled,convert:{fromHistorySyncMsg:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){return d("WAWebEventsParseWebMsgInfoEventResponse").parseWebMsgInfoEventResponses(a)});function c(b){return a.apply(this,arguments)}return c}()},parentKey:"targetMessageKey",updateCollection:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("WAWebBackendApi").frontendSendAndReceive("upsertEventResponsesModelCollection",{eventResponses:a.add})});function c(b){return a.apply(this,arguments)}return c}(),beforeUpsert:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){a=(yield d("WAWebProcessEncryptedEventResponseMsgs").processEncryptedEventResponseMsgs(a,c));c=(yield d("WAWebPrepareEventResponsesToUpsert").prepareEventResponsesToUpsert(a));return(h||(h=b("Promise"))).resolve({result:c,upsert:c})});function c(b,c){return a.apply(this,arguments)}return c}(),afterUpsert:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){});function c(){return a.apply(this,arguments)}return c}()});c=a;g["default"]=c}),98);
__d("WAWebPollsParseWebMsgInfoPollUpdates",["WALogger","WALongInt","WANullthrows","WAWebAddOnParseWebMsgInfo","WAWebMsgType","WAWebPollsCreateOptionLocalIdMap","WAWebPollsProtobufConversion","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[history sync] parseWebMsgInfoPollUpdates failed with error "," and stack ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[history sync] Failed to parse pollUpdate with error ",""]);i=function(){return a};return a}function a(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.webMsgInfo,e=a.parsedWebMsgInfo,f=a.isFromCag;try{if(b==null||b.pollUpdates==null)return[];if(e==null||e.type!==d("WAWebMsgType").MSG_TYPE.POLL_CREATION)return[];var g=e,j=(yield d("WAWebPollsCreateOptionLocalIdMap").createOptionLocalIdMap(g.pollOptions));return b.pollUpdates.map(function(a){try{var b,e=(b=c("WANullthrows"))(a.pollUpdateMessageKey),h=b(a.vote);e=b(d("WAWebAddOnParseWebMsgInfo").buildAddonMsgKey(e,f));var k=e.msgKey;e=e.sender;return d("WAWebPollsProtobufConversion").voteFromProtobuf({voteProtobuf:h,pollVoteMsgKey:k,parentMsgKey:g.id,sender:e,senderTimestampMs:d("WALongInt").numberOrThrowIfTooLarge(b(a.senderTimestampMs)),t:d("WAWebAddOnParseWebMsgInfo").getAddonServerTimestamp(a.serverTimestampMs),optionLocalIdMap:j,ack:null,read:a.unread!==!0})}catch(a){d("WALogger").ERROR(i(),a).devConsole(a).sendLogs("parseWebMsgInfoPollUpdates-vote-parse-error");return null}}).filter(Boolean)}catch(a){d("WALogger").ERROR(h(),a==null?void 0:a.name,a==null?void 0:a.stack).sendLogs("parseWebMsgInfoPollUpdates-error");return[]}});return j.apply(this,arguments)}g.parseWebMsgInfoPollUpdates=a}),98);
__d("WAWebPollVoteAddonMessageProcessor",["Promise","WAWebABProps","WAWebAddonConstants","WAWebAddonCreateMsgProcessor","WAWebAddonInfraError","WAWebBackendApi","WAWebDBMarkFutureproofMessagesReparsed","WAWebDBUpdateLastAddOnPreviewChat","WAWebLastAddOnDBSerialization","WAWebPollsExtractVotes","WAWebPollsParseWebMsgInfoPollUpdates","WAWebPollsVoteDataUtils","WAWebShouldUpdateLastAddOnPreview","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;a=d("WAWebAddonCreateMsgProcessor").createAddonMsgProcessor({isEnabled:function(){return d("WAWebABProps").getABPropConfigValue("unified_poll_vote_addon_infra_enabled")},convert:{fromHistorySyncMsg:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){return d("WAWebPollsParseWebMsgInfoPollUpdates").parseWebMsgInfoPollUpdates(a).then(function(a){return a.map(d("WAWebPollsVoteDataUtils").voteDataToPollVoteMsgData)})});function c(b){return a.apply(this,arguments)}return c}()},parentKey:"pollUpdateParentKey",updateCollection:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.add;return d("WAWebBackendApi").frontendSendAndReceive("upsertVotesModelCollection",{votes:a.map(d("WAWebPollsVoteDataUtils").pollVoteMsgDataToVoteData),restoredFromDb:!1})});function c(b){return a.apply(this,arguments)}return c}(),beforeUpsert:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){var e=[],f=new Map();for(a of a)if(a.addonEncrypted){var g=c.get(a.pollUpdateParentKey.toString());if(g==null)throw new(d("WAWebAddonInfraError").AddonInfraError)(d("WAWebAddonInfraError").AddonInfraErrorCode.MissingParentMsg);f.set(a,g)}else e.push(a);if(f.size>0){g=(yield d("WAWebPollsExtractVotes").extractVotes(f));for(c of g)e.push(d("WAWebPollsVoteDataUtils").voteDataToPollVoteMsgData(c))}return(h||(h=b("Promise"))).resolve({result:e,upsert:e})});function c(b,c){return a.apply(this,arguments)}return c}(),afterUpsert:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){yield d("WAWebBackendApi").frontendSendAndReceive("upsertVotesModelCollection",{votes:a.map(d("WAWebPollsVoteDataUtils").pollVoteMsgDataToVoteData),restoredFromDb:!1});var e=(yield d("WAWebShouldUpdateLastAddOnPreview").filterChatsWithAddOnPreviewUpdates(a.map(function(a){return d("WAWebLastAddOnDBSerialization").lastAddOnPreviewCandidateFromVoteData(d("WAWebPollsVoteDataUtils").pollVoteMsgDataToVoteData(a),!1)})));e.size>0&&(yield d("WAWebDBUpdateLastAddOnPreviewChat").updateDatabaseForLastAddOnPreview(e),d("WAWebBackendApi").frontendFireAndForget("updateChatLastAddOnPreview",{chatMap:e}));if(c.mode===d("WAWebAddonConstants").AddonProcessMode.OnlineReceive){e=b("WAWebDBMarkFutureproofMessagesReparsed");c=e.markFutureproofMessagesReparsed;yield c(a.map(function(a){return a.id.toString()}))}});function c(b,c){return a.apply(this,arguments)}return c}()});c=a;g["default"]=c}),98);
__d("WAWebReactAddonMessageProcessorUtils",["WANullthrows","WAWebAddonDBTable","WAWebCastToReactionMsg","WAWebMsgGetters","WAWebMsgType","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(a){return[a.reactionParentKey,c("WANullthrows")(d("WAWebMsgGetters").getSender(a))]}function i(a){return h(a).map(function(a){return a.toString()}).join("-")}function a(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=new Map();a=a.map(h);a=(yield d("WAWebAddonDBTable").addonDBTable.bulkGetByParentAndSender(d("WAWebMsgType").MSG_TYPE.REACTION,a));for(a of a){var c=d("WAWebCastToReactionMsg").assertReactionMsgData(a),e=i(c);b.set(e,c.reactionTimestamp)}return function(a){a=i(a);return b.get(a)}});return j.apply(this,arguments)}g.createGetReactionTimestamp=a}),98);
__d("WAWebReactionAddonMessageProcessor",["Promise","WAWebABProps","WAWebAddonConstants","WAWebAddonCreateMsgProcessor","WAWebApiChat","WAWebBackendApi","WAWebDBMarkFutureproofMessagesReparsed","WAWebLastAddOnDBSerialization","WAWebReactAddonMessageProcessorUtils","WAWebReactionDataUtils","WAWebShouldUpdateLastAddOnPreview","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;a=d("WAWebAddonCreateMsgProcessor").createAddonMsgProcessor({isEnabled:function(){return d("WAWebABProps").getABPropConfigValue("unified_reaction_addon_infra_enabled")},convert:{fromHistorySyncMsg:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){return[]});function c(b){return a.apply(this,arguments)}return c}()},parentKey:"reactionParentKey",updateCollection:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.add;yield d("WAWebBackendApi").frontendSendAndReceive("updateReactionCollection",{msgs:a})});function c(b){return a.apply(this,arguments)}return c}(),beforeUpsert:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){var e=(yield d("WAWebReactAddonMessageProcessorUtils").createGetReactionTimestamp(a));c=a.filter(function(a){var b=e(a);return b==null||b<a.reactionTimestamp});return(h||(h=b("Promise"))).resolve({result:c,upsert:c})});function c(b,c){return a.apply(this,arguments)}return c}(),afterUpsert:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){var e=(yield d("WAWebShouldUpdateLastAddOnPreview").filterChatsWithAddOnPreviewUpdates(a.map(function(a){return d("WAWebLastAddOnDBSerialization").lastAddOnPreviewCandidateFromReactionRowType(d("WAWebReactionDataUtils").reactionMsgDataToReactionRow(a))})));e.size>0&&(yield d("WAWebApiChat").bulkUpdateChatLastAddOnPreview(e),d("WAWebBackendApi").frontendFireAndForget("updateChatLastAddOnPreview",{chatMap:e}));if(c.mode===d("WAWebAddonConstants").AddonProcessMode.OnlineReceive){e=b("WAWebDBMarkFutureproofMessagesReparsed");c=e.markFutureproofMessagesReparsed;yield c(a.map(function(a){return a.id.toString()}))}});function c(b,c){return a.apply(this,arguments)}return c}()});c=a;g["default"]=c}),98);
__d("WAWebMessagePluginProcessAsAddonRegistry",["WAWebAddonCommentMsgProcessor","WAWebEventEditAddonMessageProcessor","WAWebEventResponseAddonMessageProcessor","WAWebPinAddonMessageProcessor","WAWebPollVoteAddonMessageProcessor","WAWebReactionAddonMessageProcessor"],(function(a,b,c,d,e,f,g){a=[{type:"audio",processor:null},{type:"biz_content_placeholder",processor:null},{type:"buttons_response",processor:null},{type:"chat",processor:null},{type:"chat",processor:null},{type:"ciphertext",processor:null},{type:"ciphertext",processor:null},{type:"ciphertext",processor:null},{type:"ciphertext",processor:null},{type:"comment",processor:c("WAWebAddonCommentMsgProcessor")},{type:"debug_placeholder",processor:null},{type:"document",processor:null},{type:"event_creation",processor:null},{type:"event_edit_encrypted",processor:c("WAWebEventEditAddonMessageProcessor")},{type:"event_response",processor:c("WAWebEventResponseAddonMessageProcessor")},{type:"groups_v4_invite",processor:null},{type:"hsm",processor:null},{type:"image",processor:null},{type:"interactive",processor:null},{type:"interactive_response",processor:null},{type:"keep_in_chat",processor:null},{type:"list",processor:null},{type:"list_response",processor:null},{type:"location",processor:null},{type:"multi_vcard",processor:null},{type:"native_flow",processor:null},{type:"newsletter_admin_invite",processor:null},{type:"notification_template",processor:null},{type:"order",processor:null},{type:"payment",processor:null},{type:"payment",processor:null},{type:"payment",processor:null},{type:"payment",processor:null},{type:"payment",processor:null},{type:"pin_message",processor:c("WAWebPinAddonMessageProcessor")},{type:"pinned_message",processor:null},{type:"poll_creation",processor:null},{type:"poll_update",processor:c("WAWebPollVoteAddonMessageProcessor")},{type:"product",processor:null},{type:"protocol",processor:null},{type:"protocol",processor:null},{type:"protocol",processor:null},{type:"protocol",processor:null},{type:"protocol",processor:null},{type:"protocol",processor:null},{type:"protocol",processor:null},{type:"protocol",processor:null},{type:"protocol",processor:null},{type:"ptt",processor:null},{type:"ptv",processor:null},{type:"reaction",processor:c("WAWebReactionAddonMessageProcessor")},{type:"reaction_enc",processor:null},{type:"request_phone_number",processor:null},{type:"revoked",processor:null},{type:"revoked",processor:null},{type:"sticker",processor:null},{type:"template_button_reply",processor:null},{type:"unknown",processor:null},{type:"unknown",processor:null},{type:"unknown",processor:null},{type:"unknown",processor:null},{type:"unknown",processor:null},{type:"vcard",processor:null},{type:"video",processor:null}];g["default"]=a}),98);
__d("WAWebOffdStorageUpdateOfflinePeerReceipts",["Promise","WAJids","WALogger","WAWebAck","WAWebBackendApi","WAWebDBMsgUtils","WAWebMarkAddOnsAsReadJob","WAWebModelStorageUtils","WAWebMsgGetters","WAWebMsgKey","WAWebQplQuickPerformanceLoggerMarkerIds","WAWebQplQuickPerformanceLoggerModule","WAWebSchemaMessage","WAWebSchemaPeerReadReceipt","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[init-from-storage]: getUpdatesForPeerReadReceipts: found "," pendingReadMessages"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[init-from-storage]: updatePeerReceipts: finish update add-on tables"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[init-from-storage]: updatePeerReceipts: finish update chat/message table"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[init-from-storage]: updatePeerReceipts: finish compute peer played updates"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[init-from-storage]: updatePeerReceipts: finish compute peer receipt updates"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["updatePeerReceipts: unknown ack type: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[init-from-storage]: updatePeerReceipts: find "," peer receipts"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[init-from-storage]: updatePeerReceipts: start updatePeerReceipts"]);p=function(){return a};return a}function a(){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a;d("WAWebQplQuickPerformanceLoggerModule").QPL.markerPoint(d("WAWebQplQuickPerformanceLoggerMarkerIds").QuickLogMarkerId.OFFLINE_RESUME,"UpdatePeerReceipts_start");(a=d("WALogger")).DEV(p());var e=(yield d("WAWebSchemaPeerReadReceipt").getTable().all());a.DEV(o(),e.length);var f=[],g=[];e.forEach(function(a){a.ack===d("WAWebAck").ACK.READ?f.push(a):a.ack===d("WAWebAck").ACK.PLAYED?g.push(a):d("WALogger").WARN(n(),a.ack)});e=(yield r(f));var i=e.chatUpdates;e=e.ackUpdates;a.DEV(m());var q=new Map(e.map(function(a){return[a.id,a]}));e=u(g);e.forEach(function(a){var b=q.get(a.id);b==null?q.set(a.id,a):q.set(a.id,babelHelpers["extends"]({},b,{ack:a.ack}))});var s=Array.from(q.values());a.DEV(l());d("WAWebBackendApi").frontendFireAndForget("updateOfflinePeerReceipt",{chatUpdates:i.map(function(a){return{chatId:a.id,unreadCount:a.unreadCount,unreadMentionsOfMe:(a=a.unreadMentionsOfMe)!=null?a:[]}}),ackUpdates:s.map(function(a){return{msgKey:a.id,ack:a.ack}})});yield (h||(h=b("Promise"))).all([d("WAWebModelStorageUtils").getStorage().lock(["message","chat"],function(a){var c=a[0];a=a[1];return(h||(h=b("Promise"))).all([c.bulkCreateOrMerge(s),a.bulkCreateOrMerge(i)])}).then(function(){d("WALogger").DEV(k())}),d("WAWebMarkAddOnsAsReadJob").markUnclassifiedAddOnsAsReadJob(Array.from(t(f)).map(function(a){return c("WAWebMsgKey").from(a)})).then(function(){d("WALogger").DEV(j())})]);return d("WAWebSchemaPeerReadReceipt").getTable().clear().then(function(){d("WAWebQplQuickPerformanceLoggerModule").QPL.markerPoint(d("WAWebQplQuickPerformanceLoggerMarkerIds").QuickLogMarkerId.OFFLINE_RESUME,"UpdatePeerReceipts_end")})});return q.apply(this,arguments)}function r(a){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=t(a),e=h(a);h=Array.from(e.keys());var f=(yield d("WAWebSchemaMessage").getMessageTable().anyOf(["from","pendingReadReceipt"],h.map(function(a){return[a,d("WAWebDBMsgUtils").PendingReadReceiptType.Message]}),{shouldDecrypt:!1}));d("WALogger").DEV(i(),f.length);f.forEach(function(a){return j(e.get(a.from),a)});f.forEach(function(a){return k(e.get(a.from),a)});a=l(f).concat(m(b));l=h.map(function(a){var b=e.get(a);return b!=null&&b.lastUnreadMsgRowId!=null?{id:a,unreadCount:b.unreadCount,unreadMentionsOfMe:b.unreadMentionsOfMe}:null}).filter(Boolean);return{chatUpdates:l,ackUpdates:a};function g(a){return c("WAWebMsgKey").fromString(a).remote.toString()}function h(a){return new Map(a.flatMap(function(a){return a.msgKeys}).map(g).filter(function(a){return a!==d("WAJids").STATUS_JID}).map(function(a){return[a,{unreadCount:0,lastUnreadMsgRowId:void 0,unreadMentionsOfMe:[],unreadMentionCount:0}]}))}function j(a,c){var d=c.rowId;c=c.id;if(a==null||d==null)return;b.has(c)&&(a.lastUnreadMsgRowId==null||d>a.lastUnreadMsgRowId)&&(a.lastUnreadMsgRowId=d)}function k(a,b){var c=b.rowId;if(a==null||c==null||a.lastUnreadMsgRowId==null)return;if(c>a.lastUnreadMsgRowId){a.unreadCount+=1;if(d("WAWebMsgGetters").getIsImportantMessage(b)){c={id:b.id,timestamp:b.t};a.unreadMentionsOfMe.push(c)}}}function l(a){return f.flatMap(function(a){var b=a.rowId,c=e.get(a.from);if(c==null||b==null||c.lastUnreadMsgRowId==null)return[];return b<=c.lastUnreadMsgRowId?[{id:a.id,ack:d("WAWebAck").ACK.READ,pendingReadReceipt:null}]:[]})}function m(a){return Array.from(a).filter(function(a){return g(a)===d("WAJids").STATUS_JID}).map(function(a){return{id:a,ack:d("WAWebAck").ACK.READ}})}});return s.apply(this,arguments)}function t(a){return new Set(a.flatMap(function(a){return a.msgKeys}))}function u(a){var b=new Set();a.forEach(function(a){a.ack===d("WAWebAck").ACK.PLAYED&&a.msgKeys.forEach(function(a){return b.add(a)})});return Array.from(b).map(function(a){return{id:a,ack:d("WAWebAck").ACK.PLAYED,pendingReadReceipt:null}})}g.updatePeerReceipts=a}),98);
__d("WAWebSchemaPendingDeviceSync",["WAWebOffdStorageUtils","WAWebStorageMutationBuilder"],(function(a,b,c,d,e,f,g){c=d("WAWebStorageMutationBuilder").columnBuilder();var h=c.addUserDefinedPrimaryKey;function a(){d("WAWebOffdStorageUtils").getStorage().add("pending-device-sync").version(d("WAWebOffdStorageUtils").getStorage().versions.version(4),[h("id")]).view(function(a){return a})}function b(){return d("WAWebOffdStorageUtils").getStorage().table("pending-device-sync")}g.addTable=a;g.getTable=b}),98);
__d("WAWebApiPendingDeviceSync",["WALogger","WAWebSchemaPendingDeviceSync","WAWebSyncDeviceAdvDeviceListJob","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["doPendingDeviceSync failed during RESUME_WITH_OPEN_TAB"]);h=function(){return a};return a}function a(){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{var a=(yield d("WAWebSchemaPendingDeviceSync").getTable().all()),c=b("WAWebSyncDeviceAdvDeviceListJob").syncDeviceListJob;yield c(a.map(function(a){return d("WAWebWidFactory").createWid(a.id)}),null,null);yield d("WAWebSchemaPendingDeviceSync").getTable().bulkRemove(a.map(function(a){return a.id}))}catch(a){d("WALogger").ERROR(h()).verbose().devConsole(a)}});return i.apply(this,arguments)}function c(a){return d("WAWebSchemaPendingDeviceSync").getTable().bulkCreateOrMerge(a.map(function(a){return{id:a}}))}g.doPendingDeviceSync=a;g.addUserToPendingDeviceSync=c}),98);
__d("WAWebChatDbUpdatesApi",["WAWebBackendApi","WAWebSchemaChat","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("WAWebSchemaChat").getChatTable().bulkCreateOrMerge(a);a=a.map(function(a){return{id:d("WAWebWidFactory").createWid(a.id),archive:a.archive}});d("WAWebBackendApi").frontendFireAndForget("chatCollectionUpdate",{updates:a})});return h.apply(this,arguments)}g.setArchive=a}),98);
__d("WAWebMsgRangeContainmentHandlers",["WALogger","WAWebApiActiveMessageRanges","WAWebBackendApi","WAWebChatDbUpdatesApi","WAWebHandleForMessageRangeEnums","WAWebUserPrefsMultiDevice","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleForArchive: Unarchiving chat due to an incoming message"]);h=function(){return a};return a}function a(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(b===d("WAWebHandleForMessageRangeEnums").RangeContain.DOES_NOT_CONTAIN){b=(yield d("WAWebUserPrefsMultiDevice").getArchiveV2EnabledSetting());var c=(yield d("WAWebUserPrefsMultiDevice").getUnarchiveChatsSetting());(!b||c)&&(d("WALogger").DEV(h()),d("WAWebChatDbUpdatesApi").setArchive([{id:a.chatId,archive:!1}]));yield d("WAWebApiActiveMessageRanges").removeActiveMessageRange(a.chatId,a.action)}});return i.apply(this,arguments)}function c(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){(b===d("WAWebHandleForMessageRangeEnums").RangeContain.DOES_NOT_CONTAIN||a.remainingMessages===0)&&(yield d("WAWebApiActiveMessageRanges").removeActiveMessageRange(a.chatId,a.action))});return j.apply(this,arguments)}function e(a,b,c){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){b===d("WAWebHandleForMessageRangeEnums").RangeContain.DOES_NOT_CONTAIN?yield d("WAWebApiActiveMessageRanges").removeActiveMessageRange(a.chatId,a.action):a.remainingMessages===0&&(d("WAWebBackendApi").frontendFireAndForget("updateChatReadStatus",{id:d("WAWebWidFactory").createWid(a.chatId),read:c}),yield d("WAWebApiActiveMessageRanges").removeActiveMessageRange(a.chatId,a.action))});return k.apply(this,arguments)}function f(a,b){switch(b){case d("WAWebHandleForMessageRangeEnums").RangeContain.CONTAINS_BY_TIMESTAMP:case d("WAWebHandleForMessageRangeEnums").RangeContain.CONTAINS_BY_ADDITIONAL:return d("WAWebHandleForMessageRangeEnums").ActiveRangeHandlerAction.DropMessage;case d("WAWebHandleForMessageRangeEnums").RangeContain.DOES_NOT_CONTAIN:return}}function l(a,b){switch(b){case d("WAWebHandleForMessageRangeEnums").RangeContain.CONTAINS_BY_TIMESTAMP:case d("WAWebHandleForMessageRangeEnums").RangeContain.CONTAINS_BY_ADDITIONAL:return d("WAWebHandleForMessageRangeEnums").ActiveRangeHandlerAction.DropMessage;case d("WAWebHandleForMessageRangeEnums").RangeContain.DOES_NOT_CONTAIN:return}}g.handleForArchive=a;g.handleForUnarchive=c;g.handleForMarkAsReadUnread=e;g.handleForClearChat=f;g.handleForDeleteChat=l}),98);
__d("WAWebSyncdDb",["WACryptoLtHash","WALogger","WASyncAction.pb","WASyncdKeyTypes","WAWebModelStorageUtils","WAWebSchemaCollectionVersion","WAWebSchemaMissingKeys","WAWebSchemaPendingMutations","WAWebSchemaSyncActions","WAWebSchemaSyncKeys","asyncToGeneratorRuntime","decodeProtobuf"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: adding pending mutations:\n  ",""]);h=function(){return a};return a}var i=new ArrayBuffer(d("WACryptoLtHash").KEY_LENGTH_BYTES);function a(){return d("WAWebSchemaPendingMutations").getPendingMutationsTable().all()}function c(a){return d("WAWebModelStorageUtils").getStorage().lock(["collection-version","pending-mutations","sync-actions"],a)}function e(a,b){return d("WAWebSchemaPendingMutations").getPendingMutationsTable().equals(a,b)}function f(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("WAWebSchemaPendingMutations").getPendingMutationsTable().bulkGet(a));return a.filter(Boolean)});return j.apply(this,arguments)}function k(a,b){return d("WAWebSchemaPendingMutations").getPendingMutationsTable().equals(a,b)}function l(a){d("WALogger").DEV(h(),JSON.stringify(a.map(function(a){return{index:a.index,value:d("decodeProtobuf").decodeProtobuf(d("WASyncAction.pb").SyncActionValueSpec,a.binarySyncAction)}}),null,2));return d("WAWebSchemaPendingMutations").getPendingMutationsTable().bulkCreate(a)}function m(a){return d("WAWebSchemaPendingMutations").getPendingMutationsTable().bulkRemove(a)}function n(a){return d("WAWebSchemaPendingMutations").getPendingMutationsTable().equals(["collection"],a).then(function(a){return a.length>0})}function o(a){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("WAWebSchemaCollectionVersion").getCollectionVersionTable().get(a));return a==null?void 0:a.version});return p.apply(this,arguments)}function q(a){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield d("WAWebSchemaCollectionVersion").getCollectionVersionTable().bulkGet(a));return new Map(a.map(function(a,c){return[a,(a=b[c])==null?void 0:a.version]}))});return r.apply(this,arguments)}function s(a,b,c){return d("WAWebSchemaCollectionVersion").getCollectionVersionTable().createOrMerge(a,{collection:a,version:b,ltHash:c})}function t(a){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("WAWebSchemaCollectionVersion").getCollectionVersionTable().get(a));return(a==null?void 0:a.ltHash)||i});return u.apply(this,arguments)}function v(){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WAWebSchemaCollectionVersion").getCollectionVersionTable().all());return a.map(function(a){return{collection:a.collection,ltHash:a.ltHash}})});return w.apply(this,arguments)}function x(a){return d("WAWebSchemaSyncActions").getSyncActionsTable().get(a)}function y(a,b){return d("WAWebSchemaSyncActions").getSyncActionsTable().anyOf(a,b)}function z(a){return d("WAWebSchemaSyncActions").getSyncActionsTable().createOrReplace(a)}function A(a){return d("WAWebSchemaSyncActions").getSyncActionsTable().bulkCreateOrReplace(a)}function B(a){return d("WAWebSchemaSyncActions").getSyncActionsTable().bulkCreateOrMerge(a.map(function(a){return babelHelpers["extends"]({},a)}))}function C(a){return d("WAWebSchemaSyncActions").getSyncActionsTable().bulkRemove(a)}function D(a){return E.apply(this,arguments)}function E(){E=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("WAWebSchemaSyncKeys").getSyncKeysTable().get(new Uint8Array(d("WASyncdKeyTypes").fromSyncKeyId(a))));return a==null?a:d("WAWebSchemaSyncKeys").convertToSyncKeyFromRow(a)});return E.apply(this,arguments)}function F(){return d("WAWebSchemaSyncKeys").getSyncKeysTable().all().then(function(a){return a.map(d("WAWebSchemaSyncKeys").convertToSyncKeyFromRow)})}function G(a){return d("WAWebSchemaSyncKeys").getSyncKeysTable().create(d("WAWebSchemaSyncKeys").convertFromSyncKeyToRow(a)).then(function(a){return d("WASyncdKeyTypes").toSyncKeyId(a.buffer)})}function H(a){return I.apply(this,arguments)}function I(){I=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("WAWebSchemaSyncKeys").getSyncKeysTable().equals(["keyEpoch"],a));a.forEach(function(a){return d("WAWebSchemaSyncKeys").getSyncKeysTable().merge({keyId:a.keyId},{timestamp:0})})});return I.apply(this,arguments)}function J(a){return K.apply(this,arguments)}function K(){K=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("WAWebSchemaMissingKeys").getMissingKeysTable().get(a));return a==null?a:d("WAWebSchemaMissingKeys").convertToMissingKeyFromRow(a)});return K.apply(this,arguments)}function L(){return d("WAWebSchemaMissingKeys").getMissingKeysTable().count()}function M(a){return d("WAWebSchemaMissingKeys").getMissingKeysTable().bulkGet(a).then(function(a){return a.map(function(a){return a==null?null:d("WAWebSchemaMissingKeys").convertToMissingKeyFromRow(a)})})}function N(){return d("WAWebSchemaMissingKeys").getMissingKeysTable().all().then(function(a){return a.map(d("WAWebSchemaMissingKeys").convertToMissingKeyFromRow)})}function O(a){return d("WAWebSchemaMissingKeys").getMissingKeysTable().bulkRemove(a)}function P(a){return d("WAWebSchemaMissingKeys").getMissingKeysTable().bulkCreateOrMerge(a.map(d("WAWebSchemaMissingKeys").convertFromMissingKeyToRow))}g.getAllPendingMutationsRows=a;g.performTransaction=c;g.getPendingMutationsRows=e;g.getPendingMutationsRowsById=f;g.getPendingMutationsRowsByIndex=k;g.appendPendingMutationsRows=l;g.bulkRemovePendingMutations=m;g.hasPendingMutationForCollection=n;g.getCollectionVersion=o;g.getCollectionVersions=q;g.setCollectionVersion=s;g.getLtHash=t;g.getAllCollectionLtHashes=v;g.getSyncAction=x;g.getSyncActionsRows=y;g.setSyncAction=z;g.setSyncActionRows=A;g.updateSyncActionRows=B;g.deleteSyncActionRows=C;g.getSyncKey=D;g.getAllSyncKeys=F;g.createSyncKey=G;g.expireSyncKey=H;g.getMissingKey=J;g.getMissingKeyCount=L;g.bulkGetMissingKeys=M;g.getAllMissingKeys=N;g.bulkRemoveMissingKeys=O;g.createOrUpdateMissingKeys=P}),98);
__d("WAWebWamEnumCollection",[],(function(a,b,c,d,e,f){a=Object.freeze({REGULAR:1,REGULAR_LOW:2,REGULAR_HIGH:3,CRITICAL_BLOCK:4,CRITICAL_UNBLOCK_LOW:5});f.COLLECTION=a}),66);
__d("WAWebWamEnumMdSyncdCriticalEventCode",[],(function(a,b,c,d,e,f){a=Object.freeze({MESSAGE_RANGE_UNSET:1,MESSAGE_RANGE_LAST_SYSTEM_MESSAGE_TIMESTAMP_SET:2,MESSAGE_RANGE_MESSAGES_UNSET:3,MESSAGE_RANGE_MESSAGES_EMPTY:4,MESSAGE_RANGE_MESSAGES_CROSS_LIMIT:5,MESSAGE_RANGE_MESSAGE_KEY_UNSET:6,MESSAGE_RANGE_MESSAGE_KEY_REMOTE_JID_UNSET:7,MESSAGE_RANGE_MESSAGE_KEY_FROM_ME_UNSET:8,MESSAGE_RANGE_MESSAGE_KEY_STANZA_ID_UNSET:9,MESSAGE_RANGE_MESSAGE_KEY_REMOTE_JID_INVALID:10,MESSAGE_RANGE_MESSAGE_KEY_PARTICIPANT_UNSET:11,MALFORMED_PENDING_MUTATION:12,ACTION_INVALID_INDEX_DATA:13,MISSING_MUTATION_TO_REMOVE:14,LTHASH_INCONSISTENCY_ON_DAILY_CHECK:15,LTHASH_INCONSISTENCY_ON_SNAPSHOT_MAC_MISMATCH:16});f.MD_SYNCD_CRITICAL_EVENT_CODE=a}),66);
__d("WAWebMdCriticalEventWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumCollection","WAWebWamEnumMdSyncdCriticalEventCode"],(function(a,b,c,d,e,f,g){a=d("WAWebWamCodegenUtils").defineEvents({MdCriticalEvent:[2746,{collection:[2,d("WAWebWamEnumCollection").COLLECTION],mdCriticalEventCode:[1,d("WAWebWamEnumMdSyncdCriticalEventCode").MD_SYNCD_CRITICAL_EVENT_CODE]},[1,1,1],"regular"]});g.MdCriticalEventWamEvent=a}),98);
__d("WAWebSyncdUtils",["WASyncdActionUtils","WASyncdConst","WAWebMdCriticalEventWamEvent","WAWebWamEnumCollection"],(function(a,b,c,d,e,f,g){function a(a){return d("WASyncdActionUtils").buildIndex(d("WASyncdConst").Actions.Star,h(a))}function b(a){return h(a.id)}function h(a){var b=i(a);return[a.remote.toString({legacy:!0}),a.id,a.fromMe?"1":"0",b]}function i(a){var b="0";a.participant&&!a.remote.isUser()&&!a.fromMe&&(b=a.participant.toString({legacy:!0}));return b}function j(a){switch(a){case d("WASyncdConst").CollectionName.CriticalBlock:return d("WAWebWamEnumCollection").COLLECTION.CRITICAL_BLOCK;case d("WASyncdConst").CollectionName.CriticalUnblockLow:return d("WAWebWamEnumCollection").COLLECTION.CRITICAL_UNBLOCK_LOW;case d("WASyncdConst").CollectionName.Regular:return d("WAWebWamEnumCollection").COLLECTION.REGULAR;case d("WASyncdConst").CollectionName.RegularHigh:return d("WAWebWamEnumCollection").COLLECTION.REGULAR_HIGH;case d("WASyncdConst").CollectionName.RegularLow:return d("WAWebWamEnumCollection").COLLECTION.REGULAR_LOW}}function c(a,b){a=new(d("WAWebMdCriticalEventWamEvent").MdCriticalEventWamEvent)({mdCriticalEventCode:a});b!=null&&(a.collection=j(b));a.commit()}g.constructStarMsgKeyFromMsgKey=a;g.constructMsgKeySegments=b;g.extractParticipantForSync=i;g.collectionNameToMetric=j;g.uploadCriticalEventMetric=c}),98);
__d("WAWebHandleForMessageRange",["Promise","WALogger","WASyncAction.pb","WAWebActiveMessageRanges","WAWebAddonGatingUtils","WAWebApiActiveMessageRanges","WAWebHandleForMessageRangeEnums","WAWebMsgRangeContainmentHandlers","WAWebMsgType","WAWebSchemaActiveMessageRanges","WAWebSyncdDb","WAWebSyncdUtils","WAWebWidFactory","asyncToGeneratorRuntime","decodeProtobuf"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleMessageContainment called with unknwon message range action action: ",""]);i=function(){return a};return a}var j=new Set(),k=function(a){return a.reduce(function(a,b){return new Set([].concat(Array.from(a),Array.from(b)))},new Set())};function l(a,b,c){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){var e;switch(a.action){case d("WAWebSchemaActiveMessageRanges").ActiveRangeAction.Archive:a.actionValue.archived?yield d("WAWebMsgRangeContainmentHandlers").handleForArchive(a,c):yield d("WAWebMsgRangeContainmentHandlers").handleForUnarchive(a,c);return j;case d("WAWebSchemaActiveMessageRanges").ActiveRangeAction.MarkChatAsRead:yield d("WAWebMsgRangeContainmentHandlers").handleForMarkAsReadUnread(a,c,!!a.actionValue.read);return j;case d("WAWebSchemaActiveMessageRanges").ActiveRangeAction.ClearChatDeleteStarredDeleteMedia:case d("WAWebSchemaActiveMessageRanges").ActiveRangeAction.ClearChatDeleteStarredKeepMedia:e=d("WAWebMsgRangeContainmentHandlers").handleForClearChat(a,c);return e?new Set([e]):j;case d("WAWebSchemaActiveMessageRanges").ActiveRangeAction.ClearChatKeepStarredDeleteMedia:case d("WAWebSchemaActiveMessageRanges").ActiveRangeAction.ClearChatKeepStarredKeepMedia:if(!(yield n(b.id))){e=d("WAWebMsgRangeContainmentHandlers").handleForClearChat(a,c);return e?new Set([e]):j}return j;case d("WAWebSchemaActiveMessageRanges").ActiveRangeAction.DeleteChatDeleteMedia:case d("WAWebSchemaActiveMessageRanges").ActiveRangeAction.DeleteChatKeepMedia:e=d("WAWebMsgRangeContainmentHandlers").handleForDeleteChat(a,c);return e?new Set([e]):j}d("WALogger").WARN(i(),a.action);return j});return m.apply(this,arguments)}function n(a){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=d("WAWebSyncdUtils").constructStarMsgKeyFromMsgKey(a);a=(yield d("WAWebSyncdDb").getSyncAction(a));if(a){a=d("decodeProtobuf").decodeProtobuf(d("WASyncAction.pb").SyncActionDataSpec,a.binarySyncData).value;return(a==null?void 0:(a=a.starAction)==null?void 0:a.starred)||!1}return!1});return o.apply(this,arguments)}function p(a,b){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){if(d("WAWebMsgType").SYSTEM_MESSAGE_TYPES.includes(c.type))return j;a=(yield d("WAWebApiActiveMessageRanges").getActiveMessageRanges(a.toString()));a=a.map(function(a){return[a,d("WAWebActiveMessageRanges").rangeContainsMessage(a.actionValue.messageRange,c)]});var e=a.filter(function(a){a=a[1];return a===d("WAWebHandleForMessageRangeEnums").RangeContain.CONTAINS_BY_ADDITIONAL}).map(function(a){a=a[0];return a});e.forEach(function(a){a.remainingMessages--});yield d("WAWebApiActiveMessageRanges").bulkUpdateActiveMessageRanges(e);e=a.map(function(a){var b=a[0];a=a[1];return l(b,c,a)});a=(yield (h||(h=b("Promise"))).all(e));return k(a)});return q.apply(this,arguments)}function r(a){if(d("WAWebAddonGatingUtils").isUnifiedInfraEnabledForType(a.type))return!0;return a.type==="reaction"||a.type==="poll_update"?!0:!1}function a(a){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=new Map();a.forEach(function(a){if(d("WAWebMsgType").SYSTEM_MESSAGE_TYPES.includes(a.type)||r(a))return;var b=c.get(a.id.remote.toString());(b==null||b.t<a.t)&&c.set(a.id.remote.toString(),a)});yield (h||(h=b("Promise"))).all(Array.from(c.entries()).map(function(a){var b=a[0];a=a[1];return p(d("WAWebWidFactory").createWid(b),a)}))});return s.apply(this,arguments)}g.handleForActiveMessageRange=p;g.handleOfflineForMessageRange=a}),98);
__d("WAWebMessagingGatingUtils",["WAWebABProps","WAWebDBReportingTokenUtils"],(function(a,b,c,d,e,f,g){function a(){return d("WAWebABProps").getABPropConfigValue("web_send_invisible_msg_to_new_groups")}function b(){return d("WAWebABProps").getABPropConfigValue("web_send_invisible_msg_min_group_size")}function c(){return d("WAWebABProps").getABPropConfigValue("web_send_invisible_msg_max_group_size")}function e(){var a;return(a=d("WAWebABProps").getABPropConfigValue("group_size_bypassing_sampling"))!=null?a:1e5}function f(){return d("WAWebABProps").getABPropConfigValue("retry_receipt_error_code_enabled")}function h(){return d("WAWebABProps").getABPropConfigValue("web_device_sync_manager_group_enabled")}function i(){return d("WAWebABProps").getABPropConfigValue("rt_validate_message_type")}function j(){return i()&&d("WAWebABProps").getABPropConfigValue("rt_drop_message_invalid_type")}function k(){return d("WAWebABProps").getABPropConfigValue("rt_send_reporting_tag")}function l(){return d("WAWebABProps").getABPropConfigValue("rt_receive_reporting_tag")}function m(){return d("WAWebABProps").getABPropConfigValue("rt_sync_reporting_tag")}function n(){var a;return(a=d("WAWebABProps").getABPropConfigValue("rt_clean_reporting_tag"))!=null?a:d("WAWebDBReportingTokenUtils").DEFAULT_RT_CLEANUP_OLDER_THAN_DAYS}function o(){return d("WAWebABProps").getABPropConfigValue("web_inactive_receipts_v2")}function p(){return d("WAWebABProps").getABPropConfigValue("visible_message_drop_placeholder_enabled_internal_only")}function q(){return d("WAWebABProps").getABPropConfigValue("web_payment_notifications_ack_kick_fix_enabled")}function r(){return d("WAWebABProps").getABPropConfigValue("web_message_drop_bulk_db_operation_fallback_enabled")}g.sendKeyDistributionMsgToNewGroups=a;g.sendKeyDistributionMsgMinGroupSize=b;g.sendKeyDistributionMsgMaxGroupSize=c;g.getGroupSizeBypassingSampling=e;g.isRetryReceiptErrorCodeEnabled=f;g.isDeviceSyncManagerGroupEnabled=h;g.isMsgTypeValidationEnabled=i;g.isMsgTypeValidationDropMsgEnabled=j;g.isReportingTokenSendingEnabled=k;g.isReportingTokenReceivingEnabled=l;g.isReportingTagSyncingEnabled=m;g.getReportingTagCleanupDays=n;g.isInactiveReceiptsV2Enabled=o;g.isMessageDropPlaceholderEnabled=p;g.isPaymentNotificationAckKickFixEnabled=q;g.isMessageDropBulkDbOperationFallbackEnabled=r}),98);
__d("WAWebPairList",["lodash"],(function(a,b,c,d,e,f,g){function a(a){return c("lodash").flatten(a.map(function(a){return[a[0],a[1]]}))}function b(a){if(a.length%2!==0)throw new RangeError("Flattened pairs come in 2, invalid list size to unflatten!");var b=[];for(var c=0;c<a.length;c++)b.push([a[c],a[++c]]);return b}g.flattenPairList=a;g.unFlattenPairList=b}),98);
__d("WAWebGroupSystemMsg",["Promise","WALogger","WATimeUtils","WAWebABProps","WAWebApiParticipantStore","WAWebCommunityGatingUtils","WAWebContactSystemMsg","WAWebDBCommunity","WAWebDBGroupsGroupMetadata","WAWebGroupType","WAWebGroupsParticipantsApi","WAWebMsgKey","WAWebMsgType","WAWebPairList","WAWebProfilePicConstants","WAWebRequestMethodType","WAWebSchemaGroupMetadata","WAWebUserPrefsMeUser","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["genIntegrityDelteteParentNotificationMsgs: missing parentGroupMetadata"]);i=function(){return a};return a}function j(a,b){var e,f=a.chatId;e=(e=(e=b.owner)!=null?e:a.author)!=null?e:d("WAWebUserPrefsMeUser").getMaybeMeUser();var g=b.participants.some(function(a){var b=a.isAdmin;a=a.id;return d("WAWebUserPrefsMeUser").isMeAccount(a)&&b}),h=f,i=!1,j=b.subject,k,l;if(d("WAWebCommunityGatingUtils").communitiesEnabled()&&b.defaultSubgroup===!0){var m;k="community_create";b.parentGroup&&(l=[b.parentGroup,b.subject]);e=(m=b.owner)!=null?m:a.author}else if(b.generalSubgroup===!0&&g&&d("WAWebCommunityGatingUtils").communityGeneralChatUIEnabled()){k="general_chat_add";l=["created",b.subject];e=(m=b.owner)!=null?m:a.author}else{e=(g=b.owner)!=null?g:a.author;b.parentGroup&&b.participants.length===1&&d("WAWebCommunityGatingUtils").communityShortGroupCreationEnabled()?(l=[b.parentGroup,b.parentGroupSubject,b.subject],k="empty_subgroup_create"):k="create"}return{id:new(c("WAWebMsgKey"))({remote:h,fromMe:i,participant:e,id:A(a,k)}),author:e,body:j,from:f,recipients:[],subtype:k,t:(m=b.creation)!=null?m:a.ts,type:"gp2",templateParams:l}}function a(a,b,c,d){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e,f){var g=c.participants.find(function(a){var b=a.isAdmin;a=a.id;return d("WAWebUserPrefsMeUser").isMeAccount(a)&&b});return(yield (h||(h=b("Promise"))).all([i(),k(),l(),m(),q()])).flat();function i(){return!e&&!g&&c.defaultSubgroup===!0&&c.incognito===!0?[d("WAWebContactSystemMsg").genNotificationMsg(c.id,{type:"notification_template",subtype:"cag_masked_thread_created",templateParams:[]})]:[]}function k(){return e?[]:[j(a,c)]}function l(){var b=c.ephemeralDuration;return a.author&&a.ts!=null&&b!=null&&b>0?[p(a.chatId,a.ts,a.author,b)]:[]}function m(){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=[],f=c.defaultSubgroup,g=c.parentGroup;if(g!=null&&f!==!0&&!e&&d("WAWebCommunityGatingUtils").communitiesEnabled()){f={actionType:d("WAWebGroupType").GROUP_ACTIONS.PARENT_GROUP_LINK,groupDatas:[{id:g,subject:""}]};if(d("WAWebABProps").getABPropConfigValue("group_join_request_m0_anyone_can_join")||d("WAWebABProps").getABPropConfigValue("group_join_request_m2_setting")){g=(yield d("WAWebApiParticipantStore").isCurrentUserGroupAdmin(a.chatId.toString()));b.push(yield B(a,f.groupDatas,g))}}return b});return o.apply(this,arguments)}function q(){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){return f==null?[]:[yield n(a,f)]});return r.apply(this,arguments)}});return k.apply(this,arguments)}function l(a,b){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=a.parentGroupId;if(!a)return!1;a=(yield d("WAWebDBGroupsGroupMetadata").getGroupMetadata(a));return!a||a!=null&&(yield d("WAWebDBCommunity").getJoinedSubgroups(d("WAWebWidFactory").createWid(a.id))).length<=b?!0:!1});return m.apply(this,arguments)}function n(a,b,c){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){var f=a.chatId,g=a.isAdmin;g=g===void 0?!1:g;var h=a.author&&d("WAWebWidFactory").toUserWid(a.author)||void 0,i=f,j=!1,k=null,m=[],n=h,o=b.actionType,p=null,q,r=b.parentGroupId;switch(b.actionType){case d("WAWebGroupType").GROUP_ACTIONS.SUBJECT:k=b.subject;break;case d("WAWebGroupType").GROUP_ACTIONS.MODIFY:m=b.participants.map(function(a){a=a.id;return a});break;case d("WAWebGroupType").GROUP_ACTIONS.ADD:if(b.reason===d("WAWebGroupType").ADD_REASON.INVITE)if(r&&b.participants.some(function(a){a=a.id;return d("WAWebUserPrefsMeUser").isMeAccount(a)})&&d("WAWebCommunityGatingUtils").communitiesEnabled())if(b.generalSubgroup===!0&&d("WAWebCommunityGatingUtils").communityGeneralChatUIEnabled()){var s;o="general_chat_add";p=["linked_group_join",(s=b.groupName)!=null?s:""]}else if(b.defaultSubgroup===!0){o="community_invite_rich";p=[r,(s=b.groupName)!=null?s:""]}else{o="sub_group_invite_rich";s=(yield d("WAWebDBGroupsGroupMetadata").getGroupMetadata(r));p=[r,(s=s==null?void 0:s.subject)!=null?s:""]}else o="invite";else if(d("WAWebCommunityGatingUtils").communitiesEnabled())if(b.reason===d("WAWebGroupType").ADD_REASON.LINKED_GROUP_JOIN)if(b.generalSubgroup===!0&&r!=null&&b.participants.some(function(a){a=a.id;return d("WAWebUserPrefsMeUser").isMeAccount(a)})&&d("WAWebCommunityGatingUtils").communityGeneralChatUIEnabled()){o="general_chat_add";p=["linked_group_join",(s=b.groupName)!=null?s:""]}else o="linked_group_join";else if(b.reason===d("WAWebGroupType").ADD_REASON.AUTO_ADD)if(r){p=[r,(s=b.groupName)!=null?s:"",(s=b.contextGroupId)!=null?s:""];o="subgroup_admin_triggered_auto_add"}else{o="auto_add";if(yield l(b,2)){p=[b.parentGroupId,(s=b.groupName)!=null?s:""]}}else if(b.reason===d("WAWebGroupType").ADD_REASON.DEFAULT_SUBGROUP_ADMIN_ADD)if(r){o="community_participant_add_rich";p=[r,(s=b.groupName)!=null?s:""]}else{o="default_sub_group_admin_add";if(yield l(b,1)){p=[b.parentGroupId,(s=b.groupName)!=null?s:""]}}else if(b.reason===d("WAWebGroupType").ADD_REASON.DEFAULT_SUBGROUP_PROMOTE)o="default_sub_group_promote";else if(b.reason===d("WAWebGroupType").ADD_REASON.INVITE_AUTO_ADD)if(r&&Boolean(b.defaultSubgroup)&&b.participants.some(function(a){a=a.id;return d("WAWebUserPrefsMeUser").isMeAccount(a)})){p=[r,(s=b.groupName)!=null?s:"",(s=b.contextGroupId)!=null?s:""];o="subgroup_admin_triggered_invite_auto_add"}else o="invite_auto_add",b.contextGroupId&&(p=[b.contextGroupId,""],(yield l(b,2))?p.push("false"):p.push("true"));else if(b.participants.some(function(a){a=a.id;return d("WAWebUserPrefsMeUser").isMeAccount(a)})&&b.reason===d("WAWebGroupType").ADD_REASON.GENERAL_CHAT_AUTO_ADD&&d("WAWebCommunityGatingUtils").communityGeneralChatUIEnabled())o="general_chat_add",p=["general_chat_auto_add",b.groupName];else if(b.reason==null&&r&&b.participants.some(function(a){a=a.id;return d("WAWebUserPrefsMeUser").isMeAccount(a)})&&b.generalSubgroup===!0&&d("WAWebCommunityGatingUtils").communityGeneralChatUIEnabled()){o="general_chat_add";p=["",(s=b.groupName)!=null?s:""]}else if(r&&b.participants.some(function(a){a=a.id;return d("WAWebUserPrefsMeUser").isMeAccount(a)})){s=(yield d("WAWebDBGroupsGroupMetadata").getGroupMetadata(r));p=[r,(r=s==null?void 0:s.subject)!=null?r:""];o=b.defaultSubgroup===!0?"community_participant_add_rich":"sub_group_participant_add_rich"}case d("WAWebGroupType").GROUP_ACTIONS.PROMOTE:case d("WAWebGroupType").GROUP_ACTIONS.DEMOTE:case d("WAWebGroupType").GROUP_ACTIONS.REMOVE:case d("WAWebGroupType").GROUP_ACTIONS.LINKED_GROUP_PROMOTE:case d("WAWebGroupType").GROUP_ACTIONS.LINKED_GROUP_DEMOTE:if(b.actionType===d("WAWebGroupType").GROUP_ACTIONS.REMOVE&&b.reason===d("WAWebGroupType").REMOVE_REASON.DEFAULT_SUBGROUP_DEMOTE){o="default_sub_group_demote";break}m=b.participants.map(function(a){a=a.id;return a});m.length===1&&(n=m[0]);b.actionType===d("WAWebGroupType").GROUP_ACTIONS.REMOVE&&m.length===1&&h===n&&(o="leave");break;case d("WAWebGroupType").GROUP_ACTIONS.INVITE_CODE:o="revoke_invite";break;case d("WAWebGroupType").GROUP_ACTIONS.DESC_ADD:o=b.isParentGroup===!0?"parent_group_description":"description";k=b.desc;break;case d("WAWebGroupType").GROUP_ACTIONS.DESC_REMOVE:o=b.isParentGroup===!0?"parent_group_description":"description";break;case d("WAWebGroupType").GROUP_ACTIONS.RESTRICT:p=[b.value?d("WAWebGroupType").GroupSettingChangeSystemMessageToggleEnabled.On:d("WAWebGroupType").GroupSettingChangeSystemMessageToggleEnabled.Off];k=p[0];b.threshold!=null&&p.push(b.threshold);break;case d("WAWebGroupType").GROUP_ACTIONS.ANNOUNCE:case d("WAWebGroupType").GROUP_ACTIONS.NO_FORWARD:p=[b.value?d("WAWebGroupType").GroupSettingChangeSystemMessageToggleEnabled.On:d("WAWebGroupType").GroupSettingChangeSystemMessageToggleEnabled.Off];k=p[0];break;case d("WAWebGroupType").GROUP_ACTIONS.EPHEMERAL:h&&(p=[""+b.duration,h]);break;case d("WAWebGroupType").GROUP_ACTIONS.GROWTH_LOCKED:p=[b.type];k=p[0];break;case d("WAWebGroupType").GROUP_ACTIONS.SUB_GROUP_LINK:case d("WAWebGroupType").GROUP_ACTIONS.SIBLING_GROUP_LINK:case d("WAWebGroupType").GROUP_ACTIONS.SUB_GROUP_UNLINK:case d("WAWebGroupType").GROUP_ACTIONS.PARENT_GROUP_UNLINK:case d("WAWebGroupType").GROUP_ACTIONS.SIBLING_GROUP_UNLINK:case d("WAWebGroupType").GROUP_ACTIONS.DELETE_PARENT_GROUP_UNLINK:case d("WAWebGroupType").GROUP_ACTIONS.INTEGRITY_PARENT_GROUP_UNLINK:p=d("WAWebPairList").flattenPairList(b.groupDatas.map(function(a){return[a.id,a.subject]}));break;case d("WAWebGroupType").GROUP_ACTIONS.PARENT_GROUP_LINK:p=d("WAWebPairList").flattenPairList(b.groupDatas.map(function(a){return[a.id,a.subject]}));o="community_link_parent_group_rich";q="parentGroupLink";break;case d("WAWebGroupType").GROUP_ACTIONS.PARENT_GROUP_LINK_MEMBERSHIP_APPROVAL:s=b.groupDatas[0];r=g?d("WAWebGroupType").GroupSettingChangeSystemMessageIsAdmin.Admin:d("WAWebGroupType").GroupSettingChangeSystemMessageIsAdmin.Regular;var t=b.membershipApprovalMode;p=[s.id,s.subject,r,t.toString()];q="parentGroupLinkMembershipApproval";break;case d("WAWebGroupType").GROUP_ACTIONS.DELETE_PARENT_GROUP:p=[b.communityTitle];break;case d("WAWebGroupType").GROUP_ACTIONS.MEMBERSHIP_APPROVAL_MODE:p=[b.value?d("WAWebGroupType").GroupSettingChangeSystemMessageToggleEnabled.On:d("WAWebGroupType").GroupSettingChangeSystemMessageToggleEnabled.Off,g?d("WAWebGroupType").GroupSettingChangeSystemMessageIsAdmin.Admin:d("WAWebGroupType").GroupSettingChangeSystemMessageIsAdmin.Regular];b.triggered==="server"&&(h=void 0);break;case d("WAWebGroupType").GROUP_ACTIONS.MEMBER_ADD_MODE:if(!d("WAWebABProps").getABPropConfigValue("web_anyone_can_add_group_setting_enabled"))break;s=b.memberAddMode;s!=null&&(p=[s===d("WAWebSchemaGroupMetadata").MemberAddMode.ALL_MEMBER_ADD?d("WAWebGroupType").GroupSettingChangeSystemMessageToggleEnabled.On:d("WAWebGroupType").GroupSettingChangeSystemMessageToggleEnabled.Off]);break;case d("WAWebGroupType").GROUP_ACTIONS.CREATED_MEMBERSHIP_REQUESTS:r=b.requests;b.requestMethod===d("WAWebRequestMethodType").RequestMethod.NonAdminAdd&&h!=null&&r.length>0?(p=[h.toJid()].concat(r.map(function(a){return a.toJid()})),o="created_membership_requests"):o="membership_approval_request";break;case d("WAWebGroupType").GROUP_ACTIONS.ALLOW_ADMIN_REPORTS:p=[b.value?d("WAWebGroupType").GroupSettingChangeSystemMessageToggleEnabled.On:d("WAWebGroupType").GroupSettingChangeSystemMessageToggleEnabled.Off];t=(yield d("WAWebApiParticipantStore").isCurrentUserGroupAdmin(a.chatId.toString()));p.push(t?d("WAWebGroupType").GroupSettingChangeSystemMessageIsAdmin.Admin:d("WAWebGroupType").GroupSettingChangeSystemMessageIsAdmin.Regular);break;case d("WAWebGroupType").GROUP_ACTIONS.ALLOW_NON_ADMIN_SUB_GROUP_CREATION:p=[b.value?d("WAWebGroupType").GroupSettingChangeSystemMessageToggleEnabled.On:d("WAWebGroupType").GroupSettingChangeSystemMessageToggleEnabled.Off];break;case d("WAWebGroupType").GROUP_ACTIONS.CREATED_SUBGROUP_SUGGESTION:o="created_subgroup_suggestion";p=[b.subject];break;case d("WAWebGroupType").GROUP_ACTIONS.GENERAL_CHAT_AUTO_ADD_DISABLED:o="general_chat_auto_add_disabled";break}return{id:new(c("WAWebMsgKey"))({remote:i,fromMe:j,participant:n,id:A(a,q)}),body:k?k:void 0,author:h,from:f,to:d("WAWebUserPrefsMeUser").getMeUser(),recipients:m.map(d("WAWebWidFactory").toUserWid)||[],subtype:o,t:(g=e)!=null?g:a.ts,type:"gp2",kind:d("WAWebMsgType").MsgKind.Gp2,templateParams:p?p:void 0}});return o.apply(this,arguments)}function e(a,b,e,f){var g=!1;return{type:"gp2",kind:d("WAWebMsgType").MsgKind.Gp2,subtype:"picture",t:e,author:f,body:b===d("WAWebProfilePicConstants").ProfilePicCommand.Set?"set":"remove",recipients:[],from:a,to:d("WAWebUserPrefsMeUser").getMeUser(),id:new(c("WAWebMsgKey"))({remote:a,fromMe:g,id:c("WAWebMsgKey").newId_DEPRECATED()})}}function p(a,b,e,f){return{id:new(c("WAWebMsgKey"))({remote:a,fromMe:!1,participant:e,id:c("WAWebMsgKey").newId_DEPRECATED()}),author:e,from:a,to:d("WAWebUserPrefsMeUser").getMeUser(),recipients:[],subtype:"ephemeral",t:b,type:"gp2",kind:d("WAWebMsgType").MsgKind.Gp2,templateParams:[""+f]}}function f(a,b){return{id:new(c("WAWebMsgKey"))({remote:a,fromMe:!1,id:c("WAWebMsgKey").newId_DEPRECATED()}),from:a,to:d("WAWebUserPrefsMeUser").getMeUser(),recipients:[],subtype:"initial_pHash_mismatch",t:b,type:"gp2",kind:d("WAWebMsgType").MsgKind.Gp2}}function q(a){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c,e=[],f=a.chatId,g=(yield d("WAWebDBGroupsGroupMetadata").getGroupMetadata(f));if(g==null||g.isParentGroup===!1)return e;var i=(yield d("WAWebDBCommunity").getDefaultSubgroup(f)),j=(c=g==null?void 0:g.subject)!=null?c:"",k=d("WATimeUtils").unixTime();i!=null&&(yield d("WAWebGroupsParticipantsApi").checkMyMembership(i))&&e.push(yield n({chatId:i,author:a.author,ts:k},{actionType:d("WAWebGroupType").GROUP_ACTIONS.DELETE_PARENT_GROUP,communityTitle:j}));yield (h||(h=b("Promise"))).all(((c=(yield d("WAWebDBCommunity").getJoinedSubgroups(d("WAWebWidFactory").createWid(g.id))))!=null?c:[]).filter(function(a){return!(i!=null&&i.equals(a))}).map(function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){e.push(yield n({chatId:b,author:a.author,ts:k},{actionType:d("WAWebGroupType").GROUP_ACTIONS.DELETE_PARENT_GROUP,communityTitle:j})),e.push(yield n({chatId:b,author:a.author,ts:k},{actionType:d("WAWebGroupType").GROUP_ACTIONS.PARENT_GROUP_UNLINK,groupDatas:[{id:f,subject:j}]}))});return function(a){return c.apply(this,arguments)}}()));return e});return r.apply(this,arguments)}function s(a,b){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){var e=[],f=a.chatId,g=(yield d("WAWebDBGroupsGroupMetadata").getGroupMetadata(f));if(g==null){d("WALogger").ERROR(i());return[]}var j=(yield d("WAWebDBCommunity").getDefaultSubgroup(f));if(j!=null&&(yield d("WAWebGroupsParticipantsApi").checkMyMembership(j))){e.push(yield n({chatId:j,author:void 0,ts:d("WATimeUtils").unixTime()},{actionType:d("WAWebGroupType").GROUP_ACTIONS.DELETE,reason:d("WAWebGroupType").DELETE_REASON.INTEGRITY_DELETE_PARENT,groupDatas:[{id:f,subject:(c=g==null?void 0:g.subject)!=null?c:""}]}))}yield (h||(h=b("Promise"))).all(((a=(yield d("WAWebDBCommunity").getJoinedSubgroups(f)))!=null?a:[]).filter(function(a){return!(j!=null&&j.equals(a))}).map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){return e.push(yield n({chatId:a,author:void 0,ts:d("WATimeUtils").unixTime()},{actionType:d("WAWebGroupType").GROUP_ACTIONS.INTEGRITY_PARENT_GROUP_UNLINK,groupDatas:[{id:f,subject:(a=g==null?void 0:g.subject)!=null?a:""}]}))});return function(b){return a.apply(this,arguments)}}()));return e});return t.apply(this,arguments)}function u(a,b){return v.apply(this,arguments)}function v(){v=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=a.chatId,e=(yield d("WAWebDBGroupsGroupMetadata").getGroupMetadata(c));if((e==null?void 0:e.isParentGroup)===!0&&d("WAWebCommunityGatingUtils").communitiesEnabled()){e=(yield d("WAWebDBCommunity").getDefaultSubgroup(c));if(e&&(b.actionType===d("WAWebGroupType").GROUP_ACTIONS.DESC_ADD||b.actionType===d("WAWebGroupType").GROUP_ACTIONS.DESC_REMOVE))return n(babelHelpers["extends"]({},a,{chatId:e}),babelHelpers["extends"]({},b,{isParentGroup:!0}))}return n(a,b)});return v.apply(this,arguments)}function w(a,b){return x.apply(this,arguments)}function x(){x=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=a.chatId;c=(yield d("WAWebDBCommunity").getDefaultSubgroup(c));if(!c)return;var e=(yield d("WAWebGroupsParticipantsApi").getParticipants(c));e=Boolean(e==null?void 0:e.participants.find(function(a){return d("WAWebUserPrefsMeUser").isMeAccount(d("WAWebWidFactory").createWid(a))}));if(!e)return;return n(babelHelpers["extends"]({},a,{chatId:c}),b)});return x.apply(this,arguments)}function y(a,b){return z.apply(this,arguments)}function z(){z=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=a.chatId;c=(yield d("WAWebDBCommunity").getDefaultSubgroup(c));if(!(c&&b.actionType===d("WAWebGroupType").GROUP_ACTIONS.CREATED_SUBGROUP_SUGGESTION&&d("WAWebCommunityGatingUtils").communitiesEnabled()))return;return n(babelHelpers["extends"]({},a,{chatId:c}),b)});return z.apply(this,arguments)}function A(a,b){var d;d=(d=a.externalId)!=null?d:c("WAWebMsgKey").newId_DEPRECATED();b!=null&&(d=""+d+b);return""+d+((b=a.ts)!=null?b:"")}function B(a,b,c){return C.apply(this,arguments)}function C(){C=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){f=(yield f(a.chatId));return n(babelHelpers["extends"]({},a,{isAdmin:e}),{actionType:d("WAWebGroupType").GROUP_ACTIONS.PARENT_GROUP_LINK_MEMBERSHIP_APPROVAL,membershipApprovalMode:f,groupDatas:c});function f(a){return g.apply(this,arguments)}function g(){g=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("WAWebDBGroupsGroupMetadata").getGroupMetadata(a));return(a=a==null?void 0:a.membershipApprovalMode)!=null?a:!1});return g.apply(this,arguments)}});return C.apply(this,arguments)}g.genGroupCreationMsg=j;g.genMsgsForGroupCreation=a;g.genGroupNotificationMsg=n;g.genGroupPicChangeNotificationMsg=e;g.genGroupEphemeralSettingMsg=p;g.genInitialPhashMismatchMsg=f;g.generateDeleteParentNotificationMessages=q;g.genIntegrityDeleteParentNotificationMsgs=s;g.genDescriptionNotificationMsg=u;g.genAllowNonAdminSubGroupCreationNotificationMsg=w;g.genCreatedSubgroupSuggestionNotificationMsg=y;g.genParentGroupLinkMembershipApprovalNotif=B}),98);
__d("WAWebBizCoexUtils",["WAWebBizCoexGatingUtils","WAWebOfflineDeviceCache","WAWebOfflineHandler","WAWebSyncDeviceAdvDeviceListJob"],(function(a,b,c,d,e,f,g){var h=99;function a(a){return a.some(function(a){return a.isHosted()})}function b(a,b){if(!d("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()||a==null)return;((a=a[0])==null?void 0:a.id)===h&&(!d("WAWebOfflineHandler").OfflineMessageHandler.isResumeFromRestartComplete()?d("WAWebOfflineDeviceCache").OfflinePendingDeviceCache.addOfflinePendingDevice(b.toString(),null):void d("WAWebSyncDeviceAdvDeviceListJob").syncDeviceListJob([b],null,null))}g.fanoutListContainsHostedDevice=a;g.triggerUsyncForCoexDeviceAdd=b}),98);
__d("WAWebCommentMsgDataConversion",["WAWebCommentMessageValidationError","WAWebMsgType","WAWebUserPrefsMeUser","WAWebWamEnumE2eFailureReason","WAWebWidFactory"],(function(a,b,c,d,e,f,g){function a(a,b){var c;a=(c=a.conversation)!=null?c:(c=a.extendedTextMessage)==null?void 0:c.text;if(a==null)throw new(d("WAWebCommentMessageValidationError").CommentMessageValidationError)(d("WAWebCommentMessageValidationError").CommentMessageValidationErrorCode.MISSING_COMMENT_CONTENT,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);return{ack:b.ack,body:a,from:b.from,to:b.to,id:b.id,parentMsgKey:b.targetMessageKey,sender:b.author?d("WAWebWidFactory").toUserWid(b.author):d("WAWebUserPrefsMeUser").getMeUser(),t:b.t,type:d("WAWebMsgType").MSG_TYPE.COMMENT,kind:d("WAWebMsgType").MsgKind.CommentDecrypted,read:!1}}g.convertMessageToCommentMsgData=a}),98);
__d("WAWebProcessCommentMsg",["WAWebAddOnEncryption","WAWebCommentMessageValidationError","WAWebDBMsgUtils","WAWebMsgGetters","WAWebProtobufsE2E.pb","WAWebWamEnumE2eFailureReason","WAWebWidFactory","asyncToGeneratorRuntime","decodeProtobuf","err"],(function(a,b,c,d,e,f,g){function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.targetMessageKey,e=a.encIv,f=a.encPayload;if(e==null)throw new(d("WAWebCommentMessageValidationError").CommentMessageValidationError)(d("WAWebCommentMessageValidationError").CommentMessageValidationErrorCode.MISSING_COMMENT_ENC_IV,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(f==null)throw new(d("WAWebCommentMessageValidationError").CommentMessageValidationError)(d("WAWebCommentMessageValidationError").CommentMessageValidationErrorCode.MISSING_COMMENT_ENC_PAYLOAD,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(b==null)throw new(d("WAWebCommentMessageValidationError").CommentMessageValidationError)(d("WAWebCommentMessageValidationError").CommentMessageValidationErrorCode.MISSING_COMMENT_MESSAGE_KEY,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);b=(yield d("WAWebDBMsgUtils").getMsgByMsgKey(b));if(b==null)throw c("err")("[messaging] - handling orphans");a=a.author?a.author:a.id.participant;var g=d("WAWebMsgGetters").getOriginalSender(b);if(a==null)throw new(d("WAWebCommentMessageValidationError").CommentMessageValidationError)(d("WAWebCommentMessageValidationError").CommentMessageValidationErrorCode.MISSING_COMMENT_SENDER,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);if(g==null)throw new(d("WAWebCommentMessageValidationError").CommentMessageValidationError)(d("WAWebCommentMessageValidationError").CommentMessageValidationErrorCode.MISSING_ORIGINAL_MESSAGE_SENDER,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);f={type:"comment",encryptedAddOn:f};if((b==null?void 0:b.messageSecret)==null)throw new(d("WAWebCommentMessageValidationError").CommentMessageValidationError)(d("WAWebCommentMessageValidationError").CommentMessageValidationErrorCode.MISSING_MESSAGE_SECRET,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON.INVALID_MESSAGE);f=(yield d("WAWebAddOnEncryption").decryptAddOn(f,{messageSecret:b.messageSecret,iv:e,stanzaId:b.id.id,originalMessageSender:g,addOnSender:d("WAWebWidFactory").toUserWid(a)}));return d("decodeProtobuf").decodeProtobuf(d("WAWebProtobufsE2E.pb").MessageSpec,f)});return h.apply(this,arguments)}g.processEncCommentMsg=a}),98);
__d("WAWebAddonCommentMsgProcessor",["Promise","WAWebAddonConstants","WAWebAddonCreateMsgProcessor","WAWebBackendApi","WAWebCommentMsgDataConversion","WAWebCommentParseWebMsgInfoComment","WAWebCommunityGatingUtils","WAWebDBCommentMessageSerialization","WAWebDBUpdateLastAddOnPreviewChat","WAWebLastAddOnDBSerialization","WAWebProcessCommentMsg","WAWebShouldUpdateLastAddOnPreview","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;a=d("WAWebAddonCreateMsgProcessor").createAddonMsgProcessorWithRevokes({isEnabled:function(){return d("WAWebCommunityGatingUtils").isCommentMessageReceiverEnabled()},convert:{fromHistorySyncMsg:function(a){if(d("WAWebCommunityGatingUtils").isCommentMessageHistorySyncReceiverEnabled()){a=d("WAWebCommentParseWebMsgInfoComment").parseWebMsgInfoComment(a);return(h||(h=b("Promise"))).resolve(a)}return(h||(h=b("Promise"))).resolve([])}},parentKey:"targetMessageKey",updateCollection:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("WAWebBackendApi").frontendSendAndReceive("updateCommentCollection",{comments:a.add}),yield d("WAWebBackendApi").frontendSendAndReceive("removeFromCollection",{msgKeys:a.remove})});function c(b){return a.apply(this,arguments)}return c}(),beforeUpsert:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=[];for(a of a)if(a.addonEncrypted){var c=(yield d("WAWebProcessCommentMsg").processEncCommentMsg(a));c=d("WAWebCommentMsgDataConversion").convertMessageToCommentMsgData(c,a);b.push(c)}else b.push(a);return{result:b,upsert:b}});function c(b){return a.apply(this,arguments)}return c}(),afterUpsert:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(b.mode===d("WAWebAddonConstants").AddonProcessMode.HistorySync)return;b=(yield d("WAWebShouldUpdateLastAddOnPreview").filterChatsWithAddOnPreviewUpdates(a.map(function(a){return d("WAWebLastAddOnDBSerialization").lastAddOnPreviewCandidateFromCommentRowType(d("WAWebDBCommentMessageSerialization").dbRowFromCommentMessage(a))})));b.size>0&&(yield d("WAWebDBUpdateLastAddOnPreviewChat").updateDatabaseForLastAddOnPreview(b),d("WAWebBackendApi").frontendFireAndForget("updateChatLastAddOnPreview",{chatMap:b}))});function c(b,c){return a.apply(this,arguments)}return c}()});c=a;g["default"]=c}),98);
__d("WAWebCommentParseWebMsgInfoComment",["WALogger","WANullthrows","WAWebAddOnParseWebMsgInfo","WAWebE2EProtoUtils","WAWebMsgKeyUtils","WAWebMsgType","WAWebParseWebMessageInfoApi"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[parseWebMsgInfoComment] sender "," is not matching with from "," attribute"]);h=function(){return a};return a}function a(a){var b,e=a.webMsgInfo;a=a.isFromCag;b=e==null?void 0:(b=e.message)==null?void 0:b.commentMessage;var f=[];if(e==null||b==null)return f;var g=c("WANullthrows")(b==null?void 0:b.targetMessageKey);g=c("WANullthrows")(d("WAWebParseWebMessageInfoApi").buildMsgKey(e,g));g=g.msgKey;a=c("WANullthrows")(d("WAWebAddOnParseWebMsgInfo").buildAddonMsgKey(e.key,a,e.participant));e=a.msgKey;a=a.sender;var i=d("WAWebMsgKeyUtils").msgKeyToTargetInfo(e,d("WAWebE2EProtoUtils").TranslateMsgKeyType.Addon),j=i.from;i=i.to;j.equals(a)||d("WALogger").ERROR(h(),a.toLogString(),j.toLogString()).tags("messaging").sendLogs("parseComment",.01);f.push({id:e,parentMsgKey:g,from:a,to:i,body:c("WANullthrows")((j=b.message)==null?void 0:j.conversation),sender:a,type:d("WAWebMsgType").MSG_TYPE.COMMENT,read:!0,kind:d("WAWebMsgType").MsgKind.CommentDecrypted});return f}g.parseWebMsgInfoComment=a}),98);
__d("WAWebGenerateDocumentReportingTokenContent",["WAWebReportingTokenUtils"],(function(a,b,c,d,e,f,g){function a(a){return d("WAWebReportingTokenUtils").getMediaReportingTokenContent(a)}g["default"]=a}),98);
__d("WAWebGenerateInteractiveResponseReportingTokenContent",["WAWebReportingTokenUtils"],(function(a,b,c,d,e,f,g){function a(a){return d("WAWebReportingTokenUtils").getMediaReportingTokenContent(a)}g["default"]=a}),98);
__d("WAWebPinMsgParseWebMsgInfoPinInChat",["WALogger","WALongInt","WANullthrows","WAWebAddOnParseWebMsgInfo","WAWebWidFactory"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[history sync] parseWebMsgInfoPinInChat failed with error "," and stack ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["parseWebMsgInfoPinInChat: pinInChat sender should be a wid."]);i=function(){return a};return a}function a(a,b){var e=[];try{if(a==null||a.pinInChat==null)return e;if(b==null||b.pinInChat==null)return e;a=b.pinInChat;var f=a.key,g=a.type,j=a.senderTimestampMs,k=a.serverTimestampMs;a=a.messageAddOnContextInfo;f=c("WANullthrows")(d("WAWebAddOnParseWebMsgInfo").buildAddonMsgKey(c("WANullthrows")(f)));var l=f.msgKey;f=f.sender;if(f==null)d("WALogger").ERROR(i());else{e.push({msgKey:l,parentMsgKey:b.id,chatId:d("WAWebWidFactory").toChatWid(l.remote),senderTimestampMs:d("WALongInt").numberOrThrowIfTooLarge(c("WANullthrows")(j)),t:(b=d("WAWebAddOnParseWebMsgInfo").getAddonServerTimestamp(k))!=null?b:void 0,pinType:c("WANullthrows")(g),sender:f,pinExpiryDuration:a==null?void 0:a.messageAddOnDurationInSecs})}}catch(a){d("WALogger").ERROR(h(),a==null?void 0:a.name,a==null?void 0:a.stack)}return e}g.parseWebMsgInfoPinInChat=a}),98);
__d("WAWebPinAddonMessageProcessor",["Promise","WAArrayGroupBy","WANullthrows","WAWebABProps","WAWebAddonConstants","WAWebAddonCreateMsgProcessor","WAWebBackendApi","WAWebDBMarkFutureproofMessagesReparsed","WAWebDBProcessMessage","WAWebMsgGetters","WAWebPinMessageProcessor","WAWebPinMsgGatingUtils","WAWebPinMsgParseWebMsgInfoPinInChat","WAWebPinsDbSerialization","WAWebProtobufsE2E.pb","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;a=d("WAWebAddonCreateMsgProcessor").createAddonMsgProcessor({isEnabled:function(){return d("WAWebPinMsgGatingUtils").isPinnedMessagesM1ReceiverEnabled()&&d("WAWebABProps").getABPropConfigValue("unified_pin_addon_infra_enabled")},convert:{fromHistorySyncMsg:function(a){a=d("WAWebPinMsgParseWebMsgInfoPinInChat").parseWebMsgInfoPinInChat(a.webMsgInfo,a.parsedWebMsgInfo);a=a.map(function(a){return d("WAWebPinsDbSerialization").deserializePinInChatMsgData(d("WAWebPinsDbSerialization").serializePinInChat(a))});return(h||(h=b("Promise"))).resolve(a)}},parentKey:"pinParentKey",updateCollection:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.add;yield d("WAWebBackendApi").frontendSendAndReceive("updatePinCollection",{chatId:a[0].id.remote,msgs:a})});function c(b){return a.apply(this,arguments)}return c}(),beforeUpsert:function(a){return(h||(h=b("Promise"))).resolve({result:a,upsert:a})},afterUpsert:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){if(e.mode===d("WAWebAddonConstants").AddonProcessMode.HistorySync)return;e=b("WAWebDBMarkFutureproofMessagesReparsed");e=e.markFutureproofMessagesReparsed;var f=d("WAArrayGroupBy").groupBy(a,function(a){return a.id.remote.toString()});e=[e(a.map(function(a){return a.id.toString()}))].concat(f.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=a[0];a=a[1];var f=d("WAWebWidFactory").createWid(e);e=(yield (h||(h=b("Promise"))).all(a.map(function(a){var b=d("WAWebMsgGetters").getT(a);if(a.pinMessageType!==d("WAWebProtobufsE2E.pb").Message$PinInChatMessage$Type.PIN_FOR_ALL||b==null||d("WAWebMsgGetters").getIsFailed(a))return;return d("WAWebPinMessageProcessor").genSystemMessage(f,b,c("WANullthrows")(d("WAWebMsgGetters").getSender(a)))}).filter(Boolean)));a=(yield d("WAWebBackendApi").frontendSendAndReceive("processMultipleMessages",{chatId:f,msgObjs:e,meta:{add:"after",isHistory:!1},processMessagesOrigin:"pinMessage"}));a&&(yield d("WAWebDBProcessMessage").storeMessages(e,f))});return function(b){return a.apply(this,arguments)}}()));yield (h||(h=b("Promise"))).all(e)});function e(b,c){return a.apply(this,arguments)}return e}()});e=a;g["default"]=e}),98);
__d("WAWebPinMessageProcessor",["Promise","WAArrayGroupBy","WANullthrows","WAWebBackendApi","WAWebDBCRUDOperationsPinInChat","WAWebDBMarkFutureproofMessagesReparsed","WAWebDBMsgUtils","WAWebDBProcessMessage","WAWebDBStoreMessageOrphans","WAWebMsgGetters","WAWebMsgKey","WAWebMsgType","WAWebPinsDbSerialization","WAWebProtobufsE2E.pb","WAWebUserPrefsMeUser","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.map(function(a){return a.pinParentKey}).filter(Boolean).map(function(a){return a.toString()});a=(yield d("WAWebDBMsgUtils").getMsgsByMsgKey(a));a=new Map(a.map(function(a){return[a.id.toString(),a]}));return a});return j.apply(this,arguments)}function k(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var d=b("WAWebDBStoreMessageOrphans");d=d.storeMessageOrphans;yield d(a,function(a){return c("WANullthrows")(a.pinParentKey)})});return l.apply(this,arguments)}function a(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=d("WAArrayGroupBy").groupBy(a,function(a){return a.id.remote.toString()});yield (h||(h=b("Promise"))).all(a.map(function(a){var b=a[0];a=a[1];return n(d("WAWebWidFactory").createWid(b),a)}))});return m.apply(this,arguments)}function n(a,b){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){var f=(yield i(e)),g=[],j=[];for(e of e){var l=f.get(c("WANullthrows")(e.pinParentKey).toString());!l?g.push(e):j.push(e)}yield (h||(h=b("Promise"))).all([b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(g.length===0)return;yield k(g);var a=b("WAWebDBMarkFutureproofMessagesReparsed");a=a.markFutureproofMessagesReparsed;yield a(g.map(function(a){return a.id.toString()}))})(),b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(j.length===0)return;var e=(yield d("WAWebBackendApi").frontendSendAndReceive("updatePinCollection",{chatId:a,msgs:j}));if(e){yield d("WAWebDBCRUDOperationsPinInChat").createOrUpdatePinInChat(a,e.map(function(a){return d("WAWebPinsDbSerialization").serializePinInChat(a)}));var f=b("WAWebDBMarkFutureproofMessagesReparsed");f=f.markFutureproofMessagesReparsed;yield f(e.map(function(a){return a.msgKey.toString()}))}f=(yield (h||(h=b("Promise"))).all(j.map(function(b){return b.pinMessageType===d("WAWebProtobufsE2E.pb").Message$PinInChatMessage$Type.PIN_FOR_ALL?p(a,c("WANullthrows")(b.t),c("WANullthrows")(d("WAWebMsgGetters").getSender(b))):null}).filter(Boolean)));e=(yield d("WAWebBackendApi").frontendSendAndReceive("processMultipleMessages",{chatId:a,msgObjs:f,meta:{add:"after",isHistory:!1},processMessagesOrigin:"pinMessage"}));e&&(yield d("WAWebDBProcessMessage").storeMessages(f,a))})()])});return o.apply(this,arguments)}function p(a,b,c){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){var f=d("WAWebUserPrefsMeUser").getMeUser(),g=e.equals(f);return{id:new(c("WAWebMsgKey"))({id:yield c("WAWebMsgKey").newId(),fromMe:g,remote:a,participant:e}),author:e,from:a,to:f,recipients:[],t:b,type:d("WAWebMsgType").MSG_TYPE.PINNED_MESSAGE,kind:d("WAWebMsgType").MsgKind.PinnedMessage,templateParams:[e]}});return q.apply(this,arguments)}g.groupAndProcessPinMessages=a;g.processPinMessages=n;g.genSystemMessage=p}),98);
__d("WAWebDBPollsDeleteVotes",["Promise","WAWebDBMessageDelete","WAWebPollsVotesSchema","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("WAWebPollsVotesSchema").getTable().anyOf(["parentMsgKey"],a));if(a.length===0)return;var c=a.map(function(a){return a.msgKey});a=a.map(function(a){return[a.parentMsgKey,a.sender]});c=(yield (h||(h=b("Promise"))).allSettled([d("WAWebDBMessageDelete").removeMessagesFromHistory(c),d("WAWebPollsVotesSchema").getTable().bulkRemove(a)]));for(a of c)if(a.status==="rejected")throw a.reason});return i.apply(this,arguments)}g.deleteVotesByParentMsgKeys=a}),98);
__d("WAWebDBPollsGetParentMessages",["WANullthrows","WAWebAddonProcessMsgsUtils","WAWebMsgType","WAWebPnhGatingUtils","WAWebProcessMatMessages","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=new Set(a.map(i)),c=d("WAWebProcessMatMessages").getAlternateWidMapForPolls(a),e=c.matParentMsgKeys;c=c.alternateWidMap;e.forEach(function(a){b.add(a)});e=(yield d("WAWebAddonProcessMsgsUtils").queryAddonParentMsgs(a));a=e[0];e=e[1];var f=new Map(),g=[];for(e of e){var h=a.get(i(e));if(h==null&&d("WAWebPnhGatingUtils").isMatFullyEnabled()){var j=c.get(i(e));j!=null&&(h=a.get(j.id.toString()))}h==null||h.type===d("WAWebMsgType").MSG_TYPE.UNKNOWN?g.push(e):f.set(e,h)}return{pollUpdateMsgsToParentMsgs:f,orphans:g}});return h.apply(this,arguments)}function i(a){return c("WANullthrows")(a.pollUpdateParentKey).toString()}g.getParentMessages=a}),98);
__d("WAWebGenerateAudioOrPttReportingTokenContent",["WAWebReportingTokenUtils"],(function(a,b,c,d,e,f,g){function a(a){return d("WAWebReportingTokenUtils").getMediaReportingTokenContent(a)}g["default"]=a}),98);
__d("WAWebGeneratePtvReportingTokenContent",["WAWebReportingTokenUtils"],(function(a,b,c,d,e,f,g){function a(a){return d("WAWebReportingTokenUtils").getMediaReportingTokenContent(a)}g["default"]=a}),98);
__d("WAWebDBReactionsEncAddOnProvider",["Promise","WAWebCastToReactionMsg","WAWebHandleMsgProcess","WAWebHandleMsgProcessUtils","WAWebMessageAddOnType","WAWebMsgType","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;a={type:d("WAWebMessageAddOnType").MessageAddOnType.ReactionEnc,matches:function(a){return a.type===d("WAWebMsgType").MSG_TYPE.REACTION_ENC},matchesFutureproof:function(a){return a.type===d("WAWebMsgType").MSG_TYPE.UNKNOWN&&a.type===d("WAWebMsgType").MSG_TYPE.REACTION_ENC},canRenderInUi:function(){return!0},processOrphansForNewMsg:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){return(h||(h=b("Promise"))).all(e.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=d("WAWebCastToReactionMsg").assertReactionEncMsgData(a.parsedMsgPayload);a=(yield d("WAWebHandleMsgProcessUtils").convertEncReactionToReaction(a));a!=null&&(yield d("WAWebHandleMsgProcess").processReactionMsg(a,c,!0))});return function(b){return a.apply(this,arguments)}}()))});function c(b,c,d){return a.apply(this,arguments)}return c}()};g.reactionsEncAddOnProvider=a}),98);
__d("WAWebDeleteReactionsJob",["WALogger","WAWebDBDeleteReactions","WAWebDBMessageDelete","WAWebDefinePersistedJob","WAWebMsgKey","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Persisted: Deleting reactions from Msg table for chat: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Persisted: Deleting reactions from Msg table, reactionMsgKeys is undefined, parentMsgKeys length ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Persisted: Deleting reactions from Reactions table returned undefined, parentMsgKeys length ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Persisted: Deleting reactions from Reactions table for chat: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Persisted: NOOP step for ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Persisted: deleteReaction persisted job started"]);m=function(){return a};return a}a=d("WAWebDefinePersistedJob").defineWebPersistedJob().step("deleteReactions",function(a){var b=a.chatId;a=a.parentMsgKeys;d("WALogger").LOG(m());d("WALogger").DEV(l(),b);return{chatId:b,parentMsgKeys:a}}).step("deleteReactionsFromReactionsTable",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.chatId;a=a.parentMsgKeys;d("WALogger").DEV(k(),b);b=(yield d("WAWebDBDeleteReactions").deleteReactionsByParentMessageKeys(a));if(!b){d("WALogger").LOG(j(),a.length);return[]}return b});return function(b){return a.apply(this,arguments)}}()).finalStep("deleteReactionsFromMessageTable",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e=b.chatId;b=b.parentMsgKeys;var f=[];a||d("WALogger").LOG(i(),b.length);a.forEach(function(a){c("WAWebMsgKey").fromString(a).fromMe&&f.push(a)});f.length>0&&(d("WALogger").DEV(h(),e),yield d("WAWebDBMessageDelete").removeMessagesFromHistory(f));return a});return function(b,c){return a.apply(this,arguments)}}()).end();g.deleteReactions=a}),98);
__d("WAWebDBChangeOrphanStateReactions",["WAWebModelStorageUtils","WAWebSchemaReactions","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a){return d("WAWebModelStorageUtils").getStorage().lock(["reactions"],function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){b=b[0];var c=a.map(function(a){return[a,1]});c=(yield d("WAWebSchemaReactions").getReactionsTable().anyOf(["parentMsgKey","orphan"],c));c.forEach(function(a){a.orphan=0,a.orphanReason=void 0});yield b.bulkCreateOrReplace(c);return c});return function(a){return c.apply(this,arguments)}}())}g.changeOrphanStateReactions=a}),98);
__d("WAWebCheckUpdateOrphanReactions",["WALogger","WAWebAddonGatingUtils","WAWebAddonProcessMsgs","WAWebBackendApi","WAWebDBChangeOrphanStateReactions","WAWebMsgType","WAWebReactionDataUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["checkUpdateForOrphanReactions: error ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Updating reaction orphans"]);i=function(){return a};return a}function a(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){try{a=(yield d("WAWebDBChangeOrphanStateReactions").changeOrphanStateReactions(a));d("WALogger").DEV(i()).tags("checkUpdateForOrphanReactions");d("WAWebAddonGatingUtils").isUnifiedInfraEnabledForType(d("WAWebMsgType").MSG_TYPE.REACTION)?yield d("WAWebAddonProcessMsgs").processMsgs(a.map(function(a){return d("WAWebReactionDataUtils").reactionRowToReactionMsgData(a)})):d("WAWebBackendApi").frontendFireAndForget("checkUpdateForOrphanReactions",{updatedRecords:a})}catch(a){d("WALogger").WARN(h(),a)}});return j.apply(this,arguments)}g.checkUpdateForOrphanReactions=a}),98);
__d("WAWebMessageProcessReaction",["Promise","WALogger","WAWebBackendApi","WAWebCmd","WAWebHandleMsgReceiptCommon","WAWebMessageProcessorCache","WAWebPnhGatingUtils","WAWebProcessMatMessages","WAWebWamWorkerOfflineProcessReporter","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["processReactionMessage: msgId:",", failed with error: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[unify][message] processing reactions in cache completed"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[unify][reaction] processing "," ",""]);k=function(){return a};return a}function a(a,b,c){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){try{var f=c.offline!=null&&!e,g="online";e?g="reparsing":f&&(g="offline");d("WALogger").DEV(k(),c.externalId,g);var l=d("WAWebPnhGatingUtils").isMatFullyEnabled()?yield d("WAWebProcessMatMessages").processReactionMatMessages(a):a;g=d("WAWebMessageProcessorCache").messageProcessorCache.addMessages([{msg:l}],!f).then(function(){d("WALogger").DEV(j());d("WAWebWamWorkerOfflineProcessReporter").WorkerOfflineResumeReporter.updateProcessedMessageCount();if(!f)return d("WAWebHandleMsgReceiptCommon").processReactionOrphanPeerReceipt(l.id)});(d("WAWebCmd").Cmd.isMainStreamReadyMd||e)&&void g.then(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield d("WAWebBackendApi").frontendSendAndReceive("updateReactionUI",{msg:l,reparsing:e})}))}catch(a){d("WALogger").ERROR(i(),c.externalId,a).tags("messaging").sendLogs("handle_msg: error storing/processing single message")}return(h||(h=b("Promise"))).resolve()});return l.apply(this,arguments)}g.processReactionMessage=a}),98);
__d("WAWebGenerateImageReportingTokenContent",["WAWebReportingTokenUtils"],(function(a,b,c,d,e,f,g){function a(a){return d("WAWebReportingTokenUtils").getMediaReportingTokenContent(a)}g["default"]=a}),98);
__d("WAWebGenerateVideoReportingTokenContent",["WAWebReportingTokenUtils"],(function(a,b,c,d,e,f,g){function a(a){return d("WAWebReportingTokenUtils").getMediaReportingTokenContent(a)}g["default"]=a}),98);
__d("WAWebStatusDBMessageInfo",["Promise","WABatcher","WALogger","WAPromiseMap","WAWebApiMessageInfoStore","WAWebUserPrefsStatus","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["updatePeerStatusReceiptInfo: adding ",", setting ",", offline ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["updatePeerStatusReceiptInfoInBatch: complete to update "," records"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["updatePeerStatusReceiptInfoInBatch: staring to update "," records"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["updatePeerStatusReceiptInfoInBatch: staring to process "," records"]);l=function(){return a};return a}e={delayMs:5e3};var m=d("WABatcher").createSimpleBatcher(e,function(a){return n(a)});function n(a){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WALogger").LOG(l(),a.length);var e,f,g,i,m=(yield d("WAPromiseMap").promiseMap(a,function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var d=a.msgKey;a=a.setting;switch(a){case"denylist":e||(e=c("WAWebUserPrefsStatus").getStatusDenyList().then(function(a){return new Set(a.map(String))}));f||(f=c("WAWebUserPrefsStatus").getStatusContacts());return{msgKey:d,receiverIds:yield (h||(h=b("Promise"))).all([f,e]).then(function(a){var b=a[0],c=a[1];return b.filter(function(a){return!c.has(a.toString())})})};case"allowlist":g||(g=c("WAWebUserPrefsStatus").getStatusAllowList());return{msgKey:d,receiverIds:yield g};case"contacts":f||(f=c("WAWebUserPrefsStatus").getStatusContacts());return{msgKey:d,receiverIds:yield f};default:i||(i=c("WAWebUserPrefsStatus").getStatusList());return{msgKey:d,receiverIds:(yield i).list}}});return function(b){return a.apply(this,arguments)}}())),n=[];m.forEach(function(a){a.receiverIds.forEach(function(b){n.push({msgKey:a.msgKey,receiverId:b})})});d("WALogger").LOG(k(),n.length);yield d("WAWebApiMessageInfoStore").createOrMergeReceiptRecords(n);d("WALogger").LOG(j(),n.length);return a.map(function(){return void 0})});return o.apply(this,arguments)}function a(a,b,c){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){d("WALogger").LOG(i(),a.id,c,b);a=m.accept({msgKey:a,setting:c});b||void m.runActiveBatch();return a});return p.apply(this,arguments)}f={updatePeerStatusReceiptInfo:a};g["default"]=f}),98);
__d("WAWebUserPrefsStatusType",["$InternalEnum"],(function(a,b,c,d,e,f){a=b("$InternalEnum")({Contact:"contact",AllowList:"allow-list",DenyList:"deny-list"});f.StatusPrivacySettingType=a}),66);
__d("WAWebUserPrefsStatus",["WALogger","WAWebBackendApi","WAWebCmd","WAWebModelStorageUtils","WAWebSchemaContact","WAWebSendMsgCommonApi","WAWebUserPrefsIndexedDBStorage","WAWebUserPrefsKeys","WAWebUserPrefsMeUser","WAWebUserPrefsStatusType","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["UserPrefsStatus: staring to getStatusContacts"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["UserPrefsStatus: staring to getStatusDenyList"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["UserPrefsStatus: staring to getStatusAllowList"]);j=function(){return a};return a}function a(a){var b=a.setting;a=a.list;if(b===d("WAWebUserPrefsStatusType").StatusPrivacySettingType.Contact)return d("WAWebUserPrefsIndexedDBStorage").userPrefsIdb.set(d("WAWebUserPrefsKeys").BACKEND_ONLY_KEYS.STATUS_PRIVACY_SETTING,b);b=k({setting:b,allowList:b===d("WAWebUserPrefsStatusType").StatusPrivacySettingType.AllowList?a:void 0,denyList:b===d("WAWebUserPrefsStatusType").StatusPrivacySettingType.DenyList?a:void 0});return d("WAWebUserPrefsIndexedDBStorage").userPrefsIdb.bulkSetItemsToIndexedDB(b)}function k(a){var b=[],c=a.setting,e=a.allowList;a=a.denyList;c!=null&&b.push({key:d("WAWebUserPrefsKeys").BACKEND_ONLY_KEYS.STATUS_PRIVACY_SETTING,value:c});e!=null&&b.push({key:d("WAWebUserPrefsKeys").BACKEND_ONLY_KEYS.STATUS_ALLOW_LIST,value:Array.from(new Set(e.map(function(a){return String(d("WAWebWidFactory").toUserWid(a))})))});a!=null&&b.push({key:d("WAWebUserPrefsKeys").BACKEND_ONLY_KEYS.STATUS_DENY_LIST,value:Array.from(new Set(a.map(function(a){return String(d("WAWebWidFactory").toUserWid(a))})))});return b}function l(){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){return d("WAWebUserPrefsIndexedDBStorage").userPrefsIdb.get(d("WAWebUserPrefsKeys").BACKEND_ONLY_KEYS.STATUS_PRIVACY_SETTING)||d("WAWebUserPrefsStatusType").StatusPrivacySettingType.Contact});return m.apply(this,arguments)}function n(){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){d("WALogger").LOG(j());var a=d("WAWebUserPrefsIndexedDBStorage").userPrefsIdb.get(d("WAWebUserPrefsKeys").BACKEND_ONLY_KEYS.STATUS_ALLOW_LIST);return a!=null?a.map(d("WAWebWidFactory").createWid):[]});return o.apply(this,arguments)}function p(){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){d("WALogger").LOG(i());var a=d("WAWebUserPrefsIndexedDBStorage").userPrefsIdb.get(d("WAWebUserPrefsKeys").BACKEND_ONLY_KEYS.STATUS_DENY_LIST);return a!=null?a.map(d("WAWebWidFactory").createWid):[]});return q.apply(this,arguments)}function r(){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){d("WALogger").LOG(h());if(d("WAWebCmd").Cmd.isMainStreamReadyMd){var a=(yield d("WAWebBackendApi").frontendSendAndReceive("getFilteredContacts",{showMe:!1,showWithoutName:!1,includeLidContacts:!1}));return a.map(function(a){return a.id})}a=(yield d("WAWebSchemaContact").getContactTable().equals(["isAddressBookContact"],1));return a.map(function(a){return d("WAWebWidFactory").createWid(a.id)}).filter(function(a){return!a.isLid()})});return s.apply(this,arguments)}function c(){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){return d("WAWebModelStorageUtils").getStorage().lock(["user-prefs","contact"],b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield l()),b;switch(a){case d("WAWebUserPrefsStatusType").StatusPrivacySettingType.AllowList:return{setting:d("WAWebUserPrefsStatusType").StatusPrivacySettingType.AllowList,list:yield n()};case d("WAWebUserPrefsStatusType").StatusPrivacySettingType.DenyList:b=new Set((yield p()).map(String));return{setting:d("WAWebUserPrefsStatusType").StatusPrivacySettingType.DenyList,list:(yield r()).filter(function(a){return!b.has(a.toString())})};case d("WAWebUserPrefsStatusType").StatusPrivacySettingType.Contact:return{setting:d("WAWebUserPrefsStatusType").StatusPrivacySettingType.Contact,list:yield r()}}}))});return t.apply(this,arguments)}function e(){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){return d("WAWebModelStorageUtils").getStorage().lock(["user-prefs"],b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield l()),b=(yield n()),c=(yield p());return{setting:a,allowList:b,denyList:c}}))});return u.apply(this,arguments)}function v(){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=d("WAWebUserPrefsIndexedDBStorage").userPrefsIdb.get(d("WAWebUserPrefsKeys").BACKEND_ONLY_KEYS.STATUS_SENDER_KEY);return a||{rotateKey:!1,senderKey:new Set()}});return w.apply(this,arguments)}function f(a){return x.apply(this,arguments)}function x(){x=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){return d("WAWebModelStorageUtils").getStorage().lock(["user-prefs"],b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=(yield v()),c=b.rotateKey?new Set():b.senderKey;a.forEach(function(a){c.add(String(a))});yield d("WAWebUserPrefsIndexedDBStorage").userPrefsIdb.set(d("WAWebUserPrefsKeys").BACKEND_ONLY_KEYS.STATUS_SENDER_KEY,{rotateKey:!1,senderKey:c})}))});return x.apply(this,arguments)}function y(a){return z.apply(this,arguments)}function z(){z=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){return d("WAWebModelStorageUtils").getStorage().lock(["user-prefs"],b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=(yield v());if(b.rotateKey)return;var c=a.some(function(a){return b.senderKey.has(String(a))});c&&(yield d("WAWebUserPrefsIndexedDBStorage").userPrefsIdb.set(d("WAWebUserPrefsKeys").BACKEND_ONLY_KEYS.STATUS_SENDER_KEY,{rotateKey:!0,senderKey:new Set()}))}))});return z.apply(this,arguments)}function A(a){return B.apply(this,arguments)}function B(){B=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){return d("WAWebModelStorageUtils").getStorage().lock(["user-prefs"],b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=(yield v());a.forEach(function(a){b.senderKey["delete"](String(a))});yield d("WAWebUserPrefsIndexedDBStorage").userPrefsIdb.set(d("WAWebUserPrefsKeys").BACKEND_ONLY_KEYS.STATUS_SENDER_KEY,{rotateKey:b.rotateKey,senderKey:b.senderKey})}))});return B.apply(this,arguments)}function C(a){return D.apply(this,arguments)}function D(){D=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield v());if(b.rotateKey||b.senderKey.size===0)return{rotateKey:b.rotateKey,skDistribList:a,participantList:[]};var c=[],e=[],f=0;a.forEach(function(a){b.senderKey.has(String(a))?(d("WAWebSendMsgCommonApi").isPrimaryDevice(a)&&c.push(a),f++):d("WAWebUserPrefsMeUser").isMeDevice(a)||e.push(a)});if(f<b.senderKey.size){yield d("WAWebUserPrefsIndexedDBStorage").userPrefsIdb.set(d("WAWebUserPrefsKeys").BACKEND_ONLY_KEYS.STATUS_SENDER_KEY,{rotateKey:!0,senderKey:new Set()});return{rotateKey:!0,skDistribList:a,participantList:[]}}return{rotateKey:b.rotateKey,skDistribList:e,participantList:c}});return D.apply(this,arguments)}a={setStatusPrivacyConfig:a,calculateStatusPrivacyUpdateEntries:k,getStatusPrivacySetting:l,getStatusAllowList:n,getStatusDenyList:p,getStatusSkDistribList:C,markStatusHasSenderKey:f,getStatusContacts:r,getStatusList:c,getStatusPrivacySettingConfig:e,markForgetStatusSenderKey:A,markStatusSenderKeyRotate:y};g["default"]=a}),98);
__d("WAWebGenerateStickerReportingTokenContent",["WAWebReportingTokenUtils"],(function(a,b,c,d,e,f,g){function a(a){return d("WAWebReportingTokenUtils").getMediaReportingTokenContent(a)}g["default"]=a}),98);
__d("WAWebBizCreateBizStateChangeNotificationMsgsAction",["Promise","WAWebContactSystemMsg","WAWebHandleSingleMsg","WAWebPrivacyModeSystemMsg","WAWebUserPrefsNotifications","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function a(a,b,c){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){c=l(c);e=l(e);c=[k(a,c,e),j(a,c,e)];yield (h||(h=b("Promise"))).all(c.map(function(b){return b?d("WAWebHandleSingleMsg").handleSingleMsg(a,b,"bizStateChangeNotification"):null}))});return i.apply(this,arguments)}function j(a,b,c){if(d("WAWebUserPrefsNotifications").getGlobalSecurityNotifications()!==!0)return;if(b===d("WAWebPrivacyModeSystemMsg").ReducedPrivacyMode.E2EE&&c!==d("WAWebPrivacyModeSystemMsg").ReducedPrivacyMode.E2EE)return d("WAWebContactSystemMsg").genEncryptNotificationMsg(a,"e2e_identity_unavailable")}function k(a,b,c){if(b===c)return;switch(c){case d("WAWebPrivacyModeSystemMsg").ReducedPrivacyMode.E2EE:return d("WAWebContactSystemMsg").genEncryptNotificationMsg(a,"encrypt_now");case d("WAWebPrivacyModeSystemMsg").ReducedPrivacyMode.BSP:return d("WAWebContactSystemMsg").genNonE2ENotificationMsg(a,"biz_privacy_mode_to_bsp");case d("WAWebPrivacyModeSystemMsg").ReducedPrivacyMode.FB:return d("WAWebContactSystemMsg").genNonE2ENotificationMsg(a,"biz_privacy_mode_to_fb")}}function l(a){return d("WAWebPrivacyModeSystemMsg").getReducedPrivacyMode(a.isBusiness?a.privacyMode:null)}g["default"]=a}),98);
__d("WAWebMexSetUsernameJob",["WALogger","WAWebMexClient","WAWebMexRelayEnvironmentV2","WAWebMexSetUsernameJobMutation.graphql","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[MEX][USERNAME] Failed to set username via mex"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[MEX][USERNAME] Successfully fetched set username mutation via mex"]);j=function(){return a};return a}function a(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a={input:a};var c=h!==void 0?h:h=b("WAWebMexSetUsernameJobMutation.graphql");try{c=(yield d("WAWebMexClient").fetchQuery(c,a));d("WALogger").DEV(j()).tags("GQL","MEX").devConsole({response:c});return{isUsernameApproved:((a=c.xwa2_username_set)==null?void 0:a.result)==="SUCCESS"}}catch(a){d("WALogger").ERROR(i()).tags("GQL","MEX").devConsole({e:a});if(a instanceof d("WAWebMexRelayEnvironmentV2").MexIqError)return{isUsernameApproved:!1,error:{code:a.code,text:"MexIqError:"+a.message}};if(a instanceof d("WAWebMexRelayEnvironmentV2").MexFatalExtensionError)return{isUsernameApproved:!1,error:{code:a.error.extensions.error_code,text:"MexFatalExtensionError:"+a.error.message}};throw a}});return k.apply(this,arguments)}g.mexSetUsernameQueryJob=a}),98);
__d("WAWebSetUsernameJob",["WAJobOrchestratorTypes","WALogger","WAWebApiContact","WAWebBackendApi","WAWebBackendErrors","WAWebMexSetUsernameJob","WAWebOrchestratorNonPersistedJob","WAWebUserPrefsMeUser","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[username] ",": updating "," username in db + collection"]);h=function(){return a};return a}function a(a){return d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("setUsernameQueryJob",b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=(yield d("WAWebMexSetUsernameJob").mexSetUsernameQueryJob(a)),c=b.isUsernameApproved;b=b.error;if(c){c=d("WAWebUserPrefsMeUser").assertGetMeUser();yield i([{userId:c,username:a}]);return!0}else if(b!=null)throw new(d("WAWebBackendErrors").ServerStatusCodeError)(b.code,b.text);return!1}),{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION}).waitUntilCompleted()}function i(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.map(function(a){var b=a.userId;a=a.username;var c=b.toJid();d("WALogger").LOG(h(),b.toLogString(),a==null||a===""?"empty":"non-empty");return{id:c,username:a}});yield d("WAWebApiContact").bulkUpdateUsernamesInDb(a);yield d("WAWebBackendApi").frontendSendAndReceive("bulkUpdateUsernames",{usernameUpdates:a})});return j.apply(this,arguments)}g.setUsernameQueryJob=a;g.setUsernamesJob=i}),98);
__d("WAWebUsernameGatingUtils",["WAWebABProps","WAWebPrimaryFeatures"],(function(a,b,c,d,e,f,g){function a(){return Boolean(d("WAWebABProps").getABPropConfigValue("username_change"))}function b(){return Boolean(d("WAWebABProps").getABPropConfigValue("username_contact_display"))}function c(){return Boolean(d("WAWebABProps").getABPropConfigValue("username_usync"))}function e(){return Boolean(d("WAWebABProps").getABPropConfigValue("username_1on1_chat"))}function f(){return Boolean(d("WAWebABProps").getABPropConfigValue("username_creation"))}function h(){return Boolean(d("WAWebABProps").getABPropConfigValue("username_contact_display"))&&Boolean(d("WAWebABProps").getABPropConfigValue("username_1on1_chat"))&&Boolean(d("WAWebABProps").getABPropConfigValue("username_usync"))}function i(){return d("WAWebABProps").getABPropConfigValue("username_creation")&&d("WAWebPrimaryFeatures").primaryFeatureEnabled("username_supported")}function j(){return Boolean(d("WAWebABProps").getABPropConfigValue("username_security_code_generation"))}function k(){return Boolean(d("WAWebABProps").getABPropConfigValue("username_security_code_verification"))}g.usernameChangeEnabled=a;g.usernameDisplayedEnabled=b;g.usernameUsyncEnabled=c;g.username1on1ChatCreationEnabled=e;g.usernameCreationEnabled=f;g.usernameContactlessChatEnabled=h;g.usernameSupported=i;g.usernameSecurityCodeGenerationEnabled=j;g.usernameSecurityCodeVerificationEnabled=k}),98);
__d("WAWebQueryExistsJob",["WALogger","WAPhoneUtils","WAWebApiContact","WAWebBackendErrors","WAWebSetUsernameJob","WAWebUpdateLidMetadataJob","WAWebUsernameGatingUtils","WAWebUsync","WAWebUsyncUser","WAWebWid","WAWebWidFactory","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[usync] username info response"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[usync] querying username: "," for contact info"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[usync] username info response"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[usync] querying contact: "," for username info"]);k=function(){return a};return a}function a(a){var b=a.isLid()?"":"+"+a.toString();return a.isLid()?l({type:"lid",wid:a}):l({type:"phone",phone:b})}function e(a){return l({type:"phone",phone:a})}function l(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.type==="lid"&&!a.wid.isLid())throw c("err")("queryExist is provided with invalid lid");var b=new(d("WAWebUsyncUser").USyncUser)(),e=new(d("WAWebUsync").USyncQuery)();a.type==="phone"?(e.withContactProtocol(),b.withPhone(a.phone)):b.withId(a.wid);e.withLidProtocol();if(a.type==="phone"){var f=d("WAPhoneUtils").extractDigits(a.phone)+"@c.us";if(c("WAWebWid").isWid(f)){f=d("WAWebApiContact").getCurrentLid(d("WAWebWidFactory").createUserWid(f));f&&b.withLid(f)}}e.withUser(b);e.withBusinessProtocol();e.withDisappearingModeProtocol();d("WAWebUsernameGatingUtils").usernameUsyncEnabled()&&e.withUsernameProtocol();f=(yield e.execute());b=f.error.all||f.error.contact;if(b)throw new(d("WAWebBackendErrors").ServerStatusCodeError)(b.errorCode,b.errorText);e=f.list;if(e.length!==1)return null;b=e[0];f=b.id;e=b.contact;var g=b.business,h=b.disappearing_mode,i=b.lid;b=b.username;if(a.type==="phone"&&(e==null?void 0:e.type)!=="in")return null;a={wid:f,biz:g!=null,bizInfo:g};h&&(a.disappearingMode={duration:h.duration,settingTimestamp:h.t});i!=null&&(yield d("WAWebUpdateLidMetadataJob").createLidPnMappingsJob([{pn:f,lid:d("WAWebWidFactory").createUserWid(i,"lid")}],!0));d("WAWebUsernameGatingUtils").usernameUsyncEnabled()&&b!=null?yield d("WAWebSetUsernameJob").setUsernamesJob([{userId:f,username:b}]):yield d("WAWebSetUsernameJob").setUsernamesJob([{userId:f,username:void 0}]);return a});return m.apply(this,arguments)}function f(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(!a.isLid())return;d("WALogger").LOG(k(),a).devConsole({wid:a});var b=new(d("WAWebUsyncUser").USyncUser)(),c=new(d("WAWebUsync").USyncQuery)();b.withId(a);c.withUser(b);c.withUsernameProtocol();a=(yield c.execute());b=a.error.all||a.error.contact;d("WALogger").LOG(j()).devConsole({res:a,error:b});if(b)throw new(d("WAWebBackendErrors").ServerStatusCodeError)(b.errorCode,b.errorText);c=a.list;if(c.length!==1)return null;b=c[0];a=b.id;c=b.username;c!=null?yield d("WAWebSetUsernameJob").setUsernamesJob([{userId:a,username:c}]):Object.prototype.hasOwnProperty.call(b,"username")||(yield d("WAWebSetUsernameJob").setUsernamesJob([{userId:a,username:void 0}]));b={wid:a,username:c,biz:!1};return b});return n.apply(this,arguments)}function o(a){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WALogger").LOG(i(),a).devConsole({queryUsername:a});var b=new(d("WAWebUsyncUser").USyncUser)(),c=new(d("WAWebUsync").USyncQuery)();c.withUser(b);c.withContactProtocol();b.withUsername(a);b=(yield c.execute());a=b.error.all||b.error.contact;d("WALogger").LOG(h()).devConsole({res:b,error:a});if(a)throw new(d("WAWebBackendErrors").ServerStatusCodeError)(a.errorCode,a.errorText);c=b.list;if(c.length!==1)return null;a=c[0];b=a.id;c=a.contact;a=c.username;c=c.type;if(c==="out")return null;a!=null?yield d("WAWebSetUsernameJob").setUsernamesJob([{userId:b,username:a}]):yield d("WAWebSetUsernameJob").setUsernamesJob([{userId:b,username:void 0}]);c={wid:b,username:a,biz:!1};return c});return p.apply(this,arguments)}g.queryWidExists=a;g.queryPhoneExists=e;g.queryExist=l;g.queryWidUsernameExists=f;g.queryUsernameExists=o}),98);
__d("WAWebBizUpdateVerifiedInfoAction",["WAWebApiVerifiedBusinessName","WAWebBackendApi","WAWebHandlePrivacyModeUpdateMsgAction","WAWebQueryExistsJob","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=b.name,e=b.level,f=b.isApi,g=b.isSmb,h=b.serial;b=b.privacyMode;b!=null&&(yield d("WAWebHandlePrivacyModeUpdateMsgAction").handlePrivacyModeTransition(a,b,{bypassVerifiedNameUpdate:!0}));d("WAWebBackendApi").frontendFireAndForget("updateContactWithVerifiedName",{contactId:a,verifiedNameInfo:{id:a,name:c,level:e,isApi:f,isSmb:g,privacyMode:b}});yield d("WAWebApiVerifiedBusinessName").createOrUpdateVerifiedBusinessName(a,{level:e,serial:h,name:c,isApi:f,isSmb:g,privacyMode:b?{actualActors:b.actualActors,hostStorage:b.hostStorage,privacyModeTs:b.privacyModeTs}:null})});return i.apply(this,arguments)}function a(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield d("WAWebQueryExistsJob").queryWidExists(a));if(b==null)return;b=b.bizInfo;b&&(yield h(a,b.verifiedName))});return j.apply(this,arguments)}g.updateVerifiedInfo=h;g.queryAndUpdateContactPropertiesOnNewChat=a}),98);
__d("WAWebHandlePrivacyModeUpdateMsgAction",["Promise","WAWebApiChat","WAWebApiVerifiedBusinessName","WAWebBackendApi","WAWebBizCreateBizStateChangeNotificationMsgsAction","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function a(a,b,c){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){var g;f===void 0&&(f={});if(!a.isUserNotPSA()||a.isCAPISupportAccount())return;var i=(yield j(a,f.chat));if(i==null)return;if(i.isBusiness===!1)return;if(i.privacyMode==null&&e==null)return;if(i.privacyMode!=null&&e!=null&&i.privacyMode.privacyModeTs>=e.privacyModeTs)return;f=f;f=f.bypassVerifiedNameUpdate;f=f===void 0?!1:f;g={isBusiness:(g=i.isBusiness)!=null?g:!1,privacyMode:i.privacyMode};i={isBusiness:!0,privacyMode:e};d("WAWebBackendApi").frontendFireAndForget("updateBusinessInfo",{contactId:a,businessInfo:{isBusiness:!0,isEnterprise:!0,privacyMode:e}});yield (h||(h=b("Promise"))).all([f?null:d("WAWebApiVerifiedBusinessName").createOrUpdateVerifiedBusinessName(a,{isApi:!0,isSmb:!1,privacyMode:e?{actualActors:e.actualActors,hostStorage:e.hostStorage,privacyModeTs:e.privacyModeTs}:null},d("WAWebApiVerifiedBusinessName").VerifiedBusinessNameUpdateType.Merge),c("WAWebBizCreateBizStateChangeNotificationMsgsAction")(a,g,i)])});return i.apply(this,arguments)}function j(a,b){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){if(c!=null){var e=c.contact.isBusiness;return{isBusiness:e,privacyMode:e?c.contact.privacyMode:null}}e=(yield (h||(h=b("Promise"))).all([d("WAWebApiChat").getChatRecord(a),d("WAWebApiVerifiedBusinessName").getVerifiedBusinessNameRecord(a)]));c=e[0];a=e[1];if(c==null)return null;return a==null?{isBusiness:null}:{isBusiness:!0,privacyMode:a.privacyMode==null?null:d("WAWebApiVerifiedBusinessName").convertPrivacyModeFromStorageType(a.privacyMode)}});return k.apply(this,arguments)}g.handlePrivacyModeTransition=a;g.getChatInfo=j}),98);
__d("WAWebAddonProcessDeleteForMe",["WALogger","WASyncdConst","WAWebAddonConstants","WAWebAddonDBTable","WAWebAddonPluginProcessor","WAWebMsgType","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: successfully deleted "," for me."]);h=function(){return a};return a}function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){return d("WAWebAddonDBTable").addonDBTable.getByMsgKey(d("WAWebMsgType").MSG_TYPE.COMMENT,a)});return i.apply(this,arguments)}function c(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("WAWebAddonDBTable").addonInternalDBTable.bulkRemoveByMsgKey(d("WAWebAddonConstants").AddonTableMode.Comment,[a]);var b=d("WAWebAddonPluginProcessor").getAddonProcessor(d("WAWebMsgType").MSG_TYPE.COMMENT);yield b.updateCollection({add:[],remove:[a]});d("WALogger").DEV(h(),a);return{actionState:d("WASyncdConst").SyncActionState.Success}});return j.apply(this,arguments)}g.hasDeleteAddonForMe=a;g.processDeleteForMe=c}),98);
__d("WAWebWamEnumMdLinkDeviceCompanionStage",[],(function(a,b,c,d,e,f){a=Object.freeze({PAIR_SUCCESS_RECEIVED:1,PAIR_DEVICE_SIGN_SENT:2,FIRST_CONNECT:3,UPLOAD_PREKEYS:4,COMPLETE:5,GENERATE_PREKEYS:6,SENT_PREKEYS:7});f.MD_LINK_DEVICE_COMPANION_STAGE=a}),66);
__d("WAWebMdLinkDeviceCompanionWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumMdLinkDeviceCompanionStage"],(function(a,b,c,d,e,f,g){b=(a=d("WAWebWamCodegenUtils")).defineEvents({MdLinkDeviceCompanion:[2576,{mdDurationS:[8,a.TYPES.INTEGER],mdLinkDeviceCompanionErrorCode:[6,a.TYPES.INTEGER],mdLinkDeviceCompanionStage:[4,d("WAWebWamEnumMdLinkDeviceCompanionStage").MD_LINK_DEVICE_COMPANION_STAGE],mdRegAttemptId:[9,a.TYPES.STRING],mdSessionId:[1,a.TYPES.STRING],mdTimestampS:[7,a.TYPES.INTEGER],mdWasUpgraded:[5,a.TYPES.BOOLEAN]},[1,1,1],"regular"]});g.MdLinkDeviceCompanionWamEvent=b}),98);
__d("WAWebWamDeviceLinkReporter",["WABase64","WABinary","WACryptoSha256","WAResolvable","WATimeUtils","WAWebMdLinkDeviceCompanionWamEvent","WAWebWamEnumMdLinkDeviceCompanionStage","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h=null,i=null,j=null,k=null;function a(a,b,c){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){h=new(d("WAWebMdLinkDeviceCompanionWamEvent").MdLinkDeviceCompanionWamEvent)();a=(yield n(a,b));i={regStartTime:c,sessionId:a}});return l.apply(this,arguments)}function c(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b;if(!h)return;yield (b=k)==null?void 0:b.promise;k=new(d("WAResolvable").Resolvable)();j=a;yield p()});return m.apply(this,arguments)}function n(a,b){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=new(d("WABinary").Binary)();c.writeBuffer(a);c.write("_".charCodeAt(0));c.writeBuffer(b);a=c.readByteArray();b=(yield d("WACryptoSha256").sha256(a));return d("WABase64").encodeB64(b)});return o.apply(this,arguments)}function p(a){if(!h||!i)return;var b=i,c=d("WATimeUtils").unixTimeWithoutClockSkewCorrection()-b.regStartTime;if(j==null)return;h=new(d("WAWebMdLinkDeviceCompanionWamEvent").MdLinkDeviceCompanionWamEvent)({mdDurationS:c,mdSessionId:b.sessionId,mdTimestampS:b.regStartTime,mdLinkDeviceCompanionErrorCode:a==null?0:a,mdLinkDeviceCompanionStage:j});c=h;c.commitAndWaitForFlush(!0);(b=k)==null?void 0:b.resolve();(a!=null||c.mdLinkDeviceCompanionStage===d("WAWebWamEnumMdLinkDeviceCompanionStage").MD_LINK_DEVICE_COMPANION_STAGE.COMPLETE)&&(h=null,i=null,j=null)}g.initDeviceLinkEvent=a;g.setDeviceLinkPairStage=c;g.commitDeviceLinkEvent=p}),98);
__d("WAWebCompanionRegUtils",["WALogger","WAShiftTimer","WATimeUtils","WAWebAdvSignatureApi","WAWebCmd","WAWebLogoutReasonConstants","WAWebSocketLogoutJob","WAWebSocketModel","WAWebUserPrefsIsLoggedIn","WAWebWamDeviceLinkReporter","WAWebWamEnumMdLinkDeviceCompanionStage","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[history sync][reg] main screen unblocked in ","ms"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[history sync][reg] begin device pairing latency measurement"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["logout due to initial history sync timeout"]);j=function(){return a};return a}var k=!1,l=!1,m=1e3,n=6e4*3;function o(){d("WALogger").ERROR(j()),void d("WAWebSocketLogoutJob").socketLogout(d("WAWebLogoutReasonConstants").LogoutReason.HistorySyncTimeout)}function a(){k=!1,l=!1}function c(){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(k||l)return;yield d("WAWebWamDeviceLinkReporter").setDeviceLinkPairStage(d("WAWebWamEnumMdLinkDeviceCompanionStage").MD_LINK_DEVICE_COMPANION_STAGE.FIRST_CONNECT);k=!0;yield d("WAWebAdvSignatureApi").clearADVSecretKey();d("WAWebUserPrefsIsLoggedIn").setIsConnectedAsRegistered(!0)});return p.apply(this,arguments)}function q(){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(k||l)return;l=!0;yield d("WAWebSocketModel").Socket.clearCredentialsAndStoredData();yield d("WAWebAdvSignatureApi").clearADVSecretKey()});return r.apply(this,arguments)}function e(){new(d("WAShiftTimer").ShiftTimer)(function(){q()}).onOrAfter(m)}var s;function f(){s==null&&(s=self.setTimeout(o,n),d("WAWebCmd").Cmd.on("on_initial_chat_synced",function(){self.clearTimeout(s)}))}function t(){var a=d("WATimeUtils").unixTimeMs();d("WALogger").LOG(i());d("WAWebCmd").Cmd.on("on_critical_sync_done",function(){d("WALogger").LOG(h(),d("WATimeUtils").unixTimeMs()-a)})}g.resetCompanionReg=a;g.startLogin=c;g.startLogout=q;g.logoutAfterValidationFail=e;g.startInitialHistorySyncTimeout=f;g.initDevicePairingLatencyMeasurement=t}),98);
__d("WASmaxInPassiveModeActiveIQResponseSuccess",["WAResultOrError","WASmaxParseJid","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"active");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","result");if(!c.success)return c;b=d("WASmaxParseJid").literalJid(d("WASmaxParseJid").attrDomainJid,a,"from","s.whatsapp.net");return!b.success?b:d("WAResultOrError").makeResult({type:c.value,from:b.value})}g.parseActiveIQResponseSuccess=a}),98);
__d("WASmaxOutPassiveModeActiveIQRequest",["WASmaxJsx","WAWap"],(function(a,b,c,d,e,f,g){function a(){var a=d("WASmaxJsx").smax("iq",{id:d("WAWap").generateId(),type:"set",xmlns:"passive",to:d("WAWap").S_WHATSAPP_NET},d("WASmaxJsx").smax("active",null));return a}g.makeActiveIQRequest=a}),98);
__d("WASmaxPassiveModeActiveIQRPC",["WAComms","WASmaxInPassiveModeActiveIQResponseSuccess","WASmaxOutPassiveModeActiveIQRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a){var c,e,f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:c=d("WASmaxOutPassiveModeActiveIQRequest").makeActiveIQRequest();g.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(c,a));case 3:e=g.sent;f=d("WASmaxInPassiveModeActiveIQResponseSuccess").parseActiveIQResponseSuccess(e,c);if(!f.success){g.next=7;break}return g.abrupt("return",{name:"ActiveIQResponseSuccess",value:f.value});case 7:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("ActiveIQ",{Success:f}));case 8:case"end":return g.stop()}},null,this)}g.sendActiveIQRPC=a}),98);
__d("WASmaxInPassiveModePassiveIQResponseSuccess",["WAResultOrError","WASmaxParseJid","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"passive");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","result");if(!c.success)return c;b=d("WASmaxParseJid").literalJid(d("WASmaxParseJid").attrDomainJid,a,"from","s.whatsapp.net");return!b.success?b:d("WAResultOrError").makeResult({type:c.value,from:b.value})}g.parsePassiveIQResponseSuccess=a}),98);
__d("WASmaxOutPassiveModePassiveIQRequest",["WASmaxJsx","WAWap"],(function(a,b,c,d,e,f,g){function a(){var a=d("WASmaxJsx").smax("iq",{id:d("WAWap").generateId(),type:"set",xmlns:"passive",to:d("WAWap").S_WHATSAPP_NET},d("WASmaxJsx").smax("passive",null));return a}g.makePassiveIQRequest=a}),98);
__d("WASmaxPassiveModePassiveIQRPC",["WAComms","WASmaxInPassiveModePassiveIQResponseSuccess","WASmaxOutPassiveModePassiveIQRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a){var c,e,f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:c=d("WASmaxOutPassiveModePassiveIQRequest").makePassiveIQRequest();g.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(c,a));case 3:e=g.sent;f=d("WASmaxInPassiveModePassiveIQResponseSuccess").parsePassiveIQResponseSuccess(e,c);if(!f.success){g.next=7;break}return g.abrupt("return",{name:"PassiveIQResponseSuccess",value:f.value});case 7:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("PassiveIQ",{Success:f}));case 8:case"end":return g.stop()}},null,this)}g.sendPassiveIQRPC=a}),98);
__d("WASendPassiveModeProtocol",["WALogger","WASmaxPassiveModeActiveIQRPC","WASmaxPassiveModePassiveIQRPC","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendPassiveModeIq: passive mode set to '","'"]);h=function(){return a};return a}function a(a){return b("regeneratorRuntime").async(function(c){while(1)switch(c.prev=c.next){case 0:if(!(a==="active")){c.next=5;break}c.next=3;return b("regeneratorRuntime").awrap(d("WASmaxPassiveModeActiveIQRPC").sendActiveIQRPC());case 3:c.next=7;break;case 5:c.next=7;return b("regeneratorRuntime").awrap(d("WASmaxPassiveModePassiveIQRPC").sendPassiveIQRPC());case 7:d("WALogger").LOG(h(),a);case 8:case"end":return c.stop()}},null,this)}g.sendPassiveModeProtocol=a}),98);
__d("WAWebPassiveModeManager",["Promise","WAAbortError","WALogger","WAPromiseRaceAbort","WAResolvable","WASendPassiveModeProtocol","WAWebCmd","WAWebPageLoadLogging","WAWebWamOfflineResumeReporter"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["PassiveModeManager: setPassiveModeTimeout: config timeout to be ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["PassiveModeManager: send passive active iq"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["PassiveModeManager: _endPassiveMode"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["PassiveModeManager: executePassiveTasks: passive mode end with timeout"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["PassiveModeManager: executePassiveTasks: done"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["PassiveModeManager: executePassiveTasks: end with error ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["PassiveModeManager: executePassiveTasks: abort by disconnect, skip send active"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["PassiveModeManager: executePassiveTasks: complete all tasks"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["PassiveModeManager: executePassiveTasks: failed for single task with ",""]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["PassiveModeManager: executePassiveTasks: start to execute "," passive tasks"]);r=function(){return a};return a}function a(){var b=babelHelpers.taggedTemplateLiteralLoose(["PassiveModeManager: enable debug passive mode"]);a=function(){return b};return b}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["PassiveModeManager: register passive task"]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["PassiveModeManager: reset status"]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["PassiveModeManager: processing tasks finished: ",""]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["PassiveModeManager: "," current tasks"]);v=function(){return a};return a}function w(){var a=babelHelpers.taggedTemplateLiteralLoose(["PassiveModeManager: trying to abort passive mode because of disconnect"]);w=function(){return a};return a}var x=6e4;e=function(){function a(){var a=this;this._disconnectAbortController=new AbortController();this._passiveEndPromise=new(d("WAResolvable").Resolvable)();this._debugPassiveModeEnabled=!1;this._passiveTasks=[];this._passiveModeTimeout=x;d("WAWebCmd").Cmd.on("socket_stream_disconnected",function(){var b;d("WALogger").LOG(w());d("WALogger").LOG(v(),a._passiveTasks.length);d("WALogger").LOG(u(),a._passiveEndPromise.resolveWasCalled());(b=a._disconnectAbortController)==null?void 0:b.abort();a.resetState()})}var e=a.prototype;e.resetState=function(){d("WALogger").LOG(t()),this._passiveTasks=[],this._passiveTimeoutTimer&&(self.clearTimeout(this._passiveTimeoutTimer),this._passiveTimeoutTimer=null),this._debugPassiveModeEnabled=!1,this._passiveEndPromise.resolveWasCalled()||this._passiveEndPromise.resolve(),this._passiveEndPromise=new(d("WAResolvable").Resolvable)(),this._disconnectAbortController=new AbortController()};e.registerPassiveTask=function(a){d("WALogger").LOG(s()),this._passiveTasks.push(a)};e.enableDebugPassiveMode=function(){};e.executePassiveTasks=function(){var a=this;if(!this.shouldConnectAsPassiveMode()){this._passiveEndPromise.resolve();return}d("WAWebPageLoadLogging").startPageLoadQplMeasure("passive_tasks");d("WALogger").LOG(r(),this._passiveTasks.length);void c("WAPromiseRaceAbort")((h||(h=b("Promise"))).all(this._passiveTasks.map(function(a){return a()["catch"](function(a){d("WALogger").ERROR(q(),a)})})),this._disconnectAbortController.signal).then(function(){d("WALogger").LOG(p()),void a._endPassiveMode()})["catch"](d("WAAbortError").catchAbort(function(){d("WALogger").LOG(o()),a._passiveEndPromise.resolve()}))["catch"](function(b){d("WALogger").ERROR(n(),b),void a._endPassiveMode()})["finally"](function(){d("WAWebPageLoadLogging").endPageLoadQplMeasure("passive_tasks"),d("WALogger").LOG(m()),a.resetState()});this._passiveTimeoutTimer=self.setTimeout(function(){d("WALogger").ERROR(l()).sendLogs("passive-timeout"),void a._endPassiveMode(),a.resetState()},this._passiveModeTimeout)};e._endPassiveMode=function(){d("WALogger").LOG(k()),this._passiveEndPromise.resolve(),d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.logOfflinePassiveT(),this._debugPassiveModeEnabled||(d("WALogger").LOG(j()),void d("WASendPassiveModeProtocol").sendPassiveModeProtocol("active"))};e.waitForPassiveTaskEnd=function(){return this._passiveEndPromise.promise};e.shouldConnectAsPassiveMode=function(){return this._debugPassiveModeEnabled||this._passiveTasks.length>0};e.setPassiveModeTimeout=function(a){d("WALogger").LOG(i(),a),this._passiveModeTimeout=a};return a}();f=new e();g.PassiveTaskManager=f}),98);
__d("WAWebABPropsWamGlobals",["WAWebABProps","WAWebWamGlobals"],(function(a,b,c,d,e,f,g){function a(){d("WAWebWamGlobals").Global.set({serviceImprovementOptOut:d("WAWebABProps").getABPropConfigValue("service_improvement_opt_out_flag")})}g.setAbPropDependingGlobalWamAttributes=a}),98);
__d("WASmaxInAbPropsIQErrorBadRequestMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","bad-request");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",400);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorBadRequestMixin=a}),98);
__d("WASmaxInAbPropsIQErrorFeatureNotImplementedMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","feature-not-implemented");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",501);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorFeatureNotImplementedMixin=a}),98);
__d("WASmaxInAbPropsIQErrorBadRequestOrFeatureNotImplementedMixinGroup",["WAResultOrError","WASmaxInAbPropsIQErrorBadRequestMixin","WASmaxInAbPropsIQErrorFeatureNotImplementedMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInAbPropsIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorBadRequest",value:b.value});var c=d("WASmaxInAbPropsIQErrorFeatureNotImplementedMixin").parseIQErrorFeatureNotImplementedMixin(a);return c.success?d("WAResultOrError").makeResult({name:"IQErrorFeatureNotImplemented",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorBadRequest","IQErrorFeatureNotImplemented"],[b,c])}g.parseIQErrorBadRequestOrFeatureNotImplementedMixinGroup=a}),98);
__d("WASmaxInAbPropsIQErrorResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","error");return!c.success?c:d("WAResultOrError").makeResult({type:c.value})}g.parseIQErrorResponseMixin=a}),98);
__d("WASmaxInAbPropsGetExperimentConfigResponseErrorNoRetry",["WAResultOrError","WASmaxInAbPropsIQErrorBadRequestOrFeatureNotImplementedMixinGroup","WASmaxInAbPropsIQErrorResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInAbPropsIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInAbPropsIQErrorBadRequestOrFeatureNotImplementedMixinGroup").parseIQErrorBadRequestOrFeatureNotImplementedMixinGroup(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorIQErrorBadRequestOrFeatureNotImplementedMixinGroup:b.value}))}g.parseGetExperimentConfigResponseErrorNoRetry=a}),98);
__d("WASmaxInAbPropsIQErrorInternalServerErrorMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","internal-server-error");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",500);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorInternalServerErrorMixin=a}),98);
__d("WASmaxInAbPropsGetExperimentConfigResponseErrorRetry",["WAResultOrError","WASmaxInAbPropsIQErrorInternalServerErrorMixin","WASmaxInAbPropsIQErrorResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;c=d("WASmaxInAbPropsIQErrorInternalServerErrorMixin").parseIQErrorInternalServerErrorMixin(c.value);if(!c.success)return c;a=d("WASmaxInAbPropsIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({errorIQErrorInternalServerErrorMixin:c.value},a.value))}g.parseGetExperimentConfigResponseErrorRetry=a}),98);
__d("WASmaxInAbPropsExperimentConfigMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"prop");if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"config_code",1,void 0);if(!b.success)return b;var c=d("WASmaxParseUtils").attrString(a,"config_value");if(!c.success)return c;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,a,"config_expo_key",0,void 0);return!a.success?a:d("WAResultOrError").makeResult({configCode:b.value,configValue:c.value,configExpoKey:a.value})}g.parseExperimentConfigMixin=a}),98);
__d("WASmaxInAbPropsSamplingConfigMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"prop");if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"event_code",1,void 0);if(!b.success)return b;a=d("WASmaxParseUtils").attrIntRange(a,"sampling_weight",-1e4,1e4);return!a.success?a:d("WAResultOrError").makeResult({eventCode:b.value,samplingWeight:a.value})}g.parseSamplingConfigMixin=a}),98);
__d("WASmaxInAbPropsExperimentOrSamplingConfigMixinGroup",["WAResultOrError","WASmaxInAbPropsExperimentConfigMixin","WASmaxInAbPropsSamplingConfigMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInAbPropsExperimentConfigMixin").parseExperimentConfigMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"ExperimentConfig",value:b.value});var c=d("WASmaxInAbPropsSamplingConfigMixin").parseSamplingConfigMixin(a);return c.success?d("WAResultOrError").makeResult({name:"SamplingConfig",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["ExperimentConfig","SamplingConfig"],[b,c])}g.parseExperimentOrSamplingConfigMixinGroup=a}),98);
__d("WASmaxInAbPropsIQResultResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","result");return!c.success?c:d("WAResultOrError").makeResult({type:c.value})}g.parseIQResultResponseMixin=a}),98);
__d("WASmaxInAbPropsGetExperimentConfigResponseSuccess",["WAResultOrError","WASmaxInAbPropsExperimentOrSamplingConfigMixinGroup","WASmaxInAbPropsIQResultResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"prop");if(!b.success)return b;b=d("WASmaxInAbPropsExperimentOrSamplingConfigMixinGroup").parseExperimentOrSamplingConfigMixinGroup(a);return!b.success?b:d("WAResultOrError").makeResult({experimentOrSamplingConfigMixinGroup:b.value})}function i(a){var b=d("WASmaxParseUtils").assertTag(a,"erid");if(!b.success)return b;b=d("WASmaxParseUtils").contentBytesRange(a,1,100);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"props");if(!c.success)return c;var e=d("WASmaxParseUtils").optionalChildWithTag(a,"erid",i);if(!e.success)return e;var f=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,c.value,"protocol","1");if(!f.success)return f;var g=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,c.value,"ab_key");if(!g.success)return g;var j=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,c.value,"hash");if(!j.success)return j;var k=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,c.value,"refresh",0,void 0);if(!k.success)return k;var l=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,c.value,"refresh_id",0,void 0);if(!l.success)return l;a=d("WASmaxInAbPropsIQResultResponseMixin").parseIQResultResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxParseUtils").mapChildrenWithTag(c.value,"prop",0,Infinity,h);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({propsProtocol:f.value,propsAbKey:g.value,propsHash:j.value,propsRefresh:k.value,propsRefreshId:l.value},a.value,{erid:e.value,propsProp:b.value}))}g.parseGetExperimentConfigResponseSuccessPropsProp=h;g.parseGetExperimentConfigResponseSuccessErid=i;g.parseGetExperimentConfigResponseSuccess=a}),98);
__d("WASmaxOutAbPropsBaseIQGetRequestMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("iq",{id:d("WAWap").generateId(),type:"get"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBaseIQGetRequestMixin=a}),98);
__d("WASmaxOutAbPropsGetExperimentConfigRequest",["WASmaxAttrs","WASmaxJsx","WASmaxOutAbPropsBaseIQGetRequestMixin","WAWap"],(function(a,b,c,d,e,f,g){function a(a){a=a.propsHash;a=d("WASmaxOutAbPropsBaseIQGetRequestMixin").mergeBaseIQGetRequestMixin(d("WASmaxJsx").smax("iq",{xmlns:"abt",to:d("WAWap").S_WHATSAPP_NET},d("WASmaxJsx").smax("props",{protocol:"1",hash:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,a)})));return a}g.makeGetExperimentConfigRequest=a}),98);
__d("WASmaxAbPropsGetExperimentConfigRPC",["WAComms","WASmaxInAbPropsGetExperimentConfigResponseErrorNoRetry","WASmaxInAbPropsGetExperimentConfigResponseErrorRetry","WASmaxInAbPropsGetExperimentConfigResponseSuccess","WASmaxOutAbPropsGetExperimentConfigRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,c){var e,f,g,h,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:e=d("WASmaxOutAbPropsGetExperimentConfigRequest").makeGetExperimentConfigRequest(a);j.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(e,c));case 3:f=j.sent;g=d("WASmaxInAbPropsGetExperimentConfigResponseSuccess").parseGetExperimentConfigResponseSuccess(f,e);if(!g.success){j.next=7;break}return j.abrupt("return",{name:"GetExperimentConfigResponseSuccess",value:g.value});case 7:h=d("WASmaxInAbPropsGetExperimentConfigResponseErrorNoRetry").parseGetExperimentConfigResponseErrorNoRetry(f,e);if(!h.success){j.next=10;break}return j.abrupt("return",{name:"GetExperimentConfigResponseErrorNoRetry",value:h.value});case 10:i=d("WASmaxInAbPropsGetExperimentConfigResponseErrorRetry").parseGetExperimentConfigResponseErrorRetry(f,e);if(!i.success){j.next=13;break}return j.abrupt("return",{name:"GetExperimentConfigResponseErrorRetry",value:i.value});case 13:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("GetExperimentConfig",{Success:g,ErrorNoRetry:h,ErrorRetry:i}));case 14:case"end":return j.stop()}},null,this)}g.sendGetExperimentConfigRPC=a}),98);
__d("WAGetAbPropsProtocol",["WALogger","WAResultOrError","WASmaxAbPropsGetExperimentConfigRPC","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["getAbPropsProtocol failed ",""]);h=function(){return a};return a}function a(a){var c,e,f,g,j,k,l;return b("regeneratorRuntime").async(function(m){while(1)switch(m.prev=m.next){case 0:m.next=2;return b("regeneratorRuntime").awrap(d("WASmaxAbPropsGetExperimentConfigRPC").sendGetExperimentConfigRPC({propsHash:a}));case 2:c=m.sent;if(!(c.name==="GetExperimentConfigResponseSuccess")){m.next=6;break}e=c.value,f=e.propsAbKey,g=e.propsHash,j=e.propsRefresh,k=e.propsRefreshId,l=e.propsProp;return m.abrupt("return",d("WAResultOrError").makeResult({abKey:f,hash:g,refresh:j,refreshId:k,props:i(l)}));case 6:d("WALogger").WARN(h(),c.value);return m.abrupt("return",d("WAResultOrError").makeError());case 8:case"end":return m.stop()}},null,this)}function i(a){var b=[];a.forEach(function(a){a=a.experimentOrSamplingConfigMixinGroup;if(a.name==="ExperimentConfig"){b.push({configCode:a.value.configCode,configValue:a.value.configValue,configExpoKey:(a=a.value.configExpoKey)==null?void 0:a.toString()})}});return b}g.getAbPropsProtocol=a}),98);
__d("WAWebABPropsUpdateFromStorage",["WALogger","WAWebABPropsCache","WAWebABPropsConfigs","WAWebApiAbPropConfig","WAWebUserPrefsGeneral","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[ABProps] Failed to update ABProps configs cache from storage: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[ABProps] ABProp (code: ",") exists in storage but no longer available for this client version"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[ABProps][dev] Web Beta joined, using NON-DEBUG default AB prop values (to simulate intern env)"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[ABProps][intern] Web Beta joined, using DEBUG default AB prop values"]);k=function(){return a};return a}function a(){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{var a=!1,b=a;if(!c("gkx")("26258")){var e=(yield d("WAWebUserPrefsGeneral").getWhatsAppWebExternalBetaJoinedIdb());c("gkx")("26259")&&e?(d("WALogger").LOG(k()),b=!0):a&&e&&(d("WALogger").LOG(j()),b=!1)}a=(yield d("WAWebApiAbPropConfig").getABPropConfigs());e=a.map(function(a){var e=d("WAWebABPropsCache").getABPropConfigNameFromCode(Number(a.configCode));if(e==null)d("WALogger").WARN(i(),a.configCode);else{e=d("WAWebABPropsConfigs").ABPropConfigs[e];var f=e[0],g=e[1],h=e[2];e=e[3];e=b?e:h;h=d("WAWebApiAbPropConfig").parseConfigValue(a.configValue,g,e);var j;!c("gkx")("26258")&&a.overriddenConfigValue!=null&&(j=d("WAWebApiAbPropConfig").parseConfigValue(a.overriddenConfigValue,g,e));return{configCode:f,configValue:h,configExpoKey:a.configExpoKey,hasAccessed:a.hasAccessed,overriddenConfigValue:j}}}).filter(function(a){return!!a});d("WAWebABPropsCache").bulkCreateOrReplaceABPropConfigs(e)}catch(a){d("WALogger").ERROR(h(),a).verbose().sendLogs("[ABProps] Failed to update ABProps configs cache from storage: "+a)}});return l.apply(this,arguments)}g.updateABPropsFromStorage=a}),98);
__d("WAWebAbPropsParsingJob",["WAWebABPropsConfigs"],(function(a,b,c,d,e,f,g){function a(a){var b=new Map();a.forEach(function(a){var c=a.configCode,d=a.configValue;a=a.configExpoKey;b.set(c,{configValue:d,configExpoKey:a})});var c=new Map();Object.keys(d("WAWebABPropsConfigs").ABPropConfigs).map(function(a){a=d("WAWebABPropsConfigs").ABPropConfigs[a][0];var e=b.get(a),f=e==null?void 0:e.configValue;e=e==null?void 0:e.configExpoKey;c.set(a,{configValue:f,configExpoKey:e==null?null:e.toString()})});return c}g.parseABProps=a}),98);
__d("WAWebSyncOnABProps",["WALogger","WAWebABProps","WAWebABPropsWamGlobals","WAWebProtobufsE2E.pb","WAWebSendNonMessageDataRequest","WAWebUserPrefsAppStateSync","WAWebUserPrefsTypes","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Recent Stickers: request peer message for recent sticker bootstrap."]);h=function(){return a};return a}function a(a){a!==d("WAWebABProps").getABPropConfigValue("service_improvement_opt_out_flag")&&d("WAWebABPropsWamGlobals").setAbPropDependingGlobalWamAttributes()}function c(){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(d("WAWebABProps").getABPropConfigValue("recent_sticker_rollout_phase")<3)return;var a=(yield d("WAWebUserPrefsAppStateSync").getNonCriticalDataSyncStatus());(a==null?void 0:a[d("WAWebUserPrefsTypes").NonCriticalDataSyncStatusType.RECENT_STICKER_INITIALIZED])===d("WAWebUserPrefsTypes").RecentStickerInitializedStatusType.NEED_REQUEST_BOOTSTRAP&&(d("WALogger").LOG(h()),yield d("WAWebSendNonMessageDataRequest").sendPeerDataOperationRequest(d("WAWebProtobufsE2E.pb").Message$PeerDataOperationRequestType.SEND_RECENT_STICKER_BOOTSTRAP,{}))});return i.apply(this,arguments)}g.handleServiceImprovementOptOutFlagABPropConfigValueChange=a;g.ensureNonCriticalDataSyncIsInitialized=c}),98);
__d("WAWebAbPropsSyncJob",["WAGetAbPropsProtocol","WALogger","WAPromiseDelays","WAWebABProps","WAWebABPropsGlobals","WAWebABPropsLocalStorage","WAWebABPropsUpdateFromStorage","WAWebAbPropsParsingJob","WAWebApiAbPropConfig","WAWebCmd","WAWebSyncOnABProps","WAWebUserPrefsCookie","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["failed to sync ABProps"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["update ABProps config table failed"]);i=function(){return a};return a}d("WAWebCmd").Cmd.on("on_ab_props_update",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.service_improvement_opt_out_flag;yield d("WAWebSyncOnABProps").ensureNonCriticalDataSyncIsInitialized();d("WAWebSyncOnABProps").handleServiceImprovementOptOutFlagABPropConfigValueChange(a);d("WAWebUserPrefsCookie").updateAppBuildCookieIfRequired()});return function(b){return a.apply(this,arguments)}}());function j(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b;a===void 0&&(a=!0);var c;a&&(c=d("WAWebABPropsLocalStorage").getHash());a=(yield d("WAGetAbPropsProtocol").getAbPropsProtocol(c));if(!a.success)return!1;a=a.value;var e=a.abKey,f=a.hash,g=a.refresh,h=a.refreshId;a=a.props;var j=Date.now();d("WAWebABPropsGlobals").updateGlobalABKey((b=e)!=null?b:"");d("WAWebABPropsLocalStorage").updateAttributesLocalStorage(e,c,g,j);h!=null&&d("WAWebABPropsLocalStorage").setRefreshId(h);if(f==null)return!1;try{yield d("WAWebApiAbPropConfig").updateABPropConfigs(d("WAWebAbPropsParsingJob").parseABProps(a));return!0}catch(a){d("WALogger").ERROR(i()).verbose().devConsole(a).sendLogs("update ABProps config table failed when syncing ABProps")}return!1});return k.apply(this,arguments)}function a(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a===void 0&&(a=!0);var b=d("WAWebABPropsLocalStorage").isABPropsAfterFirstSync(),c=3;while(c-->0)try{var e={service_improvement_opt_out_flag:d("WAWebABProps").getABPropConfigValue("service_improvement_opt_out_flag")},f=(yield j(b&&a));if(f){yield d("WAWebABPropsUpdateFromStorage").updateABPropsFromStorage();d("WAWebCmd").Cmd.onAbPropsUpdate(e);return}}catch(a){c===0&&d("WALogger").ERROR(h()).verbose().devConsole(a).sendLogs("failed to sync ABProps"),yield d("WAPromiseDelays").delayMs(10*1e3*Math.random())}});return l.apply(this,arguments)}g.syncABProps=j;g.syncABPropsTask=a}),98);
__d("WAWebUploadPrekeysForRegTask",["Promise","WAComms","WADeprecatedSendIq","WALogger","WAWap","WAWebConstantsDeprecated","WAWebServerPropsModel","WAWebSignalKeyApi","WAWebSignalStoreApi","WAWebSignalUtilsApi","WAWebUploadPreKeysJob","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["_uploadPreKeys: disconnected, unclear if on server: "," (count: ",", size: ","b)"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["_uploadPreKeys: unrecognized error "," (count: ",", size: ","b)"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["_uploadPreKeys: uploaded invalid keys (count: ",", size: ","b)"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["_uploadPreKeys: server requested backoff "," (count: ",", size: ","b)"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["_uploadPreKeys: "," keys uploaded, raw stanza size: ","b"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["PrekeyUploadForRegistrationTask: start key upload"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["PrekeyUploadForRegistrationTask: succesfully generated "," keys"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["PrekeyUploadForRegistrationTask: start key generation"]);p=function(){return a};return a}var q=function(){function a(){}var e=a.prototype;e.startKeyGenerationStage=function(){this.$1||(this.$1=this.$3());return this.$1};e.startKeyUploadStage=function(){this.$2||(this.$2=this.$4());return this.$2};e.$3=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){d("WALogger").LOG(p());var a=d("WAWebServerPropsModel").ServerProps.maxKeys,e=(yield (h||(h=b("Promise"))).all([d("WAWebSignalStoreApi").waSignalStore.getRegistrationInfo(),d("WAWebSignalStoreApi").waSignalStore.getSignedPreKey()])),f=e[0];e=e[1];if(!f||!e)throw c("err")("No signal info is available");a=(yield d("WAWebSignalStoreApi").waSignalStore.getOrGenPreKeys(a,d("WAWebSignalKeyApi").generatePreKeyPair));d("WALogger").LOG(o(),a.length);return{regInfo:f,signedPreKey:e,prekeys:a}});function e(){return a.apply(this,arguments)}return e}();e.$4=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=this.$1||this.startKeyGenerationStage();a=(yield a);var b=a.regInfo,e=a.signedPreKey;a=a.prekeys;d("WALogger").LOG(n());var f=a.length;if(f===0)throw c("err")("No preKey is available");var g=a[a.length-1].keyId,h=b.registrationId;b=b.identityKeyPair;h=d("WAWap").wap("iq",{id:d("WAWap").generateId(),xmlns:"encrypt",type:"set",to:d("WAWap").S_WHATSAPP_NET},d("WAWap").wap("registration",null,d("WAWap").BIG_ENDIAN_CONTENT(h)),d("WAWap").wap("type",null,c("WAWebConstantsDeprecated").KEY_BUNDLE_TYPE),d("WAWap").wap("identity",null,b.pubKey),d("WAWap").wap("list",null,a.map(d("WAWebSignalUtilsApi").xmppPreKey)),d("WAWebSignalUtilsApi").xmppSignedPreKey(e));try{yield d("WAComms").waitForConnection();yield d("WAWebSignalStoreApi").waSignalStore.markKeyAsUploaded(g);b=(yield d("WADeprecatedSendIq").deprecatedSendIqWithoutRetry(h,d("WAWebUploadPreKeysJob").uploadPreKeyResParser));if(b.success){d("WAWebSignalStoreApi").waSignalStore.setServerHasPreKeys(!0);d("WALogger").LOG(m(),a.length,h.toString().length);return{success:!0}}e=b.errorCode;e>=500?d("WALogger").WARN(l(),e,f,h.toString().length):e===406?d("WALogger").WARN(k(),f,h.toString().length):d("WALogger").WARN(j(),e,f,h.toString().length);return{errorCode:b.errorCode,errorText:b.errorText}}catch(a){d("WALogger").WARN(i(),a,f,h.toString().length);return}});function e(){return a.apply(this,arguments)}return e}();return a}();function a(){return new q()}g["default"]=a}),98);
__d("WAWebRegisterPassiveTasks",["WALogger","WAWebABPropsLocalStorage","WAWebABPropsWamGlobals","WAWebAbPropsSyncJob","WAWebClearDanglingReceipts","WAWebOnlineDanglingReceipts","WAWebPassiveModeManager","WAWebSchemaDanglingReceipt","WAWebSignalStoreApi","WAWebUploadPrekeysForRegTask","WAWebUserPrefsGeneral","WAWebWamDeviceLinkReporter","WAWebWamEnumMdLinkDeviceCompanionStage","asyncToGeneratorRuntime","cr:3979"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["error while sending dangling receipts, ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[passive] sending dangling receipts complete"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[passive] start sending dangling receipts"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["error while sending online dangling receipts, ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[passive] sending online dangling receipts complete"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[passive] start sending online dangling receipts"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["error while sync ab props prekeys, ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["error while uploading prekeys, ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[passive] key upload complete"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["[passive] start key upload"]);q=function(){return a};return a}function a(){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WAWebSignalStoreApi").waSignalStore.getServerHasPreKeys());if(!a){yield d("WAWebWamDeviceLinkReporter").setDeviceLinkPairStage(d("WAWebWamEnumMdLinkDeviceCompanionStage").MD_LINK_DEVICE_COMPANION_STAGE.UPLOAD_PREKEYS);var e=c("WAWebUploadPrekeysForRegTask")();void e.startKeyGenerationStage();d("WAWebPassiveModeManager").PassiveTaskManager.registerPassiveTask(function(){d("WALogger").LOG(q());return e.startKeyUploadStage().then(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){d("WALogger").LOG(p()),yield d("WAWebWamDeviceLinkReporter").setDeviceLinkPairStage(d("WAWebWamEnumMdLinkDeviceCompanionStage").MD_LINK_DEVICE_COMPANION_STAGE.COMPLETE),yield d("WAWebWamDeviceLinkReporter").commitDeviceLinkEvent()}))["catch"](function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WALogger").ERROR(o(),a).verbose().devConsole(a).sendLogs("error while uploading prekeys"),yield d("WAWebWamDeviceLinkReporter").commitDeviceLinkEvent(-1)});return function(b){return a.apply(this,arguments)}}())})}(!d("WAWebABPropsLocalStorage").isABPropsAfterFirstSync()||(yield d("WAWebUserPrefsGeneral").getWhatsAppWebExternalBetaDirtyBitIdb()))&&(yield d("WAWebPassiveModeManager").PassiveTaskManager.registerPassiveTask(function(){return d("WAWebAbPropsSyncJob").syncABPropsTask()["catch"](function(a){d("WALogger").WARN(n(),a).verbose()})}),void d("WAWebUserPrefsGeneral").setWhatsAppWebExternalBetaDirtyBitIdb(!1),d("WAWebABPropsWamGlobals").setAbPropDependingGlobalWamAttributes())});return r.apply(this,arguments)}function e(){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(d("WAWebOnlineDanglingReceipts").hasOnlineDanglingReceipts()){d("WAWebPassiveModeManager").PassiveTaskManager.registerPassiveTask(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{d("WALogger").LOG(m()),yield d("WAWebOnlineDanglingReceipts").sendAndClearOnlineDanglingReceipts(),d("WALogger").LOG(l())}catch(a){d("WALogger").ERROR(k(),a).verbose().devConsole(a).sendLogs("send-online-dangling-receipts-failed")}}));var a=(yield d("WAWebSchemaDanglingReceipt").getTable().count());a>0&&d("WAWebPassiveModeManager").PassiveTaskManager.registerPassiveTask(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{d("WALogger").LOG(j()),yield d("WAWebClearDanglingReceipts").sendAndClearDanglingReceipts(),d("WALogger").LOG(i())}catch(a){d("WALogger").ERROR(h(),a).verbose().devConsole(a).sendLogs("send-and-clear-dangling-receipts-failed")}}))}});return s.apply(this,arguments)}g.registerPassiveTaskForStartUp=a;g.registerPassiveTasksForConnect=e}),98);
__d("WAWebAdvStoredTimestampExpiredWamEvent",["WAWebWamCodegenUtils"],(function(a,b,c,d,e,f,g){a=d("WAWebWamCodegenUtils").defineEvents({AdvStoredTimestampExpired:[3036,{advExpireTimeInHours:[1,d("WAWebWamCodegenUtils").TYPES.INTEGER]},[1,1,1],"regular"]});g.AdvStoredTimestampExpiredWamEvent=a}),98);
__d("WAWebAdvDeviceInfoCheckJob",["Promise","WAJids","WALogger","WATimeUtils","WAWebABProps","WAWebAdvStoredTimestampExpiredWamEvent","WAWebApiDeviceList","WAWebApiPendingDeviceSync","WAWebApiTasksScheduledTime","WAWebIdentityUpdateDeviceTableApi","WAWebLastADVCheckTimeApi","WAWebLogoutReasonConstants","WAWebSocketLogoutJob","WAWebUserPrefsMeUser","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["error running the adv device check job"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["skip first run"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["scheduled in "," seconds"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Logging out due to own expired device"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["adv_device_info_check: sending usync query"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["adv: error sending usync query: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["adv: removing companions: ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["adv: running device info check with t=",""]);p=function(){return a};return a}var q=25*d("WATimeUtils").HOUR_SECONDS,r=function(){function a(a){this.advToSystemBridge=a}var c=a.prototype;c.run=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WALogger").DEV(p(),a).tags("automated-device-verification");var b=this.advToSystemBridge,c=(yield b.getUsersForExpiration(a)),e=c.usersExpired;c=c.usersCloseToExpiration;d("WALogger").DEV(o(),Array.from(e.entries()).map(function(a){var b=a[0];a=a[1];return"\n\t"+b.toString()+" (t="+a.timestamp+")"})).tags("automated-device-verification");b.removeCompanions(e);b.sendADVStoredTimestampExpiredEvents(e,a);a=Array.from(e.keys()).concat(Array.from(c.keys())).filter(function(a){return!b.canRemoveUserDevices(a)});b.sendOrQueueDeviceUsyncQuery(a)["catch"](function(a){return d("WALogger").DEV(n(),a).tags("automated-device-verification")});return b.recordLocalTimestamp()});function c(b){return a.apply(this,arguments)}return c}();return a}(),s=function(){function a(){}var c=a.prototype;c.getNumDaysKeyIndexListExpiration=function(){return d("WAWebABProps").getABPropConfigValue("num_days_key_index_list_expiration")};c.getNumDaysBeforeDeviceExpiryCheck=function(){return d("WAWebABProps").getABPropConfigValue("num_days_before_device_expiry_check")};c.getUsersForExpiration=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=this,c=(yield d("WAWebApiDeviceList").getAllDeviceLists()),e=(yield d("WAWebLastADVCheckTimeApi").getLastADVDeviceInfoCheckTime()),f=this.getNumDaysKeyIndexListExpiration()*d("WATimeUtils").DAY_SECONDS,g=new Map(),h=new Map();c.forEach(function(c){if(c.deleted||z(c))return;else A(a,f,c,e)?g.set(d("WAWebWidFactory").createUserWid(c.id),c):B(a,f-b.getNumDaysBeforeDeviceExpiryCheck()*d("WATimeUtils").DAY_SECONDS,c)&&h.set(d("WAWebWidFactory").createUserWid(c.id),c)});return{usersExpired:g,usersCloseToExpiration:h}});function c(b){return a.apply(this,arguments)}return c}();c.sendADVStoredTimestampExpiredEvents=function(a,b){var c=this;a.forEach(function(a){a=b-(a.timestamp+c.getNumDaysKeyIndexListExpiration()*d("WATimeUtils").DAY_SECONDS);if(a<0)return;a=Math.round(a/d("WATimeUtils").HOUR_SECONDS);new(d("WAWebAdvStoredTimestampExpiredWamEvent").AdvStoredTimestampExpiredWamEvent)({advExpireTimeInHours:a}).commit()})};c.sendOrQueueDeviceUsyncQuery=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WALogger").DEV(m());yield d("WAWebApiPendingDeviceSync").addUserToPendingDeviceSync(a.map(function(a){return a.toString()}));return d("WAWebApiPendingDeviceSync").doPendingDeviceSync()});function c(b){return a.apply(this,arguments)}return c}();c.canRemoveUserDevices=function(a){return!1};c.removeCompanions=function(a){var c=Array.from(a.entries());c=c.some(function(a){var b=a[0];a[1];b.user===d("WAWebUserPrefsMeUser").getMeUser().user});if(c){d("WALogger").LOG(l());void d("WAWebSocketLogoutJob").socketLogout(d("WAWebLogoutReasonConstants").LogoutReason.InvalidAdvStatus);return(h||(h=b("Promise"))).resolve()}return(h||(h=b("Promise"))).all(Array.from(a.entries()).map(function(a){var b=a[0];a=a[1];return d("WAWebIdentityUpdateDeviceTableApi").clearDeviceRecord(b,a.devices)}))};c.recordLocalTimestamp=function(){return(h||(h=b("Promise"))).resolve()};return a}(),t="advDeviceInfoCheck",u;function v(){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){u!=null&&(self.clearTimeout(u),u=null);var a=d("WATimeUtils").unixTimeWithoutClockSkewCorrection(),c=(yield d("WAWebLastADVCheckTimeApi").getLastADVDeviceInfoCheckTime()),e=0,f=function(){return(h||(h=b("Promise"))).resolve()};c!=null?(e=Math.max(d("WATimeUtils").DAY_SECONDS-(a-c),0),f=function(){return y()},d("WALogger").DEV(k(),e).tags("automated-device-verification")):d("WALogger").DEV(j()).tags("automated-device-verification");u=self.setTimeout(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{yield f()}catch(a){d("WALogger").ERROR(i()).tags("automated-device-verification")}u=null;var a=d("WATimeUtils").unixTimeWithoutClockSkewCorrection();d("WAWebLastADVCheckTimeApi").setLastADVDeviceInfoCheckTime(a);d("WAWebApiTasksScheduledTime").updateTaskScheduledTime(t,d("WATimeUtils").castToUnixTime(a));v()}),e*1e3)});return w.apply(this,arguments)}var x;function y(){x==null&&(x=new r(new s()));return x.run(d("WATimeUtils").unixTimeWithoutClockSkewCorrection())}function z(a){return a.devices.length===1&&a.devices[0].id===d("WAJids").DEFAULT_DEVICE_ID}function A(a,b,c,d){if(a-c.timestamp>=b)return!0;return c.expectedTsUpdateTs!=null?a-c.expectedTsUpdateTs>=q&&c.expectedTsLastDeviceJobTs!==d:!1}function B(a,b,c){if(a-c.timestamp>=b)return!0;return c.expectedTs!=null?c.expectedTs>c.timestamp:!1}g.AdvToSystemBridgeImpl=s;g.scheduleAdvDeviceInfoCheck=v;g.runAdvDeviceInfoCheck=y}),98);
__d("WAWebBackgroundSyncAction",["WALogger","WATimeUtils","WAWebABProps","WAWebPushNotificationsGatingUtils","WAWebPwaDocumentMetadataUtils","WAWebSetWorkerLocalStorage","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["pwa-background-sync-registration-update-failure: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["pwa background sync is already unregistered"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["pwa background sync unregistered successfully"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["pwa background sync failed to unregister"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Start pwa background sync unregistration"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["pwa background sync is already registered"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["pwa background sync failed to register"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["pwa background sync registered successfully"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["Start pwa background sync registration"]);p=function(){return a};return a}function a(){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{var a,b,c;if(!d("WAWebPushNotificationsGatingUtils").canSupportPeriodicBackgroundSync()||!d("WAWebPwaDocumentMetadataUtils").isCurrentWebSessionInsidePwa())return;a=(yield (a=window.navigator.serviceWorker)==null?void 0:a.ready);if(!("periodicSync"in((b=a)!=null?b:[])))return;b=a==null?void 0:a.periodicSync;if(!b)return;a=(yield b.getTags==null?void 0:b.getTags());if(!a)return;c=(yield (c=window.navigator.permissions)==null?void 0:c.query==null?void 0:c.query({name:"background-sync"}));if((c==null?void 0:c.state)!=="granted")return;c=d("WAWebABProps").getABPropConfigValue("web_pwa_background_sync");if(c)if(!a.includes("background-sync")){d("WALogger").LOG(p());yield d("WAWebSetWorkerLocalStorage").setWorkerLocalStorage();yield b.register==null?void 0:b.register("background-sync",{minInterval:d("WAWebABProps").getABPropConfigValue("web_pwa_background_sync_min_interval_hours")*d("WATimeUtils").HOUR_MILLISECONDS});c=(yield b.getTags==null?void 0:b.getTags());(c==null?void 0:c.includes==null?void 0:c.includes("background-sync"))?d("WALogger").LOG(o()):d("WALogger").LOG(n())}else d("WALogger").LOG(m());else if(a.includes("background-sync")){d("WALogger").LOG(l());yield b.unregister==null?void 0:b.unregister("background-sync");c=(yield b.getTags==null?void 0:b.getTags());(c==null?void 0:c.includes==null?void 0:c.includes("background-sync"))?d("WALogger").LOG(k()):d("WALogger").LOG(j())}else d("WALogger").LOG(i())}catch(a){d("WALogger").ERROR(h(),a.stack).devConsole(a).sendLogs("pwa-background-sync-registration-update-failure")}});return q.apply(this,arguments)}g.updatePeriodicBackgroundSyncRegistration=a}),98);
__d("WAWebBootstrapPremiumMessages",["Promise","WAWebMiscGatingUtils","WAWebMsgCollection","WAWebPremiumMessageCollection","WAWebPremiumMessageSchema","asyncToGeneratorRuntime","lodash"],(function(a,b,c,d,e,f,g){var h,i=250;function a(){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(!d("WAWebMiscGatingUtils").isRambutanEnabled())return(h||(h=b("Promise"))).resolve();var a=(yield d("WAWebPremiumMessageSchema").getPremiumMessageTable().all());d("WAWebPremiumMessageCollection").PremiumMessageCollection.initializeFromCache(a)});return j.apply(this,arguments)}function e(){if(!d("WAWebMiscGatingUtils").isRambutanEnabled())return;d("WAWebMsgCollection").MsgCollection.listenTo(d("WAWebMsgCollection").MsgCollection,"add",c("lodash").debounce(k,i,{leading:!0,trailing:!0}));d("WAWebPremiumMessageCollection").PremiumMessageCollection.listenTo(d("WAWebPremiumMessageCollection").PremiumMessageCollection,"add",function(a){return a.hydrateMessages()})}function k(){d("WAWebPremiumMessageCollection").PremiumMessageCollection.getModelsArray().forEach(function(a){a.hydrateMessages()})}g.restorePremiumMessages=a;g.bindPremiumMessageListeners=e}),98);
__d("WAWebCTWASuggestionInitFromStorage",["Promise","WALogger","WATimeUtils","WAWebBizGatingUtils","WAWebSchemaCTWASuggestion"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["restoreCTWASuggestions: could not remove expired suggestions"]);i=function(){return a};return a}function a(a){if(!d("WAWebBizGatingUtils").adsActionBannersEnabledOnStartup())return(h||(h=b("Promise"))).resolve();var c=d("WAWebSchemaCTWASuggestion").getCTWASuggestionTable();return c.all().then(function(b){var e=[],f=[];b.forEach(function(a){d("WATimeUtils").isInFuture(a.expiresAt)?e.push(a):f.push(a.id)});a("loadedCTWASuggestions",{suggestions:e});if(f.length>0)return c.bulkRemove(f)["catch"](function(){d("WALogger").ERROR(i()).devConsole(f)})})}g.restoreCTWASuggestions=a}),98);
__d("WAWebCommsProcessAck",["WALogger","WAWebActiveMessageRanges","WAWebDBMessageUtils","WAWebMsgCollection","WAWebMsgKey","WAWebMsgType","WAWebSchemaMessage","WAWebUserPrefsMeUser","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["processAckForOutgoingMessage: failed to update in storage"]);h=function(){return a};return a}function a(a){var b=a.attrs,c=b.id,e=b.from;b=b.t;if(a.attrs["class"]==="message"){e=d("WAWebWidFactory").createWid(String(e));a=i(a);l(String(c),e,parseInt(b,10),a);k(a,String(c),e)}}function i(a){var b;a=a.content;if(!Array.isArray(a)||((b=a[0])==null?void 0:b.tag)!=="rcat")return null;a=(b=a[0])==null?void 0:b.content;return Array.isArray(a)?null:a}function j(a,b){return b.isGroup()?new(c("WAWebMsgKey"))({fromMe:!0,remote:b,id:a,participant:d("WAWebUserPrefsMeUser").getMeUser()}):new(c("WAWebMsgKey"))({fromMe:!0,remote:b,id:a})}function k(a,b,c){if(a==null)return;b=d("WAWebMsgCollection").MsgCollection.get(j(b,c));b!=null&&(b.rcat=a)}function l(a,b,c,d){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){a=j(a,b);var f=String(a);try{var g=(yield d("WAWebSchemaMessage").getMessageTable().get(f));if((g==null?void 0:g.type)===d("WAWebMsgType").MSG_TYPE.REACTION)return;g=d("WAWebDBMessageUtils").MessagePropertyType.cast(g==null?void 0:g.messageRangeIndex.split("_")[1]);d("WAWebSchemaMessage").getMessageTable().merge(f,{messageRangeIndex:d("WAWebDBMessageUtils").craftMessageRangeIndex(b.toString(),!1,g===d("WAWebDBMessageUtils").MessagePropertyType.SystemMessage,c),rcat:e})}catch(a){d("WALogger").ERROR(h()).verbose().devConsole(a).sendLogs("message processAckForOutgoingMessage failed");throw a}d("WAWebActiveMessageRanges").checkAndRemoveActiveMessageRanges(a,c)});return m.apply(this,arguments)}g["default"]=a}),98);
__d("WAWebMdDebugMdStanza.react",["invariant","WAWebConfirmPopup.react","WAWebModal.react","WAWebModalManager","WAWebUserPrefsMultiDeviceDebug","gkx","react"],(function(a,b,c,d,e,f,g,h){var i,j,k=j||c("react"),l=(i||(i=d("react"))).useState;c("gkx")("26258")&&h(0,56260);function a(a){var b=a.originalIqId,e=a.rawStanza,f=a.onExit;b=b!=null?'<iq from="s.whatsapp.net" type="result" id="'+(b||"")+'">   </iq> ':"";var g=c("WAWebUserPrefsMultiDeviceDebug").getDebugStanzaFilter()||"";b=l(b);var h=b[0],i=b[1];b=l(g);var j=b[0],m=b[1];g=function(a){a=a.target;i(a.value)};var n=function(){if(h==null||h==="")return;window.Debug.mockIncomingStanza(h)};b=function(){n(),e==null&&j!=null&&c("WAWebUserPrefsMultiDeviceDebug").setDebugStanzaFilter(j),d("WAWebModalManager").ModalManager.close(),f==null?void 0:f()};var o=function(a){a=a.target;m((a=a.value)==null?void 0:a.trim())};return k.jsx(d("WAWebConfirmPopup.react").ConfirmPopup,{type:d("WAWebModal.react").ModalTheme.Flex,okText:"OK",onOK:b,onCancel:function(){a.onExit==null?void 0:a.onExit(),d("WAWebModalManager").ModalManager.close()},children:k.jsxs("div",{style:{padding:"20px"},children:[k.jsxs("h4",{children:[" ",e?"Sent stanza: ":'List of xmlns to filter [input as CSV, e.g. "privacy, usync"]:'," "]}),k.jsx("textarea",{name:"filter",cols:"80",readOnly:!!e,rows:e?"15":"2",value:(b=e)!=null?b:j,onChange:o}),k.jsxs("h4",{children:[" ",e?"Mock reply: ":"Mock incoming Stanza:"," "]}),k.jsx("textarea",{name:"stanza",cols:"80",rows:"15",value:h,onChange:g})]})})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("WAFrameSocket",["WABinary","WAErrors","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["FrameSocket: queueing partial frame of "," bytes"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Buffer to send: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["FrameSocket closed"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["FrameSocket error"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["FrameSocket closed, waiting for pending processing"]);l=function(){return a};return a}var m=function(b){babelHelpers.inheritsLoose(a,b);function a(a){var c="SocketClosed";a=b.call(this,(a=a)!=null?a:c)||this;a.name=c;return a}return a}(babelHelpers.wrapNativeSuper(Error));a=function(){function a(a,b){var c=this;this.$3=new(d("WABinary").Binary)();this.closed=!1;this.$4=!1;this.onFrame=null;this.onClose=null;this.$5=function(a){c.$3.writeByteArray(a),c.convertBufferedToFrames()};this.$6=function(){if(c.$3.peek(n)){d("WALogger").LOG(l());c.$4=!0;return}c.$9()};this.$7=function(a){d("WALogger").DEV(k()).devConsole(a)};this.$2=b;this.$1=a;a.onData=this.$5;a.onClose=this.$6;a.onError=this.$7}var b=a.prototype;b.sendFrame=function(a){if(this.$4)return;this.throwIfClosed();var b=this.$2,c=a.byteLength,d=this.$1.dataToSend;b?(this.$2=null,d.ensureAdditionalCapacity(b.length+3+c),d.writeByteArray(b)):d.ensureAdditionalCapacity(3+c);this.$8(c);d.writeUint8(c>>16);d.writeUint16(c&65535);d.write(a);this.$1.requestSend()};b.$9=function(){if(this.closed)return;d("WALogger").LOG(j());this.$4=!1;this.closed=!0;var a=this.onClose;a&&a()};b.$8=function(a){if(a>=1<<24){d("WALogger").WARN(i(),a);throw new(d("WAErrors").BufferTooLargeError)("Buffer too large: "+a)}};b.convertBufferedToFrames=function(){var a=this.$3,b=this.onFrame;while(b&&a.peek(n)){var c=o(a);c=a.readByteArray(c);b(c);b=this.onFrame}this.$4&&!a.peek(n)&&this.$9();b&&a.size()&&d("WALogger").LOG(h(),a.size())};b.throwIfClosed=function(){if(this.closed)throw new m()};b.close=function(){this.$1.close()};return a}();function n(a){if(a.size()<3)return!1;var b=o(a);return b<=a.size()}function o(a){return a.readUint8()<<16|a.readUint16()}g.SocketClosed=m;g.FrameSocket=a}),98);
__d("WANoiseSocket",["Promise","WACryptoDependencies","WALogger","WAPromiseQueue","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendFrame adding to queue with frame size: "," bytes"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["NoiseSocket socket closed while encrypting frame"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Sending encrypted frame to web socket"]);k=function(){return a};return a}a=(h||(h=b("Promise"))).reject("UNINITIALIZED HANDSHAKE");var l=new Uint8Array(0);a["catch"](function(){});c=function(){function a(a,b,c){var e=this;this.$4=[];this.$5=new(d("WAPromiseQueue").PromiseQueue)();this.$6=new(d("WAPromiseQueue").PromiseQueue)();this.$7=0;this.$8=0;this.$9=!1;this.$14=function(a){!e.$1.closed?(d("WALogger").DEV(k()).tags("WANoiseSocket"),e.$1.sendFrame(a)):d("WALogger").LOG(j())};this.$12=function(a){var b=e.$7++;e.$5.enqueueHandlers(o(e.$2,b,void 0,a),e.$15)};this.$13=function(){e.$9=!0,e.$5.wait().then(function(){e.$9=!1;var a=e.$11;a&&a()})};this.$15=function(a){e.$10?e.$10(a):e.$4.push(a)};this.$1=a;this.$3=b;this.$2=c;a.onFrame=this.$12;this.$1.onClose=this.$13;a.convertBufferedToFrames()}var c=a.prototype;c.sendFrameAsync=function(a){var c;return b("regeneratorRuntime").async(function(d){while(1)switch(d.prev=d.next){case 0:d.next=2;return b("regeneratorRuntime").awrap(this.sendFrame(a));case 2:c=d.sent;return d.abrupt("return",c);case 4:case"end":return d.stop()}},null,this)};c.sendFrame=function(a){if(this.$9)return(h||(h=b("Promise"))).resolve();this.$1.throwIfClosed();var c=this.$8++;d("WALogger").DEV(i(),a.length).tags("WANoiseSocket");return this.$6.enqueueHandlers(n(this.$3,c,void 0,a),this.$14)};c.setOnFrame=function(a){this.$10=a};c.setOnClose=function(a){this.$11=a};c.close=function(){this.$1.close()};return a}();function m(a){var b=new ArrayBuffer(12),c=new DataView(b);c.setUint32(8,a);return new Uint8Array(b)}function n(a,b,c,e){return d("WACryptoDependencies").getCrypto().subtle.encrypt({name:"AES-GCM",iv:m(b),additionalData:c?new Uint8Array(c):l},a,e)}function o(a,b,c,e){return d("WACryptoDependencies").getCrypto().subtle.decrypt({name:"AES-GCM",iv:m(b),additionalData:c?new Uint8Array(c):l},a,e)}g.NoiseSocket=c}),98);
__d("WANoiseHandshake",["Promise","WABinary","WACryptoDependencies","WACryptoHkdf","WACryptoSha256","WAErrors","WANoiseSocket","WAResolvable"],(function(a,b,c,d,e,f,g){"use strict";var h,i=(h||(h=b("Promise"))).reject("UNINITIALIZED HANDSHAKE"),j=new Uint8Array(0);i["catch"](function(){});a=function(){function a(a){var b=this;this.$2=i;this.$3=i;this.$4=i;this.$5=0;this.$1=a;this.$6=new(d("WAResolvable").Resolvable)();a.onClose=function(){b.$6.reject(new(d("WAErrors").Disconnected)("NoiseHandshake: SocketClosed"))};p(this.$6.promise)}var c=a.prototype;c.start=function(a,c){a=d("WABinary").Binary.build(a).readBuffer();a=a.byteLength===32?(h||(h=b("Promise"))).resolve(a):d("WACryptoSha256").sha256(a);this.$2=a;this.$3=a;this.$4=a.then(l);this.authenticate(c)};c.sendAndReceive=function(a){var c=this.$1,d=new(h||(h=b("Promise")))(function(b){c.onFrame=function(a){c.onFrame=null,b(a)},c.sendFrame(a)});return this.$7(d)};c.send=function(a){this.$1.sendFrame(a)};c.authenticate=function(a){this.$2=(h||(h=b("Promise"))).all([this.$2,a]).then(function(a){var b=a[0];a=a[1];b=d("WABinary").Binary.build(b,a).readByteArray();return d("WACryptoSha256").sha256(b)})};c.encrypt=function(a){var c=this.$5++;a=(h||(h=b("Promise"))).all([this.$4,this.$2,a]).then(function(a){var b=a[0],d=a[1];a=a[2];return m(b,c,d,a)});this.authenticate(a);return this.$7(a)};c.decrypt=function(a){var c=this.$5++,d=(h||(h=b("Promise"))).all([this.$4,this.$2]).then(function(b){var d=b[0];b=b[1];return n(d,c,b,a)});this.authenticate(a);return this.$7(d)};c.finish=function(){var a=this,c=this.$3.then(function(a){return o(a,new Uint8Array(0))}).then(function(a){var c=a[0];a=a[1];return(h||(h=b("Promise"))).all([l(c,["encrypt"]),l(a,["decrypt"])])}).then(function(b){var c=b[0];b=b[1];return new(d("WANoiseSocket").NoiseSocket)(a.$1,c,b)});return this.$7(c)};c.mixIntoKey=function(a){this.$5=0;a=(h||(h=b("Promise"))).all([this.$3,a]).then(function(a){var b=a[0];a=a[1];return o(b,new Uint8Array(a))});this.$3=a.then(function(a){return a[0]});this.$4=a.then(function(a){return l(a[1])});p(this.$3);p(this.$4)};c.$7=function(a){var c=this;return(h||(h=b("Promise"))).race([a,this.$6.promise]).then(function(a){return c.$6.resolveWasCalled()?c.$6.promise:a})};return a}();function k(a){var b=new ArrayBuffer(12),c=new DataView(b);c.setUint32(8,a);return new Uint8Array(b)}function l(a,b){b===void 0&&(b=["encrypt","decrypt"]);return d("WACryptoDependencies").getCrypto().subtle.importKey("raw",new Uint8Array(a),"AES-GCM",!1,b)}function m(a,b,c,e){return d("WACryptoDependencies").getCrypto().subtle.encrypt({name:"AES-GCM",iv:k(b),additionalData:c?new Uint8Array(c):j},a,e)}function n(a,b,c,e){return d("WACryptoDependencies").getCrypto().subtle.decrypt({name:"AES-GCM",iv:k(b),additionalData:c?new Uint8Array(c):j},a,e)}function o(a,b){return d("WACryptoHkdf").extractWithSaltAndExpand(b,new Uint8Array(a),"",64).then(function(a){return[a.slice(0,32),a.slice(32)]})}function p(a){a["catch"](function(){})}g.NoiseHandshake=a}),98);
__d("WACryptoCurve25519",["Promise","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Curve25519.generateSharedSecret pubkey:",""]);i=function(){return a};return a}a=function(){function a(a,c){this.signalDependencies=a,this.keyPair=c?(h||(h=b("Promise"))).resolve(c):this.signalDependencies.generateIdentityKeyPair()}var c=a.prototype;c.generatePublicKey=function(){return this.keyPair.then(function(a){return a.publicKey})};c.generateSharedSecret=function(a){var b=this;return this.keyPair.then(function(c){c=c.privateKey;d("WALogger").LOG(i(),a).devConsole(c);return b.signalDependencies.calculateAgreement(new Uint8Array(a),c)})};return a}();g.Curve25519=a}),98);
__d("WAOpenChatSocket",["Promise","WABinary","WACryptoCurve25519","WAErr","WAFrameSocket","WALogger","WANoiseHandshake","WAResultOrError","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["openChatSocket performing full handshake"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["openChatSocket performing resume handshake"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["openChatSocket preIntro ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["doFallbackHandshake continuing handshake with given server hello"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["resumeNoiseHandshake performing fallback handshake"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["resumeNoiseHandshake deriving secrets"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["resumeNoiseHandshake continuing resume handshake"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["resumeNoiseHandshake rcv hello"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["resumeNoiseHandshake send hello"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["fullNoiseHandshake rcv hello"]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["fullNoiseHandshake send hello"]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["doFullHandshakeCore client finish and deriving secrets"]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["doFullHandshakeCore parsing and verifying server certificate"]);u=function(){return a};return a}var v="Noise_XX_25519_AESGCM_SHA256\0\0\0\0",w="Noise_IK_25519_AESGCM_SHA256\0\0\0\0",x="Noise_XXfallback_25519_AESGCM_SHA256";function y(a,e,f,g,i){e=e||{};var j=e.ephemeral,k=e["static"];e=e.payload;if(j==null||k==null||e==null)return(h||(h=b("Promise"))).reject(c("WAErr")("doFullHandshakeCore server hello invalid proto"));a.authenticate(j);a.mixIntoKey(g.generateSharedSecret(j));k=a.decrypt(k);a.mixIntoKey(k.then(function(a){return g.generateSharedSecret(a)}));e=a.decrypt(e);return(h||(h=b("Promise"))).all([k,e]).then(function(a){var b=a[0];a=a[1];d("WALogger").LOG(u());return i.processCertificate({certificate:a,serverStatic:b})}).then(function(){var c=a.encrypt(i.staticKeyPair.generatePublicKey());a.mixIntoKey(i.staticKeyPair.generateSharedSecret(j));var d=a.encrypt((h||(h=b("Promise"))).resolve(f));return h.all([c,d])}).then(function(b){var c=b[0];b=b[1];d("WALogger").LOG(t());a.send(i.encodeHandshakeFinish({"static":c,payload:b}));return a.finish()})}function z(a,b,c,e){var f=new(d("WANoiseHandshake").NoiseHandshake)(a);f.start(v,e.protoHeader);a=c.generatePublicKey();f.authenticate(a);return a.then(function(a){d("WALogger").LOG(s());return f.sendAndReceive(e.encodeHandshakeHello({ephemeral:a}))}).then(function(a){d("WALogger").LOG(r());a=e.decodeServerHello(a);return y(f,a,b,c,e)})}function A(a,e,f,g,i){var j=new(d("WANoiseHandshake").NoiseHandshake)(a);j.start(w,i.protoHeader);var k=g.generatePublicKey();j.authenticate(f);j.authenticate(k);j.mixIntoKey(g.generateSharedSecret(f));var l=j.encrypt(i.staticKeyPair.generatePublicKey());j.mixIntoKey(i.staticKeyPair.generateSharedSecret(f));f=j.encrypt((h||(h=b("Promise"))).resolve(e));return h.all([k,f,l]).then(function(b){var a=b[0],c=b[1];b=b[2];d("WALogger").LOG(q());return j.sendAndReceive(i.encodeHandshakeHello({ephemeral:a,payload:c,"static":b}))}).then(function(b){d("WALogger").LOG(p());b=i.decodeServerHello(b);var f=b||{},h=f.ephemeral,k=f["static"];f=f.payload;if(k==null){d("WALogger").LOG(o());if(!h)throw c("WAErr")("serverHello missing serverEphemeral");if(!f)throw c("WAErr")("serverHello missing certificateCiphertext");j.authenticate(h);j.mixIntoKey(g.generateSharedSecret(h));j.mixIntoKey(i.staticKeyPair.generateSharedSecret(h));return j.decrypt(f).then(function(){d("WALogger").LOG(n());return j.finish()})}else{d("WALogger").LOG(m());return B(a,b,e,g,i)}})}function B(a,b,c,e,f){a=new(d("WANoiseHandshake").NoiseHandshake)(a);a.start(x,f.protoHeader);var g=e.generatePublicKey();a.authenticate(g);d("WALogger").LOG(l());return y(a,b,c,e,f)}function a(a,c,e){return a.openSocket(e).then(d("WAResultOrError").onResult(function(e){var f,g,l,m,n,o,p,q,r,s;return b("regeneratorRuntime").async(function(t){while(1)switch(t.prev=t.next){case 0:(h||(h=b("Promise"))).resolve().then(c);f=void 0;g=a.edgeInfo;g&&(l=new(d("WABinary").Binary)(),l.write("ED",0,1),l.writeUint8(g.byteLength>>16),l.writeUint16(g.byteLength&65535),l.writeBuffer(g),f=l.readByteArray(),d("WALogger").LOG(k(),f));m=f?d("WABinary").Binary.build(f,a.protoHeader).readByteArray():a.protoHeader;n=new(d("WAFrameSocket").FrameSocket)(e,m);t.next=8;return b("regeneratorRuntime").awrap(a.getClientPayload());case 8:o=t.sent;p=new(d("WACryptoCurve25519").Curve25519)(a.curveSignalDependencies);q=a.serverStaticKeyIfKnown();if(!q){t.next=17;break}d("WALogger").LOG(j());(r=a.preLogging)==null?void 0:r.onBeforeResumeHandshakeStarted==null?void 0:r.onBeforeResumeHandshakeStarted();return t.abrupt("return",A(n,o,q,p,a).then(function(b){var c;(c=a.preLogging)==null?void 0:c.onAfterResumeHandshakeCompleted==null?void 0:c.onAfterResumeHandshakeCompleted();return b})["catch"](function(c){var d;(d=a.preLogging)==null?void 0:d.onHandshakeError==null?void 0:d.onHandshakeError();return(h||(h=b("Promise"))).reject(c)}));case 17:d("WALogger").LOG(i());(s=a.preLogging)==null?void 0:s.onBeforeFullHandshakeStarted==null?void 0:s.onBeforeFullHandshakeStarted();return t.abrupt("return",z(n,o,p,a).then(function(b){var c;(c=a.preLogging)==null?void 0:c.onAfterFullHandshakeCompleted==null?void 0:c.onAfterFullHandshakeCompleted();return b})["catch"](function(c){var d;(d=a.preLogging)==null?void 0:d.onHandshakeError==null?void 0:d.onHandshakeError();return(h||(h=b("Promise"))).reject(c)}));case 20:case"end":return t.stop()}},null,this)}))}g.doFullHandshake=z;g.openChatSocket=a}),98);
__d("WACert.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};c={};e={};f={};a.internalSpec={details:[1,(d=d("WAProtoConst")).TYPES.BYTES],signature:[2,d.TYPES.BYTES]};b.internalSpec={serial:[1,d.TYPES.UINT32],issuer:[2,d.TYPES.STRING],expires:[3,d.TYPES.UINT64],subject:[4,d.TYPES.STRING],key:[5,d.TYPES.BYTES]};c.internalSpec={leaf:[1,d.TYPES.MESSAGE,e],intermediate:[2,d.TYPES.MESSAGE,e]};e.internalSpec={details:[1,d.TYPES.BYTES],signature:[2,d.TYPES.BYTES]};f.internalSpec={serial:[1,d.TYPES.UINT32],issuerSerial:[2,d.TYPES.UINT32],key:[3,d.TYPES.BYTES],notBefore:[4,d.TYPES.UINT64],notAfter:[5,d.TYPES.UINT64]};g.NoiseCertificateSpec=a;g.NoiseCertificate$DetailsSpec=b;g.CertChainSpec=c;g.CertChain$NoiseCertificateSpec=e;g.CertChain$NoiseCertificate$DetailsSpec=f}),98);
__d("WAVerifyChainCertificateWA6",["WACert.pb","WACryptoUtils","WAHex","WALogger","WAResultOrError","WASignalKeys","WASignalOther","WASignalSignatures","decodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(['parseCertificateWA6 certificate is missing "key"']);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(['parseCertificateWA6 certificate is missing "serial"']);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(['parseCertificateWA6 certificate is missing "issuer_serial"']);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(['parseCertificateWA6 certificate is missing "signature"']);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(['parseCertificateWA6 certificate is missing "details"']);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["verifyChainCertificateWA6 leafCert.key does not match handshake server.hello.static"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["verifyChainCertificateWA6: leaf certificate is poorly signed"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["verifyChainCertificateWA6 leaf certificate was not issued by RootCA"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["verifyChainCertificateWA6: invalid leaf certificate"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["verifying leaf certificate"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["verifyChainCertificateWA6: intermediate certificate is poorly signed"]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["verifyChainCertificateWA6 intermediate certificate was not issued by RootCA"]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["verifyChainCertificateWA6: invalid intermediate certificate"]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["verifying intermediate certificate"]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["verifyChainCertificateWA6: missing leaf and/or intermediate certificate"]);v=function(){return a};return a}function w(){var a=babelHelpers.taggedTemplateLiteralLoose(["verifyChainCertificateWA6: extract leaf and intermediate certificate"]);w=function(){return a};return a}b="142375574d0a587166aae71ebe516437c4a28b73e3695c6ce1f7f9545da8ee6b";var x={SERIAL:0,ISSUER:"WhatsAppLongTerm1",PUBLIC_KEY:d("WASignalKeys").serializeIdentity(new Uint8Array(d("WAHex").parseHex(b)))};function a(a,b){d("WALogger").LOG(w());a=d("decodeProtobuf").decodeProtobuf(d("WACert.pb").CertChainSpec,a);var c=a.intermediate;a=a.leaf;if(c==null||a==null){d("WALogger").ERROR(v());return d("WAResultOrError").makeError("missing-certificate")}d("WALogger").LOG(u());c=y(c);if(!c.success){d("WALogger").ERROR(t());return d("WAResultOrError").makeError("invalid-certificate")}if(c.value.issuerSerial!==x.SERIAL){d("WALogger").ERROR(s());return d("WAResultOrError").makeError("invalid-certificate")}if(!z(c.value,x.PUBLIC_KEY)){d("WALogger").ERROR(r());return d("WAResultOrError").makeError("invalid-certificate")}d("WALogger").LOG(q());a=y(a);if(!a.success){d("WALogger").ERROR(p());return d("WAResultOrError").makeError("invalid-certificate")}if(a.value.issuerSerial!==c.value.serial){d("WALogger").ERROR(o());return d("WAResultOrError").makeError("invalid-certificate")}var e=d("WASignalKeys").serializeIdentity(new Uint8Array(c.value.key));if(!z(a.value,e)){d("WALogger").ERROR(n());return d("WAResultOrError").makeError("invalid-certificate")}if(!d("WACryptoUtils").arrayBuffersEqual(a.value.key,b)){d("WALogger").ERROR(m());return d("WAResultOrError").makeError("invalid-certificate")}return d("WAResultOrError").makeResult({leaf:a.value,intermediate:c.value})}function y(a){var b=a.details;a=a.signature;if(!b){d("WALogger").ERROR(l());return d("WAResultOrError").makeError("invalid-certificate")}if(!a){d("WALogger").ERROR(k());return d("WAResultOrError").makeError("invalid-certificate")}var c=d("decodeProtobuf").decodeProtobuf(d("WACert.pb").CertChain$NoiseCertificate$DetailsSpec,b),e=c.issuerSerial,f=c.serial,g=c.key,m=c.notAfter;c=c.notBefore;if(e==null){d("WALogger").ERROR(j());return d("WAResultOrError").makeError("invalid-certificate")}if(f==null){d("WALogger").ERROR(i());return d("WAResultOrError").makeError("invalid-certificate")}if(g==null){d("WALogger").ERROR(h());return d("WAResultOrError").makeError("invalid-certificate")}a=d("WASignalOther").ensureSize(new Uint8Array(a),64);return d("WAResultOrError").makeResult({serial:f,issuerSerial:e,key:g,notBefore:c,notAfter:m,details:b,signature:a})}function z(a,b){return d("WASignalSignatures").verifyMsgSignalVariant(b,new Uint8Array(a.details),a.signature)}g.ROOT_CA=x;g.verifyChainCertificateWA6=a;g.parseCertificateWA6=y}),98);
__d("WAWebProtobufsWa6.pb",["$InternalEnum","WAProtoConst"],(function(a,b,c,d,e,f,g){c=(a=b("$InternalEnum"))({WHATSAPP:0,MESSENGER:1,INTEROP:2,INTEROP_MSGR:3});e=a({SYSTEM:0,GOOGLE:1,HARDCODED:2,OVERRIDE:3,FALLBACK:4});f=a({CELLULAR_UNKNOWN:0,WIFI_UNKNOWN:1,CELLULAR_EDGE:100,CELLULAR_IDEN:101,CELLULAR_UMTS:102,CELLULAR_EVDO:103,CELLULAR_GPRS:104,CELLULAR_HSDPA:105,CELLULAR_HSUPA:106,CELLULAR_HSPA:107,CELLULAR_CDMA:108,CELLULAR_1XRTT:109,CELLULAR_EHRPD:110,CELLULAR_LTE:111,CELLULAR_HSPAP:112});b=a({PUSH:0,USER_ACTIVATED:1,SCHEDULED:2,ERROR_RECONNECT:3,NETWORK_SWITCH:4,PING_RECONNECT:5,UNKNOWN:6});var h=a({SHARE_EXTENSION:0,SERVICE_EXTENSION:1,INTENTS_EXTENSION:2}),i=a({WEB_BROWSER:0,APP_STORE:1,WIN_STORE:2,DARWIN:3,WIN32:4}),j=a({PHONE:0,TABLET:1,DESKTOP:2,WEARABLE:3,VR:4}),k=a({RELEASE:0,BETA:1,ALPHA:2,DEBUG:3});a=a({ANDROID:0,IOS:1,WINDOWS_PHONE:2,BLACKBERRY:3,BLACKBERRYX:4,S40:5,S60:6,PYTHON_CLIENT:7,TIZEN:8,ENTERPRISE:9,SMB_ANDROID:10,KAIOS:11,SMB_IOS:12,WINDOWS:13,WEB:14,PORTAL:15,GREEN_ANDROID:16,GREEN_IPHONE:17,BLUE_ANDROID:18,BLUE_IPHONE:19,FBLITE_ANDROID:20,MLITE_ANDROID:21,IGLITE_ANDROID:22,PAGE:23,MACOS:24,OCULUS_MSG:25,OCULUS_CALL:26,MILAN:27,CAPI:28,WEAROS:29,ARDEVICE:30,VRDEVICE:31,BLUE_WEB:32,IPAD:33,TEST:34,SMART_GLASSES:35});var l={},m={},n={},o={},p={},q={},r={},s={},t={},u={},v={},w={};l.internalSpec={clientHello:[2,(d=d("WAProtoConst")).TYPES.MESSAGE,o],serverHello:[3,d.TYPES.MESSAGE,n],clientFinish:[4,d.TYPES.MESSAGE,m]};m.internalSpec={"static":[1,d.TYPES.BYTES],payload:[2,d.TYPES.BYTES]};n.internalSpec={ephemeral:[1,d.TYPES.BYTES],"static":[2,d.TYPES.BYTES],payload:[3,d.TYPES.BYTES]};o.internalSpec={ephemeral:[1,d.TYPES.BYTES],"static":[2,d.TYPES.BYTES],payload:[3,d.TYPES.BYTES]};p.internalSpec={username:[1,d.TYPES.UINT64],passive:[3,d.TYPES.BOOL],userAgent:[5,d.TYPES.MESSAGE,v],webInfo:[6,d.TYPES.MESSAGE,t],pushName:[7,d.TYPES.STRING],sessionId:[9,d.TYPES.SFIXED32],shortConnect:[10,d.TYPES.BOOL],connectType:[12,d.TYPES.ENUM,f],connectReason:[13,d.TYPES.ENUM,b],shards:[14,d.FLAGS.REPEATED|d.TYPES.INT32],dnsSource:[15,d.TYPES.MESSAGE,s],connectAttemptCount:[16,d.TYPES.UINT32],device:[18,d.TYPES.UINT32],devicePairingData:[19,d.TYPES.MESSAGE,r],product:[20,d.TYPES.ENUM,c],fbCat:[21,d.TYPES.BYTES],fbUserAgent:[22,d.TYPES.BYTES],oc:[23,d.TYPES.BOOL],lc:[24,d.TYPES.INT32],iosAppExtension:[30,d.TYPES.ENUM,h],fbAppId:[31,d.TYPES.UINT64],fbDeviceId:[32,d.TYPES.BYTES],pull:[33,d.TYPES.BOOL],paddingBytes:[34,d.TYPES.BYTES],yearClass:[36,d.TYPES.INT32],memClass:[37,d.TYPES.INT32],interopData:[38,d.TYPES.MESSAGE,q]};q.internalSpec={accountId:[1,d.TYPES.UINT64],token:[2,d.TYPES.BYTES]};r.internalSpec={eRegid:[1,d.TYPES.BYTES],eKeytype:[2,d.TYPES.BYTES],eIdent:[3,d.TYPES.BYTES],eSkeyId:[4,d.TYPES.BYTES],eSkeyVal:[5,d.TYPES.BYTES],eSkeySig:[6,d.TYPES.BYTES],buildHash:[7,d.TYPES.BYTES],deviceProps:[8,d.TYPES.BYTES]};s.internalSpec={dnsMethod:[15,d.TYPES.ENUM,e],appCached:[16,d.TYPES.BOOL]};t.internalSpec={refToken:[1,d.TYPES.STRING],version:[2,d.TYPES.STRING],webdPayload:[3,d.TYPES.MESSAGE,u],webSubPlatform:[4,d.TYPES.ENUM,i]};u.internalSpec={usesParticipantInKey:[1,d.TYPES.BOOL],supportsStarredMessages:[2,d.TYPES.BOOL],supportsDocumentMessages:[3,d.TYPES.BOOL],supportsUrlMessages:[4,d.TYPES.BOOL],supportsMediaRetry:[5,d.TYPES.BOOL],supportsE2EImage:[6,d.TYPES.BOOL],supportsE2EVideo:[7,d.TYPES.BOOL],supportsE2EAudio:[8,d.TYPES.BOOL],supportsE2EDocument:[9,d.TYPES.BOOL],documentTypes:[10,d.TYPES.STRING],features:[11,d.TYPES.BYTES]};v.internalSpec={platform:[1,d.TYPES.ENUM,a],appVersion:[2,d.TYPES.MESSAGE,w],mcc:[3,d.TYPES.STRING],mnc:[4,d.TYPES.STRING],osVersion:[5,d.TYPES.STRING],manufacturer:[6,d.TYPES.STRING],device:[7,d.TYPES.STRING],osBuildNumber:[8,d.TYPES.STRING],phoneId:[9,d.TYPES.STRING],releaseChannel:[10,d.TYPES.ENUM,k],localeLanguageIso6391:[11,d.TYPES.STRING],localeCountryIso31661Alpha2:[12,d.TYPES.STRING],deviceBoard:[13,d.TYPES.STRING],deviceExpId:[14,d.TYPES.STRING],deviceType:[15,d.TYPES.ENUM,j],deviceModelType:[16,d.TYPES.STRING]};w.internalSpec={primary:[1,d.TYPES.UINT32],secondary:[2,d.TYPES.UINT32],tertiary:[3,d.TYPES.UINT32],quaternary:[4,d.TYPES.UINT32],quinary:[5,d.TYPES.UINT32]};g.ClientPayload$Product=c;g.ClientPayload$DNSSource$DNSResolutionMethod=e;g.ClientPayload$ConnectType=f;g.ClientPayload$ConnectReason=b;g.ClientPayload$IOSAppExtension=h;g.ClientPayload$WebInfo$WebSubPlatform=i;g.ClientPayload$UserAgent$DeviceType=j;g.ClientPayload$UserAgent$ReleaseChannel=k;g.ClientPayload$UserAgent$Platform=a;g.HandshakeMessageSpec=l;g.HandshakeMessage$ClientFinishSpec=m;g.HandshakeMessage$ServerHelloSpec=n;g.HandshakeMessage$ClientHelloSpec=o;g.ClientPayloadSpec=p;g.ClientPayload$InteropDataSpec=q;g.ClientPayload$DevicePairingRegistrationDataSpec=r;g.ClientPayload$DNSSourceSpec=s;g.ClientPayload$WebInfoSpec=t;g.ClientPayload$WebInfo$WebdPayloadSpec=u;g.ClientPayload$UserAgentSpec=v;g.ClientPayload$UserAgent$AppVersionSpec=w}),98);
__d("WAWebCommonSocketPlatformDetails",["WALogger","WAVerifyChainCertificateWA6","WAWapDict","WAWebProtobufsWa6.pb","asyncToGeneratorRuntime","decodeProtobuf","encodeProtobuf","err"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["processCertificate start"]);h=function(){return a};return a}var i=new Uint8Array([87,65,6,d("WAWapDict").DICT_VERSION]);function a(a){return d("encodeProtobuf").encodeProtobuf(d("WAWebProtobufsWa6.pb").HandshakeMessageSpec,{clientHello:a}).readByteArray()}function e(a){return d("encodeProtobuf").encodeProtobuf(d("WAWebProtobufsWa6.pb").HandshakeMessageSpec,{clientFinish:a}).readByteArray()}function f(a){return d("decodeProtobuf").decodeProtobuf(d("WAWebProtobufsWa6.pb").HandshakeMessageSpec,a).serverHello}function j(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.certificate;a=a.serverStatic;d("WALogger").LOG(h());b=(yield d("WAVerifyChainCertificateWA6").verifyChainCertificateWA6(b,a));if(!b.success)throw c("err")("verifyCertificateWA6 - "+b.error)});return k.apply(this,arguments)}function l(){return null}g.WA_WEB_PROTO_HEADER=i;g.encodeHandshakeHello=a;g.encodeHandshakeFinish=e;g.decodeServerHello=f;g.processCertificate=j;g.serverInfoIfKnown=l}),98);
__d("WAWebClientPayloadReleaseChannel",["WALogger","WAWebProtobufsWa6.pb","WAWebUserPrefsGeneral","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Web Beta] DEV-ONLY: Enabling INTERN features"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Web Beta] Enabling dev features"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Web Beta] Enabling BETA features"]);j=function(){return a};return a}function a(){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WAWebUserPrefsGeneral").getWhatsAppWebExternalBetaJoinedIdb());if(c("gkx")("26258")){if(a){d("WALogger").LOG(j());return d("WAWebProtobufsWa6.pb").ClientPayload$UserAgent$ReleaseChannel.BETA}return d("WAWebProtobufsWa6.pb").ClientPayload$UserAgent$ReleaseChannel.RELEASE}if(c("gkx")("26259")){if(a){d("WALogger").LOG(i());return d("WAWebProtobufsWa6.pb").ClientPayload$UserAgent$ReleaseChannel.DEBUG}return d("WAWebProtobufsWa6.pb").ClientPayload$UserAgent$ReleaseChannel.BETA}if(a){d("WALogger").LOG(h());return d("WAWebProtobufsWa6.pb").ClientPayload$UserAgent$ReleaseChannel.BETA}return d("WAWebProtobufsWa6.pb").ClientPayload$UserAgent$ReleaseChannel.DEBUG});return k.apply(this,arguments)}g.getReleaseChannel=a}),98);
__d("WAWebProtobufsCompanionReg.pb",["$InternalEnum","WAProtoConst"],(function(a,b,c,d,e,f,g){a=b("$InternalEnum")({UNKNOWN:0,CHROME:1,FIREFOX:2,IE:3,OPERA:4,SAFARI:5,EDGE:6,DESKTOP:7,IPAD:8,ANDROID_TABLET:9,OHANA:10,ALOHA:11,CATALINA:12,TCL_TV:13,IOS_PHONE:14,IOS_CATALYST:15,ANDROID_PHONE:16,ANDROID_AMBIGUOUS:17,WEAR_OS:18,AR_WRIST:19,AR_DEVICE:20,UWP:21,VR:22});c={};e={};f={};c.internalSpec={os:[1,(b=d("WAProtoConst")).TYPES.STRING],version:[2,b.TYPES.MESSAGE,f],platformType:[3,b.TYPES.ENUM,a],requireFullSync:[4,b.TYPES.BOOL],historySyncConfig:[5,b.TYPES.MESSAGE,e]};e.internalSpec={fullSyncDaysLimit:[1,b.TYPES.UINT32],fullSyncSizeMbLimit:[2,b.TYPES.UINT32],storageQuotaMb:[3,b.TYPES.UINT32],inlineInitialPayloadInE2EeMsg:[4,b.TYPES.BOOL],recentSyncDaysLimit:[5,b.TYPES.UINT32],supportCallLogHistory:[6,b.TYPES.BOOL],supportBotUserAgentChatHistory:[7,b.TYPES.BOOL],supportCagReactionsAndPolls:[8,b.TYPES.BOOL],supportBizHostedMsg:[9,b.TYPES.BOOL],supportRecentSyncChunkMessageCountTuning:[10,b.TYPES.BOOL]};f.internalSpec={primary:[1,b.TYPES.UINT32],secondary:[2,b.TYPES.UINT32],tertiary:[3,b.TYPES.UINT32],quaternary:[4,b.TYPES.UINT32],quinary:[5,b.TYPES.UINT32]};g.DeviceProps$PlatformType=a;g.DevicePropsSpec=c;g.DeviceProps$HistorySyncConfigSpec=e;g.DeviceProps$AppVersionSpec=f}),98);
__d("WAWebClientPayload",["WABase64","WAByteArray","WAMd5","WAWebBuildConstants","WAWebClientPayloadReleaseChannel","WAWebMiscBrowserUtils","WAWebProtobufsCompanionReg.pb","WAWebProtobufsWa6.pb","WAWebSyncGatingUtils","WAWebSyncdMdSyncFieldstatMeta","WAWebUserPrefsInfoStore","WAWebUserPrefsMeUser","WAWebWamPlatform","asyncToGeneratorRuntime","encodeProtobuf","gkx"],(function(a,b,c,d,e,f,g){function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=d("WAWebUserPrefsMeUser").assertGetMe();a=babelHelpers["extends"]({},yield j(a),{username:parseInt(b.user,10),device:b.device!=null?b.device:0});return d("encodeProtobuf").encodeProtobuf(d("WAWebProtobufsWa6.pb").ClientPayloadSpec,a).readByteArray()});return h.apply(this,arguments)}function e(a,b,c){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){var e=l(),f=(yield m());c=babelHelpers["extends"]({},yield j(c),{devicePairingData:{buildHash:e,deviceProps:f,eRegid:d("WAByteArray").intToBytes(4,a.registrationId),eKeytype:d("WAByteArray").intToBytes(1,5),eIdent:a.identityKeyPair.pubKey,eSkeyId:d("WAByteArray").intToBytes(3,b.keyId),eSkeyVal:b.keyPair.pubKey,eSkeySig:b.signature}});return d("encodeProtobuf").encodeProtobuf(d("WAWebProtobufsWa6.pb").ClientPayloadSpec,c).readByteArray()});return i.apply(this,arguments)}function j(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b;return{passive:(b=a==null?void 0:a.passive)!=null?b:!1,pull:(b=a==null?void 0:a.pull)!=null?b:!1,connectType:d("WAWebProtobufsWa6.pb").ClientPayload$ConnectType.WIFI_UNKNOWN,connectReason:d("WAWebProtobufsWa6.pb").ClientPayload$ConnectReason.USER_ACTIVATED,userAgent:yield o(),webInfo:{webSubPlatform:r()}}});return k.apply(this,arguments)}function l(){var a=d("WABase64").decodeB64(c("WAMd5")(d("WAWebBuildConstants").VERSION_BASE));a=new Uint8Array(a);return a}function m(){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=c("WAWebMiscBrowserUtils").info(),b;if(a.version&&a.version!==""){var e=a.version.split(".");e.length>0&&a.version&&/^[0-9\.]+$/.test(a.version)&&(b={primary:parseInt(e[0],10),secondary:e.length>1?parseInt(e[1],10):void 0,tertiary:e.length>2?parseInt(e[2],10):void 0})}e=!!c("gkx")("26255");var f={inlineInitialPayloadInE2EeMsg:d("WAWebSyncGatingUtils").isHistorySyncWithoutMmsEnabled(),supportBotUserAgentChatHistory:!0,supportCagReactionsAndPolls:!0,supportRecentSyncChunkMessageCountTuning:!0};if(!c("gkx")("26255")){var g=(yield d("WAWebSyncdMdSyncFieldstatMeta").MdSyncFieldStatsMeta.getStorageEstimation());g.mdStorageQuotaBytes!==d("WAWebSyncdMdSyncFieldstatMeta").STORAGE_QUOTA_UNAVAILABLE&&(f=babelHelpers["extends"]({},f,{storageQuotaMb:Math.trunc(g.mdStorageQuotaBytes/1024/1024)}))}g={os:a.os,version:b,platformType:q(a.name),requireFullSync:e,historySyncConfig:f};a=d("encodeProtobuf").encodeProtobuf(d("WAWebProtobufsCompanionReg.pb").DevicePropsSpec,g).readByteArray();return a});return n.apply(this,arguments)}function o(){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WAWebUserPrefsInfoStore").deviceInfo.get());return{appVersion:{primary:Number(d("WAWebBuildConstants").VERSION_PRIMARY),secondary:Number(d("WAWebBuildConstants").VERSION_SECONDARY),tertiary:Number(d("WAWebBuildConstants").VERSION_TERTIARY)},platform:d("WAWebProtobufsWa6.pb").ClientPayload$UserAgent$Platform.WEB,releaseChannel:yield d("WAWebClientPayloadReleaseChannel").getReleaseChannel(),mcc:a.mcc,mnc:a.mnc,osVersion:a.osVersion,manufacturer:a.manufacturer,device:a.device,osBuildNumber:a.osBuild,localeLanguageIso6391:a.lg,localeCountryIso31661Alpha2:a.lc}});return p.apply(this,arguments)}function q(a){switch(a){case"Chrome":return d("WAWebProtobufsCompanionReg.pb").DeviceProps$PlatformType.CHROME;case"Firefox":return d("WAWebProtobufsCompanionReg.pb").DeviceProps$PlatformType.FIREFOX;case"IE":return d("WAWebProtobufsCompanionReg.pb").DeviceProps$PlatformType.IE;case"Opera":return d("WAWebProtobufsCompanionReg.pb").DeviceProps$PlatformType.OPERA;case"Safari":return d("WAWebProtobufsCompanionReg.pb").DeviceProps$PlatformType.SAFARI;case"Edge":return d("WAWebProtobufsCompanionReg.pb").DeviceProps$PlatformType.EDGE;case"electron":case"Desktop":return d("WAWebProtobufsCompanionReg.pb").DeviceProps$PlatformType.DESKTOP;case"ipad":case"iPad":return d("WAWebProtobufsCompanionReg.pb").DeviceProps$PlatformType.IPAD;case"tablet":case"Android tablet":return d("WAWebProtobufsCompanionReg.pb").DeviceProps$PlatformType.ANDROID_TABLET;case"Ohana":return d("WAWebProtobufsCompanionReg.pb").DeviceProps$PlatformType.OHANA;case"Aloha":return d("WAWebProtobufsCompanionReg.pb").DeviceProps$PlatformType.ALOHA;case"Catalina":return d("WAWebProtobufsCompanionReg.pb").DeviceProps$PlatformType.CATALINA;default:return d("WAWebProtobufsCompanionReg.pb").DeviceProps$PlatformType.UNKNOWN}}function r(){switch(d("WAWebWamPlatform").getWamPlatform()){case"WEB":case"PWA":return d("WAWebProtobufsWa6.pb").ClientPayload$WebInfo$WebSubPlatform.WEB_BROWSER;case"DARWIN":case"DARWIN_BETA":return d("WAWebProtobufsWa6.pb").ClientPayload$WebInfo$WebSubPlatform.DARWIN;case"WIN32":case"WIN32_BETA":return d("WAWebProtobufsWa6.pb").ClientPayload$WebInfo$WebSubPlatform.WIN32;case"MACSTORE":return d("WAWebProtobufsWa6.pb").ClientPayload$WebInfo$WebSubPlatform.APP_STORE;case"WINSTORE":return d("WAWebProtobufsWa6.pb").ClientPayload$WebInfo$WebSubPlatform.WIN_STORE;default:return void 0}}g.getClientPayloadForLogin=a;g.getClientPayloadForRegistration=e;g.getUserAgent=o;g.getWebSubPlatform=r}),98);
__d("WAWebGetClientPayloadForLogin",["WALogger","WANullthrows","WAWebClientPayload","WAWebPassiveModeManager","WAWebRegisterPassiveTasks","WAWebSocketLogoutJob","WAWebUserPrefsInfoStore","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unable to decrypt noise data"]);h=function(){return a};return a}function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a||{passive:!1,pull:!0};var b=(yield d("WAWebUserPrefsInfoStore").waNoiseInfo.get());b==null&&(d("WALogger").LOG(h()).tags("launch-socket-chat"),yield d("WAWebSocketLogoutJob").socketLogout(),c("WANullthrows")(b));yield d("WAWebRegisterPassiveTasks").registerPassiveTasksForConnect();a.passive=d("WAWebPassiveModeManager").PassiveTaskManager.shouldConnectAsPassiveMode();return d("WAWebClientPayload").getClientPayloadForLogin(a)});return i.apply(this,arguments)}g.getClientPayloadForLogin=a}),98);
__d("WAWebGetClientPayloadForRegistration",["Promise","WAWebClientPayload","WAWebSignalStoreApi","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){var h;function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=(yield (h||(h=b("Promise"))).all([d("WAWebSignalStoreApi").waSignalStore.getRegistrationInfo(),d("WAWebSignalStoreApi").waSignalStore.getSignedPreKey()])),f=e[0];e=e[1];if(!e||!f)throw c("err")("Invalid signal credentials");return d("WAWebClientPayload").getClientPayloadForRegistration(f,e,a)});return i.apply(this,arguments)}g.getClientPayloadForRegistration=a}),98);
__d("WAPromiseAny",["Promise","WACustomError"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return a.length===0?(h||(h=b("Promise"))).reject(new(d("WACustomError").AggregateError)([])):(h||(h=b("Promise"))).all(a.map(i)).then(function(a){throw new(d("WACustomError").AggregateError)(a)},function(a){return a})}function i(a){return new(h||(h=b("Promise")))(function(c,d){return(h||(h=b("Promise"))).resolve(a).then(d,c)})}g.promiseAny=a}),98);
__d("WARaceSignalLegacyPromise",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){var c,d=new AbortController();if(a.some(function(a){return a.aborted}))d.abort();else{c=function(){for(var d=0;d<a.length;d++){var b=a[d];b.removeEventListener("abort",e)}c=null};var e=function(){c==null?void 0:c(),d.abort()};for(var f=0;f<a.length;f++){var g=a[f];g.addEventListener("abort",e)}}return b(d.signal)["finally"](function(){c==null?void 0:c()})}f["default"]=a}),66);
__d("WAWebEventsWaitForOnline",["WAPromiseDelays","WAWebEventsWaitForEvent","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h=100;function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield c("WAWebEventsWaitForEvent")(self,"online",void 0,a);return d("WAPromiseDelays").delayMs(h,a)});return i.apply(this,arguments)}g.waitForOnlineNaive=a}),98);
__d("WAWebWatchdog",["WALogger","WAShiftTimer","WAWebBaseModel"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Watchdog timed-out without handler!"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["forced non-running watchdog!"]);i=function(){return a};return a}b=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,c;for(var e=arguments.length,f=new Array(e),g=0;g<e;g++)f[g]=arguments[g];return(b=c=a.call.apply(a,[this].concat(f))||this,c.failGeneration=d("WAWebBaseModel").session(0),c.ts=d("WAWebBaseModel").session(),c.waitDuration=d("WAWebBaseModel").session(0),c.prevWaitDuration=d("WAWebBaseModel").session(0),c.jitter=d("WAWebBaseModel").session(0),c.shiftTimer=d("WAWebBaseModel").session(),c.waitAlgorithm=d("WAWebBaseModel").session(),c.onActivated=d("WAWebBaseModel").session(),c.onDeactivated=d("WAWebBaseModel").session(),c.onFed=d("WAWebBaseModel").session(),c.onTimeout=d("WAWebBaseModel").session(),b)||babelHelpers.assertThisInitialized(c)}var c=b.prototype;c.initialize=function(){var a=this;this.shiftTimer=new(d("WAShiftTimer").ShiftTimer)(function(){return j.call(a)})};c.activate=function(){this.shiftTimer.isScheduled()||(this._run(!0),this.onActivated&&this.onActivated(this))};c.deactivate=function(){this.shiftTimer.isScheduled()&&(this.shiftTimer.cancel(),this.onDeactivated&&this.onDeactivated(this))};c.feed=function(){if(!this.shiftTimer.isScheduled())return;this._run(!0);this.onFed&&this.onFed(this)};c.forceTimeout=function(a){!this.shiftTimer.isScheduled()?d("WALogger").WARN(i()):a!=null&&a!==0?(this.shiftTimer.onOrBefore(a),this.ts=this.shiftTimer.ts):this.shiftTimer.forceRunNow()};c.poke=function(){this.forceTimeout.apply(this,arguments)};c.resetGeneration=function(){this.failGeneration=0};c._run=function(a){a&&this.resetGeneration();a=this.waitAlgorithm(this);var b=this.jitter*Math.random()*a;this.shiftTimer.debounce(a+b);this.set({ts:this.shiftTimer.ts,waitDuration:a,prevWaitDuration:this.waitDuration})};return b}(d("WAWebBaseModel").BaseModel);c=d("WAWebBaseModel").defineModel(b);function j(){var a=this.onTimeout;if(!a){d("WALogger").WARN(h()).sendLogs("watchdog-no-handler");return}this.failGeneration++;a(this)&&this._run(!1)}function a(a,b,c){if(typeof c==="number"){var d=c;return function(c){switch(c.failGeneration){case 0:return Math.min(d,b);case 1:return Math.min(d,a+b);default:return Math.min(d,c.waitDuration+c.prevWaitDuration)}}}return function(c){switch(c.failGeneration){case 0:return b;case 1:return a+b;default:return c.waitDuration+c.prevWaitDuration}}}g.Watchdog=c;g.fibonacci=a}),98);
__d("WAWebSocketOpenerMd",["Promise","WAAbortError","WACustomError","WALogger","WAPromiseAny","WAPromiseDelays","WARaceSignalLegacyPromise","WAWebABProps","WAWebBaseJSHaltDetector","WAWebBaseModel","WAWebDeprecatedTightPromise","WAWebEventsWaitForBbEvent","WAWebEventsWaitForOnline","WAWebJSHaltDetector","WAWebNetworkStatus","WAWebStreamModel","WAWebWatchdog","WAWebWatchedSocketMd","gkx"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["js halt longer than "," ms detected, resetting watchdog fail generation"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: SocketOpenerMD:offline... heuristic poll"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: SocketOpenerMD:offline... quick poll"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: SocketOpenerMD:offline... wait for navigator"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: SocketOpenerMD:offlineController activating"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: SocketOpenerMD:onlineController activating"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: opened web socket"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: attemptOpen called while not active!"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["SocketOpenerMD deadly error! ",""]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: SocketOpenerMD closing socket opener"]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: SocketOpenerMD set to socket ",""]);s=function(){return a};return a}var t=c("gkx")("26258")?"wss://web.whatsapp.com/ws/chat":"wss://dev-web.whatsapp.com/ws/chat",u=c("gkx")("26258")?"wss://web-fallback.whatsapp.com/ws/chat":"wss://dev-web-fallback.whatsapp.com/ws/chat",v=3e5,w=6e3,x=2,y=.2,z=180*1e3,A=d("WAWebWatchdog").fibonacci(8e3,4e3,3e5);a=function(a){babelHelpers.inheritsLoose(e,a);function e(){var b,c;for(var e=arguments.length,f=new Array(e),g=0;g<e;g++)f[g]=arguments[g];return(b=c=a.call.apply(a,[this].concat(f))||this,c.active=d("WAWebBaseModel").prop(!0),c.socket=d("WAWebBaseModel").prop(),c.signal=d("WAWebBaseModel").prop(),c.sockets=d("WAWebBaseModel").prop(),c.pendingSocketPromiseCount=d("WAWebBaseModel").prop(0),c.attempts=d("WAWebBaseModel").prop(0),c.watchDogController=d("WAWebBaseModel").prop(),c.retryTimestamp=d("WAWebBaseModel").prop(),c.tsListener=d("WAWebBaseModel").prop(),c.onerror=d("WAWebBaseModel").prop(),b)||babelHelpers.assertThisInitialized(c)}var f=e.prototype;f.initialize=function(){var a=this;this.sockets=[];new(h||(h=b("Promise")))(function(b,c){a.$SocketOpenerMD1=b,a.$SocketOpenerMD2=c}).then(function(b){d("WALogger").LOG(s(),b.id);if(a.signal.aborted)throw new(d("WAAbortError").AbortError)();a.set({active:!1,socket:b});c("WAWebNetworkStatus").online=!0})["finally"](function(){a.stopListening();d("WALogger").LOG(r());a.active=!1;a.sockets.forEach(function(a){a.promise instanceof c("WAWebDeprecatedTightPromise")&&a.promise.cancel();if(d("WAWebABProps").getABPropConfigValue("web_prevent_parallel_socket_connection_enabled")){(a=a.controller)==null?void 0:a.abort()}});var b=a.watchDogController;b&&(b.deactivate(),a.watchDogController=null)})["catch"](d("WAAbortError").catchAbort(function(){}))["catch"](function(b){d("WALogger").WARN(q(),String(b)).devConsole(b);if(a.onerror)a.onerror(b);else throw b});this.tsListener=function(b){a.retryTimestamp=b.ts};this.listenTo(c("WAWebNetworkStatus"),"change:online",this.$SocketOpenerMD3);this.listenTo(d("WAWebJSHaltDetector").jsHaltDetector,d("WAWebBaseJSHaltDetector").JS_HALT_EVENT,this.$SocketOpenerMD4);self.addEventListener("online",function(){a.$SocketOpenerMD3()});this.$SocketOpenerMD3()};f.$SocketOpenerMD5=function(a,e){var f=this;if(!this.active){d("WALogger").LOG(p());return}var g=new AbortController();a=c("WARaceSignalLegacyPromise")([g.signal,a],function(a){return d("WAWebWatchedSocketMd").open(f.routingToken?e+"?ED="+f.routingToken:e,a)});d("WALogger").DEV(o()).devConsole(a);this.attempts=this.sockets.push({promise:a,controller:g});this.pendingSocketPromiseCount++;var i=!1,j=function(){if(i)return(h||(h=b("Promise"))).resolve();i=!0;var a=g.signal;return c("WAWebNetworkStatus").checkOnline({signal:a})},k=new AbortController();d("WAPromiseDelays").delayMs(6e3,k.signal).then(function(){return j()})["catch"](function(){});a.then(this.$SocketOpenerMD1)["finally"](function(){f.pendingSocketPromiseCount--,k.abort()})["catch"](d("WAAbortError").catchAbort(function(){}))["catch"](function(){return j()})};f.attemptOpen=function(a){this.$SocketOpenerMD5(a,t),d("WAWebABProps").getABPropConfigValue("web_socket_parallel_connection_enabled")&&this.$SocketOpenerMD5(a,u)};f.poke=function(){this.watchDogController&&this.watchDogController.forceTimeout()};f.$SocketOpenerMD3=function(){if(!this.active)return;var a=this.watchDogController,b=c("WAWebNetworkStatus").online?this.onlineController():this.offlineController();a&&(a.off("change:ts",this.tsListener),a.deactivate());b.on("change:ts",this.tsListener);b.activate();this.watchDogController=b};f.onlineController=function(){var a=this;d("WALogger").LOG(n());return new(d("WAWebWatchdog").Watchdog)({waitAlgorithm:A,jitter:y,onActivated:function(){a.attemptOpen(a.signal)},onTimeout:function(){a.attemptOpen(a.signal);return!0}})};f.offlineController=function(){var a=this;d("WALogger").LOG(m());var e=0,f,g=function(a){f&&f.abort();f=new AbortController();var g=f.signal;if(!navigator.onLine){d("WALogger").LOG(l());e=0;void B(a,[d("WAWebEventsWaitForOnline").waitForOnlineNaive(g)],f);return v}else if(e++<x){d("WALogger").LOG(k());return w}d("WALogger").LOG(j());void B(a,[d("WAWebEventsWaitForOnline").waitForOnlineNaive(g),c("WAWebEventsWaitForBbEvent")(d("WAWebJSHaltDetector").jsHaltDetector,d("WAWebBaseJSHaltDetector").JS_HALT_EVENT,void 0,g),c("WAWebEventsWaitForBbEvent")(b("WAWebStreamModel").Stream,"change:available",void 0,g)],f);return v};return new(d("WAWebWatchdog").Watchdog)({waitAlgorithm:g,jitter:y,onActivated:function(){a.pendingAttempts()===0&&a.attemptOpen(a.signal)},onDeactivated:function(){f&&f.abort()},onTimeout:function(){a.attemptOpen(a.signal);return!0}})};f.deactivate=function(){this.$SocketOpenerMD2(new(d("WAAbortError").AbortError)())};f.pendingAttempts=function(){return this.pendingSocketPromiseCount};f.$SocketOpenerMD4=function(a){var b=this.watchDogController;b&&a>z&&(d("WALogger").LOG(i(),z),b.resetGeneration())};return e}(d("WAWebBaseModel").BaseModel);function B(a,b,c){return d("WAPromiseAny").promiseAny(b).then(function(){a.forceTimeout()})["finally"](function(){c.abort()})["catch"](d("WAAbortError").catchAbort(function(){}))["catch"](function(a){if(a instanceof d("WACustomError").AggregateError&&a.errors.every(function(a){return a.name===d("WAAbortError").ABORT_ERROR}))return;throw a})}e=d("WAWebBaseModel").defineModel(a);g["default"]=e}),98);
__d("WACryptoCurve25519Dependencies",["Promise","WACryptoPrimitives","WASignalKeys","WASignalOther"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){return(h||(h=b("Promise"))).resolve().then(function(){return d("WASignalKeys").makeKeyPair()})}function c(a,c){return(h||(h=b("Promise"))).resolve().then(function(){return d("WACryptoPrimitives").scalarMult(d("WASignalOther").ensureSize(c,32),d("WASignalOther").ensureSize(a,32)).buffer})}e={generateIdentityKeyPair:a,calculateAgreement:c};g.calculateAgreement=c;g.CURVE25519_SIGNAL_DEPENDENCIES=e}),98);
__d("WAWebWorkerCurve25519SignalDependencies",["WACryptoCurve25519Dependencies"],(function(a,b,c,d,e,f){a=importNamespace("WACryptoCurve25519Dependencies").CURVE25519_SIGNAL_DEPENDENCIES;f.curve25519SignalDependencies=a}),66);
__d("WAWebChatSocketPlatformDetails",["WABase64","WACryptoCurve25519","WALogger","WANullthrows","WAResultOrError","WASignalKeys","WAWebCommonSocketPlatformDetails","WAWebEventsWaitForBbEvent","WAWebGetClientPayloadForLogin","WAWebGetClientPayloadForRegistration","WAWebGetDefaultExport","WAWebPageLoadLogging","WAWebSocketOpenerMd","WAWebUserPrefsMultiDevice","WAWebUserPrefsMultiDeviceDebug","WAWebWorkerCurve25519SignalDependencies","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: SocketOpenerMD: error ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: SocketOpenerMD: socket event"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: openNewChatSocket"]);j=function(){return a};return a}function a(a,b){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=(yield d("WAWebUserPrefsMultiDevice").getRoutingInfo());c=c==null?void 0:c.edgeRouting;a=d("WASignalKeys").makeKeyPairFromArrayBuffers(a.pubKey,a.privKey);return{edgeInfo:c,getClientPayload:d("WAWebUserPrefsMultiDevice").isRegistered()?function(){return d("WAWebGetClientPayloadForLogin").getClientPayloadForLogin(b)}:function(){return d("WAWebGetClientPayloadForRegistration").getClientPayloadForRegistration(b)},protoHeader:d("WAWebCommonSocketPlatformDetails").WA_WEB_PROTO_HEADER,encodeHandshakeHello:d("WAWebCommonSocketPlatformDetails").encodeHandshakeHello,decodeServerHello:d("WAWebCommonSocketPlatformDetails").decodeServerHello,encodeHandshakeFinish:d("WAWebCommonSocketPlatformDetails").encodeHandshakeFinish,processCertificate:d("WAWebCommonSocketPlatformDetails").processCertificate,serverStaticKeyIfKnown:d("WAWebCommonSocketPlatformDetails").serverInfoIfKnown,staticKeyPair:new(d("WACryptoCurve25519").Curve25519)(d("WAWebWorkerCurve25519SignalDependencies").curve25519SignalDependencies,a),openSocket:l,curveSignalDependencies:d("WAWebWorkerCurve25519SignalDependencies").curve25519SignalDependencies,preLogging:{onHandshakeError:d("WAWebPageLoadLogging").incrementPageLoadQplSocketError,onBeforeFullHandshakeStarted:function(){return d("WAWebPageLoadLogging").startPageLoadQplMeasure("auth_handshake")},onAfterFullHandshakeCompleted:function(){return d("WAWebPageLoadLogging").endPageLoadQplMeasure("auth_handshake")}}}});return k.apply(this,arguments)}function l(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WALogger").DEV(j());var b=(yield d("WAWebUserPrefsMultiDevice").getRoutingInfo());b=b?b.edgeRouting:null;b=b?d("WABase64").encodeB64UrlSafe(b):null;d("WAWebPageLoadLogging").startPageLoadQplMeasure("socket_open");var e;try{a=c("WANullthrows")(a,"not received abort signal from Comms");b=new(c("WAWebSocketOpenerMd"))({routingToken:b,signal:a});yield c("WAWebEventsWaitForBbEvent")(b,"change:socket",void 0,a);a=(yield b.socket);d("WAWebPageLoadLogging").endPageLoadQplMeasure("socket_open");d("WALogger").DEV(i());return d("WAResultOrError").makeResult(a)}catch(a){d("WALogger").LOG(h(),a);d("WAWebPageLoadLogging").incrementPageLoadQplSocketError();return d("WAResultOrError").makeError(a)}finally{e==null?void 0:e.deactivate()}});return m.apply(this,arguments)}g.getChatSocketPlatformDetails=a}),98);
__d("WAWebOpenChatSocket",["Promise","WABase64","WABinary","WAFrameSocket","WAHex","WALogger","WANoiseHandshake","WANullthrows","WAOpenChatSocket","WAResultOrError","WAVerifyChainCertificateWA6","WAWapDict","WAWebABProps","WAWebChatSocketPlatformDetails","WAWebClientPayload","WAWebCryptoCurve25519","WAWebEventsWaitForBbEvent","WAWebGetDefaultExport","WAWebPageLoadLogging","WAWebPassiveModeManager","WAWebProtobufsWa6.pb","WAWebRegisterPassiveTasks","WAWebSignalStoreApi","WAWebSocketLogoutJob","WAWebSocketOpenerMd","WAWebUserPrefsInfoStore","WAWebUserPrefsMultiDevice","WAWebUserPrefsMultiDeviceDebug","asyncToGeneratorRuntime","decodeProtobuf","encodeProtobuf","err"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["openChatSocketForRegistration error ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["openChatSocketForRegistration success, resetting round"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["openChatSocketForLogin error ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["openChatSocketForLogin success, resetting round"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unable to decrypt noise data"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["verifying certificate"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["openChatSocket send hello"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["openChatSocket preIntro ",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: SocketOpenerMD: socket event"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms: openChatSocketCommon"]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["certificateCiphertext: ",""]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["serverStaticCiphertext: ",""]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["serverEphemeral: ",""]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["server hello content: ",""]);v=function(){return a};return a}function w(){var a=babelHelpers.taggedTemplateLiteralLoose(["openChatSocket rcv hello"]);w=function(){return a};return a}e=6;var x=new Uint8Array([87,65,e,d("WAWapDict").DICT_VERSION]),y="Noise_XX_25519_AESGCM_SHA256\0\0\0\0",z;function A(a){return B.apply(this,arguments)}function B(){B=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WALogger").DEV(r());var b=(yield d("WAWebUserPrefsMultiDevice").getRoutingInfo()),e=b?b.edgeRouting:null;b=e?d("WABase64").encodeB64UrlSafe(e):null;d("WAWebPageLoadLogging").startPageLoadQplMeasure("socket_open");var f=new(c("WAWebSocketOpenerMd"))({routingToken:b,signal:a}),g=d("WAWebCryptoCurve25519").keyPair();b=(yield c("WAWebEventsWaitForBbEvent")(f,"change:socket",void 0,a).then(function(){d("WAWebPageLoadLogging").endPageLoadQplMeasure("socket_open");d("WALogger").DEV(q());return f.socket})["finally"](function(){f.deactivate()}).then(function(a){var b=void 0;if(e){var c=new(d("WABinary").Binary)();c.write("ED",0,1);c.writeUint8(e.byteLength>>16);c.writeUint16(e.byteLength&65535);c.writeBuffer(e);b=c.readByteArray();d("WALogger").DEV(p(),b)}c=b?d("WABinary").Binary.build(b,x).readByteArray():x;b=new(d("WAFrameSocket").FrameSocket)(a,c);d("WAWebPageLoadLogging").startPageLoadQplMeasure("auth_handshake");z=new(d("WANoiseHandshake").NoiseHandshake)(b);z.start(y,x);d("WALogger").LOG(o());z.authenticate(g.pubKey);a={clientHello:{ephemeral:g.pubKey}};return z.sendAndReceive(d("encodeProtobuf").encodeProtobuf(d("WAWebProtobufsWa6.pb").HandshakeMessageSpec,a).readByteArray())}).then(function(a){return C(z,a,g)}));a=b[0];var h=b[1];b=b[2];d("WAWebPageLoadLogging").endPageLoadQplMeasure("auth_handshake");d("WALogger").LOG(n());h=d("WAVerifyChainCertificateWA6").verifyChainCertificateWA6(h,a);if(!h.success)throw c("err")("verifyCertificateWA6 - "+h.error);return b});return B.apply(this,arguments)}function C(a,e,f){d("WALogger").LOG(w());d("WALogger").DEV(v(),d("WAHex").toLowerCaseHex(e));e=d("decodeProtobuf").decodeProtobuf(d("WAWebProtobufsWa6.pb").HandshakeMessageSpec,e);e=e.serverHello;if(!e)throw c("err")("ServerHello payload error");var g=e.ephemeral,i=e["static"];e=e.payload;if(g==null||i==null||e==null)throw c("err")("Missing server Ephemeral");d("WALogger").DEV(u(),d("WAHex").toLowerCaseHex(new Uint8Array(g)));d("WALogger").DEV(t(),d("WAHex").toLowerCaseHex(new Uint8Array(i)));d("WALogger").DEV(s(),d("WAHex").toLowerCaseHex(new Uint8Array(e)));a.authenticate(g);a.mixIntoKey(d("WAWebCryptoCurve25519").sharedSecret(g,f.privKey));i=a.decrypt(i);var j=i.then(function(a){return d("WAWebCryptoCurve25519").sharedSecret(a,f.privKey)});a.mixIntoKey(j);return(h||(h=b("Promise"))).all([i,a.decrypt(e),g])}function D(a){return E.apply(this,arguments)}function E(){E=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){try{var e=a||{passive:!1,pull:!0},f=(yield d("WAWebUserPrefsInfoStore").waNoiseInfo.get());a=c("WANullthrows")(a==null?void 0:a.signal,"abort signal is null");a=(yield A(a).then(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){f==null&&(d("WALogger").LOG(m()).tags("launch-socket-chat"),yield d("WAWebSocketLogoutJob").socketLogout(),c("WANullthrows")(f,"Unexpected null: noiseData"));var g=c("WANullthrows")(f).staticKeyPair;yield d("WAWebRegisterPassiveTasks").registerPassiveTasksForConnect();e.passive=d("WAWebPassiveModeManager").PassiveTaskManager.shouldConnectAsPassiveMode();var i=(yield d("WAWebClientPayload").getClientPayloadForLogin(e));return(h||(h=b("Promise"))).all([H(g,z,a),z.encrypt(h.resolve(i))])});return function(b){return a.apply(this,arguments)}}()).then(function(a){var b=a[0];a=a[1];b={clientFinish:{"static":b,payload:a}};z.send(d("encodeProtobuf").encodeProtobuf(d("WAWebProtobufsWa6.pb").HandshakeMessageSpec,b).readByteArray());return z.finish()}));d("WALogger").LOG(l());return d("WAResultOrError").makeResult(a)}catch(a){d("WAWebPageLoadLogging").incrementPageLoadQplSocketError();d("WALogger").WARN(k(),a);return d("WAResultOrError").makeError("disconnected")}});return E.apply(this,arguments)}function F(a){return G.apply(this,arguments)}function G(){G=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){try{var e=c("WANullthrows")(a==null?void 0:a.signal,"abort signal is null");e=(yield A(e).then(function(a){return(h||(h=b("Promise"))).all([d("WAWebSignalStoreApi").waSignalStore.getRegistrationInfo(),d("WAWebSignalStoreApi").waSignalStore.getSignedPreKey(),a])}).then(function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(e){var f=e[0],g=e[1];e=e[2];if(!g||!f)throw c("err")("Invalid signal credentials");f=(yield d("WAWebClientPayload").getClientPayloadForRegistration(f,g,a));g=c("WANullthrows")(yield d("WAWebUserPrefsInfoStore").waNoiseInfo.get()).staticKeyPair;return(h||(h=b("Promise"))).all([H(g,z,e),z.encrypt(h.resolve(f))])});return function(a){return e.apply(this,arguments)}}()).then(function(a){var b=a[0];a=a[1];b={clientFinish:{"static":b,payload:a}};z.send(d("encodeProtobuf").encodeProtobuf(d("WAWebProtobufsWa6.pb").HandshakeMessageSpec,b).readByteArray());return z.finish()}));d("WALogger").LOG(j());return d("WAResultOrError").makeResult(e)}catch(a){d("WALogger").WARN(i(),a);return d("WAResultOrError").makeError("disconnected")}});return G.apply(this,arguments)}function H(a,e,f){var g=(h||(h=b("Promise"))).resolve(a.pubKey);g=e.encrypt(g);if(!f)return(h||(h=b("Promise"))).reject(c("err")("staticAgreement called before serverKeys"));f=d("WAWebCryptoCurve25519").sharedSecret(f,a.privKey);e.mixIntoKey(f);return g}function a(a){return I.apply(this,arguments)}function I(){I=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=d("WAWebUserPrefsMultiDevice").isRegistered();if(d("WAWebABProps").getABPropConfigValue("web_optimized_handshake_flow_enabled")){var e=c("WANullthrows")(yield d("WAWebUserPrefsInfoStore").waNoiseInfo.get()).staticKeyPair;e=(yield d("WAWebChatSocketPlatformDetails").getChatSocketPlatformDetails(e,a));return d("WAOpenChatSocket").openChatSocket(e,function(){},a==null?void 0:a.signal)}return b?D(a):F(a)});return I.apply(this,arguments)}g["default"]=a}),98);
__d("WAWebCommsConfig",["WALogger","WANullthrows","WAWapJid","WAWebABProps","WAWebCmd","WAWebCommsProcessAck","WAWebCommsSendPing","WAWebGetDefaultExport","WAWebMdDebugMdStanza.react","WAWebModalManager","WAWebOfflineResumePreAckHandler","WAWebOpenChatSocket","WAWebSocketConstants","WAWebUserPrefsMultiDevice","WAWebUserPrefsMultiDeviceDebug","gkx","react"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["ack.to is a "," not a WapJid: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms:getCommsConfig:onSocketLoopIteration"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms:getCommsConfig:onSocketOpen"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms:getCommsConfig:onDisconnect"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms:getCommsConfig:openChatSocket"]);m=function(){return a};return a}b=!1;function a(a){var b=a?a:{passive:!1,pull:!1};return{maxRetries:Number.MAX_SAFE_INTEGER,openChatSocket:function(a,e){d("WAWebABProps").getABPropConfigValue("web_comms_socket_reconnect_enabled")?b.signal=c("WANullthrows")(e):b.signal=new AbortController().signal;return c("WAWebOpenChatSocket")(b).then(function(c){d("WALogger").DEV(m()).devConsole(c);a();b.passive=!1;return c})},healthCheckInterval:15,deadSocketTime:2e4,maxSocketLoopWaitTime:6e4*15,shouldCloseStaleSocket:!0,shouldBlockReceivingUntilSuccess:!0,handlers:{onConnect:function(){d("WAWebUserPrefsMultiDevice").isRegistered()&&(d("WAWebCmd").Cmd.setSocketState(d("WAWebSocketConstants").SOCKET_STATE.CONNECTED),d("WAWebCmd").Cmd.openSocketStream())},onDisconnect:function(){d("WALogger").DEV(l()),d("WAWebCmd").Cmd.socketStreamDisconnected()},onSocketOpen:function(){d("WALogger").DEV(k()),d("WAWebCmd").Cmd.setSocketState(d("WAWebSocketConstants").SOCKET_STATE.PAIRING)},onSocketLoopIteration:function(a){d("WAWebABProps").getABPropConfigValue("web_prevent_parallel_socket_connection_enabled")&&(a==null?void 0:a.abort()),d("WALogger").DEV(j()),d("WAWebCmd").Cmd.setSocketState(d("WAWebSocketConstants").SOCKET_STATE.OPENING)},onConnectionChange:function(a){},onOptimisticConnectionChange:function(a){},onBeforeCastStanzaForE2E:function(a,b){a.tag==="ack"&&!(b==null?void 0:b.preAck)&&!d("WAWebCmd").Cmd.isOfflineDeliveryEnd&&void d("WAWebOfflineResumePreAckHandler").parseAndSerializeOfflinePreAck(a)},onCastStanza:function(a){c("gkx")("26259")&&(a.tag==="ack"&&!(a.attrs.to instanceof d("WAWapJid").WapJid)&&d("WALogger").ERROR(i(),typeof a.attrs.to,a).sendLogs("send-string-jid"))},onHandleAck:function(a){c("WAWebCommsProcessAck")(a)},onHandleStanza:function(a){},onSendIq:function(a){},onClockSkewUpdate:function(a){d("WAWebCommsSendPing").updateClockSkew(a)}}}}g.getCommsConfig=a}),98);
__d("WAWebDeleteStatusAction",["Promise","WALogger","WAWebABProps","WAWebContactGetters","WAWebDBMessageDelete","WAWebStatusV3Collection","WAWebUserPrefsMeUser"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["clearStatusForNonAddressBook: remove "," status "]);i=function(){return a};return a}function a(){if(!d("WAWebABProps").getABPropConfigValue("disable_status_to_non_sub"))return(h||(h=b("Promise"))).resolve();var a=d("WAWebStatusV3Collection").StatusV3Collection.filter(function(a){return!d("WAWebUserPrefsMeUser").isMeAccount(a.contact.id)&&!d("WAWebContactGetters").getIsMyContact(a.contact)});a=a.reduce(function(a,b){a=a.concat(b.msgs.map(function(a){return String(a.id)}));b["delete"]();return a},[]);d("WALogger").LOG(i(),a.length);return d("WAWebDBMessageDelete").removeStatusMessage(a)}g.clearStatusForRemovedContact=a}),98);
__d("WAWebEventsWaitForMain",["Promise","WAWebCmd","WAWebEventsWaitForBbEvent"],(function(a,b,c,d,e,f,g){var h;function a(){return d("WAWebCmd").Cmd.isMainLoaded?(h||(h=b("Promise"))).resolve():c("WAWebEventsWaitForBbEvent")(d("WAWebCmd").Cmd,"main_loaded")}g["default"]=a}),98);
__d("WAWebInitFavoritesFromStorage",["WAWebFavoriteCollection","WAWebSchemaFavorite"],(function(a,b,c,d,e,f,g){function a(){return d("WAWebSchemaFavorite").getFavoriteTable().all().then(function(a){d("WAWebFavoriteCollection").FavoriteCollection.initializeFromCache(a)})}g.restoreFavorites=a}),98);
__d("WAWebInitWaitForEvents",["WAWebEventsWaitForOfflineDeliveryEnd","WAWebEventsWaitForReadyForOffline"],(function(a,b,c,d,e,f,g){function a(){d("WAWebEventsWaitForReadyForOffline").initWaitForOfflineProcessReady(),d("WAWebEventsWaitForOfflineDeliveryEnd").initWaitForOfflineDeliveryEnd()}g.initOfflineResumeWaitForEvents=a}),98);
__d("WAWebPersistBotProfiles",["WAWebBotProfileCollection","WAWebSchemaBotProfile","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("WAWebSchemaBotProfile").getBotProfileTable().bulkCreateOrMerge(a.map(function(a){return{id:a.id.toString(),name:a.name,attrs:a.attrs,description:a.description,category:a.category,isDefault:a.isDefault,prompts:JSON.stringify(a.prompts),personaId:a.personaId,commands:JSON.stringify(a.commands),commandsDescription:a.commandsDescription}})),a.forEach(function(a){return d("WAWebBotProfileCollection").BotProfileCollection.gadd({id:a.id,name:a.name,attrs:a.attrs,description:a.description,category:a.category,isDefault:a.isDefault,prompts:a.prompts,personaId:a.personaId,commands:a.commands,commandsDescription:a.commandsDescription})})});return h.apply(this,arguments)}g.persistBotProfiles=a}),98);
__d("WASmaxInBotIQErrorBadRequestMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","bad-request");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",400);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorBadRequestMixin=a}),98);
__d("WASmaxInBotIQErrorForbiddenMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","forbidden");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",403);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorForbiddenMixin=a}),98);
__d("WASmaxInBotIQErrorInternalServerErrorMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","internal-server-error");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",500);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorInternalServerErrorMixin=a}),98);
__d("WASmaxInBotIQErrorNotAllowedMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","not-allowed");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",405);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorNotAllowedMixin=a}),98);
__d("WASmaxInBotIQErrorInternalServerErrorOrForbiddenOrBadRequestOrNotAllowedMixinGroup",["WAResultOrError","WASmaxInBotIQErrorBadRequestMixin","WASmaxInBotIQErrorForbiddenMixin","WASmaxInBotIQErrorInternalServerErrorMixin","WASmaxInBotIQErrorNotAllowedMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInBotIQErrorInternalServerErrorMixin").parseIQErrorInternalServerErrorMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorInternalServerError",value:b.value});var c=d("WASmaxInBotIQErrorForbiddenMixin").parseIQErrorForbiddenMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"IQErrorForbidden",value:c.value});var e=d("WASmaxInBotIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(a);if(e.success)return d("WAResultOrError").makeResult({name:"IQErrorBadRequest",value:e.value});var f=d("WASmaxInBotIQErrorNotAllowedMixin").parseIQErrorNotAllowedMixin(a);return f.success?d("WAResultOrError").makeResult({name:"IQErrorNotAllowed",value:f.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorInternalServerError","IQErrorForbidden","IQErrorBadRequest","IQErrorNotAllowed"],[b,c,e,f])}g.parseIQErrorInternalServerErrorOrForbiddenOrBadRequestOrNotAllowedMixinGroup=a}),98);
__d("WASmaxInBotIQErrorResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","error");return!c.success?c:d("WAResultOrError").makeResult({type:c.value})}g.parseIQErrorResponseMixin=a}),98);
__d("WASmaxInBotBotListResponseError",["WAResultOrError","WASmaxInBotIQErrorInternalServerErrorOrForbiddenOrBadRequestOrNotAllowedMixinGroup","WASmaxInBotIQErrorResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInBotIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInBotIQErrorInternalServerErrorOrForbiddenOrBadRequestOrNotAllowedMixinGroup").parseIQErrorInternalServerErrorOrForbiddenOrBadRequestOrNotAllowedMixinGroup(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorIQErrorInternalServerErrorOrForbiddenOrBadRequestOrNotAllowedMixinGroup:b.value}))}g.parseBotListResponseError=a}),98);
__d("WASmaxInBotEnums",[],(function(a,b,c,d,e,f){a={"AI available":"AI available","Added to waitlist":"Added to waitlist","In waitlist":"In waitlist"};b={"AI available":"AI available","In waitlist":"In waitlist"};c={all:"all",category:"category",featured:"featured"};d={dark:"dark",light:"light"};e={"false":"false","true":"true"};f.ENUM_AIAVAILABLE_ADDEDTOWAITLIST_INWAITLIST=a;f.ENUM_AIAVAILABLE_INWAITLIST=b;f.ENUM_ALL_CATEGORY_FEATURED=c;f.ENUM_DARK_LIGHT=d;f.ENUM_FALSE_TRUE=e}),66);
__d("WASmaxInBotIQResultResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","result");return!c.success?c:d("WAResultOrError").makeResult({type:c.value})}g.parseIQResultResponseMixin=a}),98);
__d("WASmaxInBotBotListResponseSuccessV1",["WAResultOrError","WASmaxInBotEnums","WASmaxInBotIQResultResponseMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"bot");if(!b.success)return b;b=d("WASmaxParseJid").attrUserJid(a,"jid");if(!b.success)return b;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrStringEnum,a,"default",d("WASmaxInBotEnums").ENUM_FALSE_TRUE);return!a.success?a:d("WAResultOrError").makeResult({jid:b.value,"default":a.value})}function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"bot");if(!c.success)return c;var e=d("WASmaxParseUtils").optionalLiteral(d("WASmaxParseUtils").attrString,c.value,"v","1");if(!e.success)return e;a=d("WASmaxInBotIQResultResponseMixin").parseIQResultResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxParseUtils").mapChildrenWithTag(c.value,"bot",1,Infinity,h);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({botV:e.value},a.value,{botBot:b.value}))}g.parseBotListResponseSuccessV1BotBot=h;g.parseBotListResponseSuccessV1=a}),98);
__d("WASmaxInBotBotListResponseSuccessV2",["WAResultOrError","WASmaxInBotEnums","WASmaxInBotIQResultResponseMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"theme");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"background");if(!b.success)return b;var c=d("WASmaxParseUtils").flattenedChildWithTag(a,"primary_text");if(!c.success)return c;var e=d("WASmaxParseUtils").flattenedChildWithTag(a,"secondary_text");if(!e.success)return e;a=d("WASmaxParseUtils").attrStringEnum(a,"mode",d("WASmaxInBotEnums").ENUM_DARK_LIGHT);if(!a.success)return a;b=d("WASmaxParseUtils").contentString(b.value);if(!b.success)return b;c=d("WASmaxParseUtils").contentString(c.value);if(!c.success)return c;e=d("WASmaxParseUtils").contentString(e.value);return!e.success?e:d("WAResultOrError").makeResult({mode:a.value,backgroundElementValue:b.value,primaryTextElementValue:c.value,secondaryTextElementValue:e.value})}function i(a){var b=d("WASmaxParseUtils").assertTag(a,"bot");if(!b.success)return b;b=d("WASmaxParseJid").attrUserJid(a,"jid");if(!b.success)return b;var c=d("WASmaxParseUtils").attrString(a,"persona_id");if(!c.success)return c;var e=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrInt,a,"count");if(!e.success)return e;a=d("WASmaxParseUtils").mapChildrenWithTag(a,"theme",0,2,h);return!a.success?a:d("WAResultOrError").makeResult({jid:b.value,personaId:c.value,count:e.value,theme:a.value})}function j(a){var b=d("WASmaxParseUtils").assertTag(a,"section");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"name");if(!b.success)return b;var c=d("WASmaxParseUtils").attrStringEnum(a,"type",d("WASmaxInBotEnums").ENUM_ALL_CATEGORY_FEATURED);if(!c.success)return c;a=d("WASmaxParseUtils").mapChildrenWithTag(a,"bot",0,Infinity,i);return!a.success?a:d("WAResultOrError").makeResult({name:b.value,type:c.value,bot:a.value})}function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"bot");if(!c.success)return c;var e=d("WASmaxParseUtils").flattenedChildWithTag(c.value,"default");if(!e.success)return e;var f=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,c.value,"v","2");if(!f.success)return f;var g=d("WASmaxParseJid").attrUserJid(e.value,"jid");if(!g.success)return g;e=d("WASmaxParseUtils").attrString(e.value,"persona_id");if(!e.success)return e;a=d("WASmaxInBotIQResultResponseMixin").parseIQResultResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxParseUtils").mapChildrenWithTag(c.value,"section",1,Infinity,j);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({botV:f.value,botDefaultJid:g.value,botDefaultPersonaId:e.value},a.value,{botSection:b.value}))}g.parseBotListResponseSuccessV2BotSectionBotTheme=h;g.parseBotListResponseSuccessV2BotSectionBot=i;g.parseBotListResponseSuccessV2BotSection=j;g.parseBotListResponseSuccessV2=a}),98);
__d("WASmaxOutBotBaseIQGetRequestMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("iq",{id:d("WAWap").generateId(),type:"get"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBaseIQGetRequestMixin=a}),98);
__d("WASmaxOutBotBotListIQMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutBotBaseIQGetRequestMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxOutBotBaseIQGetRequestMixin").mergeBaseIQGetRequestMixin(d("WASmaxJsx").smax("iq",{to:d("WAWap").S_WHATSAPP_NET,xmlns:"bot"}));return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBotListIQMixin=a}),98);
__d("WASmaxOutBotBotListRequest",["WASmaxAttrs","WASmaxJsx","WASmaxOutBotBotListIQMixin","WAWap"],(function(a,b,c,d,e,f,g){function a(a){a=a.botV;a=d("WASmaxOutBotBotListIQMixin").mergeBotListIQMixin(d("WASmaxJsx").smax("iq",null,d("WASmaxJsx").smax("bot",{v:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,a)})));return a}g.makeBotListRequest=a}),98);
__d("WASmaxBotBotListRPC",["WAComms","WASmaxInBotBotListResponseError","WASmaxInBotBotListResponseSuccessV1","WASmaxInBotBotListResponseSuccessV2","WASmaxOutBotBotListRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,c){var e,f,g,h,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:e=d("WASmaxOutBotBotListRequest").makeBotListRequest(a);j.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(e,c));case 3:f=j.sent;g=d("WASmaxInBotBotListResponseSuccessV1").parseBotListResponseSuccessV1(f,e);if(!g.success){j.next=7;break}return j.abrupt("return",{name:"BotListResponseSuccessV1",value:g.value});case 7:h=d("WASmaxInBotBotListResponseSuccessV2").parseBotListResponseSuccessV2(f,e);if(!h.success){j.next=10;break}return j.abrupt("return",{name:"BotListResponseSuccessV2",value:h.value});case 10:i=d("WASmaxInBotBotListResponseError").parseBotListResponseError(f,e);if(!i.success){j.next=13;break}return j.abrupt("return",{name:"BotListResponseError",value:i.value});case 13:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("BotList",{SuccessV1:g,SuccessV2:h,Error:i}));case 14:case"end":return j.stop()}},null,this)}g.sendBotListRPC=a}),98);
__d("WAWebRequestBotList",["WALogger","WASmaxBotBotListRPC","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[bot] requestBotList failed"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[bot] requestBotList failed"]);i=function(){return a};return a}function a(){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WASmaxBotBotListRPC").sendBotListRPC({botV:"2"}));switch(a.name){case"BotListResponseSuccessV1":var b=a.value.botBot;b=b.map(function(a){return{id:d("WAWebWidFactory").createWid(a.jid),isDefault:a["default"]==="true"}});var c=b.filter(function(a){return a.isDefault===!0}).length;if(c!==1){d("WALogger").ERROR(i()).devConsole("[bot] requestBotList response has "+c+" default bots");return[]}return b;case"BotListResponseSuccessV2":c=a.value;var e=c.botDefaultJid;b=c.botSection;var f=[];b.forEach(function(a){a.bot.forEach(function(a){var b=a.jid;a=a.personaId;f.push({id:d("WAWebWidFactory").createWid(b),isDefault:b===e,personaId:a})})});return f;case"BotListResponseError":c=a.value.errorIQErrorInternalServerErrorOrForbiddenOrBadRequestOrNotAllowedMixinGroup.value;b=c.code;a=c.text;d("WALogger").ERROR(h()).devConsole("[bot] requestBotList failed with code "+b+", "+a);return[]}});return j.apply(this,arguments)}g.requestBotList=a}),98);
__d("WAWebBotProfileCategory",["$InternalEnum"],(function(a,b,c,d,e,f){a=b("$InternalEnum")({SYNTHETIC:"synthetic",LIVING:"living",FICTIONAL:"fictional",HISTORICAL:"historical"});f.BotProfileCategory=a}),66);
__d("WAWebRequestBotProfiles",["Promise","WAWebBackendErrors","WAWebBotProfileCategory","WAWebUsync","WAWebUsyncUser","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){var h;function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.length===0)return(h||(h=b("Promise"))).resolve([]);var e=new(d("WAWebUsync").USyncQuery)().withContext("interactive").withMode("query").withBotProfileProtocol();a.forEach(function(a){var b=a.id;a=a.personaId;e.withUser(new(d("WAWebUsyncUser").USyncUser)().withId(b).withPersonaId(a))});a=(yield e.execute());var f=a.error.all||a.error.status;if(f)throw new(d("WAWebBackendErrors").ServerStatusCodeError)(f.errorCode,f.errorText);f=a.list;return!f.length?(h||(h=b("Promise"))).reject(c("err")("no status data returned for user")):f.map(function(a){var b=a.bot;a=a.id;return{id:a,name:b.name,attrs:b.attributes,description:b.description,category:(a=d("WAWebBotProfileCategory").BotProfileCategory.cast(b.category))!=null?a:d("WAWebBotProfileCategory").BotProfileCategory.SYNTHETIC,isDefault:b.isDefault,prompts:b.prompts,personaId:b.personaId,commands:b.commands,commandsDescription:b.commandsDescription}})});return i.apply(this,arguments)}g.requestBotProfiles=a}),98);
__d("WAWebRestoreBotProfilesFromDb",["WALogger","WAWebBotProfileCollection","WAWebSchemaBotProfile","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["restore-bot-profiles: commands parsing failed"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["restore-bot-profiles: commands are not an array"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["restore-bot-profiles: prompts parsing failed"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["restore-bot-profiles: prompts are not an array"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["restore-bot-profiles: invalid id"]);l=function(){return a};return a}function a(){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WAWebSchemaBotProfile").getBotProfileTable().all());a.forEach(function(a){var b;try{b=d("WAWebWidFactory").createUserWid(a.id)}catch(a){d("WALogger").ERROR(l()).sendLogs("restore-bot-profiles: invalid id");return}var c=[];if(a.prompts!=null)try{c=JSON.parse(a.prompts),Array.isArray(c)||(c=[],d("WALogger").ERROR(k()).sendLogs("restore-bot-profiles: prompts are not an array"))}catch(a){d("WALogger").ERROR(j()).sendLogs("restore-bot-profiles: prompts parsing failed")}var e=[];if(a.commands!=null)try{e=JSON.parse(a.commands),Array.isArray(e)||(e=[],d("WALogger").ERROR(i()).sendLogs("restore-bot-profiles: commands are not an array"))}catch(a){d("WALogger").ERROR(h()).sendLogs("restore-bot-profiles: commands parsing failed")}d("WAWebBotProfileCollection").BotProfileCollection.gadd({id:b,name:a.name,attrs:a.attrs,description:a.description,category:a.category,isDefault:a.isDefault,prompts:c,personaId:a.personaId,commands:e})})});return m.apply(this,arguments)}g.restoreBotProfilesFromDb=a}),98);
__d("WAWebInitializeBots",["WALogger","WATimeUtils","WAWebABProps","WAWebBotGating","WAWebCmd","WAWebPersistBotProfiles","WAWebRequestBotList","WAWebRequestBotProfiles","WAWebRestoreBotProfilesFromDb","WAWebRuntimeEnvironmentUtils","WAWebUserPrefsBot","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[bot] initializing bots complete, next fetch at ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[bot] restoring bots from DB"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[bot] requesting bots from server"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[bot] not initializing bots due to feature being disabled"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[bot] skipping bot initialization in worker"]);l=function(){return a};return a}function m(){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(d("WAWebRuntimeEnvironmentUtils").isWorker()){d("WALogger").LOG(l());return}if(!d("WAWebBotGating").isBotEnabled()){d("WALogger").LOG(k());return}var a=d("WAWebUserPrefsBot").getBotListLastRequestedTimestamp(),c=d("WATimeUtils").unixTime(),e=d("WAWebABProps").getABPropConfigValue("bonsai_update_interval"),f;a+e<c?(d("WALogger").LOG(j()),yield o(),f=e):(d("WALogger").LOG(i()),yield d("WAWebRestoreBotProfilesFromDb").restoreBotProfilesFromDb(),f=a+e-c);self.setTimeout(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield m()}),f*1e3);d("WALogger").LOG(h(),c+f)});return n.apply(this,arguments)}function o(){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WAWebRequestBotList").requestBotList());a=(yield d("WAWebRequestBotProfiles").requestBotProfiles(a));yield d("WAWebPersistBotProfiles").persistBotProfiles(a);d("WAWebUserPrefsBot").setBotListLastRequestedTimestamp(d("WATimeUtils").unixTime())});return p.apply(this,arguments)}d("WAWebCmd").Cmd.on("bot_waitlist_state_updated",function(){void m()});d("WAWebCmd").Cmd.on("on_ab_props_update",function(){void m()});d("WAWebCmd").Cmd.on("ab_props_loaded",function(){void m()});g.initializeBots=m}),98);
__d("WAWebMergeContactRecordsById",["WALogger","WAWebModelStorageUtils","WAWebSchemaContact","WAWebUserPrefsIndexedDBStorage","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["mergeContactRecordsById: end migration"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["mergeContactRecordsById: start migration"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["mergeContactRecordsById: migration already complete"]);j=function(){return a};return a}function a(){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield d("WAWebModelStorageUtils").getStorage().lock(["contact","user-prefs"],b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(d("WAWebUserPrefsIndexedDBStorage").userPrefsIdb.get("WAContactMigrationIdComplete")){d("WALogger").LOG(j());return}d("WALogger").LOG(i());var a=(yield d("WAWebSchemaContact").getContactTable().all()).filter(function(a){return a.id.endsWith("@c.us")});yield d("WAWebSchemaContact").getContactTable().bulkCreateOrMerge(a.map(function(a){var b=a.id;a=a.pushname;return{id:d("WAWebWidFactory").createWid(b).toJid(),pushname:a}}));yield d("WAWebSchemaContact").getContactTable().bulkRemove(a.map(function(a){a=a.id;return a}));yield d("WAWebUserPrefsIndexedDBStorage").userPrefsIdb.set("WAContactMigrationIdComplete",!0);d("WALogger").LOG(h())}))});return k.apply(this,arguments)}g.mergeContactRecordsById=a}),98);
__d("WAWebNewsletterMetadataInitFromStorage",["WAJids","WALinkify","WALogger","WAWebBackendApi","WAWebCommonNewsletterEnums","WAWebNewsletterMessageDeliveryUpdateToModelUtils","WAWebNewsletterMetadataCollection","WAWebSchemaNewsletterMetadata","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[init-from-storage]: restoreNewsletterMetadata: complete restoring newsletter metadata"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[init-from-storage]: restoreNewsletterMetadata: start restoring newsletter metadata"]);i=function(){return a};return a}function j(a){switch(a){case 0:return d("WAWebCommonNewsletterEnums").NewsletterMembershipType.Subscriber;case 1:return d("WAWebCommonNewsletterEnums").NewsletterMembershipType.Admin;case 3:return d("WAWebCommonNewsletterEnums").NewsletterMembershipType.Owner;case 2:default:return d("WAWebCommonNewsletterEnums").NewsletterMembershipType.Guest}}function k(a){switch(a){case 0:return d("WAWebCommonNewsletterEnums").NewsletterReactionCodesSetting.All;case 3:return d("WAWebCommonNewsletterEnums").NewsletterReactionCodesSetting.None;case 2:return d("WAWebCommonNewsletterEnums").NewsletterReactionCodesSetting.Blocklist;case 1:default:return d("WAWebCommonNewsletterEnums").NewsletterReactionCodesSetting.Basic}}function l(a){switch(a){case 1:return d("WAWebCommonNewsletterEnums").NewsletterPrivacy.Private;case 0:default:return d("WAWebCommonNewsletterEnums").NewsletterPrivacy.Public}}function a(){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){d("WALogger").DEV(i());try{var a=(yield d("WAWebSchemaNewsletterMetadata").getNewsletterMetadataTable().all());a.forEach(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=d("WAWebWidFactory").createWid(a.id),e={id:b,creationTime:a.creationTime,name:a.name,nameUpdateTime:a.nameUpdateTime,description:a.description,descriptionUpdateTime:a.descriptionUpdateTime,handle:a.handle,inviteCode:a.inviteCode,size:a.size,verified:a.verified,membershipType:j(a.membershipType),reactionCodesSetting:k(a.reactionCodesSetting),privacy:l(a.privacy),website:a.website!=null?d("WALinkify").findLink(a.website):null,adminCount:a.adminCount,suspended:a.suspended,geosuspended:a.geosuspended,terminated:a.terminated};c("WAWebNewsletterMetadataCollection")==null?void 0:c("WAWebNewsletterMetadataCollection").add(e,{merge:!0});if(a.messageDeliveryUpdates!=null){var f=[];a.messageDeliveryUpdates.forEach(function(a,b){return f.push({id:b,code:a.code})});e=(yield d("WAWebNewsletterMessageDeliveryUpdateToModelUtils").getMessageDeliveryUpdatesModelToUpdate(d("WAJids").toNewsletterJid(a.id),f,[]));a=e.modelUpdatesToAdd;yield d("WAWebBackendApi").frontendFireAndForget("updateNewsletterMessageDeliveryUpdate",{id:b,modelUpdatesToAdd:a,modelUpdatesToRemove:[]})}});return function(b){return a.apply(this,arguments)}}())}finally{d("WALogger").DEV(h())}});return m.apply(this,arguments)}g.restoreNewsletterMetadata=a}),98);
__d("WAWebMessageThread",["WACustomError","WALogger","WAPromiseQueue","WAPromiseTimeout","WAWebEventsWaitForOfflineDeliveryEnd","WAWebEventsWaitForReadyForOffline","WAWebOfflineHandler","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Online chat queue MAX_MESSAGE_DELAY exceeded"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Offline chat queue MAX_MESSAGE_DELAY exceeded"]);i=function(){return a};return a}var j=2e4,k={allChatQueue:new((f=d("WAPromiseQueue")).PromiseQueue)(),chatQueue:new f.PromiseQueueMap()},l={allChatQueue:new f.PromiseQueue(),chatQueue:new f.PromiseQueueMap()};function a(a,b,c){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){if(c&&!d("WAWebOfflineHandler").OfflineMessageHandler.isResumeFromRestartComplete())return l.allChatQueue.enqueue(function(){return l.chatQueue.enqueue(a,b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield d("WAWebEventsWaitForReadyForOffline").waitForOfflineProcessReady();return d("WAPromiseTimeout").promiseTimeout(e(),j)["catch"](function(a){if(a instanceof d("WACustomError").TimeoutError)d("WALogger").LOG(i()).tags("messaging");else throw a})}))});yield d("WAWebEventsWaitForOfflineDeliveryEnd").waitForOfflineDeliveryEnd();return k.allChatQueue.enqueue(function(){return k.chatQueue.enqueue(a,function(){return d("WAPromiseTimeout").promiseTimeout(e(),j)["catch"](function(a){if(a instanceof d("WACustomError").TimeoutError)d("WALogger").LOG(h()).tags("messaging");else throw a})})})});return m.apply(this,arguments)}function c(a){a===void 0&&(a=void 0);return a?l.chatQueue.wait(a):l.allChatQueue.wait()}function e(a){a===void 0&&(a=void 0);return a?k.chatQueue.wait(a):k.allChatQueue.wait()}g._online=k;g.handleMessage=a;g.waitForOfflineMsgThread=c;g.waitForOnlineMsgThread=e}),98);
__d("WAWebOfflineResumeConst",["$InternalEnum"],(function(a,b,c,d,e,f){a=b("$InternalEnum").Mirrored(["INIT","RESUME_ON_RESTART","RESUME_WITH_OPEN_TAB","COMPLETE"]);c=2e4;d=100;e=2e3;b=6e4;var g=1e3,h=1e3;f.ResumeStatus=a;f.OFFLINE_STANZA_COUNT_CHECK_TIMEOUT_MS=c;f.OFFLINE_STANZA_COUNT_LIMIT=d;f.OFFLINE_DEVICE_SYNC_DELAY=e;f.OFFLINE_STANZA_TIMEOUT_MS=b;f.OFFLINE_PREVIEW_PERIOD_MS=g;f.UI_UPDATE_TIME_MS=h}),66);
__d("WAWebOfflineResumeTypes.flow",["$InternalEnum"],(function(a,b,c,d,e,f){a=b("$InternalEnum")({Toastbar:"toastbar",ButterBar:"butterbar",None:"none"});f.ResumeUIProgressBarType=a}),66);
__d("WAWebBlockingOfflineResumeManager",["WALogger","WAShiftTimer","WAWebApiPendingDeviceSync","WAWebBackendApi","WAWebBrokerGlobalAppState","WAWebChatThreadLogging","WAWebCmd","WAWebHandleMsgTypes.flow","WAWebHandleOfflineAbProps","WAWebJSHaltDetector","WAWebMessageThread","WAWebOfflineResumeConst","WAWebOfflineResumeTypes.flow","WAWebOfflineResumeUtils","WAWebSignalProtocolStore","WAWebUserPrefsGeneral","WAWebWamEnumWebcScenarioType","WAWebWamOfflineResumeReporter","WAWebWorkerSafeBackendApi","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][blocking] _onOfflineComplete: clearOfflineSnapShot done."]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][blocking] _onOfflineComplete: waitForOfflineMsgThread done, total decryption error: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][blocking]offline resume finished by timeout"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][blocking]: offline session completed by timeout"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][blocking] "," received after offline completion marker. Refreshing window due to potential server issue."]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][blocking] start handling offline stanza"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][blocking] Reject multiple offline preview ib during offline resume, delay ","."]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][blocking] Reject multiple offline preview ibs during offline resume, delay ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][blocking] Accept multiple offline preview ibs during offline resume, delay ","."]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][blocking] start handling offline stanza"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][blocking] restart client due to exceed the LIMIT, message: ",", receipt: ",""]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][blocking] Offline session is complete when receiving offline preview ib."]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][blocking] offline resume stage: "," -> ",""]);t=function(){return a};return a}a=function(){function a(){var a=this;this._offlineCompleteTimer=null;this._progressBarTimer=new(d("WAShiftTimer").ShiftTimer)(function(){d("WAWebCmd").Cmd.handleOfflineProgressUpdate(),a._progressBarTimer.onOrAfter(d("WAWebOfflineResumeConst").UI_UPDATE_TIME_MS)});this._chatsAndMsgsRestored=!1;this._initState()}var e=a.prototype;e._initState=function(){this.offlineMessagePreviewCounter=-1,this._decryptedMessageCount=0,this._decryptionErrorCount=0,this._finishedDownloading=!1,this._hasMessagesToDownload=null,this._status=d("WAWebOfflineResumeConst").ResumeStatus.INIT};e._setStatus=function(a){d("WALogger").LOG(t(),this._status,a),this._status=a};e.processOfflinePreview=function(a){d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.logOfflinePreviewT();if(this.isResumeFromRestartComplete())d("WALogger").LOG(s()),d("WAWebOfflineResumeUtils").exceedResumeWithOpenTabLimit(a.message,a.receipt)&&(d("WALogger").LOG(r(),a.message,a.receipt),d("WAWebOfflineResumeUtils").refreshWindow()),d("WAWebJSHaltDetector").jsHaltDetector.restartDetection(),this._setStatus(d("WAWebOfflineResumeConst").ResumeStatus.RESUME_WITH_OPEN_TAB),d("WAWebBackendApi").frontendFireAndForget("updateChatSortListener",{enable:!1}),self.setTimeout(function(){d("WAWebBackendApi").frontendFireAndForget("updateChatSortListener",{enable:!0})},7e3);else if(this._status===d("WAWebOfflineResumeConst").ResumeStatus.INIT)c("WAWebBrokerGlobalAppState").initOrUpdateTracking(d("WAWebWamEnumWebcScenarioType").WEBC_SCENARIO_TYPE.OFFLINE_RESUME),d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.logOfflineCount(a),this._hasMessagesToDownload=a.message>0,this._finishedDownloading=a.message===0,this.offlineMessagePreviewCounter=a.message,this._decryptedMessageCount=0,this._firstPreviewReceivedT=Date.now(),d("WAWebSignalProtocolStore").enableMemSignalStore(),d("WAWebCmd").Cmd.handleOfflineProgressUpdate(),d("WAWebJSHaltDetector").jsHaltDetector.restartDetection(),this._setStatus(d("WAWebOfflineResumeConst").ResumeStatus.RESUME_ON_RESTART),this._startOfflineCompleteTimer(a.message,a.receipt),this._progressBarTimer.onOrAfter(d("WAWebOfflineResumeConst").UI_UPDATE_TIME_MS),d("WAWebCmd").Cmd.readyForProcessOffline(),d("WALogger").LOG(q());else{var b=this._firstPreviewReceivedT;if(b!=null){b=Date.now()-b;b<d("WAWebOfflineResumeConst").OFFLINE_PREVIEW_PERIOD_MS?(d("WALogger").LOG(p(),b),this.offlineMessagePreviewCounter+=a.message,this._hasMessagesToDownload=this.offlineMessagePreviewCounter>0,this._finishedDownloading=this.offlineMessagePreviewCounter===0,d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.logOfflineCount(a),d("WAWebCmd").Cmd.handleOfflineProgressUpdate()):!c("gkx")("26258")?d("WALogger").ERROR(o(),b).sendLogs("offline-multiple-preview"):d("WALogger").LOG(n(),b)}this._refreshOfflineCompleteTimer()}};e.getOfflineDeliveryProgress=function(){if(this._finishedDownloading)return 100;else if(this.offlineMessagePreviewCounter===-1)return 0;else if(this.offlineMessagePreviewCounter===0)return 100;return Math.min(Math.ceil(100*this._decryptedMessageCount/this.offlineMessagePreviewCounter),100)};e.processOfflineSessionComplete=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b,c=this;a=a;self.setTimeout(function(){d("WAWebBackendApi").frontendFireAndForget("updateChatSortListener",{enable:!0})},3e3);(b=this._offlineCompleteTimer)==null?void 0:b.cancel();this._offlineCompleteTimer=null;d("WAWebCmd").Cmd.readyForProcessOffline();d("WALogger").LOG(m());if(this._status===d("WAWebOfflineResumeConst").ResumeStatus.COMPLETE){d("WAWebHandleOfflineAbProps").isNonBlockingResumeFromOpenTabEnabled()&&(d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.logLastStanzaT(),void d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.commit());return}else if(this._status===d("WAWebOfflineResumeConst").ResumeStatus.RESUME_WITH_OPEN_TAB){yield d("WAWebMessageThread").waitForOnlineMsgThread();yield d("WAWebApiPendingDeviceSync").doPendingDeviceSync();this._setStatus(d("WAWebOfflineResumeConst").ResumeStatus.COMPLETE);return}this._hasMessagesToDownload=a>0;this._finishedDownloading=a===0;this._offlineStanzaCountAfterOfflineMarker=0;self.setTimeout(function(){c._offlineStanzaCountAfterOfflineMarker>d("WAWebOfflineResumeConst").OFFLINE_STANZA_COUNT_LIMIT&&(d("WALogger").WARN(l(),c._offlineStanzaCountAfterOfflineMarker),d("WAWebOfflineResumeUtils").refreshWindow())},d("WAWebOfflineResumeConst").OFFLINE_STANZA_COUNT_CHECK_TIMEOUT_MS);d("WAWebCmd").Cmd.handleOfflineProgressUpdate();this._setStatus(d("WAWebOfflineResumeConst").ResumeStatus.COMPLETE);return this._handleOfflineComplete()});function c(b){return a.apply(this,arguments)}return c}();e.isResumeFromRestartComplete=function(){return this._status!==d("WAWebOfflineResumeConst").ResumeStatus.RESUME_ON_RESTART&&this._status!==d("WAWebOfflineResumeConst").ResumeStatus.INIT};e.isResumeOnSocketDisconnectInProgress=function(){return this._status===d("WAWebOfflineResumeConst").ResumeStatus.RESUME_WITH_OPEN_TAB};e.isResumeFromRestartInProgress=function(){return this._status!==d("WAWebOfflineResumeConst").ResumeStatus.INIT&&!d("WAWebCmd").Cmd.isOfflineDeliveryEnd};e.getHasMessagesToDownload=function(){return this._hasMessagesToDownload};e.getFinishedDownloading=function(){return this.getOfflineDeliveryProgress()===100};e.shouldUseOfflineResumeScreen=function(){return this.offlineMessagePreviewCounter>this._decryptedMessageCount};e.processDecryptResult=function(a){this._refreshOfflineCompleteTimer(),this._decryptedMessageCount+=1,a===d("WAWebHandleMsgTypes.flow").E2EProcessResult.RETRY&&(this._decryptionErrorCount+=1)};e.offlineStanzaReceivedAfterComplete=function(){this.isResumeFromRestartComplete()&&(this._offlineStanzaCountAfterOfflineMarker+=1)};e.newOfflineStanza=function(a,b){this._refreshOfflineCompleteTimer(),d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.logAddOfflineSizeBytes(b),d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.logOldestStanzaTime(a)};e.getResumeUIProgressBarType=function(){return d("WAWebOfflineResumeTypes.flow").ResumeUIProgressBarType.None};e._refreshOfflineCompleteTimer=function(){this._offlineCompleteTimer&&this._offlineCompleteTimer.onOrAfter(d("WAWebOfflineResumeConst").OFFLINE_STANZA_TIMEOUT_MS)};e._startOfflineCompleteTimer=function(a,b){var c,e=this;(c=this._offlineCompleteTimer)==null?void 0:c.cancel();this._offlineCompleteTimer=new(d("WAShiftTimer").ShiftTimer)(function(){e._status!==d("WAWebOfflineResumeConst").ResumeStatus.COMPLETE&&(d("WALogger").LOG(k()),d("WALogger").ERROR(j()).sendLogs("blocking-offline-resume-timeout",.01),e.processOfflineSessionComplete(a+b),e._offlineCompleteTimer=null,d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.logMissedOfflineComplete())});this._offlineCompleteTimer.onOrAfter(d("WAWebOfflineResumeConst").OFFLINE_STANZA_TIMEOUT_MS)};e._handleOfflineComplete=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield d("WAWebMessageThread").waitForOfflineMsgThread(),this._finishedDownloading=!0,d("WAWebCmd").Cmd.handleOfflineProgressUpdate(),d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.logOfflineDecryptionErrorCount(this._decryptionErrorCount),d("WALogger").LOG(i(),this._decryptionErrorCount),this._decryptionErrorCount=0,yield d("WAWebOfflineResumeUtils").clearOfflineSnapShot(),d("WALogger").LOG(h()),d("WAWebSignalProtocolStore").enablePersistSignalStore(),d("WAWebOfflineResumeUtils").runReceiptCleanUpLoop(),d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.logLastStanzaT(),yield d("WAWebOfflineResumeUtils").loadMainScreen({shouldUpdateReceipts:!0,shouldRestoreChatsAndMsgs:!this._chatsAndMsgsRestored}),d("WAWebCmd").Cmd.offlineDeliveryEnd(),d("WAWebUserPrefsGeneral").setOfflinePushCount(0),d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.commit(),d("WAWebWorkerSafeBackendApi").workerSafeFireAndForget("processAllOrphanPaymentNotifications"),d("WAWebChatThreadLogging").uploadChatThreadLoggingEvents(),c("WAWebBrokerGlobalAppState").initOrUpdateTracking(d("WAWebWamEnumWebcScenarioType").WEBC_SCENARIO_TYPE.IDLE),self.setTimeout(function(){d("WAWebApiPendingDeviceSync").doPendingDeviceSync()},d("WAWebOfflineResumeConst").OFFLINE_DEVICE_SYNC_DELAY)});function a(){return a.apply(this,arguments)}return a}();return a}();g.OfflineBlockingResumeStageManager=a}),98);
__d("WAWebThreadMetadata",["WALogger","WAWebBackendApi"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["processOfflineThreadMeta:"]);h=function(){return a};return a}var i=null;function a(a){d("WALogger").DEV(h()).devConsole(a),i=a,d("WAWebBackendApi").frontendFireAndForget("updateChatPreviewT",{threadMeta:a.chatTimestamp})}function b(){return i}function c(){var a;a=(a=i)==null?void 0:a.chatTimestamp;a!=null&&d("WAWebBackendApi").frontendFireAndForget("resetChatPreviewT",{chatIds:Object.keys(a)});i=null}g.setOfflineThreadMeta=a;g.getOfflineThreadMetaPreview=b;g.resetThreadMeta=c}),98);
__d("WAWebNonBlockingOfflineResumeManager",["WALogger","WAShiftTimer","WAWebApiPendingDeviceSync","WAWebBackendApi","WAWebBrokerGlobalAppState","WAWebChatThreadLogging","WAWebCmd","WAWebHandleMsgTypes.flow","WAWebHandleOfflineAbProps","WAWebJSHaltDetector","WAWebMessageThread","WAWebOffdStorageUpdateOfflinePeerReceipts","WAWebOfflineResumeConst","WAWebOfflineResumeTypes.flow","WAWebOfflineResumeUtils","WAWebSignalProtocolStore","WAWebThreadMetadata","WAWebUserPrefsGeneral","WAWebWamEnumWebcScenarioType","WAWebWamOfflineResumeReporter","WAWebWorkerSafeBackendApi","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][non-blocking] _onOfflineComplete: clearOfflineSnapShot done."]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][non-blocking] _onOfflineComplete: waitForOfflineMsgThread done, total decryption error: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][non-blocking] offline resume finished by timeout"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][non-blocking]: offline session completed by timeout"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][non-blocking] "," received after offline completion marker. Refreshing window due to potential server issue."]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][non-blocking] Reject multiple offline preview ib during offline resume, delay ","."]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][non-blocking] Reject multiple offline preview ibs during offline resume, delay ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][non-blocking] Accept multiple offline preview ibs during offline resume, delay ","."]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[resume-from-open-tab] Main screen is loaded"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][non-blocking] restart client due to exceed the LIMIT, message: ",", receipt: ",""]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][non-blocking] Offline session is complete when receiving offline preview ib."]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["[resume-from-open-tab] reset offline delivery end to false"]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["[offline-resume][non-blocking] offline resume stage: "," -> ",""]);t=function(){return a};return a}var u=100;a=function(){function a(a){var b=this;this._offlineCompleteTimer=null;this._progressBarTimer=new(d("WAShiftTimer").ShiftTimer)(function(){d("WAWebCmd").Cmd.handleOfflineProgressUpdate(),b._progressBarTimer.onOrAfter(d("WAWebOfflineResumeConst").UI_UPDATE_TIME_MS)});this._maxProgress=95;(a==null?void 0:a.mainScreenLoaded)&&(this._mainScreenLoaded=!0);this._initState()}var e=a.prototype;e._initState=function(){this.offlineMessagePreviewCounter=-1,this._decryptedMessageCount=0,this._decryptionErrorCount=0,this._finishedDownloading=!1,this._hasMessagesToDownload=null,this._status=d("WAWebOfflineResumeConst").ResumeStatus.INIT};e._setStatus=function(a){d("WALogger").LOG(t(),this._status,a),this._status=a};e.processOfflinePreview=function(a){d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.logOfflinePreviewT();d("WAWebHandleOfflineAbProps").isNonBlockingResumeFromOpenTabEnabled()&&this._mainScreenLoaded&&(d("WALogger").LOG(s()),d("WAWebCmd").Cmd.offlineDeliveryStart());if(this.isResumeFromRestartComplete())d("WALogger").LOG(r()),d("WAWebOfflineResumeUtils").exceedResumeWithOpenTabLimit(a.message,a.receipt)&&(d("WALogger").LOG(q(),a.message,a.receipt),d("WAWebOfflineResumeUtils").refreshWindow()),d("WAWebJSHaltDetector").jsHaltDetector.restartDetection(),this._setStatus(d("WAWebOfflineResumeConst").ResumeStatus.RESUME_WITH_OPEN_TAB),d("WAWebBackendApi").frontendFireAndForget("updateChatSortListener",{enable:!1}),self.setTimeout(function(){d("WAWebBackendApi").frontendFireAndForget("updateChatSortListener",{enable:!0})},7e3);else if(this._status===d("WAWebOfflineResumeConst").ResumeStatus.INIT)c("WAWebBrokerGlobalAppState").initOrUpdateTracking(d("WAWebWamEnumWebcScenarioType").WEBC_SCENARIO_TYPE.OFFLINE_RESUME),d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.logOfflineCount(a),this.offlineMessagePreviewCounter=a.message,this._hasMessagesToDownload=!1,this._finishedDownloading=!0,this._decryptedMessageCount=0,this._firstPreviewReceivedT=Date.now(),d("WAWebSignalProtocolStore").enableMemSignalStore(),d("WAWebCmd").Cmd.handleOfflineProgressUpdate(),d("WAWebJSHaltDetector").jsHaltDetector.restartDetection(),this._progressBarTimer.onOrAfter(d("WAWebOfflineResumeConst").UI_UPDATE_TIME_MS),this._setStatus(d("WAWebOfflineResumeConst").ResumeStatus.RESUME_ON_RESTART),this._startOfflineCompleteTimer(a.message,a.receipt),!this._mainScreenLoaded?this._mainScreenLoadPromise=d("WAWebOfflineResumeUtils").loadMainScreen({}):d("WALogger").LOG(p());else{var b=this._firstPreviewReceivedT;if(b!=null){b=Date.now()-b;b<d("WAWebOfflineResumeConst").OFFLINE_PREVIEW_PERIOD_MS?(d("WALogger").LOG(o(),b),this.offlineMessagePreviewCounter+=a.message,this._hasMessagesToDownload=!1,this._finishedDownloading=!0,d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.logOfflineCount(a)):!c("gkx")("26258")?d("WALogger").ERROR(n(),b).sendLogs("offline-multiple-preview"):d("WALogger").LOG(m(),b)}this._refreshOfflineCompleteTimer()}};e.getOfflineDeliveryProgress=function(){return this.offlineMessagePreviewCounter===0?this._maxProgress:Math.min(Math.ceil(100*this._decryptedMessageCount/this.offlineMessagePreviewCounter),this._maxProgress)};e.processOfflineSessionComplete=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=this;self.setTimeout(function(){d("WAWebBackendApi").frontendFireAndForget("updateChatSortListener",{enable:!0})},3e3);(a=this._offlineCompleteTimer)==null?void 0:a.cancel();this._offlineCompleteTimer=null;if(this._status===d("WAWebOfflineResumeConst").ResumeStatus.COMPLETE){d("WAWebHandleOfflineAbProps").isNonBlockingResumeFromOpenTabEnabled()&&(d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.logLastStanzaT(),void d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.commit());return}else if(this._status===d("WAWebOfflineResumeConst").ResumeStatus.RESUME_WITH_OPEN_TAB){yield d("WAWebMessageThread").waitForOnlineMsgThread();yield d("WAWebApiPendingDeviceSync").doPendingDeviceSync();this._setStatus(d("WAWebOfflineResumeConst").ResumeStatus.COMPLETE);return}else this._status===d("WAWebOfflineResumeConst").ResumeStatus.INIT&&(this._hasMessagesToDownload=!1,this._finishedDownloading=!0,d("WAWebCmd").Cmd.handleOfflineProgressUpdate(),!this._mainScreenLoaded&&!this._mainScreenLoadPromise&&(this._mainScreenLoadPromise=d("WAWebOfflineResumeUtils").loadMainScreen({})));yield this._mainScreenLoadPromise;this._offlineStanzaCountAfterOfflineMarker=0;self.setTimeout(function(){b._offlineStanzaCountAfterOfflineMarker>d("WAWebOfflineResumeConst").OFFLINE_STANZA_COUNT_LIMIT&&(d("WALogger").WARN(l(),b._offlineStanzaCountAfterOfflineMarker),d("WAWebOfflineResumeUtils").refreshWindow())},d("WAWebOfflineResumeConst").OFFLINE_STANZA_COUNT_CHECK_TIMEOUT_MS);this._setStatus(d("WAWebOfflineResumeConst").ResumeStatus.COMPLETE);return this._handleOfflineComplete()});function c(b){return a.apply(this,arguments)}return c}();e.isResumeFromRestartComplete=function(){return this._status!==d("WAWebOfflineResumeConst").ResumeStatus.RESUME_ON_RESTART&&this._status!==d("WAWebOfflineResumeConst").ResumeStatus.INIT};e.isResumeFromRestartInProgress=function(){return this._status!==d("WAWebOfflineResumeConst").ResumeStatus.INIT&&!d("WAWebCmd").Cmd.isOfflineDeliveryEnd};e.isResumeOnSocketDisconnectInProgress=function(){return this._status===d("WAWebOfflineResumeConst").ResumeStatus.RESUME_WITH_OPEN_TAB};e.getHasMessagesToDownload=function(){return this._hasMessagesToDownload};e.getFinishedDownloading=function(){return this.getOfflineDeliveryProgress()===100};e.shouldUseOfflineResumeScreen=function(){return this.offlineMessagePreviewCounter>this._decryptedMessageCount};e.processDecryptResult=function(a){this._refreshOfflineCompleteTimer(),this._decryptedMessageCount+=1,a===d("WAWebHandleMsgTypes.flow").E2EProcessResult.RETRY&&(this._decryptionErrorCount+=1)};e.offlineStanzaReceivedAfterComplete=function(){this.isResumeFromRestartComplete()&&(this._offlineStanzaCountAfterOfflineMarker+=1)};e.newOfflineStanza=function(a,b){d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.logAddOfflineSizeBytes(b),d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.logOldestStanzaTime(a),this._refreshOfflineCompleteTimer()};e.getResumeUIProgressBarType=function(){return!d("WAWebCmd").Cmd.isOfflineDeliveryEnd&&this.offlineMessagePreviewCounter>=u?d("WAWebOfflineResumeTypes.flow").ResumeUIProgressBarType.Toastbar:d("WAWebOfflineResumeTypes.flow").ResumeUIProgressBarType.None};e._refreshOfflineCompleteTimer=function(){this._offlineCompleteTimer&&this._offlineCompleteTimer.onOrAfter(d("WAWebOfflineResumeConst").OFFLINE_STANZA_TIMEOUT_MS)};e._startOfflineCompleteTimer=function(a,b){var c,e=this;(c=this._offlineCompleteTimer)==null?void 0:c.cancel();this._offlineCompleteTimer=new(d("WAShiftTimer").ShiftTimer)(function(){e._status!==d("WAWebOfflineResumeConst").ResumeStatus.COMPLETE&&(d("WALogger").LOG(k()),d("WALogger").ERROR(j()).sendLogs("non-blocking-offline-resume-timeout",.01),e.processOfflineSessionComplete(a+b),e._offlineCompleteTimer=null,d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.logMissedOfflineComplete())});this._offlineCompleteTimer.onOrAfter(d("WAWebOfflineResumeConst").OFFLINE_STANZA_TIMEOUT_MS)};e._handleOfflineComplete=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield d("WAWebMessageThread").waitForOfflineMsgThread(),d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.logOfflineDecryptionErrorCount(this._decryptionErrorCount),d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.logLastStanzaT(),d("WAWebThreadMetadata").resetThreadMeta(),d("WALogger").LOG(i(),this._decryptionErrorCount),this._decryptionErrorCount=0,yield d("WAWebOfflineResumeUtils").clearOfflineSnapShot(),this._maxProgress=97,yield this._mainScreenLoadPromise,yield d("WAWebOffdStorageUpdateOfflinePeerReceipts").updatePeerReceipts(),this._maxProgress=99,d("WALogger").LOG(h()),d("WAWebCmd").Cmd.offlineDeliveryEnd(),d("WAWebUserPrefsGeneral").setOfflinePushCount(0),this._progressBarTimer.forceRunNow(),this._progressBarTimer.cancel(),d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.commit(),d("WAWebSignalProtocolStore").enablePersistSignalStore(),void d("WAWebOfflineResumeUtils").runReceiptCleanUpLoop(),d("WAWebWorkerSafeBackendApi").workerSafeFireAndForget("processAllOrphanPaymentNotifications"),d("WAWebChatThreadLogging").uploadChatThreadLoggingEvents(),c("WAWebBrokerGlobalAppState").initOrUpdateTracking(d("WAWebWamEnumWebcScenarioType").WEBC_SCENARIO_TYPE.IDLE),self.setTimeout(function(){d("WAWebApiPendingDeviceSync").doPendingDeviceSync()},d("WAWebOfflineResumeConst").OFFLINE_DEVICE_SYNC_DELAY)});function a(){return a.apply(this,arguments)}return a}();return a}();g.OfflineNonBlockingResumeStageManager=a}),98);
__d("WAWebOfflineResumeMainThread",["WAWebBlockingOfflineResumeManager","WAWebNonBlockingOfflineResumeManager"],(function(a,b,c,d,e,f,g){function a(a){a.initState({createBlockingStageManager:function(){return new(d("WAWebBlockingOfflineResumeManager").OfflineBlockingResumeStageManager)()},createNonblockingStageManager:function(a){return new(d("WAWebNonBlockingOfflineResumeManager").OfflineNonBlockingResumeStageManager)(a)}})}g.setupMainThreadResume=a}),98);
__d("WAQplNetwork",["WABaseGlobals","WALogger","WAQplTypes","WATimeUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Default Network already init"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["qpl_networkSendEventsOverNetwork, completed Request"]);i=function(){return a};return a}function j(a,b,c){c=c||{};a=new Blob(a,c);c=a;c.name=b;return c}function k(a,b){function c(a){delete a.app_version;delete a.app_build_number;a.wa_ab_key2===void 0&&(a.wa_ab_key2="abkey");return JSON.stringify(a)}return JSON.stringify(a)+"\n"+b.map(c).join("\n")}var l=function(){function a(a){var c;this.$1=(c=(c=a==null?void 0:a.qplEndpoint)!=null?c:(c=d("WABaseGlobals").getQplConfig())==null?void 0:c.endpoint)!=null?c:"";this.$2=(c=(c=a==null?void 0:a.qplAccessToken)!=null?c:(c=d("WABaseGlobals").getQplConfig())==null?void 0:c.accessToken)!=null?c:"";this.$3=(c=(c=a==null?void 0:a.qplAppId)!=null?c:(c=d("WABaseGlobals").getQplConfig())==null?void 0:c.appId)!=null?c:"";this.$4=(c=a==null?void 0:a.isDev)!=null?c:!1;this.$6=(c=a==null?void 0:a.restInterface)!=null?c:{post:function(a,c){return fetch(a,{method:"POST",body:c}).then(function(a){var c,d;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:e.next=2;return b("regeneratorRuntime").awrap(a.text());case 2:c=e.sent;d=a.status;return e.abrupt("return",{status:d,responseText:c});case 5:case"end":return e.stop()}},null,this)})}}}var c=a.prototype;c.sendEventsOverNetwork=function(a){var c,e,f,g,h;return b("regeneratorRuntime").async(function(l){while(1)switch(l.prev=l.next){case 0:c=this.$4?{is_employee:"true"}:{};e=this.$1;f=new FormData();f.append("access_token",this.$2);f.append("app_id",this.$3);this.$5===void 0&&(this.$5=Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString());f.append("user_id",this.$5);f.append("upload_time",d("WATimeUtils").unixTime().toString());f.append("batch_info",JSON.stringify(c));g={};a.forEach(function(a){a.app_version!==void 0&&(g[a.app_version]?g[a.app_version].push(a):g[a.app_version]=[a])});if(!(Object.keys(g).length===0)){l.next=13;break}return l.abrupt("return");case 13:Object.keys(g).map(function(a){return g[a]}).forEach(function(a){var b={app_version:a[0].app_version,app_build_number:a[0].app_build_number};f.append("batches[]",j([k(b,a)],"qpldata.txt"))});l.next=16;return b("regeneratorRuntime").awrap(this.$6.post(e,f));case 16:h=l.sent;d("WALogger").LOG(i()).tags("qpl").devConsole(h);if(!(200!==h.status)){l.next=20;break}throw new(d("WAQplTypes").QplServerStatusCodeError)(h.status,"Failed call to QPL endpoint: "+this.$1+", response: "+h.responseText);case 20:case"end":return l.stop()}},null,this)};return a}(),m;function a(a){m?a&&d("WALogger").WARN(h()):m=new l(a);return m}g.createPayload=k;g.QplNetwork=l;g.defaultQplNetwork=a}),98);
__d("WAQplUploader",["WALogger","WAPromiseDelays","WAPromiseRetryLoop","WAQplTypes","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["QPL Uploader uploadChunk, retriable error: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["QPL Uploader, sending rows ","-",", count ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["QPL Uploader, error during upload session, error: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["QPL Uploader upload session failed, error: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["QPL Uploader, done upload."]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["QPL Uploader, uploading "," rows"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["QPL Uploader, upload triggered, attempt ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["QPL Uploader, sleeping between uploads for "," ms"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["QPL Uploader, sleeping prior to start for "," ms"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["QPL Uploader, start"]);q=function(){return a};return a}var r={minTimeout:1e3,maxTimeout:1e4,retries:5,type:"exponential"},s=100,t={MAX_COUNT:4,MIN_DELAY:1*1e3*60,MAX_DELAY:15*1e3*60},u=5*60,v=24*60*60,w,x,y;function a(a,c){var e,f,g,h,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:w=c.healthLogger;x=c.storageApi;if(!y){j.next=4;break}return j.abrupt("return");case 4:d("WALogger").DEV(q());y={sendEvents:a.sendEvents,isQplEnabled:a.isQplEnabled,startDelayInMs:1e3*((e=a.startDelayInSeconds)!=null?e:u),intervalInMs:1e3*((f=a.intervalInSeconds)!=null?f:v),minRetryDelayInMs:1e3*((g=a.minRetryDelayInSeconds)!=null?g:t.MIN_DELAY),maxRetryDelayInMs:1e3*((h=a.maxRetryDelayInSeconds)!=null?h:t.MAX_DELAY),maxRetryAttemptsCount:(i=a.maxRetryAttemptsCount)!=null?i:t.MAX_COUNT};d("WALogger").DEV(p(),y.startDelayInMs);j.next=9;return b("regeneratorRuntime").awrap(d("WAPromiseDelays").delayMs(y.startDelayInMs));case 9:j.next=11;return b("regeneratorRuntime").awrap(B());case 11:z();case 12:case"end":return j.stop()}},null,this)}function c(){return B()}function z(){d("WALogger").DEV(o(),y.intervalInMs),setTimeout(function(){return b("regeneratorRuntime").async(function(a){while(1)switch(a.prev=a.next){case 0:a.next=2;return b("regeneratorRuntime").awrap(B());case 2:z();case 3:case"end":return a.stop()}},null,this)},y.intervalInMs)}function A(){var a;return b("regeneratorRuntime").async(function(c){while(1)switch(c.prev=c.next){case 0:a=y.minRetryDelayInMs+Math.floor(Math.random()*(y.maxRetryDelayInMs-y.minRetryDelayInMs));c.next=3;return b("regeneratorRuntime").awrap(d("WAPromiseDelays").delayMs(a));case 3:case"end":return c.stop()}},null,this)}function B(a){var c,e,f,g,h,i;return b("regeneratorRuntime").async(function(o){while(1)switch(o.prev=o.next){case 0:a===void 0&&(a=0);if(y.isQplEnabled()){o.next=3;break}return o.abrupt("return");case 3:d("WALogger").DEV(n(),a);o.prev=4;o.next=7;return b("regeneratorRuntime").awrap(x.getRowCount());case 7:c=o.sent,d("WALogger").DEV(m(),c),e=0;case 10:if(!(e<c)){o.next=23;break}o.next=13;return b("regeneratorRuntime").awrap(x.getFromBottom(s));case 13:f=o.sent;o.next=16;return b("regeneratorRuntime").awrap(C(f));case 16:g=f[0].id||0;h=f[f.length-1].id||0;o.next=20;return b("regeneratorRuntime").awrap(x.deleteRange(g,h));case 20:e+=f.length;o.next=10;break;case 23:d("WALogger").DEV(l());o.next=37;break;case 26:o.prev=26;o.t0=o["catch"](4);d("WALogger").DEV(k(),o.t0);if(!(a<y.maxRetryAttemptsCount)){o.next=35;break}o.next=32;return b("regeneratorRuntime").awrap(A());case 32:B(a+1);o.next=37;break;case 35:d("WALogger").ERROR(j(),o.t0).verbose().devConsole(o.t0).sendLogs("QPL Uploader upload session failed"),(i=w)==null?void 0:i.errorUploadingChunk(o.t0);case 37:case"end":return o.stop()}},null,this,[[4,26]])}function C(a){var c;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:c=new(d("WAPromiseRetryLoop").PromiseRetryLoop)({name:"QplUploadChunk",timer:{algo:{type:r.type,first:r.minTimeout},max:r.maxTimeout},code:function(b){var c=a[0].id,e=a[a.length-1].id;d("WALogger").DEV(i(),c,e,a.length);return y.sendEvents(a).then(function(){b()})["catch"](function(a){if(a instanceof d("WAQplTypes").QplServerStatusCodeError)switch(a.statusCode){case 500:d("WALogger").WARN(h(),a.message);break;default:b();break}throw a})}});c.start();e.next=4;return b("regeneratorRuntime").awrap(c.promise());case 4:case"end":return e.stop()}},null,this)}g.start=a;g.forceQplUpload=c}),98);
__d("WAWebWamEnumWebcQplHealthEventType",[],(function(a,b,c,d,e,f){a=Object.freeze({ANNOTATION_SIZE_LIMIT_EXCEEDED:1,MAX_POINT_COUNT_EXCEEDED:2,MAX_MARKER_COUNT_EXCEEDED:3,TOO_MANY_OPEN_MARKERS_TO_WRITE:4,POINT_TO_END_AT_NOT_FOUND:5,JSON_FORMAT_ERROR:6,MAX_STORAGE_EVENT_COUNT_REACHED:7,ERROR_UPLOADING_CHUNK:8,POINT_NAME_TOO_LONG:9,ANNOTATION_KEY_TOO_LONG:10,POINT_DATA_TOO_LONG:11,ERROR_PARSING_CONFIG:12});f.WEBC_QPL_HEALTH_EVENT_TYPE=a}),66);
__d("WAWebWebcQplHealthWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumWebcQplHealthEventType"],(function(a,b,c,d,e,f,g){a=d("WAWebWamCodegenUtils").defineEvents({WebcQplHealth:[3134,{webcQplHealthEventData:[1,d("WAWebWamCodegenUtils").TYPES.STRING],webcQplHealthEventType:[2,d("WAWebWamEnumWebcQplHealthEventType").WEBC_QPL_HEALTH_EVENT_TYPE]},[1,1,1],"regular"]});g.WebcQplHealthWamEvent=a}),98);
__d("WAWebQplHealthLogger",["WALogger","WAWebWamEnumWebcQplHealthEventType","WAWebWebcQplHealthWamEvent"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["QPL errorUploadingChunk, error ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["QPL maxStorageEventCountReached"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["QPL errorParsingConfig, error ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["QPL pointDataTooLong, markerId: ",", instanceKey: ",", data: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["QPL annotationKeyTooLong, markerId: ",", instanceKey: ",", annotationKey: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["QPL pointNameTooLong, markerId: ",", instanceKey: ",", pointName: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["QPL maxPointCountExceeded, markerId: ",", instanceKey: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["QPL annotationSizeLimitExceeded, markerId: ",", instanceKey: ",", annotationKey: ",""]);o=function(){return a};return a}var p=5,q=0;function a(a,b,c){d("WALogger").DEV(o(),a,b,c);if(q++>p)return;a=new(d("WAWebWebcQplHealthWamEvent").WebcQplHealthWamEvent)({webcQplHealthEventType:d("WAWebWamEnumWebcQplHealthEventType").WEBC_QPL_HEALTH_EVENT_TYPE.ANNOTATION_SIZE_LIMIT_EXCEEDED,webcQplHealthEventData:"markerId: "+a+", instanceKey: "+b+", annotationKey: "+c});a.commit()}function b(a,b){d("WALogger").DEV(n(),a,b);if(q++>p)return;a=new(d("WAWebWebcQplHealthWamEvent").WebcQplHealthWamEvent)({webcQplHealthEventType:d("WAWebWamEnumWebcQplHealthEventType").WEBC_QPL_HEALTH_EVENT_TYPE.MAX_POINT_COUNT_EXCEEDED,webcQplHealthEventData:"markerId: "+a+", instanceKey: "+b});a.commit()}function c(a,b,c){d("WALogger").DEV(m(),a,b,c);if(q++>p)return;a=new(d("WAWebWebcQplHealthWamEvent").WebcQplHealthWamEvent)({webcQplHealthEventType:d("WAWebWamEnumWebcQplHealthEventType").WEBC_QPL_HEALTH_EVENT_TYPE.POINT_NAME_TOO_LONG,webcQplHealthEventData:"markerId: "+a+", instanceKey: "+b+", pointName: "+c});a.commit()}function e(a,b,c){d("WALogger").DEV(l(),a,b,c);if(q++>p)return;a=new(d("WAWebWebcQplHealthWamEvent").WebcQplHealthWamEvent)({webcQplHealthEventType:d("WAWebWamEnumWebcQplHealthEventType").WEBC_QPL_HEALTH_EVENT_TYPE.ANNOTATION_KEY_TOO_LONG,webcQplHealthEventData:"markerId: "+a+", instanceKey: "+b+", annotationKey: "+c});a.commit()}function f(a,b,c){d("WALogger").DEV(k(),a,b,c);if(q++>p)return;a=new(d("WAWebWebcQplHealthWamEvent").WebcQplHealthWamEvent)({webcQplHealthEventType:d("WAWebWamEnumWebcQplHealthEventType").WEBC_QPL_HEALTH_EVENT_TYPE.POINT_DATA_TOO_LONG,webcQplHealthEventData:"markerId: "+a+", instanceKey: "+b+", data: "+c});a.commit()}function r(a){d("WALogger").DEV(j(),a);if(q++>p)return;a=new(d("WAWebWebcQplHealthWamEvent").WebcQplHealthWamEvent)({webcQplHealthEventType:d("WAWebWamEnumWebcQplHealthEventType").WEBC_QPL_HEALTH_EVENT_TYPE.ERROR_PARSING_CONFIG,webcQplHealthEventData:"errorString: "+a});a.commit()}function s(){d("WALogger").DEV(i());if(q++>p)return;var a=new(d("WAWebWebcQplHealthWamEvent").WebcQplHealthWamEvent)({webcQplHealthEventType:d("WAWebWamEnumWebcQplHealthEventType").WEBC_QPL_HEALTH_EVENT_TYPE.MAX_STORAGE_EVENT_COUNT_REACHED});a.commit()}function t(a){d("WALogger").DEV(h(),a);if(q++>p)return;a=new(d("WAWebWebcQplHealthWamEvent").WebcQplHealthWamEvent)({webcQplHealthEventType:d("WAWebWamEnumWebcQplHealthEventType").WEBC_QPL_HEALTH_EVENT_TYPE.ERROR_UPLOADING_CHUNK,webcQplHealthEventData:"errorString: "+a});a.commit()}g.annotationSizeLimitExceeded=a;g.maxPointCountExceeded=b;g.pointNameTooLong=c;g.annotationKeyTooLong=e;g.pointDataTooLong=f;g.errorParsingConfig=r;g.maxStorageEventCountReached=s;g.errorUploadingChunk=t}),98);
__d("WAWebApiQplEvents",["WALogger","WAWebABPropsLocalStorage","WAWebBuildConstants","WAWebQplHealthLogger","WAWebQplStorage","asyncToGeneratorRuntime","lodash"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["QPL Storage, error saving events ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["QPL Storage, saved "," rows"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["QPL Storage, error during checking for excessive events ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["QPL Storage, error calling initializeQplStorage, error ",""]);k=function(){return a};return a}var l=200,m=1e5,n=parseInt(d("WAWebBuildConstants").BUILD_ID,10)||0,o=[],p=c("lodash").throttle(function(){return C()},l);function q(a){return function(b){return r(b,a)}}function r(a,b){return{marker_id:a.marker_id,method:a.method,action_id:a.action_id,duration_ns:a.duration_ns,marker_type:a.marker_type,sample_rate:a.sample_rate,points:a.points,instance_id:a.instance_id,metadata:a.metadata||{application_analytics:{time_since_qpl_module_init:0}},flags:a.flags,annotations_bool_array:a.annotations_bool_array,annotations_bool:a.annotations_bool,annotations_double_array:a.annotations_double_array,annotations_double:a.annotations_double,annotations_int_array:a.annotations_int_array,annotations_int:a.annotations_int,annotations_string_array:a.annotations_string_array,annotations:a.annotations,app_version:d("WAWebBuildConstants").VERSION_BASE,app_build_number:n,wa_ab_key2:b}}function s(){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{yield d("WAWebQplStorage").initialize()}catch(a){d("WALogger").ERROR(k(),a).verbose().devConsole(a).sendLogs("QPL Storage init error");throw a}});return t.apply(this,arguments)}function a(a,b){b===void 0&&(b=d("WAWebABPropsLocalStorage").getABKey()||"abkey"),o=o.concat(a.map(q(b))),p()}function e(a,b){b===void 0&&(b=d("WAWebABPropsLocalStorage").getABKey()||"abkey");return a.map(q(b))}function u(a){return v.apply(this,arguments)}function v(){v=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield s();return d("WAWebQplStorage").getQplEventsTable().all({limit:a,offset:0})});return v.apply(this,arguments)}function w(){return x.apply(this,arguments)}function x(){x=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield s();return d("WAWebQplStorage").getQplEventsTable().count()});return x.apply(this,arguments)}function f(){return y.apply(this,arguments)}function y(){y=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield s();return d("WAWebQplStorage").getQplEventsTable().clear(!0)});return y.apply(this,arguments)}function z(a,b){return A.apply(this,arguments)}function A(){A=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){yield s();return d("WAWebQplStorage").getQplEventsTable().bulkDeleteRange(["id"],a-1,b+1).then(function(){})});return A.apply(this,arguments)}var B=null;function C(){return D.apply(this,arguments)}function D(){D=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield s();if(B)B.then(C);else if(o.length>0){var a=o;o=[];try{var b=(yield w());if(b+a.length>m){d("WAWebQplHealthLogger").maxStorageEventCountReached();b=b+a.length-m;yield E(b)}}catch(a){d("WALogger").ERROR(j(),a).verbose().devConsole(a).sendLogs("QPL Storage, error saving events");return}B=d("WAWebQplStorage").getQplEventsTable().bulkCreate(a).then(function(){d("WALogger").DEV(i(),a.length),B=null})["catch"](function(a){d("WALogger").ERROR(h(),a).verbose().devConsole(a).sendLogs("QPL Storage, error saving events"),B=null})}});return D.apply(this,arguments)}function E(a){return F.apply(this,arguments)}function F(){F=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield u(a));var b=a[0].id||0;a=a[a.length-1].id||0;yield z(b,a)});return F.apply(this,arguments)}g.WRITE_THROTTLE_INTERVAL=l;g.add=a;g.createRows=e;g.getFromBottom=u;g.rowCount=w;g.clear=f;g.deleteRange=z}),98);
__d("WAWebQplAbpropsConfigValueProvider",["WAWebABProps"],(function(a,b,c,d,e,f,g){function a(){return d("WAWebABProps").getABPropConfigValue("qpl_enabled")}function b(){return d("WAWebABProps").getABPropConfigValue("qpl_upload_delay")*60}function c(){return d("WAWebABProps").getABPropConfigValue("qpl_sampling_as_string")}function e(){return d("WAWebABProps").getABPropConfigValue("qpl_initial_upload_delay")*60}g.isQplEnabled=a;g.getUploadIntervalInSeconds=b;g.getEventSampling=c;g.getInitialUploadDelayInSeconds=e}),98);
__d("WAWebQplConfig",["WALogger","WAQplConfigTypes","WAWebQplHealthLogger","gkx"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["QPL Config has already been initialized"]);h=function(){return a};return a}var i={sampleRate:0,samplingMethod:d("WAQplConfigTypes").QplSampleMethod.EVENT_BASED_SAMPLING},j={sampleRate:1,samplingMethod:d("WAQplConfigTypes").QplSampleMethod.EVENT_BASED_SAMPLING},k,l,m;function n(){return m.isQplEnabled()}function o(){return m.getUploadIntervalInSeconds()}function p(){return m.getInitialUploadDelayInSeconds()}function q(a){if(!c("gkx")("26258"))return j;a=k.get(a);return a?a:i}function r(){if(c("gkx")("26258"))try{var a=m.getEventSampling();a.indexOf("json:")===0&&(a=a.slice(5));a=JSON.parse(a);a=a.sampling;a.forEach(function(a){var b=a[0],c=a[1];a=Math.max(a[2],0);k.set(b,{sampleRate:a,samplingMethod:c})})}catch(a){d("WAWebQplHealthLogger").errorParsingConfig(a)}}function a(a,b){b===void 0&&(b=!1);!l||b===!0?(k=new Map(),m=a,r(),l={isQplEnabled:n,uploadInterval:o,getEventDetails:q,uploadDelay:p}):d("WALogger").WARN(h()).tags("qpl");return l}g.config=a}),98);
__d("WAWebQplStorageApi",["WAWebApiQplEvents"],(function(a,b,c,d,e,f,g){a=function(){function a(){}var b=a.prototype;b.add=function(a,b){return d("WAWebApiQplEvents").add(a,b)};b.getFromBottom=function(a){return d("WAWebApiQplEvents").getFromBottom(a)};b.getRowCount=function(){return d("WAWebApiQplEvents").rowCount()};b.clear=function(){return d("WAWebApiQplEvents").clear()};b.deleteRange=function(a,b){return d("WAWebApiQplEvents").deleteRange(a,b)};return a}();g.QplStorageApi=a}),98);
__d("WAWebQplValuesConfig",["gkx"],(function(a,b,c,d,e,f,g){a="167028690535322";b="346387865799334";d=a;c("gkx")("26265")&&(d=b);e={accessToken:"1063127757113399|745146ffa34413f9dbb5469f5370b7af",appId:d,endpoint:"https://graph.whatsapp.net/wa_qpl_data"};g.qplConfigs=e}),98);
__d("WAWebQplInitMd",["Promise","WALogger","WAQplNetwork","WAQplUploader","WAWebApiQplEvents","WAWebQplAbpropsConfigValueProvider","WAWebQplConfig","WAWebQplHealthLogger","WAWebQplQuickPerformanceLoggerMarkerIds","WAWebQplQuickPerformanceLoggerModule","WAWebQplStorageApi","WAWebQplValuesConfig","WAWebXHR","gkx"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["QPL is disabled, throwing Killswitch, will clear database"]);i=function(){return a};return a}function a(){var b=babelHelpers.taggedTemplateLiteralLoose(["QPL, got event ",", duration: ","ms, ",""]);a=function(){return b};return b}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["QPL is being initialized"]);j=function(){return a};return a}var k={post:c("WAWebXHR").post};function e(){d("WAQplNetwork").defaultQplNetwork({restInterface:k,isDev:0,qplAccessToken:d("WAWebQplValuesConfig").qplConfigs.accessToken,qplAppId:d("WAWebQplValuesConfig").qplConfigs.appId,qplEndpoint:d("WAWebQplValuesConfig").qplConfigs.endpoint});var a=d("WAWebQplConfig").config(d("WAWebQplAbpropsConfigValueProvider"));if(a.isQplEnabled()){d("WALogger").LOG(j());if(c("gkx")("26256")){var e=new URLSearchParams(window.location.search).get("e2etestname");void d("WAQplUploader").start({sendEvents:function(a){a.forEach(function(a){e!=null&&(a.annotations?a.annotations.e2etestname=e:a.annotations={e2etestname:e})});var b=window.__je2e_recordQPLMarker;b!=null&&typeof b==="function"&&a.forEach(b);return d("WAQplNetwork").defaultQplNetwork().sendEventsOverNetwork(a)},isQplEnabled:function(){return!0},intervalInSeconds:a.uploadInterval(),startDelayInSeconds:a.uploadDelay()},{storageApi:new(d("WAWebQplStorageApi").QplStorageApi)(),healthLogger:d("WAWebQplHealthLogger")})}else d("WAQplUploader").start({isQplEnabled:a.isQplEnabled,sendEvents:function(a){return d("WAQplNetwork").defaultQplNetwork().sendEventsOverNetwork(a)},intervalInSeconds:a.uploadInterval(),startDelayInSeconds:a.uploadDelay()},{storageApi:new(d("WAWebQplStorageApi").QplStorageApi)(),healthLogger:d("WAWebQplHealthLogger")});d("WAWebQplQuickPerformanceLoggerModule").QPL.init(function(a,c){d("WAWebApiQplEvents").add([a]);return(h||(h=b("Promise"))).resolve()},a.getEventDetails,a.isQplEnabled)}else d("WALogger").LOG(i()),d("WAWebQplQuickPerformanceLoggerModule").QPL.throwKillswitch(!0),d("WAWebQplQuickPerformanceLoggerModule").QPL.clearStorage()}g.startQPL=e}),98);
__d("WAWebSubscriptionJob",["WADeprecatedSendIq","WADeprecatedWapParser","WAWap","WAWapDeprecatedSmaxID","WAWebBackendErrors","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h=new(c("WADeprecatedWapParser"))("subscriptionsParser",function(a){a.assertTag("iq");a.assertFromServer();a=a.child("subscriptions");var b=[];a.forEachChildWithTag("subscription",function(a){var c=a.attrString("status"),d=a.maybeAttrInt("subscription_end_time");a=a.attrString("id");b.push({id:a,status:c,expirationDate:d})});return b});function a(){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a;a=(a=d("WAWap")).wap("iq",{xmlns:"fb:thrift_iq",id:a.generateId(),type:"get",smax_id:a.SMAX_ID(c("WAWapDeprecatedSmaxID").QuerySubscription),to:a.S_WHATSAPP_NET});a=(yield d("WADeprecatedSendIq").deprecatedSendIq(a,h));if(a.success)return a.result;throw new(d("WAWebBackendErrors").ServerStatusCodeError)(a.errorCode,a.errorText)});return i.apply(this,arguments)}g.querySubscriptions=a}),98);
__d("WAWebSubscriptions",["WAExponentialBackoff","WALogger","WAPromiseDelays","WAWebBackendErrors","WAWebBizGatingUtils","WAWebPremiumAccessEngine","WAWebSchemaSubscription","WAWebSubscriptionCollection","WAWebSubscriptionJob","WAWebUserPrefsMeUser","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Subscriptions manager, fetch state"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["subscription sync: error PremiumAccessEngine ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Subscriptions manager, got subscriptions: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["subscription sync: error PremiumAccessEngine ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Subscriptions manager, no subscriptions found"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Subscriptions manager, sleeping for "," sec"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Subscriptions manager, non recoverable error, exiting"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Subscriptions manager, will retry in "," ms"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["Subscriptions manager pull failed, error: ",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["Subscriptions manager query failed, retriable error: ",", failCount ",""]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["Subscriptions manager, run"]);r=function(){return a};return a}var s={minTimeout:1e3,maxTimeout:16e3,retries:5,signal:new AbortController().signal},t=86400*1e3;function u(){return v.apply(this,arguments)}function v(){v=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(!d("WAWebBizGatingUtils").subscriptionFetchEnabled())return;try{yield d("WAExponentialBackoff").exponentialBackoff(s,function(a,b){d("WALogger").DEV(r());return y()["catch"](function(c){if(c instanceof d("WAWebBackendErrors").ServerStatusCodeError)switch(c.statusCode){case 500:d("WALogger").WARN(q(),c.message,b);return a(c)}throw c})})}catch(a){d("WALogger").ERROR(p(),a).verbose().devConsole(a).sendLogs("Subscriptions manager run failed");if(a instanceof d("WAWebBackendErrors").ServerStatusCodeError&&a.statusCode===500)d("WALogger").DEV(o(),t);else{d("WALogger").DEV(n());return}}d("WALogger").DEV(m(),t/1e3);yield d("WAPromiseDelays").delayMs(t);d("WAWebUserPrefsMeUser").getMaybeMeUser()&&u()});return v.apply(this,arguments)}function w(a){return x.apply(this,arguments)}function x(){x=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(d("WAWebBizGatingUtils").subscriptionFetchEnabled()){if(a.length===0){d("WALogger").DEV(l());d("WAWebSubscriptionCollection").SubscriptionCollection.reset();try{d("WAWebPremiumAccessEngine").update()}catch(a){d("WALogger").ERROR(k(),a).sendLogs("PremiumAccessEngine")}return}var b=["ACTIVE","FREE_TRIAL","IN_GRACE_PERIOD"];a=a.map(function(a){var c={id:a.id,isAutoRenewing:a.status==="ACTIVE",isDeactivated:!b.includes(a.status),expirationDate:a.expirationDate!==void 0?parseInt(a.expirationDate,10):void 0};a.status==="CANCELED"&&(c.expirationDate||0)>new Date().getTime()/1e3&&(c.isDeactivated=!1);return c});d("WALogger").DEV(j(),JSON.stringify(a));yield d("WAWebSchemaSubscription").getSubscriptionTable().bulkCreateOrMerge(a);d("WAWebSubscriptionCollection").SubscriptionCollection.add(a,{merge:!0});try{d("WAWebPremiumAccessEngine").update()}catch(a){d("WALogger").ERROR(i(),a).sendLogs("PremiumAccessEngine")}}});return x.apply(this,arguments)}function y(){return z.apply(this,arguments)}function z(){z=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(!d("WAWebUserPrefsMeUser").getMaybeMeUser())return;d("WALogger").DEV(h());var a=(yield d("WAWebSubscriptionJob").querySubscriptions());yield w(a)});return z.apply(this,arguments)}g.runSubscriptionsManager=u;g.applySubscriptions=w}),98);
__d("WAWebSyncContactsJob",["WALogger","WANullthrows","WAShiftTimer","WAWebContactSyncApi","WAWebLocalStorage","WAWebSchemaContact","WAWebUserPrefsAppStateSync","WAWebUserPrefsKeys","WAWebUserPrefsMultiDevice","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["sync dirty contacts, found "," contacts to sync"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncNewContact: contact sync failed, error: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["start new contact sync for "," contacts"]);j=function(){return a};return a}var k=86400,l=2e4,m=1e3,n=60,o=null,p=[];function a(a){p.push(a),!o?(o=new(d("WAShiftTimer").ShiftTimer)(function(){if(!d("WAWebUserPrefsMultiDevice").isRegistered())return;var a=p;p=[];o=null;d("WALogger").LOG(j(),a.length).tags("contact-sync");d("WAWebContactSyncApi").syncContactListInChunks({contactIds:a,shouldDelayBetweenChunks:!0})["catch"](function(a){d("WALogger").ERROR(i(),a).verbose().tags("non-sad","contact-sync").sendLogs("syncNewContact: contact sync failed")})}),o.onOrBefore(l)):o.debounce(m)}function q(){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WAWebSchemaContact").getContactTable().equals(["isContactSyncCompleted"],0));a=a.map(function(a){return d("WAWebWidFactory").createWid(a.id)});d("WALogger").LOG(h(),a.length).tags("contact-sync");return d("WAWebContactSyncApi").syncContactListInChunks({contactIds:a,shouldDelayBetweenChunks:!0})});return r.apply(this,arguments)}function e(){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){(yield d("WAWebUserPrefsMultiDevice").getShouldCheckContactSyncStatus())&&self.setTimeout(function(){q()},n*1e3),yield d("WAWebUserPrefsAppStateSync").setShouldCheckContactSyncStatus()});return s.apply(this,arguments)}function f(){var a;a=(a=c("WANullthrows")(c("WAWebLocalStorage")).getItem(d("WAWebUserPrefsKeys").KEYS.CONTACT_SYNC_REFRESH))!=null?a:k;return parseInt(a,10)}g.syncNewContact=a;g.runSyncDirtyContactsJob=e;g.getContactSyncRefreshSeconds=f}),98);
__d("WAWebApiTextStatus",["Promise","WATimeUtils","WAWebModelStorageUtils","WAWebTextStatusGatingUtils","WAWebTextStatusUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function a(){var a=d("WATimeUtils").unixTime();return!d("WAWebTextStatusGatingUtils").receiveTextStatusEnabled()?(h||(h=b("Promise"))).resolve():d("WAWebModelStorageUtils").getStorage().lock(["contact"],function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){b=b[0];var c=(yield b.lessThan(["textStatusExpiryTs"],a));if(!c||c.length===0)return;c=c.map(function(a){return{id:a.id,textStatusString:void 0,textStatusEmoji:void 0,textStatusExpiryTs:void 0,textStatusEphemeralDuration:void 0,textStatusLastUpdateTime:d("WAWebTextStatusUtils").CLEAR_TEXT_STATUS_LAST_UPDATE_TIME_VAL}});return b.bulkCreateOrMerge(c)});return function(a){return c.apply(this,arguments)}}())}g.updateExpiredTextStatusOfContact=a}),98);
__d("WAWebCleanUtmJob",["WAJobOrchestratorTypes","WAPromiseCallSync","WAWebOrchestratorNonPersistedJob","WAWebUtmBizPrefs","WAWebUtmBizUtils"],(function(a,b,c,d,e,f,g){function a(){return d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("cleanExpiredUtm",function(){return h()},{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.BEST_EFFORT}).waitUntilCompleted()}function h(){return d("WAPromiseCallSync").promiseCallSync(function(){var a=d("WAWebUtmBizPrefs").getAllUtmsFromLocalStorage();Object.keys(a).forEach(function(b){var c=a[b];d("WAWebUtmBizUtils").hasUtmExpired(c)&&d("WAWebUtmBizPrefs").removeUtmFromLocalStorage(b)})})}g.cleanExpiredUtmJob=a}),98);
__d("WAWebLidContactsGatingUtils",["WAWebABProps"],(function(a,b,c,d,e,f,g){function a(){return d("WAWebABProps").getABPropConfigValue("allow_lid_contacts_storage")}function b(){return d("WAWebABProps").getABPropConfigValue("allow_share_lid_contacts_vcard")}function c(){return d("WAWebABProps").getABPropConfigValue("allow_lid_contacts_add_to_group")}function e(){return d("WAWebABProps").getABPropConfigValue("allow_lid_contacts_new_1on1_chat")}g.isLidStorageEnabled=a;g.isLidVcardSharingEnabled=b;g.isLidContactAddToGroupEnabled=c;g.isLidContactOneOnOneChatEnabled=e}),98);
__d("WAWebContactSync",["Promise","WABaseGlobals","WALogger","WAServerSync.pb","WASyncdAction","WASyncdActionUtils","WASyncdConst","WASyncdOrphan","WATimeUtils","WAWebApiContact","WAWebBotGating","WAWebContactCollection","WAWebContactShortName","WAWebDeleteStatusAction","WAWebJidUtils","WAWebLidContactsGatingUtils","WAWebSyncContactsJob","WAWebSyncdActionUtils","WAWebUpdateLidMetadataJob","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: added "," contacts, removed "," contacts"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: handler done"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: before pn job"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: handler after save"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: handler after loop"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["contact sync: operation not supported"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["contact sync: malformed mutation"]);o=function(){return a};return a}a=function(a){babelHelpers.inheritsLoose(c,a);function c(){return a.apply(this,arguments)||this}var e=c.prototype;e.getVersion=function(){return 2};e.getAction=function(){return d("WASyncdConst").Actions.Contact};e.applyMutations=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){e===void 0&&(e=!1);var f=[],g=[],p=[],q=d("WAWebLidContactsGatingUtils").isLidStorageEnabled();c=(yield (h||(h=b("Promise"))).all(a.map(function(a){try{var b=a.indexParts;b=b[1];b||d("WAWebSyncdActionUtils").throwInvalidActionIndex();var c=d("WAWebWidFactory").createUserWid(b);if(a.operation==="set"){var e=a.value.contactAction;if(!e){d("WALogger").WARN(o());return{actionState:d("WASyncdConst").SyncActionState.Malformed}}if(c.isUser()&&c.isLid()&&!q)return{actionState:d("WASyncdConst").SyncActionState.Skipped};b={id:b,name:e.fullName||"",shortName:e.firstName||((b=d("WAWebContactShortName").getShortName(e.fullName))!=null?b:""),type:"in",isAddressBookContact:1,isContactSyncCompleted:0};if(c.isUser()&&!c.isLid()&&e.lidJid!=null){e=d("WAWebWidFactory").createUserWid(e.lidJid,"lid");p.push({lid:e,pn:d("WAWebWidFactory").toUserWid(c)})}f.push(b);d("WAWebContactCollection").ContactCollection.add(babelHelpers["extends"]({},b,{id:c}),{merge:!0});d("WAWebSyncContactsJob").syncNewContact(c);return{actionState:d("WASyncdConst").SyncActionState.Success}}if(a.operation==="remove"){if(c.isUser()&&c.isLid()&&!q)return{actionState:d("WASyncdConst").SyncActionState.Skipped};if(d("WAWebBotGating").isBotReceiveEnabled()&&c.isBot())return{actionState:d("WASyncdConst").SyncActionState.Skipped};e=d("WAWebContactCollection").ContactCollection.get(c);e!=null&&e.setNotMyContact();g.push(c);return{actionState:d("WASyncdConst").SyncActionState.Success}}d("WALogger").WARN(n());return{actionState:d("WASyncdConst").SyncActionState.Unsupported}}catch(a){return{actionState:d("WASyncdConst").SyncActionState.Failed}}})));d("WALogger").LOG(m());yield d("WAWebApiContact").createOrMergeAddressBookContacts(f);d("WALogger").LOG(l());e===!0&&(yield d("WABaseGlobals").getDbImpls().writeSyncdLog(d("WASyncdConst").CollectionName.CriticalUnblockLow,"handler after save"));d("WASyncdOrphan").checkOrphanUserStatusMutes(f.map(function(a){return a.id}));if(g.length>0){a=g.map(function(a){return a.isLid()?d("WAWebJidUtils").toLidUserJid(a.user):d("WAWebJidUtils").toPhoneUserJid(a.user)});yield d("WAWebApiContact").setNotAddressBookContacts(a);d("WAWebDeleteStatusAction").clearStatusForRemovedContact()}d("WALogger").LOG(k());void d("WAWebUpdateLidMetadataJob").createLidPnMappingsJob(p,!0);d("WALogger").LOG(j());e===!0&&(yield d("WABaseGlobals").getDbImpls().writeSyncdLog(d("WASyncdConst").CollectionName.CriticalUnblockLow,"handler done"));d("WALogger").DEV(i(),f.length,g.length);return c});function c(b,c,d){return a.apply(this,arguments)}return c}();e.getContactSyncMutation=function(a,b,c,e,f){f===void 0&&(f=!1);var g=d("WATimeUtils").unixTimeMs();c={contactAction:{fullName:(b=b)!=null?b:void 0,firstName:(b=c)!=null?b:void 0,lidJid:e?e.toString({legacy:!0}):void 0}};return d("WASyncdActionUtils").buildPendingMutation({collection:d("WASyncdConst").CollectionName.Regular,indexArgs:[a.toString({legacy:!0})],operation:f?d("WAServerSync.pb").SyncdMutation$SyncdOperation.REMOVE:d("WAServerSync.pb").SyncdMutation$SyncdOperation.SET,version:this.getVersion(),value:c,timestamp:g,action:this.getAction()})};return c}(d("WASyncdAction").SyncActionBase);c=new a();g["default"]=c}),98);
__d("WAWebContactSyncBridge",["WAWebApiContact","WAWebBackendApi","WAWebContactShortName","WAWebContactSync","WAWebDeleteStatusAction","WAWebGetDefaultExport","WAWebSchemaContact","WAWebSyncContactJob","WAWebSyncd","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield d("WAWebSchemaContact").getContactTable().all());if(b.length>0){b=b.map(function(a){return d("WAWebWidFactory").createWid(a.id)}).filter(function(a){return a.isEligibleForUSync()});return d("WAWebSyncContactJob").syncContactListInChunksJob(b,a)}});return h.apply(this,arguments)}function e(a,b,c,d,e){e===void 0&&(e=!1);return i(a,b,c,d,e)}function f(a){return i(a,null,null,null,!0)}function i(a,e,f,g,h){h===void 0&&(h=!1);var i=c("WAWebGetDefaultExport")(b("WAWebContactSync"));i=i.getContactSyncMutation(a,e,f,g,h);var j={id:a.toString({legacy:!0}),name:e||"",shortName:f!=null?(g=d("WAWebContactShortName").getShortName(e))!=null?g:"":"",type:"in",isAddressBookContact:1,isContactSyncCompleted:0};return d("WAWebSyncd").lockForSync(["contact"],[i],function(){return h?d("WAWebApiContact").deleteAddressBookContacts([a.toString()]):d("WAWebApiContact").createOrMergeAddressBookContacts([j])}).then(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){h?(yield d("WAWebApiContact").setNotAddressBookContacts([a.toString({legacy:!0})]),void d("WAWebDeleteStatusAction").clearStatusForRemovedContact()):d("WAWebBackendApi").frontendFireAndForget("addContactToCollection",{contact:babelHelpers["extends"]({},j,{id:a}),option:{merge:!0}})}))}g.contactSync=a;g.sendContactUpdate=e;g.sendContactDelete=f}),98);
__d("WAWebDBPruneExpiredOrphanReactions",["WALogger","WATimeUtils","WAWebABProps","WAWebModelStorageUtils","WAWebSchemaReactions","WAWebSchemaTypes.flow","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["pruneExpiredOrphanReactions: Pruning expired orphan reactions from the Reactions DB"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["bulkDeleteExpiredOrphans: unsupported orphan reason found in the Reactions table ",""]);i=function(){return a};return a}var j=60;function a(){return d("WAWebModelStorageUtils").getStorage().lock(["reactions"],function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a[0];var b=(yield d("WAWebSchemaReactions").getReactionsTable().equals(["orphan"],1)),c=[];b.forEach(function(a){var b=d("WATimeUtils").castToUnixTime(a.timestamp/1e3),e;a.orphanReason===d("WAWebSchemaTypes.flow").OrphanReactionsReasonType.ParentMsgMissing?e=d("WAWebABProps").getABPropConfigValue("reaction_cleanup_days"):a.orphanReason===d("WAWebSchemaTypes.flow").OrphanReactionsReasonType.ParentMsgPlaceholder?e=j:a.orphanReason===d("WAWebSchemaTypes.flow").OrphanReactionsReasonType.ParentMsgFutureproof?e=null:d("WALogger").DEV(i(),a.orphanReason);if(e!=null){b=!d("WATimeUtils").happenedWithin(b,d("WATimeUtils").DAY_SECONDS*e);b&&c.push(a)}});b=c.map(function(a){return[a.parentMsgKey,a.senderUserJid]});if(b.length>0){d("WALogger").DEV(h());return a.bulkRemove(b)}});return function(b){return a.apply(this,arguments)}}())}g.PARENT_MSG_PLACEHOLDER_ORPHAN_THRESHOLD=j;g.pruneExpiredOrphanReactions=a}),98);
__d("WAWebDBPruneInvalidSignalSessions",["Promise","WALogger","WAWebApiContact","WAWebSignal","WAWebUserPrefsGeneral","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["CleanInvalidLidSignalSessions: removed "," sessions"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["CleanInvalidLidSignalSessions: lid contacts (",")"]);j=function(){return a};return a}function a(){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(d("WAWebUserPrefsGeneral").getExistingLidSignalSessionIsCleaned())return;var a=d("WAWebApiContact").getAllLidContacts();d("WALogger").LOG(j(),a.length);var c=0,e=(yield d("WAWebSignal").Session.hasSignalSessions(a));yield (h||(h=b("Promise"))).all(e.map(function(b,e){if(b){c++;return d("WAWebSignal").Session.deleteRemoteInfo(a[e])}}));d("WALogger").LOG(i(),c);d("WAWebUserPrefsGeneral").markExistingLidSignalSessionIsCleaned()});return k.apply(this,arguments)}g.cleanInvalidLidSignalSessions=a}),98);
__d("WAWebDBPurgeExpiredRecords",["Promise","WAWeb-moment","WAWebDBMapOrphansToProviders","WAWebDBOrphanDbSerialization","WAWebMsgType","WAWebSchemaMessage","WAWebSchemaMessageOrphans","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function a(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){a=c("WAWeb-moment")().subtract(a,"days").unix();var f=c("WAWeb-moment")().subtract(e,"days").unix();e=(yield d("WAWebSchemaMessageOrphans").getMessageOrphanTable().between(["t"],0,a));a=new Set(e.map(function(a){return a.parentMsgKey}));a=(yield d("WAWebSchemaMessage").getMessageTable().bulkGet(Array.from(a)));var g=new Set(a.filter(function(a){return a&&a.type===d("WAWebMsgType").MSG_TYPE.UNKNOWN}).map(function(a){return a==null?void 0:a.id}));a=e.filter(function(a){return!g.has(a.parentMsgKey)||a.t<f}).map(d("WAWebDBOrphanDbSerialization").orphanFromDbRow);e=(yield d("WAWebDBMapOrphansToProviders").mapOrphansToProviders(a));var i=[];for(e of e.entries()){var j=e[0],k=e[1];j.onRecordsPurged!=null&&i.push(j.onRecordsPurged(k))}yield (h||(h=b("Promise"))).all(i);j=a.map(function(a){return a.msgKey});return d("WAWebSchemaMessageOrphans").getMessageOrphanTable().bulkRemove(j)});return i.apply(this,arguments)}g.purgeExpiredOrphanRecords=a}),98);
__d("WAWebJobUpdateQPSurfaces",["Promise","WALogger","WATimeUtils","WAWebCTWAConstants","WAWebJobLoadQuickPromotions","WAWebModelStorageUtils","WAWebOrchestratorNonPersistedJob","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["updateQPSurfaces: found duplicated surface"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["updateQPSurfaces: no surfaces"]);j=function(){return a};return a}function k(a){var b;a=(a=a.qpConfigPacing)==null?void 0:a.userInfo;return{impressions:(b=a==null?void 0:a.impressionCount)!=null?b:0,primaryClicks:(b=a==null?void 0:a.primaryClickCount)!=null?b:0,secondaryClicks:(b=a==null?void 0:a.secondaryClickCount)!=null?b:0,dismisses:(b=a==null?void 0:a.dismissClickCount)!=null?b:0}}function l(a,b){var c,d,e,f;a=a.tracking;c=(c=b.qpConfigPacing)==null?void 0:c.userInfo;b=k(b);d=a.dismisses-((d=c==null?void 0:c.dismissClickCount)!=null?d:0);e=a.primaryClicks-((e=c==null?void 0:c.primaryClickCount)!=null?e:0);f=a.secondaryClicks-((f=c==null?void 0:c.secondaryClickCount)!=null?f:0);c=a.impressions-((c=c==null?void 0:c.impressionCount)!=null?c:0);d>0&&(b.dismisses+=d);e>0&&(b.primaryClicks+=e);f>0&&(b.secondaryClicks+=f);c>0&&(b.impressions+=c);d=a.lastImpressionTs;e=a.lastPrimaryClickTs;f=a.lastSecondaryClickTs;c=a.lastDismissTs;d!=null&&(b.lastImpressionTs=d);e!=null&&(b.lastPrimaryClickTs=e);f!=null&&(b.lastSecondaryClickTs=f);c!=null&&(b.lastDismissTs=c);return b}function m(a,b){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){if(a.length===0){d("WALogger").LOG(j());return(h||(h=b("Promise"))).resolve()}var e=a.map(function(a){return a.id}),f=new Set(e);if(f.size!==e.length){d("WALogger").WARN(i());return(h||(h=b("Promise"))).resolve()}var g=new Map();a.forEach(function(a){if(!d("WAWebCTWAConstants").KNOWN_QP_SURFACES.has(a.id))return;a.promotions.forEach(function(b){g.set(b.id,{promotion:b,surfaceId:a.id})})});yield d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("updateQPSurfaces",function(){return d("WAWebModelStorageUtils").getStorage().lock(["quick-promotions"],function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var d=a[0];a=(yield d.anyOf(["surfaceId"],e));a=a.map(function(a){var b=a.id,e=g.get(b);if(e==null)return d.remove(b);a=l(a,e.promotion);e={data:e.promotion,ts:c,tracking:a};g["delete"](b);return d.merge(b,e)});yield (h||(h=b("Promise"))).all(a);a=Array.from(g.values());a=a.map(function(a){var b=a.promotion;a=a.surfaceId;return{id:b.id,surfaceId:a,data:b,ts:c,tracking:k(b)}});yield d.bulkCreate(a)});return function(b){return a.apply(this,arguments)}}())}).waitUntilCompleted();yield d("WAWebJobLoadQuickPromotions").loadQuickPromotions()});return n.apply(this,arguments)}function a(a,b){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){return m(a,b)});return o.apply(this,arguments)}function c(a){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=d("WATimeUtils").unixTime();return m(a,b)});return p.apply(this,arguments)}g.updateQPSurfacesFromNotification=a;g.updateQPSurfacesFromGraphQLFetch=c}),98);
__d("WAWebProtobufsQuickPromotionSurfaces.pb",["$InternalEnum","WAProtoConst"],(function(a,b,c,d,e,f,g){a=b("$InternalEnum")({TRUE:1,FALSE:2,UNKNOWN:3});c=b("$InternalEnum")({PASS_BY_DEFAULT:1,FAIL_BY_DEFAULT:2});e=b("$InternalEnum")({AND:1,OR:2,NOR:3});f={};b={};var h={},i={};f.internalSpec={};b.internalSpec={clauseType:[1,(d=d("WAProtoConst")).FLAGS.REQUIRED|d.TYPES.ENUM,e],clauses:[2,d.FLAGS.REPEATED|d.TYPES.MESSAGE,b],filters:[3,d.FLAGS.REPEATED|d.TYPES.MESSAGE,h]};h.internalSpec={filterName:[1,d.FLAGS.REQUIRED|d.TYPES.STRING],parameters:[2,d.FLAGS.REPEATED|d.TYPES.MESSAGE,i],filterResult:[3,d.TYPES.ENUM,a],clientNotSupportedConfig:[4,d.FLAGS.REQUIRED|d.TYPES.ENUM,c]};i.internalSpec={key:[1,d.TYPES.STRING],value:[2,d.TYPES.STRING]};g.QP$FilterResult=a;g.QP$FilterClientNotSupportedConfig=c;g.QP$ClauseType=e;g.QPSpec=f;g.QP$FilterClauseSpec=b;g.QP$FilterSpec=h;g.QP$FilterParametersSpec=i}),98);
__d("WAWebFetchQuickPromotions",["Promise","WABase64","WACustomError","WALogger","WAPromiseTimeout","WAQplTypes","WAWebBackendApi","WAWebBizGatingUtils","WAWebBuildConstants","WAWebCTWAConstants","WAWebFetchAdAccountToken","WAWebFetchQuickPromotionsQuery.graphql","WAWebFetchQuickPromotionsQuery_QPAction.graphql","WAWebFetchQuickPromotionsQuery_QPCreative.graphql","WAWebFetchQuickPromotionsQuery_QPText.graphql","WAWebFetchQuickPromotionsQuery_QPWAFilter.graphql","WAWebFetchQuickPromotionsQuery_QPWAFilterClause.graphql","WAWebFetchQuickPromotionsQuery_QuickPromotion.graphql","WAWebJobUpdateQPSurfaces","WAWebL10NCountryCodes","WAWebOrchestratorNonPersistedJob","WAWebProtobufsQuickPromotionSurfaces.pb","WAWebQplQuickPerformanceLoggerMarkerIds","WAWebQplQuickPerformanceLoggerModule","WAWebRelayClient","WAWebUserPrefsMeUser","WAWebWebp","err"],(function(a,b,c,d,e,f,g){var h,i,j,k,l,m,n,o;function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["fetchQuickPromotions: failed to decode base64 for dark mode media details"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["fetchQuickPromotions: failed to decode base64 for light mode media details"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["fetchQuickPromotions: received unexpected nux ID ",""]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["fetchQuickPromotions: could not find "," in reverse mapping"]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(['fetchQuickPromotions: failed as "timeout"']);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(['fetchQuickPromotions: failed as "','"']);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["fetchQuickPromotions: success"]);v=function(){return a};return a}var w={type:"error"},x=h!==void 0?h:h=b("WAWebFetchQuickPromotionsQuery.graphql"),y=i!==void 0?i:i=b("WAWebFetchQuickPromotionsQuery_QuickPromotion.graphql"),z=j!==void 0?j:j=b("WAWebFetchQuickPromotionsQuery_QPCreative.graphql"),A=k!==void 0?k:k=b("WAWebFetchQuickPromotionsQuery_QPAction.graphql"),B=l!==void 0?l:l=b("WAWebFetchQuickPromotionsQuery_QPText.graphql"),C=m!==void 0?m:m=b("WAWebFetchQuickPromotionsQuery_QPWAFilterClause.graphql"),D=n!==void 0?n:n=b("WAWebFetchQuickPromotionsQuery_QPWAFilter.graphql");function a(){return!d("WAWebBizGatingUtils").qpGraphQLEnabled()?(o||(o=b("Promise"))).resolve({type:"not-enabled"}):d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("fetchQuickPromotions",function(){return E()}).waitUntilCompleted()}function E(){return d("WAPromiseTimeout").promiseTimeout(F(),d("WAWebCTWAConstants").QP_FETCH_TIMEOUT_MS).then(function(a){if(a.type==="success"){d("WALogger").LOG(v());return d("WAWebJobUpdateQPSurfaces").updateQPSurfacesFromGraphQLFetch(a.quickPromotions).then(function(){return a})}a.type;d("WALogger").WARN(u(),a.type);return a})["catch"](function(a){if(a instanceof d("WACustomError").TimeoutError){d("WAWebQplQuickPerformanceLoggerModule").QPL.markerPoint(d("WAWebQplQuickPerformanceLoggerMarkerIds").QuickLogMarkerId.FETCH_QUICK_PROMOTIONS,"fetch_promotions_end");d("WAWebQplQuickPerformanceLoggerModule").QPL.markerEnd(d("WAWebQplQuickPerformanceLoggerMarkerIds").QuickLogMarkerId.FETCH_QUICK_PROMOTIONS,d("WAQplTypes").QuickLogActionType.ABORTED);d("WALogger").WARN(t());return{type:"timeout"}}throw a})}function F(){d("WAWebQplQuickPerformanceLoggerModule").QPL.markerStart(d("WAWebQplQuickPerformanceLoggerMarkerIds").QuickLogMarkerId.FETCH_QUICK_PROMOTIONS);d("WAWebQplQuickPerformanceLoggerModule").QPL.markerPoint(d("WAWebQplQuickPerformanceLoggerMarkerIds").QuickLogMarkerId.FETCH_QUICK_PROMOTIONS,"fetch_promotions_start");return d("WAWebFetchAdAccountToken").fetchToken().then(function(a){if(a.type==="success")return G(a.token).then(function(a){if(a.type==="success"){d("WAWebQplQuickPerformanceLoggerModule").QPL.markerPoint(d("WAWebQplQuickPerformanceLoggerMarkerIds").QuickLogMarkerId.FETCH_QUICK_PROMOTIONS,"fetch_promotions_end");d("WAWebQplQuickPerformanceLoggerModule").QPL.markerEnd(d("WAWebQplQuickPerformanceLoggerMarkerIds").QuickLogMarkerId.FETCH_QUICK_PROMOTIONS,d("WAQplTypes").QuickLogActionType.SUCCESS);return a}d("WAWebQplQuickPerformanceLoggerModule").QPL.markerPoint(d("WAWebQplQuickPerformanceLoggerMarkerIds").QuickLogMarkerId.FETCH_QUICK_PROMOTIONS,"fetch_promotions_end");d("WAWebQplQuickPerformanceLoggerModule").QPL.markerEnd(d("WAWebQplQuickPerformanceLoggerMarkerIds").QuickLogMarkerId.FETCH_QUICK_PROMOTIONS,d("WAQplTypes").QuickLogActionType.FAIL);a.type==="auth-failure"?d("WAWebFetchAdAccountToken").markTokenAsInvalid():a.type;return a});a.type;return a})}function G(a){return d("WAWebBackendApi").frontendSendAndReceive("getUserLocale").then(function(b){return H(a,b)})}function H(a,c){var e,f=Array.from(d("WAWebBizGatingUtils").qpSurfaceIdsUsingGraphQL());if(f.length===0)return(o||(o=b("Promise"))).resolve({type:"not-enabled"});e=(e=d("WAWebUserPrefsMeUser").getMaybeMeUser())==null?void 0:e.user;if(e==null)return(o||(o=b("Promise"))).resolve({type:"error"});e=d("WAWebL10NCountryCodes").getCountryShortcodeByPhone(e);var g;return d("WAWebRelayClient").fetchQuery(x,{nux_ids:f,trigger_context:{wa_smb_trigger_context:{is_from_wa_smb:!0,app_version:d("WAWebBuildConstants").VERSION_BASE,country:e,locale:c}}},{environmentType:"facebook",accessToken:a,getInlineDataReader:function(a){g=a}}).then(function(a){if(a==null)return w;a=a.quick_promotion_batch_fetch_root;var b=new Map();f.forEach(function(a){var c=M(a);if(c==null){d("WALogger").ERROR(s(),a).sendLogs("quick-promotions-graphql-missing-surface");return}b.set(a,{id:c,promotions:[]})});a.forEach(function(a){var c=a.surface_nux_id;a=a.eligible_promotions;if(c==null||a==null)return;var e=b.get(c);if(e==null){d("WALogger").ERROR(r(),c);return}c=a.edges;c.forEach(function(a){if(a==null)return;var b=a.node,c=a.priority,f=a.time_range,h=a.is_holdout,i=a.log_eligibility_waterfall;a=a.client_ttl_seconds;if(b==null)return;b=g(y,b);var j=b.promotion_id,k=b.creatives,l=b.is_server_force_pass,m=b.content_attributes,n=b.ab_prop_name,o=b.wa_qp_content_attributes_do_not_use,r=b.contextual_filters_for_wa_do_not_use,s=b.surface_delay_in_seconds,t=b.user_interaction_info;b=b.encrypted_logging_data;if(j==null||l==null||m==null||s==null)return;var u=m.wa_eligible_duration_after_impression_in_seconds,v=m.wa_banner_background_color;m=m.wa_primary_cta_alternative_url;if(u==null)return;k=k.map(function(a){return g(z,a)});k=k[0];var w,x,C,D,E;if(k!=null){var F=k.primary_action,G=k.title,H=k.content,I=k.wa_dark_mode_media_details,J=k.wa_light_mode_media_details,L=k.accessibility_text_for_image;if(G==null||H==null)return;x=g(B,G).text;C=g(B,H).text;if(F!=null){G=g(A,F);H=G.title;F=G.url;if(H!=null){G=g(B,H);G.text!=null&&(w={text:G==null?void 0:G.text,deepLink:F,universalLink:m})}}D=k.is_dismissible;if(L!=null){var M;try{(J==null?void 0:J.jpeg_thumbnail)!=null&&(M={elementValue:new Uint8Array(d("WABase64").decodeB64(J.jpeg_thumbnail))})}catch(a){d("WALogger").ERROR(q())}var N;try{(I==null?void 0:I.jpeg_thumbnail)!=null&&(N={elementValue:new Uint8Array(d("WABase64").decodeB64(I.jpeg_thumbnail))})}catch(a){d("WALogger").ERROR(p())}E={description:L,light:M,dark:N}}}if(x==null||C==null||D==null)return;H=v!=null?{lightHighlight:v.light_mode_highlight_color,lightBackground:v.light_mode_background_color,darkHighlight:v.dark_mode_highlight_color,darkBackground:v.dark_mode_background_color}:void 0;G=o.reduce(function(a,b){var c=b.name;b=b.value;if(c==null||b==null)return a;a.push({key:c,value:b});return a},[]);var O;if(t!=null){F=t.dismiss_click_count_for_user;m=t.impression_count_for_user;k=t.primary_click_count_for_user;J=t.secondary_click_count_for_user;I=t.dismiss_max_instances;L=t.impression_max_instances;v=t.primary_click_max_instances;if(m==null||k==null||J==null||F==null||L==null||v==null||I==null)return;O={promotionConfig:{maxImpressions:L,maxDismisses:I,maxPrimaryClicks:v,maxSecondaryClicks:0},userInfo:{impressionCount:m,primaryClickCount:k,secondaryClickCount:J,dismissClickCount:F}}}o=r!=null?K(r,g):void 0;t=b!=null?{elementValue:d("WAWebWebp").stringToUint8(b)}:void 0;L={id:j,qpConfigPriority:c,qpConfigDismissable:D?"true":"false",qpConfigEligibilityDurationMs:u*1e3,qpConfigEndTimeSeconds:f.end,qpConfigExperimentKey:n,qpConfigExposureHoldout:h?"true":"false",qpConfigForcePass:l?"true":"false",qpConfigLogEligibilityWaterfall:i?"true":"false",qpConfigStartTimeSeconds:f.start,qpConfigSurfaceDelayTimeSeconds:s,qpConfigTtlSeconds:a,titleElementValue:x,textElementValue:C,colors:H,contentAttributes:{attribute:G},image:E,primaryAction:w,qpConfigPacing:O,qpConfigFilterRules:o,header:void 0,instanceId:void 0,qpConfigDeterministic:"true",qpConfigImpressionCooldown:-1,qpConfigInstanceLogData:t,qpConfigMaxImpressions:-1,qpConfigTemplateName:"whatsapp_banner",qpConfigTriggersTrigger:[],secondaryAction:void 0};e.promotions.push(L)})});return{type:"success",quickPromotions:Array.from(b.values(),function(a){var b=a.id;a=a.promotions;return{id:b,promotions:[].concat(a)}})}})["catch"](function(a){return d("WAWebFetchAdAccountToken").hasGraphQLAuthError(a)?{type:"auth-failure"}:w})}function I(a){switch(a){case"AND_TYPE":return d("WAWebProtobufsQuickPromotionSurfaces.pb").QP$ClauseType.AND;case"OR_TYPE":return d("WAWebProtobufsQuickPromotionSurfaces.pb").QP$ClauseType.OR;case"NOR_TYPE":return d("WAWebProtobufsQuickPromotionSurfaces.pb").QP$ClauseType.NOR;default:a;throw c("err")("Unexpected future filter clause type")}}function J(a){switch(a){case"PASS":return d("WAWebProtobufsQuickPromotionSurfaces.pb").QP$FilterResult.TRUE;case"FAIL":return d("WAWebProtobufsQuickPromotionSurfaces.pb").QP$FilterResult.FALSE;case"UNKNOWN":return d("WAWebProtobufsQuickPromotionSurfaces.pb").QP$FilterResult.UNKNOWN;default:a;throw c("err")("Unexpected future filter result")}}function K(a,b){var c=b(C,a),d=c.clause_type;c=c.filters;a=a.clauses;if(d==null)return;a=a!=null?a.map(function(a){return K(a,b)}).filter(Boolean):[];c=c.map(function(a){return L(a,b)}).filter(Boolean);d={clauseType:I(d),clauses:a,filters:c};return d}function L(a,b){b=b(D,a);a=b.filter_name;var c=b.parameters,e=b.passes_if_client_not_supported;b=b.filter_result;if(a==null)return;c=c.reduce(function(a,b){var c=b.key;b=b.value;if(c==null||b==null)return a;a.push({key:c,value:b});return a},[]);a={filterName:a,parameters:c,clientNotSupportedConfig:e===!0?d("WAWebProtobufsQuickPromotionSurfaces.pb").QP$FilterClientNotSupportedConfig.PASS_BY_DEFAULT:d("WAWebProtobufsQuickPromotionSurfaces.pb").QP$FilterClientNotSupportedConfig.FAIL_BY_DEFAULT,filterResult:b!=null?J(b):void 0};return a}function M(a){for(var b=d("WAWebCTWAConstants").KNOWN_QP_SURFACES.entries(),c=Array.isArray(b),e=0,b=c?b:b[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f;if(c){if(e>=b.length)break;f=b[e++]}else{e=b.next();if(e.done)break;f=e.value}f=f;var g=f[0];f=f[1];if(f===a)return g}}g.fetchQuickPromotions=a}),98);
__d("WAWebApiPrivacyDisallowedList",["WALogger","WAWebSchemaPrivacyDisallowedList","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["privacy_settings_drawer: get all privacy disallowed lists failed"]);h=function(){return a};return a}function a(){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{var a=(yield d("WAWebSchemaPrivacyDisallowedList").getPrivacyDisallowedListTable().all());return j(a)}catch(a){d("WALogger").ERROR(h()).verbose().devConsole(a).sendLogs("privacy_settings_drawer: get all privacy disallowed lists failed");return{about:null,groupadd:null,last:null,profile:null}}});return i.apply(this,arguments)}function j(a){var b={about:null,groupadd:null,last:null,profile:null};a.forEach(function(a){switch(a.id){case d("WAWebSchemaPrivacyDisallowedList").PrivacyDisallowedListType.About:b.about=a;return;case d("WAWebSchemaPrivacyDisallowedList").PrivacyDisallowedListType.GroupAdd:b.groupadd=a;return;case d("WAWebSchemaPrivacyDisallowedList").PrivacyDisallowedListType.LastSeen:b.last=a;return;case d("WAWebSchemaPrivacyDisallowedList").PrivacyDisallowedListType.ProfilePicture:b.profile=a;return}});return b}g.queryDisallowedLists=a;g.disallowedRowsToLists=j}),98);
__d("WAWebApiPrivacyEphemerality",["WALogger","WAWebSchemaChat","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["ephemerality_daily_logs: retrieving current ephemerality information failed"]);h=function(){return a};return a}function a(){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{var a=(yield d("WAWebSchemaChat").getChatTable().greaterThan(["ephemeralDuration"],0)),b=a.length;a=a.filter(function(a){return a.disappearingModeInitiatedByMe===!0}).length;return{isEphemeralMessagingUser:a>0,countEphemeralThreadsEnabledByMe:a,countEphemeralThreads:b}}catch(a){d("WALogger").ERROR(h()).verbose().devConsole(a).sendLogs("ephemerality_daily_logs: retrieving current ephemerality information failed");return{isEphemeralMessagingUser:null,countEphemeralThreadsEnabledByMe:null,countEphemeralThreads:null}}});return i.apply(this,arguments)}g.queryEphemeralityDailyLogInfo=a}),98);
__d("WAWebCommunityHomeActionWamEvent",["WAWebWamCodegenUtils"],(function(a,b,c,d,e,f,g){b=(a=d("WAWebWamCodegenUtils")).defineEvents({CommunityHomeAction:[3494,{communityHomeGroupDiscoveries:[1,a.TYPES.INTEGER],communityHomeGroupJoins:[2,a.TYPES.INTEGER],communityHomeGroupNavigations:[3,a.TYPES.INTEGER],communityHomeId:[4,a.TYPES.STRING],communityHomeViews:[5,a.TYPES.INTEGER]},[1,1,1],"regular"]});g.CommunityHomeActionWamEvent=b}),98);
__d("WAWebCommunityTabActionWamEvent",["WAWebWamCodegenUtils"],(function(a,b,c,d,e,f,g){b=(a=d("WAWebWamCodegenUtils")).defineEvents({CommunityTabAction:[3496,{communityNoActionTabViews:[4,a.TYPES.INTEGER],communityTabGroupNavigations:[1,a.TYPES.INTEGER],communityTabToHomeViews:[2,a.TYPES.INTEGER],communityTabViews:[3,a.TYPES.INTEGER],communityTabViewsViaContextMenu:[5,a.TYPES.INTEGER]},[1,1,1],"regular"]});g.CommunityTabActionWamEvent=b}),98);
__d("WAWebWamEnumAndroidKeystoreStateType",[],(function(a,b,c,d,e,f){a=Object.freeze({NOT_AVAILABLE:1,SELF_TEST_FAILURE:2,ENC_KEY_READ_FAILURE:3,ENC_KEY_STORED_USED:4,ENC_KEY_PLAIN_DELETED:5,ENC_KEY_PLAIN_RECOVERED:6});f.ANDROID_KEYSTORE_STATE_TYPE=a}),66);
__d("WAWebWamEnumBackupNetworkSetting",[],(function(a,b,c,d,e,f){a=Object.freeze({WIFI_ONLY:0,WIFI_OR_CELLULAR:1});f.BACKUP_NETWORK_SETTING=a}),66);
__d("WAWebWamEnumBackupSchedule",[],(function(a,b,c,d,e,f){a=Object.freeze({OFF:0,DAILY:1,WEEKLY:2,MONTHLY:3,MANUAL:4});f.BACKUP_SCHEDULE=a}),66);
__d("WAWebWamEnumEmailState",[],(function(a,b,c,d,e,f){a=Object.freeze({NOT_ADDED:1,UNVERIFIED:2,VERIFIED:3});f.EMAIL_STATE=a}),66);
__d("WAWebWamEnumNotificationSettingType",[],(function(a,b,c,d,e,f){a=Object.freeze({ALLOWED:1,BLOCKED:2,UNKNOWN:3});f.NOTIFICATION_SETTING_TYPE=a}),66);
__d("WAWebWamEnumPrivacySettingsContactsBuckets",[],(function(a,b,c,d,e,f){a=Object.freeze({B0:1,B1:2,B5:3,B10:4,B15:5,B20:6,B30:7,B40:8,B50:9,B60:10,B70:11,B80:12,B90:13,B100:14});f.PRIVACY_SETTINGS_CONTACTS_BUCKETS=a}),66);
__d("WAWebWamEnumPrivacySettingsValueType",[],(function(a,b,c,d,e,f){a=Object.freeze({NOBODY:1,ONLY_SHARE_WITH:2,MY_CONTACTS:3,MY_CONTACTS_EXCEPT:4,EVERYONE:5});f.PRIVACY_SETTINGS_VALUE_TYPE=a}),66);
__d("WAWebDailyWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumAndroidKeystoreStateType","WAWebWamEnumBackupNetworkSetting","WAWebWamEnumBackupSchedule","WAWebWamEnumEmailState","WAWebWamEnumMediaQuality","WAWebWamEnumNotificationSettingType","WAWebWamEnumPrivacySettingsContactsBuckets","WAWebWamEnumPrivacySettingsValueType"],(function(a,b,c,d,e,f,g){e=(a=d("WAWebWamCodegenUtils")).defineEvents({Daily:[1158,{accessibilityVoiceover:[108,a.TYPES.BOOLEAN],addressbookSize:[11,a.TYPES.INTEGER],addressbookWhatsappSize:[12,a.TYPES.INTEGER],androidAdvertisingId:[135,a.TYPES.STRING],androidKeystoreState:[139,d("WAWebWamEnumAndroidKeystoreStateType").ANDROID_KEYSTORE_STATE_TYPE],androidXmppWorkersRuntime:[167,a.TYPES.INTEGER],appCodeHash:[103,a.TYPES.STRING],appStandbyBucket:[121,a.TYPES.INTEGER],autoDlAudioCellular:[90,a.TYPES.BOOLEAN],autoDlAudioRoaming:[91,a.TYPES.BOOLEAN],autoDlAudioWifi:[89,a.TYPES.BOOLEAN],autoDlDocCellular:[96,a.TYPES.BOOLEAN],autoDlDocRoaming:[97,a.TYPES.BOOLEAN],autoDlDocWifi:[95,a.TYPES.BOOLEAN],autoDlImageCellular:[87,a.TYPES.BOOLEAN],autoDlImageRoaming:[88,a.TYPES.BOOLEAN],autoDlImageWifi:[86,a.TYPES.BOOLEAN],autoDlVideoCellular:[93,a.TYPES.BOOLEAN],autoDlVideoRoaming:[94,a.TYPES.BOOLEAN],autoDlVideoWifi:[92,a.TYPES.BOOLEAN],backupNetworkSetting:[10,d("WAWebWamEnumBackupNetworkSetting").BACKUP_NETWORK_SETTING],backupRestoreEncryptionVersion:[138,a.TYPES.INTEGER],backupSchedule:[9,d("WAWebWamEnumBackupSchedule").BACKUP_SCHEDULE],channelsMediaFolderSize:[186,a.TYPES.INTEGER],chatDatabaseSize:[19,a.TYPES.INTEGER],chatLockFolderCount:[168,a.TYPES.INTEGER],countEphemeralThreads:[181,a.TYPES.INTEGER],countEphemeralThreadsEnabledByMe:[182,a.TYPES.INTEGER],defaultDisappearingDuration:[140,a.TYPES.INTEGER],deviceLanguage:[153,a.TYPES.STRING],emailState:[174,d("WAWebWamEnumEmailState").EMAIL_STATE],entSecurityNotificationsEnabled:[134,a.TYPES.BOOLEAN],experimentTmoPreloadGroupDaily:[166,a.TYPES.INTEGER],favoritedAnimatedStickerCount:[113,a.TYPES.INTEGER],favoritedFirstPartyStickerCount:[112,a.TYPES.INTEGER],favoritedTotalStickerCount:[111,a.TYPES.INTEGER],hasTextstatusEmojiModified24h:[175,a.TYPES.BOOLEAN],hasTextstatusModified24h:[176,a.TYPES.BOOLEAN],hasTextstatusTextModified24h:[177,a.TYPES.BOOLEAN],hasUsername:[187,a.TYPES.BOOLEAN],installedAnimatedStickerPackCount:[116,a.TYPES.INTEGER],installedAnimatedThirdPartyStickerPackCount:[137,a.TYPES.INTEGER],installedFirstPartyStickerPackCount:[115,a.TYPES.INTEGER],installedTotalStickerPackCount:[114,a.TYPES.INTEGER],ipStr:[122,a.TYPES.STRING],isDefaultDisappearingMessagingUser:[183,a.TYPES.BOOLEAN],isEphemeralMessagingUser:[184,a.TYPES.BOOLEAN],keyboardLanguage:[154,a.TYPES.STRING],languageCode:[5,a.TYPES.STRING],lastCloudBackupSize:[185,a.TYPES.INTEGER],locationCode:[6,a.TYPES.STRING],lockFolderHidden:[171,a.TYPES.BOOLEAN],lowestAppStandbyBucket:[160,a.TYPES.INTEGER],mdPairTime:[124,a.TYPES.INTEGER],mediaFolderFileCount:[21,a.TYPES.INTEGER],mediaFolderSize:[20,a.TYPES.INTEGER],mediaQualitySetting:[188,d("WAWebWamEnumMediaQuality").MEDIA_QUALITY],modifiedInternalProps:[155,a.TYPES.BOOLEAN],networkIsRoaming:[7,a.TYPES.BOOLEAN],networkOperatorName:[159,a.TYPES.STRING],numAccounts:[163,a.TYPES.INTEGER],numContactsWithTextstatus24h:[178,a.TYPES.INTEGER],numContactsWithTextstatusEmoji24h:[179,a.TYPES.INTEGER],numContactsWithTextstatusText24h:[180,a.TYPES.INTEGER],osBuildNumber:[4,a.TYPES.STRING],osNotificationSetting:[118,d("WAWebWamEnumNotificationSettingType").NOTIFICATION_SETTING_TYPE],packageName:[102,a.TYPES.STRING],passkeyExists:[165,a.TYPES.BOOLEAN],paymentsIsEnabled:[100,a.TYPES.BOOLEAN],permissionAccessCoarseLocation:[57,a.TYPES.INTEGER],permissionAccessFineLocation:[58,a.TYPES.INTEGER],permissionCamera:[56,a.TYPES.INTEGER],permissionContacts:[104,a.TYPES.BOOLEAN],permissionReadExternalStorage:[53,a.TYPES.INTEGER],permissionRecordAudio:[55,a.TYPES.INTEGER],phoneCores:[156,a.TYPES.INTEGER],phoneyid:[162,a.TYPES.STRING],privacySettingsAbout:[141,(b=d("WAWebWamEnumPrivacySettingsValueType")).PRIVACY_SETTINGS_VALUE_TYPE],privacySettingsAboutExceptNum:[142,(c=d("WAWebWamEnumPrivacySettingsContactsBuckets")).PRIVACY_SETTINGS_CONTACTS_BUCKETS],privacySettingsGroups:[143,b.PRIVACY_SETTINGS_VALUE_TYPE],privacySettingsGroupsExceptNum:[144,c.PRIVACY_SETTINGS_CONTACTS_BUCKETS],privacySettingsLastSeen:[145,b.PRIVACY_SETTINGS_VALUE_TYPE],privacySettingsLastSeenExceptNum:[146,c.PRIVACY_SETTINGS_CONTACTS_BUCKETS],privacySettingsProfilePhoto:[147,b.PRIVACY_SETTINGS_VALUE_TYPE],privacySettingsProfilePhotoExceptNum:[148,c.PRIVACY_SETTINGS_CONTACTS_BUCKETS],privacySettingsStatus:[150,b.PRIVACY_SETTINGS_VALUE_TYPE],privacySettingsStatusExceptNum:[151,c.PRIVACY_SETTINGS_CONTACTS_BUCKETS],privacySettingsStatusShareNum:[152,c.PRIVACY_SETTINGS_CONTACTS_BUCKETS],receiptsEnabled:[8,a.TYPES.BOOLEAN],secretCodeActive:[172,a.TYPES.BOOLEAN],showMetaAiButtonSetting:[173,a.TYPES.BOOLEAN],simMcc:[2,a.TYPES.INTEGER],simMnc:[3,a.TYPES.INTEGER],storageAvailSize:[31,a.TYPES.INTEGER],storageTotalSize:[32,a.TYPES.INTEGER],supportedDecoders:[169,a.TYPES.STRING],supportedEncoders:[170,a.TYPES.STRING],videoFolderFileCount:[23,a.TYPES.INTEGER],videoFolderSize:[22,a.TYPES.INTEGER]},[1,1,1],"regular"]});g.DailyWamEvent=e}),98);
__d("WAWebDbUsageApiUtils",["Promise","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f){var g;function a(a){return a!=null&&a!==0?Math.round(a/1e6).toString():"0"}function h(a){return new(g||(g=b("Promise")))(function(b,c){a.onsuccess=function(a){b(a.target.result)},a.onerror=function(a){c(a.target.result)}})}function c(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield h(a.open("__dbnames")));a=a.transaction(a.objectStoreNames,"readonly");a=a.objectStore(a.objectStoreNames[0]);a=(yield h(a.getAll()));return a});return i.apply(this,arguments)}function d(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=(yield h(a.open(b)));return a});return j.apply(this,arguments)}function e(a,c){return new(g||(g=b("Promise")))(function(b,d){var e=a.openCursor(null,"prev");e.onsuccess=function(a){a=a.target.result;a&&c(a.value)?a["continue"]():b()};e.onerror=function(a){d(a.target.result)}})}f.convertToMBToString=a;f.promisifyRequest=h;f.getAllDatabases=c;f.getDatabase=d;f.objectStoreIterator=e}),66);
__d("WAWebScanDbRowApi",["WAWebMsgType"],(function(a,b,c,d,e,f,g){var h=new Set([(e=d("WAWebMsgType")).MSG_TYPE.AUDIO,e.MSG_TYPE.CHAT,e.MSG_TYPE.DOCUMENT,e.MSG_TYPE.GROUPS_V4_INVITE,e.MSG_TYPE.HSM,e.MSG_TYPE.IMAGE,e.MSG_TYPE.INTERACTIVE,e.MSG_TYPE.LIST,e.MSG_TYPE.LOCATION,e.MSG_TYPE.MULTI_VCARD,e.MSG_TYPE.ORDER,e.MSG_TYPE.PAYMENT,e.MSG_TYPE.PRODUCT,e.MSG_TYPE.PTT,e.MSG_TYPE.STICKER,e.MSG_TYPE.TEMPLATE_BUTTON_REPLY,e.MSG_TYPE.VCARD,e.MSG_TYPE.VIDEO]);function a(a,b){if(b==="lru-media-meta-info"){b=0;a.size&&typeof a.size==="number"&&(b+=a.size);b+=i(a);return b}return i(a)}function b(a,b){return b==="message"&&!h.has(a.type)?!0:!1}function c(a,b,c){return b==="lru-media-meta-info"&&c==="lru-media-storage-idb"?1:a}function i(a){var b=0;JSON.stringify(a,function(a,c){typeof a==="string"&&(b+=2*a.length);if(c instanceof ArrayBuffer)b+=c.byteLength;else if(c instanceof Blob)b+=c.size;else if(typeof c==="number")b+=8;else if(typeof c==="boolean")b+=1;else if(typeof c==="string")b+=2*c.length;else return c});return b}g.estimateSize=a;g.skipRow=b;g.getSampleRateOverride=c}),98);
__d("WAWebEstimateFtsStorageApi",["Promise","WALogger","WANullthrows","WAWebDbUsageApiUtils","WAWebIndexedDB","WAWebScanDbRowApi","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Estimated FTS "," size: "," KB, fetched rows: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Estimated FTS size: "," KB, fetched rows: "," took: "," ms"]);j=function(){return a};return a}var k="fts-storage",l=15e3;function a(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a===void 0?{sampleRows:l}:a;a=a.sampleRows;var e=Date.now(),f=a;a=c("WANullthrows")(c("WAWebIndexedDB"));a=(yield d("WAWebDbUsageApiUtils").getDatabase(a,k));var g=a.transaction(a.objectStoreNames,"readonly"),m=0,n=0;a=function*(a){var b=g.objectStore(a),c=(yield d("WAWebDbUsageApiUtils").promisifyRequest(b.count()));if(c===0)return"continue";var e=Math.min(f,c);n=e;var h=0;yield d("WAWebDbUsageApiUtils").objectStoreIterator(b,function(b){h+=d("WAWebScanDbRowApi").estimateSize(b,a);n--;return n>0});b=Math.round(h*(c/(e-n)));m+=b;d("WALogger").DEV(i(),a,b/1e3,e-n)};for(var o of g.objectStoreNames){var p=(yield* a(o));if(p==="continue")continue}p=Date.now()-e;d("WALogger").DEV(j(),m/1e3,n,p);return(h||(h=b("Promise"))).resolve(m)});return m.apply(this,arguments)}g.getEstimatedFTSDbSize=a}),98);
__d("WAWebKeepInChatNotifWamEvent",["WAWebWamCodegenUtils"],(function(a,b,c,d,e,f,g){b=(a=d("WAWebWamCodegenUtils")).defineEvents({KeepInChatNotif:[3484,{kicGroupNotificationTaps:[3,a.TYPES.INTEGER],kicGroupNotifications:[4,a.TYPES.INTEGER],kicNotificationTaps:[5,a.TYPES.INTEGER],kicNotifications:[6,a.TYPES.INTEGER]},[1,1,1],"regular"]});g.KeepInChatNotifWamEvent=b}),98);
__d("WAWebWamEnumInAppNotificationAlertStyle",[],(function(a,b,c,d,e,f){a=Object.freeze({NONE:1,BANNERS:2,ALERTS:3});f.IN_APP_NOTIFICATION_ALERT_STYLE=a}),66);
__d("WAWebWamEnumNotificationSoundTone",[],(function(a,b,c,d,e,f){a=Object.freeze({DEFAULT:1,CUSTOM:2});f.NOTIFICATION_SOUND_TONE=a}),66);
__d("WAWebNotificationSettingWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumInAppNotificationAlertStyle","WAWebWamEnumNotificationSoundTone"],(function(a,b,c,d,e,f,g){b=(a=d("WAWebWamCodegenUtils")).defineEvents({NotificationSetting:[3684,{groupReactionNotification:[1,a.TYPES.BOOLEAN],groupShowNotification:[2,a.TYPES.BOOLEAN],groupSoundTone:[3,d("WAWebWamEnumNotificationSoundTone").NOTIFICATION_SOUND_TONE],inAppNotificationAlertStyle:[4,d("WAWebWamEnumInAppNotificationAlertStyle").IN_APP_NOTIFICATION_ALERT_STYLE],inAppNotificationSound:[5,a.TYPES.BOOLEAN],inAppNotificationVibrate:[6,a.TYPES.BOOLEAN],messageReactionNotification:[7,a.TYPES.BOOLEAN],messageShowNotification:[8,a.TYPES.BOOLEAN],messageSoundTone:[9,d("WAWebWamEnumNotificationSoundTone").NOTIFICATION_SOUND_TONE],offlineNotification:[11,a.TYPES.BOOLEAN],showPreview:[10,a.TYPES.BOOLEAN]},[1,1,1],"regular"]});g.NotificationSettingWamEvent=b}),98);
__d("WAWebPnhDailyCtwaWamEvent",["WAWebWamCodegenUtils"],(function(a,b,c,d,e,f,g){b=(a=d("WAWebWamCodegenUtils")).defineEvents({PnhDailyCtwa:[4280,{matMessagesReceived:[1,a.TYPES.INTEGER],threadDs:[3,a.TYPES.STRING],threadId:[2,a.TYPES.STRING]},[1,1,1],"regular"]});g.PnhDailyCtwaWamEvent=b}),98);
__d("WAWebPnhDailyWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumTypeOfGroupEnum"],(function(a,b,c,d,e,f,g){b=(a=d("WAWebWamCodegenUtils")).defineEvents({PnhDaily:[3806,{communityId:[1,a.TYPES.STRING],mappingMissing:[7,a.TYPES.INTEGER],pnhIndicatorClicksChat:[2,a.TYPES.INTEGER],pnhIndicatorClicksInfoScreen:[3,a.TYPES.INTEGER],reactionDeleteCount:[4,a.TYPES.INTEGER],reactionOpenTrayCount:[5,a.TYPES.INTEGER],totalContacts:[8,a.TYPES.INTEGER],typeOfGroup:[6,d("WAWebWamEnumTypeOfGroupEnum").TYPE_OF_GROUP_ENUM]},[1,1,1],"regular"]});g.PnhDailyWamEvent=b}),98);
__d("WAWebWamEnumPrivacyHighlightCategoryEnum",[],(function(a,b,c,d,e,f){a=Object.freeze({E2EE:0});f.PRIVACY_HIGHLIGHT_CATEGORY_ENUM=a}),66);
__d("WAWebPrivacyHighlightDailyWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumPrivacyHighlightCategoryEnum","WAWebWamEnumPrivacyHighlightSurfaceEnum"],(function(a,b,c,d,e,f,g){b=(a=d("WAWebWamCodegenUtils")).defineEvents({PrivacyHighlightDaily:[3522,{dialogAppearCount:[1,a.TYPES.INTEGER],dialogSelectCount:[2,a.TYPES.INTEGER],narrativeAppearCount:[3,a.TYPES.INTEGER],privacyHighlightCategory:[4,d("WAWebWamEnumPrivacyHighlightCategoryEnum").PRIVACY_HIGHLIGHT_CATEGORY_ENUM],privacyHighlightSurface:[5,d("WAWebWamEnumPrivacyHighlightSurfaceEnum").PRIVACY_HIGHLIGHT_SURFACE_ENUM]},[1,1,1],"regular"]});g.PrivacyHighlightDailyWamEvent=b}),98);
__d("WAWebPttDailyWamEvent",["WAWebWamCodegenUtils"],(function(a,b,c,d,e,f,g){b=(a=d("WAWebWamCodegenUtils")).defineEvents({PttDaily:[2938,{pttCancelBroadcast:[9,a.TYPES.INTEGER],pttCancelGroup:[8,a.TYPES.INTEGER],pttCancelIndividual:[7,a.TYPES.INTEGER],pttCancelInterop:[42,a.TYPES.INTEGER],pttCancelNewsletter:[32,a.TYPES.INTEGER],pttDraftReviewBroadcast:[15,a.TYPES.INTEGER],pttDraftReviewGroup:[14,a.TYPES.INTEGER],pttDraftReviewIndividual:[13,a.TYPES.INTEGER],pttDraftReviewInterop:[43,a.TYPES.INTEGER],pttDraftReviewNewsletter:[33,a.TYPES.INTEGER],pttFastplaybackBroadcast:[21,a.TYPES.INTEGER],pttFastplaybackGroup:[20,a.TYPES.INTEGER],pttFastplaybackIndividual:[19,a.TYPES.INTEGER],pttFastplaybackInterop:[44,a.TYPES.INTEGER],pttFastplaybackNewsletter:[34,a.TYPES.INTEGER],pttLockBroadcast:[12,a.TYPES.INTEGER],pttLockGroup:[11,a.TYPES.INTEGER],pttLockIndividual:[10,a.TYPES.INTEGER],pttLockInterop:[45,a.TYPES.INTEGER],pttLockNewsletter:[35,a.TYPES.INTEGER],pttOutOfChatBroadcast:[29,a.TYPES.INTEGER],pttOutOfChatGroup:[30,a.TYPES.INTEGER],pttOutOfChatIndividual:[31,a.TYPES.INTEGER],pttOutOfChatInterop:[46,a.TYPES.INTEGER],pttOutOfChatNewsletter:[36,a.TYPES.INTEGER],pttPausedRecordBroadcast:[22,a.TYPES.INTEGER],pttPausedRecordGroup:[23,a.TYPES.INTEGER],pttPausedRecordIndividual:[24,a.TYPES.INTEGER],pttPausedRecordInterop:[47,a.TYPES.INTEGER],pttPausedRecordNewsletter:[37,a.TYPES.INTEGER],pttPlaybackBroadcast:[18,a.TYPES.INTEGER],pttPlaybackGroup:[17,a.TYPES.INTEGER],pttPlaybackIndividual:[16,a.TYPES.INTEGER],pttPlaybackInterop:[48,a.TYPES.INTEGER],pttPlaybackNewsletter:[38,a.TYPES.INTEGER],pttRecordBroadcast:[3,a.TYPES.INTEGER],pttRecordGroup:[2,a.TYPES.INTEGER],pttRecordIndividual:[1,a.TYPES.INTEGER],pttRecordInterop:[49,a.TYPES.INTEGER],pttRecordNewsletter:[39,a.TYPES.INTEGER],pttSendBroadcast:[6,a.TYPES.INTEGER],pttSendGroup:[5,a.TYPES.INTEGER],pttSendIndividual:[4,a.TYPES.INTEGER],pttSendInterop:[50,a.TYPES.INTEGER],pttSendNewsletter:[40,a.TYPES.INTEGER],pttStopTapBroadcast:[25,a.TYPES.INTEGER],pttStopTapGroup:[26,a.TYPES.INTEGER],pttStopTapIndividual:[27,a.TYPES.INTEGER],pttStopTapInterop:[51,a.TYPES.INTEGER],pttStopTapNewsletter:[41,a.TYPES.INTEGER]},[1,1,1],"regular"]});g.PttDailyWamEvent=b}),98);
__d("WAWebScreenLockSettingsDataWamEvent",["WAWebWamCodegenUtils"],(function(a,b,c,d,e,f,g){a=d("WAWebWamCodegenUtils").defineEvents({ScreenLockSettingsData:[4802,{screenAutoLockDuration:[1,d("WAWebWamCodegenUtils").TYPES.INTEGER]},[1,1,1],"regular"]});g.ScreenLockSettingsDataWamEvent=a}),98);
__d("WAWebScreenLockSettingsWamEvent",["WAWebWamCodegenUtils"],(function(a,b,c,d,e,f,g){a=d("WAWebWamCodegenUtils").defineEvents({ScreenLockSettings:[3872,{screenLockDuration:[1,d("WAWebWamCodegenUtils").TYPES.INTEGER]},[1,1,1],"private",113760892]});g.ScreenLockSettingsWamEvent=a}),98);
__d("WAWebWebcFtsStorageWamEvent",["WAWebWamCodegenUtils"],(function(a,b,c,d,e,f,g){a=d("WAWebWamCodegenUtils").defineEvents({WebcFtsStorage:[3642,{ftsTotalSize:[1,d("WAWebWamCodegenUtils").TYPES.INTEGER]},[1,1,1],"regular"]});g.WebcFtsStorageWamEvent=a}),98);
__d("WAWebTasksDailyStatsTask",["Promise","WALogger","WATimeUtils","WAWebABProps","WAWebApiPrivacyDisallowedList","WAWebApiPrivacyEphemerality","WAWebChatThreadLoggingUtils","WAWebCommunityHomeActionWamEvent","WAWebCommunityTabActionWamEvent","WAWebContactCollection","WAWebDailyAggregatedStatsCollection","WAWebDailyWamEvent","WAWebEphemeralityResolver","WAWebEstimateFtsStorageApi","WAWebEstimateStorageApi","WAWebKeepInChatNotifWamEvent","WAWebMediaStore","WAWebMiscGatingUtils","WAWebMuteCollection","WAWebNotificationConstants","WAWebNotificationEngagementWamEvent","WAWebNotificationSettingWamEvent","WAWebPnhDailyCtwaWamEvent","WAWebPnhDailyWamEvent","WAWebPrivacyHighlightDailyWamEvent","WAWebPttDailyWamEvent","WAWebSchemaContact","WAWebScreenLockSettingsDataWamEvent","WAWebScreenLockSettingsWamEvent","WAWebUserPrefsGeneral","WAWebUserPrefsInfoStore","WAWebUserPrefsMultiDevice","WAWebUserPrefsNotifications","WAWebUserPrefsScreenLock","WAWebWamEnumNotificationSettingType","WAWebWamEnumNotificationSoundTone","WAWebWamEnumPrivacyHighlightCategoryEnum","WAWebWamEnumPrivacyHighlightSurfaceEnum","WAWebWamEnumPrivacySettingsContactsBuckets","WAWebWamEnumPrivacySettingsValueType","WAWebWamEnumTypeOfGroupEnum","WAWebWamPrivateStatsUtils","WAWebWebcFtsStorageWamEvent","WAWebWebcStorageStatWamEvent","WAWebWid","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["WamDailyStats: "]);i=function(){return a};return a}function j(a){if(a.goldenBoxContactNarrativeAppearCount>0||a.goldenBoxContactDialogAppearCount>0||a.goldenBoxContactDialogSelectCount>0){var b=new(d("WAWebPrivacyHighlightDailyWamEvent").PrivacyHighlightDailyWamEvent)({privacyHighlightCategory:d("WAWebWamEnumPrivacyHighlightCategoryEnum").PRIVACY_HIGHLIGHT_CATEGORY_ENUM.E2EE,privacyHighlightSurface:d("WAWebWamEnumPrivacyHighlightSurfaceEnum").PRIVACY_HIGHLIGHT_SURFACE_ENUM.GOLDEN_BOX_CONTACT,narrativeAppearCount:a.goldenBoxContactNarrativeAppearCount,dialogAppearCount:a.goldenBoxContactDialogAppearCount,dialogSelectCount:a.goldenBoxContactDialogSelectCount});b.commit()}if(a.goldenBoxGroupNarrativeAppearCount>0||a.goldenBoxGroupDialogAppearCount>0||a.goldenBoxGroupDialogSelectCount>0){b=new(d("WAWebPrivacyHighlightDailyWamEvent").PrivacyHighlightDailyWamEvent)({privacyHighlightCategory:d("WAWebWamEnumPrivacyHighlightCategoryEnum").PRIVACY_HIGHLIGHT_CATEGORY_ENUM.E2EE,privacyHighlightSurface:d("WAWebWamEnumPrivacyHighlightSurfaceEnum").PRIVACY_HIGHLIGHT_SURFACE_ENUM.GOLDEN_BOX_GROUP,narrativeAppearCount:a.goldenBoxGroupNarrativeAppearCount,dialogAppearCount:a.goldenBoxGroupDialogAppearCount,dialogSelectCount:a.goldenBoxGroupDialogSelectCount});b.commit()}if(a.infoScreenGroupNarrativeAppearCount>0||a.infoScreenGroupDialogAppearCount>0||a.infoScreenGroupDialogSelectCount>0){b=new(d("WAWebPrivacyHighlightDailyWamEvent").PrivacyHighlightDailyWamEvent)({privacyHighlightCategory:d("WAWebWamEnumPrivacyHighlightCategoryEnum").PRIVACY_HIGHLIGHT_CATEGORY_ENUM.E2EE,privacyHighlightSurface:d("WAWebWamEnumPrivacyHighlightSurfaceEnum").PRIVACY_HIGHLIGHT_SURFACE_ENUM.INFO_SCREEN_GROUP,narrativeAppearCount:a.infoScreenGroupNarrativeAppearCount,dialogAppearCount:a.infoScreenGroupDialogAppearCount,dialogSelectCount:a.infoScreenGroupDialogSelectCount});b.commit()}if(a.chatsListNarrativeAppearCount>0||a.chatsListDialogAppearCount>0||a.chatsListDialogSelectCount>0){b=new(d("WAWebPrivacyHighlightDailyWamEvent").PrivacyHighlightDailyWamEvent)({privacyHighlightCategory:d("WAWebWamEnumPrivacyHighlightCategoryEnum").PRIVACY_HIGHLIGHT_CATEGORY_ENUM.E2EE,privacyHighlightSurface:d("WAWebWamEnumPrivacyHighlightSurfaceEnum").PRIVACY_HIGHLIGHT_SURFACE_ENUM.CHATS_LIST,narrativeAppearCount:a.chatsListNarrativeAppearCount,dialogAppearCount:a.chatsListDialogAppearCount,dialogSelectCount:a.chatsListDialogSelectCount});b.commit()}if(a.statusListNarrativeAppearCount>0||a.statusListDialogAppearCount>0||a.statusListDialogSelectCount>0){b=new(d("WAWebPrivacyHighlightDailyWamEvent").PrivacyHighlightDailyWamEvent)({privacyHighlightCategory:d("WAWebWamEnumPrivacyHighlightCategoryEnum").PRIVACY_HIGHLIGHT_CATEGORY_ENUM.E2EE,privacyHighlightSurface:d("WAWebWamEnumPrivacyHighlightSurfaceEnum").PRIVACY_HIGHLIGHT_SURFACE_ENUM.STATUS_LIST,narrativeAppearCount:a.statusListNarrativeAppearCount,dialogAppearCount:a.statusListDialogAppearCount,dialogSelectCount:a.statusListDialogSelectCount});b.commit()}if(a.callingScreenAudioNarrativeAppearCount>0||a.callingScreenAudioDialogAppearCount>0||a.callingScreenAudioDialogSelectCount>0){b=new(d("WAWebPrivacyHighlightDailyWamEvent").PrivacyHighlightDailyWamEvent)({privacyHighlightCategory:d("WAWebWamEnumPrivacyHighlightCategoryEnum").PRIVACY_HIGHLIGHT_CATEGORY_ENUM.E2EE,privacyHighlightSurface:d("WAWebWamEnumPrivacyHighlightSurfaceEnum").PRIVACY_HIGHLIGHT_SURFACE_ENUM.CALLING_SCREEN_AUDIO,narrativeAppearCount:a.callingScreenAudioNarrativeAppearCount,dialogAppearCount:a.callingScreenAudioDialogAppearCount,dialogSelectCount:a.callingScreenAudioDialogSelectCount});b.commit()}}function k(){var a=!d("WAWebMuteCollection").MuteCollection.globalReactionsMute(),b=!!d("WAWebUserPrefsNotifications").getIgnoreNondirectGroupMsg(),c=new(d("WAWebNotificationSettingWamEvent").NotificationSettingWamEvent)();c.set({groupReactionNotification:b&&a,groupShowNotification:b,groupSoundTone:d("WAWebWamEnumNotificationSoundTone").NOTIFICATION_SOUND_TONE.DEFAULT,inAppNotificationSound:d("WAWebUserPrefsNotifications").getGlobalSounds(),messageReactionNotification:a,messageShowNotification:d("WAWebUserPrefsNotifications").getGlobalNotifications(),messageSoundTone:d("WAWebWamEnumNotificationSoundTone").NOTIFICATION_SOUND_TONE.DEFAULT,showPreview:d("WAWebUserPrefsNotifications").getGlobalPreviews(),offlineNotification:d("WAWebUserPrefsNotifications").getGlobalOfflineNotifications()});c.commit()}function a(){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield m()),b=(yield o()),e=(yield s()),f=(yield u()),g=v(),h=(yield w());a=babelHelpers["extends"]({},a,b,e,g,h);d("WALogger").DEV(i()).devConsole(a);b=new(d("WAWebDailyWamEvent").DailyWamEvent)();b.set(a);b.commit();k();g=new(d("WAWebWebcFtsStorageWamEvent").WebcFtsStorageWamEvent)();g.set({ftsTotalSize:f});g.commit();h=new(d("WAWebScreenLockSettingsWamEvent").ScreenLockSettingsWamEvent)();a=y();a&&h.set(a);h.commit();b=new(d("WAWebScreenLockSettingsDataWamEvent").ScreenLockSettingsDataWamEvent)();f=z();f&&b.set(f);b.commit();g=d("WAWebUserPrefsMultiDevice").getPairingTimestamp();a=new(d("WAWebWebcStorageStatWamEvent").WebcStorageStatWamEvent)();a.set({webcStorageQuota:e.storageTotalSize,webcStorageUsage:e.storageUsed,webcAgeOfStorage:g!=null?d("WATimeUtils").unixTimeWithoutClockSkewCorrection()-g:-1,webcPackingEnabled:!1});void a.commit();h=(yield d("WAWebUserPrefsGeneral").getOfflineNotificationEngagement());if(h){new(d("WAWebNotificationEngagementWamEvent").NotificationEngagementWamEvent)({isWebBackgroundSyncNotif:!0,totalNotifShown:(f=h.totalNotifShown)!=null?f:0,totalNotifTapToOpen:(b=h.totalNotifTapToOpen)!=null?b:0}).commit();void d("WAWebUserPrefsGeneral").clearOfflineNotificationContentEngagement()}d("WAWebWamPrivateStatsUtils").logDailyPrivateStatsTestEvents();e=d("WAWebDailyAggregatedStatsCollection").DailyAggregatedStatsCollection.toArray().filter(function(a){return a.shouldBeSubmitted()});d("WAWebDailyAggregatedStatsCollection").DailyAggregatedStatsCollection.remove(e);e.forEach(function(a){var b=new(d("WAWebPttDailyWamEvent").PttDailyWamEvent)({pttCancelBroadcast:a.pttCancelBroadcast,pttCancelGroup:a.pttCancelGroup,pttCancelIndividual:a.pttCancelIndividual,pttCancelNewsletter:a.pttCancelNewsletter,pttDraftReviewBroadcast:a.pttDraftReviewBroadcast,pttDraftReviewGroup:a.pttDraftReviewGroup,pttDraftReviewIndividual:a.pttDraftReviewIndividual,pttDraftReviewNewsletter:a.pttDraftReviewNewsletter,pttFastplaybackBroadcast:a.pttFastplaybackBroadcast,pttFastplaybackGroup:a.pttFastplaybackGroup,pttFastplaybackIndividual:a.pttFastplaybackIndividual,pttFastplaybackNewsletter:a.pttFastplaybackNewsletter,pttLockBroadcast:a.pttLockBroadcast,pttLockGroup:a.pttLockGroup,pttLockIndividual:a.pttLockIndividual,pttLockNewsletter:a.pttLockNewsletter,pttOutOfChatBroadcast:a.pttOutOfChatBroadcast,pttOutOfChatGroup:a.pttOutOfChatGroup,pttOutOfChatIndividual:a.pttOutOfChatIndividual,pttOutOfChatNewsletter:a.pttOutOfChatNewsletter,pttPlaybackBroadcast:a.pttPlaybackBroadcast,pttPlaybackGroup:a.pttPlaybackGroup,pttPlaybackIndividual:a.pttPlaybackIndividual,pttPlaybackNewsletter:a.pttPlaybackNewsletter,pttRecordBroadcast:a.pttRecordBroadcast,pttRecordGroup:a.pttRecordGroup,pttRecordIndividual:a.pttRecordIndividual,pttRecordNewsletter:a.pttRecordNewsletter,pttSendBroadcast:a.pttSendBroadcast,pttSendGroup:a.pttSendGroup,pttSendIndividual:a.pttSendIndividual,pttSendNewsletter:a.pttSendNewsletter,pttPausedRecordBroadcast:a.pttPausedRecordBroadcast,pttPausedRecordGroup:a.pttPausedRecordGroup,pttPausedRecordIndividual:a.pttPausedRecordIndividual,pttPausedRecordNewsletter:a.pttPausedRecordNewsletter,pttStopTapBroadcast:a.pttStopTapBroadcast,pttStopTapGroup:a.pttStopTapGroup,pttStopTapIndividual:a.pttStopTapIndividual,pttStopTapNewsletter:a.pttStopTapNewsletter});b.commit();j(a);new(d("WAWebCommunityTabActionWamEvent").CommunityTabActionWamEvent)({communityTabGroupNavigations:a.communityTabGroupNavigations,communityTabToHomeViews:a.communityTabToHomeViews,communityTabViews:a.communityTabViews,communityTabViewsViaContextMenu:a.communityTabViewsViaContextMenu}).commit();a.communityHome!=null&&Object.keys(a.communityHome).forEach(function(b){var e=c("WAWebWid").user(b);if(e==null)return;b=a.communityHome[b];var f=b.communityHomeGroupDiscoveries,g=b.communityHomeGroupJoins,h=b.communityHomeGroupNavigations;b=b.communityHomeViews;new(d("WAWebCommunityHomeActionWamEvent").CommunityHomeActionWamEvent)({communityHomeId:e,communityHomeGroupDiscoveries:f,communityHomeGroupJoins:g,communityHomeGroupNavigations:h,communityHomeViews:b}).commit()});a.pnhCagActions!=null&&Object.keys(a.pnhCagActions).forEach(function(b){var c=a.pnhCagActions[b],e=c.pnhIndicatorClicksChat,f=c.pnhIndicatorClicksInfoScreen,g=c.reactionDeleteCount;c=c.reactionOpenTrayCount;new(d("WAWebPnhDailyWamEvent").PnhDailyWamEvent)({communityId:b,pnhIndicatorClicksChat:e,pnhIndicatorClicksInfoScreen:f,reactionDeleteCount:g,reactionOpenTrayCount:c,typeOfGroup:d("WAWebWamEnumTypeOfGroupEnum").TYPE_OF_GROUP_ENUM.DEFAULT_SUBGROUP}).commit()});a.pnhCtwaActions!=null&&Object.keys(a.pnhCtwaActions).forEach(function(b){new(d("WAWebPnhDailyCtwaWamEvent").PnhDailyCtwaWamEvent)({threadDs:d("WAWebChatThreadLoggingUtils").getThreadDs(a.startTime),threadId:b,matMessagesReceived:a.pnhCtwaActions[b]}).commit()});b=new(d("WAWebKeepInChatNotifWamEvent").KeepInChatNotifWamEvent)({kicGroupNotificationTaps:a.kicGroupNotificationTaps,kicGroupNotifications:a.kicGroupNotifications,kicNotificationTaps:a.kicNotificationTaps,kicNotifications:a.kicNotifications});b.commit()})});return l.apply(this,arguments)}function m(){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WAWebUserPrefsInfoStore").deviceInfo.get());return{languageCode:a.lg,locationCode:a.lc,osBuildNumber:a.osBuild,simMcc:parseInt(a.mcc,10),simMnc:parseInt(a.mnc,10)}});return n.apply(this,arguments)}function o(){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a,b=d("WAWebUserPrefsGeneral").getUserPrivacySettings(),c={receiptsEnabled:b.readReceipts!=="none"},e=(yield d("WAWebApiPrivacyDisallowedList").queryDisallowedLists());c.privacySettingsAbout=q(b.about);c.privacySettingsAboutExceptNum=b.about==="contact_blacklist"?r((a=e.about)==null?void 0:a.disallowedList.length):null;c.privacySettingsGroups=q(b.groupAdd);c.privacySettingsGroupsExceptNum=b.groupAdd==="contact_blacklist"?r((a=e.groupadd)==null?void 0:a.disallowedList.length):null;c.privacySettingsLastSeen=q(b.lastSeen);c.privacySettingsLastSeenExceptNum=b.lastSeen==="contact_blacklist"?r((a=e.last)==null?void 0:a.disallowedList.length):null;c.privacySettingsProfilePhoto=q(b.profilePicture);c.privacySettingsProfilePhotoExceptNum=b.profilePicture==="contact_blacklist"?r((a=e.profile)==null?void 0:a.disallowedList.length):null;b=d("WAWebEphemeralityResolver").getEphemeralDurationForUser(d("WAWebContactCollection").ContactCollection.getMeContact());c.defaultDisappearingDuration=(e=b)!=null?e:0;if(d("WAWebABProps").getABPropConfigValue("dm_initiator_trigger_daily_logs")){c.isDefaultDisappearingMessagesUser=b!==0;a=(yield d("WAWebApiPrivacyEphemerality").queryEphemeralityDailyLogInfo());e=a.isEphemeralMessagingUser;b=a.countEphemeralThreadsEnabledByMe;a=a.countEphemeralThreads;c.isEphemeralMessagingUser=e;c.countEphemeralThreads=a;c.countEphemeralThreadsEnabledByMe=b}return c});return p.apply(this,arguments)}function q(a){if(a==null)return null;switch(a){case"all":return d("WAWebWamEnumPrivacySettingsValueType").PRIVACY_SETTINGS_VALUE_TYPE.EVERYONE;case"contacts":return d("WAWebWamEnumPrivacySettingsValueType").PRIVACY_SETTINGS_VALUE_TYPE.MY_CONTACTS;case"contact_blacklist":return d("WAWebWamEnumPrivacySettingsValueType").PRIVACY_SETTINGS_VALUE_TYPE.MY_CONTACTS_EXCEPT;case"none":return d("WAWebWamEnumPrivacySettingsValueType").PRIVACY_SETTINGS_VALUE_TYPE.NOBODY}}function r(a){if(a==null)return null;if(a===0)return d("WAWebWamEnumPrivacySettingsContactsBuckets").PRIVACY_SETTINGS_CONTACTS_BUCKETS.B0;if(a<5)return d("WAWebWamEnumPrivacySettingsContactsBuckets").PRIVACY_SETTINGS_CONTACTS_BUCKETS.B1;if(a<10)return d("WAWebWamEnumPrivacySettingsContactsBuckets").PRIVACY_SETTINGS_CONTACTS_BUCKETS.B5;if(a<15)return d("WAWebWamEnumPrivacySettingsContactsBuckets").PRIVACY_SETTINGS_CONTACTS_BUCKETS.B10;if(a<20)return d("WAWebWamEnumPrivacySettingsContactsBuckets").PRIVACY_SETTINGS_CONTACTS_BUCKETS.B15;if(a<30)return d("WAWebWamEnumPrivacySettingsContactsBuckets").PRIVACY_SETTINGS_CONTACTS_BUCKETS.B20;if(a<40)return d("WAWebWamEnumPrivacySettingsContactsBuckets").PRIVACY_SETTINGS_CONTACTS_BUCKETS.B30;if(a<50)return d("WAWebWamEnumPrivacySettingsContactsBuckets").PRIVACY_SETTINGS_CONTACTS_BUCKETS.B40;if(a<60)return d("WAWebWamEnumPrivacySettingsContactsBuckets").PRIVACY_SETTINGS_CONTACTS_BUCKETS.B50;if(a<70)return d("WAWebWamEnumPrivacySettingsContactsBuckets").PRIVACY_SETTINGS_CONTACTS_BUCKETS.B60;if(a<80)return d("WAWebWamEnumPrivacySettingsContactsBuckets").PRIVACY_SETTINGS_CONTACTS_BUCKETS.B70;if(a<90)return d("WAWebWamEnumPrivacySettingsContactsBuckets").PRIVACY_SETTINGS_CONTACTS_BUCKETS.B80;return a<100?d("WAWebWamEnumPrivacySettingsContactsBuckets").PRIVACY_SETTINGS_CONTACTS_BUCKETS.B90:d("WAWebWamEnumPrivacySettingsContactsBuckets").PRIVACY_SETTINGS_CONTACTS_BUCKETS.B100}function s(){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WAWebSchemaContact").getContactTable().equals(["isAddressBookContact"],1).then(function(a){return a.length})),e=(yield c("WAWebEstimateStorageApi")()),f=(yield d("WAWebMediaStore").LruMediaStore.count());e=(yield (h||(h=b("Promise"))).all([e,a,f]));a=0;f=0;var g=0,i=e[0];i!=null&&(a=i.available,f=i.quota,g=i.usage);return{addressbookWhatsappSize:A(e[1],10),storageAvailSize:A(a,100),storageTotalSize:A(f,100),storageUsed:A(g,100),mediaFolderFileCount:e[2]}});return t.apply(this,arguments)}function u(){return d("WAWebEstimateFtsStorageApi").getEstimatedFTSDbSize()}function v(){var a=d("WAWebWamEnumNotificationSettingType").NOTIFICATION_SETTING_TYPE.UNKNOWN;if(window.Notification!=null)switch(window.Notification.permission){case d("WAWebNotificationConstants").PERMISSION_ALLOWED:a=d("WAWebWamEnumNotificationSettingType").NOTIFICATION_SETTING_TYPE.ALLOWED;break;case d("WAWebNotificationConstants").PERMISSION_DENIED:a=d("WAWebWamEnumNotificationSettingType").NOTIFICATION_SETTING_TYPE.BLOCKED;break;default:a=d("WAWebWamEnumNotificationSettingType").NOTIFICATION_SETTING_TYPE.UNKNOWN}return{osNotificationSetting:a}}function w(){return x.apply(this,arguments)}function x(){x=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=[],b=[],c=window.navigator.mediaCapabilities;if(c!=null){var d={width:800,height:600,bitrate:1e4,framerate:30},e={type:"record"},f={type:"file"},g={contentType:'video/mp4; codecs="avc1.42000a"'},h={contentType:'video/mp4; codecs="hev1.1.6.L93.B0"'},i={contentType:'video/mp4; codecs="av01.0.00M.08"'},j={contentType:'video/mp4; codecs="vp09.00.51.08.01.01.01.01.00"'},k=babelHelpers["extends"]({},e,{video:babelHelpers["extends"]({},g,d)}),l=babelHelpers["extends"]({},e,{video:babelHelpers["extends"]({},h,d)}),m=babelHelpers["extends"]({},e,{video:babelHelpers["extends"]({},i,d)});e=babelHelpers["extends"]({},e,{video:babelHelpers["extends"]({},j,d)});g=babelHelpers["extends"]({},f,{video:babelHelpers["extends"]({},g,d)});h=babelHelpers["extends"]({},f,{video:babelHelpers["extends"]({},h,d)});i=babelHelpers["extends"]({},f,{video:babelHelpers["extends"]({},i,d)});f=babelHelpers["extends"]({},f,{video:babelHelpers["extends"]({},j,d)});if(c.encodingInfo!=null){try{(yield c.encodingInfo(k)).supported&&a.push("avc")}catch(a){}try{(yield c.encodingInfo(l)).supported&&a.push("hevc")}catch(a){}try{(yield c.encodingInfo(m)).supported&&a.push("av1")}catch(a){}try{(yield c.encodingInfo(e)).supported&&a.push("vp9")}catch(a){}}if(c.decodingInfo!=null){try{(yield c.decodingInfo(g)).supported&&b.push("avc")}catch(a){}try{(yield c.decodingInfo(h)).supported&&b.push("hevc")}catch(a){}try{(yield c.decodingInfo(i)).supported&&b.push("av1")}catch(a){}try{(yield c.decodingInfo(f)).supported&&b.push("vp9")}catch(a){}}}return{supportedEncoders:a.join(","),supportedDecoders:b.join(",")}});return x.apply(this,arguments)}function y(){if(d("WAWebMiscGatingUtils").screenLockFeatureSupported())return{screenLockDuration:d("WAWebUserPrefsScreenLock").getScreenLockDurationForLogging()}}function z(){if(d("WAWebMiscGatingUtils").screenLockFeatureSupported())return{screenAutoLockDuration:d("WAWebUserPrefsScreenLock").getScreenLockDurationForLogging()}}function A(a,b){return c("gkx")("26258")?Math.round(a/b)*b:a}g.logDailyStats=a}),98);
__d("WAWebLogDailyStatsJob",["WAJobOrchestratorTypes","WAWebOrchestratorNonPersistedJob","WAWebTasksDailyStatsTask"],(function(a,b,c,d,e,f,g){function a(){return d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("logDailyStats",function(a){return d("WAWebTasksDailyStatsTask").logDailyStats()},{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.BEST_EFFORT}).waitUntilCompleted()}g.logDailyStatsJob=a}),98);
__d("WAWebWamEnumActiveTimeAfterPairing",[],(function(a,b,c,d,e,f){a=Object.freeze({MINS_10:1,MINS_20:2,MINS_40:3,MINS_60:4,MINS_5:5});f.ACTIVE_TIME_AFTER_PAIRING=a}),66);
__d("WAWebWamEnumMdHistorySyncStatusResult",[],(function(a,b,c,d,e,f){a=Object.freeze({SUCCESS:1,UNFINISHED:2,FAIL_TO_DOWNLOAD:3,MISSING_CHUNK:4,PROTOBUF_ERROR:5,FAIL_TO_STORE:6,OTHER_ERROR:7,IN_PROGRESS:8,FAIL_TO_RECEIVE:9,FAIL_TO_STORE_CHUNK:10,FAIL_TO_FETCH:11,FAIL_TO_PREPROCESS:12,FAIL_TO_ENCRYPT:13});f.MD_HISTORY_SYNC_STATUS_RESULT=a}),66);
__d("WAWebMdBootstrapHistorySyncStatusAfterPairingWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumActiveTimeAfterPairing","WAWebWamEnumMdBootstrapHistoryPayloadType","WAWebWamEnumMdHistorySyncStatusResult"],(function(a,b,c,d,e,f,g){b=(a=d("WAWebWamCodegenUtils")).defineEvents({MdBootstrapHistorySyncStatusAfterPairing:[4652,{activeTimeAfterPairing:[1,d("WAWebWamEnumActiveTimeAfterPairing").ACTIVE_TIME_AFTER_PAIRING],isLoopRunning:[12,a.TYPES.BOOLEAN],lastProcessedNotificationChunkOrder:[2,a.TYPES.INTEGER],lastProcessedNotificationChunkProgress:[3,a.TYPES.INTEGER],mdBootstrapHistoryPayloadType:[4,d("WAWebWamEnumMdBootstrapHistoryPayloadType").MD_BOOTSTRAP_HISTORY_PAYLOAD_TYPE],mdHistorySyncStatusResult:[5,d("WAWebWamEnumMdHistorySyncStatusResult").MD_HISTORY_SYNC_STATUS_RESULT],mdSessionId:[6,a.TYPES.STRING],mdTimestamp:[7,a.TYPES.INTEGER],missingNotificationCount:[8,a.TYPES.INTEGER],nextNotificationChunkOrder:[9,a.TYPES.INTEGER],totalProcessedMessageCount:[10,a.TYPES.INTEGER],unprocessedNotificationCount:[11,a.TYPES.INTEGER]},[1,1,1],"regular"]});g.MdBootstrapHistorySyncStatusAfterPairingWamEvent=b}),98);
__d("WAWebLogHistorySyncStatusAfterPairingJob",["Promise","WAJobOrchestratorTypes","WALogger","WATimeUtils","WAWebApiHistorySyncNotification","WAWebHistorySyncNotificationUtils","WAWebMdBootstrapHistorySyncStatusAfterPairingWamEvent","WAWebOrchestratorNonPersistedJob","WAWebSyncBootstrap","WAWebSyncdMdSyncFieldstatMeta","WAWebUserPrefsHistorySync","WAWebUserPrefsTypes","WAWebWamEnumActiveTimeAfterPairing","WAWebWamEnumMdBootstrapHistoryPayloadType","WAWebWamEnumMdHistorySyncStatusResult","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[history sync] do not log status as no requirment meets"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[history sync] log status for 5 minutes after pairing"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[history sync] log status for 10 minutes after pairing"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[history sync] log status for 20 minutes after pairing"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[history sync] log status for 40 minutes after pairing"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[history sync] log status for 60 minutes after pairing"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[history sync] skip sync status logging as we've logged for more than 5 times"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[history sync] skip sync status logging as it's too soon after pairing"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["[history sync] log history sync status with time after pairing "," mins and logging count ",""]);q=function(){return a};return a}function a(a,c){a=(d("WATimeUtils").unixTime()-a)/60;d("WALogger").DEV(q(),a,c);if(a<5){d("WALogger").LOG(p());return(h||(h=b("Promise"))).resolve()}return d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("logHistorySyncStatusAfterPairing",function(a){return r(a.timeAfterPairingMins,a.loggingCount)},{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.LOW}).waitUntilCompleted({timeAfterPairingMins:a,loggingCount:c})}function r(a,b){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(b>=5){d("WALogger").LOG(o());return}if(a>=60){d("WALogger").LOG(n());yield t(d("WAWebWamEnumActiveTimeAfterPairing").ACTIVE_TIME_AFTER_PAIRING.MINS_60);void d("WAWebUserPrefsHistorySync").setHistorySyncStatusAfterPairingLoggingCount(5);return}if(b<4&&a>=40){d("WALogger").LOG(m());yield t(d("WAWebWamEnumActiveTimeAfterPairing").ACTIVE_TIME_AFTER_PAIRING.MINS_40);void d("WAWebUserPrefsHistorySync").setHistorySyncStatusAfterPairingLoggingCount(4);return}if(b<3&&a>=20){d("WALogger").LOG(l());yield t(d("WAWebWamEnumActiveTimeAfterPairing").ACTIVE_TIME_AFTER_PAIRING.MINS_20);void d("WAWebUserPrefsHistorySync").setHistorySyncStatusAfterPairingLoggingCount(3);return}if(b<2&&a>=10){d("WALogger").LOG(k());yield t(d("WAWebWamEnumActiveTimeAfterPairing").ACTIVE_TIME_AFTER_PAIRING.MINS_10);void d("WAWebUserPrefsHistorySync").setHistorySyncStatusAfterPairingLoggingCount(2);return}if(b<1&&a>=5){d("WALogger").LOG(j());yield t(d("WAWebWamEnumActiveTimeAfterPairing").ACTIVE_TIME_AFTER_PAIRING.MINS_5);void d("WAWebUserPrefsHistorySync").setHistorySyncStatusAfterPairingLoggingCount(1);return}d("WALogger").LOG(i())});return s.apply(this,arguments)}function t(a){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield v(a)});return u.apply(this,arguments)}function v(a){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield d("WAWebSyncdMdSyncFieldstatMeta").MdSyncFieldStatsMeta.getMdSessionId());b=new(d("WAWebMdBootstrapHistorySyncStatusAfterPairingWamEvent").MdBootstrapHistorySyncStatusAfterPairingWamEvent)({mdBootstrapHistoryPayloadType:d("WAWebWamEnumMdBootstrapHistoryPayloadType").MD_BOOTSTRAP_HISTORY_PAYLOAD_TYPE.RECENT_HISTORY,mdSessionId:b,mdTimestamp:d("WATimeUtils").unixTimeMs(),activeTimeAfterPairing:a,isLoopRunning:c("WAWebSyncBootstrap").getIsHistorySyncRunning()});a=(yield d("WAWebUserPrefsHistorySync").getLastHistoryRecentSyncedChunk());var e=a!=null?a.chunkOrder:-1,f=a!=null?a.progress:-1;b.lastProcessedNotificationChunkOrder=e;b.lastProcessedNotificationChunkProgress=f;f=(f=(yield d("WAWebUserPrefsHistorySync").getHistorySyncTotalProcessedMessageCount()))!=null?f:0;b.totalProcessedMessageCount=f;f=(yield d("WAWebUserPrefsHistorySync").getHistorySyncStatus());if((f==null?void 0:f.recentCompleted)===!0){b.mdHistorySyncStatusResult=d("WAWebWamEnumMdHistorySyncStatusResult").MD_HISTORY_SYNC_STATUS_RESULT.SUCCESS;b.commit();return}f=(yield d("WAWebHistorySyncNotificationUtils").getUnprocessedRecentSyncNotifications());var g=f.length;b.unprocessedNotificationCount=g;f=g>0?(g=f[0].chunkOrder)!=null?g:0:-1;b.nextNotificationChunkOrder=f;if(d("WAWebApiHistorySyncNotification").inFlightChunk.size>0){b.mdHistorySyncStatusResult=d("WAWebWamEnumMdHistorySyncStatusResult").MD_HISTORY_SYNC_STATUS_RESULT.IN_PROGRESS;b.commit();return}g=a?e+1:1;f=(yield d("WAWebUserPrefsHistorySync").getRecentSyncSingleChunkStatus());a=x(f,g);b.mdHistorySyncStatusResult=a;b.commit()});return w.apply(this,arguments)}function x(a,b){if(a==null||a[b]==null)return d("WAWebWamEnumMdHistorySyncStatusResult").MD_HISTORY_SYNC_STATUS_RESULT.FAIL_TO_RECEIVE;switch(a[b]){case d("WAWebUserPrefsTypes").HistorySyncSingleChunkStatusType.RECEIVED:return d("WAWebWamEnumMdHistorySyncStatusResult").MD_HISTORY_SYNC_STATUS_RESULT.FAIL_TO_STORE_CHUNK;case d("WAWebUserPrefsTypes").HistorySyncSingleChunkStatusType.NOTIFICATION_STORED:return d("WAWebWamEnumMdHistorySyncStatusResult").MD_HISTORY_SYNC_STATUS_RESULT.FAIL_TO_FETCH;case d("WAWebUserPrefsTypes").HistorySyncSingleChunkStatusType.DOWNLOADING:return d("WAWebWamEnumMdHistorySyncStatusResult").MD_HISTORY_SYNC_STATUS_RESULT.FAIL_TO_DOWNLOAD;case d("WAWebUserPrefsTypes").HistorySyncSingleChunkStatusType.DOWNLOADED:return d("WAWebWamEnumMdHistorySyncStatusResult").MD_HISTORY_SYNC_STATUS_RESULT.PROTOBUF_ERROR;case d("WAWebUserPrefsTypes").HistorySyncSingleChunkStatusType.DECODED:return d("WAWebWamEnumMdHistorySyncStatusResult").MD_HISTORY_SYNC_STATUS_RESULT.FAIL_TO_PREPROCESS;case d("WAWebUserPrefsTypes").HistorySyncSingleChunkStatusType.MESSAGE_PREPROCESSED:return d("WAWebWamEnumMdHistorySyncStatusResult").MD_HISTORY_SYNC_STATUS_RESULT.FAIL_TO_ENCRYPT;case d("WAWebUserPrefsTypes").HistorySyncSingleChunkStatusType.ENCRYPTED:return d("WAWebWamEnumMdHistorySyncStatusResult").MD_HISTORY_SYNC_STATUS_RESULT.FAIL_TO_STORE;default:return d("WAWebWamEnumMdHistorySyncStatusResult").MD_HISTORY_SYNC_STATUS_RESULT.OTHER_ERROR}}g.logHistorySyncStatusAfterPairingJob=a;g.logHistorySyncStatusAfterPairing=r;g.commitHistorySyncStatusData=t}),98);
__d("WAWebNewsletterCleanupTasks",["WAWebBackendApi","WAWebCommonNewsletterEnums","WAWebNewsletterDeleteChatJob","WAWebNewsletterStorageUtils","WAWebSchemaNewsletterMetadata","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h=d("WAWebNewsletterStorageUtils").mapNewsletterMembershipTypeForStorage(d("WAWebCommonNewsletterEnums").NewsletterMembershipType.Guest);function a(){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WAWebBackendApi").frontendSendAndReceive("getActiveNewsletter")),b=a==null?void 0:a.toJid();a=(yield d("WAWebSchemaNewsletterMetadata").getNewsletterMetadataTable().all());a=a.filter(function(a){return a.membershipType===h&&a.id!==b}).map(function(a){return a.id});yield d("WAWebNewsletterDeleteChatJob").bulkDeleteNewsletterChats(a.map(d("WAWebWidFactory").createWid))});return i.apply(this,arguments)}g.deletePreviewNewsletters=a}),98);
__d("WAWebWebDbVersionNonAnonymousWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumWebDbNameType"],(function(a,b,c,d,e,f,g){a=d("WAWebWamCodegenUtils").defineEvents({WebDbVersionNonAnonymous:[4816,{webDbName:[1,d("WAWebWamEnumWebDbNameType").WEB_DB_NAME_TYPE],webDbVersionNumber:[2,d("WAWebWamCodegenUtils").TYPES.INTEGER]},[1,1,1],"regular"]});g.WebDbVersionNonAnonymousWamEvent=a}),98);
__d("WAWebReportDbVerionsJob",["WAJobOrchestratorTypes","WAWebLocalSchemaVersions","WAWebOrchestratorNonPersistedJob","WAWebSchemaVersions","WAWebWebDbVersionNonAnonymousWamEvent","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(){return d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("reportDbVersions",b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WAWebLocalSchemaVersions").getLocalSchemaVersions());a.forEach(function(a,b){new(d("WAWebWebDbVersionNonAnonymousWamEvent").WebDbVersionNonAnonymousWamEvent)({webDbName:d("WAWebSchemaVersions").convertDBName(b),webDbVersionNumber:a}).commit()})}),{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.BEST_EFFORT,maxTimeoutMs:1e3*30}).waitUntilCompleted()}g.reportDbVersionsJob=a}),98);
__d("WAWebRestartRecentSyncJob",["Promise","WAJobOrchestratorTypes","WALogger","WAWebHistorySyncNotificationUtils","WAWebOrchestratorNonPersistedJob","WAWebProtobufsHistorySync.pb","WAWebSchemaHistorySyncNotification","WAWebSyncBootstrap","WAWebSyncGatingUtils","WAWebUserPrefsHistorySync","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[history sync] Restart recent sync job"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[history sync] Unprocessed notifications length: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[history sync] No unprocessed notifications found, skip restart recent sync job"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[history sync] Full sync already completed, skip restart recent sync job"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[history sync] Recent sync already completed, skip restart recent sync job"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[history sync] History sync is running, skip restart recent sync job"]);n=function(){return a};return a}function a(){return!d("WAWebSyncGatingUtils").isHistorySyncHandlingRestartV2Enabled()?(h||(h=b("Promise"))).resolve():d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("restartRecentSyncJob",function(){return o()},{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.LOW}).waitUntilCompleted()}function o(){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(c("WAWebSyncBootstrap").getIsHistorySyncRunning()){d("WALogger").LOG(n());return}var a=(yield d("WAWebUserPrefsHistorySync").getHistorySyncStatus()),b=c("gkx")("26254");if(b&&(a==null?void 0:a.recentCompleted)===!0){d("WALogger").LOG(m());return}if(!b&&(a==null?void 0:a.fullCompleted)===!0){d("WALogger").LOG(l());return}b=(yield d("WAWebSchemaHistorySyncNotification").getHistorySyncNotificationTable().equals(["processed"],0,{shouldDecrypt:!1}).then(function(a){return a.filter(function(a){return a.syncType===d("WAWebProtobufsHistorySync.pb").HistorySync$HistorySyncType.RECENT||a.syncType===d("WAWebProtobufsHistorySync.pb").HistorySync$HistorySyncType.FULL})}));if(b.length===0){d("WALogger").LOG(k());return}d("WALogger").LOG(j(),b.length);d("WALogger").LOG(i());void c("WAWebSyncBootstrap").continueProgressiveHistorySyncProcessingV2(d("WAWebHistorySyncNotificationUtils").HistorySyncScheduleSource.ManualRestart)});return p.apply(this,arguments)}g.restartRecentSyncJob=a}),98);
__d("WAWebSyncdKeyCountWamEvent",["WAWebWamCodegenUtils"],(function(a,b,c,d,e,f,g){b=(a=d("WAWebWamCodegenUtils")).defineEvents({SyncdKeyCount:[3978,{keysUsedInSnapshotCount:[1,a.TYPES.INTEGER],p80MuationsPerKey:[2,a.TYPES.INTEGER],p95MuationsPerKey:[3,a.TYPES.INTEGER],syncdSessionLengthDays:[4,a.TYPES.INTEGER],totalKeyCount:[5,a.TYPES.INTEGER]},[1,1,1],"regular"]});g.SyncdKeyCountWamEvent=b}),98);
__d("WAWebWamEnumMutationCountBucket",[],(function(a,b,c,d,e,f){a=Object.freeze({ZERO:1,ONE:2,LT10:3,LT100:4,LT500:5,LT1K:6,LT5K:7,GTE5K:8});f.MUTATION_COUNT_BUCKET=a}),66);
__d("WAWebSyncdWamUtils",["WABase64","WAGetSyncKey","WASyncdConst","WATimeUtils","WAWebSchemaSyncActions","WAWebWamEnumMutationCountBucket","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){function a(){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=new Map(),b=(yield d("WAWebSchemaSyncActions").getSyncActionsTable().all());b.map(function(b){var c,e=JSON.parse(b.index)[0];c=(c=a.get(e))!=null?c:{action:e,applied:0,invalid:0,orphan:0,unsupported:0,failed:0};switch(b.actionState){case d("WASyncdConst").SyncActionState.Success:case d("WASyncdConst").SyncActionState.Skipped:c.applied++;break;case d("WASyncdConst").SyncActionState.Malformed:c.invalid++;break;case d("WASyncdConst").SyncActionState.Orphan:c.orphan++;break;case d("WASyncdConst").SyncActionState.Unsupported:c.unsupported++;break;case d("WASyncdConst").SyncActionState.Failed:c.failed++;break}a.set(e,c)});return a});return h.apply(this,arguments)}function e(a){if(a<0)throw c("err")("cannot convert negative number to a bucket");else if(a===0)return d("WAWebWamEnumMutationCountBucket").MUTATION_COUNT_BUCKET.ZERO;else if(a===1)return d("WAWebWamEnumMutationCountBucket").MUTATION_COUNT_BUCKET.ONE;else if(a<10)return d("WAWebWamEnumMutationCountBucket").MUTATION_COUNT_BUCKET.LT10;else if(a<100)return d("WAWebWamEnumMutationCountBucket").MUTATION_COUNT_BUCKET.LT100;else if(a<500)return d("WAWebWamEnumMutationCountBucket").MUTATION_COUNT_BUCKET.LT500;else if(a<1e3)return d("WAWebWamEnumMutationCountBucket").MUTATION_COUNT_BUCKET.LT1K;else if(a<5e3)return d("WAWebWamEnumMutationCountBucket").MUTATION_COUNT_BUCKET.LT5K;else return d("WAWebWamEnumMutationCountBucket").MUTATION_COUNT_BUCKET.GTE5K}function i(){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WAWebSchemaSyncActions").getSyncActionsTable().get('["primary_version","session_start"]'));return a==null?void 0:a.timestamp});return j.apply(this,arguments)}function f(){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WAGetSyncKey").getAllSyncKeysInTransaction()),b=(yield d("WAWebSchemaSyncActions").getSyncActionsTable().all()),c=(yield i());c=c==null?void 0:Math.round((d("WATimeUtils").unixTimeMs()-c)/(1e3*3600*24));return l(a,b,c)});return k.apply(this,arguments)}function l(a,b,c){b=b.map(function(a){return d("WABase64").encodeB64(a.keyId)});var e=Array.from(new Set(b)),f=new Map();for(b of b)f.set(b,(f.get(b)||0)+1);b=Array.from(f.values()).sort();f=b.length;var g=Math.floor(f*.8)-1;f=Math.floor(f*.95)-1;return{totalKeyCount:a.length,keysUsedInSnapshotCount:e.length,p80MuationsPerKey:b[g],p95MuationsPerKey:b[f],syncdSessionLengthDays:c}}g.generateActionStatCounts=a;g.convertToBucket=e;g.getKeyStats=f;g.getKeyStatsInternal=l}),98);
__d("WAWebSyncdReportKeyStatsJob",["WAJobOrchestratorTypes","WAWebOrchestratorNonPersistedJob","WAWebSyncdKeyCountWamEvent","WAWebSyncdWamUtils","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){function a(){return d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("reportSyncdKeyStats",b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(c("gkx")("26258"))return;var a=(yield d("WAWebSyncdWamUtils").getKeyStats()),b={keysUsedInSnapshotCount:a.keysUsedInSnapshotCount,p80MuationsPerKey:a.p80MuationsPerKey,p95MuationsPerKey:a.p95MuationsPerKey,totalKeyCount:a.totalKeyCount};a.syncdSessionLengthDays!=null&&(b.syncdSessionLengthDays=a.syncdSessionLengthDays);new(d("WAWebSyncdKeyCountWamEvent").SyncdKeyCountWamEvent)(b).commit()}),{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.BEST_EFFORT,maxTimeoutMs:1e3*30}).waitUntilCompleted()}g.reportSyncdKeyStatsJob=a}),98);
__d("WAWebMdAppStateSyncMutationStatsWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumMutationCountBucket"],(function(a,b,c,d,e,f,g){b=d("WAWebWamCodegenUtils").defineEvents({MdAppStateSyncMutationStats:[3180,{applied:[1,(a=d("WAWebWamEnumMutationCountBucket")).MUTATION_COUNT_BUCKET],failed:[2,a.MUTATION_COUNT_BUCKET],invalid:[3,a.MUTATION_COUNT_BUCKET],orphan:[4,a.MUTATION_COUNT_BUCKET],syncdAction:[5,d("WAWebWamCodegenUtils").TYPES.STRING],unsupported:[6,a.MUTATION_COUNT_BUCKET]},[1,1,20],"private",0]});g.MdAppStateSyncMutationStatsWamEvent=b}),98);
__d("WAWebSyncdReportSyncdStatJob",["WAJobOrchestratorTypes","WAWebMdAppStateSyncMutationStatsWamEvent","WAWebOrchestratorNonPersistedJob","WAWebSyncdWamUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){return d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("reportSyncdStats",b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WAWebSyncdWamUtils").generateActionStatCounts());for(a of a.values()){var b;new(d("WAWebMdAppStateSyncMutationStatsWamEvent").MdAppStateSyncMutationStatsWamEvent)({syncdAction:a.action,applied:(b=d("WAWebSyncdWamUtils")).convertToBucket(a.applied),invalid:b.convertToBucket(a.invalid),orphan:b.convertToBucket(a.orphan),unsupported:b.convertToBucket(a.unsupported),failed:b.convertToBucket(a.failed)}).commit()}}),{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.BEST_EFFORT,maxTimeoutMs:1e3*30}).waitUntilCompleted()});return h.apply(this,arguments)}g.reportSyncdStatsJob=a}),98);
__d("WAWebSyncdRequestAllSyncdMissingKeysJob",["WAJobOrchestratorTypes","WASyncdHandleMissingKeys","WASyncdStoreMissingKeys","WAWebOrchestratorNonPersistedJob","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(){return d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("requestAllSyncdMissingKeys",b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield d("WASyncdHandleMissingKeys").requestAllMissingKeys(),self.setTimeout(d("WASyncdStoreMissingKeys").setMissingKeyTimeoutInTransaction,1e3*20)}),{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.BEST_EFFORT,maxTimeoutMs:1e3*30}).waitUntilCompleted()}g.requestAllSyncdMissingKeysJob=a}),98);
__d("WAWebSyncdSyncAllCollectionsJob",["WAJobOrchestratorTypes","WALogger","WASyncd","WASyncdConst","WATimeUtils","WAWebOrchestratorNonPersistedJob","WAWebUserPrefsAppStateSync","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: periodic sync for all collection"]);h=function(){return a};return a}function a(){return d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("syncdSyncAllCollections",b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a;d("WALogger").LOG(h());yield d("WASyncd").markCollectionsForSync([(a=d("WASyncdConst")).CollectionName.CriticalBlock,a.CollectionName.CriticalUnblockLow,a.CollectionName.Regular,a.CollectionName.RegularLow,a.CollectionName.RegularHigh]);yield d("WAWebUserPrefsAppStateSync").setLastPeriodicAppStateSyncTs(d("WATimeUtils").unixTime())}),{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.LOW,maxTimeoutMs:1e3*30}).waitUntilCompleted()}g.syncdSyncAllCollectionsJob=a}),98);
__d("WAWebTasksDefinitions",["$InternalEnum","Promise","WALogger","WASyncdAntiTampering","WATaskScheduler","WATimeUtils","WAWebABProps","WAWebABPropsLocalStorage","WAWebAbPropsSyncJob","WAWebApiChat","WAWebApiParticipantStore","WAWebApiTasksScheduledTime","WAWebApiTextStatus","WAWebBizGatingUtils","WAWebCleanUtmJob","WAWebContactSyncBridge","WAWebCoreWamIntegration","WAWebDBPruneExpiredOrphanReactions","WAWebDBPruneInvalidSignalSessions","WAWebDBPurgeExpiredRecords","WAWebDBReportingTokenUtils","WAWebFetchQuickPromotions","WAWebLogDailyStatsJob","WAWebLogHistorySyncStatusAfterPairingJob","WAWebMessagingGatingUtils","WAWebMobilePlatforms","WAWebNewsletterCleanupTasks","WAWebNonAddressBookContactsJob","WAWebNonMessageDataRequestMediaHandlingUtils","WAWebPersistedJobDefinitions","WAWebPersistedJobManager","WAWebReportDbVerionsJob","WAWebRestartRecentSyncJob","WAWebSyncContactsJob","WAWebSyncdReportKeyStatsJob","WAWebSyncdReportSyncdStatJob","WAWebSyncdRequestAllSyncdMissingKeysJob","WAWebSyncdSyncAllCollectionsJob","WAWebUserPrefsHistorySync","WAWebUserPrefsMultiDevice","WAWebUserPrefsTabMutex","asyncToGeneratorRuntime","cr:4857","cr:4940","gkx"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["maybeRegisterTask: registering task ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to cleanup reporting token table: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[history sync] do not schedule job for logging history sync status as we've logged for more than 4 times."]);k=function(){return a};return a}function a(){var b=babelHelpers.taggedTemplateLiteralLoose(["wam-core: This tab is in the background, skipping Private Core WAM processing for now"]);a=function(){return b};return b}function e(){var a=babelHelpers.taggedTemplateLiteralLoose(["wam-core: This tab is in the background, skipping Regular Core WAM processing for now"]);e=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to clean expired UTM: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to delete the expired orphan reactions with error: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to delete the expired orphan add-on messages with error: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to delete the expired orphan reactions with error: ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: syncdPeriodicSyncDays is 0, skipping sync"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncContacts: contact sync failed, error: ",""]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to sync non-address book contacts with error: ",""]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["RotateKeyTask skip first run"]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to log daily stats: ",""]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to delete the invalid LID signal sessions: ",""]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["CleanInvalidLidSignalSessions running"]);v=function(){return a};return a}function w(){var a=babelHelpers.taggedTemplateLiteralLoose(["CleanInvalidLidSignalSessions skip first run"]);w=function(){return a};return a}function x(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to update the expired text status of contacts with error: ",""]);x=function(){return a};return a}function y(){var a=babelHelpers.taggedTemplateLiteralLoose(["Update expired text status skip first run"]);y=function(){return a};return a}function z(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to delete the expired TcTokens with error: ",""]);z=function(){return a};return a}function A(){var a=babelHelpers.taggedTemplateLiteralLoose(["CleanTcToken skip first run"]);A=function(){return a};return a}var B=b("$InternalEnum")({CLEAN_TC_TOKENS:"cleanTcTokens",CLEAN_INVALID_LID_SIGNAL_SESSIONS:"cleanInvalidLidSignalSessions",LOG_DAILY_STATS:"logDailyStats",LOG_DB_ROW_COUNTS:"logDbRowCounts",ROTATE_KEY:"rotateKey",SYNC_AB_PROPS:"syncAbProps",SYNC_CONTACTS:"syncContacts",MONITOR_DB_STORAGE:"monitorDbStorage",REPORT_SYNCD_ACTION_STAT:"reportSyncdActionStat",LT_HASH_CHECK:"ltHashCheck",REQUEST_ALL_SYNCD_MISSING_KEYS:"requestAllSyncdMissingKeys",REPORT_SYNCD_KEY_STATS:"reportSyncdKeyStats",SYNCD_SYNC_ALL_COLLECTIONS:"syncdSyncAllCollections",CLEAN_ORPHAN_REACTIONS:"cleanOrphanReactions",CLEAN_ORPHAN_ADD_ONS:"cleanOrphanAddOns",CLEAN_PAST_PARTICIPANTS:"cleanPastParticipants",CLEAN_EXPIRED_UTM:"cleanExpiredUtm",SEND_REGULAR_WAM_EVENTS:"sendCoreWamRegularMetrics",SEND_PRIVATE_WAM_EVENTS:"sendCoreWamPrivateMetrics",SEND_NON_MESSAGE_DATA_REQUEST:"sendNonMessageDataRequest",LOG_HISTORY_SYNC_STATUS_AFTER_PAIRING:"logHistorySyncStatusAfterPairing",DELETE_NEWSLETTER_PREVIEW_CHATS:"deleteNewsletterPreviewChats",REPORT_DB_VERSIONS:"reportDbVersions",UPDATE_EXPIRED_TEXT_STATUS:"updateExpiredTextStatus",RESTART_RECENT_SYNC:"restartRecentSync",CLEANUP_REPORTING_TOKEN_TABLE:"cleanupReportingTokenTable",FETCH_QUICK_PROMOTIONS:"fetchQuickPromotions"}),C=[B.CLEAN_TC_TOKENS,B.CLEAN_INVALID_LID_SIGNAL_SESSIONS,B.LOG_DAILY_STATS,B.ROTATE_KEY,B.SYNC_AB_PROPS,B.SYNC_CONTACTS,B.MONITOR_DB_STORAGE,B.REPORT_SYNCD_ACTION_STAT,B.LT_HASH_CHECK,B.REQUEST_ALL_SYNCD_MISSING_KEYS,B.REPORT_SYNCD_KEY_STATS,B.SYNCD_SYNC_ALL_COLLECTIONS,B.CLEAN_ORPHAN_REACTIONS,B.CLEAN_ORPHAN_ADD_ONS,B.CLEAN_EXPIRED_UTM,B.SEND_REGULAR_WAM_EVENTS,B.SEND_PRIVATE_WAM_EVENTS,B.SEND_NON_MESSAGE_DATA_REQUEST,B.LOG_HISTORY_SYNC_STATUS_AFTER_PAIRING,B.DELETE_NEWSLETTER_PREVIEW_CHATS,B.REPORT_DB_VERSIONS,B.UPDATE_EXPIRED_TEXT_STATUS,B.RESTART_RECENT_SYNC,B.CLEANUP_REPORTING_TOKEN_TABLE],D=[B.FETCH_QUICK_PROMOTIONS],E=[B.LOG_DB_ROW_COUNTS];function F(a){switch(a){case B.MONITOR_DB_STORAGE:return function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(c("gkx")("26258"))return d("WATaskScheduler").DO_NOT_RESCHEDULE;a=(yield b("cr:4857")==null?void 0:b("cr:4857").shouldMonitorDbStorageUsageJob());return a?d("WATimeUtils").HOUR_SECONDS:d("WATaskScheduler").DO_NOT_RESCHEDULE});return function(b){return a.apply(this,arguments)}}();case B.CLEAN_TC_TOKENS:return function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a)d("WALogger").LOG(A());else try{yield d("WAWebApiChat").pruneExpiredTcTokens(),yield d("WAWebApiChat").pruneExpiredOrphanTcTokens()}catch(a){d("WALogger").ERROR(z(),a).verbose().devConsole(a)}return d("WATimeUtils").DAY_SECONDS});return function(b){return a.apply(this,arguments)}}();case B.UPDATE_EXPIRED_TEXT_STATUS:return function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a)d("WALogger").LOG(y());else try{yield d("WAWebApiTextStatus").updateExpiredTextStatusOfContact()}catch(a){d("WALogger").ERROR(x(),a).verbose().devConsole(a)}return d("WATimeUtils").DAY_SECONDS});return function(b){return a.apply(this,arguments)}}();case B.CLEAN_INVALID_LID_SIGNAL_SESSIONS:return function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a)d("WALogger").LOG(w());else try{d("WALogger").LOG(v()),yield d("WAWebDBPruneInvalidSignalSessions").cleanInvalidLidSignalSessions()}catch(a){d("WALogger").ERROR(u(),a).verbose().devConsole(a)}return d("WATimeUtils").DAY_SECONDS});return function(b){return a.apply(this,arguments)}}();case B.LOG_DAILY_STATS:return function(){return d("WAWebLogDailyStatsJob").logDailyStatsJob()["catch"](function(a){d("WALogger").ERROR(t(),a).verbose().devConsole(a)}).then(function(){return d("WATimeUtils").DAY_SECONDS})};case B.LOG_DB_ROW_COUNTS:if(!c("gkx")("26258")){var e=120,f=7200;return function(){self.setTimeout(function(){b("cr:4940")==null?void 0:b("cr:4940").logStorageTableRowCounts()},e*1e3);return(h||(h=b("Promise"))).resolve(f)}}else break;case B.ROTATE_KEY:return function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a?d("WALogger").LOG(s()):yield d("WAWebPersistedJobManager").getJobManager().waitUntilCompleted(d("WAWebPersistedJobDefinitions").jobSerializers.rotateKey());return 27*d("WATimeUtils").DAY_SECONDS});return function(b){return a.apply(this,arguments)}}();case B.SYNC_AB_PROPS:return function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a||(yield d("WAWebAbPropsSyncJob").syncABPropsTask());return d("WAWebABPropsLocalStorage").getRefresh()});return function(b){return a.apply(this,arguments)}}();case B.SYNC_CONTACTS:return function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(!a){try{yield d("WAWebNonAddressBookContactsJob").getNonAddressBookContactsAndMarkAllContactsDirty()}catch(a){d("WALogger").ERROR(r(),a).verbose().devConsole(a)}try{yield d("WAWebContactSyncBridge").contactSync()}catch(a){d("WALogger").ERROR(q(),a).verbose().tags("non-sad","contact-sync").sendLogs("syncContacts: contact sync failed")}}return d("WAWebSyncContactsJob").getContactSyncRefreshSeconds()});return function(b){return a.apply(this,arguments)}}();case B.REPORT_SYNCD_ACTION_STAT:return function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a||(yield d("WAWebSyncdReportSyncdStatJob").reportSyncdStatsJob());return d("WATimeUtils").DAY_SECONDS});return function(b){return a.apply(this,arguments)}}();case B.LT_HASH_CHECK:return function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=d("WAWebABProps").getABPropConfigValue("lthash_check_hours");if(b===0)return 24*d("WATimeUtils").HOUR_SECONDS;a||(yield d("WASyncdAntiTampering").checkLtHash());return b*d("WATimeUtils").HOUR_SECONDS});return function(b){return a.apply(this,arguments)}}();case B.REQUEST_ALL_SYNCD_MISSING_KEYS:return function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a||(yield d("WAWebSyncdRequestAllSyncdMissingKeysJob").requestAllSyncdMissingKeysJob());return d("WATimeUtils").HOUR_SECONDS*6});return function(b){return a.apply(this,arguments)}}();case B.REPORT_SYNCD_KEY_STATS:return function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a||(yield d("WAWebSyncdReportKeyStatsJob").reportSyncdKeyStatsJob());return c("gkx")("26258")?d("WATimeUtils").DAY_SECONDS*3:d("WATimeUtils").DAY_SECONDS});return function(b){return a.apply(this,arguments)}}();case B.SYNCD_SYNC_ALL_COLLECTIONS:return function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=d("WAWebABProps").getABPropConfigValue("syncd_periodic_sync_days");if(b===0){d("WALogger").LOG(p());return d("WATimeUtils").DAY_SECONDS}a||(yield d("WAWebSyncdSyncAllCollectionsJob").syncdSyncAllCollectionsJob());return d("WATimeUtils").DAY_SECONDS*b});return function(b){return a.apply(this,arguments)}}();case B.CLEAN_ORPHAN_REACTIONS:return b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{yield d("WAWebDBPruneExpiredOrphanReactions").pruneExpiredOrphanReactions()}catch(a){d("WALogger").ERROR(o(),a).verbose().devConsole(a)}return d("WATimeUtils").DAY_SECONDS});case B.CLEAN_ORPHAN_ADD_ONS:var g=30,i=90;return b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{yield d("WAWebDBPurgeExpiredRecords").purgeExpiredOrphanRecords(g,i)}catch(a){d("WALogger").ERROR(n(),a).verbose().devConsole(a)}return d("WATimeUtils").DAY_SECONDS});case B.CLEAN_PAST_PARTICIPANTS:return b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{yield d("WAWebApiParticipantStore").pruneExpiredPastParticipants()}catch(a){d("WALogger").ERROR(m(),a).verbose().devConsole(a)}return d("WATimeUtils").DAY_SECONDS});case B.CLEAN_EXPIRED_UTM:return function(){return!d("WAWebBizGatingUtils").isUtmTrackingEnabled()?(h||(h=b("Promise"))).resolve(d("WATaskScheduler").DO_NOT_RESCHEDULE):d("WAWebCleanUtmJob").cleanExpiredUtmJob()["catch"](function(a){d("WALogger").ERROR(l(),a).verbose().devConsole(a)}).then(function(){return d("WATimeUtils").DAY_SECONDS})};case B.SEND_REGULAR_WAM_EVENTS:return b("asyncToGeneratorRuntime").asyncToGenerator(function*(){return d("WATaskScheduler").DO_NOT_RESCHEDULE;if(!d("WAWebUserPrefsTabMutex").currentTabHasMutex()){d("WALogger").WARN(_templateObject17());return d("WATaskScheduler").DO_NOT_RESCHEDULE}yield d("WAWebCoreWamIntegration").uploadRegularCoreWamEvents();return d("WATimeUtils").FIVE_MINUTES});case B.SEND_PRIVATE_WAM_EVENTS:return b("asyncToGeneratorRuntime").asyncToGenerator(function*(){return d("WATaskScheduler").DO_NOT_RESCHEDULE;if(!d("WAWebUserPrefsTabMutex").currentTabHasMutex()){d("WALogger").WARN(_templateObject18());return d("WATaskScheduler").DO_NOT_RESCHEDULE}yield d("WAWebCoreWamIntegration").uploadPrivateCoreWamEvents();return d("WATimeUtils").FIVE_MINUTES});case B.SEND_NON_MESSAGE_DATA_REQUEST:return b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield d("WAWebNonMessageDataRequestMediaHandlingUtils").retryNonMessageDataRequestJob();return d("WATimeUtils").HOUR_SECONDS*23});case B.DELETE_NEWSLETTER_PREVIEW_CHATS:return b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield d("WAWebNewsletterCleanupTasks").deletePreviewNewsletters();return d("WATimeUtils").HOUR_SECONDS*4});case B.REPORT_DB_VERSIONS:return b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield d("WAWebReportDbVerionsJob").reportDbVersionsJob();return d("WATimeUtils").DAY_SECONDS*3});case B.LOG_HISTORY_SYNC_STATUS_AFTER_PAIRING:return b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=d("WAWebUserPrefsMultiDevice").getPairingTimestamp();if(a!=null){var b;b=(b=(yield d("WAWebUserPrefsHistorySync").getHistorySyncStatusAfterPairingLoggingCount()))!=null?b:0;if(b>=5){d("WALogger").LOG(k());return d("WATaskScheduler").DO_NOT_RESCHEDULE}yield d("WAWebLogHistorySyncStatusAfterPairingJob").logHistorySyncStatusAfterPairingJob(a,b);return b===0?d("WATimeUtils").MINUTE_SECONDS*5:d("WATimeUtils").MINUTE_SECONDS*10}return 10});case B.RESTART_RECENT_SYNC:return b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=d("WAWebUserPrefsMultiDevice").getPairingTimestamp();if(a!=null){a=(d("WATimeUtils").unixTime()-a)/60;a>=5&&(yield d("WAWebRestartRecentSyncJob").restartRecentSyncJob());return d("WATimeUtils").MINUTE_SECONDS*5}return 10});case B.CLEANUP_REPORTING_TOKEN_TABLE:return b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{yield d("WAWebDBReportingTokenUtils").cleanupReportingTokenTable(d("WAWebMessagingGatingUtils").getReportingTagCleanupDays())}catch(a){d("WALogger").ERROR(j(),a).tags("messaging","wa-ice","report-token").devConsole(a)}return d("WATimeUtils").DAY_SECONDS});case B.FETCH_QUICK_PROMOTIONS:return b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield d("WAWebFetchQuickPromotions").fetchQuickPromotions();return d("WAWebBizGatingUtils").qpGraphQLFetchIntervalMinutes()*d("WATimeUtils").MINUTE_SECONDS})}}function G(){return{scheduledTimeResolver:{get:function(a){return d("WAWebApiTasksScheduledTime").getTaskScheduledTime(String(a))},set:function(a,b){return d("WAWebApiTasksScheduledTime").updateTaskScheduledTime(String(a),b)}}}}function H(a){var b=F(a);b!=null&&(d("WALogger").LOG(i(),a),d("WATaskScheduler").registerTask(a,b))}function f(){d("WATaskScheduler").startScheduler(G()),C.forEach(H),d("WAWebMobilePlatforms").isSMB()&&D.forEach(H),c("gkx")("26258")||E.forEach(H)}g.registerTasks=f}),98);
__d("WASmaxOutServerPropsBaseIQGetRequestMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("iq",{id:d("WAWap").generateId(),type:"get"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBaseIQGetRequestMixin=a}),98);
__d("WASmaxOutServerPropsGetV2Request",["WASmaxJsx","WASmaxOutServerPropsBaseIQGetRequestMixin","WAWap"],(function(a,b,c,d,e,f,g){function a(a){a=a.propsHash;a=d("WASmaxOutServerPropsBaseIQGetRequestMixin").mergeBaseIQGetRequestMixin(d("WASmaxJsx").smax("iq",{to:d("WAWap").S_WHATSAPP_NET,xmlns:"w"},d("WASmaxJsx").smax("props",{protocol:"2",hash:d("WAWap").CUSTOM_STRING(a)})));return a}g.makeGetV2Request=a}),98);
__d("WAWebQueryServerPropsJob",["WADeprecatedSendIq","WADeprecatedWapParser","WASmaxOutServerPropsGetV2Request","WAWebUserPrefsGeneral","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h=new(c("WADeprecatedWapParser"))("serverProps",function(a){a.assertTag("iq");a.assertAttr("from","s.whatsapp.net");a=a.child("props");var b={serverPropsVersion:a.attrInt("version")};a.forEachChildWithTag("prop",function(a){switch(a.attrString("name")){case"ephemeral_messages_allowed_values":b.ephemeralMessagesAllowedValues=a.attrString("value");break;case"gif_provider":b.gifProvider=a.attrInt("value")===1?"giphy":"tenor";break;case"group_call_max_participants":b.groupCallMaxParticipants=a.attrInt("value",0);break;case"group_description_length":b.groupDescLength=a.attrInt("value");break;case"hfm_string_changes":b.hfmStringChanges=a.attrInt("value")===1;break;case"image_quality":b.imageQuality=a.attrInt("value")/100;break;case"max_participants":b.maxParticipants=a.attrInt("value")-1;break;case"max_subject":b.maxSubject=a.attrInt("value");break;case"max_keys":b.maxKeys=a.attrInt("value");break;case"media":b.media=a.attrInt("value")*1024*1024;break;case"mms_media_key_ttl":b.mmsMediaKeyTTL=a.attrInt("value");break;case"wallpapers_v2":b.wallpapersV2=a.attrInt("value")===1;break;case"shops_product_grid":b.shopsProductGrid=a.attrInt("value",0)===1;break;case"syncd_inline_mutations_max_count":b.syncdInlineMutationsMaxCount=a.attrInt("value");break;case"syncd_patch_protobuf_max_size":b.syncdPatchProtobufMaxSize=a.attrInt("value");break;case"syncd_key_max_use_days":b.syncdKeyMaxUseDays=a.attrInt("value");break;case"syncd_wait_for_key_timeout_days":b.syncdWaitForKeyTimeoutDays=a.attrInt("value");break;case"syncd_additional_mutations":b.syncdAdditionalMutations=a.attrInt("value");break;case"syncd_sentinel_timeout_seconds":b.syncdSentinelTimeoutSeconds=a.attrInt("value");break;case"md_pin_chat_enabled":b.syncdPinChatEnabled=a.attrInt("value")===1;break;case"syncd_qpl_logging_enabled":b.syncdQPLLoggingEnabled=a.attrInt("value")===1;break;case"web_biz_profile_options":b.webBizProfileOptions=a.attrInt("value");break;case"web_download_status_thumb_mms_enabled":b.webDownloadStatusThumbMmsEnabled=a.attrInt("value")===1;break;case"web_send_document_thumb_in_message_disabled":b.webSendDocumentThumbInMessageDisabled=a.attrInt("value")===1;break;case"web_voip_mac_os_min_version":b.webVoipMacOsMinVersion=a.attrString("value");break;case"web_voip_windows_os_min_version":b.webVoipWindowsOsMinVersion=a.attrString("value");break;case"mms_cat_v1_forward_hot_override_enabled":b.mmsCatV1ForwardHotOverrideEnabled=a.attrInt("value")===1;break;case"ptt_conversation_waveform":b.pttConversationWaveform=a.attrInt("value")===1;break;case"ptt_oot_playback":b.pttOotPlayback=a.attrInt("value")===1;break;case"ptt_pausable_enabled":b.pttPausableEnabled=a.attrInt("value")===1;break;case"ptt_playback_speed_enabled":b.pttPlaybackSpeedEnabled=a.attrInt("value")===1;break;case"web_product_list_message_page_size":b.webProductListMessagePageSize=a.attrInt("value");break;case"ptt_remember_play_position":b.pttRememberPlayPosition=a.attrInt("value")===1;break;case"max_electron_file_size":b.maxElectronFileSize=a.attrInt("value")*1024*1024;break;case"max_file_size":b.maxFileSize=a.attrInt("value")*1024*1024;break;case"web_log_upload_download_crashes":b.webLogUploadDownloadCrashes=a.attrInt("value")===1;break;case"web_graphql_for_catalog_m1":b.webGraphQLForCatalogM1=a.attrInt("value")===1;break;case"web_md_mms_sync_deletion_request":b.webMdMmsSyncDeletionRequest=a.attrInt("value")===1;break;case"web_payment_background_enabled":b.webPaymentBackgroundEnabled=a.attrInt("value")===1;break;case"streaming_upload_chunk_size":b.streamingUploadChunkSize=a.attrInt("value")*1024*1024;break}});return{values:b,attributes:{protocol:a.maybeAttrInt("protocol"),version:a.attrInt("version"),hash:a.maybeAttrString("hash"),refresh:a.maybeAttrInt("refresh")}}});function a(){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WAWebUserPrefsGeneral").getServerPropsAttributes());a=d("WASmaxOutServerPropsGetV2Request").makeGetV2Request({propsHash:(a=a==null?void 0:a.hash)!=null?a:""});return d("WADeprecatedSendIq").deprecatedSendIq(a,h)});return i.apply(this,arguments)}g["default"]=a}),98);
__d("WAWebUpdateServerPropsJob",["WAFilteredCatch","WALogger","WAWebBackendErrors","WAWebQueryServerPropsJob","WAWebServerPropsModel","WAWebUserPrefsGeneral","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Server props failure: empty server props table"]);h=function(){return a};return a}var i;function a(){if(i)return i;i=c("WAWebQueryServerPropsJob")().then(function(a){if(a.success)return a.result;throw new(d("WAWebBackendErrors").ServerStatusCodeError)(a.errorCode,a.errorText)}).then(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.values;a=a.attributes;if(a.protocol===2){var c,e=(yield d("WAWebUserPrefsGeneral").getServerPropsAttributes());d("WAWebUserPrefsGeneral").setServerPropsAttributes({version:a.version,hash:(c=(c=a.hash)!=null?c:e==null?void 0:e.hash)!=null?c:"",refresh:(e=a.refresh)!=null?e:86400,lastSyncTimeSeconds:Math.floor(Date.now()/1e3)})}else d("WAWebUserPrefsGeneral").setServerPropsAttributes({version:a.version,hash:"",refresh:86400,lastSyncTimeSeconds:Math.floor(Date.now()/1e3)});if(a.protocol===2)if(a.hash==null){c=(yield d("WAWebUserPrefsGeneral").getServerProps());c==null?(d("WAWebUserPrefsGeneral").setServerPropsAttributes({version:a.version,hash:"",refresh:86400,lastSyncTimeSeconds:0}),d("WALogger").ERROR(h()).sendLogs("read-from-empty-server-props-table")):d("WAWebServerPropsModel").ServerProps.updateProps(c)}else d("WAWebUserPrefsGeneral").setServerProps(b),d("WAWebServerPropsModel").ServerProps.updateProps(b);else d("WAWebServerPropsModel").ServerProps.updateProps(b)});return function(b){return a.apply(this,arguments)}}())["catch"](d("WAFilteredCatch").filteredCatch(d("WAWebBackendErrors").ServerStatusCodeError,function(){}))["finally"](function(){i=null});return i}g.queryServerProps=a}),98);
__d("WAWebWamProcessWorkerData",["WALogger","WAShiftTimer","WAWebWamStorage"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to process worker wam data: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["processWorkerWamData ",""]);i=function(){return a};return a}var j=2e4,k=1e4;function l(a){d("WALogger").LOG(i(),a?"start":"run");var b=new(d("WAShiftTimer").ShiftTimer)(function(){c("WAWebWamStorage").processWorkerWamData().then(function(a){a&&l(!1)})["catch"](function(a){d("WALogger").ERROR(h(),a).verbose().devConsole(a)})});b.onOrAfter(a?j:k)}g.processWorkerWamData=l}),98);
__d("WAWebStartBackend",["Promise","WABase64","WABinary","WAComms","WAGzip","WALogger","WAPromiseTimeout","WAWebABPropsWamGlobals","WAWebAdvDeviceInfoCheckJob","WAWebApiContact","WAWebBackendApi","WAWebBackgroundSyncAction","WAWebBizAgentAction","WAWebBizChatAssignmentAction","WAWebBizGatingUtils","WAWebBizUpdateContactsWithVerifiedNamesAction","WAWebBootstrapPremiumMessages","WAWebBuildConstants","WAWebCTWASuggestionInitFromStorage","WAWebChatThreadLogging","WAWebCmd","WAWebCommonCTWADataSharing","WAWebCommsConfig","WAWebCommsHandleStanza","WAWebCrashlog","WAWebCryptoCurve25519","WAWebDbEncryptionKey","WAWebDeleteStatusAction","WAWebEventsWaitForMain","WAWebFeatureDetectionSwSupport","WAWebFetchAdEntryPointsConfiguration","WAWebFtsClient","WAWebGetDefaultExport","WAWebHandleOfflineAbProps","WAWebHistorySyncNotificationUtils","WAWebHistorySyncProgress","WAWebInboxFiltersGatingUtils","WAWebInitFavoritesFromStorage","WAWebInitFromStorage","WAWebInitWaitForEvents","WAWebInitializeBots","WAWebJestE2ELogUtils","WAWebJobLoadQuickPromotions","WAWebL10NCountryCodes","WAWebLazyLoadedMainRequires","WAWebLogoutReason","WAWebLogoutReasonConstants","WAWebMediaHosts","WAWebMergeContactRecordsById","WAWebModelStorage","WAWebNewsletterGatingUtils","WAWebNewsletterMetadataInitFromStorage","WAWebOffdStorage","WAWebOfflineHandler","WAWebOfflineResumeMainThread","WAWebPageLoadLogging","WAWebPassiveModeManager","WAWebPersistedJobManager","WAWebPonyfillsFetch","WAWebPremiumAccessEngine","WAWebPrimaryFeatures","WAWebPushNotificationsGatingUtils","WAWebQplInitMd","WAWebRegisterPassiveTasks","WAWebSWBus","WAWebSWBusActions","WAWebSchemaVerifiedBusinessName","WAWebServerPropsModel","WAWebSignalStoreApi","WAWebSocketModel","WAWebSubscribePushManagerAction","WAWebSubscriptions","WAWebSyncBootstrap","WAWebSyncContactsJob","WAWebSyncd","WAWebTasksDefinitions","WAWebTimeSpentLoggingSession","WAWebTos","WAWebURLUtils","WAWebUpdateServerPropsJob","WAWebUserPrefsCookie","WAWebUserPrefsGeneral","WAWebUserPrefsIndexedDBStorage","WAWebUserPrefsKeys","WAWebUserPrefsLocales","WAWebUserPrefsMeUser","WAWebUserPrefsMultiDevice","WAWebWamGlobals","WAWebWamOfflineResumeReporter","WAWebWamProcessWorkerData","WAWebWidFactory","asyncToGeneratorRuntime","cr:3979","cr:4066","gkx"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[push-notification] Failed to close existing notifications, error: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[push-notification] Failed to request stopComms for service worker, error: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[removeInvalidRowsInVerifiedBusinessNameTable] "," invalid ids are removed"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[removeInvalidRowsInVerifiedBusinessNameTable] invalid id: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[removeInvalidRowsInVerifiedBusinessNameTable] start"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Chatd login cookie request errored with error msg ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Requesting chatd login cookie complete"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["init worker: error while calling startIndexer from initialSetup: ",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["init worker: startIndexer from initialSetup"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["[history sync][continueProgressiveHistorySyncProcessingV2] start backend"]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["Requesting chatd login cookie"]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["[bootstrap] need to sync critical data: false"]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["[startBackend]: connected as ",""]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["startBackendRegistered: chatd user not registered"]);v=function(){return a};return a}function w(){var a=babelHelpers.taggedTemplateLiteralLoose(["storage initialization error, logging out"]);w=function(){return a};return a}function x(){var a=babelHelpers.taggedTemplateLiteralLoose(["[StartBackend] initial setup failed:"]);x=function(){return a};return a}function y(){var a=babelHelpers.taggedTemplateLiteralLoose(["[StartBackend]: complete initial setup"]);y=function(){return a};return a}function z(){var a=babelHelpers.taggedTemplateLiteralLoose(["[StartBackend]: start initial setup"]);z=function(){return a};return a}d("WAWebCmd").Cmd.once("offline_delivery_end",b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{d("WALogger").LOG(z()),yield J(),d("WALogger").LOG(y())}catch(a){d("WALogger").LOG(x()).devConsole(a)}}));d("WAWebCmd").Cmd.on("storage_initialization_error",b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(!d("WAWebUserPrefsMultiDevice").isRegistered()&&d("WAWebLogoutReason").getPrevLogoutReasonCode()===d("WAWebLogoutReasonConstants").LOGOUT_REASON_CODE.CLIENT_FATAL)return;d("WALogger").LOG(w());yield d("WAWebSocketModel").Socket.clearCredentialsAndStoredData(d("WAWebLogoutReasonConstants").LogoutReason.ClientFatalError);d("WAWebJestE2ELogUtils").maybeLogToJestE2eJSConsole("logging out due to storage initialization error");d("WAWebCmd").Cmd.logout()}));d("WAWebCmd").Cmd.on("open_socket_stream",function(){!d("WAWebCmd").Cmd.isOfflineDeliveryEnd?d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.logSocketConnectT():d("WAWebHandleOfflineAbProps").isNonBlockingResumeFromOpenTabEnabled()&&(d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.resetEvent(),d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.logSocketConnectT())});var A=function(){void c("WAWebCommonCTWADataSharing").fetchDataSharingSettingAndUpdateModel()};function a(){return B.apply(this,arguments)}function B(){B=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){d("WAWebPageLoadLogging").startPageLoadQplMeasure("startBackend");var a=(yield C());d("WAWebPageLoadLogging").endPageLoadQplMeasure("startBackend");return a});return B.apply(this,arguments)}function C(){return D.apply(this,arguments)}function D(){D=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=d("WAWebSignalStoreApi").waSignalStore.getRegistrationInfo();if(!a){d("WALogger").LOG(v());return}d("WALogger").LOG(u(),d("WAWebUserPrefsMeUser").assertGetMe());try{yield d("WAPromiseTimeout").promiseTimeout(d("WAWebModelStorage").initialize(),20*1e3),yield d("WAPromiseTimeout").promiseTimeout(d("WAWebOffdStorage").initialize(),20*1e3),d("WAWebCrashlog").registerCrashlogUploadIsUserInExternalBetaFunction(d("WAWebUserPrefsGeneral").getWhatsAppWebExternalBetaJoinedIdb)}catch(a){d("WAWebCmd").Cmd.storageInitializationError()}d("WAWebInitWaitForEvents").initOfflineResumeWaitForEvents();void d("WAWebWamOfflineResumeReporter").OfflineResumeReporter.setLastPushCompleteTimestamp();yield P();yield d("WAWebPrimaryFeatures").loadPrimaryFeatures();d("WAWebMediaHosts").mediaHosts.maybeLoadMediaConnFromStorage();yield R();G();d("WAWebABPropsWamGlobals").setAbPropDependingGlobalWamAttributes();yield d("WAWebUserPrefsIndexedDBStorage").userPrefsIdb.set(d("WAWebUserPrefsKeys").KEYS.LANG,c("WAWebUserPrefsLocales").getLangPref()||"en");d("WAWebTimeSpentLoggingSession").restoreTimeSpentSession();yield d("WAWebChatThreadLogging").initChatThreadLogging();yield d("WAWebPersistedJobManager").startWebPersistedJobManager();d("WAWebOfflineResumeMainThread").setupMainThreadResume(d("WAWebOfflineHandler").OfflineMessageHandler);yield d("WAComms").startHandlingRequests();yield d("WAWebDbEncryptionKey").DbEncKeyStore.waitForFinalDbMsgEncKey();c("gkx")("26260")&&(Boolean(b("cr:3979")==null?void 0:b("cr:3979").getDebugEnableOfflineMock())&&(yield b("cr:4066")==null?void 0:b("cr:4066")()));yield d("WAWebPassiveModeManager").PassiveTaskManager.waitForPassiveTaskEnd();yield d("WAWebSyncd").initialize();a=!(yield c("WAWebSyncBootstrap").isCriticalDataSynced());a?yield c("WAWebSyncBootstrap").syncCriticalData():d("WALogger").LOG(t());d("WAWebBackendApi").frontendFireAndForget("handleDeferredMessages",{});d("WAWebServerPropsModel").ServerProps.serverPropsVersion==null&&(yield d("WAWebUpdateServerPropsJob").queryServerProps());yield H();void d("WAWebTos").TosManager.run();d("WAWebQplInitMd").startQPL();yield d("WAWebPremiumAccessEngine").initialize(d("WAWebBizGatingUtils").getBillingPremiumAccessConfig());void d("WAWebSubscriptions").runSubscriptionsManager();void d("WAWebSubscribePushManagerAction").updatePushManager();void d("WAWebBackgroundSyncAction").updatePeriodicBackgroundSyncRegistration();void N();void d("WAWebMergeContactRecordsById").mergeContactRecordsById();A();void d("WAWebInitializeBots").initializeBots();d("WAWebUserPrefsCookie").updateAppBuildCookieIfRequired()});return D.apply(this,arguments)}function E(a){return F.apply(this,arguments)}function F(){F=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a===void 0&&(a={passive:!1,pull:!0});d("WAWebPageLoadLogging").startPageLoadQplMeasure("startWebComms");a=d("WAWebCommsConfig").getCommsConfig(a);!c("gkx")("26256")&&c("gkx")("26257")&&!c("gkx")("26258")&&!d("WAWebBuildConstants").LOCALHOST_ENV_CONFIG&&(d("WALogger").DEV(s()).tags("StartBackend"),yield L());yield c("WAWebEventsWaitForMain")();d("WAComms").startComms(c("WAWebCommsHandleStanza"),a,function(a){return(h||(h=b("Promise"))).resolve(d("WAGzip").inflate(a))});yield d("WAComms").waitForConnection();d("WAWebPageLoadLogging").endPageLoadQplMeasure("startWebComms")});return F.apply(this,arguments)}function G(){var a;a=(a=d("WAWebUserPrefsMeUser").getMaybeMeUser())==null?void 0:a.user;a!=null&&d("WAWebWamGlobals").Global.set({psCountryCode:d("WAWebL10NCountryCodes").getCountryShortcodeByPhone(a)})}function H(){return I.apply(this,arguments)}function I(){I=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a;void d("WAWebBizUpdateContactsWithVerifiedNamesAction").applyContactBusinessProps();void (a=d("WAWebInitFromStorage")).restoreLabels();void a.restoreQuickReplies();void a.restoreLabelAssociations();void a.restoreCarts();void d("WAWebBootstrapPremiumMessages").restorePremiumMessages();d("WAWebBizGatingUtils").smbNotesV1Enabled()&&void d("WAWebInitFromStorage").restoreNotes();d("WAWebBootstrapPremiumMessages").bindPremiumMessageListeners();yield d("WAWebInitFromStorage").restoreArchiveV2Settings();yield d("WAWebInitFromStorage").restoreAgents().then(d("WAWebBizAgentAction").initializeAgentLog);d("WAWebBizChatAssignmentAction").checkOrphanAssignments();void d("WAWebInitFromStorage").restoreChatAssignments();void d("WAWebCTWASuggestionInitFromStorage").restoreCTWASuggestions(d("WAWebBackendApi").frontendFireAndForget);void d("WAWebJobLoadQuickPromotions").loadQuickPromotions();void d("WAWebFetchAdEntryPointsConfiguration").fetchAdEntryPointsConfiguration()});return I.apply(this,arguments)}function J(){return K.apply(this,arguments)}function K(){K=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){void d("WAWebApiContact").flushLidPnMappingsToDb(),d("WALogger").LOG(r()),void c("WAWebSyncBootstrap").continueProgressiveHistorySyncProcessingV2(d("WAWebHistorySyncNotificationUtils").HistorySyncScheduleSource.BackendStart),d("WALogger").LOG(q()),d("WAWebFtsClient").ftsClient.startIndexer()["catch"](function(a){d("WALogger").WARN(p(),a)}),void d("WAWebLazyLoadedMainRequires").requireStatusV3Collection().then(function(a){void a.sync().then(function(){void d("WAWebDeleteStatusAction").clearStatusForRemovedContact()})}),d("WAWebTasksDefinitions").registerTasks(),d("WAWebPushNotificationsGatingUtils").canSupportOfflineNotifications()&&d("WAWebWamProcessWorkerData").processWorkerWamData(!0),yield d("WAWebSyncContactsJob").runSyncDirtyContactsJob(),void d("WAWebInitFromStorage").restoreRecentStickers(),void d("WAWebInitFromStorage").restoreFavoriteStickers(),void d("WAWebAdvDeviceInfoCheckJob").scheduleAdvDeviceInfoCheck(),void d("WAWebInitFromStorage").restoreCommunityActivity(),void d("WAWebHistorySyncProgress").updateHistorySyncProgressModel(),void d("WAWebInitFromStorage").restoreMediaUploadResult(),void d("WAWebInitFromStorage").restoreUnjoinedSubgroups(),d("WAWebNewsletterGatingUtils").isNewsletterEnabled()&&void d("WAWebNewsletterMetadataInitFromStorage").restoreNewsletterMetadata(),d("WAWebInboxFiltersGatingUtils").inboxFavoritesEnabled()&&void d("WAWebInitFavoritesFromStorage").restoreFavorites()});return K.apply(this,arguments)}function L(){return M.apply(this,arguments)}function M(){M=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WAWebSignalStoreApi").waSignalStore.getRegistrationInfo()),b=(yield d("WAWebUserPrefsMultiDevice").getMdLoginCookieRequestComplete()),e=d("WAWebUserPrefsMeUser").assertGetMe().toString();if(b||e==null||a==null)return;b=new Uint8Array([6,4]);var f=(yield self.crypto.subtle.digest({name:"SHA-256"},a.identityKeyPair.pubKey));e=new TextEncoder().encode(e);e=new(d("WABinary").Binary)(e).readBuffer();f=d("WABinary").Binary.build(f,e).readBuffer();e=d("WABinary").Binary.build(b,f).readBuffer();b=(yield d("WAWebCryptoCurve25519").calculateSignature(a.identityKeyPair,e));a=d("WABinary").Binary.build(b,f).readByteArray().buffer;e=d("WABase64").encodeB64UrlSafe(a);b={attestation:e};f=(yield d("WAWebUserPrefsMultiDevice").getRoutingInfo());a=f?f.edgeRouting:null;e=a?d("WABase64").encodeB64UrlSafe(a):null;e!=null&&(b.ED=e);f=c("gkx")("26258")?"https://web.whatsapp.com/ws/chat":"https://dev-web.whatsapp.com/ws/chat";a=c("WAWebURLUtils").build(f,b);try{e=(yield c("WAWebPonyfillsFetch")(a,{method:"post"}));e.ok&&(d("WALogger").DEV(o()).tags("StartBackend"),yield d("WAWebUserPrefsMultiDevice").setMdLoginCookieRequestComplete())}catch(a){d("WALogger").ERROR(n(),a.message).tags("WAWebStartBackend")}});return M.apply(this,arguments)}function N(){return O.apply(this,arguments)}function O(){O=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(c("gkx")("26258"))return;if(d("WAWebUserPrefsGeneral").getVerifiedBusinessNameIsCleaned())return;d("WALogger").LOG(m());var a=(yield d("WAWebSchemaVerifiedBusinessName").getVerifiedBusinessNameTable().all());a=a.map(function(a){a=a.id;try{d("WAWebWidFactory").createUserWid(a);return null}catch(b){d("WALogger").LOG(l(),a);return a}}).filter(function(a){return a!=null});yield d("WAWebSchemaVerifiedBusinessName").getVerifiedBusinessNameTable().bulkRemove(a);d("WALogger").LOG(k(),a.length);d("WAWebUserPrefsGeneral").markVerifiedBusinessNameIsCleaned()});return O.apply(this,arguments)}function P(){return Q.apply(this,arguments)}function Q(){Q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(d("WAWebPushNotificationsGatingUtils").canSupportOfflineNotifications()){var a=c("WAWebGetDefaultExport")(b("WAWebFeatureDetectionSwSupport"));if(a.supported){var e;a=c("WAWebGetDefaultExport")(b("WAWebSWBus"));var f=c("WAWebGetDefaultExport")(b("WAWebSWBusActions"));((e=window.navigator.serviceWorker)==null?void 0:e.controller)&&(yield a.request(window.navigator.serviceWorker.controller,f.STOP_COMMS)["catch"](function(a){d("WALogger").WARN(j(),a)}));(e=window.navigator.serviceWorker)==null?void 0:(a=e.ready)==null?void 0:a.then(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(a=(yield a==null?void 0:a.getNotifications==null?void 0:a.getNotifications()))!=null?a:[];a.forEach(function(a){return a.close()})});return function(b){return a.apply(this,arguments)}}())["catch"](function(a){d("WALogger").WARN(i(),a)})}}});return Q.apply(this,arguments)}function R(){return S.apply(this,arguments)}function S(){S=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a={pull:!0};yield d("WAWebRegisterPassiveTasks").registerPassiveTaskForStartUp();yield E(a)});return S.apply(this,arguments)}g.startBackend=a;g.startWebComms=E}),98);
__d("WABackendHandleError",["Promise","WADeprecatedWapParser","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unknown error code: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Invalid stanza sent (smax-invalid)"]);j=function(){return a};return a}var k={SMAX_INVALID:479},l=new(c("WADeprecatedWapParser"))("errorParser",function(a){a.assertTag("error");a=a.attrInt("code");switch(a){case k.SMAX_INVALID:return m();default:return n(a)}});function a(a){l.parse(a);return(h||(h=b("Promise"))).resolve("NO_ACK")}function m(){d("WALogger").ERROR(j()).devConsole("check tracelogs for more info").sendLogs("smax-invalid")}function n(a){d("WALogger").ERROR(i(),a).sendLogs("unknown-error-code")}g.backendErrorParser=l;g.handleError=a}),98);
__d("WAHandleChatStateProtocol",[],(function(a,b,c,d,e,f){"use strict";function a(a){var b;a.name==="Paused"?b="idle":(a.name,b=a.value.composingMedia==="audio"?"recording_audio":"typing");return b}f.parseChatStatus=a}),66);
__d("WASmaxInChatstateComposingMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"chatstate");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"composing");if(!b.success)return b;a=d("WASmaxParseUtils").optionalLiteral(d("WASmaxParseUtils").attrString,b.value,"media","audio");return!a.success?a:d("WAResultOrError").makeResult({composingMedia:a.value})}g.parseComposingMixin=a}),98);
__d("WASmaxInChatstatePausedMixin",["WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"chatstate");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"paused");return!b.success?b:d("WASmaxParseUtils").voidSuccess}g.parsePausedMixin=a}),98);
__d("WASmaxInChatstateComposingOrPausedMixinGroup",["WAResultOrError","WASmaxInChatstateComposingMixin","WASmaxInChatstatePausedMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInChatstateComposingMixin").parseComposingMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"Composing",value:b.value});var c=d("WASmaxInChatstatePausedMixin").parsePausedMixin(a);return c.success?d("WAResultOrError").makeResult({name:"Paused",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["Composing","Paused"],[b,c])}g.parseComposingOrPausedMixinGroup=a}),98);
__d("WASmaxInChatstateFromGroupMixin",["WAResultOrError","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"chatstate");if(!b.success)return b;b=d("WASmaxParseJid").attrGroupJid(a,"from");if(!b.success)return b;var c=d("WASmaxParseJid").attrUserJid(a,"participant");if(!c.success)return c;a=d("WASmaxParseUtils").optional(d("WASmaxParseJid").attrUserJid,a,"participant_pn");return!a.success?a:d("WAResultOrError").makeResult({from:b.value,participant:c.value,participantPn:a.value})}g.parseFromGroupMixin=a}),98);
__d("WASmaxInChatstateFromUserMixin",["WAResultOrError","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"chatstate");if(!b.success)return b;b=d("WASmaxParseJid").attrUserJid(a,"from");return!b.success?b:d("WAResultOrError").makeResult({from:b.value})}g.parseFromUserMixin=a}),98);
__d("WASmaxInChatstateFromUserOrGroupMixinGroup",["WAResultOrError","WASmaxInChatstateFromGroupMixin","WASmaxInChatstateFromUserMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInChatstateFromUserMixin").parseFromUserMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"FromUser",value:b.value});var c=d("WASmaxInChatstateFromGroupMixin").parseFromGroupMixin(a);return c.success?d("WAResultOrError").makeResult({name:"FromGroup",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["FromUser","FromGroup"],[b,c])}g.parseFromUserOrGroupMixinGroup=a}),98);
__d("WASmaxInChatstateInternalTestMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").flattenedChildWithTag(a,"test");if(!a.success)return a;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,a.value,"config");return!a.success?a:d("WAResultOrError").makeResult({testConfig:a.value})}g.parseInternalTestMixin=a}),98);
__d("WASmaxInChatstateServerNotificationRequest",["WAResultOrError","WASmaxInChatstateComposingOrPausedMixinGroup","WASmaxInChatstateFromUserOrGroupMixinGroup","WASmaxInChatstateInternalTestMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"chatstate");if(!b.success)return b;b=d("WASmaxInChatstateInternalTestMixin").parseInternalTestMixin(a);var c=d("WASmaxInChatstateFromUserOrGroupMixinGroup").parseFromUserOrGroupMixinGroup(a);if(!c.success)return c;a=d("WASmaxInChatstateComposingOrPausedMixinGroup").parseComposingOrPausedMixinGroup(a);return!a.success?a:d("WAResultOrError").makeResult({internalTestMixin:b.success?b.value:null,fromUserOrGroupMixinGroup:c.value,composingOrPausedMixinGroup:a.value})}g.parseServerNotificationRequest=a}),98);
__d("WASmaxChatstateServerNotificationRPC",["WASmaxInChatstateServerNotificationRequest","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxInChatstateServerNotificationRequest").parseServerNotificationRequest(a);if(!a.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("ServerNotification",{Request:a}));return{parsedRequest:a.value}}g.receiveServerNotificationRPC=a}),98);
__d("WACreateHandleChatState",["Promise","WAHandleChatStateProtocol","WAResultOrError","WASmaxChatstateServerNotificationRPC"],(function(a,b,c,d,e,f,g){"use strict";var h,i=(h||b("Promise")).resolve(d("WAResultOrError").makeResult("NO_ACK"));function a(a){var b,c=(b=a.individualMessage)==null?void 0:b.handleIndividualChatState,e=(b=a.groupMessage)==null?void 0:b.handleGroupChatState;return function(a){if(c==null&&e==null)return i;a=d("WASmaxChatstateServerNotificationRPC").receiveServerNotificationRPC(a);a=a.parsedRequest;var b=a.composingOrPausedMixinGroup;a=a.fromUserOrGroupMixinGroup;b=d("WAHandleChatStateProtocol").parseChatStatus(b);if(a.name==="FromUser"){var f;return(f=c==null?void 0:c({status:b,jid:a.value.from}).then(d("WAResultOrError").makeResult))!=null?f:i}else{a.name;return(f=e==null?void 0:e({status:b,jid:a.value.from,participant:a.value.participant,participantPn:a.value.participantPn}).then(d("WAResultOrError").makeResult))!=null?f:i}}}g.createHandleChatState=a}),98);
__d("WAHandleDecisionTreeResult",["WATagsLogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[","] unexpected-runtime-error: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[","] runtime-error ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["unrecognized stanza: ",""]);j=function(){return a};return a}function a(a,b){var c=d("WATagsLogger").TAGS(["decision tree"]);return b.then(function(b){if(b.success)return b.value;else if(b.error.type==="unknown-stanza"){c.ERROR(j(),a);return"NO_ACK"}else{b.error.type;c.ERROR(i(),a.tag,b.error.error);return"NO_ACK"}})["catch"](function(b){c.ERROR(h(),a.tag,b);return"NO_ACK"})}g.handleDecisionTreeResult=a}),98);
__d("WASmaxInMdServerNotificationMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"t",0,void 0);if(!b.success)return b;var c=d("WASmaxParseUtils").attrStanzaId(a,"id");if(!c.success)return c;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,a,"offline",0,1024);return!a.success?a:d("WAResultOrError").makeResult({t:b.value,id:c.value,offline:a.value})}g.parseServerNotificationMixin=a}),98);
__d("WASmaxInMdPrimaryHelloNotifyCompanionRequest",["WAResultOrError","WASmaxInMdServerNotificationMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"link_code_companion_reg");if(!b.success)return b;var c=d("WASmaxParseUtils").flattenedChildWithTag(b.value,"link_code_pairing_wrapped_primary_ephemeral_pub");if(!c.success)return c;var e=d("WASmaxParseUtils").flattenedChildWithTag(b.value,"primary_identity_pub");if(!e.success)return e;var f=d("WASmaxParseUtils").flattenedChildWithTag(b.value,"link_code_pairing_ref");if(!f.success)return f;var g=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","link_code_companion_reg");if(!g.success)return g;var h=d("WASmaxParseJid").literalJid(d("WASmaxParseJid").attrDomainJid,a,"from","s.whatsapp.net");if(!h.success)return h;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,b.value,"stage","primary_hello");if(!b.success)return b;c=d("WASmaxParseUtils").contentBytes(c.value);if(!c.success)return c;e=d("WASmaxParseUtils").contentBytes(e.value);if(!e.success)return e;f=d("WASmaxParseUtils").contentBytes(f.value);if(!f.success)return f;a=d("WASmaxInMdServerNotificationMixin").parseServerNotificationMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({type:g.value,from:h.value,linkCodeCompanionRegStage:b.value,linkCodeCompanionRegLinkCodePairingWrappedPrimaryEphemeralPubElementValue:c.value,linkCodeCompanionRegPrimaryIdentityPubElementValue:e.value,linkCodeCompanionRegLinkCodePairingRefElementValue:f.value},a.value))}g.parsePrimaryHelloNotifyCompanionRequest=a}),98);
__d("WASmaxOutMdNotificationClientAckMixin",["WASmaxJsx","WASmaxMixins","WASmaxParseJid","WASmaxParseReference","WASmaxParseUtils","WASmaxParsingFailure","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseReference").attrFromReference(d("WASmaxParseUtils").attrStanzaId,a,["id"]);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(b.error);var c=d("WASmaxParseReference").attrFromReference(d("WASmaxParseJid").attrDomainJid,a,["from"]);if(!c.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(c.error);a=d("WASmaxParseReference").attrFromReference(d("WASmaxParseUtils").attrString,a,["type"]);if(!a.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(a.error);b=d("WASmaxJsx").smax("ack",{id:d("WAWap").STANZA_ID(b.value),to:d("WAWap").DOMAIN_JID(c.value),"class":"notification",type:d("WAWap").CUSTOM_STRING(a.value)});return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeNotificationClientAckMixin=a}),98);
__d("WASmaxOutMdPrimaryHelloNotifyCompanionResponseAck",["WASmaxJsx","WASmaxOutMdNotificationClientAckMixin"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxOutMdNotificationClientAckMixin").mergeNotificationClientAckMixin(d("WASmaxJsx").smax("ack",null),a);return a}g.makePrimaryHelloNotifyCompanionResponseAck=a}),98);
__d("WASmaxMdPrimaryHelloNotifyCompanionRPC",["WASmaxInMdPrimaryHelloNotifyCompanionRequest","WASmaxOutMdPrimaryHelloNotifyCompanionResponseAck","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInMdPrimaryHelloNotifyCompanionRequest").parsePrimaryHelloNotifyCompanionRequest(a);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("PrimaryHelloNotifyCompanion",{Request:b}));return{parsedRequest:b.value,makePrimaryHelloNotifyCompanionResponseAck:function(){return d("WASmaxOutMdPrimaryHelloNotifyCompanionResponseAck").makePrimaryHelloNotifyCompanionResponseAck(a)}}}g.receivePrimaryHelloNotifyCompanionRPC=a}),98);
__d("WASmaxInMdEnums",[],(function(a,b,c,d,e,f){a={"false":"false","true":"true"};f.ENUM_FALSE_TRUE=a}),66);
__d("WASmaxInMdRefreshCodeNotifyCompanionRequest",["WAResultOrError","WASmaxInMdEnums","WASmaxInMdServerNotificationMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"link_code_companion_reg");if(!b.success)return b;var c=d("WASmaxParseUtils").flattenedChildWithTag(b.value,"link_code_pairing_ref");if(!c.success)return c;var e=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","link_code_companion_reg");if(!e.success)return e;var f=d("WASmaxParseJid").literalJid(d("WASmaxParseJid").attrDomainJid,a,"from","s.whatsapp.net");if(!f.success)return f;var g=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,b.value,"stage","refresh_code");if(!g.success)return g;b=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrStringEnum,b.value,"force_manual_refresh",d("WASmaxInMdEnums").ENUM_FALSE_TRUE);if(!b.success)return b;c=d("WASmaxParseUtils").contentBytes(c.value);if(!c.success)return c;a=d("WASmaxInMdServerNotificationMixin").parseServerNotificationMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({type:e.value,from:f.value,linkCodeCompanionRegStage:g.value,linkCodeCompanionRegForceManualRefresh:b.value,linkCodeCompanionRegLinkCodePairingRefElementValue:c.value},a.value))}g.parseRefreshCodeNotifyCompanionRequest=a}),98);
__d("WASmaxOutMdRefreshCodeNotifyCompanionResponseAck",["WASmaxJsx","WASmaxOutMdNotificationClientAckMixin"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxOutMdNotificationClientAckMixin").mergeNotificationClientAckMixin(d("WASmaxJsx").smax("ack",null),a);return a}g.makeRefreshCodeNotifyCompanionResponseAck=a}),98);
__d("WASmaxMdRefreshCodeNotifyCompanionRPC",["WASmaxInMdRefreshCodeNotifyCompanionRequest","WASmaxOutMdRefreshCodeNotifyCompanionResponseAck","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInMdRefreshCodeNotifyCompanionRequest").parseRefreshCodeNotifyCompanionRequest(a);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("RefreshCodeNotifyCompanion",{Request:b}));return{parsedRequest:b.value,makeRefreshCodeNotifyCompanionResponseAck:function(){return d("WASmaxOutMdRefreshCodeNotifyCompanionResponseAck").makeRefreshCodeNotifyCompanionResponseAck(a)}}}g.receiveRefreshCodeNotifyCompanionRPC=a}),98);
__d("WASmaxInMessageFallbackEnums",["WAJids"],(function(a,b,c,d,e,f,g){b={validators:[(a=d("WAJids")).validateBroadcastJid,a.validateCallJid,a.validateDeviceJid,a.validateDomainJid,a.validateGroupJid,a.validateStatusJid,a.validateUserJid],typeName:"BroadcastJid|CallJid|DeviceJid|DomainJid|GroupJid|StatusJid|UserJid"};g.BROADCASTJID_CALLJID_DEVICEJID_DOMAINJID_GROUPJID_STATUSJID_USERJID=b}),98);
__d("WASmaxOutMessageFallbackDeliverResponseBadStanza",["WASmaxAttrs","WASmaxInMessageFallbackEnums","WASmaxJsx","WASmaxParseJid","WASmaxParseReference","WASmaxParseUtils","WASmaxParsingFailure","WAWap"],(function(a,b,c,d,e,f,g){function a(a,b){a=a.ackError;var c=d("WASmaxParseReference").attrFromReference(d("WASmaxParseUtils").attrStanzaId,b,["id"]);if(!c.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(c.error);var e=d("WASmaxParseReference").attrFromReference(d("WASmaxParseJid").attrJidEnum,b,["from"],d("WASmaxInMessageFallbackEnums").BROADCASTJID_CALLJID_DEVICEJID_DOMAINJID_GROUPJID_STATUSJID_USERJID);if(!e.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(e.error);var f=d("WASmaxParseReference").optionalAttrFromReference(d("WASmaxParseJid").attrJidEnum,b,["participant"],d("WASmaxInMessageFallbackEnums").BROADCASTJID_CALLJID_DEVICEJID_DOMAINJID_GROUPJID_STATUSJID_USERJID);if(!f.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(f.error);b=d("WASmaxParseReference").optionalAttrFromReference(d("WASmaxParseUtils").attrString,b,["type"]);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(b.error);c=d("WASmaxJsx").smax("ack",{"class":"message",id:d("WAWap").STANZA_ID(c.value),to:d("WAWap").JID(e.value),participant:d("WASmaxAttrs").OPTIONAL(d("WAWap").JID,f.value),type:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,b.value),error:d("WAWap").INT(a)});return c}g.makeDeliverResponseBadStanza=a}),98);
__d("WAWebAltDeviceLinkingBase32Encode",[],(function(a,b,c,d,e,f){var g="123456789ABCDEFGHJKLMNPQRSTVWXYZ";function a(a){a=new DataView(a.buffer,a.byteOffset,a.byteLength);var b=0,c=0,d="";for(var e=0;e<a.byteLength;e++){c=c<<8|a.getUint8(e);b+=8;while(b>=5)d+=g[c>>>b-5&31],b-=5}b>0&&(d+=g[c<<5-b&31]);return d}f.bytesToCrockford=a}),66);
__d("WAWebAltDeviceLinkingAlgorithm",["WAArrayBufferUtils","WABinary","WAByteArray","WACryptoHkdf","WALogger","WAWebAltDeviceLinkingApi","WAWebAltDeviceLinkingBase32Encode","WAWebCryptoCurve25519","WAWebSignalStoreApi","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["alt pairing: encrypt key bundle"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["alt pairing: decrypt primary hello"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["alt pairing: encrypt companion hello"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["alt pairing: create adv secret material"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["alt pairing: generate random code"]);l=function(){return a};return a}function m(){d("WALogger").LOG(l());var a=new Uint8Array(5);self.crypto.getRandomValues(a);return d("WAWebAltDeviceLinkingBase32Encode").bytesToCrockford(a)}function n(a,b){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){try{return yield a()}catch(c){(a=d("WAWebAltDeviceLinkingApi").getCurrentMarker())==null?void 0:a.addPoint(b);throw c}});return o.apply(this,arguments)}function p(a,b,c){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){c===void 0&&(c=!1);b=new(d("WABinary").Binary)(b);b=(yield self.crypto.subtle.deriveKey({name:"PBKDF2",hash:"SHA-256",salt:b.readBuffer(),iterations:2<<16},a,{name:"AES-CTR",length:256},c,["encrypt","decrypt"]));return b});return q.apply(this,arguments)}function r(a,b,c){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){d("WALogger").LOG(j());b={name:"AES-CTR",length:64,counter:b};b=(yield self.crypto.subtle.encrypt(b,c,a));return b});return s.apply(this,arguments)}function t(a,b,c){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){d("WALogger").LOG(i());var e={name:"AES-CTR",length:64,counter:b};b=(yield n(function(){return self.crypto.subtle.decrypt(e,c,a)},"fail decrypt primary ephemeral pub"));return b});return u.apply(this,arguments)}function a(){return v.apply(this,arguments)}function v(){v=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=m(),b=d("WAWebCryptoCurve25519").keyPair(),c=new Uint8Array(32);self.crypto.getRandomValues(c);var e=new Uint8Array(16);self.crypto.getRandomValues(e);b=(yield w(a,b,c,e));return babelHelpers["extends"]({},b,{linkCodePairingSecret:a})});return v.apply(this,arguments)}function w(a,b,c,d){return x.apply(this,arguments)}function x(){x=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){a=(yield self.crypto.subtle.importKey("raw",new TextEncoder().encode(a),{name:"PBKDF2"},!1,["deriveKey"]));var f=(yield p(a,c)),g=(yield n(function(){return r(b.pubKey,e,f)},"fail encrypt companion hello")),h=new(d("WABinary").Binary)();h.writeByteArray(c);h.writeByteArray(e);h.writeByteArray(new Uint8Array(g));c=h.readBuffer();return{linkCodePairingWrappedCompanionEphemeralPub:c,linkCodeKey:a,linkCodePairingCompanionADVEphemeralKeyPair:b}});return x.apply(this,arguments)}function y(a,b){return z.apply(this,arguments)}function z(){z=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=(yield d("WACryptoHkdf").extractWithSaltAndExpand(a,b,"link_code_pairing_key_bundle_encryption_key",32));return a});return z.apply(this,arguments)}function A(a,b,c){return d("WAArrayBufferUtils").concatBuffers([a,b,d("WAByteArray").uint8ArrayToBuffer(c)])}function B(a,b,c){return C.apply(this,arguments)}function C(){C=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){d("WALogger").LOG(h());var e=(yield self.crypto.subtle.importKey("raw",a,{name:"AES-GCM"},!1,["encrypt"])),f={name:"AES-GCM",iv:b};a=(yield n(function(){return self.crypto.subtle.encrypt(f,e,c)},"fail encrypt wrapped key bundle"));return a});return C.apply(this,arguments)}function e(a,b,c){d("WALogger").LOG(k());a=d("WAArrayBufferUtils").concatBuffers([a,b,d("WAByteArray").uint8ArrayToBuffer(c)]);return a}function f(a){return D.apply(this,arguments)}function D(){D=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("WACryptoHkdf").extractWithSaltAndExpand(a,null,"adv_secret",32));return a});return D.apply(this,arguments)}function E(a,b,c,d){return F.apply(this,arguments)}function F(){F=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f){var g=(yield d("WAWebSignalStoreApi").waSignalStore.getRegistrationInfo());if(g==null)throw c("err")("alt pairing: Did not find registration info");var h=new Uint8Array(32);self.crypto.getRandomValues(h);var i=new Uint8Array(32);self.crypto.getRandomValues(i);var j=new Uint8Array(12);self.crypto.getRandomValues(j);return G(a,b,e,f,g.identityKeyPair.pubKey,g.identityKeyPair.privKey,h,i,j)});return F.apply(this,arguments)}function G(a,b,c,d,e,f,g,h,i){return H.apply(this,arguments)}function H(){H=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g,h,i,j,k){a=new(d("WABinary").Binary)(a);var l=a.readByteArray(32),m=a.readByteArray(16),o=a.readByteArray(),q=(yield p(e,l)),r=(yield n(function(){return t(o,m,q)},"fail decrypt primary ephemeral pub"));if(r.byteLength===0)throw c("err")("alt pairing: linkCodePairingDecryptedPrimaryEphemeralPub is an empty buffer");a=(yield n(function(){return d("WAWebCryptoCurve25519").sharedSecret(r,f.privKey)},"fail generate ephemeral shared secret"));e=(yield y(a,j));l=A(g,b,i);e=(yield B(e,k,l));l=new(d("WABinary").Binary)();l.writeByteArray(j);l.writeByteArray(k);l.writeBuffer(e);j=(yield n(function(){return d("WAWebCryptoCurve25519").sharedSecret(b,h)},"fail generate identity shared secret"));k=d("WAArrayBufferUtils").concatBuffers([a,j,d("WAByteArray").uint8ArrayToBuffer(i)]);e=(yield d("WACryptoHkdf").extractWithSaltAndExpand(k,null,"adv_secret",32));a=l.readBuffer();return{companionIdentityPublic:g,linkCodePairingWrappedKeyBundle:a,advSecret:e}});return H.apply(this,arguments)}g.generateRandomCode=m;g.deriveKey=p;g.encryptCompanionHello=r;g.decryptPrimaryHello=t;g.companionHello=a;g.companionHelloInternal=w;g.getBundleEncryptionKey=y;g.getKeyBundle=A;g.encryptKeyBundle=B;g.createAdvSecretMaterial=e;g.createAdvSecret=f;g.companionFinish=E;g.companionFinishInternal=G}),98);
__d("WASmaxInMdIQErrorBadRequestMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","bad-request");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",400);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorBadRequestMixin=a}),98);
__d("WASmaxInMdIQErrorInternalServerErrorMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","internal-server-error");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",500);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorInternalServerErrorMixin=a}),98);
__d("WASmaxInMdIQErrorInternalServerErrorOrBadRequestMixinGroup",["WAResultOrError","WASmaxInMdIQErrorBadRequestMixin","WASmaxInMdIQErrorInternalServerErrorMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInMdIQErrorInternalServerErrorMixin").parseIQErrorInternalServerErrorMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorInternalServerError",value:b.value});var c=d("WASmaxInMdIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(a);return c.success?d("WAResultOrError").makeResult({name:"IQErrorBadRequest",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorInternalServerError","IQErrorBadRequest"],[b,c])}g.parseIQErrorInternalServerErrorOrBadRequestMixinGroup=a}),98);
__d("WASmaxInMdIQErrorResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","error");return!c.success?c:d("WAResultOrError").makeResult({type:c.value})}g.parseIQErrorResponseMixin=a}),98);
__d("WASmaxInMdCompanionFinishResponseError",["WAResultOrError","WASmaxInMdIQErrorInternalServerErrorOrBadRequestMixinGroup","WASmaxInMdIQErrorResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInMdIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInMdIQErrorInternalServerErrorOrBadRequestMixinGroup").parseIQErrorInternalServerErrorOrBadRequestMixinGroup(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorIQErrorInternalServerErrorOrBadRequestMixinGroup:b.value}))}g.parseCompanionFinishResponseError=a}),98);
__d("WASmaxInMdIQResultResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","result");return!c.success?c:d("WAResultOrError").makeResult({type:c.value})}g.parseIQResultResponseMixin=a}),98);
__d("WASmaxInMdCompanionFinishResponseSuccess",["WASmaxInMdIQResultResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxInMdIQResultResponseMixin").parseIQResultResponseMixin(a,b);return!c.success?c:c}g.parseCompanionFinishResponseSuccess=a}),98);
__d("WASmaxOutMdBaseIQSetRequestMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("iq",{id:d("WAWap").generateId(),type:"set"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBaseIQSetRequestMixin=a}),98);
__d("WASmaxOutMdCompanionFinishRequest",["WASmaxJsx","WASmaxOutMdBaseIQSetRequestMixin","WAWap"],(function(a,b,c,d,e,f,g){function a(a){var b,c=a.linkCodeCompanionRegJid,e=a.linkCodePairingWrappedKeyBundleElementValue,f=a.companionIdentityPublicElementValue;a=a.linkCodePairingRefElementValue;c=d("WASmaxOutMdBaseIQSetRequestMixin").mergeBaseIQSetRequestMixin((b=d("WASmaxJsx")).smax("iq",{xmlns:"md",to:d("WAWap").S_WHATSAPP_NET},b.smax("link_code_companion_reg",{jid:d("WAWap").USER_JID(c),stage:"companion_finish"},b.smax("link_code_pairing_wrapped_key_bundle",null,e),b.smax("companion_identity_public",null,f),b.smax("link_code_pairing_ref",null,a))));return c}g.makeCompanionFinishRequest=a}),98);
__d("WASmaxMdCompanionFinishRPC",["WAComms","WASmaxInMdCompanionFinishResponseError","WASmaxInMdCompanionFinishResponseSuccess","WASmaxOutMdCompanionFinishRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,c){var e,f,g,h;return b("regeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:e=d("WASmaxOutMdCompanionFinishRequest").makeCompanionFinishRequest(a);i.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(e,c));case 3:f=i.sent;g=d("WASmaxInMdCompanionFinishResponseSuccess").parseCompanionFinishResponseSuccess(f,e);if(!g.success){i.next=7;break}return i.abrupt("return",{name:"CompanionFinishResponseSuccess",value:g.value});case 7:h=d("WASmaxInMdCompanionFinishResponseError").parseCompanionFinishResponseError(f,e);if(!h.success){i.next=10;break}return i.abrupt("return",{name:"CompanionFinishResponseError",value:h.value});case 10:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("CompanionFinish",{Success:g,Error:h}));case 11:case"end":return i.stop()}},null,this)}g.sendCompanionFinishRPC=a}),98);
__d("WASmaxInMdIQErrorNonSupportedPrimaryMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",452);if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","primary-too-old");return!a.success?a:d("WAResultOrError").makeResult({code:b.value,text:a.value})}g.parseIQErrorNonSupportedPrimaryMixin=a}),98);
__d("WASmaxInMdIQErrorNotAllowedMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","not-allowed");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",405);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorNotAllowedMixin=a}),98);
__d("WASmaxInMdIQErrorResourceLimitMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","resource-limit");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",419);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorResourceLimitMixin=a}),98);
__d("WASmaxInMdPrimarySetIQErrorCompanionNotConnectedMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",454);if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","companion-not-connected");return!a.success?a:d("WAResultOrError").makeResult({code:b.value,text:a.value})}g.parsePrimarySetIQErrorCompanionNotConnectedMixin=a}),98);
__d("WASmaxInMdIqMixinErrors",["WAResultOrError","WASmaxInMdIQErrorBadRequestMixin","WASmaxInMdIQErrorInternalServerErrorMixin","WASmaxInMdIQErrorNonSupportedPrimaryMixin","WASmaxInMdIQErrorNotAllowedMixin","WASmaxInMdIQErrorResourceLimitMixin","WASmaxInMdPrimarySetIQErrorCompanionNotConnectedMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInMdIQErrorInternalServerErrorMixin").parseIQErrorInternalServerErrorMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorInternalServerError",value:b.value});var c=d("WASmaxInMdIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"IQErrorBadRequest",value:c.value});var e=d("WASmaxInMdIQErrorResourceLimitMixin").parseIQErrorResourceLimitMixin(a);if(e.success)return d("WAResultOrError").makeResult({name:"IQErrorResourceLimit",value:e.value});var f=d("WASmaxInMdIQErrorNonSupportedPrimaryMixin").parseIQErrorNonSupportedPrimaryMixin(a);if(f.success)return d("WAResultOrError").makeResult({name:"IQErrorNonSupportedPrimary",value:f.value});var g=d("WASmaxInMdPrimarySetIQErrorCompanionNotConnectedMixin").parsePrimarySetIQErrorCompanionNotConnectedMixin(a);if(g.success)return d("WAResultOrError").makeResult({name:"PrimarySetIQErrorCompanionNotConnected",value:g.value});var h=d("WASmaxInMdIQErrorNotAllowedMixin").parseIQErrorNotAllowedMixin(a);return h.success?d("WAResultOrError").makeResult({name:"IQErrorNotAllowed",value:h.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorInternalServerError","IQErrorBadRequest","IQErrorResourceLimit","IQErrorNonSupportedPrimary","IQErrorCompanionNotConnected","IQErrorNotAllowed"],[b,c,e,f,g,h])}g.parseIqMixinErrors=a}),98);
__d("WASmaxInMdCompanionHelloResponseError",["WAResultOrError","WASmaxInMdIQErrorResponseMixin","WASmaxInMdIqMixinErrors","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInMdIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInMdIqMixinErrors").parseIqMixinErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorIqMixinErrors:b.value}))}g.parseCompanionHelloResponseError=a}),98);
__d("WASmaxInMdCompanionHelloResponseNotifyCompanion",["WAResultOrError","WASmaxInMdIQResultResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"link_code_companion_reg");if(!c.success)return c;var e=d("WASmaxParseUtils").flattenedChildWithTag(c.value,"link_code_pairing_ref");if(!e.success)return e;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,c.value,"stage","companion_hello");if(!c.success)return c;e=d("WASmaxParseUtils").contentBytes(e.value);if(!e.success)return e;a=d("WASmaxInMdIQResultResponseMixin").parseIQResultResponseMixin(a,b);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({linkCodeCompanionRegStage:c.value,linkCodeCompanionRegLinkCodePairingRefElementValue:e.value},a.value))}g.parseCompanionHelloResponseNotifyCompanion=a}),98);
__d("WASmaxOutMdCompanionHelloRequest",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxOutMdBaseIQSetRequestMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.linkCodePairingNonceElementValue;a=d("WASmaxJsx").smax("link_code_pairing_nonce",null,a);return a}function a(a){var b,c=a.linkCodePairingNonceArgs,e=a.linkCodeCompanionRegJid,f=a.linkCodeCompanionRegShouldShowPushNotification,g=a.linkCodePairingWrappedCompanionEphemeralPubElementValue,i=a.companionServerAuthKeyPubElementValue,j=a.companionPlatformIdElementValue;a=a.companionPlatformDisplayElementValue;e=d("WASmaxOutMdBaseIQSetRequestMixin").mergeBaseIQSetRequestMixin((b=d("WASmaxJsx")).smax("iq",{xmlns:"md",to:d("WAWap").S_WHATSAPP_NET},b.smax("link_code_companion_reg",{jid:d("WAWap").USER_JID(e),stage:"companion_hello",should_show_push_notification:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,f)},b.smax("link_code_pairing_wrapped_companion_ephemeral_pub",null,g),b.smax("companion_server_auth_key_pub",null,i),b.smax("companion_platform_id",null,j),b.smax("companion_platform_display",null,a),d("WASmaxChildren").OPTIONAL_CHILD(h,c))));return e}g.makeCompanionHelloRequestLinkCodeCompanionRegLinkCodePairingNonce=h;g.makeCompanionHelloRequest=a}),98);
__d("WASmaxMdCompanionHelloRPC",["WAComms","WASmaxInMdCompanionHelloResponseError","WASmaxInMdCompanionHelloResponseNotifyCompanion","WASmaxOutMdCompanionHelloRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,c){var e,f,g,h;return b("regeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:e=d("WASmaxOutMdCompanionHelloRequest").makeCompanionHelloRequest(a);i.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(e,c));case 3:f=i.sent;g=d("WASmaxInMdCompanionHelloResponseNotifyCompanion").parseCompanionHelloResponseNotifyCompanion(f,e);if(!g.success){i.next=7;break}return i.abrupt("return",{name:"CompanionHelloResponseNotifyCompanion",value:g.value});case 7:h=d("WASmaxInMdCompanionHelloResponseError").parseCompanionHelloResponseError(f,e);if(!h.success){i.next=10;break}return i.abrupt("return",{name:"CompanionHelloResponseError",value:h.value});case 10:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("CompanionHello",{NotifyCompanion:g,Error:h}));case 11:case"end":return i.stop()}},null,this)}g.sendCompanionHelloRPC=a}),98);
__d("WASmaxInMdIQErrorBadRequestOrInternalServerErrorMixinGroup",["WAResultOrError","WASmaxInMdIQErrorBadRequestMixin","WASmaxInMdIQErrorInternalServerErrorMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInMdIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorBadRequest",value:b.value});var c=d("WASmaxInMdIQErrorInternalServerErrorMixin").parseIQErrorInternalServerErrorMixin(a);return c.success?d("WAResultOrError").makeResult({name:"IQErrorInternalServerError",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorBadRequest","IQErrorInternalServerError"],[b,c])}g.parseIQErrorBadRequestOrInternalServerErrorMixinGroup=a}),98);
__d("WASmaxInMdGetCountryCodeResponseError",["WAResultOrError","WASmaxInMdIQErrorBadRequestOrInternalServerErrorMixinGroup","WASmaxInMdIQErrorResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInMdIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInMdIQErrorBadRequestOrInternalServerErrorMixinGroup").parseIQErrorBadRequestOrInternalServerErrorMixinGroup(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorIQErrorBadRequestOrInternalServerErrorMixinGroup:b.value}))}g.parseGetCountryCodeResponseError=a}),98);
__d("WASmaxInMdGetCountryCodeResponseGetCountryCodeResponse",["WAResultOrError","WASmaxInMdIQResultResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"country_code");if(!c.success)return c;c=d("WASmaxParseUtils").attrString(c.value,"iso");if(!c.success)return c;a=d("WASmaxInMdIQResultResponseMixin").parseIQResultResponseMixin(a,b);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({countryCodeIso:c.value},a.value))}g.parseGetCountryCodeResponseGetCountryCodeResponse=a}),98);
__d("WASmaxOutMdBaseIQGetRequestMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("iq",{id:d("WAWap").generateId(),type:"get"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBaseIQGetRequestMixin=a}),98);
__d("WASmaxOutMdGetCountryCodeRequest",["WASmaxJsx","WASmaxOutMdBaseIQGetRequestMixin","WAWap"],(function(a,b,c,d,e,f,g){function a(){var a=d("WASmaxOutMdBaseIQGetRequestMixin").mergeBaseIQGetRequestMixin(d("WASmaxJsx").smax("iq",{to:d("WAWap").S_WHATSAPP_NET,xmlns:"md"},d("WASmaxJsx").smax("link_code_companion_reg",{stage:"get_country_code"})));return a}g.makeGetCountryCodeRequest=a}),98);
__d("WASmaxMdGetCountryCodeRPC",["WAComms","WASmaxInMdGetCountryCodeResponseError","WASmaxInMdGetCountryCodeResponseGetCountryCodeResponse","WASmaxOutMdGetCountryCodeRequest","WASmaxParsingFailure","WASmaxRpcUtils","regeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a){var c,e,f,g;return b("regeneratorRuntime").async(function(h){while(1)switch(h.prev=h.next){case 0:c=d("WASmaxOutMdGetCountryCodeRequest").makeGetCountryCodeRequest();h.next=3;return b("regeneratorRuntime").awrap(d("WAComms").sendSmaxStanza(c,a));case 3:e=h.sent;f=d("WASmaxInMdGetCountryCodeResponseGetCountryCodeResponse").parseGetCountryCodeResponseGetCountryCodeResponse(e,c);if(!f.success){h.next=7;break}return h.abrupt("return",{name:"GetCountryCodeResponseGetCountryCodeResponse",value:f.value});case 7:g=d("WASmaxInMdGetCountryCodeResponseError").parseGetCountryCodeResponseError(e,c);if(!g.success){h.next=10;break}return h.abrupt("return",{name:"GetCountryCodeResponseError",value:g.value});case 10:throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("GetCountryCode",{GetCountryCodeResponse:f,Error:g}));case 11:case"end":return h.stop()}},null,this)}g.sendGetCountryCodeRPC=a}),98);
__d("WAWebCompanionRegClientUtils",["$InternalEnum","WAWebMiscBrowserUtils"],(function(a,b,c,d,e,f,g){var h=b("$InternalEnum")({UNKNOWN:0,CHROME:1,EDGE:2,FIREFOX:3,IE:4,OPERA:5,SAFARI:6,ELECTRON:7,UWP:8,OTHER_WEB_CLIENT:9});d=String(a());function a(){var a=c("WAWebMiscBrowserUtils").info().name;if(!a)return h.UNKNOWN;switch(a){case"Chrome":return h.CHROME;case"Firefox":return h.FIREFOX;case"IE":return h.IE;case"Opera":return h.OPERA;case"Safari":return h.SAFARI;case"Edge":return h.EDGE;case"electron":return h.ELECTRON;default:return h.OTHER_WEB_CLIENT}}g.DEVICE_PLATFORM=d;g.getCompanionWebClientFromBrowser=a}),98);
__d("WAWebAltDeviceLinkingIq",["WALogger","WASmaxMdCompanionFinishRPC","WASmaxMdCompanionHelloRPC","WASmaxMdGetCountryCodeRPC","WAWebCompanionRegClientUtils","WAWebMiscBrowserUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["alt device linking: sendGetCountryCodeRPC failed with error: ",""]);h=function(){return a};return a}var i=function(b){babelHelpers.inheritsLoose(a,b);function a(a,c){a=b.call(this,a)||this;a.name="CompanionHelloError";a.type=c;return a}return a}(babelHelpers.wrapNativeSuper(Error)),j=function(b){babelHelpers.inheritsLoose(a,b);function a(){var a,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(a=c=b.call.apply(b,[this].concat(e))||this,c.name="CompanionFinishError",a)||babelHelpers.assertThisInitialized(c)}return a}(babelHelpers.wrapNativeSuper(Error));function a(){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{var a=(yield d("WASmaxMdGetCountryCodeRPC").sendGetCountryCodeRPC());if(a.name==="GetCountryCodeResponseGetCountryCodeResponse")return{enabled:!0,countryCode:a.value.countryCodeIso}}catch(a){d("WALogger").ERROR(h(),a).sendLogs("alt device linking: sendGetCountryCodeRPC failed")}return{enabled:!1}});return k.apply(this,arguments)}function e(a,b,c,d){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g){a=(yield d("WASmaxMdCompanionHelloRPC").sendCompanionHelloRPC({linkCodePairingNonceArgs:{linkCodePairingNonceElementValue:new Uint8Array(1)},linkCodeCompanionRegJid:a,linkCodePairingWrappedCompanionEphemeralPubElementValue:new Uint8Array(e),companionServerAuthKeyPubElementValue:new Uint8Array(f),companionPlatformIdElementValue:b("WAWebCompanionRegClientUtils").DEVICE_PLATFORM,companionPlatformDisplayElementValue:c("WAWebMiscBrowserUtils").info().name+" ("+c("WAWebMiscBrowserUtils").info().os+")",linkCodeCompanionRegShouldShowPushNotification:g?"true":"false"}));if(a.name==="CompanionHelloResponseNotifyCompanion")return a.value.linkCodeCompanionRegLinkCodePairingRefElementValue;else if(a.name==="CompanionHelloResponseError")throw new i("alt pairing: Got an error from alt paring: companion hello: "+a.value.errorIqMixinErrors.name,a.value.errorIqMixinErrors);throw new i("alt pairing: Got an unknown error from alt paring: companion hello")});return l.apply(this,arguments)}function f(a,b,c,d){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){e=(yield d("WASmaxMdCompanionFinishRPC").sendCompanionFinishRPC({linkCodeCompanionRegJid:e,linkCodePairingWrappedKeyBundleElementValue:new Uint8Array(a),companionIdentityPublicElementValue:new Uint8Array(b),linkCodePairingRefElementValue:c}));if(e.name==="CompanionFinishResponseSuccess")return;throw new j("alt pairing: Got an error from alt paring: companion finish")});return m.apply(this,arguments)}g.CompanionHelloError=i;g.CompanionFinishError=j;g.genDoesServerEnableAltDeviceLinking=a;g.sendCompanionHello=e;g.sendCompanionFinish=f}),98);
__d("WAWebAltDeviceLinkingApi",["invariant","$InternalEnum","Promise","WABase64","WAByteArray","WACryptoUtils","WALogger","WAQplTypes","WATimeUtils","WAWebAdvSignatureApi","WAWebAltDeviceLinkingAlgorithm","WAWebAltDeviceLinkingIq","WAWebBackendApi","WAWebJidUtils","WAWebQplQuickPerformanceLoggerMarkerIds","WAWebQplQuickPerformanceLoggerModule","WAWebUserPrefsInfoStore","WAWebUserPrefsMultiDevice","asyncToGeneratorRuntime","err","gkx"],(function(a,b,c,d,e,f,g,h){var i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["alt pairing: sent companion finish to server"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["alt pairing: completed companion finish local algorithm"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["alt pairing: cached companion hello ref: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["alt pairing: handling primary hello"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["alt pairing: companion hello ref received: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["alt pairing: sent companion hello"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["alt pairing: completed companion hello generation"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["alt pairing: start linking flow"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["alt pairing: initialize QR linking"]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["alt pairing: initialize alt linking"]);s=function(){return a};return a}var t=function(b){babelHelpers.inheritsLoose(a,b);function a(){var a,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(a=c=b.call.apply(b,[this].concat(e))||this,c.name="MissingCachedRefError",a)||babelHelpers.assertThisInitialized(c)}return a}(babelHelpers.wrapNativeSuper(Error)),u=function(b){babelHelpers.inheritsLoose(a,b);function a(){var a,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(a=c=b.call.apply(b,[this].concat(e))||this,c.name="NoiseInfoIsNullError",a)||babelHelpers.assertThisInitialized(c)}return a}(babelHelpers.wrapNativeSuper(Error)),v=function(b){babelHelpers.inheritsLoose(a,b);function a(){var a,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(a=c=b.call.apply(b,[this].concat(e))||this,c.name="InvalidRefError",a)||babelHelpers.assertThisInitialized(c)}return a}(babelHelpers.wrapNativeSuper(Error)),w=function(b){babelHelpers.inheritsLoose(a,b);function a(){var a,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(a=c=b.call.apply(b,[this].concat(e))||this,c.name="OldCodeError",a)||babelHelpers.assertThisInitialized(c)}return a}(babelHelpers.wrapNativeSuper(Error)),x=function(b){babelHelpers.inheritsLoose(a,b);function a(){var a,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(a=c=b.call.apply(b,[this].concat(e))||this,c.name="MaxPrimaryHelloError",a)||babelHelpers.assertThisInitialized(c)}return a}(babelHelpers.wrapNativeSuper(Error)),y=b("$InternalEnum").Mirrored(["QR_CODE","ALT_DEVICE_LINKING"]),z=b("$InternalEnum").Mirrored(["NotStarted","Initialized","AfterSendCompanionHello","AfterSendCompanionFinish"]),A=function(){function a(){this.clear()}var b=a.prototype;b.clear=function(){this.helloCached=null,this.ref=null,this.phone=null,this.stage=z.NotStarted,this.codeGenerationTs=null,this.primaryHelloAttemptCount=0,this.marker!=null&&(this.marker.end(d("WAQplTypes").QuickLogActionType.ABORTED),this.marker=null)};return a}(),B=180,C=3,D=new A(),E=y.QR_CODE;function F(){return E}function G(a){E=a}function a(){return D.ref}function H(){return D.marker}function e(){return I.apply(this,arguments)}function I(){I=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){d("WALogger").LOG(s()),D.clear(),D.marker=d("WAWebQplQuickPerformanceLoggerModule").QPL.markerStart(d("WAWebQplQuickPerformanceLoggerMarkerIds").QuickLogMarkerId.ALTERNATIVE_DEVICE_LINKING),yield d("WAWebUserPrefsMultiDevice").setADVSecretKey(),D.stage=z.Initialized,G(y.ALT_DEVICE_LINKING)});return I.apply(this,arguments)}function f(){return J.apply(this,arguments)}function J(){J=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){d("WALogger").LOG(r());if(F()===y.ALT_DEVICE_LINKING){var a;(a=H())==null?void 0:a.addPoint("switch_to_qr")}D.clear();yield d("WAWebAdvSignatureApi").generateADVSecretKey();D.stage=z.NotStarted;G(y.QR_CODE)});return J.apply(this,arguments)}function K(a,b){return L.apply(this,arguments)}function L(){L=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){d("WALogger").LOG(q());var c=(yield d("WAWebUserPrefsInfoStore").waNoiseInfo.get());if(c==null)throw new u("alt pairing: noise info is null");D.phone=a;D.codeGenerationTs=d("WATimeUtils").unixTime();return M(D,c,b)});return L.apply(this,arguments)}function M(a,b,c){return N.apply(this,arguments)}function N(){N=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){var f;if(!c("gkx")("26258")){var g;(g=D.marker)==null?void 0:g.annotate({string:{phone:a.phone}})}a.stage===z.Initialized||h(0,75727,a.stage);(g=D.marker)==null?void 0:g.addPoint("generate_code_start");g=(yield d("WAWebAltDeviceLinkingAlgorithm").companionHello());a.helloCached=g;(f=D.marker)==null?void 0:f.addPoint("generate_code_end");d("WALogger").LOG(p());(f=D.marker)==null?void 0:f.addPoint("send_companion_hello_start");a.phone!=null||h(0,67482);a.ref=(yield d("WAWebAltDeviceLinkingIq").sendCompanionHello(d("WAWebJidUtils").toPhoneUserJid(a.phone),g.linkCodePairingWrappedCompanionEphemeralPub,b.staticKeyPair.pubKey,e));(f=D.marker)==null?void 0:f.addPoint("send_companion_hello_end");d("WALogger").LOG(o());if(a.ref==null)throw new t("alt pairing:could not get ref from companion hello");c("gkx")("26258")||d("WALogger").LOG(n(),a.ref);a.stage=z.AfterSendCompanionHello;return g.linkCodePairingSecret});return N.apply(this,arguments)}function O(a){return P.apply(this,arguments)}function P(){P=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WALogger").LOG(m());d("WAWebBackendApi").frontendFireAndForget("primaryHelloReceivedAltLinking",{});try{return yield S(a,D,d("WATimeUtils").unixTime())}catch(a){d("WAWebBackendApi").frontendFireAndForget("errorAltLinking",{});return(i||(i=b("Promise"))).reject(a)}});return P.apply(this,arguments)}function Q(a){return R.apply(this,arguments)}function R(){R=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("WAWebAdvSignatureApi").generateADVSecretKey(),a.stage=z.AfterSendCompanionHello});return R.apply(this,arguments)}function S(a,b,c){return T.apply(this,arguments)}function T(){T=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){var f;(f=D.marker)==null?void 0:f.addPoint("handle_primary_hello_start");b.primaryHelloAttemptCount++;if(b.stage===z.AfterSendCompanionFinish)if(b.primaryHelloAttemptCount<=C)yield Q(b);else throw new x("alt pairing: reached max allowed primary hello attempts per code");b.stage===z.AfterSendCompanionHello||h(0,75728,b.stage);c("gkx")("26258")||d("WALogger").LOG(l(),b.ref);if(b.ref==null)throw new t("alt pairing:could not get ref from companion hello");if(!d("WACryptoUtils").uint8ArraysEqual(b.ref,a.linkCodeCompanionRegLinkCodePairingRefElementValue))throw new v("alt pairing: handle primary hello: received unexpected ref");if(b.helloCached==null)throw c("err")("alt pairing: cannot find cached hello data");if(b.codeGenerationTs==null)throw c("err")("alt pairing: cannot find codeGenerationTs");if(e-b.codeGenerationTs>B)throw new w("alt pairing: cannot process primaryHello for an old code");f=b.helloCached;e=(yield d("WAWebAltDeviceLinkingAlgorithm").companionFinish(d("WAByteArray").uint8ArrayToBuffer(a.linkCodeCompanionRegLinkCodePairingWrappedPrimaryEphemeralPubElementValue),d("WAByteArray").uint8ArrayToBuffer(a.linkCodeCompanionRegPrimaryIdentityPubElementValue),f.linkCodeKey,f.linkCodePairingCompanionADVEphemeralKeyPair));d("WALogger").LOG(k());yield d("WAWebUserPrefsMultiDevice").setADVSecretKey(d("WABase64").encodeB64(e.advSecret));a=b.ref;if(a==null)throw new t("alt pairing: cannot find cached ref");f=b.phone;if(f==null)throw new t("alt pairing: phone is empty");yield d("WAWebAltDeviceLinkingIq").sendCompanionFinish(e.linkCodePairingWrappedKeyBundle,e.companionIdentityPublic,a,d("WAWebJidUtils").toPhoneUserJid(f));d("WALogger").LOG(j());b.stage=z.AfterSendCompanionFinish;(e=D.marker)==null?void 0:e.addPoint("handle_primary_hello_end")});return T.apply(this,arguments)}g.MissingCachedRefError=t;g.NoiseInfoIsNullError=u;g.InvalidRefError=v;g.OldCodeError=w;g.MaxPrimaryHelloError=x;g.PairingType=y;g.AltPairingStage=z;g.PairingState=A;g.MAX_SECONDS_CODE_IS_VALID=B;g.getPairingType=F;g.setPairingType=G;g.getCurrentRef=a;g.getCurrentMarker=H;g.initializeAltDeviceLinking=e;g.initializeQRLinking=f;g.startAltLinkingFlow=K;g.startAltLinkingFlowInternal=M;g.handlePrimaryHello=O;g.handlePrimaryHelloInternal=S}),98);
__d("WAWebAltDeviceLinkingHandleNotification",["WACryptoUtils","WASmaxMdPrimaryHelloNotifyCompanionRPC","WASmaxMdRefreshCodeNotifyCompanionRPC","WASmaxOutMessageFallbackDeliverResponseBadStanza","WAWebAltDeviceLinkingApi","WAWebBackendApi","err"],(function(a,b,c,d,e,f,g){var h;function a(){return h}function b(a){var b=a.content;if(!Array.isArray(b)||!b.length)return d("WASmaxOutMessageFallbackDeliverResponseBadStanza").makeDeliverResponseBadStanza({ackError:487},a);b=b[0].attrs;if(b.stage==="primary_hello")return i(a);else if(b.stage==="refresh_code")return j(a);return d("WASmaxOutMessageFallbackDeliverResponseBadStanza").makeDeliverResponseBadStanza({ackError:487},a)}function i(a){a=d("WASmaxMdPrimaryHelloNotifyCompanionRPC").receivePrimaryHelloNotifyCompanionRPC(a);var b=a.parsedRequest;a=a.makePrimaryHelloNotifyCompanionResponseAck;if(!b){d("WAWebBackendApi").frontendFireAndForget("errorAltLinking",{});throw c("err")("alt pairing: could not parse primary hello")}try{h=d("WAWebAltDeviceLinkingApi").handlePrimaryHello(b);return a()}catch(a){(b=d("WAWebAltDeviceLinkingApi").getCurrentMarker())==null?void 0:b.addPoint("primary_hello_error");throw a}}function j(a){a=d("WASmaxMdRefreshCodeNotifyCompanionRPC").receiveRefreshCodeNotifyCompanionRPC(a);var b=a.parsedRequest;a=a.makeRefreshCodeNotifyCompanionResponseAck;if(!b)throw c("err")("alt pairing: could not parse refresh code");var e=d("WAWebAltDeviceLinkingApi").getCurrentRef();if(e!=null&&d("WACryptoUtils").uint8ArraysEqual(e,b.linkCodeCompanionRegLinkCodePairingRefElementValue))if(b.linkCodeCompanionRegForceManualRefresh==="true"){(e=d("WAWebAltDeviceLinkingApi").getCurrentMarker())==null?void 0:e.addPoint("receive_force_refresh_code");d("WAWebBackendApi").frontendFireAndForget("forceManualRefresh",{ref:b.linkCodeCompanionRegLinkCodePairingRefElementValue})}else{(e=d("WAWebAltDeviceLinkingApi").getCurrentMarker())==null?void 0:e.addPoint("receive_refresh_code");d("WAWebBackendApi").frontendFireAndForget("refreshAltLinkingCode",{ref:b.linkCodeCompanionRegLinkCodePairingRefElementValue})}return a()}g.getPrimaryHello=a;g.handleAltDeviceLinkingNotification=b;g.handlePrimaryHelloNotification=i;g.handleRefreshCodeNotification=j}),98);
__d("WAWebGroupJoinCWamEvent",["WAWebWamCodegenUtils"],(function(a,b,c,d,e,f,g){a=d("WAWebWamCodegenUtils").defineEvents({GroupJoinC:[158,{},[1,1,1],"regular"]});g.GroupJoinCWamEvent=a}),98);
__d("WAWebHandleGroupCreation",["Promise","WALogger","WAWebApiChat","WAWebBackendApi","WAWebCreateChat","WAWebGroupDatabaseJob","WAWebGroupJoinCWamEvent","WAWebGroupParticipantsJob","WAWebHandlePushnameUpdate","WAWebUserPrefsMeUser","WAWebWorkerSafeBackendApi","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["updated chat model and table"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["updated GroupMetadata and participants tables"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["inside handleGroupCreation"]);k=function(){return a};return a}function a(a,b,c,d){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e,f){e===void 0&&(e=!1);f===void 0&&(f=!1);d("WALogger").LOG(k()).tags("groups");var g=a.chatId,l=a.author,m=a.pushname,n=c.id,o=c.participants,p=c.subject,q=c.creation;(a.author==null||!a.author.equals(d("WAWebUserPrefsMeUser").getMaybeMeUser()))&&new(d("WAWebGroupJoinCWamEvent").GroupJoinCWamEvent)().commit();l&&m&&d("WAWebHandlePushnameUpdate").updatePushname(l,m,e);yield (h||(h=b("Promise"))).all([d("WAWebGroupDatabaseJob").updateGroupMetadataTableJob([c]),d("WAWebGroupParticipantsJob").updateParticipantsJob({group:n,participants:o,isOffline:e,groupInfo:c})]);d("WALogger").LOG(j()).tags("groups");(yield d("WAWebApiChat").getChatRecord(g))!=null?d("WAWebBackendApi").frontendFireAndForget("updateGroupSubject",{id:g,subject:p}):(yield d("WAWebCreateChat").createChat(g,"groupCreation",babelHelpers["extends"]({t:q,pendingInitialLoading:!1,createdLocally:!1},f===!0&&{notSpam:!0}),{createdOffline:e}),d("WALogger").LOG(i()).tags("groups"),d("WAWebBackendApi").frontendFireAndForget("updateContactName",{contactId:n,name:p}));d("WAWebBackendApi").frontendFireAndForget("setGroupMetadata",c);d("WAWebBackendApi").frontendFireAndForget("markProfilePicStale",{profilePicThumbWid:n});if(e)return;d("WAWebWorkerSafeBackendApi").workerSafeFireAndForget("maybeSendKeyDistributionMsgToNewGroup",{groupId:n})});return l.apply(this,arguments)}g.handleGroupCreation=a}),98);
__d("WAWebHandleGroupNotificationConst",["WATimeUtils","WAWebABProps","WAWebApiParticipantStore","WAWebBackendApi","WAWebCommunityGatingUtils","WAWebDBGroupsGroupMetadata","WAWebGroupType","WAWebGroupsParticipantsApi","WAWebRuntimeEnvironmentUtils","WAWebUserPrefsMeUser","WAWebWid","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){f=Object.freeze({REMOVE:"remove",ADD:"add",DEMOTE:"demote",DELETE:"delete",PROMOTE:"promote",MODIFY:"modify",CREATE:"create",SUBJECT:"subject",DESC:"description",LOCKED:"locked",UNLOCKED:"unlocked",ANNOUNCE:"announcement",NOT_ANNOUNCE:"not_announcement",NO_FREQUENTLY_FORWARDED:"no_frequently_forwarded",FREQUENTLY_FORWARDED_OK:"frequently_forwarded_ok",INVITE:"invite",EPHEMERAL:"ephemeral",NOT_EPHEMERAL:"not_ephemeral",REVOKE_INVITE:"revoke",SUSPENDED:"suspended",UNSUSPENDED:"unsuspended",GROWTH_LOCKED:"growth_locked",GROWTH_UNLOCKED:"growth_unlocked",LINK:"link",UNLINK:"unlink",LINKED_GROUP_PROMOTE:"linked_group_promote",LINKED_GROUP_DEMOTE:"linked_group_demote",MEMBERSHIP_APPROVAL_MODE:"membership_approval_mode",MEMBERSHIP_APPROVAL_REQUEST:"membership_approval_request",CREATED_MEMBERSHIP_REQUESTS:"created_membership_requests",REVOKED_MEMBERSHIP_REQUESTS:"revoked_membership_requests",ALLOW_NON_ADMIN_SUB_GROUP_CREATION:"allow_non_admin_sub_group_creation",NOT_ALLOW_NON_ADMIN_SUB_GROUP_CREATION:"not_allow_non_admin_sub_group_creation",ALLOW_ADMIN_REPORTS:"allow_admin_reports",NOT_ALLOW_ADMIN_REPORTS:"not_allow_admin_reports",REPORTS:"reports",CREATED_SUBGROUP_SUGGESTION:"created_sub_group_suggestion",REVOKED_SUB_GROUP_SUGGESTIONS:"revoked_sub_group_suggestions",CHANGE_NUMBER:"change_number",MEMBER_ADD_MODE:"member_add_mode",AUTO_ADD_DISABLED:"auto_add_disabled"});function h(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=(yield d("WAWebDBGroupsGroupMetadata").getGroupMetadata(a));return!!a&&a.growthLockType===b&&((b=a.growthLockExpiration)!=null?b:0)>d("WATimeUtils").unixTime()});return i.apply(this,arguments)}function a(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(b.actionType===d("WAWebGroupType").GROUP_ACTIONS.REVOKE_INVITE||b.actionType===d("WAWebGroupType").GROUP_ACTIONS.SUSPEND||b.actionType===d("WAWebGroupType").GROUP_ACTIONS.REVOKED_MEMBERSHIP_REQUESTS||b.actionType===d("WAWebGroupType").GROUP_ACTIONS.REVOKED_SUB_GROUP_SUGGESTIONS||b.actionType===d("WAWebGroupType").GROUP_ACTIONS.SUBGROUP_SUGGESTIONS_CHANGE_NUMBER)return!0;if(b.actionType===d("WAWebGroupType").GROUP_ACTIONS.ALLOW_NON_ADMIN_SUB_GROUP_CREATION&&!d("WAWebCommunityGatingUtils").memberAddedGroupsM1Enabled())return!0;if(b.actionType===d("WAWebGroupType").GROUP_ACTIONS.GROWTH_LOCKED||b.actionType===d("WAWebGroupType").GROUP_ACTIONS.GROWTH_UNLOCKED){if(b.actionType===d("WAWebGroupType").GROUP_ACTIONS.GROWTH_LOCKED){if(b.type!=="invite")return!0;var e=(yield h(a.chatId,b.type));if(e)return!0}e=(yield d("WAWebApiParticipantStore").isCurrentUserGroupAdmin(a.chatId.toString()));return!e}if((b.actionType===d("WAWebGroupType").GROUP_ACTIONS.SUB_GROUP_LINK||b.actionType===d("WAWebGroupType").GROUP_ACTIONS.PARENT_GROUP_LINK||b.actionType===d("WAWebGroupType").GROUP_ACTIONS.SIBLING_GROUP_LINK||b.actionType===d("WAWebGroupType").GROUP_ACTIONS.SUB_GROUP_UNLINK||b.actionType===d("WAWebGroupType").GROUP_ACTIONS.SIBLING_GROUP_UNLINK||b.actionType===d("WAWebGroupType").GROUP_ACTIONS.PARENT_GROUP_UNLINK||b.actionType===d("WAWebGroupType").GROUP_ACTIONS.INTEGRITY_PARENT_GROUP_UNLINK||b.actionType===d("WAWebGroupType").GROUP_ACTIONS.DELETE_PARENT_GROUP||b.actionType===d("WAWebGroupType").GROUP_ACTIONS.LINKED_GROUP_PROMOTE||b.actionType===d("WAWebGroupType").GROUP_ACTIONS.LINKED_GROUP_DEMOTE)&&!d("WAWebCommunityGatingUtils").communitiesEnabled())return!0;if(d("WAWebCommunityGatingUtils").communitiesEnabled()&&(b.actionType===d("WAWebGroupType").GROUP_ACTIONS.PROMOTE||b.actionType===d("WAWebGroupType").GROUP_ACTIONS.DEMOTE)&&(yield l(a.chatId))===!0)return!0;if(b.actionType===d("WAWebGroupType").GROUP_ACTIONS.PROMOTE||b.actionType===d("WAWebGroupType").GROUP_ACTIONS.DEMOTE){e=b.participants.length===1&&d("WAWebUserPrefsMeUser").isMeAccount(b.participants[0].id);if(!e)return!0}if(b.actionType===d("WAWebGroupType").GROUP_ACTIONS.LINKED_GROUP_DEMOTE&&b.participants.length===1&&!d("WAWebUserPrefsMeUser").isMeAccount(b.participants[0].id)){e=(yield d("WAWebApiParticipantStore").isCurrentUserGroupAdmin(a.chatId.toString()));if(!e)return!0}if(b.actionType===d("WAWebGroupType").GROUP_ACTIONS.REMOVE&&b.participants.length===1&&c("WAWebWid").equals(a.author,b.participants[0].id)){e=(yield d("WAWebApiParticipantStore").isCurrentUserGroupAdmin(a.chatId.toString()));var f=d("WAWebUserPrefsMeUser").isMeAccount(a.author);if(!e||f)return!0}if(b.actionType===d("WAWebGroupType").GROUP_ACTIONS.CREATED_SUBGROUP_SUGGESTION){e=(yield d("WAWebApiParticipantStore").isCurrentUserGroupAdmin(a.chatId.toString()));if(!e||b.isExistingGroup===!0&&!d("WAWebCommunityGatingUtils").memberSuggestedGroupsM3ReceiverEnabled())return!0}if(b.actionType===d("WAWebGroupType").GROUP_ACTIONS.DELETE){f=(yield d("WAWebDBGroupsGroupMetadata").getGroupMetadata(a.chatId));e=f!=null?d("WAWebGroupType").getGroupTypeFromGroupMetadata(f):null;if(b.reason===d("WAWebGroupType").DELETE_REASON.INTEGRITY_DELETE_PARENT&&e===d("WAWebGroupType").GroupType.LINKED_ANNOUNCEMENT_GROUP&&d("WAWebABProps").getABPropConfigValue("community_suspend_v0_enabled"))return!1;else if(b.reason===d("WAWebGroupType").DELETE_REASON.DELETE_PARENT&&e===d("WAWebGroupType").GroupType.LINKED_ANNOUNCEMENT_GROUP)return!0;return!0}if(b.actionType===(d("WAWebABProps").getABPropConfigValue("group_join_request_m3")?d("WAWebGroupType").GROUP_ACTIONS.MEMBERSHIP_APPROVAL_REQUEST:d("WAWebGroupType").GROUP_ACTIONS.CREATED_MEMBERSHIP_REQUESTS))return!0;if(d("WAWebABProps").getABPropConfigValue("web_anyone_can_add_group_setting_enabled")&&b.actionType===d("WAWebGroupType").GROUP_ACTIONS.CREATED_MEMBERSHIP_REQUESTS){f=(yield d("WAWebApiParticipantStore").isCurrentUserGroupAdmin(a.chatId.toString()));if(!f)return!0}if(b.actionType===d("WAWebGroupType").GROUP_ACTIONS.CREATED_MEMBERSHIP_REQUESTS&&b.skipGenMsg)return!0;if(b.actionType===d("WAWebGroupType").GROUP_ACTIONS.ALLOW_ADMIN_REPORTS&&b.shouldSkipGenMsg===!0)return!0;if(b.actionType===d("WAWebGroupType").GROUP_ACTIONS.ADMIN_REPORT_RECIEVED&&b.shouldSkipGenMsg===!0)return!0;if((b.actionType===d("WAWebGroupType").GROUP_ACTIONS.REMOVE||b.actionType===d("WAWebGroupType").GROUP_ACTIONS.PROMOTE||b.actionType===d("WAWebGroupType").GROUP_ACTIONS.DEMOTE||b.actionType===d("WAWebGroupType").GROUP_ACTIONS.MODIFY)&&(yield l(a.chatId))===!0)return!0;if(b.actionType===d("WAWebGroupType").GROUP_ACTIONS.LINKED_GROUP_PROMOTE||b.actionType===d("WAWebGroupType").GROUP_ACTIONS.LINKED_GROUP_DEMOTE){e=b.participants.every(function(a){a=a.id;return a.isLid()});if(e)return!0}return!1});return j.apply(this,arguments)}function e(a,b){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(!d("WAWebRuntimeEnvironmentUtils").isWorker())return d("WAWebBackendApi").frontendSendAndReceive("notAlreadyInGroup",{groupId:a,participants:b});var c=new Set((a=(a=(yield d("WAWebGroupsParticipantsApi").getParticipants(a)))==null?void 0:a.participants)!=null?a:[]);return b.filter(function(a){a=a.id;return!c.has(String(a))})});return k.apply(this,arguments)}function l(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("WAWebDBGroupsGroupMetadata").getGroupMetadata(a));return a!=null&&a.defaultSubgroup===!0&&a.incognito===!0});return m.apply(this,arguments)}g.GROUP_NOTIFICATION_TAG=f;g.shouldSkipGenMsg=a;g.notAlreadyInGroup=e;g.getIsIncognitoCagById=l}),98);
__d("WAWebIsAddressingModeMismatch",["WAWebABProps"],(function(a,b,c,d,e,f,g){function a(a,b){if(!d("WAWebABProps").getABPropConfigValue("lid_groups_handle_server_addressing_mode"))return!1;return Boolean(a.defaultSubgroup)===!0?!1:Boolean(b.isLidAddressingMode)!==Boolean(a.isLidAddressingMode)}g.isAddressingModeMismatch=a}),98);
__d("WAWebIsPnhCagInLimboState",["WAWebMiscGatingUtils"],(function(a,b,c,d,e,f,g){function a(a,b){if(!d("WAWebMiscGatingUtils").pnhCagBlockLidInLimbo())return!1;b=b.some(function(a){a=a.id;return a.isLid()});if(!b)return!1;return a.defaultSubgroup!==!0?!1:(a==null?void 0:a.incognito)!==!0}g.isPnhCagInLimboState=a}),98);
__d("WAWebShouldTriggerQueryGroupInfo",["WAWebIsAddressingModeMismatch","WAWebIsPnhCagInLimboState","WAWebSchemaGroupMetadata","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,b){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=(yield d("WAWebSchemaGroupMetadata").getGroupMetadataTable().get(a.toString()));if(a==null)return!1;return Boolean(a.defaultSubgroup)===!1?d("WAWebIsAddressingModeMismatch").isAddressingModeMismatch(a,b):d("WAWebIsPnhCagInLimboState").isPnhCagInLimboState(a,b.participants)});return h.apply(this,arguments)}g.shouldTriggerQueryGroupInfo=a}),98);
__d("WAWebDBGroupMembeshipApprovalRequest",["WABatcher","WALogger","WAWebModelStorageUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["removeMembershipApprovalRequestsBatched: aggregating "," changes"]);h=function(){return a};return a}var i=3e3,j=function(){return d("WABatcher").batch({delayMs:i},function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WALogger").DEV(h(),a.length).devConsole(a);var b=a.flatMap(function(a){var b=a.id.toString();return a.requests.map(function(a){return[b,a.toString()]})});yield d("WAWebModelStorageUtils").getStorage().lock(["pending-membership-approval-request"],function(a){a=a[0];return a.bulkRemove(b)});return b.map(function(a){return void 0})});return function(b){return a.apply(this,arguments)}}())}();function a(a,b,c){c===void 0&&(c=!1);if(c)return j({id:a,requests:b});var e=a.toString();return d("WAWebModelStorageUtils").getStorage().lock(["pending-membership-approval-request"],function(a){a=a[0];return a.bulkRemove(b.map(function(a){return[e,a.toString()]}))})}g.removeMembershipApprovalRequests=a}),98);
__d("WAWebGroupsMembershipApprovalRequestsApi",["WAWebDBGroupMembeshipApprovalRequest"],(function(a,b,c,d,e,f,g){function a(a){var b=a.group,c=a.requests;a=a.isOffline;return d("WAWebDBGroupMembeshipApprovalRequest").removeMembershipApprovalRequests(b,c,a)}g.removeMembershipApprovalRequests=a}),98);
__d("WAWebGroupMembershipApprovalRequestsJob",["WAJobOrchestratorTypes","WAWebGroupsMembershipApprovalRequestsApi","WAWebOrchestratorNonPersistedJob"],(function(a,b,c,d,e,f,g){function a(a,b,c){a={group:a,requests:b,isOffline:c};return d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("removeMembershipApprovalRequests",function(a){return d("WAWebGroupsMembershipApprovalRequestsApi").removeMembershipApprovalRequests(a)},{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.SKIP}).waitUntilCompleted(a)}g.removeMembershipApprovalRequestsJob=a}),98);
__d("WAWebSubgroupSuggestionsJob",["WAJobOrchestratorTypes","WAWebApiSubgroupSuggestionStore","WAWebOrchestratorNonPersistedJob"],(function(a,b,c,d,e,f,g){function a(a,b){return d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("removeSubgroupSuggestions",function(a){return d("WAWebApiSubgroupSuggestionStore").removeSubgroupSuggestionsWithOfflineOption(a)},{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.SKIP}).waitUntilCompleted({subgroupSuggestions:a,isOffline:b})}g.removeSubgroupSuggestionsJob=a}),98);
__d("WAWebUpdateDbForGroupActionApi",["Promise","WAFilteredCatch","WALogger","WANullthrows","WATimeUtils","WAWebABProps","WAWebApiMembershipApprovalRequestStore","WAWebApiParticipantStore","WAWebApiSubgroupSuggestionStore","WAWebCommunityGatingUtils","WAWebDBCommunity","WAWebDBCommunityTypes","WAWebDBGroupsGroupMetadata","WAWebDBParticipantTypes","WAWebDBRevokeInviteV4","WAWebGroupDatabaseJob","WAWebGroupMembershipApprovalRequestsJob","WAWebGroupParticipantsJob","WAWebGroupQueryBridge","WAWebGroupType","WAWebHandlePushnameUpdate","WAWebNux","WAWebNuxAction","WAWebQueryAndUpdateSubgroupSuggestionsJob","WAWebSubgroupSuggestionsJob","WAWebUpdateDbForCommunityAction","WAWebUserPrefsGeneral","WAWebUserPrefsMeUser","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["finished all storageTasks"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["unhandled group notif action in handleGroupActionMD for action ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["modifyGroupParticipant: out-of-sync group notification"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["_handleGroupActionMD: participants length should be 1, but is ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received group invite revokation from ",", but user not in participants list"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received revoke without an admin jid ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["getMaybeMeUser returned null, can't process action ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["linkedGroupDemote: out-of-sync group notification"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["linkedGroupPromote: out-of-sync group notification"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["removeParticipants: out-of-sync group notification"]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["removeParticipants: out-of-sync group notification"]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["removeParticipants: out-of-sync group notification"]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["addParticipants: out-of-sync group notification"]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["inside _handleGroupActionMD"]);v=function(){return a};return a}function a(a,b,c){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){f===void 0&&(f=!1);d("WALogger").LOG(v()).tags("groups");var g=a.chatId,w=a.author,y=a.pushname,A=a.ts,B=A===void 0?Date.now()/1e3:A;w&&y&&d("WAWebHandlePushnameUpdate").updatePushname(w,y,f);A=[];switch(e.actionType){case d("WAWebGroupType").GROUP_ACTIONS.ADD:A.push(d("WAWebGroupParticipantsJob").addParticipantsJob(g,e.participants,f,e.reason)["catch"](d("WAFilteredCatch").filteredCatch(d("WAWebDBParticipantTypes").GroupUnSyncedError,function(){d("WALogger").WARN(u()),z(g,f)})));d("WAWebABProps").getABPropConfigValue("group_join_request_m2")&&A.push(d("WAWebGroupMembershipApprovalRequestsJob").removeMembershipApprovalRequestsJob(a.chatId,e.participants.map(function(a){return a.id}),f));break;case d("WAWebGroupType").GROUP_ACTIONS.REMOVE:y=(yield d("WAWebDBGroupsGroupMetadata").getGroupMetadata(g));if(y==null)break;var C=e.reason!==d("WAWebGroupType").REMOVE_REASON.DEFAULT_SUBGROUP_DEMOTE&&e.participants.some(function(a){a=a.id;return d("WAWebUserPrefsMeUser").isMeAccount(a)})&&(yield d("WAWebDBCommunity").isLastJoinedSubgroup(y));A.push(d("WAWebGroupParticipantsJob").removeParticipantsJob(g,e.participants,B,a.author,e.reason,y,f)["catch"](d("WAFilteredCatch").filteredCatch(d("WAWebDBParticipantTypes").GroupUnSyncedError,function(){d("WALogger").WARN(t()),z(g,f)})));var D=d("WAWebUserPrefsMeUser").getMaybeMeUser();D&&e.participants.find(function(a){a=a.id;return a.equals(D)})&&(d("WAWebUserPrefsGeneral").removeUserSentMessageToChat(g),d("WAWebApiParticipantStore").setAdminshipCache(g.toString(),!1));if(C){C=y==null?void 0:y.parentGroup;y=(yield d("WAWebUpdateDbForCommunityAction").databaseUpdatesForExitedCommunity(C!=null?d("WAWebWidFactory").createWid(C):null));A.push.apply(A,y)}break;case d("WAWebGroupType").GROUP_ACTIONS.DEMOTE:C=(yield d("WAWebDBGroupsGroupMetadata").getGroupMetadata(g));if(C==null)break;var E=d("WAWebUserPrefsMeUser").getMaybeMeUser();E&&e.participants.find(function(a){a=a.id;return a.equals(E)})&&(d("WAWebApiParticipantStore").setAdminshipCache(g.toString(),!1),d("WAWebABProps").getABPropConfigValue("group_join_request_m2")&&A.push(d("WAWebApiMembershipApprovalRequestStore").removeAllMembershipApprovalRequests(g)),yield x(C,g));A.push(d("WAWebGroupParticipantsJob").demoteParticipantsJob(g,e.participants,C,f)["catch"](d("WAFilteredCatch").filteredCatch(d("WAWebDBParticipantTypes").GroupUnSyncedError,function(){d("WALogger").WARN(s()),z(g,f)})));break;case d("WAWebGroupType").GROUP_ACTIONS.PROMOTE:y=(yield d("WAWebDBGroupsGroupMetadata").getGroupMetadata(g));if(y==null)break;var F=d("WAWebUserPrefsMeUser").getMaybeMeUser();if(F&&e.participants.find(function(a){a=a.id;return a.equals(F)})){if(d("WAWebCommunityGatingUtils").communityAdminPromotionOneTimePromptEnabled()&&y!=null&&d("WAWebGroupType").getGroupTypeFromGroupMetadata(y)===d("WAWebGroupType").GroupType.COMMUNITY){C=d("WAWebNux").getCommunityAdminPromotionNuxKey(y.id.toString());d("WAWebNuxAction").resetNux(C)}d("WAWebApiParticipantStore").setAdminshipCache(g.toString(),!0);yield x(y,g)}A.push(d("WAWebGroupParticipantsJob").promoteParticipantsJob(g,e.participants,y,f)["catch"](d("WAFilteredCatch").filteredCatch(d("WAWebDBParticipantTypes").GroupUnSyncedError,function(){d("WALogger").WARN(r()),z(g,f)})));break;case d("WAWebGroupType").GROUP_ACTIONS.LINKED_GROUP_PROMOTE:if(!e.jid)break;var G=e.jid;C=(yield d("WAWebApiParticipantStore").isCurrentUserGroupAdmin(G.toString()));C||A.push(d("WAWebGroupParticipantsJob").promoteCommunityParticipantsJob(G,e.participants,f)["catch"](d("WAFilteredCatch").filteredCatch(d("WAWebDBParticipantTypes").GroupUnSyncedError,function(){d("WALogger").WARN(q()),z(G,f)})));break;case d("WAWebGroupType").GROUP_ACTIONS.LINKED_GROUP_DEMOTE:if(!e.jid)break;var H=e.jid;y=(yield d("WAWebApiParticipantStore").isCurrentUserGroupAdmin(H.toString()));y||A.push(d("WAWebGroupParticipantsJob").demoteCommunityParticipantsJob(H,e.participants,f)["catch"](d("WAFilteredCatch").filteredCatch(d("WAWebDBParticipantTypes").GroupUnSyncedError,function(){d("WALogger").WARN(p()),z(H,f)})));break;case d("WAWebGroupType").GROUP_ACTIONS.REVOKE_INVITE:var I=(C=d("WAWebUserPrefsMeUser").getMaybeMeUser())==null?void 0:C.toString();if(!I){d("WALogger").WARN(o(),e);return}y=w==null?void 0:w.toString();C=[];if(y==null){d("WALogger").WARN(n(),e);return}if(y===I)C=e.participants.map(function(a){return{from:I,to:a.id.toString(),groupId:g.toString(),expiration:a.expiration}});else{var J=e.participants.find(function(a){return a.id.toString()===I});if(!J){d("WALogger").ERROR(m(),y).sendLogs("bad-revoke");return}C=[{from:y,to:I,groupId:g.toString(),expiration:J.expiration}]}yield (h||(h=b("Promise"))).all(C.map(function(a){return d("WAWebDBRevokeInviteV4").revokeGroupInviteV4(a.from,a.to,a.groupId,a.expiration)}));break;case d("WAWebGroupType").GROUP_ACTIONS.MODIFY:if(e.participants.length!==1){d("WALogger").WARN(l(),e.participants.length);break}A.push(d("WAWebGroupDatabaseJob").modifyGroupParticipantJob(g,c("WANullthrows")(w),e.participants[0].id)["catch"](d("WAFilteredCatch").filteredCatch(d("WAWebDBParticipantTypes").GroupUnSyncedError,function(){d("WALogger").WARN(k()),z(g,f)})));break;case d("WAWebGroupType").GROUP_ACTIONS.SUBJECT:A.push(d("WAWebDBGroupsGroupMetadata").persistGroupMetadata(g,{subject:e.subject},f));break;case d("WAWebGroupType").GROUP_ACTIONS.DESC_ADD:A.push(d("WAWebDBGroupsGroupMetadata").persistGroupMetadata(g,{desc:e.desc,descId:e.descId,descTime:e.descTime,descOwner:w==null?void 0:w.toString()},f));break;case d("WAWebGroupType").GROUP_ACTIONS.DESC_REMOVE:A.push(d("WAWebDBGroupsGroupMetadata").persistGroupMetadata(g,{desc:void 0,descId:void 0,descTime:void 0,descOwner:void 0},f));break;case d("WAWebGroupType").GROUP_ACTIONS.RESTRICT:A.push(d("WAWebDBGroupsGroupMetadata").persistGroupMetadata(g,{restrict:!!e.value},f));break;case d("WAWebGroupType").GROUP_ACTIONS.SUSPEND:A.push(d("WAWebDBGroupsGroupMetadata").persistGroupMetadata(g,{suspended:!!e.value},f));break;case d("WAWebGroupType").GROUP_ACTIONS.ANNOUNCE:A.push(d("WAWebDBGroupsGroupMetadata").persistGroupMetadata(g,{announce:!!e.value},f));break;case d("WAWebGroupType").GROUP_ACTIONS.NO_FORWARD:A.push(d("WAWebDBGroupsGroupMetadata").persistGroupMetadata(g,{noFrequentlyForwarded:!!e.value},f));break;case d("WAWebGroupType").GROUP_ACTIONS.EPHEMERAL:A.push(d("WAWebDBGroupsGroupMetadata").persistGroupMetadata(g,{ephemeralDuration:e.duration},f));break;case d("WAWebGroupType").GROUP_ACTIONS.INVITE_CODE:break;case d("WAWebGroupType").GROUP_ACTIONS.DELETE_PARENT_GROUP_UNLINK:break;case d("WAWebGroupType").GROUP_ACTIONS.DELETE:if(e.reason===d("WAWebGroupType").DELETE_REASON.INTEGRITY_DELETE_PARENT){y=(yield d("WAWebUpdateDbForCommunityAction").databaseUpdatesForIntegrityDeactivateCommunity(g,f));A.push.apply(A,y)}else if(e.reason===d("WAWebGroupType").DELETE_REASON.DELETE_PARENT){J=(yield d("WAWebUpdateDbForCommunityAction").databaseUpdatesForDeactivateCommunity(g,f));A.push.apply(A,J)}else A.push(d("WAWebDBGroupsGroupMetadata").persistGroupMetadata(g,{terminated:!0},f));break;case d("WAWebGroupType").GROUP_ACTIONS.GROWTH_UNLOCKED:A.push(d("WAWebDBGroupsGroupMetadata").persistGroupMetadata(g,{growthLockExpiration:void 0,growthLockType:void 0},f));break;case d("WAWebGroupType").GROUP_ACTIONS.GROWTH_LOCKED:e.type==="invite"&&A.push(d("WAWebDBGroupsGroupMetadata").persistGroupMetadata(g,{growthLockExpiration:e.expiration,growthLockType:e.type},f));break;case d("WAWebGroupType").GROUP_ACTIONS.PARENT_GROUP_LINK:C=e.groupDatas[0].id;A.push(d("WAWebDBGroupsGroupMetadata").persistGroupMetadata(g,{parentGroup:C.toString()},f));break;case d("WAWebGroupType").GROUP_ACTIONS.SUB_GROUP_LINK:A.push(d("WAWebDBCommunity").persistCommunityLink(g,e.groupDatas,d("WAWebDBCommunityTypes").CommunityLinkOperation.SubGroupLink,f),d("WAWebDBGroupsGroupMetadata").persistGroupMetadata(g,{lastActivityTimestamp:d("WATimeUtils").unixTime()},f));break;case d("WAWebGroupType").GROUP_ACTIONS.SIBLING_GROUP_LINK:A.push(d("WAWebDBCommunity").persistCommunityLink(g,e.groupDatas,d("WAWebDBCommunityTypes").CommunityLinkOperation.SiblingGroupLink,f));break;case d("WAWebGroupType").GROUP_ACTIONS.PARENT_GROUP_UNLINK:A.push(d("WAWebDBGroupsGroupMetadata").persistGroupMetadata(g,{parentGroup:void 0},f));break;case d("WAWebGroupType").GROUP_ACTIONS.SUB_GROUP_UNLINK:A.push(d("WAWebDBCommunity").persistCommunityLink(g,e.groupDatas,d("WAWebDBCommunityTypes").CommunityLinkOperation.SubGroupUnlink,f));break;case d("WAWebGroupType").GROUP_ACTIONS.SIBLING_GROUP_UNLINK:A.push(d("WAWebDBCommunity").persistCommunityLink(g,e.groupDatas,d("WAWebDBCommunityTypes").CommunityLinkOperation.SiblingGroupUnlink,f));break;case d("WAWebGroupType").GROUP_ACTIONS.MEMBERSHIP_APPROVAL_MODE:d("WAWebABProps").getABPropConfigValue("group_join_request_m2")&&(A.push(d("WAWebDBGroupsGroupMetadata").persistGroupMetadata(g,{membershipApprovalMode:e.value},f)),e.value||A.push(d("WAWebApiMembershipApprovalRequestStore").removeAllMembershipApprovalRequests(g)));break;case d("WAWebGroupType").GROUP_ACTIONS.MEMBERSHIP_APPROVAL_REQUEST:if(d("WAWebABProps").getABPropConfigValue("group_join_request_m2")&&!d("WAWebABProps").getABPropConfigValue("group_join_request_m3")){A.push(d("WAWebApiMembershipApprovalRequestStore").addMembershipApprovalRequests(a.chatId,[{id:c("WANullthrows")(w),t:B,addedBy:c("WANullthrows")(w),requestMethod:e.requestMethod,parentGroupId:e.parentGroupId}]));y=d("WAWebNux").getMembershipApprovalRequestsBannerNuxKey(a.chatId.toString());d("WAWebNuxAction").resetNux(y)}break;case d("WAWebGroupType").GROUP_ACTIONS.ALLOW_ADMIN_REPORTS:A.push(d("WAWebDBGroupsGroupMetadata").persistGroupMetadata(g,babelHelpers["extends"]({reportToAdminMode:e.value},!e.value&&{lastReportToAdminTimestamp:null}),f));break;case d("WAWebGroupType").GROUP_ACTIONS.ADMIN_REPORT_RECIEVED:A.push(d("WAWebDBGroupsGroupMetadata").persistGroupMetadata(g,{lastReportToAdminTimestamp:e.value},f));break;case d("WAWebGroupType").GROUP_ACTIONS.CREATED_MEMBERSHIP_REQUESTS:if(d("WAWebABProps").getABPropConfigValue("group_join_request_m2")&&d("WAWebABProps").getABPropConfigValue("group_join_request_m3")){A.push(d("WAWebApiMembershipApprovalRequestStore").addMembershipApprovalRequests(a.chatId,e.requests.map(function(a){return{id:a,t:B,addedBy:c("WANullthrows")(w),requestMethod:e.requestMethod,parentGroupId:e.parentGroupId}})));J=d("WAWebNux").getMembershipApprovalRequestsBannerNuxKey(a.chatId.toString());d("WAWebNuxAction").resetNux(J)}break;case d("WAWebGroupType").GROUP_ACTIONS.REVOKED_MEMBERSHIP_REQUESTS:d("WAWebABProps").getABPropConfigValue("group_join_request_m2")&&A.push(d("WAWebGroupMembershipApprovalRequestsJob").removeMembershipApprovalRequestsJob(a.chatId,e.requests,f));break;case d("WAWebGroupType").GROUP_ACTIONS.ALLOW_NON_ADMIN_SUB_GROUP_CREATION:A.push(d("WAWebDBGroupsGroupMetadata").persistGroupMetadata(g,{allowNonAdminSubGroupCreation:!!e.value},f));break;case d("WAWebGroupType").GROUP_ACTIONS.CREATED_SUBGROUP_SUGGESTION:A.push(d("WAWebApiSubgroupSuggestionStore").addSubgroupSuggestions(a.chatId,[{id:e.id,parentGroupId:e.parentGroupId,subject:e.subject,desc:e.description,owner:e.owner,t:e.t,isExistingGroup:(C=e.isExistingGroup)!=null?C:!1,participantCount:e.participantCount}]));y=d("WAWebNux").getSubgroupSuggestionsBannerNuxKey(a.chatId.toString());void d("WAWebNuxAction").resetNux(y);break;case d("WAWebGroupType").GROUP_ACTIONS.REVOKED_SUB_GROUP_SUGGESTIONS:A.push(d("WAWebSubgroupSuggestionsJob").removeSubgroupSuggestionsJob(e.subgroupSuggestions.map(function(a){var b=a.id;a=a.owner;return{parentGroupId:e.parentGroupId,id:b,owner:a}}),f));break;case d("WAWebGroupType").GROUP_ACTIONS.SUBGROUP_SUGGESTIONS_CHANGE_NUMBER:A.push(d("WAWebApiSubgroupSuggestionStore").updateOwnerInSubgroupSuggestions(e.parentGroupId,e.subgroupSuggestions,e.oldOwner,e.newOwner));break;case d("WAWebGroupType").GROUP_ACTIONS.MEMBER_ADD_MODE:d("WAWebABProps").getABPropConfigValue("web_anyone_can_add_group_setting_enabled")&&A.push(d("WAWebDBGroupsGroupMetadata").persistGroupMetadata(g,{memberAddMode:e.memberAddMode},f));break;case d("WAWebGroupType").GROUP_ACTIONS.GENERAL_CHAT_AUTO_ADD_DISABLED:A.push(d("WAWebDBGroupsGroupMetadata").persistGroupMetadata(g,{generalChatAutoAddDisabled:!0},f));break;default:d("WALogger").ERROR(j(),JSON.stringify(e)).tags("groups");break}yield (h||(h=b("Promise"))).all(A);d("WALogger").LOG(i()).tags("groups")});return w.apply(this,arguments)}function x(a,b){return y.apply(this,arguments)}function y(){y=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(a.isParentGroup===!0&&a.allowNonAdminSubGroupCreation!==!0&&d("WAWebCommunityGatingUtils").memberSuggestedGroupsEnabled()){a=(yield d("WAWebDBCommunity").getJoinedSubgroups(b));a[0]&&void d("WAWebQueryAndUpdateSubgroupSuggestionsJob").queryAndUpdateSubgroupSuggestions(b,a[0])}});return y.apply(this,arguments)}function z(a,b){return b?d("WAWebGroupDatabaseJob").markGroupParticipantStaleJob(a):d("WAWebGroupQueryBridge").sendQueryGroup(a)}g.updateDBForGroupAction=a}),98);
__d("WAWebHandleGroupNotificationV2",["Promise","WALogger","WAWap","WAWebBackendApi","WAWebCmd","WAWebCommsWapMd","WAWebGetMessageCache","WAWebGroupDatabaseJob","WAWebGroupSystemMsg","WAWebHandleGroupNotificationConst","WAWebHandleSingleMsg","WAWebMessageThread","WAWebShouldTriggerQueryGroupInfo","WAWebUpdateDbForGroupActionApi","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handle_group_notification_v2: handling notification for ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["no handler for group notification ",""]);j=function(){return a};return a}function a(a,b){return m(a,b)!=null}function k(a){return d("WAWap").wap("ack",{to:d("WAWebCommsWapMd").GROUP_JID(a.chatId),id:d("WAWap").CUSTOM_STRING(a.externalId),"class":"notification",type:"w:gp2",participant:a.author?d("WAWebCommsWapMd").USER_JID(a.author):d("WAWap").DROP_ATTR})}function c(a,b){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){c=m(a,c);if(c==null){d("WALogger").WARN(j(),a.chatId.toLogString());return k(a)}d("WALogger").DEV(i(),a.chatId.toString());yield (h||(h=b("Promise"))).all([c.writeSystemMessages(),c.writeGroupInfoUpdates()]);return k(a)});return l.apply(this,arguments)}function m(a,c){var e=[];for(var f of a.actions){var g=i(a,f);if(g==null)return null;e.push(g)}return{writeSystemMessages:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield (h||(h=b("Promise"))).all(e.map(function(a){return a.writeSystemMessages()}))});function c(){return a.apply(this,arguments)}return c}(),writeGroupInfoUpdates:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield (h||(h=b("Promise"))).all(e.map(function(a){return a.writeGroupInfoUpdates()}))});function c(){return a.apply(this,arguments)}return c}()};function i(e,a){return a.actionType===d("WAWebHandleGroupNotificationConst").GROUP_NOTIFICATION_TAG.CREATE?null:{writeGroupInfoUpdates:function(){var f=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if((a.actionType===d("WAWebHandleGroupNotificationConst").GROUP_NOTIFICATION_TAG.ADD||a.actionType===d("WAWebHandleGroupNotificationConst").GROUP_NOTIFICATION_TAG.REMOVE)&&(yield d("WAWebShouldTriggerQueryGroupInfo").shouldTriggerQueryGroupInfo(e.chatId,a))){d("WAWebGroupDatabaseJob").markGroupParticipantStaleJob(e.chatId);return}yield d("WAWebUpdateDbForGroupActionApi").updateDBForGroupAction(e,a,c);d("WAWebBackendApi").frontendSendAndReceive("updateModelForGroupAction",{groupMeta:e,groupAction:a})});function g(){return f.apply(this,arguments)}return g}(),writeSystemMessages:function(){var f=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){return p(e.chatId,yield n(e,a),c,function(){return d("WAWebHandleGroupNotificationConst").shouldSkipGenMsg(e,a)})});function g(){return f.apply(this,arguments)}return g}()}}}function n(a,b){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=[];if((b.actionType===d("WAWebHandleGroupNotificationConst").GROUP_NOTIFICATION_TAG.ADD||b.actionType===d("WAWebHandleGroupNotificationConst").GROUP_NOTIFICATION_TAG.REMOVE)&&(yield d("WAWebShouldTriggerQueryGroupInfo").shouldTriggerQueryGroupInfo(a.chatId,b)))return[];if(b.actionType===d("WAWebHandleGroupNotificationConst").GROUP_NOTIFICATION_TAG.ADD){var e=(yield d("WAWebHandleGroupNotificationConst").notAlreadyInGroup(a.chatId,b.participants));e=e.filter(function(a){a=a.id;return!a.isLid()});e.length>0&&(c=[yield d("WAWebGroupSystemMsg").genGroupNotificationMsg(a,babelHelpers["extends"]({},b,{participants:e}))])}else b.actionType!==d("WAWebHandleGroupNotificationConst").GROUP_NOTIFICATION_TAG.CREATE&&(c=[yield d("WAWebGroupSystemMsg").genGroupNotificationMsg(a,b)]);return c});return o.apply(this,arguments)}function p(a,c,e,f){var g=function(){return void 0},i=new(h||(h=b("Promise")))(function(a){return g=a});d("WAWebMessageThread").handleMessage(a.toString(),e,b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(yield f()){g();return}var a=j(c).then(function(){g()});return e?(h||(h=b("Promise"))).resolve():a}));return i;function j(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.length===0)return;if(e){d("WAWebCmd").Cmd.isMainStreamReadyMd&&a.forEach(function(a){d("WAWebBackendApi").frontendFireAndForget("updateMessageUI",{chatId:a.id.remote,msg:a})});return d("WAWebGetMessageCache").getMessageCache().addMessages(a.map(function(a){return{msg:a}}),!1)}yield (h||(h=b("Promise"))).all(a.map(function(a){return d("WAWebHandleSingleMsg").handleSingleMsg(a.from,a)}))});return k.apply(this,arguments)}}g.isGroupNotificationOptimizationEligible=a;g.handleGroupNotificationV2=c}),98);
__d("WASmaxInGroupsServerNotificationMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"t",0,void 0);if(!b.success)return b;var c=d("WASmaxParseUtils").attrStanzaId(a,"id");if(!c.success)return c;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,a,"offline",0,1024);return!a.success?a:d("WAResultOrError").makeResult({t:b.value,id:c.value,offline:a.value})}g.parseServerNotificationMixin=a}),98);
__d("WASmaxInGroupsGroupsDirtyNotificationRequest",["WAResultOrError","WASmaxInGroupsServerNotificationMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"group");if(!b.success)return b;b=d("WASmaxParseJid").attrGroupJid(a,"jid");return!b.success?b:d("WAResultOrError").makeResult({jid:b.value})}function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"groups_dirty");if(!b.success)return b;var c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","w:gp2");if(!c.success)return c;var e=d("WASmaxParseJid").literalJid(d("WASmaxParseJid").attrDomainJid,a,"from","g.us");if(!e.success)return e;a=d("WASmaxInGroupsServerNotificationMixin").parseServerNotificationMixin(a);if(!a.success)return a;b=d("WASmaxParseUtils").mapChildrenWithTag(b.value,"group",1,500,h);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({type:c.value,from:e.value},a.value,{groupsDirtyGroup:b.value}))}g.parseGroupsDirtyNotificationRequestGroupsDirtyGroup=h;g.parseGroupsDirtyNotificationRequest=a}),98);
__d("WASmaxOutGroupsNotificationClientAckMixin",["WASmaxInGroupsEnums","WASmaxJsx","WASmaxMixins","WASmaxParseJid","WASmaxParseReference","WASmaxParseUtils","WASmaxParsingFailure","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseReference").attrFromReference(d("WASmaxParseUtils").attrStanzaId,a,["id"]);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(b.error);var c=d("WASmaxParseReference").attrFromReference(d("WASmaxParseJid").attrJidEnum,a,["from"],d("WASmaxInGroupsEnums").DOMAINJID_GROUPJID);if(!c.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(c.error);a=d("WASmaxParseReference").attrFromReference(d("WASmaxParseUtils").attrString,a,["type"]);if(!a.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(a.error);b=d("WASmaxJsx").smax("ack",{id:d("WAWap").STANZA_ID(b.value),to:d("WAWap").JID(c.value),"class":"notification",type:d("WAWap").CUSTOM_STRING(a.value)});return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeNotificationClientAckMixin=a}),98);
__d("WASmaxOutGroupsGroupsDirtyNotificationResponseAck",["WASmaxJsx","WASmaxOutGroupsNotificationClientAckMixin"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxOutGroupsNotificationClientAckMixin").mergeNotificationClientAckMixin(d("WASmaxJsx").smax("ack",null),a);return a}g.makeGroupsDirtyNotificationResponseAck=a}),98);
__d("WASmaxGroupsGroupsDirtyNotificationRPC",["WASmaxInGroupsGroupsDirtyNotificationRequest","WASmaxOutGroupsGroupsDirtyNotificationResponseAck","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsGroupsDirtyNotificationRequest").parseGroupsDirtyNotificationRequest(a);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("GroupsDirtyNotification",{Request:b}));return{parsedRequest:b.value,makeGroupsDirtyNotificationResponseAck:function(){return d("WASmaxOutGroupsGroupsDirtyNotificationResponseAck").makeGroupsDirtyNotificationResponseAck(a)}}}g.receiveGroupsDirtyNotificationRPC=a}),98);
__d("WAWebHandleGroupsDirtyNotification",["WALogger","WASmaxGroupsGroupsDirtyNotificationRPC","WAWebPersistedJobDefinitions","WAWebPersistedJobManager"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleGroupsDirtyNotification: received groups dirty bit notification"]);h=function(){return a};return a}function a(a){a=d("WASmaxGroupsGroupsDirtyNotificationRPC").receiveGroupsDirtyNotificationRPC(a);var b=a.makeGroupsDirtyNotificationResponseAck;a=a.parsedRequest;d("WALogger").LOG(h());a=a.groupsDirtyGroup.map(function(a){return a.jid});i(a);return b()}function i(a){var c=b("WAWebPersistedJobManager").getJobManager;c().fireAndForget(d("WAWebPersistedJobDefinitions").jobSerializers.queryAndUpdateGroupsMetadataByJids(a))}g.handleGroupsDirtyNotificationJob=a;g.queryAndUpdateDirtyGroupsMetadata=i}),98);
__d("WAWebHandleGroupNotification",["Promise","WADeprecatedWapParser","WALogger","WANullthrows","WAWap","WAWebABProps","WAWebApiParticipantStore","WAWebBackendApi","WAWebCommsWapMd","WAWebCommunityGatingUtils","WAWebCreateOrReplaceDisplayNamesAndLidPnMappingsJob","WAWebDBGroupsGroupMetadata","WAWebGetMessageCache","WAWebGroupApiConst","WAWebGroupQueryJob","WAWebGroupSystemMsg","WAWebGroupType","WAWebGroupsQueryApi","WAWebHandleGroupCreation","WAWebHandleGroupNotificationConst","WAWebHandleGroupNotificationV2","WAWebHandleGroupsDirtyNotification","WAWebHandleSingleMsg","WAWebJidToWid","WAWebMessageThread","WAWebOfflineHandler","WAWebRequestMethodType","WAWebSchemaChat","WAWebSchemaGroupMetadata","WAWebShouldTriggerQueryGroupInfo","WAWebUpdateDbForGroupActionApi","WAWebUserPrefsMeUser","asyncToGeneratorRuntime","cr:4533","gkx"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose([""," is a CAG with LID addressing mode"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleGroupNotification: failed with ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["updateDBForGroupAction done for ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["updateDBForGroupAction done for ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["updateDBForGroupAction done for ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["updateDBForGroupAction done for ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["updateDBForGroupAction done for ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleGroupNotification debug: ignoring participant add for "," times"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleGroupCreation done for group id ",""]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["group id "," exists in storage = ",""]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["handle action ",""]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["Parsing Error: ",""]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["error while parsing: ",""]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["Known error T150827746: ",""]);v=function(){return a};return a}function w(a){if(a.hasChild("description")){a=a.child("description");if(a.hasChild("body")){var b=a.child("body");if(b.hasContent())return{content:b.contentString(),id:a.attrString("id")}}}return null}function x(a){if(a.hasChild("ephemeral")){a=a.child("ephemeral");if(a.hasAttr("expiration"))return{ephemeralDuration:a.attrInt("expiration")}}return null}function y(a){return a.mapChildrenWithTag("participant",function(a){var b=a.attrEnumOrDefault("type",d("WAWebGroupApiConst").GROUP_PARTICIPANT_TYPES,"participant"),c=a.maybeAttrLidUserJid("lid"),e=a.maybeAttrPhoneUserJid("phone_number");return{displayName:a.maybeAttrString("display_name"),id:d("WAWebJidToWid").userJidToUserWid(a.attrUserJid("jid")),isSuperAdmin:b===d("WAWebGroupApiConst").GROUP_PARTICIPANT_TYPES.superadmin,isAdmin:b===d("WAWebGroupApiConst").GROUP_PARTICIPANT_TYPES.admin||b===d("WAWebGroupApiConst").GROUP_PARTICIPANT_TYPES.superadmin,lid:c!=null?d("WAWebJidToWid").userJidToUserWid(c):null,phoneNumber:e!=null?d("WAWebJidToWid").userJidToUserWid(e):null}})}function z(a){a=a.child("sub_group_suggestion");var b=d("WAWebJidToWid").groupJidToWid(a.attrGroupJid("jid")),c=d("WAWebJidToWid").userJidToUserWid(a.attrUserJid("creator")),e=a.attrTime("creation"),f=a.child("subject");f=f.contentString();var g,h,i;if(a.hasChild("description")){var j=a.child("description");if(j.hasChild("body")){j=j.child("body");j.hasContent()&&(g=j.contentString())}}if(a.hasChild("is_existing_group")){j=a.child("is_existing_group");j.hasContent()&&(h=j.contentString()==="true")}if(a.hasChild("participant_count")){j=a.child("participant_count");j.hasContent()&&(i=j.contentInt())}return{id:b,owner:c,subject:f,description:g,t:e,isExistingGroup:(a=h)!=null?a:!1,participantCount:i}}var A={invite:(e=d("WAWebGroupType")).ADD_REASON.INVITE,linked_group_join:e.ADD_REASON.LINKED_GROUP_JOIN,auto_add:e.ADD_REASON.AUTO_ADD,default_sub_group_admin_add:e.ADD_REASON.DEFAULT_SUBGROUP_ADMIN_ADD,default_sub_group_promote:e.ADD_REASON.DEFAULT_SUBGROUP_PROMOTE,invite_auto_add:e.ADD_REASON.INVITE_AUTO_ADD,general_chat_auto_add:e.ADD_REASON.GENERAL_CHAT_AUTO_ADD},B={default_sub_group_demote:e.REMOVE_REASON.DEFAULT_SUBGROUP_DEMOTE},C={invite_link:d("WAWebRequestMethodType").RequestMethod.InviteLink,linked_group_join:d("WAWebRequestMethodType").RequestMethod.LinkedGroupJoin,non_admin_add:d("WAWebRequestMethodType").RequestMethod.NonAdminAdd},D={approved:e.RevokedSubGroupSuggestionReason.APPROVED,rejected:e.RevokedSubGroupSuggestionReason.REJECTED,cancelled:e.RevokedSubGroupSuggestionReason.CANCELLED};function E(a){var b=a.child("group"),c=y(b),e=w(b),f=x(b),g=d("WAWebGroupsQueryApi").extractLinkedParent(b);g={subject:b.attrString("subject"),restrict:b.hasChild("locked"),announce:b.hasChild("announcement"),noFrequentlyForwarded:b.hasChild("no_frequently_forwarded"),ephemeralDuration:f?f.ephemeralDuration:void 0,owner:b.hasAttr("creator")?d("WAWebJidToWid").userJidToUserWid(b.attrUserJid("creator")):void 0,creation:b.attrTime("creation"),participants:c,desc:e?e.content:void 0,descId:e?e.id:void 0,subjectOwner:b.hasAttr("s_o")?d("WAWebJidToWid").userJidToUserWid(b.attrUserJid("s_o")):void 0,subjectTime:b.hasAttr("s_t")?b.attrTime("s_t"):void 0,support:b.hasChild("support"),isParentGroup:b.hasChild("parent"),isParentGroupClosed:((f=b.maybeChild("parent"))==null?void 0:f.maybeAttrString("default_membership_approval_mode"))==="request_required",parentGroup:g?g.parentGroup:void 0,defaultSubgroup:b.hasChild("default_sub_group"),generalSubgroup:b.hasChild("general_chat"),size:b.hasAttr("size")?b.attrInt("size"):void 0,incognito:b.hasChild("incognito"),membershipApprovalMode:(b==null?void 0:(c=b.maybeChild("membership_approval_mode"))==null?void 0:(e=c.maybeChild("group_join"))==null?void 0:e.maybeAttrString("state"))==="on",allowNonAdminSubGroupCreation:b==null?void 0:b.hasChild("allow_non_admin_sub_group_creation"),generalChatAutoAddDisabled:(f=a.hasChild("auto_add_disabled"))!=null?f:void 0};return{actionType:d("WAWebHandleGroupNotificationConst").GROUP_NOTIFICATION_TAG.CREATE,reason:a.hasAttr("reason")?A[a.attrString("reason")]:null,contextGroupId:a.hasAttr("context_group_jid")?d("WAWebJidToWid").groupJidToWid(a.attrGroupJid("context_group_jid")):null,groupInfo:g}}var F=new(c("WADeprecatedWapParser"))("groupNotificationParser",function(a){a.assertTag("notification");a.hasAttr("to")&&a.assertAttr("to",d("WAWebUserPrefsMeUser").assertGetMe().toJid());var b=d("WAWebJidToWid").groupJidToWid(a.attrGroupJid("from")),e=a.hasAttr("participant")?d("WAWebJidToWid").userJidToUserWid(a.attrUserJid("participant")):null,f=null;try{var g=a.maybeAttrPhoneUserJid("participant_pn");f=g!=null?d("WAWebJidToWid").userJidToUserWid(g):null}catch(a){d("WALogger").ERROR(v(),a.toString())}var h=a.attrTime("t"),i=a.hasAttr("addressing_mode")?a.attrString("addressing_mode")==="lid":!1;function j(a){return{jid:a.hasAttr("jid")?d("WAWebJidToWid").groupJidToWid(a.attrGroupJid("jid")):void 0}}g=a.mapChildren(function(f){var g=f.tag();switch(g){case d("WAWebHandleGroupNotificationConst").GROUP_NOTIFICATION_TAG.CREATE:return E(f);case d("WAWebHandleGroupNotificationConst").GROUP_NOTIFICATION_TAG.ADD:return{actionType:d("WAWebGroupType").GROUP_ACTIONS.ADD,participants:y(f),reason:f.hasAttr("reason")?A[f.attrString("reason")]:null,isLidAddressingMode:i};case d("WAWebHandleGroupNotificationConst").GROUP_NOTIFICATION_TAG.DELETE:var k={integrity_delete_parent:d("WAWebGroupType").DELETE_REASON.INTEGRITY_DELETE_PARENT,delete_parent:d("WAWebGroupType").DELETE_REASON.DELETE_PARENT};return{actionType:d("WAWebGroupType").GROUP_ACTIONS.DELETE,reason:f.hasAttr("reason")?k[f.attrString("reason")]:null,groupDatas:[{id:b,subject:""}]};case d("WAWebHandleGroupNotificationConst").GROUP_NOTIFICATION_TAG.REMOVE:return{actionType:d("WAWebHandleGroupNotificationConst").GROUP_NOTIFICATION_TAG.REMOVE,participants:y(f),reason:f.hasAttr("reason")?B[f.attrString("reason")]:null,isLidAddressingMode:i};case d("WAWebHandleGroupNotificationConst").GROUP_NOTIFICATION_TAG.PROMOTE:return{actionType:d("WAWebHandleGroupNotificationConst").GROUP_NOTIFICATION_TAG.PROMOTE,participants:y(f)};case d("WAWebHandleGroupNotificationConst").GROUP_NOTIFICATION_TAG.DEMOTE:return{actionType:d("WAWebHandleGroupNotificationConst").GROUP_NOTIFICATION_TAG.DEMOTE,participants:y(f)};case d("WAWebHandleGroupNotificationConst").GROUP_NOTIFICATION_TAG.LINKED_GROUP_PROMOTE:return babelHelpers["extends"]({actionType:d("WAWebHandleGroupNotificationConst").GROUP_NOTIFICATION_TAG.LINKED_GROUP_PROMOTE,participants:y(f)},j(f));case d("WAWebHandleGroupNotificationConst").GROUP_NOTIFICATION_TAG.LINKED_GROUP_DEMOTE:return babelHelpers["extends"]({actionType:d("WAWebHandleGroupNotificationConst").GROUP_NOTIFICATION_TAG.LINKED_GROUP_DEMOTE,participants:y(f)},j(f));case d("WAWebHandleGroupNotificationConst").GROUP_NOTIFICATION_TAG.MODIFY:return{actionType:d("WAWebGroupType").GROUP_ACTIONS.MODIFY,participants:y(f)};case d("WAWebHandleGroupNotificationConst").GROUP_NOTIFICATION_TAG.SUBJECT:return{actionType:d("WAWebGroupType").GROUP_ACTIONS.SUBJECT,subject:f.attrString("subject"),s_o:f.hasAttr("s_o")?d("WAWebJidToWid").userJidToUserWid(f.attrUserJid("s_o")):null,s_t:f.hasAttr("s_t")?f.attrTime("s_t"):null};case d("WAWebHandleGroupNotificationConst").GROUP_NOTIFICATION_TAG.DESC:return f.hasChild("delete")?{actionType:d("WAWebGroupType").GROUP_ACTIONS.DESC_REMOVE,descId:f.attrString("id")}:{actionType:d("WAWebGroupType").GROUP_ACTIONS.DESC_ADD,descId:f.attrString("id"),desc:f.hasChild("body")?f.child("body").contentString():null,descTime:h};case d("WAWebHandleGroupNotificationConst").GROUP_NOTIFICATION_TAG.SUSPENDED:return{actionType:d("WAWebGroupType").GROUP_ACTIONS.SUSPEND,value:!0};case d("WAWebHandleGroupNotificationConst").GROUP_NOTIFICATION_TAG.UNSUSPENDED:return{actionType:d("WAWebGroupType").GROUP_ACTIONS.SUSPEND,value:!1};case d("WAWebHandleGroupNotificationConst").GROUP_NOTIFICATION_TAG.LOCKED:return{actionType:d("WAWebGroupType").GROUP_ACTIONS.RESTRICT,value:!0,threshold:(k=f.maybeAttrString("threshold"))!=null?k:void 0};case d("WAWebHandleGroupNotificationConst").GROUP_NOTIFICATION_TAG.UNLOCKED:return{actionType:d("WAWebGroupType").GROUP_ACTIONS.RESTRICT,value:!1};case d("WAWebHandleGroupNotificationConst").GROUP_NOTIFICATION_TAG.ANNOUNCE:return{actionType:d("WAWebGroupType").GROUP_ACTIONS.ANNOUNCE,value:!0};case d("WAWebHandleGroupNotificationConst").GROUP_NOTIFICATION_TAG.NOT_ANNOUNCE:return{actionType:d("WAWebGroupType").GROUP_ACTIONS.ANNOUNCE,value:!1};case d("WAWebHandleGroupNotificationConst").GROUP_NOTIFICATION_TAG.NO_FREQUENTLY_FORWARDED:return{actionType:d("WAWebGroupType").GROUP_ACTIONS.NO_FORWARD,value:!0};case d("WAWebHandleGroupNotificationConst").GROUP_NOTIFICATION_TAG.FREQUENTLY_FORWARDED_OK:return{actionType:d("WAWebGroupType").GROUP_ACTIONS.NO_FORWARD,value:!1};case d("WAWebHandleGroupNotificationConst").GROUP_NOTIFICATION_TAG.INVITE:return{actionType:d("WAWebGroupType").GROUP_ACTIONS.INVITE_CODE,code:f.attrString("code")};case d("WAWebHandleGroupNotificationConst").GROUP_NOTIFICATION_TAG.EPHEMERAL:return{actionType:d("WAWebGroupType").GROUP_ACTIONS.EPHEMERAL,duration:f.attrInt("expiration")};case d("WAWebHandleGroupNotificationConst").GROUP_NOTIFICATION_TAG.NOT_EPHEMERAL:return{actionType:d("WAWebGroupType").GROUP_ACTIONS.EPHEMERAL,duration:0};case d("WAWebHandleGroupNotificationConst").GROUP_NOTIFICATION_TAG.REVOKE_INVITE:return{actionType:d("WAWebGroupType").GROUP_ACTIONS.REVOKE_INVITE,participants:f.mapChildrenWithTag("participant",function(a){return{id:d("WAWebJidToWid").userJidToUserWid(a.attrUserJid("jid")),expiration:a.attrInt("expiration")}})};case d("WAWebHandleGroupNotificationConst").GROUP_NOTIFICATION_TAG.GROWTH_UNLOCKED:return{actionType:d("WAWebGroupType").GROUP_ACTIONS.GROWTH_UNLOCKED};case d("WAWebHandleGroupNotificationConst").GROUP_NOTIFICATION_TAG.GROWTH_LOCKED:return{actionType:d("WAWebGroupType").GROUP_ACTIONS.GROWTH_LOCKED,expiration:f.attrInt("expiration"),type:f.attrString("type")};case d("WAWebHandleGroupNotificationConst").GROUP_NOTIFICATION_TAG.LINK:k=f.attrString("link_type");var l={sub_group:d("WAWebGroupType").GROUP_ACTIONS.SUB_GROUP_LINK,parent_group:d("WAWebGroupType").GROUP_ACTIONS.PARENT_GROUP_LINK,sibling_group:d("WAWebGroupType").GROUP_ACTIONS.SIBLING_GROUP_LINK};return{actionType:l[k],groupDatas:f.mapChildrenWithTag("group",function(a){return{id:d("WAWebJidToWid").groupJidToWid(a.attrGroupJid("jid")),subject:a.attrString("subject"),subjectTime:a.attrInt("s_t")}})};case d("WAWebHandleGroupNotificationConst").GROUP_NOTIFICATION_TAG.UNLINK:l=f.attrString("unlink_type");k=f.hasAttr("unlink_reason")?f.attrString("unlink_reason"):null;var m=f.mapChildrenWithTag("group",function(a){return{id:d("WAWebJidToWid").groupJidToWid(a.attrGroupJid("jid")),subject:a.attrString("subject"),subjectTime:a.attrInt("s_t")}});if(l==="parent_group"){if(k===d("WAWebGroupType").DELETE_REASON.DELETE_PARENT)return{actionType:d("WAWebGroupType").GROUP_ACTIONS.DELETE_PARENT_GROUP_UNLINK,groupDatas:m};if(k===d("WAWebGroupType").DELETE_REASON.INTEGRITY_DELETE_PARENT)return{actionType:d("WAWebGroupType").GROUP_ACTIONS.INTEGRITY_PARENT_GROUP_UNLINK,groupDatas:m}}else if(l==="sub_group")if(k===d("WAWebGroupType").DELETE_REASON.DELETE_PARENT)return{actionType:d("WAWebGroupType").GROUP_ACTIONS.DELETE_PARENT_GROUP_UNLINK,groupDatas:m};else if(k===d("WAWebGroupType").DELETE_REASON.INTEGRITY_DELETE_PARENT)return{actionType:d("WAWebGroupType").GROUP_ACTIONS.INTEGRITY_SUB_GROUP_UNLINK,groupDatas:m};k={sub_group:d("WAWebGroupType").GROUP_ACTIONS.SUB_GROUP_UNLINK,parent_group:d("WAWebGroupType").GROUP_ACTIONS.PARENT_GROUP_UNLINK,sibling_group:d("WAWebGroupType").GROUP_ACTIONS.SIBLING_GROUP_UNLINK};return{actionType:k[l],groupDatas:m};case d("WAWebHandleGroupNotificationConst").GROUP_NOTIFICATION_TAG.MEMBERSHIP_APPROVAL_MODE:return{actionType:d("WAWebGroupType").GROUP_ACTIONS.MEMBERSHIP_APPROVAL_MODE,value:((k=f.child("group_join"))==null?void 0:k.attrString("state"))==="on",triggered:f.hasAttr("triggered")?f.attrString("triggered"):void 0};case d("WAWebHandleGroupNotificationConst").GROUP_NOTIFICATION_TAG.MEMBERSHIP_APPROVAL_REQUEST:return{actionType:d("WAWebGroupType").GROUP_ACTIONS.MEMBERSHIP_APPROVAL_REQUEST,requestMethod:(l=C[f.attrString("request_method")])!=null?l:d("WAWebRequestMethodType").RequestMethod.InviteLink,parentGroupId:f.hasAttr("parent_group_jid")?d("WAWebJidToWid").groupJidToWid(f.attrGroupJid("parent_group_jid")):void 0};case d("WAWebHandleGroupNotificationConst").GROUP_NOTIFICATION_TAG.ALLOW_ADMIN_REPORTS:return{actionType:d("WAWebGroupType").GROUP_ACTIONS.ALLOW_ADMIN_REPORTS,shouldSkipGenMsg:!d("WAWebABProps").getABPropConfigValue("report_to_admin_kill_switch"),value:!0,author:e,triggered:f.hasAttr("triggered")?f.attrString("triggered"):void 0};case d("WAWebHandleGroupNotificationConst").GROUP_NOTIFICATION_TAG.NOT_ALLOW_ADMIN_REPORTS:return{actionType:d("WAWebGroupType").GROUP_ACTIONS.ALLOW_ADMIN_REPORTS,shouldSkipGenMsg:!d("WAWebABProps").getABPropConfigValue("report_to_admin_kill_switch"),value:!1,author:e,triggered:f.hasAttr("triggered")?f.attrString("triggered"):void 0};case d("WAWebHandleGroupNotificationConst").GROUP_NOTIFICATION_TAG.REPORTS:return{actionType:d("WAWebGroupType").GROUP_ACTIONS.ADMIN_REPORT_RECIEVED,shouldSkipGenMsg:!0,value:h};case d("WAWebHandleGroupNotificationConst").GROUP_NOTIFICATION_TAG.CREATED_MEMBERSHIP_REQUESTS:return{actionType:d("WAWebGroupType").GROUP_ACTIONS.CREATED_MEMBERSHIP_REQUESTS,requestMethod:(m=C[f.attrString("request_method")])!=null?m:d("WAWebRequestMethodType").RequestMethod.InviteLink,parentGroupId:f.hasAttr("parent_group_jid")?d("WAWebJidToWid").groupJidToWid(f.attrGroupJid("parent_group_jid")):void 0,requests:f.hasChildren()?f.mapChildrenWithTag("requested_user",function(a){return d("WAWebJidToWid").userJidToUserWid(a.attrUserJid("jid"))}):[c("WANullthrows")(e)],skipGenMsg:f.maybeAttrString("suppress_sys_msg")==="true"};case d("WAWebHandleGroupNotificationConst").GROUP_NOTIFICATION_TAG.REVOKED_MEMBERSHIP_REQUESTS:return{actionType:d("WAWebGroupType").GROUP_ACTIONS.REVOKED_MEMBERSHIP_REQUESTS,requests:f.mapChildrenWithTag("participant",function(a){return d("WAWebJidToWid").userJidToUserWid(a.attrUserJid("jid"))})};case d("WAWebHandleGroupNotificationConst").GROUP_NOTIFICATION_TAG.ALLOW_NON_ADMIN_SUB_GROUP_CREATION:return{actionType:d("WAWebGroupType").GROUP_ACTIONS.ALLOW_NON_ADMIN_SUB_GROUP_CREATION,value:!0};case d("WAWebHandleGroupNotificationConst").GROUP_NOTIFICATION_TAG.NOT_ALLOW_NON_ADMIN_SUB_GROUP_CREATION:return{actionType:d("WAWebGroupType").GROUP_ACTIONS.ALLOW_NON_ADMIN_SUB_GROUP_CREATION,value:!1};case d("WAWebHandleGroupNotificationConst").GROUP_NOTIFICATION_TAG.CREATED_SUBGROUP_SUGGESTION:return babelHelpers["extends"]({actionType:d("WAWebGroupType").GROUP_ACTIONS.CREATED_SUBGROUP_SUGGESTION,parentGroupId:b},z(f));case d("WAWebHandleGroupNotificationConst").GROUP_NOTIFICATION_TAG.REVOKED_SUB_GROUP_SUGGESTIONS:return{actionType:d("WAWebGroupType").GROUP_ACTIONS.REVOKED_SUB_GROUP_SUGGESTIONS,parentGroupId:b,subgroupSuggestions:f.mapChildrenWithTag("sub_group_suggestion",function(a){return{id:d("WAWebJidToWid").groupJidToWid(a.attrGroupJid("jid")),owner:d("WAWebJidToWid").userJidToUserWid(a.attrUserJid("creator")),reason:a.hasAttr("reason")?D[a.attrString("reason")]:void 0}})};case d("WAWebHandleGroupNotificationConst").GROUP_NOTIFICATION_TAG.CHANGE_NUMBER:return{actionType:d("WAWebGroupType").GROUP_ACTIONS.SUBGROUP_SUGGESTIONS_CHANGE_NUMBER,subgroupSuggestions:f.mapChildrenWithTag("sub_group_suggestion",function(a){return d("WAWebJidToWid").groupJidToWid(a.attrGroupJid("jid"))}),parentGroupId:b,oldOwner:d("WAWebJidToWid").userJidToUserWid(a.attrUserJid("participant")),newOwner:d("WAWebJidToWid").userJidToUserWid(f.attrUserJid("jid"))};case d("WAWebHandleGroupNotificationConst").GROUP_NOTIFICATION_TAG.MEMBER_ADD_MODE:if(d("WAWebABProps").getABPropConfigValue("web_anyone_can_add_group_setting_enabled"))return{actionType:d("WAWebGroupType").GROUP_ACTIONS.MEMBER_ADD_MODE,memberAddMode:d("WAWebSchemaGroupMetadata").MemberAddMode.cast(f.contentString())};throw a.createParseError("Unrecognized group action "+g);case d("WAWebHandleGroupNotificationConst").GROUP_NOTIFICATION_TAG.AUTO_ADD_DISABLED:return{actionType:d("WAWebGroupType").GROUP_ACTIONS.GENERAL_CHAT_AUTO_ADD_DISABLED};default:throw a.createParseError("Unrecognized group action "+g)}});return{externalId:a.attrString("id"),chatId:b,isLidAddressingMode:i,author:e,authorPhoneNumber:f,ts:a.attrTime("t"),pushname:a.hasAttr("notify")?a.attrString("notify"):null,offline:a.hasAttr("offline")?a.attrString("offline"):null,actions:g}});function G(a){return H.apply(this,arguments)}function H(){H=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield (h||(h=b("Promise"))).all([d("WAWebDBGroupsGroupMetadata").getGroupMetadata(a),d("WAWebSchemaChat").getChatTable().get(a.toString(),!1)]));var c=a[0];a=a[1];return!!c||!!a&&!!a.t});return H.apply(this,arguments)}function I(a,b){return J.apply(this,arguments)}function J(){J=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){return b.participants.some(function(a){a=a.id;return a.isLid()})&&(yield d("WAWebHandleGroupNotificationConst").getIsIncognitoCagById(a.chatId))===!0?b.participants.filter(function(a){a=a.id;return!a.isLid()}):b.participants});return J.apply(this,arguments)}function K(a){var b=a.author;a=a.authorPhoneNumber;return b!=null?{id:b,phoneNumber:a}:null}function L(a,b,c){return M.apply(this,arguments)}function M(){M=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){f===void 0&&(f=!1);if(!e)return;d("WALogger").LOG(s(),e.actionType).tags("groups");var g=[];try{yield d("WAWebCreateOrReplaceDisplayNamesAndLidPnMappingsJob").createOrReplaceDisplayNamesAndLidPnMappings([K(a)].concat(e.participants),!f);if(e.actionType===d("WAWebHandleGroupNotificationConst").GROUP_NOTIFICATION_TAG.CREATE){var i=babelHelpers["extends"]({},e.groupInfo,{id:a.chatId,isLidAddressingMode:a.isLidAddressingMode}),t=Q(a,e,i),u=(yield G(i.id));d("WALogger").LOG(r(),i.id,u).tags("groups");yield O(a,i,f,t,e.reason==="invite");d("WALogger").LOG(q(),i.id).tags("groups");i=(yield d("WAWebGroupSystemMsg").genMsgsForGroupCreation(a,i,u,t));g.push.apply(g,i)}else if(e.actionType===d("WAWebGroupType").GROUP_ACTIONS.ADD){if(!c("gkx")("26258")){t=(u=b("cr:4533")==null?void 0:b("cr:4533").getDebugIgnoreParticipantAdd())!=null?u:0;if(t>0){d("WALogger").DEV(p(),t);b("cr:4533")==null?void 0:b("cr:4533").setDebugDecryptFail(t-1);return}}i=(yield d("WAWebHandleGroupNotificationConst").notAlreadyInGroup(a.chatId,e.participants));if(yield d("WAWebShouldTriggerQueryGroupInfo").shouldTriggerQueryGroupInfo(a.chatId,e))yield d("WAWebGroupQueryJob").queryAndUpdateGroupMetadataById(a.chatId);else{yield d("WAWebUpdateDbForGroupActionApi").updateDBForGroupAction(a,e,f);void N(a,e);d("WALogger").DEV(o(),JSON.stringify(e)).tags("groups");if(i.length||e.reason){u=(yield I(a,e));u.length>0&&g.push(yield d("WAWebGroupSystemMsg").genGroupNotificationMsg(a,babelHelpers["extends"]({},e,{participants:u})))}}}else if(!(e.actionType===d("WAWebGroupType").GROUP_ACTIONS.INTEGRITY_PARENT_GROUP_UNLINK||e.actionType===d("WAWebGroupType").GROUP_ACTIONS.INTEGRITY_SUB_GROUP_UNLINK))if(!(e.actionType===d("WAWebGroupType").GROUP_ACTIONS.DELETE_PARENT_GROUP_UNLINK||e.actionType===d("WAWebGroupType").GROUP_ACTIONS.DELETE_PARENT_SUB_GROUP_UNLINK))if(e.actionType===d("WAWebGroupType").GROUP_ACTIONS.DELETE&&e.reason===d("WAWebGroupType").DELETE_REASON.INTEGRITY_DELETE_PARENT){if(d("WAWebCommunityGatingUtils").communitiesEnabled()){t=(yield d("WAWebGroupSystemMsg").genIntegrityDeleteParentNotificationMsgs(a,e));t.forEach(function(a){g.push(a)})}yield d("WAWebUpdateDbForGroupActionApi").updateDBForGroupAction(a,e,f);void N(a,e);d("WALogger").DEV(n(),JSON.stringify(e)).tags("groups")}else if(e.actionType===d("WAWebGroupType").GROUP_ACTIONS.DESC_ADD||e.actionType===d("WAWebGroupType").GROUP_ACTIONS.DESC_REMOVE)g.push(yield d("WAWebGroupSystemMsg").genDescriptionNotificationMsg(a,e)),yield d("WAWebUpdateDbForGroupActionApi").updateDBForGroupAction(a,e,f),void N(a,e),d("WALogger").DEV(m(),JSON.stringify(e)).tags("groups");else if(e.actionType===d("WAWebGroupType").GROUP_ACTIONS.DELETE&&e.reason===d("WAWebGroupType").DELETE_REASON.DELETE_PARENT){if(d("WAWebCommunityGatingUtils").communitiesEnabled()){i=(yield d("WAWebGroupSystemMsg").generateDeleteParentNotificationMessages(a));if(i.length===0)return;i.forEach(function(a){g.push(a)})}yield d("WAWebUpdateDbForGroupActionApi").updateDBForGroupAction(a,e,f);void N(a,e);d("WALogger").DEV(l(),JSON.stringify(e)).tags("groups")}else{u=!1;e.actionType===d("WAWebGroupType").GROUP_ACTIONS.REMOVE&&((yield d("WAWebShouldTriggerQueryGroupInfo").shouldTriggerQueryGroupInfo(a.chatId,e))&&(u=!0,void d("WAWebGroupQueryJob").queryAndUpdateGroupMetadataById(a.chatId)));if(!u){t=(yield d("WAWebHandleGroupNotificationConst").shouldSkipGenMsg(a,e));yield d("WAWebUpdateDbForGroupActionApi").updateDBForGroupAction(a,e,f);void N(a,e);d("WALogger").DEV(k(),JSON.stringify(e)).tags("groups");if(!t){i=(yield d("WAWebApiParticipantStore").isCurrentUserGroupAdmin(a.chatId.toString()));if(e.actionType===d("WAWebGroupType").GROUP_ACTIONS.REMOVE){u=(yield I(a,e));u.length>0&&g.push(yield d("WAWebGroupSystemMsg").genGroupNotificationMsg(babelHelpers["extends"]({},a,{isAdmin:i}),babelHelpers["extends"]({},e,{participants:u})))}else if(e.actionType===d("WAWebGroupType").GROUP_ACTIONS.CREATED_SUBGROUP_SUGGESTION){t=(yield d("WAWebGroupSystemMsg").genCreatedSubgroupSuggestionNotificationMsg(a,e));t&&g.push(t)}else if(e.actionType===d("WAWebGroupType").GROUP_ACTIONS.PROMOTE||e.actionType===d("WAWebGroupType").GROUP_ACTIONS.DEMOTE||e.actionType===d("WAWebGroupType").GROUP_ACTIONS.MODIFY||e.actionType===d("WAWebGroupType").GROUP_ACTIONS.LINKED_GROUP_PROMOTE||e.actionType===d("WAWebGroupType").GROUP_ACTIONS.LINKED_GROUP_DEMOTE){u=(yield I(a,e));u.length>0&&g.push(yield d("WAWebGroupSystemMsg").genGroupNotificationMsg(babelHelpers["extends"]({},a,{isAdmin:i}),babelHelpers["extends"]({},e,{participants:u})))}else if(e.actionType===d("WAWebGroupType").GROUP_ACTIONS.ALLOW_NON_ADMIN_SUB_GROUP_CREATION){t=(yield d("WAWebGroupSystemMsg").genAllowNonAdminSubGroupCreationNotificationMsg(a,e));t&&g.push(t)}else g.push(yield d("WAWebGroupSystemMsg").genGroupNotificationMsg(babelHelpers["extends"]({},a,{isAdmin:i}),e));e.actionType===d("WAWebGroupType").GROUP_ACTIONS.PARENT_GROUP_LINK&&d("WAWebABProps").getABPropConfigValue("group_join_request_m0_anyone_can_join")&&g.push(yield d("WAWebGroupSystemMsg").genParentGroupLinkMembershipApprovalNotif(a,e.groupDatas,i))}}}f?void d("WAWebGetMessageCache").getMessageCache().addMessages(g.map(function(a){return{msg:a}}),!1):yield (h||(h=b("Promise"))).all(g.map(function(a){return d("WAWebHandleSingleMsg").handleSingleMsg(a.from,a)}))}catch(a){d("WALogger").LOG(j(),a)}});return M.apply(this,arguments)}function N(a,b){return d("WAWebBackendApi").frontendSendAndReceive("updateModelForGroupAction",{groupMeta:a,groupAction:b})}function O(a,b,c,d,e){return P.apply(this,arguments)}function P(){P=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f){c===void 0&&(c=!1),f===void 0&&(f=!1),yield d("WAWebHandleGroupCreation").handleGroupCreation(a,b,c,f),e!=null&&(yield d("WAWebUpdateDbForGroupActionApi").updateDBForGroupAction(a,e,c),void N(a,e))});return P.apply(this,arguments)}function Q(a,b,c){if(!d("WAWebUserPrefsMeUser").isMeAccount(a.author)||b.reason===d("WAWebGroupType").ADD_REASON.INVITE_AUTO_ADD){a=(a=c.participants.find(function(a){return a.id.equals(d("WAWebUserPrefsMeUser").getMaybeMeUser())}))==null?void 0:a.isAdmin;return{actionType:d("WAWebGroupType").GROUP_ACTIONS.ADD,participants:[{id:c.defaultSubgroup===!0&&c.incognito===!0||c.isLidAddressingMode===!0?d("WAWebUserPrefsMeUser").getMaybeMeLidUser():d("WAWebUserPrefsMeUser").getMaybeMeUser(),isAdmin:a,isSuperAdmin:!1}],reason:b.reason,parentGroupId:c.parentGroup,isParentGroup:c.isParentGroup,contextGroupId:b.contextGroupId,groupName:c.subject,defaultSubgroup:c.defaultSubgroup,generalSubgroup:c.generalSubgroup}}}function a(a){var c=a.content;if(c!=null&&Array.isArray(c)&&c.length>0){c=c[0];c=c.tag;if(c==="groups_dirty")return(h||(h=b("Promise"))).resolve(d("WAWebHandleGroupsDirtyNotification").handleGroupsDirtyNotificationJob(a))}c=F.parse(a);if(c.error){d("WALogger").DEV(u(),a.toString());d("WALogger").ERROR(t(),c.error.toString());return(h||(h=b("Promise"))).reject(c.error)}var e=c.success,f=Boolean(e.offline)&&!d("WAWebOfflineHandler").OfflineMessageHandler.isResumeFromRestartComplete();void R(e.chatId);return d("WAWebHandleGroupNotificationV2").isGroupNotificationOptimizationEligible(e,f)&&f?d("WAWebHandleGroupNotificationV2").handleGroupNotificationV2(e,f):d("WAWebMessageThread").handleMessage(e.chatId.toString(),f,b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield (h||(h=b("Promise"))).all(e.actions.map(function(a){return L(e,a,f)}));return d("WAWap").wap("ack",{to:d("WAWebCommsWapMd").GROUP_JID(e.chatId),id:d("WAWap").CUSTOM_STRING(e.externalId),"class":"notification",type:"w:gp2",participant:e.author?d("WAWebCommsWapMd").USER_JID(e.author):d("WAWap").DROP_ATTR})}))}function R(a){return S.apply(this,arguments)}function S(){S=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(!d("WAWebABProps").getABPropConfigValue("web_extra_lid_group_logging_attributes"))return;var b=(yield d("WAWebDBGroupsGroupMetadata").getGroupMetadata(a));b!=null&&b.defaultSubgroup===!0&&b.incognito===!0&&b.isLidAddressingMode===!0&&d("WALogger").ERROR(i(),a.toString()).sendLogs("GroupLidInfra/cag_lid_addressing_mode")});return S.apply(this,arguments)}g.handleAction=L;g.handleGroupNotification=a}),98);
__d("WAWebHandleIdentityChange",["Promise","WADeprecatedWapParser","WAJids","WALogger","WAWap","WAWebBackendApi","WAWebCommsWapMd","WAWebCreateOrReplaceDisplayNamesAndLidPnMappingsJob","WAWebIdentityChangeApi","WAWebJidToWid","WAWebManageE2ESessionsJob","WAWebMessageThread","WAWebOfflineHandler","WAWebSecurityCodeApi","WAWebSendTcTokenWhenDeviceIdentityChange","WAWebSignal","WAWebSignalCommonUtils","WAWebSignalProtocolStore","WAWebUserPrefsMeUser","WAWebUserPrefsStatus","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleE2eIdentityChange: "," has old identity, establishing new session"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleNewIdentity: ignore identity change from companion device"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Parsing Error: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["error while parsing: ",""]);l=function(){return a};return a}var m=new(c("WADeprecatedWapParser"))("identityChange",function(a){a.assertTag("notification");a.assertAttr("type","encrypt");a.child("identity");var b=parseInt(a.maybeAttrString("delay"),10);return{wid:d("WAWebJidToWid").deviceJidToDeviceWid(a.attrDeviceJid("from")),stanzaId:a.attrString("id"),delay:Number.isFinite(b)&&b>0?b:null,displayName:a.maybeAttrString("display_name"),lid:a.hasAttr("lid")?d("WAWebJidToWid").deviceJidToDeviceWid(a.attrDeviceJid("lid")):null,offline:a.hasAttr("offline")?a.attrString("offline"):null}});function a(a){var e=m.parse(a);if(e.error){d("WALogger").DEV(l(),a.toString());d("WALogger").ERROR(k(),e.error.toString());return(h||(h=b("Promise"))).reject(e.error)}a=e.success;var f=a.wid;e=a.stanzaId;var g=a.displayName,n=a.delay,o=a.lid,p=a.offline,q=d("WAWap").wap("ack",{to:d("WAWebCommsWapMd").DEVICE_JID(f),id:d("WAWap").CUSTOM_STRING(e),"class":"notification"});if(f.device!=null&&f.device!==d("WAJids").DEFAULT_DEVICE_ID){d("WALogger").LOG(j());return(h||(h=b("Promise"))).resolve(q)}if(d("WAWebUserPrefsMeUser").isMePrimary(f)){d("WAWebBackendApi").frontendFireAndForget("handleSelfPrimaryIdentityChange",{});return(h||(h=b("Promise"))).resolve(q)}var r=!!p&&!d("WAWebOfflineHandler").OfflineMessageHandler.isResumeFromRestartComplete();return d("WAWebMessageThread").handleMessage(String(f),r,b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield d("WAWebIdentityChangeApi").clearDeviceRecordForIdentityChange(f,r);var a=(yield d("WAWebSignalProtocolStore").getSignalProtocolStore().loadIdentityKey(d("WAWebSignalCommonUtils").createSignalAddress(f).toString()));a&&(d("WALogger").LOG(i(),f.toString()),yield d("WAWebSignal").Session.deleteRemoteInfo(f),d("WAWebSecurityCodeApi").addSecurityCodeChangedNotifications(f,r),void d("WAWebSendTcTokenWhenDeviceIdentityChange").sendTcTokenWhenDeviceIdentityChange(f),void c("WAWebUserPrefsStatus").markStatusSenderKeyRotate([f]),r||(n!=null?d("WAWebManageE2ESessionsJob").ensureE2ESessionsWithDelay([f],n,!0):d("WAWebManageE2ESessionsJob").ensureE2ESessions([f],!0)),yield d("WAWebCreateOrReplaceDisplayNamesAndLidPnMappingsJob").createOrReplaceDisplayNamesAndLidPnMappings([{id:d("WAWebWidFactory").toUserWid(f),lid:o?d("WAWebWidFactory").toUserWid(o):null,displayName:g}],!p));return q}))}g.handleE2eIdentityChange=a}),98);
__d("WAWebHandlePaymentAmountUtils",["WALogger","err"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Amount missing in pay or transaction node"]);h=function(){return a};return a}var i=1e3;function j(a){a.assertTag("money");var b=parseFloat(a.attrString("value")),c=a.attrString("currency");a=a.maybeAttrInt("offset");a=a!=null&&a!==0?a:i;b=b*i/a;return{currency:c,amount1000:b}}function k(a){if(a.hasChild("amount")){var b=a.child("amount");return j(b.child("money"))}else if(a.hasAttr("amount")){b=parseFloat(a.attrString("amount"));return{amount1000:b*i,currency:a.attrString("currency")}}d("WALogger").WARN(h());throw c("err")("Amount missing in pay or transaction node")}function a(a){return k(a)}g.getAmount1000AndCurrency=a}),98);
__d("WAWebPaymentStatusUtils",["$InternalEnum","WALogger","WAWebProtobufsWeb.pb"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["parsePaymentTransactionType payment transaction string=",""]);h=function(){return a};return a}var i=b("$InternalEnum")({TYPE_UNSET:0,TYPE_P2P_SENT:1,TYPE_P2P_RCVD:2,TYPE_P2P_GRP:3,TYPE_P2P_NO_INFO:4,TYPE_FUTURE:5,TYPE_P2P_REQ_SENT:10,TYPE_P2P_REQ_RCVD:20,TYPE_P2P_REQ_SCHEDULED_PAYMENT_RCVD:21,TYPE_P2P_REQ_GRP:30,TYPE_P2M_SENT:100,TYPE_P2M_RCVD:200,TYPE_P2M_PAYOUT:300,TYPE_MISSING_DETAILS:400,TYPE_DEPOSIT:500,TYPE_REFUND:600,TYPE_WITHDRAWAL:700}),j=b("$InternalEnum")({STATUS_UNSET:0,REQUEST_PAY_INIT:11,REQUEST_PAY_SUCCESS:12,REQUEST_PAY_FAILED:13,REQUEST_PAY_FAILED_RISK:14,REQUEST_PAY_REJECTED:15,REQUEST_PAY_EXPIRED:16,REQUEST_PAY_FULFILLED:17,REQUEST_PAY_CANCELLED:18,REQUEST_PAY_CANCELLING:19,REQUEST_PAY_SCHEDULED_PAYMENT_SUCCESS:20,RECV_PAY_INIT:101,RECV_PAY_PENDING_SETUP:102,RECV_PAY_PENDING:103,RECV_PAY_RETRY_ON_FAILURE:104,RECV_PAY_FAILURE:105,RECV_PAY_SUCCESS:106,RECV_PAY_EXPIRED:107,RECV_PAY_FAILURE_RISK:108,RECV_PAY_WITHDRAWAL_PROCESSING:109,RECV_PAY_WITHDRAWAL_FAILURE:110,RECV_PAY_WITHDRAWAL_PERMANENT_FAILED:111,RECV_PAY_SENDER_CANCELED:112,SEND_PAY_INIT:401,SEND_PAY_PENDING_RECEIVER:402,SEND_PAY_PENDING:403,SEND_PAY_REFUND_PENDING:404,SEND_PAY_SUCCESS:405,SEND_PAY_FAILURE:406,SEND_PAY_FAILURE_RISK:407,SEND_PAY_REFUNDED:408,SEND_PAY_REFUND_FAILED:409,SEND_PAY_FAILURE_RECEIVER:410,SEND_PAY_REFUND_FAILED_PROCESSING:411,SEND_PAY_PENDING_REFUND:412,SEND_PAY_AUTH_CANCEL_FAILED_PROCESSING:413,SEND_PAY_AUTH_CANCEL_FAILED:414,SEND_PAY_AUTH_CANCELED:415,SEND_PAY_EXPIRED:416,SEND_PAY_AUTH_SUCCESS:417,SEND_PAY_AUTH_SUCCESS_CANCELING:418,SEND_PAY_IN_REVIEW:419,SEND_PAY_PENDING_PROCESSING:420,SEND_PAY_USER_CANCELED:421,WITHDRAWAL_INIT:601,WITHDRAWAL_PENDING:602,WITHDRAWAL_IN_REVIEW:603,WITHDRAWAL_SUCCESS:604,WITHDRAWAL_FAILED:605,WITHDRAWAL_USER_CANCELED:606,WITHDRAWAL_EXPIRED:607,WITHDRAWAL_ACTIVE:608}),k={TYPE_P2P:"p2p",TYPE_P2M:"p2m",TYPE_P2M_PAYOUT:"payout",TYPE_WITHDRAWAL:"withdrawal",TYPE_DEPOSIT:"deposit",TYPE_REFUND:"refund"},l={PENDING_RECEIVER_SETUP:"PENDING_RECEIVER_SETUP",PENDING_SETUP:"PENDING_SETUP",PENDING:"PENDING",INITIAL:"INITIAL",SUCCESS:"SUCCESS",COMPLETED:"COMPLETED",IN_REVIEW:"IN_REVIEW",FAILED:"FAILED",DECLINED:"DECLINED",FAILURE:"FAILURE",FAILED_RISK:"FAILED_RISK",FAILED_PROCESSING:"FAILED_PROCESSING",FAILED_RECEIVER_PROCESSING:"FAILED_RECEIVER_PROCESSING",REFUND_FAILED_PROCESSING:"REFUND_FAILED_PROCESSING",REFUNDED:"REFUNDED",REFUND_FAILED:"REFUND_FAILED",EXPIRED:"EXPIRED",CANCELED:"CANCELLED",AUTH_SUCCESS:"AUTH_SUCCESS",AUTH_CANCELED:"AUTH_CANCELED",AUTH_CANCEL_FAILED_PROCESSING:"AUTH_CANCEL_FAILED_PROCESSING",AUTH_CANCEL_FAILED:"AUTH_CANCEL_FAILED",COLLECT_SUCCESS:"COLLECT_SUCCESS",COLLECT_FAILED:"COLLECT_FAILED",COLLECT_REJECTED:"COLLECT_REJECTED",COLLECT_EXPIRED:"COLLECT_EXPIRED",COLLECT_CANCELED:"COLLECT_CANCELED",FAILED_DA:"FAILED_DA",FAILED_DA_FINAL:"FAILED_DA_FINAL",REFUND_FAILED_DA:"REFUND_FAILED_DA",COLLECT_FAILED_RISK:"COLLECT_FAILED_RISK",WITHDRAWAL_PROCESSING:"WITHDRAWAL_PROCESSING",WITHDRAWAL_FAILURE:"WITHDRAWAL_FAILURE",WITHDRAWAL_PERMANENT_FAILED:"WITHDRAWAL_PERMANENT_FAILED",WITHDRAWAL_ACTIVE:"WITHDRAWAL_ACTIVE"};function a(a,b){if(a==null)return d("WAWebProtobufsWeb.pb").PaymentInfo$Status.UNKNOWN_STATUS;switch(a){case j.SEND_PAY_INIT:case j.SEND_PAY_PENDING:case j.RECV_PAY_INIT:case j.RECV_PAY_PENDING:case j.RECV_PAY_RETRY_ON_FAILURE:case j.REQUEST_PAY_INIT:return d("WAWebProtobufsWeb.pb").PaymentInfo$Status.PROCESSING;case j.SEND_PAY_PENDING_RECEIVER:case j.SEND_PAY_FAILURE_RECEIVER:return d("WAWebProtobufsWeb.pb").PaymentInfo$Status.SENT;case j.REQUEST_PAY_SUCCESS:return b===i.TYPE_P2P_REQ_SENT?d("WAWebProtobufsWeb.pb").PaymentInfo$Status.WAITING_FOR_PAYER:d("WAWebProtobufsWeb.pb").PaymentInfo$Status.WAITING;case j.RECV_PAY_PENDING_SETUP:return d("WAWebProtobufsWeb.pb").PaymentInfo$Status.NEED_TO_ACCEPT;case j.SEND_PAY_SUCCESS:case j.RECV_PAY_SUCCESS:case j.REQUEST_PAY_FULFILLED:return d("WAWebProtobufsWeb.pb").PaymentInfo$Status.COMPLETE;case j.SEND_PAY_FAILURE:case j.SEND_PAY_FAILURE_RISK:case j.SEND_PAY_PENDING_REFUND:case j.SEND_PAY_REFUND_PENDING:case j.SEND_PAY_REFUND_FAILED:case j.SEND_PAY_REFUND_FAILED_PROCESSING:case j.RECV_PAY_FAILURE:case j.REQUEST_PAY_FAILED:case j.REQUEST_PAY_FAILED_RISK:return d("WAWebProtobufsWeb.pb").PaymentInfo$Status.COULD_NOT_COMPLETE;case j.SEND_PAY_REFUNDED:return d("WAWebProtobufsWeb.pb").PaymentInfo$Status.REFUNDED;case j.RECV_PAY_EXPIRED:case j.REQUEST_PAY_EXPIRED:case j.SEND_PAY_AUTH_CANCELED:case j.SEND_PAY_AUTH_CANCEL_FAILED:case j.SEND_PAY_AUTH_CANCEL_FAILED_PROCESSING:return d("WAWebProtobufsWeb.pb").PaymentInfo$Status.EXPIRED;case j.REQUEST_PAY_REJECTED:return d("WAWebProtobufsWeb.pb").PaymentInfo$Status.REJECTED;case j.REQUEST_PAY_CANCELLED:return d("WAWebProtobufsWeb.pb").PaymentInfo$Status.CANCELLED;case j.STATUS_UNSET:return d("WAWebProtobufsWeb.pb").PaymentInfo$Status.UNKNOWN_STATUS;case j.REQUEST_PAY_CANCELLING:return d("WAWebProtobufsWeb.pb").PaymentInfo$Status.UNKNOWN_STATUS;default:return d("WAWebProtobufsWeb.pb").PaymentInfo$Status.UNKNOWN_STATUS}}function c(a,b){if(!b)return j.STATUS_UNSET;b=b.toUpperCase();switch(a){case i.TYPE_P2P_SENT:case i.TYPE_P2M_SENT:case i.TYPE_DEPOSIT:switch(b){case l.PENDING_RECEIVER_SETUP:return j.SEND_PAY_PENDING_RECEIVER;case l.FAILED_DA:return j.SEND_PAY_PENDING;case l.REFUND_FAILED_DA:return j.SEND_PAY_REFUND_PENDING;case l.FAILED_RISK:return j.SEND_PAY_FAILURE_RISK;case l.INITIAL:return j.SEND_PAY_INIT;case l.SUCCESS:case l.COMPLETED:return j.SEND_PAY_SUCCESS;case l.FAILURE:case l.FAILED:return j.SEND_PAY_FAILURE;case l.REFUNDED:return j.SEND_PAY_REFUNDED;case l.REFUND_FAILED:return j.SEND_PAY_REFUND_FAILED;case l.FAILED_RECEIVER_PROCESSING:return j.SEND_PAY_FAILURE_RECEIVER;case l.REFUND_FAILED_PROCESSING:return j.SEND_PAY_REFUND_FAILED_PROCESSING;case l.FAILED_DA_FINAL:return j.SEND_PAY_PENDING_REFUND;case l.AUTH_CANCEL_FAILED_PROCESSING:return j.SEND_PAY_AUTH_CANCEL_FAILED_PROCESSING;case l.AUTH_CANCEL_FAILED:return j.SEND_PAY_AUTH_CANCEL_FAILED;case l.AUTH_CANCELED:return j.SEND_PAY_AUTH_CANCELED;case l.EXPIRED:return j.SEND_PAY_EXPIRED;case l.IN_REVIEW:return j.SEND_PAY_IN_REVIEW;case l.PENDING:return j.SEND_PAY_PENDING_PROCESSING;case l.CANCELED:return j.SEND_PAY_USER_CANCELED}break;case i.TYPE_P2P_RCVD:case i.TYPE_P2M_RCVD:switch(b){case l.PENDING_SETUP:return j.RECV_PAY_PENDING_SETUP;case l.FAILED_DA:return j.RECV_PAY_PENDING;case l.FAILED_PROCESSING:return j.RECV_PAY_RETRY_ON_FAILURE;case l.SUCCESS:case l.COMPLETED:return j.RECV_PAY_SUCCESS;case l.FAILURE:case l.FAILED:return j.RECV_PAY_FAILURE;case l.EXPIRED:return j.RECV_PAY_EXPIRED;case l.FAILED_RISK:return j.RECV_PAY_FAILURE_RISK;case l.WITHDRAWAL_PROCESSING:return j.RECV_PAY_WITHDRAWAL_PROCESSING;case l.WITHDRAWAL_FAILURE:return j.RECV_PAY_WITHDRAWAL_FAILURE;case l.WITHDRAWAL_PERMANENT_FAILED:return j.RECV_PAY_WITHDRAWAL_PERMANENT_FAILED;case l.CANCELED:return j.RECV_PAY_SENDER_CANCELED}break;case i.TYPE_P2P_REQ_SENT:case i.TYPE_P2P_REQ_RCVD:switch(b){case l.COLLECT_SUCCESS:return j.REQUEST_PAY_SUCCESS;case l.COLLECT_FAILED:return j.REQUEST_PAY_FAILED;case l.COLLECT_FAILED_RISK:return j.REQUEST_PAY_FAILED_RISK;case l.COLLECT_REJECTED:return j.REQUEST_PAY_REJECTED;case l.COLLECT_EXPIRED:return j.REQUEST_PAY_EXPIRED;case l.COLLECT_CANCELED:return j.REQUEST_PAY_CANCELLED}break;case i.TYPE_P2P_REQ_SCHEDULED_PAYMENT_RCVD:switch(b){case l.COLLECT_SUCCESS:return j.REQUEST_PAY_SCHEDULED_PAYMENT_SUCCESS;case l.AUTH_SUCCESS:return j.SEND_PAY_AUTH_SUCCESS}break;case i.TYPE_REFUND:switch(b){case l.SUCCESS:case l.COMPLETED:return j.RECV_PAY_SUCCESS}break;case i.TYPE_WITHDRAWAL:switch(b){case l.PENDING:return j.WITHDRAWAL_PENDING;case l.IN_REVIEW:return j.WITHDRAWAL_IN_REVIEW;case l.SUCCESS:case l.COMPLETED:return j.WITHDRAWAL_SUCCESS;case l.FAILED:case l.DECLINED:return j.WITHDRAWAL_FAILED;case l.CANCELED:return j.WITHDRAWAL_USER_CANCELED;case l.EXPIRED:return j.WITHDRAWAL_EXPIRED;case l.WITHDRAWAL_ACTIVE:return j.WITHDRAWAL_ACTIVE}break;default:return j.STATUS_UNSET}return j.STATUS_UNSET}function e(a){if(a==null)return d("WAWebProtobufsWeb.pb").PaymentInfo$TxnStatus.UNKNOWN;switch(a){case j.RECV_PAY_EXPIRED:case j.SEND_PAY_EXPIRED:return d("WAWebProtobufsWeb.pb").PaymentInfo$TxnStatus.EXPIRED_TXN;case j.RECV_PAY_FAILURE:case j.SEND_PAY_FAILURE:return d("WAWebProtobufsWeb.pb").PaymentInfo$TxnStatus.FAILED;case j.RECV_PAY_INIT:case j.SEND_PAY_INIT:return d("WAWebProtobufsWeb.pb").PaymentInfo$TxnStatus.INIT;case j.RECV_PAY_PENDING_SETUP:return d("WAWebProtobufsWeb.pb").PaymentInfo$TxnStatus.PENDING_SETUP;case j.RECV_PAY_PENDING:case j.SEND_PAY_PENDING:return d("WAWebProtobufsWeb.pb").PaymentInfo$TxnStatus.FAILED_DA;case j.RECV_PAY_RETRY_ON_FAILURE:return d("WAWebProtobufsWeb.pb").PaymentInfo$TxnStatus.FAILED_PROCESSING;case j.RECV_PAY_SUCCESS:case j.SEND_PAY_SUCCESS:case j.REQUEST_PAY_FULFILLED:return d("WAWebProtobufsWeb.pb").PaymentInfo$TxnStatus.SUCCESS;case j.REQUEST_PAY_CANCELLED:return d("WAWebProtobufsWeb.pb").PaymentInfo$TxnStatus.COLLECT_CANCELED;case j.REQUEST_PAY_CANCELLING:return d("WAWebProtobufsWeb.pb").PaymentInfo$TxnStatus.COLLECT_CANCELLING;case j.REQUEST_PAY_EXPIRED:return d("WAWebProtobufsWeb.pb").PaymentInfo$TxnStatus.COLLECT_EXPIRED;case j.REQUEST_PAY_FAILED_RISK:return d("WAWebProtobufsWeb.pb").PaymentInfo$TxnStatus.COLLECT_FAILED_RISK;case j.REQUEST_PAY_FAILED:return d("WAWebProtobufsWeb.pb").PaymentInfo$TxnStatus.COLLECT_FAILED;case j.REQUEST_PAY_INIT:return d("WAWebProtobufsWeb.pb").PaymentInfo$TxnStatus.COLLECT_INIT;case j.REQUEST_PAY_REJECTED:return d("WAWebProtobufsWeb.pb").PaymentInfo$TxnStatus.COLLECT_REJECTED;case j.REQUEST_PAY_SUCCESS:return d("WAWebProtobufsWeb.pb").PaymentInfo$TxnStatus.COLLECT_SUCCESS;case j.SEND_PAY_AUTH_CANCELED:return d("WAWebProtobufsWeb.pb").PaymentInfo$TxnStatus.AUTH_CANCELED;case j.SEND_PAY_AUTH_CANCEL_FAILED_PROCESSING:return d("WAWebProtobufsWeb.pb").PaymentInfo$TxnStatus.AUTH_CANCEL_FAILED_PROCESSING;case j.SEND_PAY_AUTH_CANCEL_FAILED:return d("WAWebProtobufsWeb.pb").PaymentInfo$TxnStatus.AUTH_CANCEL_FAILED;case j.SEND_PAY_FAILURE_RECEIVER:return d("WAWebProtobufsWeb.pb").PaymentInfo$TxnStatus.FAILED_RECEIVER_PROCESSING;case j.SEND_PAY_FAILURE_RISK:case j.RECV_PAY_FAILURE_RISK:return d("WAWebProtobufsWeb.pb").PaymentInfo$TxnStatus.FAILED_RISK;case j.SEND_PAY_PENDING_RECEIVER:return d("WAWebProtobufsWeb.pb").PaymentInfo$TxnStatus.PENDING_RECEIVER_SETUP;case j.SEND_PAY_PENDING_REFUND:return d("WAWebProtobufsWeb.pb").PaymentInfo$TxnStatus.FAILED_DA_FINAL;case j.SEND_PAY_REFUNDED:return d("WAWebProtobufsWeb.pb").PaymentInfo$TxnStatus.REFUNDED_TXN;case j.SEND_PAY_REFUND_FAILED_PROCESSING:return d("WAWebProtobufsWeb.pb").PaymentInfo$TxnStatus.REFUND_FAILED_PROCESSING;case j.SEND_PAY_REFUND_FAILED:return d("WAWebProtobufsWeb.pb").PaymentInfo$TxnStatus.REFUND_FAILED;case j.SEND_PAY_REFUND_PENDING:return d("WAWebProtobufsWeb.pb").PaymentInfo$TxnStatus.REFUND_FAILED_DA;case j.SEND_PAY_IN_REVIEW:return d("WAWebProtobufsWeb.pb").PaymentInfo$TxnStatus.IN_REVIEW;case j.STATUS_UNSET:return d("WAWebProtobufsWeb.pb").PaymentInfo$TxnStatus.UNKNOWN;default:return d("WAWebProtobufsWeb.pb").PaymentInfo$TxnStatus.UNKNOWN}}function f(a,b){if(a){a=a.toLowerCase();switch(a){case k.TYPE_P2P:return b?i.TYPE_P2P_SENT:i.TYPE_P2P_RCVD;case k.TYPE_P2M:return b?i.TYPE_P2M_SENT:i.TYPE_P2M_RCVD;case k.TYPE_P2M_PAYOUT:return i.TYPE_P2M_PAYOUT;case k.TYPE_DEPOSIT:return i.TYPE_DEPOSIT;case k.TYPE_REFUND:return i.TYPE_REFUND;case k.TYPE_WITHDRAWAL:return i.TYPE_WITHDRAWAL;default:d("WALogger").LOG(h(),a)}}return b?i.TYPE_P2P_SENT:i.TYPE_P2P_RCVD}function m(a){return a===d("WAWebProtobufsWeb.pb").PaymentInfo$TxnStatus.COMPLETED||a===d("WAWebProtobufsWeb.pb").PaymentInfo$TxnStatus.SUCCESS}function n(a){return m(a)?a:d("WAWebProtobufsWeb.pb").PaymentInfo$TxnStatus.COLLECT_INIT}g.PaymentTransactionType=i;g.NotificationTransactionStatus=j;g.PaymentTransactionTypeServerString=k;g.PaymentTransactionStatusServerString=l;g.getPaymentWebStatus=a;g.getNotificationTransactionStatus=c;g.getPaymentTxnWebStatus=e;g.getPaymentTransactionType=f;g.determinePaymentRequestFulfilledStatus=n}),98);
__d("WAWebPaymentNotificationParser",["WADeprecatedWapParser","WALogger","WAWebHandlePaymentAmountUtils","WAWebJidToWid","WAWebMessagingGatingUtils","WAWebMsgKey","WAWebPaymentStatusUtils","WAWebUserPrefsMeUser"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Payment notification from Novi not supported."]);h=function(){return a};return a}function i(a){return a&&a.hasAttr("service")?a.attrString("service").toUpperCase()==="NOVI":!1}a=new(c("WADeprecatedWapParser"))("paymentNotificationParser",function(a){if(d("WAWebMessagingGatingUtils").isPaymentNotificationAckKickFixEnabled()){a.assertTag("notification");a.assertAttr("type","pay");return{stanzaId:a.attrString("id"),from:a.attrWapJid("from"),transaction:a.hasChild("transaction")?j(a.child("transaction")):null,invite:k(a)}}return{transaction:a.hasChild("transaction")?j(a.child("transaction")):null,invite:k(a)}});function j(a){if(i(a)){d("WALogger").WARN(h());return null}var b=void 0,e=void 0,f=d("WAWebUserPrefsMeUser").getMeUser(),g=d("WAWebJidToWid").jidWithTypeToWid(a.attrJidWithType("sender")),j=d("WAWebJidToWid").jidWithTypeToWid(a.attrJidWithType("receiver"));f=f.equals(g);a.hasAttr("group")?(b=d("WAWebJidToWid").jidWithTypeToWid(a.attrJidWithType("group")),e=d("WAWebJidToWid").jidWithTypeToWid(a.attrJidWithType("sender"))):f?b=j:b=g;g=new(c("WAWebMsgKey"))({id:a.attrString("message-id"),fromMe:f,remote:b,participant:e});f=d("WAWebPaymentStatusUtils").getPaymentTransactionType(a.attrString("transaction-type"),g.fromMe);b=d("WAWebHandlePaymentAmountUtils").getAmount1000AndCurrency(a);e=b.amount1000;b=b.currency;return{receiver:j,currency:b,amount1000:e,status:d("WAWebPaymentStatusUtils").getNotificationTransactionStatus(f,a.attrString("status")),ts:a.attrInt("ts"),type:f,msgKey:g}}function k(a){if(!a.hasChild("invite"))return null;var b=a.child("invite");return{type:b.maybeAttrString("type"),service:b.maybeAttrString("service"),inviteUsed:b.hasAttr("invite-used")?b.attrString("invite-used")==="1":null,from:d("WAWebJidToWid").chatJidToChatWid(a.attrChatJid("from")),timestamp:a.attrTime("t")}}g.isNoviTransaction=i;g.paymentNotificationParser=a;g.parseTransactionNode=j}),98);
__d("WAWebHandleMsgParser",["WADeprecatedWapParser","WANullthrows","WAParsableWapNode","WAWebBackendJobs.flow","WAWebBizCoexGatingUtils","WAWebBotGating","WAWebBotTypes","WAWebCreateNackFromStanza","WAWebHandleMsgCommon","WAWebHandleMsgTypes.flow","WAWebHandlePaymentAmountUtils","WAWebJidToWid","WAWebMessagingGatingUtils","WAWebPaymentNotificationParser","WAWebPaymentStatusUtils","WAWebProtobufsWeb.pb","WAWebSendStatusGatingUtils","WAWebUserPrefsMeUser","WAWebWidFactory"],(function(a,b,c,d,e,f,g){a=new(c("WADeprecatedWapParser"))("incomingMsgParser",function(a){a.assertTag("message");a.hasAttr("to")&&a.assertAttr("to",d("WAWebUserPrefsMeUser").assertGetMe().toJid());var b=a.maybeChild("plaintext");b!=null&&b["throw"]("not to be present in e2ee messages");b=a.mapChildrenWithTag("enc",function(a){return{e2eType:a.attrEnumValues("type",d("WAWebBackendJobs.flow").CiphertextType.members()),encMediaType:d("WAWebBackendJobs.flow").EncMediaType.cast(a.maybeAttrString("mediatype")),ciphertext:a.contentBytes(),retryCount:a.hasAttr("count")?a.attrInt("count"):0,hideFail:a.maybeAttrString("decrypt-fail")==="hide"}});var c=a.maybeChild("device-identity");c=c?c.contentBytes():null;var e=j(a),f=i(a,b),g=h(a,b,e,f),n=k(a,g),p=m(a),q=l(a),r=o(a);a=(a=(a=a.maybeChild("rcat"))==null?void 0:a.contentBytes())!=null?a:null;return{encs:b,msgInfo:g,msgMeta:f,bizInfo:n,hsmInfo:q,paymentInfo:p,deviceIdentity:c,rcat:a,msgBotInfo:e,reportingTokenInfo:r}});function h(a,b,e,f){var g={externalId:a.attrString("id"),ts:a.attrTime("t"),edit:a.hasAttr("edit")?a.attrInt("edit"):-1,isHsm:a.hasChild("hsm"),count:a.hasAttr("count")?a.attrInt("count"):null,pushname:a.hasAttr("notify")?a.attrString("notify"):null,username:a.hasAttr("username")?a.attrString("username"):null,displayName:a.hasAttr("display_name")?a.attrString("display_name"):null,senderPn:a.hasAttr("sender_pn")?d("WAWebJidToWid").userJidToUserWid(a.attrUserJid("sender_pn")):null,senderLid:a.hasAttr("sender_lid")?d("WAWebJidToWid").userJidToUserWid(a.attrUserJid("sender_lid")):null,recipientLid:a.hasAttr("recipient_lid")?d("WAWebJidToWid").userJidToUserWid(a.attrUserJid("recipient_lid")):null,recipientPn:a.hasAttr("recipient_pn")?d("WAWebJidToWid").userJidToUserWid(a.attrUserJid("recipient_pn")):null,recipientUsername:a.hasAttr("recipient_username")?a.attrString("recipient_username"):null,participantLid:a.hasAttr("participant_lid")?d("WAWebJidToWid").userJidToUserWid(a.attrLidUserJid("participant_lid")):null,participantPn:a.hasAttr("participant_pn")?d("WAWebJidToWid").userJidToUserWid(a.attrUserJid("participant_pn")):null,category:a.hasAttr("category")?a.attrString("category"):null,offline:a.hasAttr("offline")?a.attrString("offline"):null},h=d("WAWebJidToWid").jidWithTypeToWid(a.attrJidWithType("from"));h.isNewsletter()&&a["throw"]("unexpected `from` attribute with newsletter Jid");var i=a.hasAttr("participant")?d("WAWebJidToWid").deviceJidToDeviceWid(a.attrDeviceJid("participant")):null,j=a.hasAttr("recipient")?d("WAWebJidToWid").userJidToUserWid(a.attrUserJid("recipient")):null;if(d("WAWebBizCoexGatingUtils").bizHostedDevicesEnabled()){var k=Boolean((i==null?void 0:i.isHosted())&&(h.isStatusV3()||h.isGroup()||h.isBroadcast()));if(k)throw new(d("WAParsableWapNode").XmppParsingFailure)("incomingMsgParser",""+d("WAWebCreateNackFromStanza").NackReason.InvalidHostedCompanionStanza)}k=b.every(function(a){return a.e2eType!==d("WAWebBackendJobs.flow").CiphertextType.Skmsg});b=b.some(function(a){return a.retryCount>0});var l=h.isGroup()||h.isBroadcast()?i:h;if(j!=null&&l!=null&&!d("WAWebUserPrefsMeUser").isMeAccount(l))return a["throw"]("Invalid recipient from non peer device");var m,n={};l=a.maybeChild("participants");if(l){var o=[];l.forEachChildWithTag("to",function(a){var b=d("WAWebJidToWid").deviceJidToDeviceWid(a.attrDeviceJid("jid"));a=a.maybeAttrString("eph_setting");o.push(b);a!=null&&(n[b.toString()]=a)});m=o}if(d("WAWebBotGating").isBotMsgParseEnabledForFutureproofOrFullRecv()&&e&&f&&h.isBot()&&f.targetChatJid!=null)return babelHelpers["extends"]({type:d("WAWebHandleMsgTypes.flow").MESSAGE_TYPE.CHAT},g,{chat:d("WAWebWidFactory").toUserWid(c("WANullthrows")(f.targetChatJid)),author:h,botParticipant:h});else if(h.isUser())return j!=null?!d("WAWebUserPrefsMeUser").isMeAccount(h)?a["throw"]("recipient on non peer chat message"):babelHelpers["extends"]({type:d("WAWebHandleMsgTypes.flow").MESSAGE_TYPE.CHAT},g,{chat:d("WAWebWidFactory").toUserWid(j),author:h}):babelHelpers["extends"]({type:d("WAWebHandleMsgTypes.flow").MESSAGE_TYPE.CHAT},g,{chat:d("WAWebWidFactory").toUserWid(h),author:h});else if(h.isGroup()){if(i==null)return a["throw"]("group message with no participant");l=a.attrEnumOrDefault("addressing_mode",d("WAWebHandleMsgCommon").STANZA_MSG_ADDRESSING_MODE,d("WAWebHandleMsgCommon").STANZA_MSG_ADDRESSING_MODE.pn);return babelHelpers["extends"]({type:d("WAWebHandleMsgTypes.flow").MESSAGE_TYPE.GROUP},g,{chat:h,author:i,isDirect:k,addressingMode:l})}else if(h.isBroadcast()&&!h.isStatusV3()){if(i==null)return a["throw"]("broadcast message with no participant");if(d("WAWebUserPrefsMeUser").isMeAccount(i)){if(m==null){if(!b)return a["throw"]("peer broadcast message with no participants node");m=[]}return babelHelpers["extends"]({type:d("WAWebHandleMsgTypes.flow").MESSAGE_TYPE.PEER_BROADCAST},g,{chat:h,author:i,isDirect:k,bclParticipants:m,bclHashValidated:!1,bclEphSettings:n})}return babelHelpers["extends"]({type:d("WAWebHandleMsgTypes.flow").MESSAGE_TYPE.OTHER_BROADCAST},g,{chat:h,author:i,isDirect:k,ephSetting:a.maybeAttrString("eph_setting")})}else if(h.isBroadcast()&&h.isStatusV3()){if(i==null)return a["throw"]("status message with no participant");var p;if(d("WAWebSendStatusGatingUtils").isStatusPostingEnabled()){p=(f=(e=a.maybeChild("meta"))==null?void 0:e.maybeAttrString("status_setting"))!=null?f:void 0}return d("WAWebUserPrefsMeUser").isMeAccount(i)&&k?m==null?babelHelpers["extends"]({type:d("WAWebHandleMsgTypes.flow").MESSAGE_TYPE.DIRECT_PEER_STATUS},g,{chat:h,author:i,isDirect:k,statusSetting:p}):babelHelpers["extends"]({type:d("WAWebHandleMsgTypes.flow").MESSAGE_TYPE.DIRECT_PEER_STATUS},g,{chat:h,author:i,bclParticipants:m,bclHashValidated:!1,statusSetting:p}):babelHelpers["extends"]({type:d("WAWebHandleMsgTypes.flow").MESSAGE_TYPE.OTHER_STATUS},g,{chat:h,author:i,isDirect:k,statusSetting:p})}return a["throw"]("Unrecognized message type")}function i(a,b){var c=a.hasChild("unavailable");!c&&b.length===0&&a["throw"]("incomingMsgParser: to have enc node children");b=!1;if(c){var e=a.maybeChild("unavailable");b=(e==null?void 0:e.maybeAttrString("hosted"))==="true"}e=a.attrEnum("type",d("WAWebHandleMsgCommon").STANZA_MSG_TYPES);var f=a.maybeChild("meta"),g=e===d("WAWebHandleMsgCommon").STANZA_MSG_TYPES.poll?f==null?void 0:f.attrEnumOrNullIfUnknown("polltype",d("WAWebHandleMsgCommon").POLL_TYPES):null;c={isUnavailable:c,isHostedMsgUnavailable:b,type:e,pollType:g,origin:f==null?void 0:f.attrEnumOrDefault("origin",d("WAWebHandleMsgCommon").STANZA_MSG_ORIGIN,null),rawTs:a.attrString("t"),urlNumber:a.hasChild("url_number"),urlText:a.hasChild("url_text")};f&&f.hasAttr(d("WAWebHandleMsgCommon").BIZ_SOURCE_ATTR)&&(c.bizSource=f.attrString(d("WAWebHandleMsgCommon").BIZ_SOURCE_ATTR));f&&f.hasAttr("thread_msg_id")&&(c.threadMsgId=f.attrString("thread_msg_id"));f&&f.hasAttr("thread_msg_sender_jid")&&(c.threadMsgSenderJid=d("WAWebJidToWid").jidWithTypeToWid(f.attrJidWithType("thread_msg_sender_jid")));f&&f.hasAttr("target_id")&&(c.targetId=f.attrString("target_id"));f&&f.hasAttr("target_sender_jid")&&(c.targetSenderJid=d("WAWebJidToWid").jidWithTypeToWid(f.attrJidWithType("target_sender_jid")));f&&f.hasAttr("target_chat_jid")&&(c.targetChatJid=d("WAWebJidToWid").jidWithTypeToWid(f.attrJidWithType("target_chat_jid")));e===d("WAWebHandleMsgCommon").STANZA_MSG_TYPES.event&&f&&f.hasAttr("event_type")&&(c.eventType=f.attrEnum("event_type",d("WAWebHandleMsgCommon").EVENT_TYPES));return c}function j(a){a=a.maybeChild("bot");if(!d("WAWebBotGating").isBotMsgParseEnabledForFutureproofOrFullRecv()||!a)return;var b=a.maybeAttrString("sender_timestamp_ms"),c=a.maybeAttrString("edit_target_id"),e=d("WAWebBotTypes").BotMsgEditType.cast(a.maybeAttrString("edit")),f;a.hasAttr("biz_bot")&&(a.attrString("biz_bot")==="1"?f=d("WAWebBotTypes").BizBotType.BIZ_1P:a.attrString("biz_bot")==="3"&&(f=d("WAWebBotTypes").BizBotType.BIZ_3P));a={botSenderTimestampMs:b,botEditTargetId:c,botEditType:e,bizBotType:f};return a}function k(a,b){var c;c=Boolean(b==null?void 0:(c=b.author)==null?void 0:c.isBot());b=Boolean(b==null?void 0:(b=b.chat)==null?void 0:b.isBot());b=!b&&c;if(b)return{verifiedNameSerial:null,verifiedLevel:null,verifiedNameCert:null,privacyMode:null,nativeFlowName:null,campaignId:null};b=a.hasChild("verified_name")?a.child("verified_name").contentBytes():null;var e=a.attrEnumOrDefault("verified_level",d("WAWebHandleMsgCommon").MSG_VERIFIED_LEVEL,null),f=a.hasAttr("verified_name")?a.attrInt("verified_name"):-1,g=a.maybeChild("biz"),h=null;if(g!=null){var i=d("WAWebHandleMsgTypes.flow").ActualActorsEnumType.cast(g.maybeAttrInt("actual_actors")),j=d("WAWebHandleMsgTypes.flow").HostStorageEnumType.cast(g.maybeAttrInt("host_storage")),k=g.maybeAttrInt("privacy_mode_ts");i!=null&&j!=null&&k!=null&&!c&&(h={actualActors:i,hostStorage:j,privacyModeTs:k})}c=g==null?void 0:g.maybeAttrString("native_flow_name");i=g==null?void 0:g.maybeAttrString("campaign_id");return babelHelpers["extends"]({verifiedNameCert:b,verifiedLevel:e,verifiedNameSerial:f,privacyMode:h,nativeFlowName:c,campaignId:i},g&&{verifiedButtonsEnvelope:g.hasChild("buttons"),verifiedListEnvelope:g.hasChild("list"),verifiedHsmEnvelope:a.hasChild("hsm")})}function l(a){a=a.maybeChild("hsm");if(a!=null){var b=a.maybeAttrString("tag");a=a.maybeAttrString("category");if(b!=null||a!=null)return{tag:b,category:a}}return null}function m(a){var b=null,c=a.hasChild("pay")?a.child("pay"):null,e=a.hasChild("transaction")?a.child("transaction"):null,f=d("WAWebJidToWid").jidWithTypeToWid(a.attrJidWithType("from")).isGroup(),g=a.hasAttr("participant")?d("WAWebJidToWid").jidWithTypeToWid(a.attrJidWithType("participant")):null;if(d("WAWebPaymentNotificationParser").isNoviTransaction(c)||d("WAWebPaymentNotificationParser").isNoviTransaction(e))b={futureproofed:!0};else if(e){e=d("WAWebPaymentNotificationParser").parseTransactionNode(e);e&&(n(f,g,d("WAWebWidFactory").createWid(e.receiver.toString()))?b={receiverJid:e.receiver.toString(),currency:e.currency,amount1000:e.amount1000,transactionTimestamp:e.ts,txnStatus:d("WAWebPaymentStatusUtils").getPaymentTxnWebStatus(e.status)}:b={receiverJid:e.receiver.toString(),currency:e.currency,amount1000:e.amount1000,transactionTimestamp:e.ts})}else if(c){e=c.attrEnum("type",d("WAWebHandleMsgCommon").PAY_NODE_TYPES);switch(e){case d("WAWebHandleMsgCommon").PAY_NODE_TYPES.send:e=d("WAWebHandlePaymentAmountUtils").getAmount1000AndCurrency(c);var h=e.amount1000;e=e.currency;c=c.hasAttr("receiver")?c.attrString("receiver"):a.attrString("recipient");n(f,g,d("WAWebWidFactory").createWid(c))?b={receiverJid:c,currency:e,amount1000:h,transactionTimestamp:a.attrInt("t"),txnStatus:d("WAWebProtobufsWeb.pb").PaymentInfo$TxnStatus.INIT}:b={receiverJid:c,currency:e,amount1000:h,transactionTimestamp:a.attrInt("t")};break;case d("WAWebHandleMsgCommon").PAY_NODE_TYPES.request:break;case d("WAWebHandleMsgCommon").PAY_NODE_TYPES.invite:break;default:break}}return b}function n(a,b,c){if(a&&b!=null&&c!=null){a=d("WAWebUserPrefsMeUser").getMeUser();if(!a.equals(b)&&!a.equals(c))return!1}return!0}b=new(c("WADeprecatedWapParser"))("incomingMsgParserForAckOnly",function(a){a.assertTag("message");var b=null;try{b=a.attrEnum("type",d("WAWebHandleMsgCommon").STANZA_MSG_TYPES)}catch(a){}var c=null;try{c=a.attrString("offline")!==""}catch(a){}var e=null;try{e=h(a,[],j(a))}catch(a){}return{type:b,externalId:a.attrString("id"),from:d("WAWebJidToWid").jidWithTypeToWid(a.attrJidWithType("from")),participant:a.hasAttr("participant")?d("WAWebJidToWid").deviceJidToDeviceWid(a.attrDeviceJid("participant")):null,msgInfo:e,offline:c}});function o(a){if(!d("WAWebMessagingGatingUtils").isReportingTokenReceivingEnabled())return null;a=a.maybeChild("reporting");if(a==null)return null;var b={},c=a.maybeChild("reporting_token");a=a.maybeChild("reporting_tag");c!=null&&(b.reportingToken=c.contentBytes());a!=null&&(b.reportingTag=a.contentBytes());return b}g.incomingMsgParser=a;g.parseMessageInfo=h;g.parseMessageMeta=i;g.parseMessageBotInfo=j;g.parseBizInfo=k;g.incomingMsgParserForAckOnly=b}),98);
__d("WAWebMessageHighRetryCountWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumE2eSenderType","WAWebWamEnumMediaType","WAWebWamEnumMessageType","WAWebWamEnumSizeBucket"],(function(a,b,c,d,e,f,g){a=d("WAWebWamCodegenUtils").defineEvents({MessageHighRetryCount:[3132,{deviceSizeBucket:[5,d("WAWebWamEnumSizeBucket").SIZE_BUCKET],e2eSenderType:[3,d("WAWebWamEnumE2eSenderType").E2E_SENDER_TYPE],mediaType:[1,d("WAWebWamEnumMediaType").MEDIA_TYPE],messageType:[4,d("WAWebWamEnumMessageType").MESSAGE_TYPE],retryCount:[2,d("WAWebWamCodegenUtils").TYPES.INTEGER]},[1,20,20],"regular"]});g.MessageHighRetryCountWamEvent=a}),98);
__d("WAWebPostMessageHighRetryCountMetric",["WAWebMessageHighRetryCountWamEvent","WAWebMessagingGatingUtils","WAWebWamGroupMetricCache","WAWebWamMsgUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h=5;function a(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(a<h)return;a=new(d("WAWebMessageHighRetryCountWamEvent").MessageHighRetryCountWamEvent)({retryCount:a,messageType:d("WAWebWamMsgUtils").getMessageTypeFromMsgInfoType(b.type)});var c=d("WAWebWamMsgUtils").getWamE2eSenderType(b.author);c!=null&&(a.e2eSenderType=c);c=b.chat;if(c==null?void 0:c.isGroup()){b=(yield d("WAWebWamGroupMetricCache").getGroupMetrics(c));(b==null?void 0:b.deviceSizeBucket)!=null&&(a.deviceSizeBucket=b.deviceSizeBucket);(b==null?void 0:b.participantCount)!=null&&b.participantCount>d("WAWebMessagingGatingUtils").getGroupSizeBypassingSampling()&&(a.weight=0)}a.commit()});return i.apply(this,arguments)}g.MAX_RETRY=h;g.maybePostMessageHighRetryCountMetric=a}),98);
__d("WAWebSendRetryReceiptJob",["$InternalEnum","Promise","WADeprecatedSendIq","WALogger","WAWap","WAWebAdvSignatureApi","WAWebCommsAckParser","WAWebCommsWapMd","WAWebConstantsDeprecated","WAWebCryptoCurve25519","WAWebHandleMsgError","WAWebMessagingGatingUtils","WAWebSignalCommonErrors","WAWebSignalKeyApi","WAWebSignalProtocolStore","WAWebSignalStoreApi","WAWebSignalUtilsApi","WAWebUserPrefsMeUser","WAWebWidFactory","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["error: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["error: ",""]);j=function(){return a};return a}var k=2,l=b("$InternalEnum")({UnknownError:0,SignalErrorNoSession:1,SignalErrorInvalidKey:2,SignalErrorInvalidKeyId:3,SignalErrorInvalidMessage:4,SignalErrorInvalidSignature:5,SignalErrorFutureMessage:6,SignalErrorBadMac:7,SignalErrorInvalidSession:8,SignalErrorInvalidMsgKey:9,BadBroadcastEphemeralSetting:10,UnknownCompanionNoPrekey:11,AdvFailure:12,StatusRevokeDelay:13});function a(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=a.retryCount,f=a.to,g=a.participant,k=a.recipient,l=a.externalId,m=a.rawTs,o=a.isPeer;o=o===void 0?!1:o;a=a.retryReason;try{var p=d("WAWebSignalProtocolStore").getSignalProtocolStore();p=(yield (h||(h=b("Promise"))).all([p.getLocalRegistrationId(),p.getIdentityKeyPair()]));var q=p[0];p=p[1];if(q==null||p==null)throw c("err")("No registration info found");var r;try{r=(yield n(e,d("WAWebCryptoCurve25519").toCurveKeyPair(p)))}catch(a){d("WALogger").ERROR(j(),a).sendLogs("sendRetryReceipt: error while creating key section in retry receipt")}p=!f.isBot()&&Boolean(g==null?void 0:g.isBot());if(p)return;p=d("WAWap").DROP_ATTR;var s=d("WAWap").DROP_ATTR,t=d("WAWap").DROP_ATTR,u;if(f.isUser()){u=d("WAWebCommsWapMd").DEVICE_JID(f);if(d("WAWebUserPrefsMeUser").getMeUser().equals(d("WAWebWidFactory").toUserWid(f)))if(o)p=d("WAWap").CUSTOM_STRING("peer");else if(!k)return(h||(h=b("Promise"))).reject(c("err")("sendRetryReceipt: send retry to peer device without recipient"));else s=d("WAWebCommsWapMd").USER_JID(k)}else u=d("WAWebCommsWapMd").CHAT_JID(f),t=g?d("WAWebCommsWapMd").DEVICE_JID(g):d("WAWap").DROP_ATTR;o=d("WAWap").wap("receipt",{id:d("WAWap").CUSTOM_STRING(l),to:u,participant:t,recipient:s,type:"retry",category:p},d("WAWap").wap("retry",{v:"1",count:d("WAWap").INT(e),id:d("WAWap").CUSTOM_STRING(l),t:d("WAWap").CUSTOM_STRING(m),error:d("WAWebMessagingGatingUtils").isRetryReceiptErrorCodeEnabled()&&a!=null?d("WAWap").INT(a):d("WAWap").DROP_ATTR}),d("WAWap").wap("registration",null,d("WAWap").BIG_ENDIAN_CONTENT(q)),r);return d("WADeprecatedSendIq").deprecatedSendStanzaAndWaitForAck(o,d("WAWebCommsAckParser").toCoreAckTemplate({id:l,"class":"receipt",from:f,participant:g,type:"retry"}))}catch(a){d("WALogger").ERROR(i(),a).sendLogs("sendRetryReceipt: error while creating or sending the retry message")}});return m.apply(this,arguments)}function n(a,b){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=(yield p(a,b));b=a[0];a=a[1];a&&(yield d("WAWebSignalStoreApi").waSignalStore.markKeyAsUploaded(a.keyId),yield d("WAWebSignalStoreApi").waSignalStore.markPreKeyAsDirectDistribution(a.keyId));return b});return o.apply(this,arguments)}function p(a,b){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){if(a<k)return(h||(h=b("Promise"))).resolve([null,null]);try{a=(yield (h||(h=b("Promise"))).all([d("WAWebSignalStoreApi").waSignalStore.getSignedPreKey(),d("WAWebSignalStoreApi").waSignalStore.getOrGenSinglePreKey(d("WAWebSignalKeyApi").generatePreKeyPair),d("WAWebAdvSignatureApi").getADVEncodedIdentity().then(function(a){return d("WAWap").wap("device-identity",null,a)})]));var f=a[0],g=a[1];a=a[2];if(!f)throw c("err")("Signed pre key is not available");e=d("WAWap").wap("keys",null,d("WAWap").wap("type",null,c("WAWebConstantsDeprecated").KEY_BUNDLE_TYPE),d("WAWap").wap("identity",null,e.pubKey),d("WAWebSignalUtilsApi").xmppPreKey(g),d("WAWebSignalUtilsApi").xmppSignedPreKey(f),a);return[e,g]}catch(a){throw c("err")("Could not create keys section for retry")}});return q.apply(this,arguments)}function e(a){if(a instanceof d("WAWebHandleMsgError").UnknownDeviceMessageError)return l.UnknownCompanionNoPrekey;else if(a instanceof d("WAWebSignalCommonErrors").SignalDecryptionError)switch(a.message){case"errSignalNoSession":case"errLoadSenderKeySession":return l.SignalErrorNoSession;case"errSignalInvalidMsg":return l.SignalErrorInvalidMessage;case"errSignalInvalidKey":return l.SignalErrorInvalidKey;case"errSignalTooManyMessagesInFuture":case"errSignalGrpTooManyMessagesInFuture":return l.SignalErrorFutureMessage;case"errInvalidMacWithDecryptedPlaintext":case"errInvalidMacInvalidCipherKey":case"errInvalidMacInvalidCipherKeyNewChain":return l.SignalErrorBadMac}}g.RetryReason=l;g.sendRetryReceipt=a;g.prepareKeysForRetry=n;g.getRetryReasonFromError=e}),98);
__d("WAWebHandleMsgSendReceipt",["WALogger","WAWebCreateNackFromStanza","WAWebHandleMsgCommon","WAWebHandleMsgSendAck","WAWebHandleMsgTypes.flow","WAWebMsgProcessingApiUtils","WAWebPostMessageHighRetryCountMetric","WAWebSendDeliveryReceiptJob","WAWebSendReceiptJobCommon","WAWebSendRetryReceiptJob","WAWebUserPrefsMeUser","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(['sendReceipt: invalid e2eProcessResult "','"']);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(['sendReceipt: HSM mismatch, no receipt sent for "','"']);i=function(){return a};return a}function a(a,b,c){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){var e=a.externalId,f=b.rawTs;b=b.type;var g=d("WAWebMsgProcessingApiUtils").getFrom(a),j=a.type===d("WAWebHandleMsgTypes.flow").MESSAGE_TYPE.CHAT&&d("WAWebUserPrefsMeUser").isMeAccount(a.author)?a.chat:null,k=a.type===d("WAWebHandleMsgTypes.flow").MESSAGE_TYPE.CHAT?null:a.author,l=a.category===d("WAWebHandleMsgCommon").CATEGORY_PEER,m=!a.chat.isBot()&&a.author.isBot();switch(c.result){case d("WAWebHandleMsgTypes.flow").E2EProcessResult.SUCCESS:case d("WAWebHandleMsgTypes.flow").E2EProcessResult.SIGNAL_OLD_COUNTER_ERROR:if(m){var n,o;a.type===d("WAWebHandleMsgTypes.flow").MESSAGE_TYPE.CHAT?(m=a.author,n=a.chat):(m=a.chat,o=a.author);return d("WAWebSendReceiptJobCommon").sendBotInvokeResponseAcks([e],m,n,o)}return d("WAWebSendDeliveryReceiptJob").sendDeliveryReceiptsAfterDecryption(e,g,j,k,l,c);case d("WAWebHandleMsgTypes.flow").E2EProcessResult.HSM_MISMATCH:d("WALogger").WARN(i(),e).sendLogs("send-receipt-skipping-hsm-mismatch-result");return;case d("WAWebHandleMsgTypes.flow").E2EProcessResult.RETRY:m=c.retryCount==null?1:c.retryCount+1;yield d("WAWebSendRetryReceiptJob").sendRetryReceipt({retryCount:m,to:g,participant:k,recipient:j,externalId:e,rawTs:f,isPeer:l,retryReason:c.retryReason});void d("WAWebPostMessageHighRetryCountMetric").maybePostMessageHighRetryCountMetric(m,a);return;case d("WAWebHandleMsgTypes.flow").E2EProcessResult.BACKFILL:return d("WAWebHandleMsgSendAck").sendAck(e,g,b,k);case d("WAWebHandleMsgTypes.flow").E2EProcessResult.PARSE_VALIDATION_ERROR:return d("WAWebHandleMsgSendAck").sendNack(e,g,b,k,d("WAWebCreateNackFromStanza").NackReason.InvalidProtobuf);case d("WAWebHandleMsgTypes.flow").E2EProcessResult.PARSE_ERROR:return d("WAWebHandleMsgSendAck").sendNack(e,g,b,k,d("WAWebCreateNackFromStanza").NackReason.ParsingError)}d("WALogger").ERROR(h(),c.result).sendLogs("send-receipt-missing-e2e-process-result");return d("WAWebHandleMsgSendAck").sendAck(e,g,b,k)});return j.apply(this,arguments)}g.sendReceipt=a}),98);
__d("WAWebWamEnumCallStanzaType",[],(function(a,b,c,d,e,f){a=Object.freeze({OFFER:0,ACCEPT:1,REJECT:2,VIDEO:3,TERMINATE:4,ENC_REKEY:5,RELAYLATENCY:6,TRANSPORT:7,PREACCEPT:8,GROUP_UPDATE:9,MUTE_V2:10,INTERRUPTION:11,FLOWCONTROL:12,NOTIFY:13,OFFER_NOTICE:14,CALL_RELAY:15,MUTE:16,SCREEN_SHARE:17,UNKNOWN:18});f.CALL_STANZA_TYPE=a}),66);
__d("WAWebWamEnumStanzaType",[],(function(a,b,c,d,e,f){a=Object.freeze({MESSAGE:1,RECEIPT:2,CALL:3,NOTIFICATION:4,APPDATA:5});f.STANZA_TYPE=a}),66);
__d("WAWebOfflineCountTooHighWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumCallStanzaType","WAWebWamEnumMediaType","WAWebWamEnumMessageType","WAWebWamEnumStanzaType"],(function(a,b,c,d,e,f,g){b=(a=d("WAWebWamCodegenUtils")).defineEvents({OfflineCountTooHigh:[2638,{callStanzaType:[7,d("WAWebWamEnumCallStanzaType").CALL_STANZA_TYPE],mediaType:[3,d("WAWebWamEnumMediaType").MEDIA_TYPE],messageType:[4,d("WAWebWamEnumMessageType").MESSAGE_TYPE],notificationStanzaType:[6,a.TYPES.STRING],offlineCount:[2,a.TYPES.INTEGER],receiptStanzaType:[5,a.TYPES.STRING],stanzaType:[1,d("WAWebWamEnumStanzaType").STANZA_TYPE]},[1,1,1],"regular"]});g.OfflineCountTooHighWamEvent=b}),98);
__d("WAWebMaybePostOfflineCountTooHighMetric",["WALogger","WAWebBackendJobsCommon","WAWebOfflineCountTooHighWamEvent","WAWebWamEnumStanzaType","WAWebWamMsgUtils"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to post OfflineCountTooHigh metric: ",""]);h=function(){return a};return a}var i=11;function a(a){var b=a.msgInfo,c=a.msgMeta;a=a.encs;var e=parseInt(b.offline,10);if(Number.isNaN(e)||e<i)return;a=new(d("WAWebOfflineCountTooHighWamEvent").OfflineCountTooHighWamEvent)({offlineCount:e,stanzaType:d("WAWebWamEnumStanzaType").STANZA_TYPE.MESSAGE,mediaType:d("WAWebBackendJobsCommon").getMetricMediaType({encMediaType:(e=a.find(function(a){return a.encMediaType!=null}))==null?void 0:e.encMediaType,msgType:c.type,msgPollType:c.pollType})});e=d("WAWebWamMsgUtils").getMessageTypeFromMsgInfoType(b.type);e!=null&&(a.messageType=e);a.commitAndWaitForFlush()["catch"](function(a){d("WALogger").WARN(h(),a).tags("messaging")})}g.OFFLINE_COUNT_TOO_HIGH_THRESHOLD=i;g.maybePostOfflineCountTooHigh=a}),98);
__d("WAWebMessageDedupUtils",["WALogger","WAWebABProps"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["message-dedup: message with "," is pending"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["message-dedup: remove message cacheKey: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["message-dedup: add message cacheKey: ",""]);j=function(){return a};return a}var k=new Set();function a(){return d("WAWebABProps").getABPropConfigValue("web_message_dedup_enabled")}function b(a,b,c){a=l(a,b,c);k.add(a);d("WALogger").LOG(j(),a)}function c(a,b,c){a=l(a,b,c);d("WALogger").LOG(i(),a);k["delete"](a)}function e(a,b,c){a=l(a,b,c);b=k.has(a);b&&d("WALogger").LOG(h(),a);return b}function l(a,b,c){c=c.map(function(a){return String(a.e2eType)+":"+a.retryCount}).join(",");return a.toString()+"_"+b.toString()+"_"+c}g.isMessageDedupEnabled=a;g.addToPendingMessage=b;g.removeFromPendingMessage=c;g.isMessagePending=e}),98);
__d("WAWebMessageInsertDebugPlaceholder",["WALogger","WAWebBackendApi","WAWebCmd","WAWebMessageProcessorCache","WAWebMessagingGatingUtils","WAWebMsgProcessingApiUtils","WAWebMsgType","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["_insertDebugPlaceholder: msgId::",", failed to insert with error: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["_insertDebugPlaceholder: msgId::",", could not parse message info"]);i=function(){return a};return a}function a(a){if(!d("WAWebMessagingGatingUtils").isMessageDropPlaceholderEnabled())return;void j(a)}function j(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.externalId,c=a.msgInfo,e=a.offline;a=a.nackReason;if(c==null){d("WALogger").WARN(i(),b).tags("messaging");return}c=babelHelpers["extends"]({},d("WAWebMsgProcessingApiUtils").generateBaseMsg(c),{type:d("WAWebMsgType").MSG_TYPE.DEBUG_PLACEHOLDER,kind:d("WAWebMsgType").MsgKind.DebugPlaceholder,body:a.toString()});try{yield d("WAWebMessageProcessorCache").messageProcessorCache.addMessages([{msg:c}],e!==!0),d("WAWebCmd").Cmd.isMainStreamReadyMd&&(yield d("WAWebBackendApi").frontendSendAndReceive("updateMessageUI",{chatId:c.id.remote,msg:c}))}catch(a){d("WALogger").WARN(h(),b,a).tags("messaging")}});return k.apply(this,arguments)}g.maybeInsertDebugPlaceholder=a}),98);
__d("WAWebMsgProcessingDecryptEnc",["Promise","WAWebBackendJobs.flow","WAWebBotGating","WAWebBotMessageSecret","WAWebSignal","err"],(function(a,b,c,d,e,f,g){var h;function a(a,e,f,g){var i=a.e2eType;a=a.ciphertext;switch(i){case d("WAWebBackendJobs.flow").CiphertextType.Skmsg:if(!(e.isGroup()||e.isBroadcast()))return(h||(h=b("Promise"))).reject(c("err")("['messaging'] decryptEnc: Can not do skmsg for non group "+e.toString()));return!f?(h||(h=b("Promise"))).reject(c("err")("['messaging'] decryptEnc: receive msg from "+e.toString()+" without participant")):d("WAWebSignal").Cipher.decryptGroupSignalProto(e,f,a);case d("WAWebBackendJobs.flow").CiphertextType.Pkmsg:case d("WAWebBackendJobs.flow").CiphertextType.Msg:f=e.isUser()?e:f;return!f?(h||(h=b("Promise"))).reject(c("err")("['messaging'] decryptEnc: receive msg from "+e.toString()+" without participant")):d("WAWebSignal").Cipher.decryptSignalProto(f,i,a);case d("WAWebBackendJobs.flow").CiphertextType.Msmsg:return!d("WAWebBotGating").isBotReceiveEnabled()?(h||(h=b("Promise"))).reject(c("err")("[messaging] decryptEnc: Msmsg unsupported")):d("WAWebBotMessageSecret").decryptMsmsgBotMessage(a,g)}}g.decryptEnc=a}),98);
__d("WAWebE2eMessageRecvWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumAddressingMode","WAWebWamEnumAgentEngagementEnumType","WAWebWamEnumBotType","WAWebWamEnumE2eCiphertextType","WAWebWamEnumE2eDestination","WAWebWamEnumE2eFailureReason","WAWebWamEnumE2eSenderType","WAWebWamEnumEditType","WAWebWamEnumMediaType","WAWebWamEnumRevokeType","WAWebWamEnumStanzaType","WAWebWamEnumTypeOfGroupEnum"],(function(a,b,c,d,e,f,g){b=(a=d("WAWebWamCodegenUtils")).defineEvents({E2eMessageRecv:[478,{agentEngagementType:[15,d("WAWebWamEnumAgentEngagementEnumType").AGENT_ENGAGEMENT_ENUM_TYPE],botType:[19,d("WAWebWamEnumBotType").BOT_TYPE],e2eCiphertextType:[5,d("WAWebWamEnumE2eCiphertextType").E2E_CIPHERTEXT_TYPE],e2eCiphertextVersion:[6,a.TYPES.INTEGER],e2eDestination:[4,d("WAWebWamEnumE2eDestination").E2E_DESTINATION],e2eFailureReason:[2,d("WAWebWamEnumE2eFailureReason").E2E_FAILURE_REASON],e2eSenderType:[8,d("WAWebWamEnumE2eSenderType").E2E_SENDER_TYPE],e2eSuccessful:[1,a.TYPES.BOOLEAN],editType:[13,d("WAWebWamEnumEditType").EDIT_TYPE],isHostedChat:[20,a.TYPES.BOOLEAN],isLid:[11,a.TYPES.BOOLEAN],localAddressingMode:[16,d("WAWebWamEnumAddressingMode").ADDRESSING_MODE],messageAddressingMode:[17,d("WAWebWamEnumAddressingMode").ADDRESSING_MODE],messageMediaType:[7,d("WAWebWamEnumMediaType").MEDIA_TYPE],offline:[9,a.TYPES.BOOLEAN],retryCount:[3,a.TYPES.INTEGER],revokeType:[10,d("WAWebWamEnumRevokeType").REVOKE_TYPE],serverAddressingMode:[18,d("WAWebWamEnumAddressingMode").ADDRESSING_MODE],stanzaType:[14,d("WAWebWamEnumStanzaType").STANZA_TYPE],typeOfGroup:[12,d("WAWebWamEnumTypeOfGroupEnum").TYPE_OF_GROUP_ENUM]},[1,1,20],"regular"]});g.E2eMessageRecvWamEvent=b}),98);
__d("WAWebPostE2eMessageRecvMetric",["WAWebABProps","WAWebBackendApi","WAWebBackendJobsCommon","WAWebE2eMessageRecvWamEvent","WAWebGroupType","WAWebHandleMsgCommon","WAWebWamAddressingModeUtils","WAWebWamEnumAgentEngagementEnumType","WAWebWamMsgUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b,c=a.enc,e=a.from,f=a.msgMeta,g=a.msgInfo;a=a.msgBotInfo;var h=f.type===d("WAWebHandleMsgCommon").STANZA_MSG_TYPES.reaction,i=g.chat;f=new(d("WAWebE2eMessageRecvWamEvent").E2eMessageRecvWamEvent)({e2eCiphertextType:(b=d("WAWebBackendJobsCommon")).getMetricE2eCiphertextType(c.e2eType),e2eCiphertextVersion:b.CIPHERTEXT_VERSION,e2eSuccessful:!1,messageMediaType:b.getMetricMediaType({encMediaType:c.encMediaType,msgType:f.type,msgPollType:f.pollType}),retryCount:c.retryCount,editType:b.getMetricEditType(g.edit),botType:d("WAWebWamMsgUtils").getWamBotType(i,a==null?void 0:a.bizBotType)});c=d("WAWebBackendJobsCommon").getMetricE2eDestination(e);c&&(f.e2eDestination=c);d("WAWebABProps").getABPropConfigValue("web_extra_lid_group_logging_attributes")&&(g.addressingMode!=null&&(f.serverAddressingMode=d("WAWebWamAddressingModeUtils").getWamAddressingModeFromString(g.addressingMode)));if(i.isGroup()){b=(yield d("WAWebBackendApi").frontendSendAndReceive("getGroupMetadata",{groupWid:i}));if(b!=null){a=b.isIncognitoCag;a!=null&&(f.isLid=a&&h);e=d("WAWebGroupType").groupTypeToWamEnum(d("WAWebGroupType").getGroupTypeFromGroupMetadata(b));f.typeOfGroup=e;Object.assign(f,d("WAWebWamAddressingModeUtils").getAddressingModeMetricsFromGroupMetadata(b))}}else f.isLid=i.isLid();g.author.isBot()&&(g.chat.isBot()?f.agentEngagementType=d("WAWebWamEnumAgentEngagementEnumType").AGENT_ENGAGEMENT_ENUM_TYPE.DIRECT_CHAT:f.agentEngagementType=d("WAWebWamEnumAgentEngagementEnumType").AGENT_ENGAGEMENT_ENUM_TYPE.INVOKED);return f});return i.apply(this,arguments)}function a(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield h(a));a.e2eSuccessful=!0;a.weight=1e3;a.commit()});return j.apply(this,arguments)}function c(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield h(a));a.e2eSuccessful=!1;a.weight=1;a.commit()});return k.apply(this,arguments)}g.postSuccessE2eMessageRecvMetric=a;g.postFailureE2eMessageRecvMetric=c}),98);
__d("WAWebMsgProcessingDecryptionHandler",["$InternalEnum","WALogger","WATimeUtils","WAWebABProps","WAWebBackendJobs.flow","WAWebBackendJobsCommon","WAWebCreateNackFromStanza","WAWebHandleMsgCommon","WAWebHandleMsgError","WAWebHandleMsgProcess","WAWebHandleMsgTypes.flow","WAWebMessagingGatingUtils","WAWebMsgProcessingApiUtils","WAWebMsgType","WAWebPostE2eMessageRecvMetric","WAWebPostIncomingMessageDropMetric","WAWebSendRetryReceiptJob","WAWebSignalCommonErrors","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["messageDrop: insert a debug placeholder for ",", reason: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["decryptE2EPayload: e2eType:"," error:",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["decryptE2EPayload: e2eType:"," error:",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["decryptE2EPayload: e2eType:"," infoType:"," isDirect:"," error:",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["decryptE2EPayload: e2eType:"," error:",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["decryptE2EPayload: e2eType:"," error:",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["decryptE2EPayload: msgId::"," e2eType:"," error:",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["decryptE2EPayload: expired status has 2 encs and expired for ","s client time or for ","s with a clock skew"]);o=function(){return a};return a}var p=b("$InternalEnum").Mirrored(["SignalRetryable","SignalDuplicateMessage","UnknownDevice","DeviceSentMessage","InvalidProtobuf","HsmMismatch","Unknown"]),q=new Set([p.SignalRetryable]);function r(a){return a.message==="errDuplicateMsg"?p.SignalDuplicateMessage:p.SignalRetryable}function s(a){if(a instanceof d("WAWebHandleMsgError").UnknownDeviceMessageError)return p.UnknownDevice;else if(a instanceof d("WAWebSignalCommonErrors").SignalDecryptionError)return r(a);else if(a instanceof d("WAWebSignalCommonErrors").SignalMessageCounterError)return p.SignalDuplicateMessage;else if(a instanceof d("WAWebHandleMsgError").DeviceSentMessageError)return p.DeviceSentMessage;else if(a instanceof d("WAWebHandleMsgError").MessageValidationError)return p.InvalidProtobuf;else if(a instanceof d("WAWebHandleMsgCommon").HsmMismatchError)return p.HsmMismatch;return p.Unknown}function a(a){var b={accessedEncs:new Set(),pkOrMsgFailedEnc:null,skMsgFailedEnc:null};return{handleError:function(c,e){var f=s(e);c.e2eType===d("WAWebBackendJobs.flow").CiphertextType.Skmsg?b.skMsgFailedEnc={enc:c,error:e,errorType:f}:b.pkOrMsgFailedEnc={enc:c,error:e,errorType:f};x(a,{enc:c,error:e,errorType:f})},canDecryptNext:function(a){var c;c=(c=b.pkOrMsgFailedEnc)==null?void 0:c.errorType;if(c!=null&&q.has(c))return!1;b.accessedEncs.add(a.e2eType);return!0},getResult:function(c){return u(a,b,c)}}}function t(a,b){var c=a.msgInfo;a=a.encs;b===void 0&&(b=!1);var e=c.chat;c=c.ts;if(e.isStatusV3()){e=d("WATimeUtils").unixTimeWithoutClockSkewCorrection()-(c+d("WATimeUtils").DAY_SECONDS);var f=e>0;if(f&&b&&a.length===2){b=d("WATimeUtils").unixTime()-(c+d("WATimeUtils").DAY_SECONDS);d("WALogger").WARN(o(),e,b).tags("messaging").sendLogs("handleMsg: expired status multiple encs",.01)}return f}return!1}function u(a,b,c){return v.apply(this,arguments)}function v(){v=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){var e;e=(e=b.skMsgFailedEnc)!=null?e:b.pkOrMsgFailedEnc;var f=e!=null&&b.accessedEncs.has(d("WAWebBackendJobs.flow").CiphertextType.Skmsg)&&b.skMsgFailedEnc==null;if(e==null||f||t(a,!0)&&d("WAWebABProps").getABPropConfigValue("web_skip_expired_status_error"))return{result:d("WAWebHandleMsgTypes.flow").E2EProcessResult.SUCCESS,hasInactiveMsg:c};w(a,b);y(a,b);f=e.enc;c=e.error;b=e.errorType;var g;(c instanceof d("WAWebSignalCommonErrors").SignalDecryptionError||c instanceof d("WAWebHandleMsgError").UnknownDeviceMessageError)&&(g=d("WAWebSendRetryReceiptJob").getRetryReasonFromError(c),b!==p.SignalDuplicateMessage&&(f.hideFail||(yield d("WAWebHandleMsgProcess").processPlaceholderMsg({type:d("WAWebMsgType").MSG_TYPE.CIPHERTEXT,msgInfo:a.msgInfo,placeholderType:d("WAWebHandleMsgTypes.flow").PlaceholderType.E2E,placeholderAddReason:d("WAWebBackendJobsCommon").getPlaceholderAddReason(c)}))));switch(b){case p.SignalRetryable:case p.UnknownDevice:return{result:d("WAWebHandleMsgTypes.flow").E2EProcessResult.RETRY,retryCount:f.retryCount,retryReason:g};case p.SignalDuplicateMessage:return{result:d("WAWebHandleMsgTypes.flow").E2EProcessResult.SIGNAL_OLD_COUNTER_ERROR,failedEnc:f};case p.InvalidProtobuf:case p.DeviceSentMessage:return{result:d("WAWebHandleMsgTypes.flow").E2EProcessResult.PARSE_VALIDATION_ERROR};case p.HsmMismatch:return{result:d("WAWebHandleMsgTypes.flow").E2EProcessResult.HSM_MISMATCH};case p.Unknown:return{result:d("WAWebHandleMsgTypes.flow").E2EProcessResult.PARSE_ERROR}}});return v.apply(this,arguments)}function w(a,b){var c=b.skMsgFailedEnc;b=b.pkOrMsgFailedEnc;var e=a.msgInfo,f=a.msgMeta;c=(c=c)!=null?c:b;if(c==null)return;b=c.enc;var g=c.errorType;c=c.error;if(t(a)){d("WAWebABProps").getABPropConfigValue("web_skip_expired_status_error")||d("WAWebPostIncomingMessageDropMetric").postIncomingMessageDropExpired({msgInfo:e,msgMeta:f,enc:b,error:c instanceof d("WAWebHandleMsgError").MessageValidationError?c:void 0});return}switch(g){case p.SignalRetryable:case p.UnknownDevice:case p.HsmMismatch:case p.SignalDuplicateMessage:break;case p.InvalidProtobuf:case p.DeviceSentMessage:d("WAWebPostIncomingMessageDropMetric").postIncomingMessageDropInvalidProtobuf({msgInfo:e,msgMeta:f,enc:b,error:c instanceof d("WAWebHandleMsgError").MessageValidationError?c:void 0});break;case p.Unknown:d("WAWebPostIncomingMessageDropMetric").postIncomingMessageDropInvalidStanzaFromDecryptedMessageInfo({msgInfo:e,msgMeta:f,enc:b})}}function x(a,b){var e=a.msgInfo,f=a.msgMeta;a=a.msgBotInfo;var g=b.enc,h=b.error;b=b.errorType;var o=d("WAWebMsgProcessingApiUtils").getFrom(e);void d("WAWebPostE2eMessageRecvMetric").postFailureE2eMessageRecvMetric({enc:g,from:o,msgMeta:f,msgInfo:e,msgBotInfo:a});d("WALogger").WARN(n(),e.externalId,g.e2eType,h.stack).tags("messaging");switch(b){case p.SignalDuplicateMessage:break;case p.SignalRetryable:case p.UnknownDevice:c("gkx")("26258")||d("WALogger").WARN(m(),g.e2eType,h).tags("messaging").sendLogs("handleMsg: decryption error");break;case p.InvalidProtobuf:h instanceof d("WAWebHandleMsgError").MessageValidationError&&h.sendLogs&&d("WALogger").WARN(l(),g.e2eType,h).tags("messaging").sendLogs("handleMsg: "+h.name);break;case p.DeviceSentMessage:d("WALogger").WARN(k(),g.e2eType,e.type,e.isDirect,h).tags("messaging").sendLogs("handleMsg: parse device sent message error");break;case p.HsmMismatch:d("WALogger").WARN(j(),g.e2eType,h).tags("messaging").sendLogs("handleMsg: hsm mismatch error");break;case p.Unknown:d("WALogger").WARN(i(),g.e2eType,h).tags("messaging").sendLogs("handleMsg: parse decrypted message error");break}}function y(a,b){var c=b.skMsgFailedEnc;b=b.pkOrMsgFailedEnc;c=(c=c)!=null?c:b;if(c==null)return;if(!d("WAWebMessagingGatingUtils").isMessageDropPlaceholderEnabled())return;b=a.msgInfo.chat;if(!(b.isUser()||b.isGroup()))return;if(t(a))return;b=null;switch(c.errorType){case p.SignalRetryable:case p.SignalDuplicateMessage:case p.UnknownDevice:break;case p.DeviceSentMessage:case p.InvalidProtobuf:b=d("WAWebCreateNackFromStanza").NackReason.InvalidProtobuf;break;case p.HsmMismatch:case p.Unknown:b=d("WAWebCreateNackFromStanza").NackReason.ParsingError;break}if(b!=null){var e=a.msgInfo.externalId;d("WALogger").WARN(h(),e,c.errorType).tags("messaging");void d("WAWebHandleMsgProcess").processPlaceholderMsg({type:d("WAWebMsgType").MSG_TYPE.DEBUG_PLACEHOLDER,msgInfo:a.msgInfo,nackReason:b})}}g.DecryptionErrorType=p;g.createDecryptionHandler=a}),98);
__d("WAWebMsgProcessingDecryptApi",["WALogger","WAWebAdvSignatureApi","WAWebBackendJobs.flow","WAWebHandleMsgTypes.flow","WAWebMsgProcessingApiUtils","WAWebMsgProcessingDecryptEnc","WAWebMsgProcessingDecryptionHandler","WAWebPostE2eMessageRecvMetric","WAWebSendRetryReceiptJob","WAWebSignalProtocolStore","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["processDecryptedProto: msgId::"," e2eType:"," done"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["decryptE2EPayload: msgId::"," e2eType:"," done"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["decryptE2EPayload: msgId::",", validateADVIdentity failed"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["decryptE2EPayload: msgId::"," skMsg is out of order"]);k=function(){return a};return a}function a(a,b){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=a.bizInfo,e=a.msgInfo,f=a.paymentInfo,g=a.deviceIdentity,k=a.encs,l=a.msgMeta,n=a.rcat,o=a.hsmInfo,p=a.msgBotInfo,q=a.reportingTokenInfo,r=d("WAWebMsgProcessingApiUtils").getFrom(e);m(k,e);if(e.author.device!=null&&e.author.device!==0){g=(yield d("WAWebAdvSignatureApi").validateADVwithEncs(e.author,g,k,!!e.offline));if(!g){d("WALogger").WARN(j(),e.externalId).tags("messaging");return{result:d("WAWebHandleMsgTypes.flow").E2EProcessResult.RETRY,retryCount:k[0].retryCount,retryReason:d("WAWebSendRetryReceiptJob").RetryReason.AdvFailure}}}g=!1;var s=d("WAWebMsgProcessingDecryptionHandler").createDecryptionHandler(a);for(k of k){if(!s.canDecryptNext(k))continue;try{var t=(yield d("WAWebMsgProcessingDecryptEnc").decryptEnc(k,r,e.author,a));d("WALogger").LOG(i(),e.externalId,k.e2eType).tags("messaging");d("WAWebPostE2eMessageRecvMetric").postSuccessE2eMessageRecvMetric({enc:k,from:r,msgMeta:l,msgInfo:e,msgBotInfo:p});var u={retryCount:k.retryCount,e2eType:k.e2eType,encMediaType:k.encMediaType,hideFail:k.hideFail};t=(yield b({decrypted:t,info:e,paymentInfo:f,e2eInfo:u,bizInfo:c,hsmInfo:o,msgMeta:l,rcat:n,msgBotInfo:p,reportingTokenInfo:q}));t.hasInactiveMsg&&(g=!0);d("WALogger").LOG(h(),e.externalId,k.e2eType).tags("messaging")}catch(a){s.handleError(k,a)}}yield d("WAWebSignalProtocolStore").getSignalProtocolStore().flushBufferToDiskIfNotMemOnlyMode();return s.getResult(g)});return l.apply(this,arguments)}function m(a,b){a.length===2&&a[0].e2eType===d("WAWebBackendJobs.flow").CiphertextType.Skmsg&&d("WALogger").ERROR(k(),b.externalId).tags("messaging").sendLogs("handleMsg: invalid encs order",.1)}g.decryptE2EPayload=a}),98);
__d("WAWebProcessPhoneNumberMapping",["Promise","WAWebApiContact","WAWebSetUsernameJob","WAWebUpdateLidMetadataJob","WAWebUserPrefsMeUser","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(a,b,c){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){var f=a.recipientPn,g=a.recipientUsername,i=a.chat,j=a.author;if(d("WAWebUserPrefsMeUser").isMeAccount(j)){g!=null&&(yield d("WAWebSetUsernameJob").setUsernamesJob([{userId:d("WAWebWidFactory").toUserWid(i),username:g}]));if((c==null?void 0:c.origin)!=="username")if(f!=null)yield (h||(h=b("Promise"))).all([d("WAWebUpdateLidMetadataJob").createLidPnMappingsJob([{lid:d("WAWebWidFactory").toUserWid(i),pn:d("WAWebWidFactory").toUserWid(f)}],e),d("WAWebUpdateLidMetadataJob").updateLidMetadataJob([{lid:d("WAWebWidFactory").toUserWid(i),data:{shareOwnPn:!1}}])]);else{g=(yield d("WAWebApiContact").getContactRecord(i));(g==null||(g==null?void 0:g.shareOwnPn)!==!0)&&d("WAWebUpdateLidMetadataJob").updateLidMetadataJob([{lid:d("WAWebWidFactory").toUserWid(i),data:{shareOwnPn:!0}}])}return}f=a.displayName;f!=null&&(yield d("WAWebUpdateLidMetadataJob").updateLidMetadataJob([{lid:d("WAWebWidFactory").toUserWid(j),data:{displayNameLID:f}}]));if((c==null?void 0:c.origin)==="username"){g=a.username;i=[];f=d("WAWebWidFactory").toUserWid(j);g!=null?i.push({userId:f,username:g}):i.push({userId:f});yield d("WAWebSetUsernameJob").setUsernamesJob(i)}g=a.senderPn;g!=null&&(yield d("WAWebUpdateLidMetadataJob").createLidPnMappingsJob([{lid:d("WAWebWidFactory").toUserWid(j),pn:d("WAWebWidFactory").toUserWid(g)}],e));(c==null?void 0:c.origin)!=="username"&&(g==null&&(yield d("WAWebUpdateLidMetadataJob").updateLidMetadataJob([{lid:d("WAWebWidFactory").toUserWid(j),data:{shareOwnPn:!0}}])))});return j.apply(this,arguments)}function k(a,b,c){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){b=a.recipientLid;var e=a.chat,f=a.author;d("WAWebUserPrefsMeUser").isMeAccount(f)&&b!=null&&(yield d("WAWebUpdateLidMetadataJob").createLidPnMappingsJob([{lid:d("WAWebWidFactory").toUserWid(b),pn:d("WAWebWidFactory").toUserWid(e)}],c));b=a.senderLid;b!=null&&(yield d("WAWebUpdateLidMetadataJob").createLidPnMappingsJob([{lid:d("WAWebWidFactory").toUserWid(b),pn:d("WAWebWidFactory").toUserWid(f)}],c))});return l.apply(this,arguments)}function m(a,b,c){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){var d=a.author;return d.isLid()?i(a,b,c):k(a,b,c)});return n.apply(this,arguments)}function o(a,b){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=a.participantPn,e=a.participantLid,f=a.author;c!=null&&(yield d("WAWebUpdateLidMetadataJob").createLidPnMappingsJob([{lid:d("WAWebWidFactory").toUserWid(f),pn:d("WAWebWidFactory").toUserWid(c)}],b));e!=null&&(yield d("WAWebUpdateLidMetadataJob").createLidPnMappingsJob([{lid:d("WAWebWidFactory").toUserWid(e),pn:d("WAWebWidFactory").toUserWid(f)}],b));c=a.displayName;!d("WAWebUserPrefsMeUser").isMeAccount(f)&&c!=null&&(yield d("WAWebUpdateLidMetadataJob").updateLidMetadataJob([{lid:d("WAWebWidFactory").toUserWid(f),data:{displayNameLID:c}}]))});return p.apply(this,arguments)}function a(a,b,c){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){var d=a.chat;if(d.isUser())return m(a,b,c);else if(d.isGroup()||d.isBroadcast())return o(a,c)});return q.apply(this,arguments)}g.processUserMessage=m;g.processGroupOrStatusBroadcastMessage=o;g.processPhoneNumberMapping=a}),98);
__d("WAWebHandleMsg",["Promise","WALogger","WAParsableWapNode","WATimeUtils","WAWebCreateNackFromStanza","WAWebDBReportingTokenUtils","WAWebGetMessageCache","WAWebHandleMsgCommon","WAWebHandleMsgMetaUtils","WAWebHandleMsgParser","WAWebHandleMsgProcess","WAWebHandleMsgSendReceipt","WAWebHandleMsgTypes.flow","WAWebMaybePostOfflineCountTooHighMetric","WAWebMessageDedupUtils","WAWebMessageInsertDebugPlaceholder","WAWebMessageThread","WAWebMsgProcessingApiUtils","WAWebMsgProcessingDecryptApi","WAWebMsgType","WAWebOfflineHandler","WAWebPostIncomingMessageDropMetric","WAWebPostUnknownStanzaMetric","WAWebProcessPhoneNumberMapping","asyncToGeneratorRuntime","cr:4122","gkx"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleMessage: msgId::",', start processing message, offline="','"']);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["setting fanout placeholder type to hosted fanout"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["setting fanout placeholder type to bot fanout future proofing"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleMessage: msgId::",", get fanout placeholder"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["message-dedup: skip progressing duplicate"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleMsg: error while parsing message for ack only: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleMsg: error while parsing message stanza: ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleMsg: error while parsing message stanza"]);p=function(){return a};return a}function q(a){var e=d("WAWebHandleMsgParser").incomingMsgParser.parse(a);if(e.error){c("gkx")("26258")?d("WALogger").WARN(p()).tags("messaging"):d("WALogger").WARN(o(),a.toString()).tags("messaging");d("WAWebPostUnknownStanzaMetric").postUnknownStanzaMetric(a);var f=d("WAWebHandleMsgParser").incomingMsgParserForAckOnly.parse(a);if(f.error){d("WALogger").LOG(n(),f.error).tags("messaging");d("WAWebPostIncomingMessageDropMetric").postIncomingMessageDropInvalidStanza(a);return(h||(h=b("Promise"))).resolve(d("WAWebCreateNackFromStanza").createNackFromStanza(a,d("WAWebCreateNackFromStanza").NackReason.ParsingError))}f=f.success;var g=f.type,s=f.externalId,t=f.msgInfo;f=f.offline;var u=d("WAWebCreateNackFromStanza").NackReason.ParsingError;g==null?(u=d("WAWebCreateNackFromStanza").NackReason.UnrecognizedStanzaType,d("WAWebPostIncomingMessageDropMetric").postIncomingMessageDropUnknownMessageType(a)):e.error instanceof d("WAParsableWapNode").XmppParsingFailure&&((g=e.error)==null?void 0:g.reason)===""+d("WAWebCreateNackFromStanza").NackReason.InvalidHostedCompanionStanza?(u=d("WAWebCreateNackFromStanza").NackReason.InvalidHostedCompanionStanza,d("WAWebPostIncomingMessageDropMetric").postIncomingMessageDropInvalidHostedCompanionStanza(a)):d("WAWebPostIncomingMessageDropMetric").postIncomingMessageDropInvalidStanza(a);d("WAWebMessageInsertDebugPlaceholder").maybeInsertDebugPlaceholder({externalId:s,nackReason:u,msgInfo:t,offline:f});return(h||(h=b("Promise"))).resolve(d("WAWebCreateNackFromStanza").createNackFromStanza(a,u))}var v=e.success;d("WAWebMaybePostOfflineCountTooHighMetric").maybePostOfflineCountTooHigh(v);var w=v.msgMeta,x=v.msgInfo,y=v.msgBotInfo,z=v.encs,A=d("WAWebMsgProcessingApiUtils").messageInfoToKey(x);x.clientReceivedTsMillis=d("WATimeUtils").unixTimeMs();if(x.offline!=null){d("WAWebOfflineHandler").OfflineMessageHandler.addOfflinePendingMessage();d("WAWebOfflineHandler").OfflineMessageHandler.offlineStanzaReceivedAfterComplete();if(d("WAWebMessageDedupUtils").isMessageDedupEnabled()&&d("WAWebMessageDedupUtils").isMessagePending(A,x.ts,z)){d("WAWebOfflineHandler").OfflineMessageHandler.processMessageDecryptResult(d("WAWebHandleMsgTypes.flow").E2EProcessResult.SUCCESS);d("WALogger").LOG(m()).sendLogs("message-dedup-skip-duplicate",0);return(h||(h=b("Promise"))).resolve()}}d("WAWebMessageDedupUtils").isMessageDedupEnabled()&&d("WAWebMessageDedupUtils").addToPendingMessage(A,x.ts,z);d("WAWebOfflineHandler").OfflineMessageHandler.isResumeFromRestartComplete()&&delete v.msgInfo.offline;if(b("cr:4122")==null?void 0:b("cr:4122").isNextMessagePostponed(a,q)){void d("WAWebHandleMsgSendReceipt").sendReceipt(v.msgInfo,v.msgMeta,{result:d("WAWebHandleMsgTypes.flow").E2EProcessResult.SUCCESS});return(h||(h=b("Promise"))).resolve()}return d("WAWebMessageThread").handleMessage(x.chat.toString(),!!v.msgInfo.offline,b("asyncToGeneratorRuntime").asyncToGenerator(function*(){x.msgProcessStartTsMillis=d("WATimeUtils").unixTimeMs();void d("WAWebProcessPhoneNumberMapping").processPhoneNumberMapping(x,w,x.offline==null);if(w.isUnavailable){d("WAWebDBReportingTokenUtils").maybeStoreReportingTag(A,v.reportingTokenInfo);d("WALogger").LOG(l(),x.externalId).tags("messaging");var a=d("WAWebHandleMsgTypes.flow").PlaceholderType.FANOUT;y!=null?(d("WALogger").DEV(k()),a=d("WAWebHandleMsgTypes.flow").PlaceholderType.BOT_UNAVAILABLE_FANOUT):w.isHostedMsgUnavailable===!0&&(d("WALogger").DEV(j()),a=d("WAWebHandleMsgTypes.flow").PlaceholderType.HOSTED_UNAVAILABLE_FANOUT);yield d("WAWebHandleMsgProcess").processPlaceholderMsg({type:d("WAWebMsgType").MSG_TYPE.CIPHERTEXT,msgInfo:x,placeholderType:a});d("WAWebHandleMsgSendReceipt").sendReceipt(x,w,{result:d("WAWebHandleMsgTypes.flow").E2EProcessResult.BACKFILL});return}d("WALogger").LOG(i(),x.externalId,(a=x.offline)!=null?a:"").tags("messaging");a=(yield d("WAWebMsgProcessingDecryptApi").decryptE2EPayload(v,d("WAWebHandleMsgProcess").processDecryptedMessageProto));x.offline!=null&&d("WAWebOfflineHandler").OfflineMessageHandler.processMessageDecryptResult(a.result);a.result!==d("WAWebHandleMsgTypes.flow").E2EProcessResult.SUCCESS&&d("WAWebDBReportingTokenUtils").maybeStoreReportingTag(A,v.reportingTokenInfo);a.result===d("WAWebHandleMsgTypes.flow").E2EProcessResult.SIGNAL_OLD_COUNTER_ERROR&&r(v)?void d("WAWebGetMessageCache").getMessageCache().addMessages([{duplicateMsgReceiptInfo:{externalId:x.externalId,from:d("WAWebMsgProcessingApiUtils").getFrom(x),author:x.author,msgInfo:x,msgMeta:w,enc:a.failedEnc||z[0],hasHideFailEnc:z.some(function(a){return a.hideFail})}}],x.offline==null)["finally"](function(){d("WAWebMessageDedupUtils").isMessageDedupEnabled()&&d("WAWebMessageDedupUtils").removeFromPendingMessage(A,x.ts,z)}):x.offline==null||x.category===d("WAWebHandleMsgCommon").CATEGORY_PEER||a.result!==d("WAWebHandleMsgTypes.flow").E2EProcessResult.SUCCESS&&a.result!==d("WAWebHandleMsgTypes.flow").E2EProcessResult.SIGNAL_OLD_COUNTER_ERROR?(void d("WAWebHandleMsgSendReceipt").sendReceipt(x,w,a),d("WAWebMessageDedupUtils").isMessageDedupEnabled()&&d("WAWebMessageDedupUtils").removeFromPendingMessage(A,x.ts,z)):void d("WAWebGetMessageCache").getMessageCache().addMessages([{receiptInfo:{externalId:x.externalId,from:d("WAWebMsgProcessingApiUtils").getFrom(x),author:x.author}}],!1)["finally"](function(){d("WAWebMessageDedupUtils").isMessageDedupEnabled()&&d("WAWebMessageDedupUtils").removeFromPendingMessage(A,x.ts,z)})}))}function r(a){var b=a.msgMeta;a=a.encs;a=a.some(function(a){return a.hideFail});return a?d("WAWebHandleMsgMetaUtils").isReactionMsgMeta(b)||d("WAWebHandleMsgMetaUtils").isPollVoteMsgMeta(b):b.type===d("WAWebHandleMsgCommon").STANZA_MSG_TYPES.text||b.type===d("WAWebHandleMsgCommon").STANZA_MSG_TYPES.media||b.type===d("WAWebHandleMsgCommon").STANZA_MSG_TYPES.poll}g["default"]=q}),98);
__d("WAWebHandleMsgReceiptParser",["WADeprecatedWapParser","WAWebAck","WAWebHandleMsgTypes.flow","WAWebJidToWid","WAWebUserPrefsMeUser"],(function(a,b,c,d,e,f,g){var h={read:(a=d("WAWebAck")).ACK.READ,played:a.ACK.PLAYED,inactive:a.ACK.INACTIVE,"server-error":a.ACK.CONTENT_GONE,sender:a.ACK.RECEIVED,"read-self":a.ACK.READ,"played-self":a.ACK.PLAYED,peer_msg:a.ACK.PEER},i={SIMPLE:"simple",AGGREGATE:"aggregate"};b=new(c("WADeprecatedWapParser"))("incomingMsgReceiptParser",function(a){a.assertTag("receipt");a.hasAttr("to")&&a.assertAttr("to",d("WAWebUserPrefsMeUser").assertGetMe().toJid());var b=a.hasAttr("type")?a.attrEnumOrNullIfUnknown("type",h):d("WAWebAck").ACK.RECEIVED;b={ack:b||d("WAWebAck").ACK.RECEIVED,stanzaId:a.attrString("id"),from:d("WAWebJidToWid").jidWithTypeToWid(a.attrJidWithType("from")),ackString:a.hasAttr("type")?a.attrString("type"):null,offline:a.hasAttr("offline")?a.attrString("offline"):null};var c=a.maybeChild("error");c!=null&&(c.hasAttr("reason")&&c.attrString("reason")==="lid"&&c.attrString("type")==="feature-incapable"&&(b.ack=d("WAWebAck").ACK.SENT));c=a.maybeChild("participants");return c?j(b,c):k(b,a)});function j(a,b){var c=b.mapChildrenWithTag("user",function(a){try{var b=d("WAWebJidToWid").deviceJidToDeviceWid(a.attrDeviceJid("jid"));a=a.attrTime("t");return{participant:b,ts:a}}catch(a){return null}});c=c.filter(Boolean);return babelHelpers["extends"]({},a,{type:i.AGGREGATE,externalId:b.attrString("key"),receipts:c})}function k(a,b){var c=b.hasAttr("participant")?d("WAWebJidToWid").deviceJidToDeviceWid(b.attrDeviceJid("participant")):null,e=b.hasAttr("recipient")?d("WAWebJidToWid").userJidToUserWid(b.attrUserJid("recipient")):null,f=b.maybeAttrString("type")==="view",g;b.hasChild("list")?g=b.child("list").mapChildrenWithTag("item",function(a){return f?a.attrString("server_id"):a.attrString("id")}):g=[];var h;if(b.hasChild("biz")){var j=b.child("biz"),k=d("WAWebHandleMsgTypes.flow").ActualActorsEnumType.cast(j.maybeAttrInt("actual_actors")),l=d("WAWebHandleMsgTypes.flow").HostStorageEnumType.cast(j.maybeAttrInt("host_storage"));j=j.maybeAttrInt("privacy_mode_ts");k!=null&&l!=null&&j!=null&&(h={actualActors:k,hostStorage:l,privacyModeTs:j})}f||g.push(a.stanzaId);return babelHelpers["extends"]({},a,{type:i.SIMPLE,externalIds:g,participant:c,recipient:e,ts:b.attrTime("t"),biz:h})}g.RECEIPT_TYPES_TO_ACK=h;g.RECEIPT_TYPE=i;g.msgReceiptParser=b}),98);
__d("WAWebWamEnumReceiptAggregationType",[],(function(a,b,c,d,e,f){a=Object.freeze({NONE:0,MULTI_MESSAGES:1,MULTI_PARTICIPANTS:2});f.RECEIPT_AGGREGATION_TYPE=a}),66);
__d("WAWebWamEnumReceiptStanzaStage",[],(function(a,b,c,d,e,f){a=Object.freeze({OVERALL:0,PARSE:1,WAITING_TO_PROCESS:2,PROCESS:3,WAITING_TO_ACK:5,ACK:4});f.RECEIPT_STANZA_STAGE=a}),66);
__d("WAWebReceiptStanzaReceiveWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumMediaType","WAWebWamEnumMessageType","WAWebWamEnumReceiptAggregationType","WAWebWamEnumReceiptStanzaStage"],(function(a,b,c,d,e,f,g){b=(a=d("WAWebWamCodegenUtils")).defineEvents({ReceiptStanzaReceive:[2496,{dbReadsCount:[12,a.TYPES.INTEGER],dbWritesCount:[13,a.TYPES.INTEGER],mediaType:[2,d("WAWebWamEnumMediaType").MEDIA_TYPE],messageType:[10,d("WAWebWamEnumMessageType").MESSAGE_TYPE],receiptAggregation:[11,d("WAWebWamEnumReceiptAggregationType").RECEIPT_AGGREGATION_TYPE],receiptStanzaDuration:[1,a.TYPES.TIMER],receiptStanzaHasOrphaned:[6,a.TYPES.BOOLEAN],receiptStanzaOfflineCount:[3,a.TYPES.INTEGER],receiptStanzaProcessedCount:[8,a.TYPES.INTEGER],receiptStanzaRetryVer:[5,a.TYPES.INTEGER],receiptStanzaStage:[9,d("WAWebWamEnumReceiptStanzaStage").RECEIPT_STANZA_STAGE],receiptStanzaTotalCount:[7,a.TYPES.INTEGER],receiptStanzaType:[4,a.TYPES.STRING]},[1,1,1],"regular"]});g.ReceiptStanzaReceiveWamEvent=b}),98);
__d("WAWebCreateReceiptStanzaReceiveMetric",["WAWebAck","WAWebHandleMsgReceiptParser","WAWebReceiptStanzaReceiveWamEvent","WAWebWamEnumMessageType","WAWebWamEnumReceiptStanzaStage","WAWebWid"],(function(a,b,c,d,e,f,g){function a(){var a=new(d("WAWebReceiptStanzaReceiveWamEvent").ReceiptStanzaReceiveWamEvent)({receiptStanzaStage:d("WAWebWamEnumReceiptStanzaStage").RECEIPT_STANZA_STAGE.OVERALL,receiptStanzaTotalCount:1});return function(b){var c=b.ackString,e=b.from,f=b.offline;b=b.receipts;a.messageType=h(e);if(f!=null){e=parseInt(f,10);Number.isNaN(e)||(a.receiptStanzaOfflineCount=e)}c==null?a.receiptStanzaType=d("WAWebAck").ACK_STRING.DELIVERY:d("WAWebHandleMsgReceiptParser").RECEIPT_TYPES_TO_ACK[c]!=null&&(a.receiptStanzaType=c);(b==null?void 0:b.length)!=null&&(a.receiptStanzaTotalCount=b.length);a.markReceiptStanzaDuration();a.commit()}}function h(a){if(c("WAWebWid").isStatusV3(a))return d("WAWebWamEnumMessageType").MESSAGE_TYPE.STATUS;else if(c("WAWebWid").isGroup(a))return d("WAWebWamEnumMessageType").MESSAGE_TYPE.GROUP;else if(c("WAWebWid").isBroadcast(a))return d("WAWebWamEnumMessageType").MESSAGE_TYPE.BROADCAST;else if(c("WAWebWid").isNewsletter(a))return d("WAWebWamEnumMessageType").MESSAGE_TYPE.CHANNEL;return d("WAWebWamEnumMessageType").MESSAGE_TYPE.INDIVIDUAL}g.createReceiptStanzaReceiveMetric=a}),98);
__d("WAWebHandleAckPeerSimpleReceipt",["WAWebApiPeerMessageStore","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("WAWebApiPeerMessageStore").deletePeerMessage(a.stanzaId)});return h.apply(this,arguments)}g.handleAckPeerSimpleReceipt=a}),98);
__d("WAWebHandleBotInvokeMsgReceipt",["WALogger","WAWebAck","WAWebMessageReceiptBatcher","WAWebMsgKey","WAWebOfflineHandler","WAWebOrchestratorNonPersistedJob","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[unify][batcher] adding receipt ",""]);h=function(){return a};return a}function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.ack,e=a.from,f=a.externalIds,g=a.ts,i=a.ackString,j=a.recipient;a=a.offline;a=a!=null&&!d("WAWebOfflineHandler").OfflineMessageHandler.isResumeFromRestartComplete();if(i!==d("WAWebAck").ACK_STRING.READ||j==null||!e.isBot())throw c("err")("handleBotOneToOneInvokeSimpleReadReceipt: unexpected receipt");i=f.map(function(a){return new(c("WAWebMsgKey"))({id:a,remote:j,fromMe:!0})});f=i.map(function(a){return a.toString()});d("WALogger").DEV(h(),f.join(","));i=d("WAWebMessageReceiptBatcher").receiptBatcher.acceptOtherReceipt({ack:b,ts:g,receiverId:e,msgKeys:f,isBotInvoke:!0});a||(yield d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("receiptBatcherRunActiveBatches",function(){return d("WAWebMessageReceiptBatcher").receiptBatcher.runActiveBatches()}).waitUntilCompleted());return i});return i.apply(this,arguments)}g.handleBotOneToOneInvokeSimpleReadReceipt=a}),98);
__d("WAWebHandleMsgReceiptUtils",["WAWebAck","WAWebHandleMsgReceiptParser"],(function(a,b,c,d,e,f,g){function a(a){return a===d("WAWebAck").ACK_STRING.READ||a===d("WAWebAck").ACK_STRING.READ_SELF||a===d("WAWebAck").ACK_STRING.PLAYED||a===d("WAWebAck").ACK_STRING.PLAYED_SELF}function b(a){return a.receipts.map(function(b){return{type:d("WAWebHandleMsgReceiptParser").RECEIPT_TYPE.SIMPLE,stanzaId:a.externalId,externalIds:[a.externalId],from:a.from,participant:b.participant,recipient:null,ts:b.ts,ack:a.ack,ackString:a.ackString,offline:a.offline,biz:null}})}g.isReadOrPlayedReceipt=a;g.deaggregateReceipt=b}),98);
__d("WAWebHandleDirectChatReceipt",["Promise","WAJids","WALogger","WAWebABProps","WAWebAck","WAWebHandleMsgReceiptCommon","WAWebHandleMsgReceiptUtils","WAWebMessageReceiptBatcher","WAWebMsgKey","WAWebOfflineHandler","WAWebUserPrefsIndexedDBStorage","WAWebUserPrefsKeys","WAWebUserPrefsMeUser","WAWebWid","WAWebWidFactory","asyncToGeneratorRuntime","err","gkx"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[unify][batcher] adding peer receipt ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[unify][batcher] adding receipt ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["error: invalid sender/peer receipt without recipient"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["error: invalid sender/peer receipt without recipient"]);l=function(){return a};return a}function a(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=a.from,f=a.externalIds,g=a.ts,m=a.recipient,n=a.ackString,o=a.offline,p=a.biz;a=a.ack;var q=n===d("WAWebAck").ACK_STRING.SENDER,r=!q&&d("WAWebWidFactory").toUserWid(e).equals(d("WAWebUserPrefsMeUser").getMeUser()),s;if(r||q){if(!m){!c("gkx")("26258")?d("WALogger").WARN(l()).sendLogs("handleChatSimpleReceipt: failed"):d("WALogger").WARN(k());throw c("err")("handleChatSimpleReceipt: invalid sender/peer receipt without recipient")}s=m}else{var t;s=d("WAWebWidFactory").toUserWid(e);t=((t=d("WAWebUserPrefsIndexedDBStorage").userPrefsIdb.get(d("WAWebUserPrefsKeys").HASHED_KEYS.USER_PRIVACY_SETTINGS))==null?void 0:t.readReceipts)==="none";t&&(a===d("WAWebAck").ACK.READ||a===d("WAWebAck").ACK.PLAYED&&d("WAWebABProps").getABPropConfigValue("played_self_enabled"))&&(a=d("WAWebAck").ACK.RECEIVED)}var u;s!=null&&c("WAWebWid").isWid(s)&&s===d("WAWebWidFactory").createWid(d("WAJids").PSA_JID)&&(u=d("WAWebWidFactory").createWid(d("WAJids").PSA_JID));t=f.map(function(a){return new(c("WAWebMsgKey"))({id:a,remote:s,fromMe:!r,participant:u})});r&&a===d("WAWebAck").ACK.PLAYED&&d("WAWebHandleMsgReceiptCommon").handleViewOnceOpenedIfNecessary(t);t=t.map(function(a){return a.toString()});o!=null&&d("WAWebOfflineHandler").OfflineMessageHandler.offlineStanzaReceivedAfterComplete();o=o!=null&&!d("WAWebOfflineHandler").OfflineMessageHandler.isResumeFromRestartComplete();var v=(h||(h=b("Promise"))).resolve();!r?(d("WALogger").DEV(j(),t.join(",")),v=d("WAWebMessageReceiptBatcher").receiptBatcher.acceptOtherReceipt({ack:a,ts:g,receiverId:e,msgKeys:t,privacyMode:p,isSender:q})):m!=null&&d("WAWebHandleMsgReceiptUtils").isReadOrPlayedReceipt(n)&&f.length>0&&(d("WALogger").DEV(i(),t.join(",")),v=d("WAWebMessageReceiptBatcher").receiptBatcher.acceptPeerReceipt({ack:a,ts:g,msgKeys:t,isOffline:o,remote:s}));o||d("WAWebMessageReceiptBatcher").receiptBatcher.runActiveBatches();return v});return m.apply(this,arguments)}g.handleChatSimpleReceipt=a}),98);
__d("WAWebHandleGroupChatReceipt",["WALogger","WAWebABProps","WAWebAck","WAWebHandleMsgReceiptCommon","WAWebHandleMsgReceiptUtils","WAWebMessageReceiptBatcher","WAWebMsgKey","WAWebOfflineHandler","WAWebOrchestratorNonPersistedJob","WAWebUserPrefsMeUser","WAWebWidFactory","asyncToGeneratorRuntime","err","gkx"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[unify][batcher] adding peer receipt ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[unify][batcher] adding receipt ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["error: invalid sender/peer receipt without recipient"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["error: invalid sender/peer receipt without recipient"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["error: got group ack without participant."]);l=function(){return a};return a}function a(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.ack,e=a.from,f=a.externalIds,g=a.ts,m=a.ackString,n=a.participant,o=a.recipient;a=a.offline;if(!n){d("WALogger").ERROR(l()).sendLogs("handleGroupSimpleReceipt: failed");throw c("err")("handleGroupSimpleReceipt: got group ack without participant.")}var p=d("WAWebUserPrefsMeUser").getMeUser(),q=d("WAWebWidFactory").toUserWid(n),r=m===d("WAWebAck").ACK_STRING.SENDER,s=!r&&q.equals(p),t;if(s){if(!o){!c("gkx")("26258")?d("WALogger").WARN(k()).sendLogs("handleGroupSimpleReceipt: failed"):d("WALogger").WARN(j());throw c("err")("handleGroupSimpleReceipt: invalid sender/peer receipt without recipient")}t=o}else t=p;r=f.map(function(a){return new(c("WAWebMsgKey"))({id:a,remote:e,fromMe:!s,participant:t})});s&&b===d("WAWebAck").ACK.PLAYED&&d("WAWebHandleMsgReceiptCommon").handleViewOnceOpenedIfNecessary(r);q=r.map(function(a){return a.toString()});a!=null&&d("WAWebOfflineHandler").OfflineMessageHandler.offlineStanzaReceivedAfterComplete();p=a!=null&&!d("WAWebOfflineHandler").OfflineMessageHandler.isResumeFromRestartComplete();var u;!s?(d("WALogger").DEV(i(),q.join(",")),u=d("WAWebMessageReceiptBatcher").receiptBatcher.acceptOtherReceipt({ack:b,ts:g,receiverId:n,msgKeys:q})):o!=null&&d("WAWebHandleMsgReceiptUtils").isReadOrPlayedReceipt(m)&&f.length>0&&(d("WALogger").DEV(h(),q.join(",")),u=d("WAWebMessageReceiptBatcher").receiptBatcher.acceptPeerReceipt({isOffline:p,ack:b,ts:g,msgKeys:q,remote:e}));!p&&!d("WAWebABProps").getABPropConfigValue("web_batch_online_read_receipts_enabled")&&(yield d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("receiptBatcherRunActiveBatches",function(){return d("WAWebMessageReceiptBatcher").receiptBatcher.runActiveBatches()}).waitUntilCompleted());return u});return m.apply(this,arguments)}g.handleGroupSimpleReceipt=a}),98);
__d("WAWebHandleNewsletterReceipt",["WAAckLevel","WALogger","WAWebAck","WAWebHandleMsgReceiptCommon","WAWebMessageReceiptBatcher","WAWebMsgKey","WAWebOfflineHandler","WAWebUserPrefsMeUser","WAWebWidFactory","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["","  online, updating the UI"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose([""," only peer receipts are accepted"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose([""," ACK should be READ or PLAYED, "," received instead"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose([""," handling newsletter receipt"]);k=function(){return a};return a}function a(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.ack,e=a.from,f=a.externalIds,g=a.ts,l=a.ackString,m=a.participant,n=a.offline,o=a.stanzaId;o="[receipt][newsletter]["+o+"]";d("WALogger").DEV(k(),o).devConsole(a);if(l==="view")return d("WAWebHandleMsgReceiptCommon").updateMsgViewed(f.map(function(a){return parseInt(a,10)}),e);if(b!==d("WAAckLevel").ACK.READ&&b!==d("WAAckLevel").ACK.PLAYED){d("WALogger").WARN(j(),o,b);throw c("err")("handleNewsletterSimpleReceipt: only READ/PLAYED ack for newsletters")}a=(l===d("WAWebAck").ACK_STRING.READ_SELF||l===d("WAWebAck").ACK_STRING.PLAYED_SELF)&&m!=null&&d("WAWebWidFactory").toUserWid(m).equals(d("WAWebUserPrefsMeUser").getMeUser());if(!a){d("WALogger").WARN(i(),o).devConsole(m);throw c("err")("handleNewsletterSimpleReceipt: only peer receipts for newsletters")}l=f.map(function(a){return new(c("WAWebMsgKey"))({id:a,remote:e,fromMe:!1})});a=l.map(function(a){return a.toString()});n!=null&&d("WAWebOfflineHandler").OfflineMessageHandler.offlineStanzaReceivedAfterComplete();m=n!=null&&!d("WAWebOfflineHandler").OfflineMessageHandler.isResumeFromRestartComplete();f=d("WAWebMessageReceiptBatcher").receiptBatcher.acceptPeerReceipt({isOffline:m,ack:b,ts:g,remote:e,msgKeys:a});m||(d("WALogger").DEV(h(),o),yield d("WAWebMessageReceiptBatcher").receiptBatcher.runActiveBatches());return f});return l.apply(this,arguments)}g.handleNewsletterSimpleReceipt=a}),98);
__d("WAWebHandleStatusReceipt",["Promise","WAJids","WALogger","WAWebAck","WAWebMessageReceiptBatcher","WAWebMsgKey","WAWebOfflineHandler","WAWebUserPrefsIndexedDBStorage","WAWebUserPrefsKeys","WAWebUserPrefsMeUser","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[unify][batcher] adding (",") receipt ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[unify][batcher] adding (",") status peer receipt ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["error: got status ack without participant"]);k=function(){return a};return a}function a(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e,f=a.externalIds,g=a.ts,l=a.ackString,m=a.ack,n=a.participant,o=a.recipient;a=a.offline;f=f[0];if(!n){d("WALogger").ERROR(k()).sendLogs("handleStatusSimpleReceipt: failed");return}var p=d("WAWebUserPrefsMeUser").getMeUser();n=d("WAWebWidFactory").toUserWid(n);var q=n.equals(p);e=((e=d("WAWebUserPrefsIndexedDBStorage").userPrefsIdb.get(d("WAWebUserPrefsKeys").HASHED_KEYS.USER_PRIVACY_SETTINGS))==null?void 0:e.readReceipts)==="none";if(!q&&(e||l!==d("WAWebAck").ACK_STRING.READ))return;e=d("WAWebWidFactory").createWid(d("WAJids").STATUS_JID);f=new(c("WAWebMsgKey"))({id:f,remote:e,fromMe:!q,participant:(l=o)!=null?l:p});o=[f.toString()];l=a!=null&&!d("WAWebOfflineHandler").OfflineMessageHandler.isResumeFromRestartComplete();p=(h||(h=b("Promise"))).resolve();q?(d("WALogger").DEV(j(),l?"offline":"online",o.join(",")),p=d("WAWebMessageReceiptBatcher").receiptBatcher.acceptPeerReceipt({ts:g,msgKeys:o,ack:m,isOffline:l,remote:e})):(d("WALogger").DEV(i(),l?"offline":"online",o.join(",")),p=d("WAWebMessageReceiptBatcher").receiptBatcher.acceptOtherReceipt({ack:m,ts:g,receiverId:n,msgKeys:o}));l||d("WAWebMessageReceiptBatcher").receiptBatcher.runActiveBatches();return p});return l.apply(this,arguments)}g.handleStatusSimpleReceipt=a}),98);
__d("WAWebReceiptAck",["WAWap","WAWebCommsWapMd"],(function(a,b,c,d,e,f,g){function a(a,b,c,e){return d("WAWap").wap("ack",{to:d("WAWebCommsWapMd").JID(a),id:d("WAWap").CUSTOM_STRING(b),"class":"receipt",type:d("WAWap").MAYBE_CUSTOM_STRING(c),participant:e&&e!==a?d("WAWebCommsWapMd").DEVICE_JID(e):d("WAWap").DROP_ATTR})}g.buildReceiptAck=a}),98);
__d("WAWebHandleMsgReceipt",["Promise","WALogger","WAWebAck","WAWebCreateReceiptStanzaReceiveMetric","WAWebHandleAckPeerSimpleReceipt","WAWebHandleBotInvokeMsgReceipt","WAWebHandleDirectChatReceipt","WAWebHandleGroupChatReceipt","WAWebHandleMsgReceiptParser","WAWebHandleMsgReceiptUtils","WAWebHandleNewsletterReceipt","WAWebHandleStatusReceipt","WAWebNewsletterGatingUtils","WAWebReceiptAck","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["type: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleAggregateReceipt: got "," receipts of ack type "," for msg ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleSimpleReceipt: got error for receipt "," for msg ",": ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleSimpleReceipt: got receipt "," for msg ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Parsing Error: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["error while parsing: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleAggregateReceipt: aggregate receipts should come only from group, broadcast"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["error: reupload receipts cannot be aggregated"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["error: unsupported type for ",""]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["error: missing participant for broadcast receipt ",""]);r=function(){return a};return a}function a(a){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=d("WAWebCreateReceiptStanzaReceiveMetric").createReceiptStanzaReceiveMetric(),c=d("WAWebHandleMsgReceiptParser").msgReceiptParser.parse(a);if(c.error){d("WALogger").DEV(n(),a.toString());d("WALogger").ERROR(m(),c.error.toString());throw c.error}a=c.success;c=a.ack;var e=a.ackString,f=a.from,g=a.stanzaId,h=a.offline;if(a.type===d("WAWebHandleMsgReceiptParser").RECEIPT_TYPE.SIMPLE)if(c===d("WAWebAck").ACK.CONTENT_GONE)c=d("WAWebReceiptAck").buildReceiptAck(f,g,e,null);else{try{d("WALogger").LOG(l(),a.ack,a.stanzaId),yield t(a)}catch(b){d("WALogger").WARN(k(),a.ack,a.stanzaId,b).tags("messaging")}c=d("WAWebReceiptAck").buildReceiptAck(f,g,e,a.participant)}else if(a.type===d("WAWebHandleMsgReceiptParser").RECEIPT_TYPE.AGGREGATE){try{d("WALogger").LOG(j(),a.receipts.length,a.ack,a.externalId),yield u(a)}catch(a){}c=d("WAWebReceiptAck").buildReceiptAck(f,g,e,null)}else d("WALogger").ERROR(i(),a.type).sendLogs("handleMsgReceipt: Invalid receipt type"),c=d("WAWebReceiptAck").buildReceiptAck(f,g,e,null);h==null&&b(a);return c});return s.apply(this,arguments)}function t(a){var e=a.from,f=a.ack,g=a.recipient,i=a.ackString;if(f===d("WAWebAck").ACK.PEER)return d("WAWebHandleAckPeerSimpleReceipt").handleAckPeerSimpleReceipt(a);if(e.isNewsletter())return!d("WAWebNewsletterGatingUtils").isNewsletterEnabled()?(h||(h=b("Promise"))).resolve():d("WAWebHandleNewsletterReceipt").handleNewsletterSimpleReceipt(a);else if(e.isBot()&&g!=null&&i===d("WAWebAck").ACK_STRING.READ)return d("WAWebHandleBotInvokeMsgReceipt").handleBotOneToOneInvokeSimpleReadReceipt(a);else if(e.isStatusV3())return d("WAWebHandleStatusReceipt").handleStatusSimpleReceipt(a);else if(e.isUser())return d("WAWebHandleDirectChatReceipt").handleChatSimpleReceipt(a);else if(e.isGroup())return d("WAWebHandleGroupChatReceipt").handleGroupSimpleReceipt(a);else if(e.isBroadcast()){if(!a.participant){d("WALogger").ERROR(r(),e.toString()).sendLogs("handleSimpleReceipt: failed");return(h||(h=b("Promise"))).reject(c("err")("handleSimpleReceipt: missing participant for broadcast receipt "+e.toString()))}f=babelHelpers["extends"]({},a,{from:a.participant,participant:null});return d("WAWebHandleDirectChatReceipt").handleChatSimpleReceipt(f)}d("WALogger").ERROR(q(),e.toString()).sendLogs("handleSimpleReceipt: failed");return(h||(h=b("Promise"))).reject(c("err")("handleSimpleReceipt: unsupported type for "+e.toString()))}function u(a){var e=a.ack,f=a.from;if(e===d("WAWebAck").ACK.CONTENT_GONE){d("WALogger").ERROR(p()).sendLogs("handleAggregateReceipt: failed");return(h||(h=b("Promise"))).reject(c("err")("handleAggregateReceipt: failed"))}if(!f.isGroup()&&!f.isBroadcast()){d("WALogger").ERROR(o()).sendLogs("handleAggregateReceipt: failed");return(h||(h=b("Promise"))).reject(c("err")("handleAggregateReceipt: failed"))}return(h||(h=b("Promise"))).all(d("WAWebHandleMsgReceiptUtils").deaggregateReceipt(a).map(t))}g["default"]=a}),98);
__d("WAWebHandleNewsletterMsgAddOns",["Promise","WAAckLevel","WAWebBackendApi","WAWebCRUDOperationsNewsletterMyVotes","WAWebDBCreateOrUpdateReactions","WAWebNewsletterDBUtils","WAWebNewsletterPollsVotesUtils","WAWebUserPrefsMeUser","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function a(a,c){switch(a.type){case"reaction":return i(a);case"poll_update":return k(a,c);default:return(h||(h=b("Promise"))).resolve()}}function i(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.reactionText,c=a.id,e=a.serverId,f=a.from;a=a.t;if(e==null||a==null||f==null||b==null)return;c={msgKey:c.toString(),parentMsgKey:d("WAWebNewsletterDBUtils").craftNewsletterMsgKeyFromServerId(e,f).toString(),senderUserJid:d("WAWebUserPrefsMeUser").getMeUser().toString(),reactionText:b,timestamp:a*1e3,orphan:0,read:!0,ack:d("WAAckLevel").ACK.SENT};yield d("WAWebDBCreateOrUpdateReactions").createOrUpdateReactions([c]);b=(yield d("WAWebNewsletterDBUtils").getMessageByServerId(e,f.toJid()));b!=null&&(yield d("WAWebBackendApi").frontendFireAndForget("updateChatPreviewFromReaction",{reactionMsgObj:c,parentMsgKey:b.id}))});return j.apply(this,arguments)}function k(a,b){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=a.id,e=a.serverId,f=a.from,g=a.t,h=a.selectedOptionLocalIds;b=b.pollVotes;if(e==null||g==null||f==null||b==null)return;c={chatJid:c.remote.toJid(),msgServerId:e,msgKey:a.id.toString(),serverTimestampMs:g*1e3,t:g,votes:b.map(d("WAWebNewsletterPollsVotesUtils").bufferToHex)};yield d("WAWebCRUDOperationsNewsletterMyVotes").createOrUpdateMyVote(c);b=(yield d("WAWebNewsletterDBUtils").getMessageByServerId(e,f.toJid()));if(b!=null){yield d("WAWebBackendApi").frontendFireAndForget("updateChatPreviewFromVote",{voteMsgObj:{ack:d("WAAckLevel").ACK.SENT,read:!0,msgKey:a.id,parentMsgKey:b.id,selectedOptionLocalIds:(c=h)!=null?c:[],sender:d("WAWebUserPrefsMeUser").getMeUser(),senderTimestampMs:g*1e3,t:g},parentMsgKey:b.id})}});return l.apply(this,arguments)}g.maybeHandleNewsletterMsgAddOns=a}),98);
__d("WASmaxInMessageDeliverAdminEditMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"message");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"edit","3");return!b.success?b:d("WAResultOrError").makeResult({edit:b.value})}g.parseAdminEditMixin=a}),98);
__d("WASmaxInMessageDeliverContentTypeMediaMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"message");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","media");return!b.success?b:d("WAResultOrError").makeResult({type:b.value})}g.parseContentTypeMediaMixin=a}),98);
__d("WASmaxInMessageDeliverEnums",["WAJids"],(function(a,b,c,d,e,f,g){a={0:"0",1:"1"};b={1:"1",2:"2"};c={1:"1",3:"3"};e={ACCEPT:"ACCEPT",REJECT:"REJECT",UNKNOWN:"UNKNOWN"};f={address_message:"address_message",form_message:"form_message",galaxy_message:"galaxy_message",menu_options:"menu_options"};var h={address_message:"address_message",galaxy_message:"galaxy_message"},i={allowlist:"allowlist",contacts:"contacts",denylist:"denylist"},j={allow:"allow",bypass:"bypass",deny:"deny",error:"error"},k={ASPRESENTED:"ASPRESENTED",BIMONTHLY:"BIMONTHLY",DAILY:"DAILY",FORTNIGHTLY:"FORTNIGHTLY",HALFYEARLY:"HALFYEARLY",MONTHLY:"MONTHLY",ONETIME:"ONETIME",QUARTERLY:"QUARTERLY",UNKNOWN:"UNKNOWN",WEEKLY:"WEEKLY",YEARLY:"YEARLY"},l={audio:"audio",avatar_sticker:"avatar_sticker",buttons_response:"buttons_response",cataloglink:"cataloglink",contact:"contact",contact_array:"contact_array",document:"document",genai_sticker:"genai_sticker",gif:"gif",history:"history",image:"image",list_response:"list_response",location:"location",native_flow_response:"native_flow_response",order:"order",product:"product",productlink:"productlink",ptt:"ptt",ptv:"ptv",sticker:"sticker",url:"url",vcard:"vcard",video:"video",xma:"xma"},m={audio:"audio",avatar_sticker:"avatar_sticker",buttons_response:"buttons_response",cataloglink:"cataloglink",contact:"contact",contact_array:"contact_array",document:"document",gif:"gif",history:"history",image:"image",list_response:"list_response",location:"location",native_flow_response:"native_flow_response",order:"order",product:"product",productlink:"productlink",ptt:"ptt",ptv:"ptv",sticker:"sticker",url:"url",vcard:"vcard",video:"video",xma:"xma"},n={audio:"audio",avatar_sticker:"avatar_sticker",cataloglink:"cataloglink",document:"document",genai_sticker:"genai_sticker",gif:"gif",image:"image",productlink:"productlink",ptt:"ptt",sticker:"sticker",url:"url",vcard:"vcard",video:"video"},o={buyer:"buyer",seller:"seller"},p={card:"card","net-banking":"net-banking",upi:"upi",wallet:"wallet"},q={catalog_message:"catalog_message",laneline_call:"laneline_call",menu_options:"menu_options",novi_complete_transaction:"novi_complete_transaction",novi_hub:"novi_hub",novi_login:"novi_login",novi_report_transaction:"novi_report_transaction",novi_view_bank_detail:"novi_view_bank_detail",novi_view_card_detail:"novi_view_card_detail",novi_view_code:"novi_view_code",novi_view_transaction:"novi_view_transaction",order_details:"order_details",order_status:"order_status",otp:"otp",payment_method:"payment_method",payment_status:"payment_status",voice_call:"voice_call"},r={creation:"creation",edit:"edit"},s={creation:"creation",edit:"edit",response:"response"},t={ctwa:"ctwa",username:"username"},u={EXACT:"EXACT",MAX:"MAX"},v={FAILURE:"FAILURE",INIT:"INIT",SUCCESS:"SUCCESS"},w={"false":"false","true":"true"},x={FBPAY:"FBPAY",NOVI:"NOVI",P2M_LITE:"P2M_LITE",UPI:"UPI"},y={first:"first",full:"full",inner:"inner",last:"last"},z={FULL:"FULL",MISSING_FIELD_NOT_PARTIAL:"MISSING_FIELD_NOT_PARTIAL",PARTIAL:"PARTIAL"},A={high:"high",high_force:"high_force",low:"low"},B={high:"high",low:"low",unknown:"unknown"},C={HPP_PAYMENT_LINK:"HPP_PAYMENT_LINK",UPI:"UPI"},D={incentive:"incentive",p2m:"p2m",p2p:"p2p",payout:"payout"},E={lid:"lid",pn:"pn"},F={matched:"matched",unmatched:"unmatched"},G={msg:"msg",pkmsg:"pkmsg"},H={request:"request",send:"send"},I={validators:[(d=d("WAJids")).validateDeviceJid,d.validateBroadcastJid,d.validateDeviceJid,d.validateGroupJid,d.validateStatusJid],typeName:"DeviceJid|BroadcastJid|DeviceJid|GroupJid|StatusJid"},J={validators:[d.validateDeviceJid,d.validateDeviceJid],typeName:"DeviceJid|DeviceJid"},K={validators:[d.validateDeviceJid,d.validateDeviceJid,d.validateDeviceJid],typeName:"DeviceJid|DeviceJid|DeviceJid"};d={validators:[d.validateGroupJid,d.validateUserJid],typeName:"GroupJid|UserJid"};g.ENUM_0_1=a;g.ENUM_1_2=b;g.ENUM_1_3=c;g.ENUM_ACCEPT_REJECT_UNKNOWN=e;g.ENUM_ADDRESSMESSAGE_FORMMESSAGE_GALAXYMESSAGE_MENUOPTIONS=f;g.ENUM_ADDRESSMESSAGE_GALAXYMESSAGE=h;g.ENUM_ALLOWLIST_CONTACTS_DENYLIST=i;g.ENUM_ALLOW_BYPASS_DENY_ERROR=j;g.ENUM_ASPRESENTED_BIMONTHLY_DAILY_FORTNIGHTLY_HALFYEARLY_MONTHLY_ONETIME_QUARTERLY_UNKNOWN_WEEKLY_YEARLY=k;g.ENUM_AUDIO_AVATARSTICKER_BUTTONSRESPONSE_CATALOGLINK_CONTACT_CONTACTARRAY_DOCUMENT_GENAISTICKER_GIF_HISTORY_IMAGE_LISTRESPONSE_LOCATION_NATIVEFLOWRESPONSE_ORDER_PRODUCT_PRODUCTLINK_PTT_PTV_STICKER_URL_VCARD_VIDEO_XMA=l;g.ENUM_AUDIO_AVATARSTICKER_BUTTONSRESPONSE_CATALOGLINK_CONTACT_CONTACTARRAY_DOCUMENT_GIF_HISTORY_IMAGE_LISTRESPONSE_LOCATION_NATIVEFLOWRESPONSE_ORDER_PRODUCT_PRODUCTLINK_PTT_PTV_STICKER_URL_VCARD_VIDEO_XMA=m;g.ENUM_AUDIO_AVATARSTICKER_CATALOGLINK_DOCUMENT_GENAISTICKER_GIF_IMAGE_PRODUCTLINK_PTT_STICKER_URL_VCARD_VIDEO=n;g.ENUM_BUYER_SELLER=o;g.ENUM_CARD_NETBANKING_UPI_WALLET=p;g.ENUM_CATALOGMESSAGE_LANELINECALL_MENUOPTIONS_NOVICOMPLETETRANSACTION_NOVIHUB_NOVILOGIN_NOVIREPORTTRANSACTION_NOVIVIEWBANKDETAIL_NOVIVIEWCARDDETAIL_NOVIVIEWCODE_NOVIVIEWTRANSACTION_ORDERDETAILS_ORDERSTATUS_OTP_PAYMENTMETHOD_PAYMENTSTATUS_VOICECALL=q;g.ENUM_CREATION_EDIT=r;g.ENUM_CREATION_EDIT_RESPONSE=s;g.ENUM_CTWA_USERNAME=t;g.ENUM_EXACT_MAX=u;g.ENUM_FAILURE_INIT_SUCCESS=v;g.ENUM_FALSE_TRUE=w;g.ENUM_FBPAY_NOVI_P2MLITE_UPI=x;g.ENUM_FIRST_FULL_INNER_LAST=y;g.ENUM_FULL_MISSINGFIELDNOTPARTIAL_PARTIAL=z;g.ENUM_HIGH_HIGHFORCE_LOW=A;g.ENUM_HIGH_LOW_UNKNOWN=B;g.ENUM_HPPPAYMENTLINK_UPI=C;g.ENUM_INCENTIVE_P2M_P2P_PAYOUT=D;g.ENUM_LID_PN=E;g.ENUM_MATCHED_UNMATCHED=F;g.ENUM_MSG_PKMSG=G;g.ENUM_REQUEST_SEND=H;g.DEVICEJID_BROADCASTJID_DEVICEJID_GROUPJID_STATUSJID=I;g.DEVICEJID_DEVICEJID=J;g.DEVICEJID_DEVICEJID_DEVICEJID=K;g.GROUPJID_USERJID=d}),98);
__d("WASmaxInMessageDeliverPayloadMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"plaintext");if(!b.success)return b;b=d("WASmaxParseUtils").contentBytesRange(a,1,1048576);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}g.parsePayloadMixin=a}),98);
__d("WASmaxInMessageDeliverNewsletterMediaMixin",["WAResultOrError","WASmaxInMessageDeliverContentTypeMediaMixin","WASmaxInMessageDeliverEnums","WASmaxInMessageDeliverPayloadMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"message");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"plaintext");if(!b.success)return b;var c=d("WASmaxParseUtils").attrStringEnum(b.value,"mediatype",d("WASmaxInMessageDeliverEnums").ENUM_AUDIO_AVATARSTICKER_CATALOGLINK_DOCUMENT_GENAISTICKER_GIF_IMAGE_PRODUCTLINK_PTT_STICKER_URL_VCARD_VIDEO);if(!c.success)return c;b=d("WASmaxInMessageDeliverPayloadMixin").parsePayloadMixin(b.value);if(!b.success)return b;a=d("WASmaxInMessageDeliverContentTypeMediaMixin").parseContentTypeMediaMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({plaintextMediatype:c.value,plaintextPayloadMixin:b.value},a.value))}g.parseNewsletterMediaMixin=a}),98);
__d("WASmaxInMessageDeliverContentTypeTextMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"message");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","text");return!b.success?b:d("WAResultOrError").makeResult({type:b.value})}g.parseContentTypeTextMixin=a}),98);
__d("WASmaxInMessageDeliverNewsletterTextMixin",["WAResultOrError","WASmaxInMessageDeliverContentTypeTextMixin","WASmaxInMessageDeliverPayloadMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"message");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"plaintext");if(!b.success)return b;b=d("WASmaxInMessageDeliverPayloadMixin").parsePayloadMixin(b.value);if(!b.success)return b;a=d("WASmaxInMessageDeliverContentTypeTextMixin").parseContentTypeTextMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({plaintextPayloadMixin:b.value},a.value))}g.parseNewsletterTextMixin=a}),98);
__d("WASmaxInMessageDeliverNewsletterTextOrMediaMixinGroup",["WAResultOrError","WASmaxInMessageDeliverNewsletterMediaMixin","WASmaxInMessageDeliverNewsletterTextMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInMessageDeliverNewsletterTextMixin").parseNewsletterTextMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"NewsletterText",value:b.value});var c=d("WASmaxInMessageDeliverNewsletterMediaMixin").parseNewsletterMediaMixin(a);return c.success?d("WAResultOrError").makeResult({name:"NewsletterMedia",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["NewsletterText","NewsletterMedia"],[b,c])}g.parseNewsletterTextOrMediaMixinGroup=a}),98);
__d("WASmaxInMessageDeliverNewsletterEditMixin",["WAResultOrError","WASmaxInMessageDeliverAdminEditMixin","WASmaxInMessageDeliverNewsletterTextOrMediaMixinGroup","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"message");if(!b.success)return b;b=d("WASmaxInMessageDeliverAdminEditMixin").parseAdminEditMixin(a);if(!b.success)return b;a=d("WASmaxInMessageDeliverNewsletterTextOrMediaMixinGroup").parseNewsletterTextOrMediaMixinGroup(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({},b.value,{newsletterTextOrMediaMixinGroup:a.value}))}g.parseNewsletterEditMixin=a}),98);
__d("WASmaxInMessageDeliverContentTypePollCreationMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"message");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"meta");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","poll");if(!a.success)return a;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,b.value,"polltype","creation");return!b.success?b:d("WAResultOrError").makeResult({type:a.value,metaPolltype:b.value})}g.parseContentTypePollCreationMixin=a}),98);
__d("WASmaxInMessageDeliverNewsletterPollCreationMixin",["WAResultOrError","WASmaxInMessageDeliverContentTypePollCreationMixin","WASmaxInMessageDeliverPayloadMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"message");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"plaintext");if(!b.success)return b;b=d("WASmaxInMessageDeliverPayloadMixin").parsePayloadMixin(b.value);if(!b.success)return b;a=d("WASmaxInMessageDeliverContentTypePollCreationMixin").parseContentTypePollCreationMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({plaintextPayloadMixin:b.value},a.value))}g.parseNewsletterPollCreationMixin=a}),98);
__d("WASmaxInMessageDeliverContentTypePollVoteMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"message");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"meta");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","poll");if(!a.success)return a;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,b.value,"polltype","vote");return!b.success?b:d("WAResultOrError").makeResult({type:a.value,metaPolltype:b.value})}g.parseContentTypePollVoteMixin=a}),98);
__d("WASmaxInMessageDeliverNewsletterPollVoteMixin",["WAResultOrError","WASmaxInMessageDeliverContentTypePollVoteMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"vote");if(!b.success)return b;b=d("WASmaxParseUtils").contentBytesRange(a,32,32);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}function a(a){var b=d("WASmaxParseUtils").assertTag(a,"message");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"votes");if(!b.success)return b;a=d("WASmaxInMessageDeliverContentTypePollVoteMixin").parseContentTypePollVoteMixin(a);if(!a.success)return a;b=d("WASmaxParseUtils").mapChildrenWithTag(b.value,"vote",0,1e3,h);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{votesVote:b.value}))}g.parseNewsletterPollVoteVotesVote=h;g.parseNewsletterPollVoteMixin=a}),98);
__d("WASmaxInMessageDeliverContentTypeReactionMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"message");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","reaction");return!b.success?b:d("WAResultOrError").makeResult({type:b.value})}g.parseContentTypeReactionMixin=a}),98);
__d("WASmaxInMessageDeliverNewsletterReactionMixin",["WAResultOrError","WASmaxInMessageDeliverContentTypeReactionMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"message");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"reaction");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(b.value,"code");if(!b.success)return b;a=d("WASmaxInMessageDeliverContentTypeReactionMixin").parseContentTypeReactionMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({reactionCode:b.value},a.value))}g.parseNewsletterReactionMixin=a}),98);
__d("WASmaxInMessageDeliverRevokeMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"message");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"edit","7");return!b.success?b:d("WAResultOrError").makeResult({edit:b.value})}g.parseRevokeMixin=a}),98);
__d("WASmaxInMessageDeliverNewsletterReactionRevokeMixin",["WAResultOrError","WASmaxInMessageDeliverContentTypeReactionMixin","WASmaxInMessageDeliverRevokeMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"message");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"reaction");if(!b.success)return b;b=d("WASmaxInMessageDeliverRevokeMixin").parseRevokeMixin(a);if(!b.success)return b;a=d("WASmaxInMessageDeliverContentTypeReactionMixin").parseContentTypeReactionMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({},b.value,a.value))}g.parseNewsletterReactionRevokeMixin=a}),98);
__d("WASmaxInMessageDeliverAdminRevokeMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"message");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"edit","8");return!b.success?b:d("WAResultOrError").makeResult({edit:b.value})}g.parseAdminRevokeMixin=a}),98);
__d("WASmaxInMessageDeliverNewsletterRevokeMixin",["WAResultOrError","WASmaxInMessageDeliverAdminRevokeMixin","WASmaxInMessageDeliverContentTypeTextMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"message");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"plaintext");if(!b.success)return b;b=d("WASmaxInMessageDeliverAdminRevokeMixin").parseAdminRevokeMixin(a);if(!b.success)return b;a=d("WASmaxInMessageDeliverContentTypeTextMixin").parseContentTypeTextMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({},b.value,a.value))}g.parseNewsletterRevokeMixin=a}),98);
__d("WASmaxInMessageDeliverNewsletterMessageFanoutContent",["WAResultOrError","WASmaxInMessageDeliverNewsletterEditMixin","WASmaxInMessageDeliverNewsletterMediaMixin","WASmaxInMessageDeliverNewsletterPollCreationMixin","WASmaxInMessageDeliverNewsletterPollVoteMixin","WASmaxInMessageDeliverNewsletterReactionMixin","WASmaxInMessageDeliverNewsletterReactionRevokeMixin","WASmaxInMessageDeliverNewsletterRevokeMixin","WASmaxInMessageDeliverNewsletterTextMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInMessageDeliverNewsletterEditMixin").parseNewsletterEditMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"NewsletterEdit",value:b.value});var c=d("WASmaxInMessageDeliverNewsletterRevokeMixin").parseNewsletterRevokeMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"NewsletterRevoke",value:c.value});var e=d("WASmaxInMessageDeliverNewsletterTextMixin").parseNewsletterTextMixin(a);if(e.success)return d("WAResultOrError").makeResult({name:"NewsletterText",value:e.value});var f=d("WASmaxInMessageDeliverNewsletterMediaMixin").parseNewsletterMediaMixin(a);if(f.success)return d("WAResultOrError").makeResult({name:"NewsletterMedia",value:f.value});var g=d("WASmaxInMessageDeliverNewsletterReactionMixin").parseNewsletterReactionMixin(a);if(g.success)return d("WAResultOrError").makeResult({name:"NewsletterReaction",value:g.value});var h=d("WASmaxInMessageDeliverNewsletterReactionRevokeMixin").parseNewsletterReactionRevokeMixin(a);if(h.success)return d("WAResultOrError").makeResult({name:"NewsletterReactionRevoke",value:h.value});var i=d("WASmaxInMessageDeliverNewsletterPollCreationMixin").parseNewsletterPollCreationMixin(a);if(i.success)return d("WAResultOrError").makeResult({name:"NewsletterPollCreation",value:i.value});var j=d("WASmaxInMessageDeliverNewsletterPollVoteMixin").parseNewsletterPollVoteMixin(a);return j.success?d("WAResultOrError").makeResult({name:"NewsletterPollVote",value:j.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["NewsletterEdit","NewsletterRevoke","NewsletterText","NewsletterMedia","NewsletterReaction","NewsletterReactionRevoke","NewsletterPollCreation","NewsletterPollVote"],[b,c,e,f,g,h,i,j])}g.parseNewsletterMessageFanoutContent=a}),98);
__d("WASmaxInMessageDeliverNewsletterMessageLastEditTimestampMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"message");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"meta");if(!b.success)return b;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,b.value,"msg_edit_t",0,void 0);return!a.success?a:d("WAResultOrError").makeResult({metaMsgEditT:a.value})}g.parseNewsletterMessageLastEditTimestampMixin=a}),98);
__d("WASmaxInMessageDeliverNewsletterMessageOriginalTimestampMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"message");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"meta");if(!b.success)return b;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,b.value,"original_msg_t",0,void 0);return!a.success?a:d("WAResultOrError").makeResult({metaOriginalMsgT:a.value})}g.parseNewsletterMessageOriginalTimestampMixin=a}),98);
__d("WASmaxInMessageDeliverNewsletterMessageFanoutMixin",["WAResultOrError","WASmaxInMessageDeliverNewsletterMessageFanoutContent","WASmaxInMessageDeliverNewsletterMessageLastEditTimestampMixin","WASmaxInMessageDeliverNewsletterMessageOriginalTimestampMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"message");if(!b.success)return b;b=d("WASmaxParseUtils").attrStanzaId(a,"id");if(!b.success)return b;var c=d("WASmaxParseUtils").attrIntRange(a,"server_id",99,2147476647);if(!c.success)return c;var e=d("WASmaxParseUtils").attrIntRange(a,"t",0,void 0);if(!e.success)return e;var f=d("WASmaxParseUtils").optionalLiteral(d("WASmaxParseUtils").attrString,a,"is_sender","true");if(!f.success)return f;var g=d("WASmaxInMessageDeliverNewsletterMessageOriginalTimestampMixin").parseNewsletterMessageOriginalTimestampMixin(a),h=d("WASmaxInMessageDeliverNewsletterMessageLastEditTimestampMixin").parseNewsletterMessageLastEditTimestampMixin(a);a=d("WASmaxInMessageDeliverNewsletterMessageFanoutContent").parseNewsletterMessageFanoutContent(a);return!a.success?a:d("WAResultOrError").makeResult({id:b.value,serverId:c.value,t:e.value,isSender:f.value,newsletterMessageOriginalTimestampMixin:g.success?g.value:null,newsletterMessageLastEditTimestampMixin:h.success?h.value:null,newsletterMessageFanoutContent:a.value})}g.parseNewsletterMessageFanoutMixin=a}),98);
__d("WASmaxInMessageDeliverOfflineMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").attrIntRange(a,"offline",0,12);return!a.success?a:d("WAResultOrError").makeResult({offline:a.value})}g.parseOfflineMixin=a}),98);
__d("WASmaxInMessageDeliverNewsletterMessageWithJIDMixin",["WAResultOrError","WASmaxInMessageDeliverNewsletterMessageFanoutMixin","WASmaxInMessageDeliverOfflineMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"message");if(!b.success)return b;b=d("WASmaxParseJid").attrNewsletterJid(a,"from");if(!b.success)return b;var c=d("WASmaxInMessageDeliverNewsletterMessageFanoutMixin").parseNewsletterMessageFanoutMixin(a);if(!c.success)return c;a=d("WASmaxInMessageDeliverOfflineMixin").parseOfflineMixin(a);return d("WAResultOrError").makeResult(babelHelpers["extends"]({from:b.value},c.value,{offlineMixin:a.success?a.value:null}))}g.parseNewsletterMessageWithJIDMixin=a}),98);
__d("WASmaxInMessageDeliverNewsletterRequest",["WASmaxInMessageDeliverNewsletterMessageWithJIDMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"message");if(!b.success)return b;b=d("WASmaxInMessageDeliverNewsletterMessageWithJIDMixin").parseNewsletterMessageWithJIDMixin(a);return!b.success?b:b}g.parseNewsletterRequest=a}),98);
__d("WASmaxOutMessageDeliverCommonAckMixin",["WASmaxJsx","WASmaxMixins","WASmaxParseJid","WASmaxParseReference","WASmaxParseUtils","WASmaxParsingFailure","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseReference").attrFromReference(d("WASmaxParseJid").attrNewsletterJid,a,["from"]);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(b.error);var c=d("WASmaxParseReference").attrFromReference(d("WASmaxParseUtils").attrStanzaId,a,["id"]);if(!c.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(c.error);a=d("WASmaxParseReference").attrFromReference(d("WASmaxParseUtils").attrString,a,["type"]);if(!a.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(a.error);b=d("WASmaxJsx").smax("ack",{to:d("WAWap").JID(b.value),"class":"message",id:d("WAWap").STANZA_ID(c.value),type:d("WAWap").CUSTOM_STRING(a.value)});return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeCommonAckMixin=a}),98);
__d("WASmaxOutMessageDeliverNewsletterResponseError",["WASmaxJsx","WASmaxOutMessageDeliverCommonAckMixin"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxOutMessageDeliverCommonAckMixin").mergeCommonAckMixin(d("WASmaxJsx").smax("ack",{error:"406"}),a);return a}g.makeNewsletterResponseError=a}),98);
__d("WASmaxOutMessageDeliverNewsletterResponseSuccess",["WASmaxJsx","WASmaxOutMessageDeliverCommonAckMixin"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxOutMessageDeliverCommonAckMixin").mergeCommonAckMixin(d("WASmaxJsx").smax("ack",null),a);return a}g.makeNewsletterResponseSuccess=a}),98);
__d("WASmaxMessageDeliverNewsletterRPC",["WASmaxInMessageDeliverNewsletterRequest","WASmaxOutMessageDeliverNewsletterResponseError","WASmaxOutMessageDeliverNewsletterResponseSuccess","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInMessageDeliverNewsletterRequest").parseNewsletterRequest(a);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("Newsletter",{Request:b}));return{parsedRequest:b.value,makeNewsletterResponseError:function(){return d("WASmaxOutMessageDeliverNewsletterResponseError").makeNewsletterResponseError(a)},makeNewsletterResponseSuccess:function(){return d("WASmaxOutMessageDeliverNewsletterResponseSuccess").makeNewsletterResponseSuccess(a)}}}g.receiveNewsletterRPC=a}),98);
__d("WAWebHandleNewsletterMsgLogger",["WASmaxMessageDeliverNewsletterRPC","WAWebHandleMsgError","WAWebIncomingMessageDropWamEvent","WAWebWamEnumE2eDestination","WAWebWamEnumMediaType","WAWebWamEnumMessageDropReasonType","WAWebWamEnumRevokeType"],(function(a,b,c,d,e,f,g){function h(a){try{return d("WASmaxMessageDeliverNewsletterRPC").receiveNewsletterRPC(a)}catch(a){return null}}function a(a,b){b=h(b.stanza);a instanceof d("WAWebHandleMsgError").MessageValidationError&&i(b,a)}function i(a,b){var c;c=new(d("WAWebIncomingMessageDropWamEvent").IncomingMessageDropWamEvent)({messageDropReason:d("WAWebWamEnumMessageDropReasonType").MESSAGE_DROP_REASON_TYPE.INVALID_PROTOBUF,e2eDestination:d("WAWebWamEnumE2eDestination").E2E_DESTINATION.CHANNEL,offline:(a==null?void 0:(c=a.parsedRequest)==null?void 0:(c=c.offlineMixin)==null?void 0:c.offline)!=null,e2eFailureReason:b==null?void 0:b.e2eFailureReason,messageMediaType:j(a),revokeType:(a==null?void 0:a.parsedRequest.newsletterMessageFanoutContent.name)==="NewsletterRevoke"?d("WAWebWamEnumRevokeType").REVOKE_TYPE.ADMIN:void 0});c.commit()}function j(a){a=a==null?void 0:a.parsedRequest.newsletterMessageFanoutContent;if(a==null)return d("WAWebWamEnumMediaType").MEDIA_TYPE.NONE;switch(a.name){case"NewsletterReaction":return d("WAWebWamEnumMediaType").MEDIA_TYPE.REACTION;case"NewsletterMedia":return k(a.value.plaintextMediatype);case"NewsletterEdit":return a.value.newsletterTextOrMediaMixinGroup.value.type==="media"?k(a.value.newsletterTextOrMediaMixinGroup.value.plaintextMediatype):d("WAWebWamEnumMediaType").MEDIA_TYPE.NONE;case"NewsletterText":return d("WAWebWamEnumMediaType").MEDIA_TYPE.NONE;case"NewsletterRevoke":case"NewsletterReactionRevoke":return d("WAWebWamEnumMediaType").MEDIA_TYPE.NONE;case"NewsletterPollCreation":return d("WAWebWamEnumMediaType").MEDIA_TYPE.POLL_CREATE;case"NewsletterPollVote":return d("WAWebWamEnumMediaType").MEDIA_TYPE.POLL_VOTE;default:a.name;return d("WAWebWamEnumMediaType").MEDIA_TYPE.NONE}}function k(a){switch(a){case"video":return d("WAWebWamEnumMediaType").MEDIA_TYPE.VIDEO;case"vcard":return d("WAWebWamEnumMediaType").MEDIA_TYPE.CONTACT;case"url":return d("WAWebWamEnumMediaType").MEDIA_TYPE.URL;case"sticker":case"genai_sticker":return d("WAWebWamEnumMediaType").MEDIA_TYPE.STICKER;case"ptt":return d("WAWebWamEnumMediaType").MEDIA_TYPE.PTT;case"productlink":return d("WAWebWamEnumMediaType").MEDIA_TYPE.PRODUCT_LINK;case"image":return d("WAWebWamEnumMediaType").MEDIA_TYPE.PHOTO;case"gif":return d("WAWebWamEnumMediaType").MEDIA_TYPE.GIF;case"document":return d("WAWebWamEnumMediaType").MEDIA_TYPE.DOCUMENT;case"cataloglink":return d("WAWebWamEnumMediaType").MEDIA_TYPE.CATALOG_LINK;case"avatar_sticker":return d("WAWebWamEnumMediaType").MEDIA_TYPE.FUTURE;default:a;return d("WAWebWamEnumMediaType").MEDIA_TYPE.AUDIO}}g.handleNewsletterMsgError=a}),98);
__d("WAWebNewsletterMsgParser",["WASmaxMessageDeliverNewsletterRPC","WASmaxParsingFailure","WAWebJidToWid","WAWebReactionsBEUtils","WAWebUserPrefsMeUser"],(function(a,b,c,d,e,f,g){function a(a){var b;a=d("WASmaxMessageDeliverNewsletterRPC").receiveNewsletterRPC(a);var c=a.parsedRequest;a=a.makeNewsletterResponseSuccess;b={id:c.id,t:c.t,isSender:c.isSender==="true",serverId:c.serverId,offline:((b=c.offlineMixin)==null?void 0:b.offline)!=null,from:d("WAWebJidToWid").jidWithTypeToWid({jidType:"newsletter",newsletterJid:c.from}),to:d("WAWebUserPrefsMeUser").getMeUser()};return{ack:a(),msg:k(b,c)}}function h(a){return a.reactionCode}function i(a){return a.votesVote.map(function(a){a=a.elementValue;return a})}function j(a){return a.plaintextPayloadMixin.elementValue}function k(a,b){var c=b.newsletterMessageFanoutContent;switch(c.name){case"NewsletterPollVote":return babelHelpers["extends"]({},a,{type:"NewsletterPollVote",pollVote:i(c.value)});case"NewsletterReaction":return babelHelpers["extends"]({},a,{type:"NewsletterReaction",reactionCode:h(c.value)});case"NewsletterReactionRevoke":return babelHelpers["extends"]({},a,{type:"NewsletterReactionRevoke",reactionCode:d("WAWebReactionsBEUtils").REVOKED_REACTION_TEXT});case"NewsletterRevoke":return babelHelpers["extends"]({},a,{type:"NewsletterRevoke"});case"NewsletterMedia":return babelHelpers["extends"]({},a,{type:c.name,payload:j(c.value)});case"NewsletterText":return babelHelpers["extends"]({},a,{type:c.name,payload:j(c.value)});case"NewsletterPollCreation":return babelHelpers["extends"]({},a,{type:"NewsletterPollCreation",payload:j(c.value)});case"NewsletterEdit":return babelHelpers["extends"]({},a,{type:"NewsletterEdit",payload:j(c.value.newsletterTextOrMediaMixinGroup.value),msgEditT:(a=b.newsletterMessageLastEditTimestampMixin)==null?void 0:a.metaMsgEditT,msgOriginalT:(a=b.newsletterMessageOriginalTimestampMixin)==null?void 0:a.metaOriginalMsgT});default:c.name;throw new(d("WASmaxParsingFailure").SmaxParsingFailure)("unrecognized-newsletter-message-type")}}g["default"]=a}),98);
__d("WAWebNewsletterMsgProcessor",["WATimeUtils","WAWebApiOrphanRevoke","WAWebNewsletterBackendMsgUtils","WAWebNewsletterDBUtils","WAWebPollsCreateOptionLocalIdMap","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.type==="NewsletterRevoke",c=a.serverId,e=i(a.type),f=e&&c!=null?yield d("WAWebNewsletterDBUtils").getMessageByServerId(c,a.from.toJid()):null,g=e&&f==null,h=(yield k(f,a.pollVote));b=d("WAWebNewsletterBackendMsgUtils").mapMsgStanzaToMsgData({msg:a,msgContext:{isNewMsg:!a.offline&&!b,addOnParentKey:e?j({addOnParentMsg:f,serverId:c,remote:a.from}):void 0,pollVotesAsLocalIds:h,latestEditSenderTimestampMs:a.msgEditT!=null?d("WATimeUtils").castToMillisTime(a.msgEditT):null}},"relay");e=(yield d("WAWebApiOrphanRevoke").applyOrphanRevokes([b]));f=e[0];return{msgData:f,isOrphan:g}});return h.apply(this,arguments)}function i(a){switch(a){case"NewsletterReaction":case"NewsletterReactionRevoke":case"NewsletterPollVote":return!0;default:return!1}}function j(a){var b=a.addOnParentMsg,c=a.serverId;a=a.remote;return b!=null?b.id:d("WAWebNewsletterDBUtils").craftNewsletterMsgKeyFromServerId(c,a.toJid())}function k(a,b){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=a==null?void 0:a.pollOptions;if(a==null||b==null)return;var c=(yield d("WAWebPollsCreateOptionLocalIdMap").createOptionLocalIdMap(a));return b.map(function(a){return c.getLocalIdForHash(a.slice().buffer)})});return l.apply(this,arguments)}g.preprocessNewsletterMsg=a;g.isAddOnType=i}),98);
__d("WAWebHandleNewsletterMsg",["Promise","WALogger","WATimeUtils","WAWebBackendApi","WAWebCmd","WAWebHandleMsgTypes.flow","WAWebHandleNewsletterMsgAddOns","WAWebHandleNewsletterMsgLogger","WAWebLogReceivedMessages","WAWebMessageProcessorCache","WAWebMessageThread","WAWebNewsletterGatingUtils","WAWebNewsletterMsgParser","WAWebNewsletterMsgProcessor","WAWebOfflineHandler","WAWebWamWorkerOfflineProcessReporter","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[newsletter] Failed to handle newsletter message"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[newsletter] Failed to handle newsletter offline ack"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[newsletter][message] Message decoded, UI update started"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[newsletter] Failed to handle newsletter message"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[newsletter][message] Message stored to DB"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[newsletter][message] Newsletter not enabled, drop & ack"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[newsletter][message] Message received, parsing and decoding"]);o=function(){return a};return a}function a(a){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){try{d("WALogger").DEV(o());var e=c("WAWebNewsletterMsgParser")(a),f=e.msg,g=e.ack;if(!d("WAWebNewsletterGatingUtils").isNewsletterEnabled()){d("WALogger").DEV(n());return g}var p=d("WATimeUtils").unixTimeMs();f.offline&&(d("WAWebOfflineHandler").OfflineMessageHandler.addOfflinePendingMessage(),d("WAWebOfflineHandler").OfflineMessageHandler.offlineStanzaReceivedAfterComplete());d("WAWebOfflineHandler").OfflineMessageHandler.isResumeFromRestartComplete()&&(f.offline=!1);var q=!d("WAWebNewsletterMsgProcessor").isAddOnType(f.type);return yield d("WAWebMessageThread").handleMessage(f.from.toString(),f.offline,b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=d("WATimeUtils").unixTimeMs(),c=(yield d("WAWebNewsletterMsgProcessor").preprocessNewsletterMsg(f)),e=c.msgData;c=c.isOrphan;var i=q?d("WAWebMessageProcessorCache").messageProcessorCache.addMessages([{msg:e}],!f.offline).then(function(){d("WALogger").DEV(m()),d("WAWebWamWorkerOfflineProcessReporter").WorkerOfflineResumeReporter.updateProcessedMessageCount(),d("WAWebLogReceivedMessages").logReceivedMessagesInWAM([e],f.offline,f.t*1e3,p,a)})["catch"](function(a){d("WALogger").ERROR(l()).tags("newsletter").devConsole(a).sendLogs("newsletter-failed-to-store-incoming-message")}):(h||(h=b("Promise"))).resolve();yield d("WAWebHandleNewsletterMsgAddOns").maybeHandleNewsletterMsgAddOns(e,{pollVotes:f.pollVote});d("WAWebCmd").Cmd.isMainStreamReadyMd&&(d("WAWebCmd").Cmd.isOfflineDeliveryEnd&&(yield i),d("WALogger").DEV(k()),d("WAWebBackendApi").frontendFireAndForget("updateNewsletterMessageUI",{chatID:f.from,msg:e,isOrphan:c}));if(f.offline){d("WAWebOfflineHandler").OfflineMessageHandler.processMessageDecryptResult(d("WAWebHandleMsgTypes.flow").E2EProcessResult.SUCCESS);d("WAWebMessageProcessorCache").messageProcessorCache.addMessages([{receiptInfo:{externalId:f.id,from:f.from,author:f.from}}])["catch"](function(a){d("WALogger").ERROR(j()).tags("newsletter").devConsole(a).sendLogs("newsletter-failed-to-store-offline-ack")});return}return g}))}catch(b){d("WAWebHandleNewsletterMsgLogger").handleNewsletterMsgError(b,{stanza:a});d("WALogger").ERROR(i()).tags("newsletter").devConsole(b).sendLogs("failed-handle-newsletter-message");throw b}});return p.apply(this,arguments)}g["default"]=a}),98);
__d("WAWebHandleVoipCallReceipt",["Promise","WADeprecatedWapParser","WALogger","WAWap","WAWebCommsWapMd","WAWebJidToWid","WAWebUserPrefsMeUser"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Parsing Error: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["voip: error while parsing: ",""]);j=function(){return a};return a}var k=new(c("WADeprecatedWapParser"))("callReceiptParser",function(a){a.assertTag("receipt");var b=a.maybeChild("offer")||a.maybeChild("accept")||a.maybeChild("reject");if(!b)throw a.createParseError("Unrecognized call stanza");return{stanzaId:a.attrString("id"),type:a.hasAttr("type")?a.attrString("type"):null,from:d("WAWebJidToWid").jidWithTypeToWid(a.attrJidWithType("from"))}});function a(a){var c=k.parse(a);if(c.error){d("WALogger").DEV(j(),a.toString());d("WALogger").ERROR(i(),c.error.toString());return(h||(h=b("Promise"))).reject(c.error)}a=c.success;c=a.stanzaId;var e=a.type;a=a.from;return(h||(h=b("Promise"))).resolve(d("WAWap").wap("ack",{id:d("WAWap").CUSTOM_STRING(c),to:d("WAWebCommsWapMd").JID(a),from:d("WAWebCommsWapMd").JID(d("WAWebUserPrefsMeUser").getMaybeMeUser()),"class":"receipt",type:d("WAWap").MAYBE_CUSTOM_STRING(e)}))}g.handleCallReceipt=a}),98);
__d("WAWebCommsHandleWorkerCompatibleStanza",["WALogger","WAParsableWapNode","WAWeb-dexie","WAWebCreateNackFromStanza","WAWebHandleGroupNotification","WAWebHandleIdentityChange","WAWebHandleMsg","WAWebHandleMsgReceipt","WAWebHandleNewsletterMsg","WAWebHandleVoipCallReceipt","WAWebPostIncomingMessageDropMetric","WAWebPostUnknownStanzaMetric","WAWebRuntimeEnvironmentUtils","WAWebWamWorkerOfflineProcessReporter","WAWebWid","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleMsg: drop incoming message due to an internal error: ",", message: ",", stack: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleMsg: drop incoming message due to an internal error: ",", message: ",", stack: ",""]);i=function(){return a};return a}function j(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(!d("WAWebRuntimeEnvironmentUtils").isWorker())return a;a=(yield a);b("WAWebWamWorkerOfflineProcessReporter").WorkerOfflineResumeReporter.updateProcessedNotificationCount();return a});return k.apply(this,arguments)}function a(a){var b=a.attrs;switch(a.tag){case"notification":switch(b.type){case"w:gp2":return j(d("WAWebHandleGroupNotification").handleGroupNotification(a))["catch"](function(b){return l(a,b)});case"encrypt":var e=a.content;if(!Array.isArray(e)||!e.length)break;e=e[0].tag;switch(e){case"identity":return j(d("WAWebHandleIdentityChange").handleE2eIdentityChange(a))["catch"](function(b){return l(a,b)})}break}break;case"message":e=a.attrs.from;return c("WAWebWid").isNewsletter(e==null?void 0:e.toString())?c("WAWebHandleNewsletterMsg")(a)["catch"](function(b){return m(a,b)}):c("WAWebHandleMsg")(a)["catch"](function(b){return m(a,b)});case"receipt":try{if(n(a))return d("WAWebHandleVoipCallReceipt").handleCallReceipt(a);else if(b.type!=="retry"&&b.type!=="enc_rekey_retry")return c("WAWebHandleMsgReceipt")(a)}catch(b){if(b instanceof d("WAParsableWapNode").XmppParsingFailure){d("WAWebPostUnknownStanzaMetric").postUnknownStanzaMetric(a);return d("WAWebCreateNackFromStanza").createNackFromStanza(a,d("WAWebCreateNackFromStanza").NackReason.ParsingError)}return d("WAWebCreateNackFromStanza").createNackFromStanza(a,d("WAWebCreateNackFromStanza").NackReason.UnhandledError)}}}function l(a,b){if(b instanceof d("WAParsableWapNode").XmppParsingFailure){d("WAWebPostUnknownStanzaMetric").postUnknownStanzaMetric(a);return d("WAWebCreateNackFromStanza").createNackFromStanza(a,d("WAWebCreateNackFromStanza").NackReason.ParsingError)}return d("WAWebCreateNackFromStanza").createNackFromStanza(a,d("WAWebCreateNackFromStanza").NackReason.UnhandledError)}function m(a,b){if(b instanceof d("WAParsableWapNode").XmppParsingFailure){d("WAWebPostUnknownStanzaMetric").postUnknownStanzaMetric(a);d("WAWebPostIncomingMessageDropMetric").postIncomingMessageDropInvalidStanza(a);return d("WAWebCreateNackFromStanza").createNackFromStanza(a,d("WAWebCreateNackFromStanza").NackReason.ParsingError)}if(b instanceof c("WAWeb-dexie").DexieError){d("WAWebPostIncomingMessageDropMetric").postIncomingMessageDropDBOperationFailed(a);d("WALogger").ERROR(i(),b.name,b.message,b.stack).sendLogs("incoming-message-drop-db-operation-failed",.1);return}d("WALogger").ERROR(h(),b.name,b.message,b.stack).sendLogs("incoming-message-drop-internal-error",.1);d("WAWebPostIncomingMessageDropMetric").postIncomingMessageDropInternalError(a);return d("WAWebCreateNackFromStanza").createNackFromStanza(a,d("WAWebCreateNackFromStanza").NackReason.UnhandledError)}function n(a){if(Array.isArray(a.content)&&a.content.length>0){a=a.content[0].tag;return a==="offer"||a==="accept"||a==="reject"}return!1}g.handleWorkerCompatibleStanza=a}),98);
__d("WAWebHandleAboutNotification",["$InternalEnum","Promise","WADeprecatedWapParser","WALogger","WAWap","WAWebApiContact","WAWebCommsWapMd","WAWebJidToWid","WAWebSchemaContact","WAWebStatusCollection","WAWebStatusContactAction","WAWebWid","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleAboutNotification: unhandled notification of\n        type ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleAboutNotification: get status update for unknown contact ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["could not find side contact hash for status update operation"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleAboutNotification: received ","\n    for ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Parsing Error: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["error while parsing: ",""]);n=function(){return a};return a}var o=b("$InternalEnum")({CHANGE:"change",SIDE_LIST_CHANGE:"sideListChange",UNKNOWN:"unknown"}),p=new(c("WADeprecatedWapParser"))("incomingAboutNotification",function(a){a.assertTag("notification");var b={stanzaId:a.attrString("id")},c=a.hasChild("set")&&a.child("set");if(c&&!c.hasAttr("hash"))return babelHelpers["extends"]({type:o.CHANGE,from:d("WAWebJidToWid").userJidToUserWid(a.attrUserJid("from")),pushname:a.attrString("notify"),content:c.contentString(),ts:a.attrTime("t")},b);return c&&c.hasAttr("hash")?babelHelpers["extends"]({type:o.SIDE_LIST_CHANGE,from:d("WAWebJidToWid").userJidToUserWid(a.attrUserJid("from")),hash:c.attrString("hash")},b):babelHelpers["extends"]({type:o.UNKNOWN,from:a.attrString("from")},b)});function q(a){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WALogger").LOG(l(),a.type,a.from.toString());switch(a.type){case o.SIDE_LIST_CHANGE:var b=(yield d("WAWebSchemaContact").getContactTable().equals(["contactHash"],a.hash));if(b.length===0)d("WALogger").WARN(k());else{b=d("WAWebWidFactory").createWid(b[0].id);var e=d("WAWebStatusCollection").StatusCollection.get(b);b=e==null?null:d("WAWebStatusContactAction").getStatus(b).then(function(a){e.set({status:a.status})});yield b}break;case o.CHANGE:b=a.from;if(!(b instanceof c("WAWebWid")))break;var f=[b];if(b.isLid()){b=d("WAWebApiContact").getPhoneNumber(b);b!=null&&f.push(b)}for(b of f){f=d("WAWebStatusCollection").StatusCollection.get(b);f&&a.content!=null?f.status=a.content:d("WALogger").WARN(j(),b.toLogString())}break;default:d("WALogger").WARN(i(),a.type);break}return d("WAWap").wap("ack",{id:d("WAWap").CUSTOM_STRING(a.stanzaId),to:a.from instanceof c("WAWebWid")?d("WAWebCommsWapMd").JID(a.from):d("WAWap").CUSTOM_STRING(a.from),"class":"notification",type:"status"})});return r.apply(this,arguments)}function a(a){var c=p.parse(a);if(c.error){d("WALogger").DEV(n(),a.toString());d("WALogger").ERROR(m(),c.error.toString());return(h||(h=b("Promise"))).reject(c.error)}return q(c.success)}g.NotificationType=o;g.handleAboutNotification=a}),98);
__d("WAWebProcessAppdata",["Promise","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f){var g;function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield (g||(g=b("Promise"))).resolve();return{hasInactiveMsg:!1}});return h.apply(this,arguments)}f.processDecryptedAppdataProto=a}),66);
__d("WAWebHandleAppdata",["Promise","WADeprecatedWapParser","WALogger","WATimeUtils","WAWebBackendJobs.flow","WAWebGetMessageCache","WAWebHandleMsgCommon","WAWebHandleMsgParser","WAWebHandleMsgSendAck","WAWebHandleMsgSendReceipt","WAWebHandleMsgTypes.flow","WAWebJidToWid","WAWebMessageThread","WAWebMsgProcessingApiUtils","WAWebMsgProcessingDecryptApi","WAWebOfflineHandler","WAWebProcessAppdata","WAWebUserPrefsMeUser","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleAppdata: msgId::",', start processing appdata, offline="','"']);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleAppdata: msgId::",", msgMeta is unavailable, also not showing placeholder for appdata"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleAppdata: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleAppdata: error while parsing appdata for ack only: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleAppdata: error while parsing: ",""]);m=function(){return a};return a}var n=new(c("WADeprecatedWapParser"))("incomingAppdataParser",function(a){a.assertTag("appdata");a.hasAttr("to")&&a.assertAttr("to",d("WAWebUserPrefsMeUser").assertGetMe().toJid());var b=a.mapChildrenWithTag("enc",function(a){return{e2eType:a.attrEnumValues("type",d("WAWebBackendJobs.flow").CiphertextType.members()),encMediaType:d("WAWebBackendJobs.flow").EncMediaType.cast(a.maybeAttrString("mediatype")),ciphertext:a.contentBytes(),retryCount:a.hasAttr("count")?a.attrInt("count"):0,hideFail:a.maybeAttrString("decrypt-fail")==="hide"}}),c=a.maybeChild("device-identity");c=c?c.contentBytes():null;var e=d("WAWebHandleMsgParser").parseMessageInfo(a,b),f=d("WAWebHandleMsgParser").parseMessageMeta(a,b),g=d("WAWebHandleMsgParser").parseBizInfo(a);a=(a=(a=a.maybeChild("rcat"))==null?void 0:a.contentBytes())!=null?a:null;return{encs:b,bizInfo:g,msgInfo:e,msgMeta:f,deviceIdentity:c,rcat:a}}),o=new(c("WADeprecatedWapParser"))("incomingMsgParserForAckOnly",function(a){a.assertTag("appdata");return{externalId:a.attrString("id"),from:d("WAWebJidToWid").jidWithTypeToWid(a.attrJidWithType("from")),participant:a.hasAttr("participant")?d("WAWebJidToWid").deviceJidToDeviceWid(a.attrDeviceJid("participant")):null}});function p(a,c){d("WALogger").DEV(m(),c.toString()).tags("appdata");c=o.parse(c);if(c.error){d("WALogger").DEV(l(),c.error).tags("appdata");return(h||(h=b("Promise"))).reject(a.error)}a=c.success;c=a.externalId;var e=a.from;a=a.participant;return(h||(h=b("Promise"))).resolve(d("WAWebHandleMsgSendAck").sendAck(c,e,null,a))}function a(a){var c=n.parse(a);if(c.error)return p(c,a);var e=c.success;d("WALogger").DEV(k(),e);var f=e.msgMeta,g=e.msgInfo;g.clientReceivedTsMillis=d("WATimeUtils").unixTimeMs();g.offline!=null&&(d("WAWebOfflineHandler").OfflineMessageHandler.addOfflinePendingMessage(),d("WAWebOfflineHandler").OfflineMessageHandler.offlineStanzaReceivedAfterComplete());d("WAWebOfflineHandler").OfflineMessageHandler.isResumeFromRestartComplete()&&delete e.msgInfo.offline;return d("WAWebMessageThread").handleMessage(g.chat.toString(),!!e.msgInfo.offline,b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a;g.msgProcessStartTsMillis=d("WATimeUtils").unixTimeMs();if(f.isUnavailable){d("WALogger").LOG(j(),g.externalId).tags("appdata");return}d("WALogger").LOG(i(),g.externalId,(a=g.offline)!=null?a:"").tags("appdata");a=(yield d("WAWebMsgProcessingDecryptApi").decryptE2EPayload(e,d("WAWebProcessAppdata").processDecryptedAppdataProto));g.offline!=null?(d("WAWebOfflineHandler").OfflineMessageHandler.processMessageDecryptResult(a.result),a.result!==d("WAWebHandleMsgTypes.flow").E2EProcessResult.SUCCESS||g.category===d("WAWebHandleMsgCommon").CATEGORY_PEER?d("WAWebHandleMsgSendReceipt").sendReceipt(g,f,a):d("WAWebGetMessageCache").getMessageCache().addMessages([{receiptInfo:{externalId:g.externalId,from:d("WAWebMsgProcessingApiUtils").getFrom(g),author:g.author}}],!1)):d("WAWebHandleMsgSendReceipt").sendReceipt(g,f,a)}))}g["default"]=a}),98);
__d("WASmaxInBizCtwaAdAccountServerNotificationMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"t",0,void 0);if(!b.success)return b;var c=d("WASmaxParseUtils").attrStanzaId(a,"id");if(!c.success)return c;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,a,"offline",0,1024);return!a.success?a:d("WAResultOrError").makeResult({t:b.value,id:c.value,offline:a.value})}g.parseServerNotificationMixin=a}),98);
__d("WASmaxInBizCtwaAdAccountNonceNotificationRequest",["WAResultOrError","WASmaxInBizCtwaAdAccountServerNotificationMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"wa_ad_account_nonce");if(!b.success)return b;var c=d("WASmaxParseJid").literalJid(d("WASmaxParseJid").attrDomainJid,a,"from","s.whatsapp.net");if(!c.success)return c;var e=d("WASmaxParseUtils").optional(d("WASmaxParseJid").attrUserJid,a,"to");if(!e.success)return e;var f=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","business");if(!f.success)return f;b=d("WASmaxParseUtils").contentString(b.value);if(!b.success)return b;a=d("WASmaxInBizCtwaAdAccountServerNotificationMixin").parseServerNotificationMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({from:c.value,to:e.value,type:f.value,waAdAccountNonceElementValue:b.value},a.value))}g.parseNonceNotificationRequest=a}),98);
__d("WASmaxBizCtwaAdAccountNonceNotificationRPC",["WASmaxInBizCtwaAdAccountNonceNotificationRequest","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxInBizCtwaAdAccountNonceNotificationRequest").parseNonceNotificationRequest(a);if(!a.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("NonceNotification",{Request:a}));return{parsedRequest:a.value}}g.receiveNonceNotificationRPC=a}),98);
__d("WASmaxInBizSettingsServerNotificationMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"t",0,void 0);if(!b.success)return b;var c=d("WASmaxParseUtils").attrStanzaId(a,"id");if(!c.success)return c;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,a,"offline",0,1024);return!a.success?a:d("WAResultOrError").makeResult({t:b.value,id:c.value,offline:a.value})}g.parseServerNotificationMixin=a}),98);
__d("WASmaxInBizSettingsSyncPrivacySettingRequest",["WAResultOrError","WASmaxInBizSettingsServerNotificationMixin","WASmaxInBizSettingsSmbDataSharingSettingMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"privacy");if(!b.success)return b;var c=d("WASmaxParseJid").literalJid(d("WASmaxParseJid").attrDomainJid,a,"from","s.whatsapp.net");if(!c.success)return c;var e=d("WASmaxParseUtils").optional(d("WASmaxParseJid").attrUserJid,a,"to");if(!e.success)return e;var f=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","business");if(!f.success)return f;b=d("WASmaxInBizSettingsSmbDataSharingSettingMixin").parseSmbDataSharingSettingMixin(b.value);a=d("WASmaxInBizSettingsServerNotificationMixin").parseServerNotificationMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({from:c.value,to:e.value,type:f.value,privacySmbDataSharingSettingMixin:b.success?b.value:null},a.value))}g.parseSyncPrivacySettingRequest=a}),98);
__d("WASmaxBizSettingsSyncPrivacySettingRPC",["WASmaxInBizSettingsSyncPrivacySettingRequest","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxInBizSettingsSyncPrivacySettingRequest").parseSyncPrivacySettingRequest(a);if(!a.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("SyncPrivacySetting",{Request:a}));return{parsedRequest:a.value}}g.receiveSyncPrivacySettingRPC=a}),98);
__d("WAWebCTWAParsePrivacy",["WALogger","WASmaxBizSettingsSyncPrivacySettingRPC"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["parseCTWAPrivacy: Could not parse RPC response"]);h=function(){return a};return a}function a(a){try{a=d("WASmaxBizSettingsSyncPrivacySettingRPC").receiveSyncPrivacySettingRPC(a.node());a=a.parsedRequest;a=(a=a.privacySmbDataSharingSettingMixin)==null?void 0:a.value;return a==null?null:{smbDataSharingSetting:a}}catch(a){d("WALogger").ERROR(h());return null}}g.parseCTWAPrivacy=a}),98);
__d("WASmaxInBizCtwaActionEnums",[],(function(a,b,c,d,e,f){a={"false":"false","true":"true"};b={info:"info",warning:"warning"};f.ENUM_FALSE_TRUE=a;f.ENUM_INFO_WARNING=b}),66);
__d("WASmaxInBizCtwaActionLocalisationMetadataMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"parameter");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"name");if(!b.success)return b;a=d("WASmaxParseUtils").attrString(a,"value");return!a.success?a:d("WAResultOrError").makeResult({name:b.value,value:a.value})}function a(a){var b=d("WASmaxParseUtils").assertTag(a,"localisation_metadata");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"uid");if(!b.success)return b;var c=d("WASmaxParseUtils").attrString(a,"translation_project");if(!c.success)return c;a=d("WASmaxParseUtils").mapChildrenWithTag(a,"parameter",0,20,h);return!a.success?a:d("WAResultOrError").makeResult({uid:b.value,translationProject:c.value,parameter:a.value})}g.parseLocalisationMetadataParameter=h;g.parseLocalisationMetadataMixin=a}),98);
__d("WASmaxInBizCtwaActionNativeActionsMixinMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"native_action");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"platform");if(!b.success)return b;var c=d("WASmaxParseUtils").attrString(a,"min_app_version");if(!c.success)return c;var e=d("WASmaxParseUtils").attrString(a,"local_link");if(!e.success)return e;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,a,"universal_link");return!a.success?a:d("WAResultOrError").makeResult({platform:b.value,minAppVersion:c.value,localLink:e.value,universalLink:a.value})}function a(a){a=d("WASmaxParseUtils").mapChildrenWithTag(a,"native_action",0,50,h);return!a.success?a:d("WAResultOrError").makeResult({nativeAction:a.value})}g.parseNativeActionsMixinNativeAction=h;g.parseNativeActionsMixinMixin=a}),98);
__d("WASmaxInBizCtwaActionServerNotificationMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"t",0,void 0);if(!b.success)return b;var c=d("WASmaxParseUtils").attrStanzaId(a,"id");if(!c.success)return c;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,a,"offline",0,1024);return!a.success?a:d("WAResultOrError").makeResult({t:b.value,id:c.value,offline:a.value})}g.parseServerNotificationMixin=a}),98);
__d("WASmaxInBizCtwaActionBannerSuggestionRequest",["WAResultOrError","WASmaxInBizCtwaActionEnums","WASmaxInBizCtwaActionLocalisationMetadataMixin","WASmaxInBizCtwaActionNativeActionsMixinMixin","WASmaxInBizCtwaActionServerNotificationMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"action");if(!b.success)return b;b=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,a,"deep_link");if(!b.success)return b;var c=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,a,"local_link");if(!c.success)return c;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,a,"local_android_link");return!a.success?a:d("WAResultOrError").makeResult({deepLink:b.value,localLink:c.value,localAndroidLink:a.value})}function i(a){var b=d("WASmaxParseUtils").assertTag(a,"localised_heading");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"localisation_metadata");if(!b.success)return b;a=d("WASmaxParseUtils").attrString(a,"value");if(!a.success)return a;b=d("WASmaxInBizCtwaActionLocalisationMetadataMixin").parseLocalisationMetadataMixin(b.value);return!b.success?b:d("WAResultOrError").makeResult({value:a.value,localisationMetadataLocalisationMetadataMixin:b.value})}function j(a){var b=d("WASmaxParseUtils").assertTag(a,"localised_body");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"localisation_metadata");if(!b.success)return b;a=d("WASmaxParseUtils").attrString(a,"value");if(!a.success)return a;b=d("WASmaxInBizCtwaActionLocalisationMetadataMixin").parseLocalisationMetadataMixin(b.value);return!b.success?b:d("WAResultOrError").makeResult({value:a.value,localisationMetadataLocalisationMetadataMixin:b.value})}function k(a){var b=d("WASmaxParseUtils").assertTag(a,"localised_highlight");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"localisation_metadata");if(!b.success)return b;a=d("WASmaxParseUtils").attrString(a,"value");if(!a.success)return a;b=d("WASmaxInBizCtwaActionLocalisationMetadataMixin").parseLocalisationMetadataMixin(b.value);return!b.success?b:d("WAResultOrError").makeResult({value:a.value,localisationMetadataLocalisationMetadataMixin:b.value})}function l(a){var b=d("WASmaxParseUtils").assertTag(a,"banner");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"config");if(!b.success)return b;var c=d("WASmaxParseUtils").flattenedChildWithTag(a,"content");if(!c.success)return c;var e=d("WASmaxParseUtils").flattenedChildWithTag(c.value,"heading");if(!e.success)return e;var f=d("WASmaxParseUtils").flattenedChildWithTag(c.value,"body");if(!f.success)return f;var g=d("WASmaxParseUtils").flattenedChildWithTag(c.value,"highlight");if(!g.success)return g;var l=d("WASmaxParseUtils").optionalChildWithTag(a,"action",h);if(!l.success)return l;var m=d("WASmaxParseUtils").optionalChildWithTag(c.value,"localised_heading",i);if(!m.success)return m;var n=d("WASmaxParseUtils").optionalChildWithTag(c.value,"localised_body",j);if(!n.success)return n;var o=d("WASmaxParseUtils").optionalChildWithTag(c.value,"localised_highlight",k);if(!o.success)return o;var p=d("WASmaxParseUtils").attrIntRange(b.value,"expires_at",1,void 0);if(!p.success)return p;var q=d("WASmaxParseUtils").attrStringEnum(b.value,"display",d("WASmaxInBizCtwaActionEnums").ENUM_INFO_WARNING);if(!q.success)return q;b=d("WASmaxParseUtils").attrStringEnum(b.value,"revoked",d("WASmaxInBizCtwaActionEnums").ENUM_FALSE_TRUE);if(!b.success)return b;c=d("WASmaxParseUtils").attrString(c.value,"locale");if(!c.success)return c;e=d("WASmaxParseUtils").contentString(e.value);if(!e.success)return e;f=d("WASmaxParseUtils").contentString(f.value);if(!f.success)return f;g=d("WASmaxParseUtils").contentString(g.value);if(!g.success)return g;a=d("WASmaxInBizCtwaActionNativeActionsMixinMixin").parseNativeActionsMixinMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({configExpiresAt:p.value,configDisplay:q.value,configRevoked:b.value,contentLocale:c.value,contentHeadingElementValue:e.value,contentBodyElementValue:f.value,contentHighlightElementValue:g.value},a.value,{action:l.value,contentLocalisedHeading:m.value,contentLocalisedBody:n.value,contentLocalisedHighlight:o.value}))}function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"ctwa_suggestion");if(!b.success)return b;var c=d("WASmaxParseUtils").optionalChildWithTag(b.value,"banner",l);if(!c.success)return c;var e=d("WASmaxParseJid").literalJid(d("WASmaxParseJid").attrDomainJid,a,"from","s.whatsapp.net");if(!e.success)return e;var f=d("WASmaxParseUtils").optional(d("WASmaxParseJid").attrUserJid,a,"to");if(!f.success)return f;var g=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","business");if(!g.success)return g;b=d("WASmaxParseUtils").attrString(b.value,"target_entity_id");if(!b.success)return b;a=d("WASmaxInBizCtwaActionServerNotificationMixin").parseServerNotificationMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({from:e.value,to:f.value,type:g.value,ctwaSuggestionTargetEntityId:b.value},a.value,{ctwaSuggestionBanner:c.value}))}g.parseBannerSuggestionRequestCtwaSuggestionBannerAction=h;g.parseBannerSuggestionRequestCtwaSuggestionBannerContentLocalisedHeading=i;g.parseBannerSuggestionRequestCtwaSuggestionBannerContentLocalisedBody=j;g.parseBannerSuggestionRequestCtwaSuggestionBannerContentLocalisedHighlight=k;g.parseBannerSuggestionRequestCtwaSuggestionBanner=l;g.parseBannerSuggestionRequest=a}),98);
__d("WASmaxBizCtwaActionBannerSuggestionRPC",["WASmaxInBizCtwaActionBannerSuggestionRequest","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxInBizCtwaActionBannerSuggestionRequest").parseBannerSuggestionRequest(a);if(!a.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("BannerSuggestion",{Request:a}));return{parsedRequest:a.value}}g.receiveBannerSuggestionRPC=a}),98);
__d("WAWebWamEnumPreferredLinkType",[],(function(a,b,c,d,e,f){a=Object.freeze({LOCAL:0,UNIVERSAL:1});f.PREFERRED_LINK_TYPE=a}),66);
__d("WAWebCtwaActionBannerUnderstandWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumPreferredLinkType"],(function(a,b,c,d,e,f,g){b=(a=d("WAWebWamCodegenUtils")).defineEvents({CtwaActionBannerUnderstand:[3586,{bannerIdentifier:[1,a.TYPES.STRING],bannerLocale:[2,a.TYPES.STRING],clientLocale:[3,a.TYPES.STRING],hasLocalLink:[4,a.TYPES.BOOLEAN],hasUniversalLink:[5,a.TYPES.BOOLEAN],invalidLink:[6,a.TYPES.STRING],lwiFlowIdentifier:[7,a.TYPES.STRING],preferredLink:[8,d("WAWebWamEnumPreferredLinkType").PREFERRED_LINK_TYPE],validLocale:[9,a.TYPES.BOOLEAN],validNotification:[10,a.TYPES.BOOLEAN]},[1,1,1],"private",0]});g.CtwaActionBannerUnderstandWamEvent=b}),98);
__d("WAWebCTWAParseSuggestion",["WALogger","WASmaxBizCtwaActionBannerSuggestionRPC","WATimeUtils","WAWebApiParse","WAWebBizGatingUtils","WAWebCtwaActionBannerUnderstandWamEvent","WAWebL10N","WAWebUpdaterVersion"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["parseCTWASuggestion: invalid deep link (",", ",")"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["parseCTWASuggestion: manage ads not enabled (",")"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["parseCTWASuggestion: invalid link (",")"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["parseCTWASuggestion: app version too old (",")"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["parseCTWASuggestion: too many actions (",")"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose([""," (",")"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose([""," (",")"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["parseCTWASuggestion: locale mismatch (",")"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["parseCTWASuggestion: missing banner data (",")"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["parseCTWASuggestion: metric failed"]);q=function(){return a};return a}var r="recreate_ad",s="manage_ads",t="parseCTWASuggestion: missing action link";function u(a){if(!d("WAWebBizGatingUtils").adsActionBannersLoggingEnabled())return;var b=new(d("WAWebCtwaActionBannerUnderstandWamEvent").CtwaActionBannerUnderstandWamEvent)();b.bannerIdentifier=a.bannerIdentifier;b.validNotification=a.validNotification;a.clientLocale!=null&&(b.clientLocale=a.clientLocale);a.bannerLocale!=null&&(b.bannerLocale=a.bannerLocale);a.validLocale!=null&&(b.validLocale=a.validLocale);b.commitAndWaitForFlush()["catch"](function(a){d("WALogger").ERROR(q()).devConsole(a)})}function v(a){a=a.split("-");return a[1]}function a(a){a=d("WASmaxBizCtwaActionBannerSuggestionRPC").receiveBannerSuggestionRPC(a.node());a=a.parsedRequest;var b=a.ctwaSuggestionTargetEntityId,e=a.ctwaSuggestionBanner;a=a.t;var f=v(b);if(e==null){u({bannerIdentifier:b,validNotification:!1});d("WALogger").ERROR(p(),f).sendLogs("parseCTWASuggestion-missing-banner-data-"+f);return}if(e.configRevoked==="true")return{type:"revokedBanner",id:b};var g=e.contentLocale,q=c("WAWebL10N").getNormalizedLocale(),w=function(a){var c=a.validNotification;a=a.validLocale;u({bannerIdentifier:b,validNotification:c,clientLocale:q,bannerLocale:g,validLocale:a})};if(c("WAWebL10N").normalizeLocaleToWajsLocale(g)!==q){w({validNotification:!1,validLocale:!1});d("WALogger").WARN(o(),f);return}var x=e.configExpiresAt,y=e.contentHeadingElementValue,z=e.contentBodyElementValue,A=e.contentHighlightElementValue,B=e.configDisplay;e=e.nativeAction;e=e.filter(function(a){return a.platform==="web"});if(e.length===0){w({validNotification:!1,validLocale:!0});b.endsWith(r)||b.includes(s)?d("WALogger").ERROR(n(),t,f).sendLogs("parseCTWASuggestion-missing-action-link-${bannerType}"):d("WALogger").WARN(m(),t,f);return}else if(e.length>1){w({validNotification:!1,validLocale:!0});d("WALogger").ERROR(l(),f).sendLogs("parseCTWASuggestion-too-many-actions-${bannerType}");return}e=e[0];var C=e.minAppVersion;C=new(d("WAWebUpdaterVersion").Version)(C);var D=new(d("WAWebUpdaterVersion").Version)(d("WAWebUpdaterVersion").SANITIZED_VERSION_STR);if(D.lt(C)){d("WALogger").WARN(k(),f);return}D=e.localLink;C=d("WAWebApiParse").parseAPICmd(D);if(C.resultType==="INVALID"){if(!D.startsWith("https://")){w({validNotification:!1,validLocale:!0});d("WALogger").ERROR(j(),f).sendLogs("parseCTWASuggestion-invalid-link-${bannerType}");return}}else if(C.resultType==="MANAGE_ADS"){if(!d("WAWebBizGatingUtils").adsActionManageAdsBannerEnabled()){w({validNotification:!1,validLocale:!0});d("WALogger").WARN(i(),f);return}}else{C.resultType;w({validNotification:!1,validLocale:!0});d("WALogger").ERROR(h(),f,C.resultType).sendLogs("parseCTWASuggestion-invalid-deep-link-${bannerType}");return}w({validNotification:!0,validLocale:!0});return{type:"banner",id:b,expiresAt:d("WATimeUtils").castToUnixTime(x),heading:y,body:z,highlight:A,actionLink:D,display:B,ts:d("WATimeUtils").castToUnixTime(a)}}g.parseCTWASuggestion=a}),98);
__d("WAWebHandleBusinessRemoval",["Promise","WAWebBizCreateBizStateChangeNotificationMsgsAction","WAWebContactCollection","WAWebModelStorageUtils","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){var h;function i(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=(yield a.get(b.user));if(c==null)return;c.isBusiness=!1;c.verifiedLevel=0;c.verifiedName="";return a.merge(b.user,c)});return j.apply(this,arguments)}function k(a,b){return a.remove(b.user)}var l={isBusiness:!1};function m(a,b,c){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){e=d("WAWebContactCollection").ContactCollection.get(a);f=e?{isBusiness:e.isBusiness,privacyMode:e.privacyMode}:l;yield d("WAWebModelStorageUtils").getStorage().lock(["contact","verified-business-name"],function(c){var d=c[0];c=c[1];return(h||(h=b("Promise"))).all([i(d,a),k(c,a)])});e=d("WAWebContactCollection").ContactCollection.get(a);e!=null&&e.set({isBusiness:!1,verifiedLevel:null,verifiedName:null});return c("WAWebBizCreateBizStateChangeNotificationMsgsAction")(a,f,l)});return n.apply(this,arguments)}function a(a){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.type!=="remove_hash")throw c("err")("Invalid notification type");var e=d("WAWebContactCollection").ContactCollection.resolveWidsFromHash(a.hash);if(!e)return!1;yield (h||(h=b("Promise"))).all(e.map(function(b){return m(b,a.stanzaId,a.ts)}));return!0});return o.apply(this,arguments)}function e(a){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.type!=="remove_jid")throw c("err")("Invalid notification type");yield m(a.jid,a.stanzaId,a.ts)});return p.apply(this,arguments)}g.handleBusinessRemoval=m;g.handleBusinessRemovalNotificationHash=a;g.handleBusinessRemovalNotificationContact=e}),98);
__d("WAWebHandleBusinessNameChange",["Promise","WADeprecatedSendIq","WADeprecatedWapParser","WALogger","WAWap","WAWebApiVerifiedBusinessName","WAWebBizCreateBizStateChangeNotificationMsgsAction","WAWebBizUpdateContactsWithVerifiedNamesAction","WAWebCommonParsersVerifiedName","WAWebCommsWapMd","WAWebContactCollection","WAWebHandleBusinessRemoval","WAWebModelStorageUtils","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["verified name notification not found"]);i=function(){return a};return a}function j(a,c,e,f,g,i){var j=d("WAWebContactCollection").ContactCollection.get(a);j!=null&&d("WAWebBizUpdateContactsWithVerifiedNamesAction").updateContactsWithVerifiedNames([{id:a,name:e,level:c,isApi:f,isSmb:g,privacyMode:i}],[j]);return(h||(h=b("Promise"))).resolve()}function k(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("WAWebModelStorageUtils").getStorage().lock(["verified-business-name"],function(){return d("WAWebApiVerifiedBusinessName").createOrUpdateVerifiedBusinessName(a.wid,{level:a.level,serial:parseInt(a.serial||"0",10),name:a.verifiedName,isApi:a.isApi,isSmb:a.isSmb,privacyMode:a.privacyMode?{actualActors:a.privacyMode.actualActors,hostStorage:a.privacyMode.hostStorage,privacyModeTs:a.privacyMode.privacyModeTs}:null})});var e=[],f=d("WAWebContactCollection").ContactCollection.get(a.wid);f!=null&&e.push(c("WAWebBizCreateBizStateChangeNotificationMsgsAction")(a.wid,{isBusiness:f.isBusiness,privacyMode:f.privacyMode},{isBusiness:!0,privacyMode:a.privacyMode}));e.push(j(a.wid,a.level,a.verifiedName,a.isApi,a.isSmb,a.privacyMode));yield (h||(h=b("Promise"))).all(e)});return l.apply(this,arguments)}var m=new(c("WADeprecatedWapParser"))("verifiedNameParser",function(a){return c("WAWebCommonParsersVerifiedName")(a.child("verified_name"))});function n(a){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b;b=(b=d("WAWap")).wap("iq",{to:b.S_WHATSAPP_NET,type:"get",xmlns:"w:biz",id:b.generateId()},b.wap("verified_name",{jid:d("WAWebCommsWapMd").DEVICE_JID(a)}));a=(yield d("WADeprecatedSendIq").deprecatedSendIq(b,m));if(!a.success){if(a.errorCode===404){d("WALogger").WARN(i());return}throw c("err")("Could not send IQ in retrieveBusinessDetails")}return a.result});return o.apply(this,arguments)}function a(a){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.type!=="verified_name_hash")throw c("err")("Invalid notification type");var e=d("WAWebContactCollection").ContactCollection.resolveWidsFromHash(a.hash);if(!e)return!1;e=(yield (h||(h=b("Promise"))).all(e.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield n(a));return{wid:a,verifiedName:b}});return function(b){return a.apply(this,arguments)}}())));e.length&&(yield (h||(h=b("Promise"))).all(e.map(function(b){var c=b.wid;b=b.verifiedName;if(b){var e=b.name,f=b.level,g=b.serial,h=b.isApi,i=b.isSmb,j=b.privacyMode;return k({wid:c,verifiedName:e,level:f,stanzaId:a.stanzaId,ts:a.ts,serial:g,isApi:h,isSmb:i,privacyMode:j})}else if(b===void 0)return d("WAWebHandleBusinessRemoval").handleBusinessRemoval(c,a.stanzaId,a.ts)})));return!0});return p.apply(this,arguments)}function e(a){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.jid,c=a.stanzaId,e=a.ts;a=a.verifiedName;var f=a.serial;f=f===void 0?"":f;var g=a.level,h=a.isApi,i=a.isSmb,j=a.privacyMode;a=a.name;if(!a){var l;if(((l=d("WAWebContactCollection").ContactCollection.get(b))==null?void 0:l.verifiedName)!=null){a=((l=d("WAWebContactCollection").ContactCollection.get(b))==null?void 0:l.verifiedName)||""}else{l=(yield n(b));if(!l)return;a=l.name}}return k({verifiedName:a,level:g,stanzaId:c,ts:e,wid:b,serial:f,isApi:h,isSmb:i,privacyMode:j})});return q.apply(this,arguments)}g.handleVerifiedBusinessNameNotificationHash=a;g.handleVerifiedBusinessNameNotificationContact=e}),98);
__d("WAWebHandleBusinessProductCatalogNotification",["Promise","WAWebCatalogCollection","WAWebUserPrefsMeUser","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=d("WAWebCatalogCollection").CatalogCollection.get(d("WAWebUserPrefsMeUser").getMeUser().toString());if(c){var e=[];a.forEach(function(a){e.push(c.refreshProduct(a))});yield (h||(h=b("Promise"))).all(e)}});return i.apply(this,arguments)}function c(a){var c=d("WAWebCatalogCollection").CatalogCollection.get(d("WAWebUserPrefsMeUser").getMeUser().toString());if(c==null?void 0:c.collections)for(var e=0;e<a.collectionIds.length;e++){var f=c.collections.get(a.collectionIds[e]);f&&f.set(a.reviewStatuses[e])}return(h||(h=b("Promise"))).resolve()}g.handleProductNotification=a;g.handleCollectionNotification=c}),98);
__d("WAWebHandleBusinessProfile",["Promise","WAWebBusinessProfileCollection","WAWebContactCollection","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.from;a=d("WAWebWidFactory").createWidFromWidLike(a.toString());yield k([a])});return i.apply(this,arguments)}function c(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.hash;a=d("WAWebContactCollection").ContactCollection.resolveWidsFromHash(a);if(!a)return!1;yield k(a);return!0});return j.apply(this,arguments)}function k(a){a=a.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=Boolean(d("WAWebBusinessProfileCollection").BusinessProfileCollection.getValid(a));a=(yield d("WAWebBusinessProfileCollection").BusinessProfileCollection.update(a));a=Array.isArray(a)?a:[a];for(a of a)b||(a.stale=!0)});return function(b){return a.apply(this,arguments)}}());return(h||(h=b("Promise"))).all(a)}g.handleBusinessProfile=a;g.handleBusinessProfileHash=c}),98);
__d("WAWebHandleCTWASuggestion",["WALogger","WATimeUtils","WAWebBackendApi","WAWebBizGatingUtils","WAWebSchemaCTWASuggestion","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleCTWASuggestion: suggestion de-duped"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleCTWASuggestion: expired"]);i=function(){return a};return a}function a(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a.type==="banner"?yield k(a):(a.type,yield m(a))});return j.apply(this,arguments)}function k(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(!d("WAWebBizGatingUtils").adsActionBannersEnabled())return;if(!d("WATimeUtils").isInFuture(a.expiresAt)){d("WALogger").WARN(i()).devConsole(a);return}try{yield d("WAWebSchemaCTWASuggestion").getCTWASuggestionTable().create(a)}catch(b){d("WALogger").WARN(h()).devConsole(a);return}d("WAWebBackendApi").frontendFireAndForget("newCTWASuggestion",{suggestion:a})});return l.apply(this,arguments)}function m(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("WAWebSchemaCTWASuggestion").getCTWASuggestionTable().remove(a.id),d("WAWebBackendApi").frontendFireAndForget("revokeCTWASuggestion",{suggestion:a})});return n.apply(this,arguments)}g.handleCTWASuggestion=a}),98);
__d("WAWebHandlePrivacySettingsNotification",["WAWebBackendApi"],(function(a,b,c,d,e,f,g){function a(a){d("WAWebBackendApi").frontendFireAndForget("smbDataSharingSettingUpdate",{smbDataSharingSettingValue:a})}g.handleSmbDataSharingSettingNotification=a}),98);
__d("WAWebHandleBusinessNotification",["WADeprecatedWapParser","WALogger","WASmaxBizCtwaAdAccountNonceNotificationRPC","WAWap","WAWebBackendJobsCommon","WAWebBizGatingUtils","WAWebCTWABizAccessTokenNonceManager","WAWebCTWAParsePrivacy","WAWebCTWAParseSuggestion","WAWebCommonParsersVerifiedName","WAWebHandleBusinessNameChange","WAWebHandleBusinessProductCatalogNotification","WAWebHandleBusinessProfile","WAWebHandleBusinessRemoval","WAWebHandleCTWASuggestion","WAWebHandlePrivacySettingsNotification","WAWebJidToWid","WAWebOrchestratorNonPersistedJob","WAWebProductTypes.flow","WAWebSubscriptions","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Parsing Error: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["error while parsing: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["business notification received, node: ",""]);j=function(){return a};return a}var k=new(c("WADeprecatedWapParser"))("businessNotificationParser",function(a){a.assertTag("notification");var b=a.attrString("id"),e=a.attrWapJid("from"),f=a.attrTime("t");b={stanzaId:b,from:e,ts:f};if(a.hasChild("remove")){e=a.child("remove");return e.hasAttr("jid")?babelHelpers["extends"]({type:"remove_jid",jid:d("WAWebJidToWid").chatJidToChatWid(e.attrChatJid("jid"))},b):babelHelpers["extends"]({type:"remove_hash",hash:e.attrString("hash")},b)}else if(a.hasChild("verified_name")){e=a.child("verified_name");return e.hasAttr("jid")?babelHelpers["extends"]({type:"verified_name_jid",jid:d("WAWebJidToWid").chatJidToChatWid(e.attrChatJid("jid")),verifiedName:c("WAWebCommonParsersVerifiedName")(e)},b):babelHelpers["extends"]({type:"verified_name_hash",hash:e.attrString("hash")},b)}else if(a.hasChild("profile")){f=a.child("profile");e=f.maybeAttrString("hash");return e?babelHelpers["extends"]({type:"profile_hash",hash:e},b):babelHelpers["extends"]({type:"profile"},b)}else if(a.hasChild("product_catalog")){f=a.child("product_catalog");if(f.hasChild("product")){var g=[];f.forEachChildWithTag("product",function(a){a=a.child("id").contentString();g.push(a)});return babelHelpers["extends"]({type:"product",productsIds:g},b)}else if(f.hasChild("collection")){var h=[],i=[];f.forEachChildWithTag("collection",function(a){if(a.hasChild("status_info")){var b;b={reviewStatus:(b=d("WAWebProductTypes.flow").asProductReviewType(a.child("status_info").child("status").contentString()))!=null?b:"APPROVED",rejectReason:(b=a.child("status_info").maybeChild("reject_reason"))==null?void 0:b.contentString(),commerceUrl:(b=a.child("status_info").maybeChild("commerce_url"))==null?void 0:b.contentString()};h.push(a.attrString("id"));i.push(b)}});return babelHelpers["extends"]({type:"collection",collectionIds:h,reviewStatuses:i},b)}}else if(a.hasChild("subscriptions")){e=a.child("subscriptions");var j=[];e.forEachChildWithTag("subscription",function(a){var b=a.attrString("status"),c=a.maybeAttrInt("subscription_end_time");a=a.attrString("id");j.push({id:a,status:b,expirationDate:c})});return babelHelpers["extends"]({type:"subscriptions",subscriptions:j},b)}else if(a.hasChild("ctwa_suggestion")){if(d("WAWebBizGatingUtils").adsActionBannersEnabled()){f=d("WAWebCTWAParseSuggestion").parseCTWASuggestion(a);if(f!=null)return babelHelpers["extends"]({type:"ctwa_suggestion",suggestion:f},b)}}else if(a.hasChild("privacy")){if(d("WAWebBizGatingUtils").smbDataSharingConsentEnabled()){e=d("WAWebCTWAParsePrivacy").parseCTWAPrivacy(a);if(e!=null)return babelHelpers["extends"]({type:"privacy",privacy:e},b)}}else if(a.hasChild("wa_ad_account_nonce")&&d("WAWebBizGatingUtils").adManagementEnabled()){f=d("WASmaxBizCtwaAdAccountNonceNotificationRPC").receiveNonceNotificationRPC(a.node());return babelHelpers["extends"]({type:"wa_ad_account_nonce",nonce:d("WAWebCTWABizAccessTokenNonceManager").castToNonce(f.parsedRequest.waAdAccountNonceElementValue)},b)}return babelHelpers["extends"]({type:"unknown"},b)});function l(a,b,c){return c?d("WAWap").wap("ack",{id:d("WAWap").CUSTOM_STRING(a),to:b,"class":"notification",type:"business"},d("WAWap").wap("user",{side_list:"out"})):d("WAWap").wap("ack",{id:d("WAWap").CUSTOM_STRING(a),to:b,"class":"notification",type:"business"})}function m(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WALogger").DEV(j(),a);var b=k.parse(a);if(b.error){d("WALogger").DEV(i(),a.toString());d("WALogger").ERROR(h(),b.error.toString());throw b.error}a=b.success;switch(a.type){case"verified_name_hash":b=(yield d("WAWebHandleBusinessNameChange").handleVerifiedBusinessNameNotificationHash(a));return l(a.stanzaId,a.from,!b);case"verified_name_jid":yield d("WAWebHandleBusinessNameChange").handleVerifiedBusinessNameNotificationContact(a);return l(a.stanzaId,a.from,!1);case"remove_hash":b=(yield d("WAWebHandleBusinessRemoval").handleBusinessRemovalNotificationHash(a));return l(a.stanzaId,a.from,!b);case"remove_jid":yield d("WAWebHandleBusinessRemoval").handleBusinessRemovalNotificationContact(a);return l(a.stanzaId,a.from,!1);case"profile":yield d("WAWebHandleBusinessProfile").handleBusinessProfile(a);return l(a.stanzaId,a.from,!1);case"profile_hash":b=(yield d("WAWebHandleBusinessProfile").handleBusinessProfileHash(a));return l(a.stanzaId,a.from,!b);case"product":yield d("WAWebHandleBusinessProductCatalogNotification").handleProductNotification(a.productsIds);return l(a.stanzaId,a.from,!1);case"collection":yield d("WAWebHandleBusinessProductCatalogNotification").handleCollectionNotification(a);return l(a.stanzaId,a.from,!1);case"subscriptions":yield d("WAWebSubscriptions").applySubscriptions(a.subscriptions);return l(a.stanzaId,a.from,!1);case"ctwa_suggestion":yield d("WAWebHandleCTWASuggestion").handleCTWASuggestion(a.suggestion);return l(a.stanzaId,a.from,!1);case"privacy":d("WAWebHandlePrivacySettingsNotification").handleSmbDataSharingSettingNotification(a.privacy.smbDataSharingSetting);return l(a.stanzaId,a.from,!1);case"wa_ad_account_nonce":d("WAWebCTWABizAccessTokenNonceManager").setNonceFromPushNotification(a.nonce);return l(a.stanzaId,a.from,!1);default:a.type;return l(a.stanzaId,a.from,!1)}});return n.apply(this,arguments)}function a(a){var b=d("WAWebBackendJobsCommon").getNonCriticalNotificationPriority(Boolean(a.attrs.offline));return d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("handleBusinessNotification",function(a){return m(a.node)},{priority:b}).waitUntilCompleted({node:a})}g.handleBusinessNotification=m;g.handleBusinessNotificationJob=a}),98);
__d("WAWebHandleChatState",["WAWebChangePresenceHandlerAction","WAWebJidToWid","WAWebUpdateLidMetadataJob","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.jid;a=a.status;b=d("WAWebJidToWid").userJidToUserWid(b);yield c("WAWebChangePresenceHandlerAction")({id:b,type:a});return"NO_ACK"});return function(b){return a.apply(this,arguments)}}();e=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.jid,e=a.status,f=a.participant;a=a.participantPn;b=d("WAWebJidToWid").chatJidToChatWid(b);f=d("WAWebJidToWid").userJidToUserWid(f);a=a==null?null:d("WAWebJidToWid").userJidToUserWid(a);a!=null&&(yield d("WAWebUpdateLidMetadataJob").createLidPnMappingsJob([{lid:f,pn:a}],!0));yield c("WAWebChangePresenceHandlerAction")({id:b,type:e,participant:f});return"NO_ACK"});return function(b){return a.apply(this,arguments)}}();g.handleIndividualChatState=a;g.handleGroupChatState=e}),98);
__d("WAWebHandleContactNotification",["Promise","WADeprecatedWapParser","WALogger","WANullthrows","WAWap","WAWebBackendJobsCommon","WAWebChangeProfilePicThumb","WAWebChatCollection","WAWebContactCollection","WAWebContactGetters","WAWebContactSyncBridge","WAWebContactTextStatusBridge","WAWebHandleSingleMsg","WAWebJidToWid","WAWebMsgKey","WAWebMsgType","WAWebOrchestratorNonPersistedJob","WAWebPresenceCollection","WAWebProfilePicConstants","WAWebSchemaChat","WAWebStatusCollection","WAWebStatusContactAction","WAWebTextStatusGatingUtils","WAWebUpdateLidMetadataJob","WAWebUpdateTextStatusForContact","WAWebUserPrefsMeUser","WAWebWidFactory","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleContactsNotification: unhandled notification of type ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["received contact sync notification"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleContactsNotification: an update command does not include jid"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Parsing Error: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["error while parsing: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["notification.oldJid is null"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(['Unexpected "contacts" notification']);o=function(){return a};return a}var p=new(c("WADeprecatedWapParser"))("incomingContactsNotification",function(a){a.assertTag("notification");var b=a.attrString("id"),c=a.attrWapJid("from"),e=a.attrTime("t"),f=a.attrString("t");c={from:c,ts:e,rawTs:f,stanzaId:b};if(a.hasChild("update")){var g=a.child("update");if(g.hasAttr("jid"))return babelHelpers["extends"]({type:"update",jid:d("WAWebJidToWid").userJidToUserWid(g.attrUserJid("jid"))},c);else if(g.hasAttr("hash")){e=d("WAWebContactCollection").ContactCollection.findFirst(function(a){return((a=d("WAWebContactGetters").getUserhash(a))==null?void 0:a.slice(0,4))===g.attrString("hash")});return e==null?babelHelpers["extends"]({type:"empty",jid:null},c):babelHelpers["extends"]({type:"update",jid:e.id},c)}return babelHelpers["extends"]({type:"empty",jid:null},c)}else if(a.hasChild("add")){f=a.child("add");return babelHelpers["extends"]({type:"add",hash:f.hasContent()?f.contentBytes():null,jid:null},c)}else if(a.hasChild("remove")){b=a.child("remove");return babelHelpers["extends"]({type:"remove",jid:d("WAWebJidToWid").userJidToUserWid(b.attrUserJid("jid"))},c)}else if(a.hasChild("modify")){e=a.child("modify");return babelHelpers["extends"]({type:"modify",jid:d("WAWebJidToWid").userJidToUserWid(e.attrUserJid("new")),oldJid:d("WAWebJidToWid").userJidToUserWid(e.attrUserJid("old")),lid:e.maybeAttrUserJid("new_lid")?d("WAWebJidToWid").userJidToUserWid(e.attrUserJid("new_lid")):null,oldLid:e.maybeAttrUserJid("old_lid")?d("WAWebJidToWid").userJidToUserWid(e.attrUserJid("old_lid")):null},c)}else if(a.hasChild("sync")){f=a.child("sync");return babelHelpers["extends"]({type:"sync",after:f.attrTime("after"),jid:null},c)}d("WALogger").WARN(o());return babelHelpers["extends"]({type:"empty",jid:null},c)});function q(a,b){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(b.type!=="modify")throw c("err")("Error: genContactChangeNotificationMsg invalid type");else{var e=d("WAWebUserPrefsMeUser").getMeUser(),f=c("WANullthrows")(b.oldJid),g=c("WANullthrows")(b.jid);if(b.lid!=null&&b.oldLid!=null){var h=b.oldLid,i=b.lid;h=[f,g,h,i]}else h=[f,g];return{id:new(c("WAWebMsgKey"))({remote:a,fromMe:!1,id:yield c("WAWebMsgKey").newId()}),from:a,subtype:"change_number",t:b.ts,to:e,type:"notification_template",kind:d("WAWebMsgType").MsgKind.NotificationTemplate,templateParams:h}}});return r.apply(this,arguments)}function s(a,b){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){b=(yield q(a,b));yield d("WAWebHandleSingleMsg").handleSingleMsg(a,b,"changeNumberNotification")});return t.apply(this,arguments)}function u(a){return v.apply(this,arguments)}function v(){v=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.oldJid){var c=a.oldJid,e=a.jid,f=a.oldLid!=null?a.oldLid:null,g=a.lid!=null?a.lid:null,i=[],j=d("WAWebChatCollection").ChatCollection.get(c);j&&i.push({id:c.toString(),changeNumberNewJid:e.toString(),changeNumberOldJid:void 0});j=d("WAWebChatCollection").ChatCollection.get(e);j&&i.push({id:e.toString(),changeNumberNewJid:void 0,changeNumberOldJid:c.toString()});d("WAWebSchemaChat").getChatTable().bulkCreateOrMerge(i).then(function(){i.forEach(function(a){var b=d("WAWebChatCollection").ChatCollection.get(a.id);if(b){var c=a.changeNumberNewJid;a=a.changeNumberOldJid;b.changeNumberNewJid=c!=null?d("WAWebWidFactory").createWid(c):void 0;b.changeNumberOldJid=a!=null?d("WAWebWidFactory").createWid(a):void 0}})});if(f!=null&&g!=null){yield d("WAWebUpdateLidMetadataJob").createLidPnMappingsJob([{lid:(j=d("WAWebWidFactory")).toUserWid(f),pn:j.toUserWid(c)},{lid:j.toUserWid(g),pn:j.toUserWid(e)}],!0)}yield (h||(h=b("Promise"))).all([s(c,a),s(e,a)])}else d("WALogger").LOG(n()).devConsole(a)});return v.apply(this,arguments)}function w(a){return x.apply(this,arguments)}function x(){x=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=p.parse(a);if(c.error){d("WALogger").DEV(m(),a.toString());d("WALogger").ERROR(l(),c.error.toString());throw c.error}a=c.success;c=a.jid;switch(a.type){case"update":if(!c){d("WALogger").WARN(k());return n(a)}var e=d("WAWebPresenceCollection").PresenceCollection.get(c);e&&e.reset();var f=d("WAWebStatusCollection").StatusCollection.get(c);e=f==null?null:d("WAWebStatusContactAction").getStatus(c).then(function(a){f.set({status:a.status})});c=d("WAWebContactCollection").ContactCollection.get(c);var g;c&&d("WAWebTextStatusGatingUtils").receiveTextStatusEnabled()&&(g=d("WAWebContactTextStatusBridge").getTextStatus(c.id,c.textStatusLastUpdateTime).then(function(a){var b=a.text,c=a.emoji,e=a.ephemeralDurationSeconds,f=a.lastUpdateTime;a=a.id;return d("WAWebUpdateTextStatusForContact").updateTextStatusForContact(a,b,c,e,f!=null?Number(f):void 0)}));c=d("WAWebChangeProfilePicThumb").changeProfilePicThumb(a.jid,d("WAWebProfilePicConstants").ProfilePicCommand.Set);yield (h||(h=b("Promise"))).all([c,e,g]);return n(a);case"modify":yield u(a);return n(a);case"sync":d("WALogger").LOG(j()).tags("contact-sync");yield d("WAWebContactSyncBridge").contactSync();return n(a);default:d("WALogger").LOG(i(),a.type);return n(a)}function n(a,b){return d("WAWap").wap("ack",{id:d("WAWap").CUSTOM_STRING(a.stanzaId),to:a.from,"class":"notification",type:"contacts"},b)}});return x.apply(this,arguments)}function a(a){var b=d("WAWebBackendJobsCommon").getNonCriticalNotificationPriority(Boolean(a.attrs.offline));return d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("handleContactNotification",function(a){return w(a.node)},{priority:b}).waitUntilCompleted({node:a})}g["default"]=a}),98);
__d("WAWebHandleDeviceNotification",["Promise","WADeprecatedWapParser","WALogger","WAWap","WAWebAdvHandlerApi","WAWebApiPendingDeviceSync","WAWebCommsWapMd","WAWebJidToWid","WAWebJidUtils","WAWebOfflineDeviceCache","WAWebOfflineHandler","WAWebSchemaContact","WAWebSyncDeviceAdvDeviceListJob","WAWebUpdateLidMetadataJob","WAWebVoip","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleDevicesNotification - unknown notification type ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleDevicesNotification - update error: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["could not find side contact hash for device update operation"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleDevicesNotification - remove error: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleDevicesNotification - add error: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Parsing Error: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["error while parsing: ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(['Unknown Devices Notification: Devices notification without "remove" and "add" nodes']);p=function(){return a};return a}var q={add:"add",remove:"remove",update:"update"},r=new(c("WADeprecatedWapParser"))("incomingDevicesNotification",function(a){a.assertTag("notification");a.assertTag("notification");a.assertAttr("type","devices");var b,c,e,f=[],g=null;if(a.hasChild("remove"))c=q.remove,b=a.child("remove");else if(a.hasChild("add"))c=q.add,b=a.child("add");else if(a.hasChild("update"))c=q.update,b=a.child("update");else{d("WALogger").WARN(p());throw a.createParseError("Failed to parse devices notification")}if(c===q.add||c===q.remove){var h=b.maybeChild("key-index-list");if(!h)throw a.createParseError("key index node is required to handle device add or remove notification");var i=h.attrTime("ts");if(c===q.remove&&!i)throw a.createParseError("timestamp is required to handle device remove notification");e={ts:i,signedKeyIndexBytes:c===q.add?h.contentBytes():null};i=b.child("device");h=d("WAWebJidUtils").extractDeviceId(i.attrDeviceJid("jid"));var j=i.hasAttr("lid")?d("WAWebJidUtils").extractDeviceId(i.attrDeviceJid("lid")):null;i=i.hasAttr("key-index")?i.attrInt("key-index"):null;f=[{id:h,keyIndex:i}];j!=null&&(g=[{id:j,keyIndex:i}])}return{type:c,stanzaId:a.attrString("id"),hash:b.attrString(c===q.update?"hash":"device_hash"),lidHash:b.hasAttr("device_lid_hash")?b.attrString(c===q.update?"hash":"device_lid_hash"):null,user:d("WAWebJidToWid").deviceJidToUserWid(a.attrDeviceJid("from")),lidUser:a.hasAttr("lid")?d("WAWebJidToWid").deviceJidToUserWid(a.attrDeviceJid("lid")):null,deviceList:f,lidDeviceList:g,keyIndex:e}});function a(a){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=r.parse(a);if(e.error){d("WALogger").DEV(o(),a.toString());d("WALogger").ERROR(n(),e.error.toString());throw e.error}var f=e.success,g=d("WAWap").wap("ack",{to:d("WAWebCommsWapMd").USER_JID(f.user),id:d("WAWap").CUSTOM_STRING(f.stanzaId),"class":"notification"});a={wid:f.user,devices:{deviceList:f.deviceList,keyIndex:f.keyIndex},type:f.type,hash:f.hash};e=f.lidUser!=null&&f.lidHash!=null&&f.lidDeviceList!=null?{wid:f.lidUser,devices:{deviceList:f.lidDeviceList,keyIndex:f.keyIndex},type:f.type,hash:f.lidHash}:null;a=[a,e].filter(Boolean);e=[];f.lidUser!=null&&f.user!=null&&e.push({lid:f.lidUser,pn:f.user});if(!d("WAWebOfflineHandler").OfflineMessageHandler.isResumeFromRestartComplete()){e.length>0&&(yield d("WAWebUpdateLidMetadataJob").createLidPnMappingsJob(e,!1));a.forEach(function(a){a=a.wid;return d("WAWebOfflineDeviceCache").OfflinePendingDeviceCache.addOfflinePendingDevice(a.toString(),g)});return"NO_ACK"}e.length>0&&(yield d("WAWebUpdateLidMetadataJob").createLidPnMappingsJob(e,!0));yield (h||(h=b("Promise"))).all(a.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=a.wid,g=a.devices,n=a.type;a=a.hash;if(d("WAWebOfflineHandler").OfflineMessageHandler.isResumeOnSocketDisconnectInProgress())yield d("WAWebApiPendingDeviceSync").addUserToPendingDeviceSync([e.toString()]);else if(f.type===q.add)try{yield d("WAWebAdvHandlerApi").handleADVDeviceNotification({wid:e,devices:g,type:n})}catch(a){d("WALogger").WARN(m(),a)}else if(f.type===q.remove)try{yield d("WAWebAdvHandlerApi").handleADVDeviceNotification({wid:e,devices:g,type:n});n=((g=f.deviceList)==null?void 0:g.map(function(a){return a.id}))||[];var o=e.user,p=e.server;yield (h||(h=b("Promise"))).all(n.map(function(a){a=d("WAWebWidFactory").createDeviceWidFromUserAndDevice(o,p,a);c("WAWebVoip").Voip.notifyDeviceIdentityChangedOrDeleted(a,!0)}))}catch(a){d("WALogger").WARN(l(),a)}else if(f.type===q.update){g=(yield d("WAWebSchemaContact").getContactTable().equals(["contactHash"],a));if(g.length===0)d("WALogger").WARN(k());else try{yield d("WAWebSyncDeviceAdvDeviceListJob").syncDeviceListJob([d("WAWebWidFactory").createWid(g[0].id)],"notification",null)}catch(a){d("WALogger").WARN(j(),a)}}else d("WALogger").WARN(i(),f.type)});return function(b){return a.apply(this,arguments)}}()));return g});return s.apply(this,arguments)}g.handleDevicesNotification=a}),98);
__d("WAWebWaOldCodeWamEvent",["WAWebWamCodegenUtils"],(function(a,b,c,d,e,f,g){a=d("WAWebWamCodegenUtils").defineEvents({WaOldCode:[3940,{deviceId:[1,d("WAWebWamCodegenUtils").TYPES.STRING]},[1,1,1],"regular"]});g.WaOldCodeWamEvent=a}),98);
__d("WAWebHandleDeviceSwitchingNotification",["WADeprecatedWapParser","WALogger","WATimeUtils","WAWap","WAWebABProps","WAWebBackendApi","WAWebUserPrefsMeUser","WAWebWaOldCodeWamEvent","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["OTP code has expired, expiry time: "," and current time: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Parsing Error: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["error while parsing: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["DeviceSwitching notification received, node: ",""]);k=function(){return a};return a}var l=new(c("WADeprecatedWapParser"))("incomingDeviceSwitchingNotificationParser",function(a){a.assertTag("notification");var b=a.attrString("id"),c=a.attrWapJid("from");a=a.child("wa_old_registration");var d=a.attrString("code"),e=a.attrTime("expiry_t"),f=a.attrTime("ts");a=a.attrString("device_id");return{stanzaId:b,from:c,code:d,expiryTime:e,ts:f,deviceId:a}});function a(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WALogger").DEV(k(),a);var b=l.parse(a);if(b.error){d("WALogger").DEV(j(),a.toString());d("WALogger").ERROR(i(),b.error.toString());throw b.error}a=b.success;b=d("WAWap").wap("ack",{id:d("WAWap").CUSTOM_STRING(a.stanzaId),"class":"notification",type:"registration",to:a.from});if(!d("WAWebABProps").getABPropConfigValue("web_device_switching"))return b;var c=a.expiryTime,e=d("WATimeUtils").unixTime();if(e>c){d("WALogger").LOG(h(),c,e);return b}c=a.code;d("WAWebBackendApi").frontendFireAndForget("showDeviceSwitchOtp",{otpCode:c});e=d("WAWebUserPrefsMeUser").assertGetMe().getDeviceId().toString();new(d("WAWebWaOldCodeWamEvent").WaOldCodeWamEvent)({deviceId:e}).commit();return b});return m.apply(this,arguments)}g["default"]=a}),98);
__d("WAWebHandleDigestKey",["Promise","WADeprecatedWapParser","WALogger","WAWap","WAWebDigestKeyJob"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Parsing Error: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["error while parsing: ",""]);j=function(){return a};return a}var k=new(c("WADeprecatedWapParser"))("digestKeyParser",function(a){a.assertTag("notification");a.assertAttr("type","encrypt");a.assertFromServer();a.child("digest").assertTag("digest");return{stanzaId:a.attrString("id")}});function a(a){var c=k.parse(a);if(c.error){d("WALogger").DEV(j(),a.toString());d("WALogger").ERROR(i(),c.error.toString());return(h||(h=b("Promise"))).reject(c.error)}a=c.success;var e=d("WAWap").wap("ack",{to:d("WAWap").S_WHATSAPP_NET,id:d("WAWap").CUSTOM_STRING(a.stanzaId),"class":"notification"});return d("WAWebDigestKeyJob").digestKey().then(function(){return e})}g["default"]=a}),98);
__d("WAWebHandleDisappearingModeNotification",["Promise","WADeprecatedWapParser","WAJobOrchestratorTypes","WALogger","WAWap","WAWebCommsWapMd","WAWebJidToWid","WAWebOrchestratorNonPersistedJob","WAWebUpdateDisappearingModeForContact","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleDisappearingModeNotification: received d=",":t=","\n    for ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Parsing Error: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["error while parsing: ",""]);k=function(){return a};return a}var l=new(c("WADeprecatedWapParser"))("disappearingModeNotification",function(a){a.assertTag("notification");var b=a.child("disappearing_mode");return{stanzaId:a.attrString("id"),from:d("WAWebJidToWid").deviceJidToDeviceWid(a.attrDeviceJid("from")),duration:b.attrInt("duration",0),ts:b.attrTime("t")}});function m(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.duration,c=a.from,e=a.stanzaId;a=a.ts;d("WALogger").LOG(i(),b,a,c.toString()).tags("DM","DDM");yield d("WAWebUpdateDisappearingModeForContact").updateDisappearingModeForContact(c,b,a);return d("WAWap").wap("ack",{id:d("WAWap").CUSTOM_STRING(e),to:d("WAWebCommsWapMd").JID(c),"class":"notification",type:"disappearing_mode"})});return n.apply(this,arguments)}function a(a){var c=d("WAJobOrchestratorTypes").JOB_PRIORITY.LOW;return d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("handleDisappearingModeNotification",function(){var c=l.parse(a);if(c.error){d("WALogger").DEV(k(),a.toString()).tags("DM","DDM");d("WALogger").ERROR(j(),c.error.toString());return(h||(h=b("Promise"))).reject(c.error)}return m(c.success)},{priority:c}).waitUntilCompleted({node:a})}g.handleDisappearingModeNotificationJob=a}),98);
__d("WAWebE2ETestPairingConstants",[],(function(a,b,c,d,e,f){a="jest_e2e_pairing_attempt_ongoing";b="jest_e2e_first_read_done";f.PAIRING_ATTEMPT_ONGOING_KEY=a;f.FIRST_QRCODE_READ_DONE=b}),66);
__d("WAWebLazyPoll",["WALogger","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["LazyPoll[","]: Manually Resumed"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["LazyPoll[","]: Manually Paused"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["LazyPoll[","]: Polling..."]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["LazyPoll[","]: Active Resuming"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["LazyPoll[","]: Inactive slowing down"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["LazyPoll[","]: Inactive paused"]);m=function(){return a};return a}a=function(){function a(a){var b=a.name,d=a.handler;d=d===void 0?null:d;var e=a.interval;e=e===void 0?3600:e;var f=a.restingInterval;f=f===void 0?18e3:f;var g=a.sleepWhileResting;g=g===void 0?!1:g;a=a.randomIntervalExtension;a=a===void 0?0:a;this.$6=!1;this.$7=!1;this.$1=b;this.$2=e*1e3;this.$3=f*1e3;this.$4=g;this.$5=a*1e3;this.$12();if(typeof d==="function")this.poll(d);else if(d!=null)throw c("err")("Poll handler must be a function or null")}var e=a.prototype;e.$13=function(){return Math.ceil(Math.random()*this.$5)};e.$14=function(){return(this.$7?this.$3:this.$2)+this.$13()};e.$12=function(){var a=this;document.addEventListener("visibilitychange",function(){if(a.$11)return;document.hidden?a.$4?(d("WALogger").LOG(m(),a.$1),a.$15()):(d("WALogger").LOG(l(),a.$1),a.$7=!0):a.$9&&(d("WALogger").LOG(k(),a.$1),a.$16())},!1)};e.$17=function(){if(!this.$10)return!0;var a=Date.now()-this.$10;return a>=this.$14()};e.$15=function(){self.clearTimeout(this.$8),this.$6=!1};e.$16=function(){this.$7=!1,this.$6=!0,this.$18()};e.$18=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=this;this.$6&&(this.$17()&&(d("WALogger").LOG(j(),this.$1),yield this.$9(),this.$10=Date.now()),self.clearTimeout(this.$8),this.$8=self.setTimeout(function(){return a.$18()},this.$14()))});function c(){return a.apply(this,arguments)}return c}();e.poll=function(a){if(this.$9!=null){this.resume();return}this.$9=a;this.$6=!0;this.$18()};e.pause=function(){d("WALogger").LOG(i(),this.$1),this.$11=!0,this.$15()};e.resume=function(){d("WALogger").LOG(h(),this.$1),this.$11=!1,this.$16()};return a}();g["default"]=a}),98);
__d("WAWebUpdaterUpdatePoll",["JSResource","WALogger","WAWebBuildConstants","WAWebLazyPoll","WAWebPonyfillsFetch","WAWebStreamModel","WAWebUpdater","WAWebUpdaterVersion","WAWebWamPlatform","asyncToGeneratorRuntime","err","gkx"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Updater: App will update. ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Updater: Version check failed"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Updater: Checked at "," ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Update check skipped because user is offline."]);k=function(){return a};return a}var l=d("WAWebBuildConstants").DYN_ORIGIN+"check-update";e=1800;f=3600;var m=e*.1,n={WEB:"web",PWA:"web",DARWIN:"darwin",WIN32:"win32",MACSTORE:"darwin-store",WINSTORE:"win32-store",DARWIN_BETA:"darwin-beta",WIN32_BETA:"win32-beta"},o=function(a){return[a.isBroken,a.isBelowSoft,a.isBelowHard,a.beta].some(Boolean)};e=new(c("WAWebLazyPoll"))({name:"updater",interval:e,restingInterval:f,randomIntervalExtension:m});function a(){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(!c("gkx")("26257")&&!c("gkx")("26260"))return!1;var a=n[d("WAWebWamPlatform").getWamPlatform()],e=d("WAWebUpdaterVersion").SANITIZED_VERSION_STR,f=null;if(!navigator.onLine){d("WALogger").LOG(k());return!1}try{var g=(yield c("WAWebPonyfillsFetch")(l+"?version="+e+"&platform="+a));if(!g.ok)throw c("err")(g.statusText);f=(yield g.json());g=new Date().toISOString();d("WALogger").LOG(j(),g,JSON.stringify({response:f,version:e}))}catch(a){d("WALogger").ERROR(i()).devConsole(a)}if(!f||!o(f))return!1;if(c("gkx")("26259")){g=(yield c("JSResource")("WAWebChatCollection").__setRef("WAWebUpdaterUpdatePoll").load());g=g.ChatCollection;if(f.beta&&g.get("16509655277-1417824428@g.us")===void 0)return!1}g=f;var m=g.isBelowHard,p=g.isBelowSoft,q=g.hardUpdateTime,r=g.currentVersion,s=g.isBroken;g=g.beta;d("WALogger").LOG(h(),JSON.stringify({response:f,version:e}));f=m?q:null;if(a==="web")d("WAWebUpdater").Updater.update(r,p,f);else if(c("gkx")("26259")&&a==="win32"){e=b("WAWebStreamModel").Stream;e!=null&&(e.needsManualDownload=!0)}else if(s){m=b("WAWebStreamModel").Stream;m!=null&&(m.needsManualDownload=!0)}else d("WAWebUpdater").Updater.update(void 0,p,f,g);return!0});return p.apply(this,arguments)}g.PLATFORMS=n;g.hasUpdate=o;g.updatePoll=e;g.checkForUpdates=a}),98);
__d("WAWebHandleFailure",["Promise","WAComms","WADeprecatedWapParser","WALogger","WAWebCmd","WAWebE2ETestPairingConstants","WAWebFailureErrorCodes","WAWebJestE2ELogUtils","WAWebL10N","WAWebLocalStorage","WAWebLogoutReasonConstants","WAWebSocketModel","WAWebUpdater","WAWebUpdaterUpdatePoll","WAWebUpdaterVersion","WAWebWamPlatform","asyncToGeneratorRuntime","err","gkx"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["failure reason "," not implemented yet"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleFailure: got failure code ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleFailure: got failure code ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Incorrect temporary ban data "," ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Client too old or bad user agent, attempting to update the app"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["received failure stanza, reason: ",", logging out"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["received failure stanza, reason: ",", logging out"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose([""," parsing ",""]);p=function(){return a};return a}var q=new(c("WADeprecatedWapParser"))("failureParser",function(a){a.assertTag("failure");return{reason:a.attrInt("reason",400,599),location:a.attrString("location"),code:a.hasAttr("code")?a.attrInt("code"):null,expire:a.hasAttr("expire")?a.attrInt("expire"):null,message:a.maybeAttrString("message"),url:a.maybeAttrString("url"),logoutMessageHeader:a.maybeAttrString("logout_message_header"),logoutMessageSubtext:a.maybeAttrString("logout_message_subtext"),logoutMessageLocale:a.maybeAttrString("logout_message_locale")}});function a(a){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){c("gkx")("26256")&&(d("WAWebJestE2ELogUtils").maybeLogToJestE2eJSConsole("received failure stanza, "+a.toString()),c("WAWebLocalStorage")==null?void 0:c("WAWebLocalStorage").removeItem(d("WAWebE2ETestPairingConstants").PAIRING_ATTEMPT_ONGOING_KEY));var e=q.parse(a);if(e.error){d("WALogger").ERROR(p(),e.error.toString(),a.toString());return(h||(h=b("Promise"))).reject(e.error)}switch(e.success.reason){case d("WAWebFailureErrorCodes").FAILURE_REASON.REASON_LOCKED:d("WALogger").LOG(o(),e.success.reason);a=e.success;var f=a.logoutMessageHeader,g=a.logoutMessageSubtext;a=a.logoutMessageLocale;var r=null;a===c("WAWebL10N").getNormalizedLocale()&&(f!=null||g!=null)&&(r={logoutMessageHeader:f,logoutMessageSubtext:g});yield d("WAWebSocketModel").Socket.clearCredentialsAndStoredData(d("WAWebLogoutReasonConstants").LogoutReason.AccountLocked,r);d("WAWebCmd").Cmd.logout();break;case d("WAWebFailureErrorCodes").FAILURE_REASON.REASON_NOT_AUTHORIZED:case d("WAWebFailureErrorCodes").FAILURE_REASON.REASON_BANNED:d("WALogger").LOG(n(),e.success.reason);yield d("WAWebSocketModel").Socket.clearCredentialsAndStoredData();d("WAWebCmd").Cmd.logout();break;case d("WAWebFailureErrorCodes").FAILURE_REASON.REASON_CLIENT_TOO_OLD:case d("WAWebFailureErrorCodes").FAILURE_REASON.REASON_BAD_USER_AGENT:d("WALogger").LOG(m());a=d("WAWebUpdaterVersion").SANITIZED_VERSION_STR;f=d("WAWebUpdaterUpdatePoll").PLATFORMS[d("WAWebWamPlatform").getWamPlatform()];f==="web"?d("WAWebUpdater").Updater.update(a,!1,0):d("WAWebUpdater").Updater.update(void 0,!1,0,!1);d("WAComms").stopComms();break;case d("WAWebFailureErrorCodes").FAILURE_REASON.REASON_TEMP_BANNED:g=e.success;r=g.code;f=g.expire;a=g.message;g=g.url;if(r!=null&&f!=null)d("WAWebCmd").Cmd.onTemporaryBan({banned:!0,code:r,message:a,url:g,expire:f});else{d("WALogger").ERROR(l(),r,f);throw c("err")("handleFailure: wrong temp ban data")}break;case d("WAWebFailureErrorCodes").FAILURE_REASON.REASON_GENERIC_FAILURE:case d("WAWebFailureErrorCodes").FAILURE_REASON.REASON_INTERNAL_SERVER_ERROR:case d("WAWebFailureErrorCodes").FAILURE_REASON.REASON_EXPERIMENTAL:d("WALogger").WARN(k(),e.success.reason);break;case d("WAWebFailureErrorCodes").FAILURE_REASON.REASON_SERVICE_UNAVAILABLE:d("WALogger").WARN(j(),e.success.reason);d("WAWebCmd").Cmd.showServiceUnavailableError();break;default:d("WALogger").WARN(i(),e.success.reason);return(h||(h=b("Promise"))).reject(c("err")("failure reason "+e.success.reason+" not implemented yet"))}});return r.apply(this,arguments)}g["default"]=a}),98);
__d("WAWebWamEnumNotificationActionType",[],(function(a,b,c,d,e,f){a=Object.freeze({SHOW:1,REMOVE:2});f.NOTIFICATION_ACTION_TYPE=a}),66);
__d("WAWebWamEnumNotificationDestinationType",[],(function(a,b,c,d,e,f){a=Object.freeze({INDIVIDUAL:1,GROUP:2,OTHER:3,CHANNEL:4,INTEROP:5});f.NOTIFICATION_DESTINATION_TYPE=a}),66);
__d("WAWebWamEnumNotificationSourceType",[],(function(a,b,c,d,e,f){a=Object.freeze({PUSH_TRIGGERED:1,MAIN_APP:2,IN_APP:3});f.NOTIFICATION_SOURCE_TYPE=a}),66);
__d("WAWebWamEnumNotificationTypeEnum",[],(function(a,b,c,d,e,f){a=Object.freeze({TEXT_MESSAGE:1,VOICE_MESSAGE:2,FILE_MESSAGE:3,PHOTO_MESSAGE:4,VIDEO_MESSAGE:5,MISSED_VOICE_CALL:6,MISSED_VIDEO_CALL:7,STICKER_MESSAGE:8,REACTION_MESSAGE:9,GROUP_INVITE_MESSAGE:10,REQUEST_MEDIA_REUPLOAD:11,WEB_CLIENT_LOGIN:12,BACKUP:13,KEEP_IN_CHAT:14,PAYMENT:15,POLL_MESSAGE:16,LOCATION_MESSAGE:17,WEB_PAGE_MESSAGE:18,FAILED_UPLOAD:19,GDPR_REPORT:20,INCOMING_VOICE_CALL:21,INCOMING_VIDEO_CALL:22,VIDEO_CALL_UPGRADE:23,WAFFLE:24,XPLAT_MIGRATION:25,OTHER:26,INVITE_JOINED:27,SCHEDULED_CALL_LOCAL_REMINDER:28,PTV_MESSAGE:29});f.NOTIFICATION_TYPE_ENUM=a}),66);
__d("WAWebNotificationDeliveryWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumNotificationActionType","WAWebWamEnumNotificationDestinationType","WAWebWamEnumNotificationSourceType","WAWebWamEnumNotificationTypeEnum"],(function(a,b,c,d,e,f,g){b=(a=d("WAWebWamCodegenUtils")).defineEvents({NotificationDelivery:[3748,{clientMessageId:[1,a.TYPES.STRING],notificationAction:[2,d("WAWebWamEnumNotificationActionType").NOTIFICATION_ACTION_TYPE],notificationDeliveryT:[3,a.TYPES.INTEGER],notificationDestination:[4,d("WAWebWamEnumNotificationDestinationType").NOTIFICATION_DESTINATION_TYPE],notificationId:[5,a.TYPES.STRING],notificationSource:[6,d("WAWebWamEnumNotificationSourceType").NOTIFICATION_SOURCE_TYPE],threadId:[7,a.TYPES.STRING],uiNotificationType:[8,d("WAWebWamEnumNotificationTypeEnum").NOTIFICATION_TYPE_ENUM]},[1,1,1],"regular"]});g.NotificationDeliveryWamEvent=b}),98);
__d("WAWebHandleGrowthNotification",["WADeprecatedWapParser","WALogger","WATimeUtils","WAWap","WAWebABProps","WAWebChatFindBridge","WAWebChatMessageCountsWamEvent","WAWebChatThreadLogging","WAWebCreateChat","WAWebHandleSingleMsg","WAWebJidToWid","WAWebMsgKey","WAWebMsgType","WAWebNotificationDeliveryWamEvent","WAWebUserPrefsMeUser","WAWebWamEnumNotificationTypeEnum","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unable to create new chat thread with receiver - {receiverId}"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unable to create new chat thread with receiver - {receiverId}"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Invalid receiver id"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Invalid receiver id"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Parsing Error: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["error while parsing: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Growth notification received, node: ",""]);n=function(){return a};return a}var o={contacts:"contacts","w:growth":"w:growth"},p=new(c("WADeprecatedWapParser"))("incomingGrowthNotificationParser",function(a){a.assertTag("notification");var b=a.attrString("id"),c=a.attrWapJid("from"),d=a.attrEnum("type",o);b={stanzaId:b,from:c,type:d};if(a.hasChild("invite")){c=a.child("invite");if(c.hasChild("receiver")){d=c.child("receiver");return babelHelpers["extends"]({receiverId:d.hasAttr("user")?d.attrUserJid("user"):null,reason:d.hasAttr("reason")?d.attrString("reason"):""},b)}}return b});function a(a){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WALogger").DEV(n(),a);var b=p.parse(a);if(b.error){d("WALogger").DEV(m(),a.toString());d("WALogger").ERROR(l(),b.error.toString());throw b.error}a=b.success;b=a.type;if(d("WAWebABProps").getABPropConfigValue("chat_upsell_for_1on1_invites")&&b==="contacts"){if(!("receiverId"in a)||a.receiverId==null){d("WALogger").DEV(k());d("WALogger").ERROR(j());return}var c=d("WAWebJidToWid").userJidToUserWid(a.receiverId),e="reason"in a&&a.reason==="clicked_invite_link";yield r(c,e)}return d("WAWap").wap("ack",{id:d("WAWap").CUSTOM_STRING(a.stanzaId),"class":"notification",type:b,to:a.from})});return q.apply(this,arguments)}function r(a,b){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=(yield d("WAWebChatFindBridge").findLocal(a.toString()));if(c==null){yield d("WAWebCreateChat").createChat(a,"createChatOnInviteAccept");c=(yield d("WAWebChatFindBridge").findLocal(a.toString()));if(c==null){d("WALogger").DEV(i());d("WALogger").ERROR(h());return}a=c.id;b=(yield t(a,b));c=(yield d("WAWebChatThreadLogging").getChatThreadID(c.id.toJid()));new(d("WAWebNotificationDeliveryWamEvent").NotificationDeliveryWamEvent)({threadId:c,uiNotificationType:d("WAWebWamEnumNotificationTypeEnum").NOTIFICATION_TYPE_ENUM.INVITE_JOINED}).commit();yield d("WAWebHandleSingleMsg").handleSingleMsg(a,b);new(d("WAWebChatMessageCountsWamEvent").ChatMessageCountsWamEvent)({isInviteCreatedThread:!0}).commit()}return});return s.apply(this,arguments)}function t(a,b){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){return{id:new(c("WAWebMsgKey"))({remote:a,fromMe:!1,id:yield c("WAWebMsgKey").newId()}),from:a,subtype:"sender_invite",to:d("WAWebUserPrefsMeUser").getMeUser(),type:"notification_template",kind:d("WAWebMsgType").MsgKind.NotificationTemplate,t:d("WATimeUtils").unixTime(),templateParams:[b.toString()]}});return u.apply(this,arguments)}g["default"]=a}),98);
__d("WASmaxInClientExpirationClientExpirationRequest",["WAResultOrError","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"ib");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"client_expiration");if(!b.success)return b;a=d("WASmaxParseJid").literalJid(d("WASmaxParseJid").attrDomainJid,a,"from","s.whatsapp.net");if(!a.success)return a;b=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,b.value,"t",0,void 0);return!b.success?b:d("WAResultOrError").makeResult({from:a.value,clientExpirationT:b.value})}g.parseClientExpirationRequest=a}),98);
__d("WASmaxClientExpirationClientExpirationRPC",["WASmaxInClientExpirationClientExpirationRequest","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxInClientExpirationClientExpirationRequest").parseClientExpirationRequest(a);if(!a.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("ClientExpiration",{Request:a}));return{parsedRequest:a.value}}g.receiveClientExpirationRPC=a}),98);
__d("WAWebClearDirtyBitsJob",["WADeprecatedSendIq","WADeprecatedWapParser","WALogger","WAWap","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["clearDirtyBits: failed with error"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["clearDirtyBits: success for type: ",""]);i=function(){return a};return a}var j=new(c("WADeprecatedWapParser"))("cleanDirtyReplyParser",function(a){a.assertAttr("type","result");return{}});function a(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.length===0)return;var b=a.map(function(a){return d("WAWap").wap("clean",{type:d("WAWap").CUSTOM_STRING(a.type),timestamp:d("WAWap").INT(a.timestamp)})});b=d("WAWap").wap("iq",{to:d("WAWap").S_WHATSAPP_NET,type:"set",xmlns:"urn:xmpp:whatsapp:dirty",id:d("WAWap").generateId()},b);try{yield d("WADeprecatedSendIq").deprecatedSendIq(b,j),d("WALogger").LOG(i(),a.map(function(a){return a.type}).join(","))}catch(a){d("WALogger").WARN(h()).devConsole(a)}});return k.apply(this,arguments)}g.clearDirtyBits=a}),98);
__d("WAWebMdAppStateDirtyBitsWamEvent",["WAWebWamCodegenUtils"],(function(a,b,c,d,e,f,g){a=d("WAWebWamCodegenUtils").defineEvents({MdAppStateDirtyBits:[2520,{dirtyBitsFalsePositive:[2,d("WAWebWamCodegenUtils").TYPES.BOOLEAN]},[1,20,1e3],"regular"]});g.MdAppStateDirtyBitsWamEvent=a}),98);
__d("WAWebHandleDirtyBits",["Promise","WALogger","WASyncd","WASyncdConst","WAWebAccountSyncJob","WAWebApiPendingDeviceSync","WAWebBackendApi","WAWebClearDirtyBitsJob","WAWebCmd","WAWebEventsWaitForOfflineDeliveryEnd","WAWebMdAppStateDirtyBitsWamEvent","WAWebNewsletterGatingUtils","WAWebOfflineDeviceCache","WAWebOfflineHandler","WAWebPDFNTypes","WAWebQueryAndUpdateGroupMetadataJob","WAWebQueryAndUpdateNewslettersMetadataAction","WAWebTos","WAWebUserPrefsMeUser","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleDirtyBits: handle dirty bits, supported: ",", unsupported: ",""]);i=function(){return a};return a}var j={groups:"groups",account_sync:"account_sync",syncd_app_state:"syncd_app_state",newsletter_metadata:"newsletter_metadata"};c={devices:"devices",picture:"picture",privacy:"privacy",blocklist:"blocklist",notice:"notice"};function k(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a===void 0&&(a=[]);a=a.map(function(a){return d("WAWebAccountSyncJob").AccountSyncType.cast(a)}).filter(Boolean);a.length===0&&(a=Array.from(d("WAWebAccountSyncJob").AccountSyncType.members()));yield (h||(h=b("Promise"))).all(a.map(function(a){if(a===d("WAWebAccountSyncJob").AccountSyncType.DEVICES)return o();else if(a===d("WAWebAccountSyncJob").AccountSyncType.PICTURE)return d("WAWebAccountSyncJob").getAndUpdateProfilePicture();else a===d("WAWebAccountSyncJob").AccountSyncType.PRIVACY?d("WAWebAccountSyncJob").updatePrivacySettings():a===d("WAWebAccountSyncJob").AccountSyncType.BLOCKLIST?d("WAWebAccountSyncJob").updateBlocklist():a===d("WAWebAccountSyncJob").AccountSyncType.NOTICE&&void p()}))});return l.apply(this,arguments)}function m(a){return a.patches!=null&&a.patches.length>0||a.snapshot!=null}function n(){d("WAWebCmd").Cmd.once(d("WAWebCmd").APP_STATE_SYNC_COMPLETED,function(a){a=a.some(m);new(d("WAWebMdAppStateDirtyBitsWamEvent").MdAppStateDirtyBitsWamEvent)({dirtyBitsFalsePositive:!a}).commit()});return d("WASyncd").markCollectionsForSync(Array.from(d("WASyncdConst").CollectionName.members()))}function o(){var a=String(d("WAWebUserPrefsMeUser").getMeUser());if(!d("WAWebOfflineHandler").OfflineMessageHandler.isResumeFromRestartComplete()){d("WAWebOfflineDeviceCache").OfflinePendingDeviceCache.addOfflinePendingDevice(a,null);return(h||(h=b("Promise"))).resolve()}else if(d("WAWebOfflineHandler").OfflineMessageHandler.isResumeOnSocketDisconnectInProgress())return d("WAWebApiPendingDeviceSync").addUserToPendingDeviceSync([a]);return d("WAWebAccountSyncJob").getDevices("notification")}function p(){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield d("WAWebTos").TosManager.run();var a=[d("WAWebNewsletterGatingUtils").getNewsletterProducerTos(),d("WAWebNewsletterGatingUtils").getNewsletterConsumerTos(),d("WAWebNewsletterGatingUtils").getNewsletterAdminInviteTos()],b=[];a.map(function(a){a={id:a,accepted:d("WAWebTos").TosManager.getState(a)===d("WAWebPDFNTypes").NOTICE_STATUS.ACCEPTED};b.push(a)});return d("WAWebBackendApi").frontendFireAndForget("updateUserDisclosures",{userDisclosures:b})});return q.apply(this,arguments)}function a(a){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=a.supported,e=a.unsupported,f=a.protocols;d("WALogger").LOG(i(),c.map(function(a){return a.type}).join(","),e.map(function(a){return a.type}).join(","));a=[].concat(e,c);yield (h||(h=b("Promise"))).all(c.map(function(a){a=a.type;if(a===j.groups)return d("WAWebEventsWaitForOfflineDeliveryEnd").waitForOfflineDeliveryEnd().then(function(){return d("WAWebQueryAndUpdateGroupMetadataJob").queryAndUpdateAllGroupMetadata()});else if(a===j.newsletter_metadata)return d("WAWebEventsWaitForOfflineDeliveryEnd").waitForOfflineDeliveryEnd().then(function(){return d("WAWebQueryAndUpdateNewslettersMetadataAction").queryAndUpdateAllNewsletterMetadataAction(d("WAWebQueryAndUpdateNewslettersMetadataAction").NewsletterMetadataUpdateEntryPoint.DirtyBit,{messageCount:1})});else if(a===j.account_sync)return k(f);else if(a===j.syncd_app_state)return n()}));return d("WAWebClearDirtyBitsJob").clearDirtyBits(a)});return r.apply(this,arguments)}g.SUPPORTED_DIRTY_TYPE=j;g.SUPPORTED_DIRTY_PROTOCOLS=c;g.handleDirtyBits=a}),98);
__d("WAWebHandleInfoBulletinTypes.flow",[],(function(a,b,c,d,e,f){a=Object.freeze({DIRTY:"dirty",ROUTING:"edge_routing",OFFLINE:"offline",OFFLINE_PREVIEW:"offline_preview",TOS:"tos",THREAD_META:"thread_metadata",CLIENT_EXPIRATION:"client_expiration",OFFLINE_PRIORITY_COMPLETE:"priority_offline_complete"});f.INFO_TYPE=a}),66);
__d("WAWebHandleRoutingInfo",["WAHex","WALogger","WAWebUserPrefsMultiDevice","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleInfoBulletin setting and domain: "," and edgeRouting:"]);h=function(){return a};return a}var i={fb:"fb",sl:"sl"};function a(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.domain;if(!b){var c=(yield d("WAWebUserPrefsMultiDevice").getRoutingInfo());b=c?c.domain:i.fb}c=d("WAHex").bytesToBuffer(a.edgeRouting);yield d("WAWebUserPrefsMultiDevice").setRoutingInfo({domain:b,edgeRouting:c});d("WALogger").LOG(h(),b).devConsole(c)});return j.apply(this,arguments)}g.DOMAINS=i;g.handleRoutingInfo=a}),98);
__d("WAWebHandleServerClientExpiration",["WATimeUtils","WAWebBuildConstants","WAWebCmd","WAWebUpdaterHardExpireTime","WAWebUserPrefsMultiDevice"],(function(a,b,c,d,e,f,g){function a(a){var b=parseInt(c("WAWebUpdaterHardExpireTime"),10);if(a==null)d("WAWebUserPrefsMultiDevice").clearServerClientExpirationOverride();else{var e;e=(e=d("WAWebUserPrefsMultiDevice").getServerClientExpirationOverride())==null?void 0:e.timestamp;if(e!=null&&a>=e||a>=b)return;e=d("WATimeUtils").futureUnixTime(3*d("WATimeUtils").DAY_SECONDS);e=Math.max(e,Math.min(a,b));d("WAWebUserPrefsMultiDevice").setServerClientExpirationOverride(""+e,d("WAWebBuildConstants").VERSION_BASE);d("WAWebCmd").Cmd.serverUpdatedClientExpiration()}}g.handleServerClientExpiration=a}),98);
__d("WAWebMdAppStateOfflineNotificationsWamEvent",["WAWebWamCodegenUtils"],(function(a,b,c,d,e,f,g){a=d("WAWebWamCodegenUtils").defineEvents({MdAppStateOfflineNotifications:[2602,{redundantCount:[1,d("WAWebWamCodegenUtils").TYPES.INTEGER]},[1,20,1e3],"regular"]});g.MdAppStateOfflineNotificationsWamEvent=a}),98);
__d("WAWebHandleServerSyncNotification",["Promise","WADeprecatedWapParser","WALogger","WASyncd","WASyncdCollectionUtils","WASyncdConst","WAWap","WAWebMdAppStateOfflineNotificationsWamEvent","WAWebSyncBootstrap"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Parsing Error: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["error while parsing: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: unknown collection name in notification: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: filtered non critical collections during bootstrap. new collections: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: incoming sync notification for collections\n    ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(['handleServerSyncNotification: "from" is not domain jid "s.whatsapp.net"']);n=function(){return a};return a}var o=new Map(),p=new(c("WADeprecatedWapParser"))("serverSyncNotification",function(a){a.assertTag("notification");if(!a.hasChild("collection"))throw a.createParseError("Server sync notification does not contain any collections");var b=a.attrString("id"),c=new Map(a.mapChildrenWithTag("collection",function(a){return[a.attrString("name"),a.attrInt("version")]})),e=a.hasAttr("offline");a=a.attrString("from");a!==d("WAWap").S_WHATSAPP_NET.toString()&&d("WALogger").ERROR(n());return{changedCollections:c,stanzaId:b,offline:e}});function q(a){if(a.changedCollections){var e=new Map();for(var f=a.changedCollections,g=Array.isArray(f),i=0,f=g?f:f[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var j;if(g){if(i>=f.length)break;j=f[i++]}else{i=f.next();if(i.done)break;j=i.value}j=j;var n=j[0];j=j[1];var p=d("WASyncdConst").CollectionName.cast(n);p!=null?e.set(p,j):d("WALogger").WARN(k(),n)}p=Array.from(e.keys());a.offline&&p.forEach(function(a){var b=o.get(a);b!=null?o.set(a,b+1):o.set(a,1)});d("WALogger").LOG(m(),Array.from(e.entries()).map(function(b){var a=b[0];b=b[1];return a+" v"+b}).join("\n"));c("WAWebSyncBootstrap").isSyncDCriticalDataSyncInProcess()&&(p=p.filter(function(a){return d("WASyncdCollectionUtils").isCriticalCollection(a)}),d("WALogger").LOG(l(),p));void d("WASyncd").markCollectionsForSync(p,e)}return(h||(h=b("Promise"))).resolve(d("WAWap").wap("ack",{id:d("WAWap").CUSTOM_STRING(a.stanzaId),"class":"notification",type:"server_sync",to:d("WAWap").S_WHATSAPP_NET}))}function a(){if(o.size<1)return;var a=0;Array.from(o.entries()).forEach(function(b){b=b[1];a+=b-1});new(d("WAWebMdAppStateOfflineNotificationsWamEvent").MdAppStateOfflineNotificationsWamEvent)({redundantCount:a}).commit();o.clear()}function e(a){var c=p.parse(a);if(c.error){d("WALogger").DEV(j(),a.toString());d("WALogger").ERROR(i(),c.error.toString());return(h||(h=b("Promise"))).reject(c.error)}return q(c.success)}g.reportOfflineNotifications=a;g.handleServerSyncNotification=e}),98);
__d("WAWebParseThreadMetadata",["WAWebHandleInfoBulletinTypes.flow"],(function(a,b,c,d,e,f,g){function a(a){a=a.child(d("WAWebHandleInfoBulletinTypes.flow").INFO_TYPE.THREAD_META);var b={};a.forEachChildWithTag("item",function(a){var c=a.attrChatJid("from");a=a.attrTime("t");b[String(c)]=a});return{chatTimestamp:b}}g.parseThreadMetadata=a}),98);
__d("WAWebHandleInfoBulletin",["WADeprecatedWapParser","WALogger","WASmaxClientExpirationClientExpirationRPC","WATimeUtils","WAWebHandleDirtyBits","WAWebHandleInfoBulletinTypes.flow","WAWebHandleRoutingInfo","WAWebHandleServerClientExpiration","WAWebHandleServerSyncNotification","WAWebOfflineHandler","WAWebParseThreadMetadata","WAWebThreadMetadata","WAWebTos","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleInfoBulletin unrecognized info bulletin"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Parsing Error: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["error while parsing: ",""]);j=function(){return a};return a}var k=new(c("WADeprecatedWapParser"))("infoBulletinParser",function(a){a.assertTag("ib");a.assertFromServer();if(a.hasChild(d("WAWebHandleInfoBulletinTypes.flow").INFO_TYPE.DIRTY)){var b=[],c=[],e=[];a.forEachChildWithTag(d("WAWebHandleInfoBulletinTypes.flow").INFO_TYPE.DIRTY,function(a){var f={type:a.attrString("type"),timestamp:a.attrInt("timestamp")};if(f.type==="account_sync"){a=a.mapChildren(function(a){return a.tag()});a.forEach(function(a){Object.prototype.hasOwnProperty.call(d("WAWebHandleDirtyBits").SUPPORTED_DIRTY_PROTOCOLS,a)&&e.push(a)});c.push(f)}else Object.prototype.hasOwnProperty.call(d("WAWebHandleDirtyBits").SUPPORTED_DIRTY_TYPE,f.type)?c.push(f):b.push(f)});return{type:d("WAWebHandleInfoBulletinTypes.flow").INFO_TYPE.DIRTY,supported:c,unsupported:b,protocols:e}}else if(a.hasChild(d("WAWebHandleInfoBulletinTypes.flow").INFO_TYPE.ROUTING)){var f=a.child(d("WAWebHandleInfoBulletinTypes.flow").INFO_TYPE.ROUTING);return{type:d("WAWebHandleInfoBulletinTypes.flow").INFO_TYPE.ROUTING,edgeRouting:f.child("routing_info").contentBytes(),domain:f.hasChild("dns_domain")?f.child("dns_domain").contentEnum(d("WAWebHandleRoutingInfo").DOMAINS):null}}else if(a.hasChild(d("WAWebHandleInfoBulletinTypes.flow").INFO_TYPE.OFFLINE))return{count:a.child(d("WAWebHandleInfoBulletinTypes.flow").INFO_TYPE.OFFLINE).attrInt("count"),type:d("WAWebHandleInfoBulletinTypes.flow").INFO_TYPE.OFFLINE};else if(a.hasChild(d("WAWebHandleInfoBulletinTypes.flow").INFO_TYPE.OFFLINE_PRIORITY_COMPLETE))return{type:d("WAWebHandleInfoBulletinTypes.flow").INFO_TYPE.OFFLINE_PRIORITY_COMPLETE};else if(a.hasChild(d("WAWebHandleInfoBulletinTypes.flow").INFO_TYPE.OFFLINE_PREVIEW)){return{count:{message:a.child((f=d("WAWebHandleInfoBulletinTypes.flow")).INFO_TYPE.OFFLINE_PREVIEW).attrInt("message"),receipt:a.child(f.INFO_TYPE.OFFLINE_PREVIEW).attrInt("receipt"),notification:a.child(f.INFO_TYPE.OFFLINE_PREVIEW).attrInt("notification")},type:f.INFO_TYPE.OFFLINE_PREVIEW}}else if(a.hasChild(d("WAWebHandleInfoBulletinTypes.flow").INFO_TYPE.TOS)){var g=[];a.child("tos").forEachChildWithTag("notice",function(a){g.push(a.attrString("id"))});return{type:d("WAWebHandleInfoBulletinTypes.flow").INFO_TYPE.TOS,noticeIds:g}}else if(a.hasChild(d("WAWebHandleInfoBulletinTypes.flow").INFO_TYPE.THREAD_META))return{type:d("WAWebHandleInfoBulletinTypes.flow").INFO_TYPE.THREAD_META,threadMeta:d("WAWebParseThreadMetadata").parseThreadMetadata(a)};else if(a.hasChild(d("WAWebHandleInfoBulletinTypes.flow").INFO_TYPE.CLIENT_EXPIRATION)){f=d("WASmaxClientExpirationClientExpirationRPC").receiveClientExpirationRPC(a.getNode());a=f.parsedRequest.clientExpirationT;f=a!=null?d("WATimeUtils").castToUnixTime(a):null;return{type:d("WAWebHandleInfoBulletinTypes.flow").INFO_TYPE.CLIENT_EXPIRATION,newClientExpirationTime:f}}return null});function a(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=k.parse(a);if(b.error){d("WALogger").DEV(j(),a.toString());d("WALogger").ERROR(i(),b.error.toString());throw b.error}a=b.success;if(!a){d("WALogger").WARN(h());return}switch(a.type){case d("WAWebHandleInfoBulletinTypes.flow").INFO_TYPE.DIRTY:yield d("WAWebHandleDirtyBits").handleDirtyBits(a);return"NO_ACK";case d("WAWebHandleInfoBulletinTypes.flow").INFO_TYPE.ROUTING:yield d("WAWebHandleRoutingInfo").handleRoutingInfo(a);return"NO_ACK";case d("WAWebHandleInfoBulletinTypes.flow").INFO_TYPE.OFFLINE:d("WAWebOfflineHandler").OfflineMessageHandler.processOfflineIb(a.count);d("WAWebHandleServerSyncNotification").reportOfflineNotifications();return"NO_ACK";case d("WAWebHandleInfoBulletinTypes.flow").INFO_TYPE.OFFLINE_PREVIEW:yield d("WAWebOfflineHandler").OfflineMessageHandler.processOfflinePreviewIb(a.count);return"NO_ACK";case d("WAWebHandleInfoBulletinTypes.flow").INFO_TYPE.TOS:d("WAWebTos").TosManager.maybeUpdateServer(a.noticeIds);return"NO_ACK";case d("WAWebHandleInfoBulletinTypes.flow").INFO_TYPE.THREAD_META:d("WAWebThreadMetadata").setOfflineThreadMeta(a.threadMeta);return"NO_ACK";case d("WAWebHandleInfoBulletinTypes.flow").INFO_TYPE.CLIENT_EXPIRATION:d("WAWebHandleServerClientExpiration").handleServerClientExpiration(a.newClientExpirationTime);return"NO_ACK";default:return}});return l.apply(this,arguments)}g["default"]=a}),98);
__d("WAWebHandleMediaRetryNotification",["WABase64","WADeprecatedWapParser","WALogger","WANullthrows","WAWap","WAWebCommsWapMd","WAWebCryptoMediaRetry","WAWebProtobufsMmsRetry.pb","WAWebRequestMediaReuploadManager","WAWebUserPrefsMeUser","WAWebWidFactory","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleMediaRetryNotification: ",": id mismatch"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleMediaRetryNotification: ",": mediaKey is not found"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleMediaRetryNotification: ",": received error code: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleMediaRetryNotification: received from not self-primary"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleMediaRetryNotification: received from not self-primary: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleMediaRetryNotification: parsing error: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleMediaRetryNotification: error while parsing: ",""]);n=function(){return a};return a}var o=new(c("WADeprecatedWapParser"))("mediaRetryNotification",function(a){a.assertTag("notification");var b=a.maybeChild("error"),c=a.attrWapJid("from"),e;a.hasAttr("participant")&&(e=a.attrWapJid("participant"));if(b)return{from:c,participant:e,msgId:a.attrString("id"),ciphertext:null,iv:null,errorCode:d("WAWebProtobufsMmsRetry.pb").MediaRetryNotification$ResultType.cast(b.attrInt("code"))};b=a.child("encrypt");return{from:c,participant:e,msgId:a.attrString("id"),ciphertext:b.child("enc_p").contentBytes(),iv:b.child("enc_iv").contentBytes(d("WAWebCryptoMediaRetry").ENC_IV_SIZE),errorCode:null}});function a(a){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=o.parse(a);if(b.error){d("WALogger").DEV(n(),a.toString());d("WALogger").ERROR(m(),b.error.toString());throw b.error}a=b.success;var e=a.from,f=a.participant,g=a.msgId;a=a.errorCode;(e==null||!d("WAWebWidFactory").createDeviceWid(e.toString()).equals(d("WAWebUserPrefsMeUser").getMeUser()))&&(d("WALogger").LOG(l(),e),d("WALogger").WARN(k()).sendLogs("media-retry-notification-not-from-self-primary"));e=d("WAWap").wap("ack",{id:d("WAWap").CUSTOM_STRING(g),"class":"notification",type:"mediaretry",to:e!=null?e:d("WAWebCommsWapMd").USER_JID(d("WAWebUserPrefsMeUser").getMeUser()),participant:f||d("WAWap").DROP_ATTR});if(a!=null){d("WALogger").LOG(j(),g,a);d("WAWebRequestMediaReuploadManager").RequestMediaReuploadManager.resolveMediaReupload({msgId:g,result:a});return e}f=b.success;a=f.ciphertext;b=f.iv;f=d("WAWebRequestMediaReuploadManager").RequestMediaReuploadManager.getMediaKey(g);if(!f){d("WALogger").WARN(i(),g);return e}f=(yield d("WAWebCryptoMediaRetry").decryptMediaRetryNotification(d("WABase64").decodeB64(f),g,c("WANullthrows")(b),c("WANullthrows")(a)));b=f.stanzaId;a=f.directPath;f=f.result;if(b!==g){d("WALogger").LOG(h(),g);throw c("err")("handleMediaRetryNotification: msg id does not match")}d("WAWebRequestMediaReuploadManager").RequestMediaReuploadManager.resolveMediaReupload({msgId:g,result:f,directPath:a});return e});return p.apply(this,arguments)}g["default"]=a}),98);
__d("WAWebMexGroupPropertyUpdateNotificationHandler",["WALogger","WATimeUtils","WAWebGroupType","WAWebHandleGroupNotification","WAWebWidFactory","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[mex][group-property-update][notification] Failed to changed update group property"]);h=function(){return a};return a}function i(a){return c("err")("[mex][group-property-update][notification] unexpected null "+a+" in xwa2_notify_group_on_prop_change")}function a(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=b.xwa2_notify_group_on_prop_change;b=a.id;var c=a.update_time,e=a.updated_by;a=a.properties;if(b==null)throw i("id");if(c==null)throw i("update_time");if(e==null)throw i("updated_by");if(a==null)throw i("properties");var f=e.id;e=e.notify_name;a=a.allow_non_admin_sub_group_creation;if(f==null)throw i("author_id");var g;a!=null&&(g={actionType:d("WAWebGroupType").GROUP_ACTIONS.ALLOW_NON_ADMIN_SUB_GROUP_CREATION,value:a});if(g==null)return;a=d("WAWebWidFactory").createWid(f);f={chatId:d("WAWebWidFactory").createWid(b),ts:d("WATimeUtils").castMilliSecondsToUnixTime(Number(c)),actions:[g],author:a,authorPhoneNumber:a,isLidAddressingMode:!1,pushname:e,externalId:"",offline:null};try{yield d("WAWebHandleGroupNotification").handleAction(f,g,!1)}catch(a){d("WALogger").ERROR(h()).tags("mex").devConsole(a).sendLogs("mex-group-property-update-notification-fail")}});return j.apply(this,arguments)}g.mexHandleGroupPropertyUpdate=a}),98);
__d("WAWebMexNewsletterAdminInviteRevokeNotificationHandler",["asyncToGeneratorRuntime"],(function(a,b,c,d,e,f){"use strict";function a(a,b){return g.apply(this,arguments)}function g(){g=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){return});return g.apply(this,arguments)}f.handleNewsletterAdminInviteRevoke=a}),66);
__d("WASmaxInNewslettersServerNotificationMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"t",0,void 0);if(!b.success)return b;var c=d("WASmaxParseUtils").attrStanzaId(a,"id");if(!c.success)return c;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,a,"offline",0,1024);return!a.success?a:d("WAResultOrError").makeResult({t:b.value,id:c.value,offline:a.value})}g.parseServerNotificationMixin=a}),98);
__d("WASmaxInNewslettersCommonNotificationMixin",["WAResultOrError","WASmaxInNewslettersServerNotificationMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseJid").attrNewsletterJid(a,"from");if(!b.success)return b;var c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","newsletter");if(!c.success)return c;a=d("WASmaxInNewslettersServerNotificationMixin").parseServerNotificationMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({from:b.value,type:c.value},a.value))}g.parseCommonNotificationMixin=a}),98);
__d("WASmaxInNewslettersNewsletterMessageDeliveryUpdateMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"message");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"issue");if(!b.success)return b;a=d("WASmaxParseUtils").attrIntRange(a,"server_id",0,void 0);if(!a.success)return a;b=d("WASmaxParseUtils").attrIntRange(b.value,"code",0,void 0);return!b.success?b:d("WAResultOrError").makeResult({serverId:a.value,issueCode:b.value})}g.parseNewsletterMessageDeliveryUpdateMixin=a}),98);
__d("WASmaxInNewslettersMessageDeliveryUpdateNotificationRequest",["WAResultOrError","WASmaxInNewslettersCommonNotificationMixin","WASmaxInNewslettersNewsletterMessageDeliveryUpdateMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"message");if(!b.success)return b;b=d("WASmaxInNewslettersNewsletterMessageDeliveryUpdateMixin").parseNewsletterMessageDeliveryUpdateMixin(a);return!b.success?b:b}function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"message_delivery_updates");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(b.value,"messages");if(!b.success)return b;a=d("WASmaxInNewslettersCommonNotificationMixin").parseCommonNotificationMixin(a);if(!a.success)return a;b=d("WASmaxParseUtils").mapChildrenWithTag(b.value,"message",1,300,h);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{messageDeliveryUpdatesMessagesMessage:b.value}))}g.parseMessageDeliveryUpdateNotificationRequestMessageDeliveryUpdatesMessagesMessage=h;g.parseMessageDeliveryUpdateNotificationRequest=a}),98);
__d("WASmaxOutNewslettersNotificationClientAckMixin",["WASmaxJsx","WASmaxMixins","WASmaxParseJid","WASmaxParseReference","WASmaxParseUtils","WASmaxParsingFailure","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseReference").attrFromReference(d("WASmaxParseUtils").attrStanzaId,a,["id"]);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(b.error);var c=d("WASmaxParseReference").attrFromReference(d("WASmaxParseJid").attrNewsletterJid,a,["from"]);if(!c.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(c.error);a=d("WASmaxParseReference").attrFromReference(d("WASmaxParseUtils").attrString,a,["type"]);if(!a.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(a.error);b=d("WASmaxJsx").smax("ack",{id:d("WAWap").STANZA_ID(b.value),to:d("WAWap").JID(c.value),"class":"notification",type:d("WAWap").CUSTOM_STRING(a.value)});return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeNotificationClientAckMixin=a}),98);
__d("WASmaxOutNewslettersMessageDeliveryUpdateNotificationResponseAck",["WASmaxJsx","WASmaxOutNewslettersNotificationClientAckMixin"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxOutNewslettersNotificationClientAckMixin").mergeNotificationClientAckMixin(d("WASmaxJsx").smax("ack",null),a);return a}g.makeMessageDeliveryUpdateNotificationResponseAck=a}),98);
__d("WASmaxNewslettersMessageDeliveryUpdateNotificationRPC",["WASmaxInNewslettersMessageDeliveryUpdateNotificationRequest","WASmaxOutNewslettersMessageDeliveryUpdateNotificationResponseAck","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInNewslettersMessageDeliveryUpdateNotificationRequest").parseMessageDeliveryUpdateNotificationRequest(a);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("MessageDeliveryUpdateNotification",{Request:b}));return{parsedRequest:b.value,makeMessageDeliveryUpdateNotificationResponseAck:function(){return d("WASmaxOutNewslettersMessageDeliveryUpdateNotificationResponseAck").makeMessageDeliveryUpdateNotificationResponseAck(a)}}}g.receiveMessageDeliveryUpdateNotificationRPC=a}),98);
__d("WAWebNewsletterHandleMessageDeliveryUpdateNotification",["WAJobOrchestratorTypes","WALogger","WASmaxNewslettersMessageDeliveryUpdateNotificationRPC","WAWebBackendApi","WAWebJidToWid","WAWebNewsletterGatingUtils","WAWebNewsletterMessageDeliveryUpdateToModelUtils","WAWebNewsletterMetadataJob","WAWebNux","WAWebUserPrefsNuxPreferences","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[newsletter][message-delivery-update-notification] Failed to update the db records"]);h=function(){return a};return a}function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=d("WASmaxNewslettersMessageDeliveryUpdateNotificationRPC").receiveMessageDeliveryUpdateNotificationRPC(a);var b=a.makeMessageDeliveryUpdateNotificationResponseAck;a=a.parsedRequest;if(!d("WAWebNewsletterGatingUtils").isNewsletterEnabled())return b();try{yield j(a.from,a.messageDeliveryUpdatesMessagesMessage,a.t)}catch(a){d("WALogger").ERROR(h()).tags("newsletter").devConsole(a).sendLogs("newsletter-message-delivery-update-notification-db-fail")}return b()});return i.apply(this,arguments)}function j(a,b,c){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){var e=d("WAWebJidToWid").newsletterJidToWid(a);b=b.reduce(function(a,b){if(b.issueCode===0)a.updatesToRemove.push(b.serverId);else{b={id:b.serverId,code:b.issueCode};c!=null&&(b.t=c);a.updatesToAdd.push(b)}return a},{updatesToAdd:[],updatesToRemove:[]});var f=b.updatesToAdd;b=b.updatesToRemove;void d("WAWebNewsletterMetadataJob").updateNewsletterMessageDeliveryUpdates(a,f,b,d("WAJobOrchestratorTypes").JOB_PRIORITY.HIGH);f=(yield d("WAWebNewsletterMessageDeliveryUpdateToModelUtils").getMessageDeliveryUpdatesModelToUpdate(a,f,b));b=f.modelUpdatesToAdd;f=f.modelUpdatesToRemove;yield d("WAWebBackendApi").frontendSendAndReceive("updateNewsletterMessageDeliveryUpdate",{id:e,modelUpdatesToAdd:b,modelUpdatesToRemove:f});e=d("WAWebNux").getNewsletterAlertsBannerNuxKey(a);d("WAWebUserPrefsNuxPreferences").resetNux(e)});return k.apply(this,arguments)}g.handleNewsletterMessageDeliveryUpdateNotification=a;g.handleNewsletterMessageDeliveryUpdateNotificationImpl=j}),98);
__d("WAWebMexNewsletterAdminNotificationHandler",["WALogger","WAWebBackendApi","WAWebCommonNewsletterEnums","WAWebJidToWid","WAWebNewsletterAdminNotificationJob","WAWebNewsletterGatingUtils","WAWebNewsletterHandleMessageDeliveryUpdateNotification","WAWebNewsletterValidationUtils","WAWebNux","WAWebUserPrefsNuxPreferences","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[mex][newsletter][notification][admin-metadata] Failed to persist admin metadata notification information on db"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["unexpected null id in xwa2_notify_newsletter_on_admin_metadata_update"]);i=function(){return a};return a}function a(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(!d("WAWebNewsletterGatingUtils").isNewsletterGeosuspendAdminAlertsEnabled())return;a=b.xwa2_notify_newsletter_on_admin_metadata_update;b=a.id;var c=a.thread_metadata;a=a.messages;try{if(b==null){d("WALogger").ERROR(i()).tags("mex","newsletter").devConsole("unexpected null id in xwa2_notify_newsletter_on_admin_metadata_update").sendLogs("newsletter-mex-admin-metadata-notification-unexpected-null-id");return}yield k(b,c);yield m(b,a)}catch(a){d("WALogger").ERROR(h()).tags("mex","newsletter").devConsole(a).sendLogs("mex-newsletter-admin-metadata-notification-db-fail")}});return j.apply(this,arguments)}function k(a,b){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if((b==null?void 0:b.geo_states)==null)return;b=b.geo_states;a=d("WAWebNewsletterValidationUtils").toNewsletterJidOrThrow(a);var c=d("WAWebJidToWid").newsletterJidToWid(a);b=b.reduce(function(a,b){var c=b.country_code;d("WAWebCommonNewsletterEnums").NewsletterState.cast((b=b.state.type)==null?void 0:b.toLowerCase())===d("WAWebCommonNewsletterEnums").NewsletterState.GeoSuspended?a.countriesToAdd.push(c):a.countriesToRemove.push(c);return a},{countriesToAdd:[],countriesToRemove:[]});var e=b.countriesToAdd;b=b.countriesToRemove;if(e.length>0){yield d("WAWebNewsletterAdminNotificationJob").updateGeosuspendedCountry(a,e,!0);d("WAWebBackendApi").frontendFireAndForget("updateGeosuspendedCountry",{id:c,countryCodes:e,toAdd:!0});e=d("WAWebNux").getNewsletterAlertsBannerNuxKey(a);d("WAWebUserPrefsNuxPreferences").resetNux(e)}b.length>0&&(yield d("WAWebNewsletterAdminNotificationJob").updateGeosuspendedCountry(a,b,!1),d("WAWebBackendApi").frontendFireAndForget("updateGeosuspendedCountry",{id:c,countryCodes:b,toAdd:!1}))});return l.apply(this,arguments)}function m(a,b){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(b==null)return;a=d("WAWebNewsletterValidationUtils").toNewsletterJidOrThrow(a);b=b.edges.map(function(a){a=a.node;var b=a.message_delivery_update.issue.code,d;switch(b){case"NEEDS_REVIEW":d=1;break;case"NONE":d=0;break;default:throw c("err")("Unexpected mex issue code: "+b)}return{serverId:parseInt(a.server_id,10),issueCode:d}});yield d("WAWebNewsletterHandleMessageDeliveryUpdateNotification").handleNewsletterMessageDeliveryUpdateNotificationImpl(a,b)});return n.apply(this,arguments)}g.mexHandleNewsletterAdminNotification=a}),98);
__d("WASmaxInNewslettersNewsletterReactionsBlocklistMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"reaction");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"code");return!b.success?b:d("WAResultOrError").makeResult({code:b.value})}function a(a){var b=d("WASmaxParseUtils").assertTag(a,"reactions");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"mode","blocklist");if(!b.success)return b;a=d("WASmaxParseUtils").mapChildrenWithTag(a,"reaction",1,1e3,h);return!a.success?a:d("WAResultOrError").makeResult({mode:b.value,reaction:a.value})}g.parseNewsletterReactionsBlocklistReaction=h;g.parseNewsletterReactionsBlocklistMixin=a}),98);
__d("WASmaxInNewslettersNewsletterReactionsModeOthersMixin",["WAResultOrError","WASmaxInNewslettersEnums","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"reactions");if(!b.success)return b;b=d("WASmaxParseUtils").attrStringEnum(a,"mode",d("WASmaxInNewslettersEnums").ENUM_ALL_BASIC_NONE);return!b.success?b:d("WAResultOrError").makeResult({mode:b.value})}g.parseNewsletterReactionsModeOthersMixin=a}),98);
__d("WASmaxInNewslettersNewsletterReactionsModeOthersOrBlocklistMixinGroup",["WAResultOrError","WASmaxInNewslettersNewsletterReactionsBlocklistMixin","WASmaxInNewslettersNewsletterReactionsModeOthersMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInNewslettersNewsletterReactionsModeOthersMixin").parseNewsletterReactionsModeOthersMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"NewsletterReactionsModeOthers",value:b.value});var c=d("WASmaxInNewslettersNewsletterReactionsBlocklistMixin").parseNewsletterReactionsBlocklistMixin(a);return c.success?d("WAResultOrError").makeResult({name:"NewsletterReactionsBlocklist",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["NewsletterReactionsModeOthers","NewsletterReactionsBlocklist"],[b,c])}g.parseNewsletterReactionsModeOthersOrBlocklistMixinGroup=a}),98);
__d("WASmaxInNewslettersNewsletterReactionSettingsMixin",["WAResultOrError","WASmaxInNewslettersNewsletterReactionsModeOthersOrBlocklistMixinGroup","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"settings");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"reactions");if(!b.success)return b;a=d("WASmaxInNewslettersNewsletterReactionsModeOthersOrBlocklistMixinGroup").parseNewsletterReactionsModeOthersOrBlocklistMixinGroup(b.value);return!a.success?a:d("WAResultOrError").makeResult({reactionsNewsletterReactionsModeOthersOrBlocklistMixinGroup:a.value})}g.parseNewsletterReactionSettingsMixin=a}),98);
__d("WASmaxInNewslettersNewsletterSettingsMetadataMixin",["WAResultOrError","WASmaxInNewslettersNewsletterReactionSettingsMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"metadata");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"settings");if(!b.success)return b;a=d("WASmaxInNewslettersNewsletterReactionSettingsMixin").parseNewsletterReactionSettingsMixin(b.value);return d("WAResultOrError").makeResult({settingsNewsletterReactionSettingsMixin:a.success?a.value:null})}g.parseNewsletterSettingsMetadataMixin=a}),98);
__d("WASmaxInNewslettersJoinNotificationRequest",["WAResultOrError","WASmaxInNewslettersCommonNewsletterMetadataMixin","WASmaxInNewslettersCommonNotificationMixin","WASmaxInNewslettersNewsletterSettingsMetadataMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"join");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(b.value,"metadata");if(!b.success)return b;var c=d("WASmaxInNewslettersCommonNewsletterMetadataMixin").parseCommonNewsletterMetadataMixin(b.value);if(!c.success)return c;b=d("WASmaxInNewslettersNewsletterSettingsMetadataMixin").parseNewsletterSettingsMetadataMixin(b.value);a=d("WASmaxInNewslettersCommonNotificationMixin").parseCommonNotificationMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({joinMetadataCommonNewsletterMetadataMixin:c.value,joinMetadataNewsletterSettingsMetadataMixin:b.success?b.value:null},a.value))}g.parseJoinNotificationRequest=a}),98);
__d("WASmaxOutNewslettersJoinNotificationResponseAck",["WASmaxJsx","WASmaxOutNewslettersNotificationClientAckMixin"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxOutNewslettersNotificationClientAckMixin").mergeNotificationClientAckMixin(d("WASmaxJsx").smax("ack",null),a);return a}g.makeJoinNotificationResponseAck=a}),98);
__d("WASmaxNewslettersJoinNotificationRPC",["WASmaxInNewslettersJoinNotificationRequest","WASmaxOutNewslettersJoinNotificationResponseAck","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInNewslettersJoinNotificationRequest").parseJoinNotificationRequest(a);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("JoinNotification",{Request:b}));return{parsedRequest:b.value,makeJoinNotificationResponseAck:function(){return d("WASmaxOutNewslettersJoinNotificationResponseAck").makeJoinNotificationResponseAck(a)}}}g.receiveJoinNotificationRPC=a}),98);
__d("WAWebNewsletterHandleJoinNotification",["Promise","WALogger","WASmaxNewslettersJoinNotificationRPC","WATimeUtils","WAWebBackendApi","WAWebCreateChat","WAWebNewsletterBackendAddOnsUtils","WAWebNewsletterBackendQueues","WAWebNewsletterGatingUtils","WAWebNewsletterGetMessagesJob","WAWebNewsletterMetadataJob","WAWebNewsletterModelUtils","WAWebNewsletterStorageUtils","WAWebNewsletterSystemMessages","WAWebNewsletterUpdateMsgsRecordsJob","WAWebNewsletterUpdateNewslettersRecordsJob","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[newsletter][join-notification] Failed process join notification ",""]);i=function(){return a};return a}function a(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield (h||(h=b("Promise"))).all([d("WAWebNewsletterBackendQueues").newsletterCreationQueue.wait(),d("WAWebNewsletterBackendQueues").newsletterSubscribeQueue.wait()]);a=d("WASmaxNewslettersJoinNotificationRPC").receiveJoinNotificationRPC(a);var c=a.makeJoinNotificationResponseAck;a=a.parsedRequest;if(!d("WAWebNewsletterGatingUtils").isNewsletterEnabled())return c();var e=a.joinMetadataCommonNewsletterMetadataMixin;e=babelHelpers["extends"]({},e,{idJid:a.from});e=d("WAWebNewsletterModelUtils").mapNewsletterToModels(e);var f=e.chat,g=e.metadata;e=e.pic;try{yield k(f,g,e,a.from)}catch(a){d("WALogger").ERROR(i(),a).tags("newsletter").devConsole(a).sendLogs("newsletter-join-notification-fail")}return c()});return j.apply(this,arguments)}function k(a,b,c,d){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){e=(yield m({chat:a,metadata:b,newsletterJid:e}));var f=e.msgsToStore;e=e.noEarlierMsgs;yield d("WAWebNewsletterUpdateNewslettersRecordsJob").updateNewsletterChatRecords([d("WAWebCreateChat").createNewsletterObjectForStorage(a)]);yield d("WAWebNewsletterMetadataJob").updateNewsletterMetadata(d("WAWebNewsletterStorageUtils").createNewsletterMetadataObjectForStorage(b));yield d("WAWebBackendApi").frontendSendAndReceive("joinNewsletter",{newsletter:a,metadata:b,pic:c,msgs:f,noEarlierMsgs:e})});return l.apply(this,arguments)}function m(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.chat,c=a.metadata;a=a.newsletterJid;try{var e=d("WAWebNewsletterSystemMessages").genNewsletterCreationSystemMessages({id:b.id,name:b.name,t:c.creationTime,role:c.membershipType});a=(yield d("WAWebNewsletterGetMessagesJob").getNewsletterMessages(a,1));var f=a.msgs;e=f.length>0?[f,!1]:[e,!0];var g=e[0];e=e[1];b.t=o(c.creationTime,g);f.length>0&&(yield d("WAWebNewsletterBackendAddOnsUtils").updateAddOnDbRecords(a));yield d("WAWebNewsletterUpdateMsgsRecordsJob").addNewsletterMsgsRecords(g);return{msgsToStore:g,noEarlierMsgs:e}}catch(a){return{msgsToStore:[],noEarlierMsgs:!1}}});return n.apply(this,arguments)}function o(a,b){return d("WATimeUtils").castToUnixTime(Math.min(Math.max((a=a)!=null?a:0,Math.max.apply(Math,b.map(function(a){return(a=a.t)!=null?a:0}))),Date.now()/1e3))}g.handleNewsletterJoinNotification=a;g.handleNewsletterJoin=k}),98);
__d("WAWebMexNewsletterJoinHandler",["WALogger","WAWebMexNewsletterParseUtils","WAWebNewsletterGatingUtils","WAWebNewsletterHandleJoinNotification","WAWebNewsletterModelUtils","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[mex][newsletter][notification][join]"]);h=function(){return a};return a}function a(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(!d("WAWebNewsletterGatingUtils").isNewsletterEnabled())return;a=d("WAWebMexNewsletterParseUtils").parseMexNewsletterResponse(b.xwa2_notify_newsletter_on_join);if(a==null)throw c("err")("cannot parse xwa2_notify_newsletter_on_join response");b=d("WAWebNewsletterModelUtils").mapNewsletterToModels(a);var e=b.chat,f=b.metadata;b=b.pic;try{return yield d("WAWebNewsletterHandleJoinNotification").handleNewsletterJoin(e,f,b,a.idJid)}catch(a){d("WALogger").ERROR(h()).tags("mex","newsletter").devConsole(a).sendLogs("mex-newsletter-notification-join-fail")}});return i.apply(this,arguments)}g.mexHandleNewsletterJoin=a}),98);
__d("WAWebMexNewsletterLeaveHandler",["WAJids","WALogger","WAWebBackendApi","WAWebJidToWid","WAWebNewsletterDBUtils","WAWebNewsletterDeleteChatJob","WAWebNewsletterDeleteMessageAddOns","WAWebNewsletterMetadataJob","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[mex][newsletter][notification][leave]"]);h=function(){return a};return a}function a(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=b.xwa2_notify_newsletter_on_leave.id;if(a==null)throw c("err")("unexpected null id in xwa2_notify_newsletter_on_leave");b=d("WAJids").toNewsletterJid(a);a=d("WAWebJidToWid").newsletterJidToWid(b);if(!(yield d("WAWebNewsletterDBUtils").doesNewsletterExistInStorage(b))){d("WAWebBackendApi").frontendFireAndForget("updateNewsletterSubscriberCount",{id:a,update:{increment:-1}});return}try{yield d("WAWebNewsletterMetadataJob").deleteNewsletterMetadata(b),yield d("WAWebNewsletterDeleteMessageAddOns").deleteNewsletterMessageAddOns(b),yield d("WAWebNewsletterDeleteChatJob").deleteNewsletterChat(a),d("WAWebBackendApi").frontendFireAndForget("deleteNewsletter",{id:a,keep:!0})}catch(a){d("WALogger").ERROR(h()).tags("mex","newsletter").devConsole(a).sendLogs("mex-newsletter-notification-leave-fail")}});return i.apply(this,arguments)}g.mexHandleNewsletterLeave=a}),98);
__d("WAWebNewsletterMetadataUpdateUtils",["WAWebBackendApi","WAWebContactProfilePicThumbBridge","WAWebDBBulkPersistProfilePic","WAWebNewsletterMetadataJob","WAWebNewsletterStorageUtils","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,b,c){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){yield d("WAWebNewsletterMetadataJob").updateNewsletterMetadata(d("WAWebNewsletterStorageUtils").createNewsletterMetadataObjectForStorage(b));if(Object.prototype.hasOwnProperty.call(c,"eurl")){var e=d("WAWebWidFactory").createWid(c.id.toString());yield d("WAWebDBBulkPersistProfilePic").bulkPersistProfilePicChanges([d("WAWebContactProfilePicThumbBridge").mapProfilePictureToProfilePicThumbRowType(e,{id:e,tag:(e=c.tag)!=null?e:void 0,eurl:(e=c.eurl)!=null?e:void 0,previewEurl:(e=c.previewEurl)!=null?e:void 0,stale:c.stale,eurlStale:!1,timestamp:(e=c.timestamp)!=null?e:Date.now()})])}yield d("WAWebBackendApi").frontendSendAndReceive("updateNewsletterMetadata",{metadata:b,newsletter:a,pic:c})});return h.apply(this,arguments)}g.updateNewsletterMetadataAndPic=a}),98);
__d("WAWebMexNewsletterMetadataUpdateNotificationHandler",["WAJids","WALogger","WAWebApiChat","WAWebJidToWid","WAWebMexNewsletterParseUtils","WAWebNewsletterMetadataUpdateUtils","WAWebNewsletterModelUtils","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[mex][newsletter][notification][metadata-update] Failed to update metadata change"]);h=function(){return a};return a}function a(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=b.xwa2_notify_newsletter_on_metadata_update;b=a.id;if(b==null)throw c("err")("unexpected null id in xwa2_notify_newsletter_on_metadata_update");b=d("WAJids").toNewsletterJid(b);b=d("WAWebJidToWid").newsletterJidToWid(b);b=(yield d("WAWebApiChat").getChatRecord(b));if(b==null)return;b=d("WAWebMexNewsletterParseUtils").parseMexNewsletterResponse(a);if(b==null)throw c("err")("Unexpected null metadata for newsletter update notification");try{a=d("WAWebNewsletterModelUtils").mapNewsletterToModels(b);b=a.chat;var e=a.metadata;a=a.pic;yield d("WAWebNewsletterMetadataUpdateUtils").updateNewsletterMetadataAndPic(b,e,a)}catch(a){d("WALogger").ERROR(h()).tags("mex","newsletter").devConsole(a).sendLogs("mex-newsletter-notification-metadata-update-fail")}});return i.apply(this,arguments)}g.mexHandleNewsletterMetadataUpdate=a}),98);
__d("WAWebMexNewsletterMutedChangeHandler",["WAJids","WALogger","WAWebBackendApi","WAWebCreateChat","WAWebNewsletterMetadataQueryJob","WAWebNewsletterModelUtils","WAWebNewsletterUpdateNewslettersRecordsJob","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[mex][newsletter][notification][mute-unmute]"]);h=function(){return a};return a}function a(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=b.xwa2_notify_newsletter_on_mute_change;b=a.id;a=a.mute;if(b==null)throw c("err")("unexpected null id in xwa2_notify_newsletter_on_mute_change");var e;switch(a){case"ON":e="on";break;case"OFF":e="off";break;default:e="undefined"}a=d("WAWebNewsletterMetadataQueryJob").emptyNewsletterMetadataType(d("WAJids").toNewsletterJid(b));b=babelHelpers["extends"]({},a,{newsletterMutedMetadataMixin:{mutedState:e}});a=d("WAWebNewsletterModelUtils").mapNewsletterToModels(b);b=a.chat;var f=a.metadata;a=a.pic;try{yield d("WAWebNewsletterUpdateNewslettersRecordsJob").updateNewsletterChatRecords([d("WAWebCreateChat").createNewsletterObjectForStorage(b)]),yield d("WAWebBackendApi").frontendSendAndReceive("updateNewsletterMetadata",{metadata:f,newsletter:b,pic:a})}catch(a){d("WALogger").ERROR(h()).tags("mex","newsletter").devConsole(a).sendLogs("mex-newsletter-notification-mute-unmute-fail")}});return i.apply(this,arguments)}g.mexHandleNewsletterMutedChange=a}),98);
__d("WAWebMexNewsletterOwnerNotificationHandler",["WAJids","WALogger","WAWebBackendApi","WAWebJidToWid","WAWebMexNewsletterParseUtils","WAWebNewsletterGatingUtils","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["no updates were found in xwa2_notify_newsletter_owner_on_metadata_update"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["reaction setting did not contain updated value in xwa2_notify_newsletter_owner_on_metadata_update"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["description did not contain updated value in xwa2_notify_newsletter_owner_on_metadata_update"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["name did not contain updated value in xwa2_notify_newsletter_owner_on_metadata_update"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["no user found to be making this change in xwa2_notify_newsletter_owner_on_metadata_update"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["no changes found in xwa2_notify_newsletter_owner_on_metadata_update"]);m=function(){return a};return a}function a(a,b){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(!d("WAWebNewsletterGatingUtils").isNewsletterMultiAdminM1ImprovementsEnabled())return;a=b.xwa2_notify_newsletter_owner_on_metadata_update;b=a.id;var c=a.thread_metadata;a=a.actor;if(c==null){d("WALogger").ERROR(m()).tags("mex","newsletter").sendLogs("newsletter-mex-owner-metadata-notification-no-metadata-updates");return}a=a==null?void 0:a.id;if(a==null){d("WALogger").ERROR(l()).tags("mex","newsletter").sendLogs("newsletter-mex-owner-metadata-notification-no-actor");return}var e=[],f=c.name,g=c.description,n=c.picture,o=c.preview;c=c.settings;(n!=null||o!=null)&&e.push({item:"profile_picture"});if(f!=null){n=f.text;n==null?d("WALogger").ERROR(k()).tags("mex","newsletter").devConsole(f).sendLogs("newsletter-mex-owner-metadata-notification-no-updated-name-value"):e.push({item:"name",value:n})}if(g!=null){o=g.text;o==null?d("WALogger").ERROR(j()).tags("mex","newsletter").devConsole(g).sendLogs("newsletter-mex-owner-metadata-notification-no-updated-name-value"):e.push({item:"description",value:o})}f=c==null?void 0:c.reaction_codes;if(c!=null&&f!=null){n=d("WAWebMexNewsletterParseUtils").toReactionCodesSettingMixin(f.value);n==null?d("WALogger").ERROR(i()).tags("mex","newsletter").devConsole(f).sendLogs("newsletter-mex-owner-metadata-notification-no-updated-name-value"):e.push({item:"reaction_setting",value:n})}if(e.length===0){d("WALogger").ERROR(h()).tags("mex","newsletter").sendLogs("newsletter-mex-owner-metadata-notification-no-updates");return}g=d("WAJids").toNewsletterJid(b);o=d("WAWebJidToWid").newsletterJidToWid(g);c=d("WAWebWidFactory").createWid(a);f={newsletterId:d("WAWebWidFactory").toNewsletterWid(o),actorId:d("WAWebWidFactory").toUserWid(c),updates:e};d("WAWebBackendApi").frontendFireAndForget("displayNewsletterMetadataUpdateNotification",{notification:f})});return n.apply(this,arguments)}g.mexHandleNewsletterOwnerNotification=a}),98);
__d("WAWebMexNewsletterRoleChangeNotificationHandler",["WALogger","WAWebBackendApi","WAWebMexNewsletterUtils","WAWebNewsletterMetadataJob","WAWebNewsletterStorageUtils","WAWebNewsletterValidationUtils","WAWebUserPrefsMeUser","WAWebUserPrefsNewsletter","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[mex][newsletter][notification][admin-","] Failed to process "," notification, error parsing jid"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[mex][newsletter][notification][admin-","] Failed to process "," notification, null payload"]);i=function(){return a};return a}function a(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c;a=b.xwa2_notify_newsletter_admin_promote!=null?"promote":"demote";c=(c=b.xwa2_notify_newsletter_admin_promote)!=null?c:b.xwa2_notify_newsletter_admin_demote;if(c==null){d("WALogger").ERROR(i(),a,a).tags("mex","newsletter").sendLogs("mex-newsletternotification-state-change-fail");return}try{var e=d("WAWebNewsletterValidationUtils").toNewsletterJidOrThrow(c.id),f=c.user.pn;if(f==null)return;f=d("WAWebWidFactory").createWid(f);c=d("WAWebMexNewsletterUtils").mapRoleToMembership(c.user_new_role);if(c==null)return;f.equals(d("WAWebUserPrefsMeUser").getMeUser())?(yield d("WAWebNewsletterMetadataJob").updateNewsletterMetadata({id:e,membershipType:d("WAWebNewsletterStorageUtils").mapNewsletterMembershipTypeForStorage(c)}),d("WAWebBackendApi").frontendFireAndForget("handleMyRoleChangeNotification",{jid:e})):f.equals(d("WAWebUserPrefsMeUser").getMeUser())||d("WAWebBackendApi").frontendFireAndForget("handleOtherUserRoleChangeNotification",{jid:e,userId:f,newRole:c});yield d("WAWebUserPrefsNewsletter").flushCachedNewsletterSubscribers(e);d("WAWebBackendApi").frontendFireAndForget("displayRoleChangeDesktopNotification",{notification:b})}catch(b){d("WALogger").ERROR(h(),a,a).tags("mex","newsletter").devConsole(b).sendLogs("mex-newsletternotification-state-change-fail-"+a)}});return j.apply(this,arguments)}g.mexHandleNewsletterRoleChange=a}),98);
__d("WAWebMexNewsletterStateChangeHandler",["WAJids","WALogger","WAWebApiChat","WAWebBackendApi","WAWebJidToWid","WAWebNewsletterDeleteChatJob","WAWebNewsletterGatingUtils","WAWebNewsletterMetadataJob","WAWebNewsletterMetadataQueryJob","WAWebNewsletterModelUtils","WAWebNewsletterStorageUtils","WAWebNewsletterSystemMessages","WAWebNewsletterUpdateMsgsRecordsJob","WAWebNux","WAWebUserPrefsNuxPreferences","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[mex][newsletter][notification][state-change] Failed to update to "," state"]);h=function(){return a};return a}function i(a){switch(a){case"ACTIVE":return"active";case"SUSPENDED":return"suspended";case"GEOSUSPENDED":return"geosuspended"}}function a(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=b.xwa2_notify_newsletter_on_state_change;b=a.id;var e=a.is_requestor;a=a.state;if(b==null)throw c("err")("unexpected null id in xwa2_notify_newsletter_on_state_change");b=d("WAJids").toNewsletterJid(b);var f=d("WAWebJidToWid").newsletterJidToWid(b);e=e===!0;a=a==null?void 0:a.type;var g=(yield d("WAWebApiChat").getChatRecord(f));if(g==null)return;try{switch(a){case"DELETED":return yield k(e,b,f,g.name);case"ACTIVE":case"SUSPENDED":case"GEOSUSPENDED":e=i(a);f=d("WAWebNewsletterMetadataQueryJob").emptyNewsletterMetadataType(b);g=babelHelpers["extends"]({},f,{newsletterStateMetadataMixin:{stateType:e}});b=d("WAWebNewsletterModelUtils").mapNewsletterToModels(g);f=b.chat;e=b.metadata;g=b.pic;yield d("WAWebNewsletterMetadataJob").updateNewsletterMetadata(d("WAWebNewsletterStorageUtils").createNewsletterMetadataObjectForStorage(e));if(e.suspended===!0&&d("WAWebNewsletterGatingUtils").isNewsletterDSAEnforcementSuspensionEnabled()){b=d("WAWebNux").getNewsletterAlertsBannerNuxKey(e.id.toString());d("WAWebUserPrefsNuxPreferences").resetNux(b)}yield d("WAWebBackendApi").frontendSendAndReceive("updateNewsletterMetadata",{metadata:e,newsletter:f,pic:g});break;default:b=a==null?"null or undefined":a;throw c("err")("Unexpected state change type: "+b)}}catch(b){d("WALogger").ERROR(h(),a).tags("mex","newsletter").devConsole(b).sendLogs("mex-newsletternotification-state-change-fail")}});return j.apply(this,arguments)}function k(a,b,c,d){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,d){return a?m(b,c):o(b,c,d)});return l.apply(this,arguments)}function m(a,b){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){yield d("WAWebNewsletterMetadataJob").deleteNewsletterMetadata(a.toString()),yield d("WAWebNewsletterDeleteChatJob").deleteNewsletterChat(b),yield d("WAWebNewsletterMetadataJob").deleteNewsletterPicture(a.toString()),yield d("WAWebBackendApi").frontendSendAndReceive("deleteNewsletter",{id:b,keep:!0})});return n.apply(this,arguments)}function o(a,b,c){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){c=d("WAWebNewsletterSystemMessages").genNewsletterDeletionSystemMessages({id:a,name:c});yield d("WAWebNewsletterMetadataJob").updateNewsletterMetadata({id:a,terminated:!0});yield d("WAWebNewsletterUpdateMsgsRecordsJob").addNewsletterMsgsRecords(c);yield d("WAWebBackendApi").frontendSendAndReceive("terminateNewsletter",{id:b,msgs:c})});return p.apply(this,arguments)}g.mexHandleNewsletterStateChange=a}),98);
__d("WAWebMexTextStatusUpdateNotificationHandler",["WALogger","WAWebContactTextStatusBridge","WAWebSchemaContact","WAWebTextStatusGatingUtils","WAWebTextStatusParseUtils","WAWebUpdateTextStatusForContact","WAWebWidFactory","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[mex][textStatus][notification][side-sub] Could not find side contact hash for text status update side sub operation"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[mex][textStatus][notification][text-status-update] Failed to update text status change"]);i=function(){return a};return a}function a(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=b.xwa2_notify_text_status_on_update;b=a.jid;if(!d("WAWebTextStatusGatingUtils").receiveTextStatusEnabled())return;if(b==null)throw c("err")("unexpected null id in xwa2_notify_text_status_on_update");a=d("WAWebTextStatusParseUtils").parseTextStatusServerResponse(a);try{void d("WAWebUpdateTextStatusForContact").updateTextStatusForContact(d("WAWebWidFactory").createWid(b),a.textStatusString,a.textStatusEmoji,a.textStatusEphemeralDuration,a.textStatusLastUpdateTime)}catch(a){d("WALogger").ERROR(i()).tags("mex").devConsole(a).sendLogs("mex-text-status-notification-update-fail")}});return j.apply(this,arguments)}function e(a,b){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=b.xwa2_notify_text_status_on_update_side_sub;b=(yield d("WAWebSchemaContact").getContactTable().equals(["contactHash"],a.hash));if(b.length===0)d("WALogger").WARN(h());else{a=d("WAWebWidFactory").createWid(b[0].id);b=b[0].textStatusLastUpdateTime;return d("WAWebContactTextStatusBridge").getTextStatus(a,b).then(function(a){var b=a.text,c=a.emoji,e=a.ephemeralDurationSeconds,f=a.lastUpdateTime;a=a.id;return d("WAWebUpdateTextStatusForContact").updateTextStatusForContact(a,b,c,e,f)})}});return k.apply(this,arguments)}g.mexHandleTextStatusUpdate=a;g.mexHandleTextStatusUpdateSideSub=e}),98);
__d("WAWebHandleMexNotification",["Promise","WADeprecatedWapParser","WALogger","WAParsableWapNode","WAWap","WAWebMexGroupPropertyUpdateNotificationHandler","WAWebMexNewsletterAdminInviteRevokeNotificationHandler","WAWebMexNewsletterAdminNotificationHandler","WAWebMexNewsletterJoinHandler","WAWebMexNewsletterLeaveHandler","WAWebMexNewsletterMetadataUpdateNotificationHandler","WAWebMexNewsletterMutedChangeHandler","WAWebMexNewsletterOwnerNotificationHandler","WAWebMexNewsletterRoleChangeNotificationHandler","WAWebMexNewsletterStateChangeHandler","WAWebMexRelayEnvironmentV2","WAWebMexTextStatusUpdateNotificationHandler","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[mex][notification] handle MexNotificationEvent"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[mex][notification][error]"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[mex][notification] handled ",""]);k=function(){return a};return a}var l="mexNotificationParser",m=new(c("WADeprecatedWapParser"))(l,function(a){a.assertTag("notification");a.assertAttr("type","mex");var b=a.child("update"),c=a.attrString("id");a=a.attrWapJid("from");var e=b.attrString("op_name");b=b.contentString();var f;try{f=JSON.parse(b)}catch(a){throw new(d("WAParsableWapNode").XmppParsingFailure)(l,"JSON parsing error: "+a)}return{stanzaId:c,from:a,OperationName:e,mexResponse:f}});function a(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=m.parseOrThrow(a);try{var c=(yield o(b));d("WALogger").DEV(k(),b.OperationName).tags("mex").devConsole(c,b);return c}catch(c){d("WALogger").ERROR(j()).tags("mex","notification").devConsole(a,c).sendLogs("mex-notification-error-"+b.OperationName);if(c instanceof d("WAParsableWapNode").XmppParsingFailure)throw c;throw new(d("WAParsableWapNode").XmppParsingFailure)(l,"unexpected error: "+c)}});return n.apply(this,arguments)}function o(a){switch(a.OperationName){case"MexNotificationEvent":return p(a,s);case"NotificationNewsletterMuteChange":return p(a,d("WAWebMexNewsletterMutedChangeHandler").mexHandleNewsletterMutedChange);case"NotificationNewsletterJoin":return p(a,d("WAWebMexNewsletterJoinHandler").mexHandleNewsletterJoin);case"NotificationNewsletterLeave":return p(a,d("WAWebMexNewsletterLeaveHandler").mexHandleNewsletterLeave);case"NotificationNewsletterStateChange":return p(a,d("WAWebMexNewsletterStateChangeHandler").mexHandleNewsletterStateChange);case"NotificationNewsletterAdminMetadataUpdate":return p(a,d("WAWebMexNewsletterAdminNotificationHandler").mexHandleNewsletterAdminNotification);case"NotificationNewsletterOwnerUpdate":return p(a,d("WAWebMexNewsletterOwnerNotificationHandler").mexHandleNewsletterOwnerNotification);case"NotificationNewsletterUpdate":return p(a,d("WAWebMexNewsletterMetadataUpdateNotificationHandler").mexHandleNewsletterMetadataUpdate);case"NotificationNewsletterAdminPromote":return p(a,d("WAWebMexNewsletterRoleChangeNotificationHandler").mexHandleNewsletterRoleChange);case"NotificationNewsletterAdminDemote":return p(a,d("WAWebMexNewsletterRoleChangeNotificationHandler").mexHandleNewsletterRoleChange);case"NotificationNewsletterAdminInviteRevoke":return p(a,d("WAWebMexNewsletterAdminInviteRevokeNotificationHandler").handleNewsletterAdminInviteRevoke);case"TextStatusUpdateNotification":return p(a,d("WAWebMexTextStatusUpdateNotificationHandler").mexHandleTextStatusUpdate);case"TextStatusUpdateNotificationSideSub":return p(a,d("WAWebMexTextStatusUpdateNotificationHandler").mexHandleTextStatusUpdateSideSub);case"NotificationGroupPropertyUpdate":return p(a,d("WAWebMexGroupPropertyUpdateNotificationHandler").mexHandleGroupPropertyUpdate);default:return(h||(h=b("Promise"))).reject(new(d("WAParsableWapNode").XmppParsingFailure)(l,"no concrete handler for: "+a.OperationName))}}function p(a,b){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=a.mexResponse,e=d("WAWebMexRelayEnvironmentV2").parseFatalExtensionError(c.errors);if(e!=null)throw new(d("WAParsableWapNode").XmppParsingFailure)(l,"errors list in parsed json has fatal error");if(c.data!=null){yield b(a.from,c.data);return r(a.stanzaId,a.from)}throw new(d("WAParsableWapNode").XmppParsingFailure)(l,"null data in parsed json")});return q.apply(this,arguments)}function r(a,b){return d("WAWap").wap("ack",{id:d("WAWap").CUSTOM_STRING(a),to:b,"class":"notification",type:"mex"})}function s(a,b){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){d("WALogger").DEV(i()).tags("mex").devConsole(a,b)});return t.apply(this,arguments)}g.handleMexNotification=a}),98);
__d("WASmaxInNewslettersDeleteNotificationRequest",["WAResultOrError","WASmaxInNewslettersCommonNotificationMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"delete");if(!b.success)return b;b=d("WASmaxParseUtils").optionalLiteral(d("WASmaxParseUtils").attrString,a,"is_sender","true");if(!b.success)return b;a=d("WASmaxInNewslettersCommonNotificationMixin").parseCommonNotificationMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({isSender:b.value},a.value))}g.parseDeleteNotificationRequest=a}),98);
__d("WASmaxOutNewslettersDeleteNotificationResponseAck",["WASmaxJsx","WASmaxOutNewslettersNotificationClientAckMixin"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxOutNewslettersNotificationClientAckMixin").mergeNotificationClientAckMixin(d("WASmaxJsx").smax("ack",null),a);return a}g.makeDeleteNotificationResponseAck=a}),98);
__d("WASmaxNewslettersDeleteNotificationRPC",["WASmaxInNewslettersDeleteNotificationRequest","WASmaxOutNewslettersDeleteNotificationResponseAck","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInNewslettersDeleteNotificationRequest").parseDeleteNotificationRequest(a);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("DeleteNotification",{Request:b}));return{parsedRequest:b.value,makeDeleteNotificationResponseAck:function(){return d("WASmaxOutNewslettersDeleteNotificationResponseAck").makeDeleteNotificationResponseAck(a)}}}g.receiveDeleteNotificationRPC=a}),98);
__d("WAWebNewsletterDeleteNotification",["WALogger","WASmaxNewslettersDeleteNotificationRPC","WAWebApiChat","WAWebBackendApi","WAWebJidToWid","WAWebNewsletterBackendQueues","WAWebNewsletterDeleteChatJob","WAWebNewsletterGatingUtils","WAWebNewsletterMetadataJob","WAWebNewsletterSystemMessages","WAWebNewsletterUpdateMsgsRecordsJob","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[newsletter][metadata-notification] Failed to update the db records"]);h=function(){return a};return a}function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("WAWebNewsletterBackendQueues").newsletterDeleteQueue.wait();a=d("WASmaxNewslettersDeleteNotificationRPC").receiveDeleteNotificationRPC(a);var b=a.makeDeleteNotificationResponseAck;a=a.parsedRequest;var c=a.from,e=d("WAWebJidToWid").newsletterJidToWid(c),f=(yield d("WAWebApiChat").getChatRecord(e));if(!d("WAWebNewsletterGatingUtils").isNewsletterEnabled()||f==null)return b();try{a=a.isSender==="true";if(a){yield d("WAWebNewsletterMetadataJob").deleteNewsletterMetadata(c.toString());yield d("WAWebNewsletterDeleteChatJob").deleteNewsletterChat(e);yield d("WAWebNewsletterMetadataJob").deleteNewsletterPicture(c.toString());yield d("WAWebBackendApi").frontendSendAndReceive("deleteNewsletter",{id:e,keep:!1});return b()}a=d("WAWebNewsletterSystemMessages").genNewsletterDeletionSystemMessages({id:c,name:f.name});yield d("WAWebNewsletterMetadataJob").updateNewsletterMetadata({id:c,terminated:!0});yield d("WAWebNewsletterUpdateMsgsRecordsJob").addNewsletterMsgsRecords(a);yield d("WAWebBackendApi").frontendSendAndReceive("terminateNewsletter",{id:e,msgs:a})}catch(a){d("WALogger").ERROR(h()).tags("newsletter").devConsole(a).sendLogs("newsletter-delete-notification-db-fail")}return b()});return i.apply(this,arguments)}g["default"]=a}),98);
__d("WASmaxInNewslettersAdminNotificationGeosuspendedStateMixinMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"country");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"iso_code");return!b.success?b:d("WAResultOrError").makeResult({isoCode:b.value})}function a(a){var b=d("WASmaxParseUtils").assertTag(a,"admin");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"geosuspended");if(!b.success)return b;a=d("WASmaxParseUtils").mapChildrenWithTag(b.value,"country",1,250,h);return!a.success?a:d("WAResultOrError").makeResult({geosuspendedCountry:a.value})}g.parseAdminNotificationGeosuspendedStateMixinGeosuspendedCountry=h;g.parseAdminNotificationGeosuspendedStateMixinMixin=a}),98);
__d("WASmaxInNewslettersAdminNotificationGeounsuspendedStateMixinMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"country");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"iso_code");return!b.success?b:d("WAResultOrError").makeResult({isoCode:b.value})}function a(a){var b=d("WASmaxParseUtils").assertTag(a,"admin");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"geounsuspended");if(!b.success)return b;a=d("WASmaxParseUtils").mapChildrenWithTag(b.value,"country",1,250,h);return!a.success?a:d("WAResultOrError").makeResult({geounsuspendedCountry:a.value})}g.parseAdminNotificationGeounsuspendedStateMixinGeounsuspendedCountry=h;g.parseAdminNotificationGeounsuspendedStateMixinMixin=a}),98);
__d("WASmaxInNewslettersAdminNotificationGeosuspendedOrGeounsuspendedStateMixinMixinGroup",["WAResultOrError","WASmaxInNewslettersAdminNotificationGeosuspendedStateMixinMixin","WASmaxInNewslettersAdminNotificationGeounsuspendedStateMixinMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInNewslettersAdminNotificationGeosuspendedStateMixinMixin").parseAdminNotificationGeosuspendedStateMixinMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"AdminNotificationGeosuspendedStateMixin",value:b.value});var c=d("WASmaxInNewslettersAdminNotificationGeounsuspendedStateMixinMixin").parseAdminNotificationGeounsuspendedStateMixinMixin(a);return c.success?d("WAResultOrError").makeResult({name:"AdminNotificationGeounsuspendedStateMixin",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["AdminNotificationGeosuspendedStateMixin","AdminNotificationGeounsuspendedStateMixin"],[b,c])}g.parseAdminNotificationGeosuspendedOrGeounsuspendedStateMixinMixinGroup=a}),98);
__d("WASmaxInNewslettersAdminGeosuspendNotificationPayloadMixin",["WAResultOrError","WASmaxInNewslettersAdminNotificationGeosuspendedOrGeounsuspendedStateMixinMixinGroup","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"admin");if(!b.success)return b;b=d("WASmaxInNewslettersAdminNotificationGeosuspendedOrGeounsuspendedStateMixinMixinGroup").parseAdminNotificationGeosuspendedOrGeounsuspendedStateMixinMixinGroup(a);return!b.success?b:d("WAResultOrError").makeResult({adminNotificationGeosuspendedOrGeounsuspendedStateMixinMixinGroup:b.value})}g.parseAdminGeosuspendNotificationPayloadMixin=a}),98);
__d("WASmaxInNewslettersAdminNotificationRequest",["WAResultOrError","WASmaxInNewslettersAdminGeosuspendNotificationPayloadMixin","WASmaxInNewslettersCommonNotificationMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"admin");if(!b.success)return b;b=d("WASmaxInNewslettersAdminGeosuspendNotificationPayloadMixin").parseAdminGeosuspendNotificationPayloadMixin(b.value);a=d("WASmaxInNewslettersCommonNotificationMixin").parseCommonNotificationMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({adminAdminGeosuspendNotificationPayloadMixin:b.success?b.value:null},a.value))}g.parseAdminNotificationRequest=a}),98);
__d("WASmaxOutNewslettersAdminNotificationResponseAck",["WASmaxJsx","WASmaxOutNewslettersNotificationClientAckMixin"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxOutNewslettersNotificationClientAckMixin").mergeNotificationClientAckMixin(d("WASmaxJsx").smax("ack",null),a);return a}g.makeAdminNotificationResponseAck=a}),98);
__d("WASmaxNewslettersAdminNotificationRPC",["WASmaxInNewslettersAdminNotificationRequest","WASmaxOutNewslettersAdminNotificationResponseAck","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInNewslettersAdminNotificationRequest").parseAdminNotificationRequest(a);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("AdminNotification",{Request:b}));return{parsedRequest:b.value,makeAdminNotificationResponseAck:function(){return d("WASmaxOutNewslettersAdminNotificationResponseAck").makeAdminNotificationResponseAck(a)}}}g.receiveAdminNotificationRPC=a}),98);
__d("WAWebCountriesNativeCountryNames",[],(function(a,b,c,d,e,f){a={AC:"Ascension Island",AD:"Andorra",AE:"\u0627\u0644\u0625\u0645\u0627\u0631\u0627\u062a \u0627\u0644\u0639\u0631\u0628\u064a\u0629 \u0627\u0644\u0645\u062a\u062d\u062f\u0629",AF:"\u0627\u0641\u063a\u0627\u0646\u0633\u062a\u0627\u0646",AG:"Antigua & Barbuda",AI:"Anguilla",AL:"Shqip\xebri",AM:"\u0540\u0561\u0575\u0561\u057d\u057f\u0561\u0576",AO:"Angola",AR:"Argentina",AS:"American Samoa",AT:"\xd6sterreich",AU:"Australia",AW:"Aruba",AX:"\xc5land",AZ:"Az\u0259rbaycan",BA:"Bosna i Hercegovina",BB:"Barbados",BD:"\u09ac\u09be\u0982\u09b2\u09be\u09a6\u09c7\u09b6",BE:"Belgi\xeb",BF:"Burkina Faso",BG:"\u0411\u044a\u043b\u0433\u0430\u0440\u0438\u044f",BH:"\u0627\u0644\u0628\u062d\u0631\u064a\u0646",BI:"Burundi",BJ:"B\xe9nin",BL:"Saint-Barth\xe9lemy",BM:"Bermuda",BN:"Brunei",BO:"Bolivia",BQ:"Caribisch Nederland",BR:"Brasil",BS:"Bahamas",BT:"\u0f60\u0f56\u0fb2\u0f74\u0f42",BW:"Botswana",BY:"\u0411\u0435\u043b\u0430\u0440\u0443\u0441\u044c",BZ:"Belize",CA:"Canada",CC:"Kepulauan Cocos (Keeling)",CD:"Congo-Kinshasa",CF:"R\xe9publique centrafricaine",CG:"Congo-Brazzaville",CH:"Schweiz",CI:"C\xf4te d\u2019Ivoire",CK:"Cook Islands",CL:"Chile",CM:"Cameroon",CN:"\u4e2d\u56fd",CO:"Colombia",CR:"Costa Rica",CU:"Cuba",CV:"Cabo Verde",CW:"Cura\xe7ao",CX:"Christmas Island",CY:"\u039a\u03cd\u03c0\u03c1\u03bf\u03c2",CZ:"\u010cesko",DE:"Deutschland",DJ:"Djibouti",DK:"Danmark",DM:"Dominica",DO:"Rep\xfablica Dominicana",DZ:"\u0627\u0644\u062c\u0632\u0627\u0626\u0631",EC:"Ecuador",EE:"Eesti",EG:"\u0645\u0635\u0631",ER:"\u0625\u0631\u064a\u062a\u0631\u064a\u0627",ES:"Espa\xf1a",ET:"\u12a2\u1275\u12ee\u1335\u12eb",FI:"Suomi",FJ:"Fiji",FK:"Falkland Islands",FM:"Micronesia",FO:"F\xf8royar",FR:"France",GA:"Gabon",GB:"United Kingdom",GD:"Grenada",GE:"\u10e1\u10d0\u10e5\u10d0\u10e0\u10d7\u10d5\u10d4\u10da\u10dd",GF:"Guyane fran\xe7aise",GG:"Guernsey",GH:"Ghana",GI:"Gibraltar",GL:"Kalaallit Nunaat",GM:"Gambia",GN:"Guin\xe9e",GP:"Guadeloupe",GQ:"Guinea Ecuatorial",GR:"\u0395\u03bb\u03bb\u03ac\u03b4\u03b1",GT:"Guatemala",GU:"Guam",GW:"Guin\xe9-Bissau",GY:"Guyana",HK:"\u4e2d\u570b\u9999\u6e2f\u7279\u5225\u884c\u653f\u5340",HN:"Honduras",HR:"Hrvatska",HT:"Ha\xefti",HU:"Magyarorsz\xe1g",ID:"Indonesia",IE:"Ireland",IL:"\u05d9\u05e9\u05e8\u05d0\u05dc",IM:"Isle of Man",IN:"India",IO:"British Indian Ocean Territory",IQ:"\u0627\u0644\u0639\u0631\u0627\u0642",IR:"\u0627\u06cc\u0631\u0627\u0646",IS:"\xcdsland",IT:"Italia",JE:"Jersey",JM:"Jamaica",JO:"\u0627\u0644\u0623\u0631\u062f\u0646",JP:"\u65e5\u672c",KE:"Kenya",KG:"\u041a\u044b\u0440\u0433\u044b\u0437\u0441\u0442\u0430\u043d",KH:"\u1780\u1798\u17d2\u1796\u17bb\u1787\u17b6",KI:"Kiribati",KM:"\u062c\u0632\u0631 \u0627\u0644\u0642\u0645\u0631",KN:"St. Kitts & Nevis",KP:"\uc870\uc120\ubbfc\uc8fc\uc8fc\uc758\uc778\ubbfc\uacf5\ud654\uad6d",KR:"\ub300\ud55c\ubbfc\uad6d",KW:"\u0627\u0644\u0643\u0648\u064a\u062a",KY:"Cayman Islands",KZ:"\u049a\u0430\u0437\u0430\u049b\u0441\u0442\u0430\u043d",LA:"\u0ea5\u0eb2\u0ea7",LB:"\u0644\u0628\u0646\u0627\u0646",LC:"St. Lucia",LI:"Liechtenstein",LK:"\u0dc1\u0dca\u200d\u0dbb\u0dd3 \u0dbd\u0d82\u0d9a\u0dcf\u0dc0",LR:"Liberia",LS:"Lesotho",LT:"Lietuva",LU:"L\xebtzebuerg",LV:"Latvija",LY:"\u0644\u064a\u0628\u064a\u0627",MA:"\u0627\u0644\u0645\u063a\u0631\u0628",MC:"Monaco",MD:"Republica Moldova",ME:"\u0426\u0440\u043d\u0430 \u0413\u043e\u0440\u0430",MF:"Saint-Martin",MG:"Madagascar",MH:"Marshall Islands",MK:"\u0421\u0435\u0432\u0435\u0440\u043d\u0430 \u041c\u0430\u043a\u0435\u0434\u043e\u043d\u0438\u0458\u0430",ML:"Mali",MM:"\u1019\u103c\u1014\u103a\u1019\u102c",MN:"\u041c\u043e\u043d\u0433\u043e\u043b",MO:"\u4e2d\u570b\u6fb3\u9580\u7279\u5225\u884c\u653f\u5340",MP:"Northern Mariana Islands",MQ:"Martinique",MR:"\u0645\u0648\u0631\u064a\u062a\u0627\u0646\u064a\u0627",MS:"Montserrat",MT:"Malta",MU:"Mauritius",MV:"Maldives",MW:"Malawi",MX:"M\xe9xico",MY:"Malaysia",MZ:"Mo\xe7ambique",NA:"Namibia",NC:"Nouvelle-Cal\xe9donie",NE:"Niger",NF:"Norfolk Island",NG:"Nigeria",NI:"Nicaragua",NL:"Nederland",NO:"Norge",NP:"\u0928\u0947\u092a\u093e\u0932",NR:"Nauru",NU:"Niue",NZ:"New Zealand",OM:"\u0639\u064f\u0645\u0627\u0646",PA:"Panam\xe1",PE:"Per\xfa",PF:"Polyn\xe9sie fran\xe7aise",PG:"Papua New Guinea",PH:"Philippines",PK:"\u067e\u0627\u06a9\u0633\u062a\u0627\u0646",PL:"Polska",PM:"Saint-Pierre-et-Miquelon",PR:"Puerto Rico",PS:"\u0627\u0644\u0623\u0631\u0627\u0636\u064a \u0627\u0644\u0641\u0644\u0633\u0637\u064a\u0646\u064a\u0629",PT:"Portugal",PW:"Palau",PY:"Paraguay",QA:"\u0642\u0637\u0631",RE:"La R\xe9union",RO:"Rom\xe2nia",RS:"\u0421\u0440\u0431\u0438\u0458\u0430",RU:"\u0420\u043e\u0441\u0441\u0438\u044f",RW:"U Rwanda",SA:"\u0627\u0644\u0645\u0645\u0644\u0643\u0629 \u0627\u0644\u0639\u0631\u0628\u064a\u0629 \u0627\u0644\u0633\u0639\u0648\u062f\u064a\u0629",SB:"Solomon Islands",SC:"Seychelles",SD:"\u0627\u0644\u0633\u0648\u062f\u0627\u0646",SE:"Sverige",SG:"Singapore",SH:"St. Helena",SI:"Slovenija",SJ:"\u0428\u043f\u0438\u0446\u0431\u0435\u0440\u0433\u0435\u043d \u0438 \u042f\u043d-\u041c\u0430\u0439\u0435\u043d",SK:"Slovensko",SL:"Sierra Leone",SM:"San Marino",SN:"S\xe9n\xe9gal",SO:"Soomaaliya",SR:"Suriname",SS:"South Sudan",ST:"S\xe3o Tom\xe9 e Pr\xedncipe",SV:"El Salvador",SX:"Sint-Maarten",SY:"\u0633\u0648\u0631\u064a\u0627",SZ:"Eswatini",TC:"Turks & Caicos Islands",TD:"Tchad",TG:"Togo",TH:"\u0e44\u0e17\u0e22",TJ:"\u0422\u043e\u04b7\u0438\u043a\u0438\u0441\u0442\u043e\u043d",TK:"Tokelau",TL:"Timor-Leste",TM:"T\xfcrkmenistan",TN:"\u062a\u0648\u0646\u0633",TO:"Tonga",TR:"T\xfcrkiye",TT:"Trinidad & Tobago",TV:"Tuvalu",TW:"\u53f0\u7063",TZ:"Tanzania",UA:"\u0423\u043a\u0440\u0430\u0457\u043d\u0430",UG:"Uganda",US:"United States",UY:"Uruguay",UZ:"O\u02bbzbekiston",VA:"Citt\xe0 del Vaticano",VC:"St. Vincent & Grenadines",VE:"Venezuela",VG:"British Virgin Islands",VI:"U.S. Virgin Islands",VN:"Vi\u1ec7t Nam",VU:"Vanuatu",WF:"Wallis-et-Futuna",WS:"Samoa",XK:"Kosov\xeb",YE:"\u0627\u0644\u064a\u0645\u0646",YT:"Mayotte",ZA:"iNingizimu Afrika",ZM:"Zambia",ZW:"Zimbabwe"};f["default"]=a}),66);
__d("WAWebNewsletterHandleAdminNotification",["WALogger","WASmaxNewslettersAdminNotificationRPC","WAWebBackendApi","WAWebCountriesNativeCountryNames","WAWebJidToWid","WAWebNewsletterAdminNotificationJob","WAWebNewsletterGatingUtils","WAWebNux","WAWebUserPrefsNuxPreferences","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[newsletter][admin-notification] Failed to update the db records"]);h=function(){return a};return a}function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=d("WASmaxNewslettersAdminNotificationRPC").receiveAdminNotificationRPC(a);var b=a.makeAdminNotificationResponseAck;a=a.parsedRequest;if(!d("WAWebNewsletterGatingUtils").isNewsletterGeosuspendAdminAlertsEnabled())return b();var e=a.from,f=d("WAWebJidToWid").newsletterJidToWid(e);try{a=(a=a.adminAdminGeosuspendNotificationPayloadMixin)==null?void 0:a.adminNotificationGeosuspendedOrGeounsuspendedStateMixinMixinGroup;if(a==null)return b();switch(a.name){case"AdminNotificationGeosuspendedStateMixin":var g=a.value;g=g.geosuspendedCountry.map(function(a){a=a.isoCode;return a in c("WAWebCountriesNativeCountryNames")?a:null}).filter(Boolean);if(g.length>0){yield d("WAWebNewsletterAdminNotificationJob").updateGeosuspendedCountry(e,g,!0);d("WAWebBackendApi").frontendFireAndForget("updateGeosuspendedCountry",{id:f,countryCodes:g,toAdd:!0});g=d("WAWebNux").getNewsletterAlertsBannerNuxKey(e);d("WAWebUserPrefsNuxPreferences").resetNux(g)}break;case"AdminNotificationGeounsuspendedStateMixin":g=a.value;a=g.geounsuspendedCountry.map(function(a){a=a.isoCode;return a in c("WAWebCountriesNativeCountryNames")?a:null}).filter(Boolean);a.length>0&&(yield d("WAWebNewsletterAdminNotificationJob").updateGeosuspendedCountry(e,a,!1),d("WAWebBackendApi").frontendFireAndForget("updateGeosuspendedCountry",{id:f,countryCodes:a,toAdd:!1}));break}}catch(a){d("WALogger").ERROR(h()).tags("newsletter").devConsole(a).sendLogs("newsletter-admin-notification-db-fail")}return b()});return i.apply(this,arguments)}g["default"]=a}),98);
__d("WASmaxInNewslettersLeaveNotificationRequest",["WASmaxInNewslettersCommonNotificationMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"leave");if(!b.success)return b;b=d("WASmaxInNewslettersCommonNotificationMixin").parseCommonNotificationMixin(a);return!b.success?b:b}g.parseLeaveNotificationRequest=a}),98);
__d("WASmaxOutNewslettersLeaveNotificationResponseAck",["WASmaxJsx","WASmaxOutNewslettersNotificationClientAckMixin"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxOutNewslettersNotificationClientAckMixin").mergeNotificationClientAckMixin(d("WASmaxJsx").smax("ack",null),a);return a}g.makeLeaveNotificationResponseAck=a}),98);
__d("WASmaxNewslettersLeaveNotificationRPC",["WASmaxInNewslettersLeaveNotificationRequest","WASmaxOutNewslettersLeaveNotificationResponseAck","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInNewslettersLeaveNotificationRequest").parseLeaveNotificationRequest(a);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("LeaveNotification",{Request:b}));return{parsedRequest:b.value,makeLeaveNotificationResponseAck:function(){return d("WASmaxOutNewslettersLeaveNotificationResponseAck").makeLeaveNotificationResponseAck(a)}}}g.receiveLeaveNotificationRPC=a}),98);
__d("WAWebNewsletterHandleLeaveNotification",["WALogger","WASmaxNewslettersLeaveNotificationRPC","WAWebBackendApi","WAWebJidToWid","WAWebNewsletterDBUtils","WAWebNewsletterDeleteChatJob","WAWebNewsletterDeleteMessageAddOns","WAWebNewsletterGatingUtils","WAWebNewsletterMetadataJob","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[newsletter][leave-notification] Failed to update the db"]);h=function(){return a};return a}function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=d("WASmaxNewslettersLeaveNotificationRPC").receiveLeaveNotificationRPC(a);var b=a.makeLeaveNotificationResponseAck;a=a.parsedRequest;a=a.from;if(!d("WAWebNewsletterGatingUtils").isNewsletterEnabled())return b();var c=d("WAWebJidToWid").newsletterJidToWid(a);if(!(yield d("WAWebNewsletterDBUtils").doesNewsletterExistInStorage(a))){d("WAWebBackendApi").frontendFireAndForget("updateNewsletterSubscriberCount",{id:c,update:{increment:-1}});return b()}try{yield d("WAWebNewsletterMetadataJob").deleteNewsletterMetadata(a),yield d("WAWebNewsletterDeleteMessageAddOns").deleteNewsletterMessageAddOns(a),yield d("WAWebNewsletterDeleteChatJob").deleteNewsletterChat(c),d("WAWebBackendApi").frontendFireAndForget("deleteNewsletter",{id:c,keep:!0})}catch(a){d("WALogger").ERROR(h()).tags("newsletter").devConsole(a).sendLogs("newsletter-leave-notification-db-fail")}return b()});return i.apply(this,arguments)}g["default"]=a}),98);
__d("WASmaxInNewslettersLiveUpdatesNotificationRequest",["WAResultOrError","WASmaxInNewslettersCommonNotificationMixin","WASmaxInNewslettersNewsletterMessageResponsePayloadMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"live_updates");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(b.value,"messages");if(!b.success)return b;b=d("WASmaxInNewslettersNewsletterMessageResponsePayloadMixin").parseNewsletterMessageResponsePayloadMixin(b.value);if(!b.success)return b;a=d("WASmaxInNewslettersCommonNotificationMixin").parseCommonNotificationMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({liveUpdatesMessagesNewsletterMessageResponsePayloadMixin:b.value},a.value))}g.parseLiveUpdatesNotificationRequest=a}),98);
__d("WASmaxOutNewslettersLiveUpdatesNotificationResponseAck",["WASmaxJsx","WASmaxOutNewslettersNotificationClientAckMixin"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxOutNewslettersNotificationClientAckMixin").mergeNotificationClientAckMixin(d("WASmaxJsx").smax("ack",null),a);return a}g.makeLiveUpdatesNotificationResponseAck=a}),98);
__d("WASmaxNewslettersLiveUpdatesNotificationRPC",["WASmaxInNewslettersLiveUpdatesNotificationRequest","WASmaxOutNewslettersLiveUpdatesNotificationResponseAck","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInNewslettersLiveUpdatesNotificationRequest").parseLiveUpdatesNotificationRequest(a);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("LiveUpdatesNotification",{Request:b}));return{parsedRequest:b.value,makeLiveUpdatesNotificationResponseAck:function(){return d("WASmaxOutNewslettersLiveUpdatesNotificationResponseAck").makeLiveUpdatesNotificationResponseAck(a)}}}g.receiveLiveUpdatesNotificationRPC=a}),98);
__d("WAWebNewsletterHandleLiveUpdatesNotification",["WALogger","WANullthrows","WASmaxNewslettersLiveUpdatesNotificationRPC","WAWebBackendApi","WAWebNewsletterBackendAddOnsUtils","WAWebNewsletterGatingUtils","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[newsletter][live-updates-notification] Failed to handle the notification"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[liveUpdate] start"]);i=function(){return a};return a}function a(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WALogger").DEV(i());a=d("WASmaxNewslettersLiveUpdatesNotificationRPC").receiveLiveUpdatesNotificationRPC(a);var b=a.makeLiveUpdatesNotificationResponseAck;a=a.parsedRequest;try{if(!d("WAWebNewsletterGatingUtils").isNewsletterReactionEnabled())return b();var e=a.liveUpdatesMessagesNewsletterMessageResponsePayloadMixin.message,f=a.from;a=a.t;e=(yield d("WAWebNewsletterBackendAddOnsUtils").getMsgsAndAddOnsFromUpdates(e,d("WAWebWidFactory").createWid(c("WANullthrows")(f)),a));yield d("WAWebNewsletterBackendAddOnsUtils").updateAddOnDbRecords(babelHelpers["extends"]({},e,{timestamp:a}));d("WAWebBackendApi").frontendFireAndForget("updateNewsletterMessages",e);return b()}catch(a){d("WALogger").ERROR(h()).tags("newsletter").devConsole(a).sendLogs("newsletter-live-updates-db");return b()}});return j.apply(this,arguments)}g.handleNewsletterLiveUpdatesNotification=a}),98);
__d("WASmaxInNewslettersSetMetadataNotificationRequest",["WAResultOrError","WASmaxInNewslettersCommonNewsletterMetadataMixin","WASmaxInNewslettersCommonNotificationMixin","WASmaxInNewslettersNewsletterSettingsMetadataMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"metadata");if(!b.success)return b;var c=d("WASmaxInNewslettersCommonNewsletterMetadataMixin").parseCommonNewsletterMetadataMixin(b.value);if(!c.success)return c;b=d("WASmaxInNewslettersNewsletterSettingsMetadataMixin").parseNewsletterSettingsMetadataMixin(b.value);a=d("WASmaxInNewslettersCommonNotificationMixin").parseCommonNotificationMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({metadataCommonNewsletterMetadataMixin:c.value,metadataNewsletterSettingsMetadataMixin:b.success?b.value:null},a.value))}g.parseSetMetadataNotificationRequest=a}),98);
__d("WASmaxOutNewslettersSetMetadataNotificationResponseAck",["WASmaxJsx","WASmaxOutNewslettersNotificationClientAckMixin"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxOutNewslettersNotificationClientAckMixin").mergeNotificationClientAckMixin(d("WASmaxJsx").smax("ack",null),a);return a}g.makeSetMetadataNotificationResponseAck=a}),98);
__d("WASmaxNewslettersSetMetadataNotificationRPC",["WASmaxInNewslettersSetMetadataNotificationRequest","WASmaxOutNewslettersSetMetadataNotificationResponseAck","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInNewslettersSetMetadataNotificationRequest").parseSetMetadataNotificationRequest(a);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("SetMetadataNotification",{Request:b}));return{parsedRequest:b.value,makeSetMetadataNotificationResponseAck:function(){return d("WASmaxOutNewslettersSetMetadataNotificationResponseAck").makeSetMetadataNotificationResponseAck(a)}}}g.receiveSetMetadataNotificationRPC=a}),98);
__d("WAWebNewsletterHandleMetadataNotification",["WALogger","WASmaxNewslettersSetMetadataNotificationRPC","WAWebCreateChat","WAWebNewsletterGatingUtils","WAWebNewsletterMetadataUpdateUtils","WAWebNewsletterModelUtils","WAWebNewsletterUpdateNewslettersRecordsJob","WAWebNux","WAWebUserPrefsNuxPreferences","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[newsletter][metadata-notification] Failed to process metadata notification: ",""]);h=function(){return a};return a}function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=d("WASmaxNewslettersSetMetadataNotificationRPC").receiveSetMetadataNotificationRPC(a);var b=a.makeSetMetadataNotificationResponseAck;a=a.parsedRequest;if(!d("WAWebNewsletterGatingUtils").isNewsletterEnabled())return b();a=babelHelpers["extends"]({},a.metadataCommonNewsletterMetadataMixin,{idJid:a.from,newsletterCreationTimeMetadataMixin:null});a=d("WAWebNewsletterModelUtils").mapNewsletterToModels(a);var c=a.chat,e=a.metadata;a=a.pic;try{yield d("WAWebNewsletterUpdateNewslettersRecordsJob").updateNewsletterChatRecords([d("WAWebCreateChat").createNewsletterObjectForStorage(c)]);yield d("WAWebNewsletterMetadataUpdateUtils").updateNewsletterMetadataAndPic(c,e,a);if(e.suspended===!0&&d("WAWebNewsletterGatingUtils").isNewsletterDSAEnforcementSuspensionEnabled()){c=d("WAWebNux").getNewsletterAlertsBannerNuxKey(e.id.toString());d("WAWebUserPrefsNuxPreferences").resetNux(c)}}catch(a){d("WALogger").ERROR(h(),a).tags("newsletter").devConsole(a).sendLogs("newsletter-metadata-notification-fail")}return b()});return i.apply(this,arguments)}g["default"]=a}),98);
__d("WAWebNewsletterNotificationQueue",["WAPromiseQueue"],(function(a,b,c,d,e,f,g){a=new(d("WAPromiseQueue").PromiseQueueMap)();g["default"]=a}),98);
__d("WAWebHandleNewsletterNotification",["$InternalEnum","WADeprecatedWapParser","WALogger","WAParsableWapNode","WAWebNewsletterDeleteNotification","WAWebNewsletterHandleAdminNotification","WAWebNewsletterHandleJoinNotification","WAWebNewsletterHandleLeaveNotification","WAWebNewsletterHandleLiveUpdatesNotification","WAWebNewsletterHandleMessageDeliveryUpdateNotification","WAWebNewsletterHandleMetadataNotification","WAWebNewsletterNotificationQueue","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[newsletter][notification] Failed to parse notification"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[newsletter][notification] Unexpected from "]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[newsletter][notification] Failed to cast ",""]);j=function(){return a};return a}var k=b("$InternalEnum")({Join:"join",Metadata:"metadata",Leave:"leave",Delete:"delete",LiveUpdates:"live_updates",MessageDeliveryUpdates:"message_delivery_updates",Admin:"admin"}),l=new(c("WADeprecatedWapParser"))("incomingNewsletterNotificationParser",function(a){var b=a.mapFirstChild(function(a){return a.tag()}),e=k.cast(b),f=a.attrFromJid();if(e==null){d("WALogger").ERROR(j(),b).tags("newsletter").devConsole(a,b).sendLogs("newsletter-failed-to-cast-notification");throw c("err")("Failed to cast "+b)}if(f.type!=="newsletter"){d("WALogger").ERROR(i()).tags("newsletter").devConsole(f).sendLogs("newsletter-wrong-notification-sender-type-"+f.type);throw c("err")("Unexpected from "+f.type)}return{firstChildTag:e,from:f.newsletterJid}});function a(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){try{var b=l.parseOrThrow(a),e=b.firstChildTag;b=b.from;return yield c("WAWebNewsletterNotificationQueue").enqueue(b,function(){switch(e){case k.Join:return d("WAWebNewsletterHandleJoinNotification").handleNewsletterJoinNotification(a);case k.Metadata:return c("WAWebNewsletterHandleMetadataNotification")(a);case k.Leave:return c("WAWebNewsletterHandleLeaveNotification")(a);case k.Delete:return c("WAWebNewsletterDeleteNotification")(a);case k.LiveUpdates:return d("WAWebNewsletterHandleLiveUpdatesNotification").handleNewsletterLiveUpdatesNotification(a);case k.MessageDeliveryUpdates:return d("WAWebNewsletterHandleMessageDeliveryUpdateNotification").handleNewsletterMessageDeliveryUpdateNotification(a);case k.Admin:return c("WAWebNewsletterHandleAdminNotification")(a)}})}catch(a){d("WALogger").ERROR(h()).tags("newsletter").devConsole(a).sendLogs("failed-to-parse-newsletter-notification");throw new(d("WAParsableWapNode").XmppParsingFailure)("incomingNewsletterNotificationParser",a instanceof Error?a.name:typeof a+" was thrown rather than an Error")}});return m.apply(this,arguments)}g["default"]=a}),98);
__d("WASmaxInMdBaseIQSetRequestMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"iq");if(!b.success)return b;b=d("WASmaxParseUtils").attrStanzaId(a,"id");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","set");return!a.success?a:d("WAResultOrError").makeResult({id:b.value,type:a.value})}g.parseBaseIQSetRequestMixin=a}),98);
__d("WASmaxInMdSetToCompanionRequest",["WAResultOrError","WASmaxInMdBaseIQSetRequestMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"ref");if(!b.success)return b;b=d("WASmaxParseUtils").contentBytes(a);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}function a(a){var b=d("WASmaxParseUtils").assertTag(a,"iq");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"pair-device");if(!b.success)return b;var c=d("WASmaxParseJid").literalJid(d("WASmaxParseJid").attrDomainJid,a,"from","s.whatsapp.net");if(!c.success)return c;var e=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"xmlns","md");if(!e.success)return e;a=d("WASmaxInMdBaseIQSetRequestMixin").parseBaseIQSetRequestMixin(a);if(!a.success)return a;b=d("WASmaxParseUtils").mapChildrenWithTag(b.value,"ref",6,6,h);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({from:c.value,xmlns:e.value},a.value,{pairDeviceRef:b.value}))}g.parseSetToCompanionRequestPairDeviceRef=h;g.parseSetToCompanionRequest=a}),98);
__d("WASmaxOutMdSetToCompanionResponseClientResponse",["WASmaxJsx","WASmaxParseJid","WASmaxParseReference","WASmaxParseUtils","WASmaxParsingFailure","WAWap"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseReference").attrFromReference(d("WASmaxParseUtils").attrStanzaId,a,["id"]);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(b.error);a=d("WASmaxParseReference").attrFromReference(d("WASmaxParseJid").attrDomainJid,a,["from"]);if(!a.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(a.error);b=d("WASmaxJsx").smax("iq",{id:d("WAWap").STANZA_ID(b.value),to:d("WAWap").DOMAIN_JID(a.value),type:"result"});return b}g.makeSetToCompanionResponseClientResponse=a}),98);
__d("WASmaxMdSetToCompanionRPC",["WASmaxInMdSetToCompanionRequest","WASmaxOutMdSetToCompanionResponseClientResponse","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInMdSetToCompanionRequest").parseSetToCompanionRequest(a);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("SetToCompanion",{Request:b}));return{parsedRequest:b.value,makeSetToCompanionResponseClientResponse:function(){return d("WASmaxOutMdSetToCompanionResponseClientResponse").makeSetToCompanionResponseClientResponse(a)}}}g.receiveSetToCompanionRPC=a}),98);
__d("WAWebHandlePairDevice",["Promise","WABinary","WALogger","WAShiftTimer","WASmaxMdSetToCompanionRPC","WAWebAdvSignatureApi","WAWebConnModel","WAWebNetworkStatus","WAWebSocketConstants","WAWebSocketModel","WAWebUserPrefsMultiDevice","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handlePairDevice: wrong pair device result received from server"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Parsing Error: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["error while parsing: ",""]);k=function(){return a};return a}var l=60*1e3,m=20*1e3,n=[],o=null;function a(a){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e;try{e=d("WASmaxMdSetToCompanionRPC").receiveSetToCompanionRPC(a)}catch(c){d("WALogger").DEV(k(),a.toString());d("WALogger").ERROR(j(),c.toString());return(h||(h=b("Promise"))).reject(c)}a=e;var f=a.parsedRequest;a=a.makeSetToCompanionResponseClientResponse;f={refs:f.pairDeviceRef.map(function(a){a=new(d("WABinary").Binary)(a.elementValue);return a.readString(a.size())}),id:f.id};if(!f||!f.refs||!Array.isArray(f.refs)||f.refs.length!==6)d("WALogger").WARN(i());else{f=f.refs;a();yield d("WAWebAdvSignatureApi").generateADVSecretKey();n=f;o||(o=new(d("WAShiftTimer").ShiftTimer)(function(){if(d("WAWebUserPrefsMultiDevice").isRegistered()||!c("WAWebNetworkStatus").online)o&&o.cancel(),o=null;else if(!n||!n.length)o&&o.cancel(),o=null,d("WAWebSocketModel").Socket.state=d("WAWebSocketConstants").SOCKET_STATE.UNPAIRED_IDLE;else{var a=n.length===6?l:m,b=n.shift();d("WAWebConnModel").Conn.set({ref:b,refTTL:a});d("WAWebSocketModel").Socket.state=d("WAWebSocketConstants").SOCKET_STATE.UNPAIRED;o&&o.onOrAfter(a)}}));o.forceRunNow()}});return p.apply(this,arguments)}g["default"]=a}),98);
__d("WASmaxInMdSetRegRequest",["WAResultOrError","WASmaxInMdBaseIQSetRequestMixin","WASmaxInMdEnums","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"biz");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"name");return!b.success?b:d("WAResultOrError").makeResult({name:b.value})}function a(a){var b=d("WASmaxParseUtils").assertTag(a,"iq");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"pair-success");if(!b.success)return b;var c=d("WASmaxParseUtils").flattenedChildWithTag(b.value,"device-identity");if(!c.success)return c;var e=d("WASmaxParseUtils").flattenedChildWithTag(b.value,"device");if(!e.success)return e;var f=d("WASmaxParseUtils").flattenedChildWithTag(b.value,"platform");if(!f.success)return f;b=d("WASmaxParseUtils").optionalChildWithTag(b.value,"biz",h);if(!b.success)return b;var g=d("WASmaxParseJid").literalJid(d("WASmaxParseJid").attrDomainJid,a,"from","s.whatsapp.net");if(!g.success)return g;var i=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"xmlns","md");if(!i.success)return i;c=d("WASmaxParseUtils").contentBytesRange(c.value,1,500);if(!c.success)return c;var j=d("WASmaxParseJid").attrDeviceJid(e.value,"jid");if(!j.success)return j;var k=d("WASmaxParseUtils").optional(d("WASmaxParseJid").attrDeviceJid,e.value,"lid");if(!k.success)return k;e=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrStringEnum,e.value,"beta",d("WASmaxInMdEnums").ENUM_FALSE_TRUE);if(!e.success)return e;f=d("WASmaxParseUtils").attrString(f.value,"name");if(!f.success)return f;a=d("WASmaxInMdBaseIQSetRequestMixin").parseBaseIQSetRequestMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({from:g.value,xmlns:i.value,pairSuccessDeviceIdentityElementValue:c.value,pairSuccessDeviceJid:j.value,pairSuccessDeviceLid:k.value,pairSuccessDeviceBeta:e.value,pairSuccessPlatformName:f.value},a.value,{pairSuccessBiz:b.value}))}g.parseSetRegRequestPairSuccessBiz=h;g.parseSetRegRequest=a}),98);
__d("WASmaxOutMdRegularCompanionSetRegResponseBundleMixin",["WASmaxAttrs","WASmaxChildren","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=a.keyAttestationKeyId;a=a.keyAttestationElementValue;b=d("WASmaxJsx").smax("key_attestation",{key_id:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,b)},a);return b}function i(a){a=a.gpiaElementValue;a=d("WASmaxJsx").smax("gpia",null,a);return a}function j(a){var b=a.keyAttestationArgs,c=a.gpiaArgs,e=a.deviceIdentityKeyIndex;a=a.deviceIdentityElementValue;e=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("pair-device-sign",null,d("WASmaxJsx").smax("device-identity",{"key-index":d("WAWap").INT(e)},a),d("WASmaxChildren").OPTIONAL_CHILD(h,b),d("WASmaxChildren").OPTIONAL_CHILD(i,c)));return e}function a(a,b){b=j(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.makeRegularCompanionSetRegResponseBundlePairDeviceSignKeyAttestation=h;g.makeRegularCompanionSetRegResponseBundlePairDeviceSignGpia=i;g.mergeRegularCompanionSetRegResponseBundleMixin=a}),98);
__d("WASmaxOutMdSetRegResponseClientResponse",["WASmaxJsx","WASmaxOutMdRegularCompanionSetRegResponseBundleMixin","WASmaxParseReference","WASmaxParseUtils","WASmaxParsingFailure","WAWap"],(function(a,b,c,d,e,f,g){function a(a,b){b=d("WASmaxParseReference").attrFromReference(d("WASmaxParseUtils").attrStanzaId,b,["id"]);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(b.error);b=d("WASmaxOutMdRegularCompanionSetRegResponseBundleMixin").mergeRegularCompanionSetRegResponseBundleMixin(d("WASmaxJsx").smax("iq",{id:d("WAWap").STANZA_ID(b.value),to:d("WAWap").S_WHATSAPP_NET,type:"result"}),a);return b}g.makeSetRegResponseClientResponse=a}),98);
__d("WASmaxOutMdIQErrorNotAuthorizedMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("error",{text:"not-authorized",code:d("WAWap").INT(401)});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIQErrorNotAuthorizedMixin=a}),98);
__d("WASmaxOutMdSetRegResponseError",["WASmaxJsx","WASmaxOutMdIQErrorNotAuthorizedMixin","WASmaxParseReference","WASmaxParseUtils","WASmaxParsingFailure","WAWap"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseReference").attrFromReference(d("WASmaxParseUtils").attrStanzaId,a,["id"]);if(!a.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(a.error);a=d("WASmaxJsx").smax("iq",{id:d("WAWap").STANZA_ID(a.value),to:d("WAWap").S_WHATSAPP_NET,type:"error"},d("WASmaxOutMdIQErrorNotAuthorizedMixin").mergeIQErrorNotAuthorizedMixin(d("WASmaxJsx").smax("error",null)));return a}g.makeSetRegResponseError=a}),98);
__d("WASmaxOutMdHostedCompanionSetRegResponseBundleMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.deviceIdentityElementValue;a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("hosted-pair-set",null,d("WASmaxJsx").smax("device-identity",null,a)));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeHostedCompanionSetRegResponseBundleMixin=a}),98);
__d("WASmaxOutMdSetRegResponseHostedClientResponse",["WASmaxJsx","WASmaxOutMdHostedCompanionSetRegResponseBundleMixin","WASmaxParseReference","WASmaxParseUtils","WASmaxParsingFailure","WAWap"],(function(a,b,c,d,e,f,g){function a(a,b){b=d("WASmaxParseReference").attrFromReference(d("WASmaxParseUtils").attrStanzaId,b,["id"]);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(b.error);b=d("WASmaxOutMdHostedCompanionSetRegResponseBundleMixin").mergeHostedCompanionSetRegResponseBundleMixin(d("WASmaxJsx").smax("iq",{id:d("WAWap").STANZA_ID(b.value),to:d("WAWap").S_WHATSAPP_NET,type:"result"}),a);return b}g.makeSetRegResponseHostedClientResponse=a}),98);
__d("WASmaxMdSetRegRPC",["WASmaxInMdSetRegRequest","WASmaxOutMdSetRegResponseClientResponse","WASmaxOutMdSetRegResponseError","WASmaxOutMdSetRegResponseHostedClientResponse","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInMdSetRegRequest").parseSetRegRequest(a);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("SetReg",{Request:b}));return{parsedRequest:b.value,makeSetRegResponseClientResponse:function(b){return d("WASmaxOutMdSetRegResponseClientResponse").makeSetRegResponseClientResponse(b,a)},makeSetRegResponseHostedClientResponse:function(b){return d("WASmaxOutMdSetRegResponseHostedClientResponse").makeSetRegResponseHostedClientResponse(b,a)},makeSetRegResponseError:function(){return d("WASmaxOutMdSetRegResponseError").makeSetRegResponseError(a)}}}g.receiveSetRegRPC=a}),98);
__d("WAWebHandlePairSuccess",["invariant","Promise","WABase64","WABinary","WACryptoHmac","WALogger","WANullthrows","WAQplTypes","WASmaxMdSetRegRPC","WATimeUtils","WAWebAdvSignatureApi","WAWebAltDeviceLinkingApi","WAWebBizAgentAction","WAWebCompanionRegUtils","WAWebConnModel","WAWebCryptoCurve25519","WAWebE2ETestPairingConstants","WAWebJidToWid","WAWebLocalStorage","WAWebLogoutReasonConstants","WAWebMobilePlatforms","WAWebProtobufsAdv.pb","WAWebSignalCommonUtils","WAWebSignalStoreApi","WAWebSocketLogoutJob","WAWebUserPrefsHistorySync","WAWebUserPrefsMeUser","WAWebUserPrefsMultiDevice","WAWebWamDeviceLinkReporter","WAWebWamEnumMdLinkDeviceCompanionStage","WAWebWidFactory","asyncToGeneratorRuntime","decodeProtobuf","encodeProtobuf","gkx"],(function(a,b,c,d,e,f,g,h){var i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["error in handlePairSuccess, ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Parsing Error: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["error while parsing: ",""]);l=function(){return a};return a}var m=!1;function a(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){c("gkx")("26256")&&(c("WAWebLocalStorage")==null?void 0:c("WAWebLocalStorage").removeItem(d("WAWebE2ETestPairingConstants").PAIRING_ATTEMPT_ONGOING_KEY));if(m||d("WAWebUserPrefsMultiDevice").isRegistered())return;m=!0;var e=d("WATimeUtils").unixTimeWithoutClockSkewCorrection(),f=null;try{f=d("WASmaxMdSetRegRPC").receiveSetRegRPC(a)}catch(c){d("WALogger").DEV(l(),a.toString());d("WALogger").ERROR(k(),c.toString());m=!1;return(i||(i=b("Promise"))).reject(c)}a=f;f=a.parsedRequest;var g=a.makeSetRegResponseClientResponse;a=a.makeSetRegResponseError;try{d("WAWebCompanionRegUtils").resetCompanionReg();d("WAWebUserPrefsMultiDevice").setPairingTimestamp(e);if(d("WAWebAltDeviceLinkingApi").getPairingType()===d("WAWebAltDeviceLinkingApi").PairingType.ALT_DEVICE_LINKING){var n;(n=d("WAWebAltDeviceLinkingApi").getCurrentMarker())==null?void 0:n.addPoint("alt_linking_pair_success");(n=d("WAWebAltDeviceLinkingApi").getCurrentMarker())==null?void 0:n.end(d("WAQplTypes").QuickLogActionType.SUCCESS)}n=f.pairSuccessDeviceJid;var o=f.pairSuccessDeviceIdentityElementValue,p=f.pairSuccessPlatformName;f=f.pairSuccessDeviceLid;d("WAWebConnModel").Conn.blockStoreAdds=!1;d("WAWebConnModel").Conn.platform=p;yield d("WAWebMobilePlatforms").setMobilePlatform(p);p=d("decodeProtobuf").decodeProtobuf(d("WAWebProtobufsAdv.pb").ADVSignedDeviceIdentityHMACSpec,o);o=p.details;p=p.hmac;o!=null&&p!=null||h(0,56299);var q=new(d("WABinary").Binary)(o).readByteArray(),r=(yield d("WAWebAdvSignatureApi").getADVSecretKey());r=(yield d("WACryptoHmac").hmacSha256(r,q));q=d("WABase64").encodeB64(r);r=d("WABase64").encodeB64(p);if(q!==r){d("WAWebCompanionRegUtils").logoutAfterValidationFail();m=!1;return a()}p=d("decodeProtobuf").decodeProtobuf(d("WAWebProtobufsAdv.pb").ADVSignedDeviceIdentitySpec,o);q=p.accountSignatureKey;q!=null||h(0,56344);r=p.accountSignature;r!=null||h(0,56295);o=(yield d("WAWebSignalStoreApi").waSignalStore.getRegistrationInfo());o!=null||h(0,56296);yield d("WAWebWamDeviceLinkReporter").initDeviceLinkEvent(q,o.identityKeyPair.pubKey,e);yield d("WAWebWamDeviceLinkReporter").setDeviceLinkPairStage(d("WAWebWamEnumMdLinkDeviceCompanionStage").MD_LINK_DEVICE_COMPANION_STAGE.PAIR_SUCCESS_RECEIVED);d("WAWebCompanionRegUtils").initDevicePairingLatencyMeasurement();r=d("WAWebAdvSignatureApi").verifyDeviceIdentityAccountSignature(p,o.identityKeyPair.pubKey,null);if(!r){yield d("WAWebWamDeviceLinkReporter").commitDeviceLinkEvent(401);d("WAWebCompanionRegUtils").logoutAfterValidationFail();m=!1;return a()}p.deviceSignature=(yield d("WAWebAdvSignatureApi").generateDeviceSignature(p,o.identityKeyPair,q));yield d("WAWebSignalStoreApi").waSignalStore.putIdentity(d("WAWebSignalCommonUtils").createSignalAddress(d("WAWebWidFactory").toUserWid(d("WAWebJidToWid").deviceJidToDeviceWid(n))).toString(),d("WAWebSignalCommonUtils").bufferToStr(d("WAWebCryptoCurve25519").toSignalCurvePubKey(q)));yield d("WAWebAdvSignatureApi").setADVSignedIdentity(p);r=d("decodeProtobuf").decodeProtobuf(d("WAWebProtobufsAdv.pb").ADVDeviceIdentitySpec,p.details);a=r.keyIndex;a!=null||h(0,56297);p.accountSignatureKey=void 0;o=d("encodeProtobuf").encodeProtobuf(d("WAWebProtobufsAdv.pb").ADVSignedDeviceIdentitySpec,p).readByteArray();q=g({deviceIdentityElementValue:o,deviceIdentityKeyIndex:a});yield d("WAWebWamDeviceLinkReporter").setDeviceLinkPairStage(d("WAWebWamEnumMdLinkDeviceCompanionStage").MD_LINK_DEVICE_COMPANION_STAGE.PAIR_DEVICE_SIGN_SENT);d("WAWebUserPrefsMeUser").setMe(d("WAWebJidToWid").deviceJidToDeviceWid(n));f!=null&&d("WAWebUserPrefsMeUser").setMeLid(d("WAWebJidToWid").deviceJidToDeviceWid(f));r=(yield d("WAWebUserPrefsHistorySync").getInitialHistorySyncComplete());r!==!0&&d("WAWebCompanionRegUtils").startInitialHistorySyncTimeout();m=!1;d("WAWebBizAgentAction").setShouldLogAgentLogin({loginTimestamp:e});return q}catch(a){d("WALogger").ERROR(j(),a).verbose().devConsole(a).sendLogs("error in handlePairSuccess"),yield d("WAWebWamDeviceLinkReporter").commitDeviceLinkEvent(-1),yield d("WAWebSocketLogoutJob").socketLogout(d("WAWebLogoutReasonConstants").LogoutReason.UnknownCompanion)}});return n.apply(this,arguments)}g["default"]=a}),98);
__d("WAWebHandlePreKeyLow",["WADeprecatedWapParser","WALogger","WAWap","WAWebEventsWaitForOfflineDeliveryEnd","WAWebSignalStoreApi","WAWebUploadPreKeysJob","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["handlePreKeyLow: Parsing Error: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handlePreKeyLow: error while parsing: ",""]);i=function(){return a};return a}var j=new Set(),k=new(c("WADeprecatedWapParser"))("lowKeyParser",function(a){a.assertTag("notification");a.assertAttr("type","encrypt");a.assertFromServer();return{stanzaId:a.attrString("id"),numRemaining:a.child("count").attrInt("value")}});function a(a,b){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=k.parse(a);if(c.error){d("WALogger").DEV(i(),a.toString());d("WALogger").ERROR(h(),c.error.toString());throw c.error}else{a=c.success;var e=d("WAWap").wap("ack",{to:d("WAWap").S_WHATSAPP_NET,id:d("WAWap").CUSTOM_STRING(a.stanzaId),"class":"notification"});if(j.has(b))return e;j.add(b);d("WAWebSignalStoreApi").waSignalStore.setServerHasPreKeys(!1);yield d("WAWebEventsWaitForOfflineDeliveryEnd").waitForOfflineDeliveryEnd();return d("WAWebUploadPreKeysJob").uploadPreKeys().then(function(){return e})["finally"](function(){return void j["delete"](b)})}});return l.apply(this,arguments)}g["default"]=a}),98);
__d("WASmaxInPresenceEnums",["WAJids"],(function(a,b,c,d,e,f,g){a={deny:"deny",error:"error",none:"none"};b={validators:[d("WAJids").validateGroupJid,d("WAJids").validateUserJid],typeName:"GroupJid|UserJid"};g.ENUM_DENY_ERROR_NONE=a;g.GROUPJID_USERJID=b}),98);
__d("WASmaxInPresenceAvailableMixin",["WAResultOrError","WASmaxInPresenceEnums","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"presence");if(!b.success)return b;b=d("WASmaxParseJid").attrJidEnum(a,"from",d("WASmaxInPresenceEnums").GROUPJID_USERJID);if(!b.success)return b;var c=d("WASmaxParseUtils").optionalLiteral(d("WASmaxParseUtils").attrString,a,"type","available");if(!c.success)return c;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,a,"last");return!a.success?a:d("WAResultOrError").makeResult({from:b.value,type:c.value,last:a.value})}g.parseAvailableMixin=a}),98);
__d("WASmaxInPresenceLastSeenWithOtherValueMixin",["WAResultOrError","WASmaxInPresenceEnums","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"presence");if(!b.success)return b;b=d("WASmaxParseJid").attrUserJid(a,"from");if(!b.success)return b;var c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","unavailable");if(!c.success)return c;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrStringEnum,a,"last",d("WASmaxInPresenceEnums").ENUM_DENY_ERROR_NONE);return!a.success?a:d("WAResultOrError").makeResult({from:b.value,type:c.value,last:a.value})}g.parseLastSeenWithOtherValueMixin=a}),98);
__d("WASmaxInPresenceUserUnavailableMixin",["WAResultOrError","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"presence");if(!b.success)return b;b=d("WASmaxParseJid").attrUserJid(a,"from");if(!b.success)return b;var c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","unavailable");if(!c.success)return c;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,a,"last");return!a.success?a:d("WAResultOrError").makeResult({from:b.value,type:c.value,last:a.value})}g.parseUserUnavailableMixin=a}),98);
__d("WASmaxInPresenceAvailableOrLastSeenWithOtherValueOrUserUnavailableMixinGroup",["WAResultOrError","WASmaxInPresenceAvailableMixin","WASmaxInPresenceLastSeenWithOtherValueMixin","WASmaxInPresenceUserUnavailableMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInPresenceAvailableMixin").parseAvailableMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"Available",value:b.value});var c=d("WASmaxInPresenceLastSeenWithOtherValueMixin").parseLastSeenWithOtherValueMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"LastSeenWithOtherValue",value:c.value});var e=d("WASmaxInPresenceUserUnavailableMixin").parseUserUnavailableMixin(a);return e.success?d("WAResultOrError").makeResult({name:"UserUnavailable",value:e.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["Available","LastSeenWithOtherValue","UserUnavailable"],[b,c,e])}g.parseAvailableOrLastSeenWithOtherValueOrUserUnavailableMixinGroup=a}),98);
__d("WASmaxInPresenceServerUpdateRequest",["WAResultOrError","WASmaxInPresenceAvailableOrLastSeenWithOtherValueOrUserUnavailableMixinGroup","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"presence");if(!b.success)return b;b=d("WASmaxInPresenceAvailableOrLastSeenWithOtherValueOrUserUnavailableMixinGroup").parseAvailableOrLastSeenWithOtherValueOrUserUnavailableMixinGroup(a);return!b.success?b:d("WAResultOrError").makeResult({availableOrLastSeenWithOtherValueOrUserUnavailableMixinGroup:b.value})}g.parseServerUpdateRequest=a}),98);
__d("WASmaxPresenceServerUpdateRPC",["WASmaxInPresenceServerUpdateRequest","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxInPresenceServerUpdateRequest").parseServerUpdateRequest(a);if(!a.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("ServerUpdate",{Request:a}));return{parsedRequest:a.value}}g.receiveServerUpdateRPC=a}),98);
__d("WAWebHandlePresence",["Promise","WALogger","WASmaxPresenceServerUpdateRPC","WATimeUtils","WAWebChangePresenceHandlerAction","WAWebJidToWid"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Parsing Error: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["error while parsing: ",""]);j=function(){return a};return a}function k(a){if(a!=null){if(!["deny","none","error"].includes(a))return d("WATimeUtils").castToUnixTime(Number(a))}else return d("WATimeUtils").unixTime()}function a(a){try{var e=d("WASmaxPresenceServerUpdateRPC").receiveServerUpdateRPC(a);e=e.parsedRequest.availableOrLastSeenWithOtherValueOrUserUnavailableMixinGroup;e={id:d("WAWebJidToWid").chatJidToChatWid(e.value.from),type:e.value.type||"available",deny:e.value.last==="deny"||void 0,t:e.value.type==="unavailable"?k(e.value.last):void 0};return c("WAWebChangePresenceHandlerAction")(e)}catch(c){d("WALogger").DEV(j(),a.toString());d("WALogger").ERROR(i(),c.toString());return(h||(h=b("Promise"))).reject(c)}}g["default"]=a}),98);
__d("WAWebSetTcTokenChatAction",["WAArrayBufferUtils","WAWebApiOrphanTcToken","WAWebChatGetExistingBridge","WAWebSchemaChat","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,b,c){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){if(c==null)return;if(!a.isUserNotPSA())return;var e=(yield d("WAWebChatGetExistingBridge").getExisting(a));if(e==null){yield d("WAWebApiOrphanTcToken").createOrUpdateOrphanTcToken(a.toString(),{tcToken:c,tcTokenTimestamp:b});return}if(e.tcToken!=null&&d("WAArrayBufferUtils").arrayBuffersEqualUNSAFE(e.tcToken,c)||e.tcTokenTimestamp!=null&&e.tcTokenTimestamp>b)return;c={tcToken:c,tcTokenTimestamp:b};e.set(c);yield d("WAWebSchemaChat").getChatTable().merge(a.toString(),c)});return h.apply(this,arguments)}g.setTcToken=a}),98);
__d("WAWebHandlePrivacyTokensNotification",["Promise","WAByteArray","WADeprecatedWapParser","WALogger","WAWap","WAWebApiChat","WAWebEventsWaitForOfflineDeliveryEnd","WAWebJidToWid","WAWebPnhGatingUtils","WAWebPresenceCollection","WAWebSetTcTokenChatAction","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Parsing Error: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["error while parsing: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Privacy Tokens notification received, node: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["incomingPrivacyTokensParser - receiving an unknown token: ",""]);l=function(){return a};return a}var m=function(a){var b=d("WAByteArray").uint8ArrayToBuffer(a.contentBytes());return{type:"trusted_contact",content:b,ts:a.attrTime("t")}},n=new(c("WADeprecatedWapParser"))("incomingPrivacyTokensParser",function(a){a.assertTag("notification");var b=a.attrString("id"),c=a.attrUserJid("from");a=a.child("tokens");var e=[];a.forEachChildWithTag("token",function(a){var b=a.attrString("type");switch(b){case"trusted_contact":e.push(m(a));break;default:d("WALogger").LOG(l(),b)}});return{id:b,from:c,privacyTokens:e}});function o(a,b){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=b.ts;a=d("WAWebJidToWid").userJidToUserWid(a.from);b.type==="trusted_contact"&&(d("WAWebPnhGatingUtils").isMatFullyEnabled()&&a.isUser()&&(a=d("WAWebWidFactory").toUserWid(yield d("WAWebApiChat").getMatChatIncomingMessage(a))),yield d("WAWebSetTcTokenChatAction").setTcToken(a,c,b.content),yield d("WAWebPresenceCollection").PresenceCollection.reSubscribeWhenActive(a))});return p.apply(this,arguments)}function a(a){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WALogger").DEV(k(),a);var c=n.parse(a);if(c.error){d("WALogger").LOG(j(),a.toString());d("WALogger").ERROR(i(),c.error.toString());throw c.error}var e=c.success;a=d("WAWap").wap("ack",{id:d("WAWap").CUSTOM_STRING(e.id),"class":"notification",to:d("WAWap").JID(e.from),type:"privacy_token"});yield d("WAWebEventsWaitForOfflineDeliveryEnd").waitForOfflineDeliveryEnd();yield (h||(h=b("Promise"))).all(e.privacyTokens.map(function(a){return o(e,a)}));return a});return q.apply(this,arguments)}g["default"]=a}),98);
__d("WAWebHandleProfilePicNotification",["Promise","WADeprecatedWapParser","WALogger","WAWap","WAWebBackendJobsCommon","WAWebChangeProfilePicThumb","WAWebCommsWapMd","WAWebGroupSystemMsg","WAWebHandleSingleMsg","WAWebJidToWid","WAWebOrchestratorNonPersistedJob","WAWebProfilePicConstants","WAWebSchemaContact","WAWebUserPrefsMeUser","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Invalid type received"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["could not find side contact hash for profile pic update operation"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Parsing Error: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["error while parsing: ",""]);l=function(){return a};return a}var m=new(c("WADeprecatedWapParser"))("incomingProfilePicNotificationParser",function(a){a.assertTag("notification");var b,c;if(a.hasChild("delete"))b="delete",c=a.child("delete");else if(a.hasChild("set"))b="set",c=a.child("set");else if(a.hasChild("request"))b="request",c=a.child("request"),c.assertAttr("jid",d("WAWebUserPrefsMeUser").assertGetMe().toJid());else return a["throw"]("Expected child type to be one of: set, delete, request");var e=a.attrString("id");return c.hasAttr("jid")?{type:b,from:d("WAWebJidToWid").chatJidToChatWid(a.attrChatJid("from")),jid:d("WAWebJidToWid").chatJidToChatWid(c.attrChatJid("jid")),author:c.hasAttr("author")?d("WAWebJidToWid").userJidToUserWid(c.attrUserJid("author")):null,ts:a.attrTime("t"),rawTs:a.attrString("t"),stanzaId:e,picId:b==="set"?c.attrInt("id",1):0}:{from:d("WAWebJidToWid").userJidToUserWid(a.attrUserJid("from")),jid:null,type:b,hash:c.attrString("hash"),ts:a.attrTime("t"),stanzaId:e}});function n(a){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=m.parse(a);if(c.error){d("WALogger").DEV(l(),a.toString());d("WALogger").ERROR(k(),c.error.toString());return(h||(h=b("Promise"))).reject(c.error)}var e=c.success;a=(h||(h=b("Promise"))).resolve();if(e.jid||e.hash){var f;if(e.jid)f=e.jid;else{c=(yield d("WAWebSchemaContact").getContactTable().equals(["contactHash"],e.hash));c.length===0?d("WALogger").WARN(j()):f=d("WAWebWidFactory").createWid(c[0].id)}switch(e.type){case"delete":case"set":var g=e.type==="delete"?d("WAWebProfilePicConstants").ProfilePicCommand.Remove:d("WAWebProfilePicConstants").ProfilePicCommand.Set;f&&(a=d("WAWebChangeProfilePicThumb").changeProfilePicThumb(f,g).then(function(){if(!f.isGroup())return;if(e.ts!=null){var a=d("WAWebGroupSystemMsg").genGroupPicChangeNotificationMsg(f,g,e.ts,e.author||d("WAWebUserPrefsMeUser").getMeUser());return d("WAWebHandleSingleMsg").handleSingleMsg(f,a,"profilePicNotification")}}));break;case"request":break;default:d("WALogger").WARN(i()).devConsole(e.type)}}return a.then(function(){return d("WAWap").wap("ack",{id:d("WAWap").CUSTOM_STRING(e.stanzaId),to:d("WAWebCommsWapMd").JID(e.from),"class":"notification",type:"picture"})})});return o.apply(this,arguments)}function a(a){var b=d("WAWebBackendJobsCommon").getNonCriticalNotificationPriority(Boolean(a.attrs.offline));return d("WAWebOrchestratorNonPersistedJob").createNonPersistedJob("handleProfilePicNotification",function(a){return n(a.node)},{priority:b}).waitUntilCompleted({node:a})}g.handleProfilePicNotificationJob=a}),98);
__d("WAWebRevokeStatusPsaMsgAction",["Promise","WALogger","WAWebMessageStore","WAWebStatusV3Collection","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["revokeStatusPSA completed"]);i=function(){return a};return a}function j(a,b){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){b.length>0&&(a.revokeMsgs(b),yield d("WAWebMessageStore").removeMessagesFromHistory(b),d("WALogger").LOG(i()).tags("revoke-status-psa"))});return k.apply(this,arguments)}function a(){var a=d("WAWebStatusV3Collection").StatusV3Collection.getPSAStatus();if(!a)return(h||(h=b("Promise"))).resolve();var c=a.msgs.map(function(a){return a.id.toString()});return j(a,c)}function c(a){var c=d("WAWebStatusV3Collection").StatusV3Collection.getPSAStatus();if(!c)return(h||(h=b("Promise"))).resolve();var e=c.msgs.filter(function(b){return b.campaignId===a}).map(function(a){return a.id.toString()});return j(c,e)}g.revokeAllStatusPSA=a;g.revokeStatusPSA=c}),98);
__d("WAWebHandlePsa",["$InternalEnum","Promise","WAByteArray","WADeprecatedWapParser","WAJids","WALogger","WAWap","WAWebABProps","WAWebBackendJobs.flow","WAWebCommsWapMd","WAWebHandleMsgProcess","WAWebHandleMsgTypes.flow","WAWebJidToWid","WAWebRevokeStatusPsaMsgAction","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Parsing Error: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["error while parsing: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["PSA notification received, node: ",""]);k=function(){return a};return a}var l=b("$InternalEnum")({Image:"image",Video:"video",Text:"text"}),m=new(c("WADeprecatedWapParser"))("incomingCampaignParser",function(a){a.assertTag("notification");a.assertAttr("from",d("WAJids").STATUS_JID);var b=a.attrString("id"),c=d("WAWebJidToWid").userJidToUserWid(a.attrUserJid("participant")),e=a.attrTime("t");a=a.child("campaign");var f=a.hasChild("revoke"),g=a.attrString("id"),h=a.maybeAttrInt("duration");a=a.mapChildrenWithTag("message",function(a){var b=a.child("media");b.attrEnumValues("mediatype",l.members());a={id:a.attrString("id"),ts:e,body:d("WAByteArray").uint8ArrayToBuffer(b.contentBytes())};return a});return{participant:c,stanzaId:b,campaignId:g,campaignDuration:h,revoke:f,ts:e,messages:a}});function n(a,b){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=a.participant,e=a.campaignId;a=a.campaignDuration;var f=b.id,g=b.ts;b=b.body;f={type:d("WAWebHandleMsgTypes.flow").MESSAGE_TYPE.OTHER_STATUS,externalId:f,ts:g,edit:-1,isHsm:!1,count:null,chat:d("WAWebWidFactory").createWid(d("WAJids").STATUS_JID),author:c,pushname:null,isDirect:!1,campaignId:e,campaignDuration:a};g={retryCount:0,e2eType:d("WAWebBackendJobs.flow").CiphertextType.Msg,encMediaType:d("WAWebBackendJobs.flow").EncMediaType.Image,hideFail:!1};c={nativeFlowName:null,verifiedNameSerial:null,verifiedLevel:null,verifiedNameCert:null,privacyMode:null,campaignId:null};yield d("WAWebHandleMsgProcess").processDecryptedMessageProto({decrypted:b,info:f,e2eInfo:g,bizInfo:c,hsmInfo:null,isPadded:!1})});return o.apply(this,arguments)}function a(a){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WALogger").DEV(k(),a);var c=m.parse(a);if(c.error){d("WALogger").LOG(j(),a.toString());d("WALogger").ERROR(i(),c.error.toString());throw c.error}var e=c.success;a=d("WAWap").wap("ack",{id:d("WAWap").CUSTOM_STRING(e.stanzaId),participant:d("WAWebCommsWapMd").JID(e.participant),"class":"notification",type:"psa",to:d("WAWebCommsWapMd").JID(d("WAWebWidFactory").createWid(d("WAJids").STATUS_JID))});if(!d("WAWebABProps").getABPropConfigValue("web_status_psa"))return a;e.revoke?yield d("WAWebRevokeStatusPsaMsgAction").revokeStatusPSA(e.campaignId):yield (h||(h=b("Promise"))).all(e.messages.map(function(a){return n(e,a)}));return a});return p.apply(this,arguments)}g["default"]=a}),98);
__d("WASmaxInQpSurfacesEnums",[],(function(a,b,c,d,e,f){a={"false":"false","true":"true"};f.ENUM_FALSE_TRUE=a}),66);
__d("WASmaxInQpSurfacesQPSurfacesMixin",["WAResultOrError","WASmaxInQpSurfacesEnums","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"trigger");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"name");return!b.success?b:d("WAResultOrError").makeResult({name:b.value})}function i(a){var b=d("WASmaxParseUtils").assertTag(a,"header");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"title");return!b.success?b:d("WAResultOrError").makeResult({title:b.value})}function j(a){var b=d("WASmaxParseUtils").assertTag(a,"light");if(!b.success)return b;b=d("WASmaxParseUtils").contentBytes(a);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}function k(a){var b=d("WASmaxParseUtils").assertTag(a,"dark");if(!b.success)return b;b=d("WASmaxParseUtils").contentBytes(a);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}function l(a){var b=d("WASmaxParseUtils").assertTag(a,"image");if(!b.success)return b;b=d("WASmaxParseUtils").optionalChildWithTag(a,"light",j);if(!b.success)return b;var c=d("WASmaxParseUtils").optionalChildWithTag(a,"dark",k);if(!c.success)return c;a=d("WASmaxParseUtils").attrString(a,"description");return!a.success?a:d("WAResultOrError").makeResult({description:a.value,light:b.value,dark:c.value})}function m(a){var b=d("WASmaxParseUtils").assertTag(a,"primary_action");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"text");if(!b.success)return b;var c=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,a,"universal_link");if(!c.success)return c;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,a,"deep_link");return!a.success?a:d("WAResultOrError").makeResult({text:b.value,universalLink:c.value,deepLink:a.value})}function n(a){var b=d("WASmaxParseUtils").assertTag(a,"secondary_action");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"text");if(!b.success)return b;var c=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,a,"universal_link");if(!c.success)return c;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,a,"deep_link");return!a.success?a:d("WAResultOrError").makeResult({text:b.value,universalLink:c.value,deepLink:a.value})}function o(a){var b=d("WASmaxParseUtils").assertTag(a,"colors");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"light");if(!b.success)return b;a=d("WASmaxParseUtils").flattenedChildWithTag(a,"dark");if(!a.success)return a;var c=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,b.value,"background");if(!c.success)return c;b=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,b.value,"highlight");if(!b.success)return b;var e=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,a.value,"background");if(!e.success)return e;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,a.value,"highlight");return!a.success?a:d("WAResultOrError").makeResult({lightBackground:c.value,lightHighlight:b.value,darkBackground:e.value,darkHighlight:a.value})}function p(a){var b=d("WASmaxParseUtils").assertTag(a,"attribute");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"key");if(!b.success)return b;a=d("WASmaxParseUtils").attrString(a,"value");return!a.success?a:d("WAResultOrError").makeResult({key:b.value,value:a.value})}function q(a){var b=d("WASmaxParseUtils").assertTag(a,"content_attributes");if(!b.success)return b;b=d("WASmaxParseUtils").mapChildrenWithTag(a,"attribute",0,50,p);return!b.success?b:d("WAResultOrError").makeResult({attribute:b.value})}function r(a){var b=d("WASmaxParseUtils").assertTag(a,"filter_rules");if(!b.success)return b;b=d("WASmaxParseUtils").contentBytes(a);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}function s(a){var b=d("WASmaxParseUtils").assertTag(a,"instance_log_data");if(!b.success)return b;b=d("WASmaxParseUtils").contentBytes(a);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}function t(a){var b=d("WASmaxParseUtils").assertTag(a,"promotion_config");if(!b.success)return b;b=d("WASmaxParseUtils").attrInt(a,"max_impressions");if(!b.success)return b;var c=d("WASmaxParseUtils").attrInt(a,"max_primary_clicks");if(!c.success)return c;var e=d("WASmaxParseUtils").attrInt(a,"max_secondary_clicks");if(!e.success)return e;a=d("WASmaxParseUtils").attrInt(a,"max_dismisses");return!a.success?a:d("WAResultOrError").makeResult({maxImpressions:b.value,maxPrimaryClicks:c.value,maxSecondaryClicks:e.value,maxDismisses:a.value})}function u(a){var b=d("WASmaxParseUtils").assertTag(a,"user_info");if(!b.success)return b;b=d("WASmaxParseUtils").attrInt(a,"impression_count");if(!b.success)return b;var c=d("WASmaxParseUtils").attrInt(a,"primary_click_count");if(!c.success)return c;var e=d("WASmaxParseUtils").attrInt(a,"secondary_click_count");if(!e.success)return e;a=d("WASmaxParseUtils").attrInt(a,"dismiss_click_count");return!a.success?a:d("WAResultOrError").makeResult({impressionCount:b.value,primaryClickCount:c.value,secondaryClickCount:e.value,dismissClickCount:a.value})}function v(a){var b=d("WASmaxParseUtils").assertTag(a,"pacing");if(!b.success)return b;b=d("WASmaxParseUtils").optionalChildWithTag(a,"promotion_config",t);if(!b.success)return b;a=d("WASmaxParseUtils").optionalChildWithTag(a,"user_info",u);return!a.success?a:d("WAResultOrError").makeResult({promotionConfig:b.value,userInfo:a.value})}function w(a){var b=d("WASmaxParseUtils").assertTag(a,"promotion");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"title");if(!b.success)return b;var c=d("WASmaxParseUtils").flattenedChildWithTag(a,"text");if(!c.success)return c;var e=d("WASmaxParseUtils").flattenedChildWithTag(a,"qp_config");if(!e.success)return e;var f=d("WASmaxParseUtils").flattenedChildWithTag(e.value,"triggers");if(!f.success)return f;var g=d("WASmaxParseUtils").optionalChildWithTag(a,"header",i);if(!g.success)return g;var j=d("WASmaxParseUtils").optionalChildWithTag(a,"image",l);if(!j.success)return j;var k=d("WASmaxParseUtils").optionalChildWithTag(a,"primary_action",m);if(!k.success)return k;var p=d("WASmaxParseUtils").optionalChildWithTag(a,"secondary_action",n);if(!p.success)return p;var t=d("WASmaxParseUtils").optionalChildWithTag(a,"colors",o);if(!t.success)return t;var u=d("WASmaxParseUtils").optionalChildWithTag(a,"content_attributes",q);if(!u.success)return u;var w=d("WASmaxParseUtils").optionalChildWithTag(e.value,"filter_rules",r);if(!w.success)return w;var x=d("WASmaxParseUtils").optionalChildWithTag(e.value,"instance_log_data",s);if(!x.success)return x;var y=d("WASmaxParseUtils").optionalChildWithTag(e.value,"pacing",v);if(!y.success)return y;var z=d("WASmaxParseUtils").attrString(a,"id");if(!z.success)return z;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,a,"instance_id");if(!a.success)return a;b=d("WASmaxParseUtils").contentString(b.value);if(!b.success)return b;c=d("WASmaxParseUtils").contentString(c.value);if(!c.success)return c;var A=d("WASmaxParseUtils").attrString(e.value,"template_name");if(!A.success)return A;var B=d("WASmaxParseUtils").attrInt(e.value,"start_time_seconds");if(!B.success)return B;var C=d("WASmaxParseUtils").attrInt(e.value,"end_time_seconds");if(!C.success)return C;var D=d("WASmaxParseUtils").attrInt(e.value,"ttl_seconds");if(!D.success)return D;var E=d("WASmaxParseUtils").attrStringEnum(e.value,"dismissable",d("WASmaxInQpSurfacesEnums").ENUM_FALSE_TRUE);if(!E.success)return E;var F=d("WASmaxParseUtils").attrStringEnum(e.value,"force_pass",d("WASmaxInQpSurfacesEnums").ENUM_FALSE_TRUE);if(!F.success)return F;var G=d("WASmaxParseUtils").attrInt(e.value,"surface_delay_time_seconds");if(!G.success)return G;var H=d("WASmaxParseUtils").attrStringEnum(e.value,"deterministic",d("WASmaxInQpSurfacesEnums").ENUM_FALSE_TRUE);if(!H.success)return H;var I=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,e.value,"experiment_key");if(!I.success)return I;var J=d("WASmaxParseUtils").attrStringEnum(e.value,"exposure_holdout",d("WASmaxInQpSurfacesEnums").ENUM_FALSE_TRUE);if(!J.success)return J;var K=d("WASmaxParseUtils").attrInt(e.value,"max_impressions");if(!K.success)return K;var L=d("WASmaxParseUtils").attrInt(e.value,"impression_cooldown");if(!L.success)return L;var M=d("WASmaxParseUtils").attrInt(e.value,"eligibility_duration_ms");if(!M.success)return M;var N=d("WASmaxParseUtils").attrInt(e.value,"priority");if(!N.success)return N;e=d("WASmaxParseUtils").attrStringEnum(e.value,"log_eligibility_waterfall",d("WASmaxInQpSurfacesEnums").ENUM_FALSE_TRUE);if(!e.success)return e;f=d("WASmaxParseUtils").mapChildrenWithTag(f.value,"trigger",1,50,h);return!f.success?f:d("WAResultOrError").makeResult({id:z.value,instanceId:a.value,titleElementValue:b.value,textElementValue:c.value,qpConfigTemplateName:A.value,qpConfigStartTimeSeconds:B.value,qpConfigEndTimeSeconds:C.value,qpConfigTtlSeconds:D.value,qpConfigDismissable:E.value,qpConfigForcePass:F.value,qpConfigSurfaceDelayTimeSeconds:G.value,qpConfigDeterministic:H.value,qpConfigExperimentKey:I.value,qpConfigExposureHoldout:J.value,qpConfigMaxImpressions:K.value,qpConfigImpressionCooldown:L.value,qpConfigEligibilityDurationMs:M.value,qpConfigPriority:N.value,qpConfigLogEligibilityWaterfall:e.value,header:g.value,image:j.value,primaryAction:k.value,secondaryAction:p.value,colors:t.value,contentAttributes:u.value,qpConfigFilterRules:w.value,qpConfigInstanceLogData:x.value,qpConfigPacing:y.value,qpConfigTriggersTrigger:f.value})}function x(a){var b=d("WASmaxParseUtils").assertTag(a,"surface");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"id");if(!b.success)return b;a=d("WASmaxParseUtils").mapChildrenWithTag(a,"promotion",0,100,w);return!a.success?a:d("WAResultOrError").makeResult({id:b.value,promotion:a.value})}function a(a){var b=d("WASmaxParseUtils").assertTag(a,"surfaces");if(!b.success)return b;b=d("WASmaxParseUtils").mapChildrenWithTag(a,"surface",0,100,x);return!b.success?b:d("WAResultOrError").makeResult({surface:b.value})}g.parseQPSurfacesSurfacePromotionQpConfigTriggersTrigger=h;g.parseQPSurfacesSurfacePromotionHeader=i;g.parseQPSurfacesSurfacePromotionImageLight=j;g.parseQPSurfacesSurfacePromotionImageDark=k;g.parseQPSurfacesSurfacePromotionImage=l;g.parseQPSurfacesSurfacePromotionPrimaryAction=m;g.parseQPSurfacesSurfacePromotionSecondaryAction=n;g.parseQPSurfacesSurfacePromotionColors=o;g.parseQPSurfacesSurfacePromotionContentAttributesAttribute=p;g.parseQPSurfacesSurfacePromotionContentAttributes=q;g.parseQPSurfacesSurfacePromotionQpConfigFilterRules=r;g.parseQPSurfacesSurfacePromotionQpConfigInstanceLogData=s;g.parseQPSurfacesSurfacePromotionQpConfigPacingPromotionConfig=t;g.parseQPSurfacesSurfacePromotionQpConfigPacingUserInfo=u;g.parseQPSurfacesSurfacePromotionQpConfigPacing=v;g.parseQPSurfacesSurfacePromotion=w;g.parseQPSurfacesSurface=x;g.parseQPSurfacesMixin=a}),98);
__d("WASmaxInQpSurfacesServerNotificationMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"t",0,void 0);if(!b.success)return b;var c=d("WASmaxParseUtils").attrStanzaId(a,"id");if(!c.success)return c;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,a,"offline",0,1024);return!a.success?a:d("WAResultOrError").makeResult({t:b.value,id:c.value,offline:a.value})}g.parseServerNotificationMixin=a}),98);
__d("WASmaxInQpSurfacesQPNotificationRequest",["WAResultOrError","WASmaxInQpSurfacesQPSurfacesMixin","WASmaxInQpSurfacesServerNotificationMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"surfaces");if(!b.success)return b;var c=d("WASmaxParseJid").attrUserJid(a,"from");if(!c.success)return c;var e=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","psa");if(!e.success)return e;b=d("WASmaxInQpSurfacesQPSurfacesMixin").parseQPSurfacesMixin(b.value);if(!b.success)return b;a=d("WASmaxInQpSurfacesServerNotificationMixin").parseServerNotificationMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({from:c.value,type:e.value,surfacesQPSurfacesMixin:b.value},a.value))}g.parseQPNotificationRequest=a}),98);
__d("WASmaxOutQpSurfacesNotificationClientAckMixin",["WASmaxJsx","WASmaxMixins","WASmaxParseJid","WASmaxParseReference","WASmaxParseUtils","WASmaxParsingFailure","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseReference").attrFromReference(d("WASmaxParseUtils").attrStanzaId,a,["id"]);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(b.error);var c=d("WASmaxParseReference").attrFromReference(d("WASmaxParseJid").attrUserJid,a,["from"]);if(!c.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(c.error);a=d("WASmaxParseReference").attrFromReference(d("WASmaxParseUtils").attrString,a,["type"]);if(!a.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(a.error);b=d("WASmaxJsx").smax("ack",{id:d("WAWap").STANZA_ID(b.value),to:d("WAWap").USER_JID(c.value),"class":"notification",type:d("WAWap").CUSTOM_STRING(a.value)});return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeNotificationClientAckMixin=a}),98);
__d("WASmaxOutQpSurfacesQPNotificationResponseAck",["WASmaxJsx","WASmaxOutQpSurfacesNotificationClientAckMixin"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxOutQpSurfacesNotificationClientAckMixin").mergeNotificationClientAckMixin(d("WASmaxJsx").smax("ack",null),a);return a}g.makeQPNotificationResponseAck=a}),98);
__d("WASmaxQpSurfacesQPNotificationRPC",["WASmaxInQpSurfacesQPNotificationRequest","WASmaxOutQpSurfacesQPNotificationResponseAck","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInQpSurfacesQPNotificationRequest").parseQPNotificationRequest(a);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("QPNotification",{Request:b}));return{parsedRequest:b.value,makeQPNotificationResponseAck:function(){return d("WASmaxOutQpSurfacesQPNotificationResponseAck").makeQPNotificationResponseAck(a)}}}g.receiveQPNotificationRPC=a}),98);
__d("WAWebParseQPSurfacesNotification",["WALogger","WASmaxQpSurfacesQPNotificationRPC","WATimeUtils","WAWebProtobufsQuickPromotionSurfaces.pb","decodeProtobuf"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["loadQuickPromotions: Malformed filter rules node. Skipping the promotion"]);h=function(){return a};return a}function a(a){a=d("WASmaxQpSurfacesQPNotificationRPC").receiveQPNotificationRPC(a);var b=a.parsedRequest;a=a.makeQPNotificationResponseAck;var c=b.surfacesQPSurfacesMixin;b=b.t;c=c.surface;c=c.map(function(a){var b=a.promotion.reduce(function(a,b){var c=b.qpConfigFilterRules;if(c==null){b.qpConfigFilterRules;var e=babelHelpers.objectWithoutPropertiesLoose(b,["qpConfigFilterRules"]);a.push(e);return a}try{e=d("decodeProtobuf").decodeProtobuf(d("WAWebProtobufsQuickPromotionSurfaces.pb").QP$FilterClauseSpec,c.elementValue);b.qpConfigFilterRules;c=babelHelpers.objectWithoutPropertiesLoose(b,["qpConfigFilterRules"]);b=babelHelpers["extends"]({},c,{qpConfigFilterRules:e});a.push(b)}catch(a){d("WALogger").WARN(h())}return a},[]);return{id:a.id,promotions:b}});return{surfaces:c,ts:d("WATimeUtils").castToUnixTime(b),makeAck:a}}g.parseQPSurfacesNotification=a}),98);
__d("WAWebHandleQPSurfacesNotification",["WALogger","WAWebBizGatingUtils","WAWebCTWAConstants","WAWebJobUpdateQPSurfaces","WAWebParseQPSurfacesNotification","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleQPSurfacesNotification: skipping QP surface ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleQPSurfacesNotification: unknown QP surface ",""]);i=function(){return a};return a}function a(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=d("WAWebParseQPSurfacesNotification").parseQPSurfacesNotification(a);var b=a.surfaces,c=a.makeAck;a=a.ts;c=c();if(!d("WAWebBizGatingUtils").qpSDKProcessingEnabled())return c;var e;d("WAWebBizGatingUtils").qpGraphQLEnabled()?e=b.filter(function(a){var b=d("WAWebCTWAConstants").KNOWN_QP_SURFACES.get(a.id);if(b==null){d("WALogger").WARN(i(),a.id);return!1}b=!d("WAWebBizGatingUtils").qpSurfaceIdsUsingGraphQL().has(b);b||d("WALogger").WARN(h(),a.id);return b}):e=b;yield d("WAWebJobUpdateQPSurfaces").updateQPSurfacesFromNotification(e,a);return c});return j.apply(this,arguments)}g.handleQPSurfacesNotification=a}),98);
__d("WAWebMdRetryFromUnknownDeviceWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumDeviceType"],(function(a,b,c,d,e,f,g){a=d("WAWebWamCodegenUtils").defineEvents({MdRetryFromUnknownDevice:[2178,{offline:[2,d("WAWebWamCodegenUtils").TYPES.BOOLEAN],senderType:[1,d("WAWebWamEnumDeviceType").DEVICE_TYPE]},[1,1,1],"regular"]});g.MdRetryFromUnknownDeviceWamEvent=a}),98);
__d("WAWebWamEnumRetryRejectReason",[],(function(a,b,c,d,e,f){a=Object.freeze({OTHER:0,DOUBLE_CHECKMARK:1,IDENTITY_CHANGE:2,MESSAGE_NOT_EXIST:3});f.RETRY_REJECT_REASON=a}),66);
__d("WAWebE2eRetryRejectWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumDeviceType","WAWebWamEnumMessageType","WAWebWamEnumRetryRejectReason"],(function(a,b,c,d,e,f,g){a=d("WAWebWamCodegenUtils").defineEvents({E2eRetryReject:[3578,{messageType:[1,d("WAWebWamEnumMessageType").MESSAGE_TYPE],msgRetryCount:[2,d("WAWebWamCodegenUtils").TYPES.INTEGER],retryRejectReason:[3,d("WAWebWamEnumRetryRejectReason").RETRY_REJECT_REASON],retryRevoke:[4,d("WAWebWamCodegenUtils").TYPES.BOOLEAN],senderDeviceType:[5,d("WAWebWamEnumDeviceType").DEVICE_TYPE]},[1,1,1],"regular"]});g.E2eRetryRejectWamEvent=a}),98);
__d("WAWebProcessRetryKeyBundle",["WALogger","WAWebAddonRetryRequestUtils","WAWebApiMessageInfoStore","WAWebApiParticipantStore","WAWebChatCollection","WAWebDBMessageSerialization","WAWebE2eRetryRejectWamEvent","WAWebMsgKey","WAWebMsgModel","WAWebMsgType","WAWebSchemaMessage","WAWebSendMsgTypes","WAWebSendStatusGatingUtils","WAWebSignal","WAWebUserPrefsMeUser","WAWebUserPrefsStatus","WAWebWamEnumDeviceType","WAWebWamEnumRetryRejectReason","WAWebWamMsgUtils","WAWebWidFactory","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["updateLocalSession: delete local session due to same base key"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["updateLocalSession: delete session because reg does not match, saved: ",", received: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["updateLocalSession: retryCount: ",", offline: ",", has keyBundle: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["processKeyBundle: update local session with the retry key bundle"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["processKeyBundle: update local session with the retry key bundle"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["processKeyBundle: delete session because reg does not match, saved: ",", received: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["processKeyBundle: missing session for retry"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["processKeyBundle: skip due to missing key bundle"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["getMsgIfAuthorized: ",", "," retry eligibility ",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["getMsgIfAuthorized: msg missing rowId ","."]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["getMsgIfAuthorized: can not find msg ","."]);r=function(){return a};return a}function a(a,b,c,d,e){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g){var h=d("WAWebUserPrefsMeUser").getMaybeMeLidUser(),i=d("WAWebUserPrefsMeUser").getMeUser();h=e.isLid()&&h!=null?h:i;i=new(c("WAWebMsgKey"))({id:a,remote:b,fromMe:!0,participant:b.isUser()?void 0:h});var j;b=(yield d("WAWebAddonRetryRequestUtils").getSentAddonMsgRecord(i));if(b!=null)h=g==null?void 0:g.sentAddonRowId,j=b.selfMsgRow.rowId,b={type:d("WAWebSendMsgTypes").SendMessageRecordType.Addon,data:b.msgData};else{var k=(yield d("WAWebSchemaMessage").getMessageTable().get(String(i)));if(!k){d("WALogger").WARN(r(),i.toString());return null}h=g==null?void 0:g.rowId;j=k.type===d("WAWebMsgType").MSG_TYPE.REVOKED?k.protocolMessageRowId:k.rowId;g=new(d("WAWebMsgModel").Msg)(d("WAWebDBMessageSerialization").messageFromDbRow(k));b={type:d("WAWebSendMsgTypes").SendMessageRecordType.Message,data:g}}if(j==null){d("WALogger").WARN(q(),i.toString());return null}k=(yield d("WAWebApiMessageInfoStore").isRetryEligible(i,e,h,j));b.type===d("WAWebSendMsgTypes").SendMessageRecordType.Message&&(yield b.data.waitForPrep());d("WALogger").LOG(p(),a,String(e),k).tags("messaging");g=d("WAWebWamEnumRetryRejectReason").RETRY_REJECT_REASON.OTHER;i=!1;b.data.type===d("WAWebMsgType").MSG_TYPE.REVOKED&&(i=!0,b.data.type="protocol",b.data.subtype=b.data.subtype==="admin"?"admin_revoke":"sender_revoke");switch(k){case d("WAWebApiMessageInfoStore").RetryEligibilityResult.ELIGIBLE:return b;case d("WAWebApiMessageInfoStore").RetryEligibilityResult.INELIGIBLE_ALREADY_DELIVERED:g=d("WAWebWamEnumRetryRejectReason").RETRY_REJECT_REASON.DOUBLE_CHECKMARK;break;case d("WAWebApiMessageInfoStore").RetryEligibilityResult.INELIGIBLE_CHANGED_IDENTITY:g=d("WAWebWamEnumRetryRejectReason").RETRY_REJECT_REASON.IDENTITY_CHANGE;break;default:g=d("WAWebWamEnumRetryRejectReason").RETRY_REJECT_REASON.OTHER;break}new(d("WAWebE2eRetryRejectWamEvent").E2eRetryRejectWamEvent)({senderDeviceType:e.isCompanion()?d("WAWebWamEnumDeviceType").DEVICE_TYPE.COMPANION:d("WAWebWamEnumDeviceType").DEVICE_TYPE.PRIMARY,messageType:d("WAWebWamMsgUtils").getWamMessageType(b.data),msgRetryCount:f,retryRevoke:i,retryRejectReason:g}).commit();return null});return s.apply(this,arguments)}function t(a,b,c,d,e){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f){if(c==null||!a||!a.key){d("WALogger").LOG(o());return!1}if(f){if(e==null){d("WALogger").LOG(n());yield d("WAWebSignal").Session.deleteRemoteInfo(b);return!1}else if(e!==c){d("WALogger").LOG(m(),e,c);yield d("WAWebSignal").Session.deleteRemoteInfo(b);return!1}d("WALogger").LOG(l());yield d("WAWebSignal").Session.createSignalSession(babelHelpers["extends"]({wid:b,regId:c},a));return!0}d("WALogger").LOG(k());yield d("WAWebSignal").Session.createSignalSession(babelHelpers["extends"]({wid:b,regId:c},a));return!0});return u.apply(this,arguments)}function e(a,b){return v.apply(this,arguments)}function v(){v=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){var f=e.from,g=e.keyBundle,k=e.offline,l=e.originalMsgId,m=e.participant,n=e.regId;e=e.retryCount;m=m||f;d("WALogger").LOG(j(),e,k.toString(),(!!g).toString());if(a.isGroup()){f=b("WAWebChatCollection").ChatCollection.get(a);f&&(m&&d("WAWebApiParticipantStore").markForgetSenderKey(f.id,[m]))}d("WAWebSendStatusGatingUtils").isStatusPostingEnabled()&&a.isStatusV3()&&(m&&void c("WAWebUserPrefsStatus").markForgetStatusSenderKey([m]));f=(yield d("WAWebSignal").Session.getRemoteRegId(m));if(d("WAWebWidFactory").toUserWid(m).equals(d("WAWebUserPrefsMeUser").getMeUser())&&f!==n)throw c("err")("updateLocalSession: detect registration Id change remote: "+n+", local: "+String(f)+" for peer device");a=(yield t(g,m,n,f,k));a||f!=null&&f!==n&&(d("WALogger").LOG(i(),f,n),yield d("WAWebSignal").Session.deleteRemoteSession(m));g=2;if(e===g)return d("WAWebSignal").Session.saveSessionBaseKey(m,l);else if(e>g){k=(yield d("WAWebSignal").Session.hasSameBaseKey(m,l));if(k){d("WALogger").LOG(h());return d("WAWebSignal").Session.deleteRemoteSession(m)}}});return v.apply(this,arguments)}g.getMsgIfAuthorized=a;g.processKeyBundle=t;g.updateLocalSession=e}),98);
__d("WAWebRetryRequestParser",["WADeprecatedWapParser","WAWebJidToWid","WAWebUserPrefsMeUser"],(function(a,b,c,d,e,f,g){a=new(c("WADeprecatedWapParser"))("retryRequestParser",function(a){a.assertTag("receipt");a.assertAttr("type","retry");a.hasAttr("to")&&a.assertAttr("to",d("WAWebUserPrefsMeUser").assertGetMe().toJid());var b=d("WAWebJidToWid").jidWithTypeToWid(a.attrJidWithType("from")),c=a.hasAttr("participant")?d("WAWebJidToWid").deviceJidToDeviceWid(a.attrDeviceJid("participant")):null,e=a.hasAttr("recipient")?d("WAWebJidToWid").deviceJidToUserWid(a.attrDeviceJid("recipient")):null,f=a.child("retry"),g=a.maybeChild("keys"),h=null;if(g!=null){var i=g.child("skey"),j=g.child("key");h={identity:g.child("identity").contentBytes(32),deviceIdentity:(g=g.maybeChild("device-identity"))==null?void 0:g.contentBytes(),skey:{id:i.child("id").contentUint(3),pubkey:i.child("value").contentBytes(32),signature:i.child("signature").contentBytes(64)},key:{id:j.child("id").contentUint(3),pubkey:j.child("value").contentBytes(32)}}}return{stanzaId:a.attrString("id"),originalMsgId:f.attrString("id"),ts:a.attrTime("t"),retryCount:f.hasAttr("count")?f.attrInt("count"):0,regId:a.child("registration").contentUint(4),offline:a.hasAttr("offline"),from:b,participant:c,recipient:e,keyBundle:h}});b=a;g["default"]=b}),98);
__d("WAWebSendRetryMsgJob",["invariant","WADeprecatedSendIq","WALogger","WAWebBotMessageSecret","WAWebCommsAckParser","WAWebOutgoingMessage","WAWebSendMsgCreateDeviceStanza","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g,h){function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendRetry: sending "," to ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendRetry: id "," to ",", requester: ",", count: ",""]);j=function(){return a};return a}function a(a,b,c,d,e){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f){var g,k=e.data.id.id,l=b||a;g=e==null?void 0:(g=e.data)==null?void 0:g.messageSecret;g=g?new Uint8Array(yield d("WAWebBotMessageSecret").genBotMsgSecretFromMsgSecret(g)):null;d("WALogger").LOG(j(),k,a.toString(),l.toString(),f).tags("messaging");l=d("WAWebOutgoingMessage").createOutgoingMessageProtobuf(e);f={type:d("WAWebSendMsgCreateDeviceStanza").MsgType.Retry,retryCount:f};var m;a.isUser()?m=(yield d("WAWebSendMsgCreateDeviceStanza").createUserDeviceMsgStanza(a,c,e,l,f,g)):(b!=null||h(0,56263),m=(yield d("WAWebSendMsgCreateDeviceStanza").createGroupDeviceMsgStanza(a,b,e,l,f,g)));d("WALogger").LOG(i(),k,a.toString()).tags("messaging");e=b;l=a;(a==null?void 0:a.isBot())&&c!=null&&!(c==null?void 0:c.isBot())&&(e=a,c!=null||h(0,75958),l=c);return d("WADeprecatedSendIq").deprecatedSendStanzaAndWaitForAck(m,d("WAWebCommsAckParser").toCoreAckTemplate({id:k,"class":"message",from:l,participant:e}))});return k.apply(this,arguments)}g.sendRetry=a}),98);
__d("WAWebHandleRetryRequest",["Promise","WAJids","WALogger","WAWap","WAWebApiDeviceList","WAWebCommsWapMd","WAWebManageE2ESessionsJob","WAWebMdRetryFromUnknownDeviceWamEvent","WAWebMessageThread","WAWebPostMessageHighRetryCountMetric","WAWebProcessRetryKeyBundle","WAWebRetryRequestParser","WAWebSendMsgQueueMap","WAWebSendRetryMsgJob","WAWebSignalCommonUtils","WAWebSignalProtocolStore","WAWebUserPrefsMeUser","WAWebWamEnumDeviceType","WAWebWidFactory","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleRetryRequest error: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleRetryRequest: no device "," found for "," for incoming retry request ."]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleRetryRequest: no requester found for incoming retry request."]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleRetryRequest: no chat found for incoming retry request."]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleRetryRequest refusing retry attempt #",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["getActualChatId: from is a peer device, but without recipient"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleMessageRetryRequest error: ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleMessageRetryRequest "," retry not authorized"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received null stanzaID when handling message retry request"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["Parsing Error: ",""]);r=function(){return a};return a}function a(a){a=c("WAWebRetryRequestParser").parse(a);if(a.error){d("WALogger").ERROR(r(),a.error.toString());return(h||(h=b("Promise"))).reject(a.error)}var e=a.success,f=e.from,g=e.participant,i=e.recipient,j=e.retryCount;a=e.stanzaId;if(a==null){d("WALogger").WARN(q());return(h||(h=b("Promise"))).reject(c("err")("Received null stanzaID when handling message retry request"))}var k=d("WAWap").wap("ack",{id:d("WAWap").CUSTOM_STRING(a),to:d("WAWebCommsWapMd").JID(f),participant:g?d("WAWebCommsWapMd").DEVICE_JID(g):d("WAWap").DROP_ATTR,"class":"receipt",type:"retry"});a=v(f,i);return!a?(h||(h=b("Promise"))).resolve(k):d("WAWebMessageThread").handleMessage(String(a),!1,b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield t(e));if(a==null)return k;var b=a.originalMsgId,c=a.chat,h=a.requester;a=a.identity;try{b=(yield d("WAWebProcessRetryKeyBundle").getMsgIfAuthorized(b,c,h,j,a));if(!b){d("WALogger").WARN(p(),b==null?void 0:b.type);return k}yield d("WAWebSendRetryMsgJob").sendRetry(f,g,i,b,j)}catch(a){d("WALogger").WARN(o(),a)}return k}))}function e(a){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield t(a));return a!=null});return s.apply(this,arguments)}function t(a){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=a.originalMsgId,e=a.from,f=a.participant,g=a.recipient,h=a.retryCount,n=a.offline;if(h>=d("WAWebPostMessageHighRetryCountMetric").MAX_RETRY){d("WALogger").LOG(m(),h);return}var o=v(e,g);if(!o){d("WALogger").WARN(l());return}var p=o.isUser()?e:f;if(!p){d("WALogger").WARN(k());return}h=p.device||0;try{g=(yield d("WAWebApiDeviceList").hasDevice(p,h));if(!g){d("WALogger").WARN(j(),h,p.user);new(d("WAWebMdRetryFromUnknownDeviceWamEvent").MdRetryFromUnknownDeviceWamEvent)({offline:n,senderType:h===d("WAJids").DEFAULT_DEVICE_ID?d("WAWebWamEnumDeviceType").DEVICE_TYPE.PRIMARY:d("WAWebWamEnumDeviceType").DEVICE_TYPE.COMPANION}).commit();return}return yield d("WAWebSendMsgQueueMap").sendMsgQueueMap.enqueue(o.toString(),b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield d("WAWebProcessRetryKeyBundle").updateLocalSession(o,a);yield d("WAWebManageE2ESessionsJob").ensureE2ESessions([p]);var b=(yield d("WAWebSignalProtocolStore").getPersistSignalProtocolStore().getIdentityWithRowId(d("WAWebSignalCommonUtils").createSignalAddress(p).toString()));return{originalMsgId:c,chat:o,requester:p,identity:b}}))}catch(a){d("WALogger").WARN(i(),a)}});return u.apply(this,arguments)}function v(a,b){if(a.isBot()&&b!=null)return b;if(a.isUser()){if(d("WAWebWidFactory").toUserWid(a).equals(d("WAWebUserPrefsMeUser").getMeUser())){if(!b){d("WALogger").WARN(n());return null}return b}return d("WAWebWidFactory").toUserWid(a)}return a}g.handleMessageRetryRequest=a;g.handleVoipRetryRequest=e}),98);
__d("WAWebHandleServerNotification",["$InternalEnum","Promise","WADeprecatedWapParser","WALogger","WAWap","WAWebAbPropsSyncJob","WAWebCrashlog","WAWebUpdateServerPropsJob"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Parsing Error: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["error while parsing: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(['Unsupported notification with type "server",\n    blindly ack-ing it and doing nothing']);k=function(){return a};return a}var l=b("$InternalEnum")({LOG:"log",PROPS:"props",ABPROPS:"abprops"}),m=new(c("WADeprecatedWapParser"))("incomingServerNotificationParser",function(a){a.assertTag("notification");var b=a.attrString("id"),c=a.attrWapJid("from");if(a.hasChild(l.LOG))return{type:l.LOG,stanzaId:b,from:c};if(a.hasChild(l.PROPS))return{type:l.PROPS,stanzaId:b,from:c};return a.hasChild(l.ABPROPS)?{type:l.ABPROPS,stanzaId:b,from:c}:{type:null,stanzaId:b,from:c}});function n(a){var c=d("WAWap").wap("ack",{id:d("WAWap").CUSTOM_STRING(a.stanzaId),"class":"notification",type:"server",to:a.from});if(a.type==null){d("WALogger").WARN(k());return(h||(h=b("Promise"))).resolve(c)}switch(a.type){case l.LOG:void d("WAWebCrashlog").upload({reason:d("WAWebCrashlog").SERVER_REQUESTED,immediate:!0,isHighPri:!0});return(h||(h=b("Promise"))).resolve(c);case l.PROPS:return d("WAWebUpdateServerPropsJob").queryServerProps().then(function(){return c});case l.ABPROPS:return d("WAWebAbPropsSyncJob").syncABPropsTask(!1).then(function(){return c})}}function a(a){var c=m.parse(a);if(c.error){d("WALogger").DEV(j(),a.toString());d("WALogger").ERROR(i(),c.error.toString());return(h||(h=b("Promise"))).reject(c.error)}return n(c.success)}g.NotificationType=l;g.handleServerNotification=a}),98);
__d("WAWebClockSkewDifferenceTWamEvent",["WAWebWamCodegenUtils"],(function(a,b,c,d,e,f,g){a=d("WAWebWamCodegenUtils").defineEvents({ClockSkewDifferenceT:[3178,{clockSkewHourly:[1,d("WAWebWamCodegenUtils").TYPES.INTEGER]},[1,1e3,1e4],"private",37887164]});g.ClockSkewDifferenceTWamEvent=a}),98);
__d("WAWebUpdateClockSkewUtils",["WATimeUtils","WAWebABProps","WAWebBackendApi","WAWebClockSkewDifferenceTWamEvent"],(function(a,b,c,d,e,f,g){function a(a){var b=Date.now()/1e3;b=Math.round(b-a);a=Math.round(b/d("WATimeUtils").HOUR_SECONDS);a!==0&&d("WAWebABProps").getABPropConfigValue("log_clock_skew")&&new(d("WAWebClockSkewDifferenceTWamEvent").ClockSkewDifferenceTWamEvent)({clockSkewHourly:a*-1}).commit();d("WATimeUtils").setClockSkew(b);d("WAWebBackendApi").frontendFireAndForget("setWebClockSkew",{newClockSkew:b})}g.updateClockSkew=a}),98);
__d("WAWebUpdateMeLidUtils",["WANullthrows","WAWebUserPrefsMeUser"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WAWebUserPrefsMeUser").getMaybeMeLid(!1);if(b==null&&a==null)return;if(b==null&&a!=null){d("WAWebUserPrefsMeUser").setMeLid(a);return}if(b!=null&&a==null)return;if(c("WANullthrows")(b).equals(a))return;d("WAWebUserPrefsMeUser").setMeLid(c("WANullthrows")(a))}g.updateMeLid=a}),98);
__d("WAWebHandleSuccess",["Promise","WACustomError","WADeprecatedWapParser","WALogger","WAPromiseTimeout","WAWebABPropsLocalStorage","WAWebAbPropsSyncJob","WAWebCmd","WAWebCryptoEncKeyHelper","WAWebDbEncryptionKey","WAWebMediaHosts","WAWebPageLoadLogging","WAWebPassiveModeManager","WAWebUpdateClockSkewUtils","WAWebUpdateMeLidUtils","WAWebUpdateServerPropsJob","WAWebUserPrefsGeneral","WAWebUserPrefsMeUser","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["fetching mms4 hosts on startup failed: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["fetching mms4 hosts on startup exceeded timeout"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleSuccess: failed to parse ",""]);k=function(){return a};return a}var l=new(c("WADeprecatedWapParser"))("successParser",function(a){a.assertTag("success");return{ts:a.attrTime("t"),propsVersion:a.attrInt("props"),companionEncStatic:a.maybeAttrString("companion_enc_static")||"NULL",lid:a.maybeAttrString("lid"),displayName:a.maybeAttrString("display_name"),abpropsRefreshId:a.maybeAttrInt("abprops")}});function a(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WAWebPageLoadLogging").addPageLoadQplPoint("success_received");a=l.parse(a);if(a.error){d("WALogger").ERROR(k(),a.error);return(h||(h=b("Promise"))).reject(a.error)}a=a.success;d("WAWebUpdateClockSkewUtils").updateClockSkew(a.ts);d("WAWebUpdateMeLidUtils").updateMeLid(a.lid!=null?d("WAWebWidFactory").createWid(a.lid):null);a.displayName!=null&&d("WAWebUserPrefsMeUser").setMeDisplayName(a.displayName);d("WAWebCmd").Cmd.onTemporaryBan({banned:!1});d("WAWebPassiveModeManager").PassiveTaskManager.executePassiveTasks();void d("WAWebUserPrefsGeneral").setOfflinePushDisabled(!1);var c=a.companionEncStatic;void d("WAWebDbEncryptionKey").DbEncKeyStore.generateFinalDbEncryptionAndFtsKey(c);void d("WAWebCryptoEncKeyHelper").generateFinalDbEncryptionAndFtsKeyForInvoker(c);c=(yield d("WAWebUserPrefsGeneral").getServerPropsAttributes());((c=c==null?void 0:c.version)!=null?c:-1)<a.propsVersion&&(yield d("WAWebUpdateServerPropsJob").queryServerProps());a=(c=a.abpropsRefreshId)!=null?c:0;c=d("WAWebABPropsLocalStorage").getRefreshId();if(c<a){c=d("WAWebABPropsLocalStorage").isABPropsAfterFirstSync();c&&(yield d("WAWebAbPropsSyncJob").syncABPropsTask())}yield n(1e3)});return m.apply(this,arguments)}function n(a){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){try{yield d("WAPromiseTimeout").promiseTimeout(d("WAWebMediaHosts").mediaHosts.forceRefresh(new AbortController().signal),a)}catch(a){a instanceof d("WACustomError").TimeoutError?d("WALogger").LOG(j()).sendLogs("mms4-fetch-host-timeout",0):d("WALogger").ERROR(i(),a).sendLogs("mms4-fetch-host-failed")}});return o.apply(this,arguments)}g["default"]=a}),98);
__d("WASmaxInUsernameDisplayNameMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxParseUtils").attrString(a,"display_name");return!a.success?a:d("WAResultOrError").makeResult({displayName:a.value})}g.parseDisplayNameMixin=a}),98);
__d("WASmaxInUsernameChangeNotificationDeletedMixin",["WASmaxInUsernameDisplayNameMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"set");if(!b.success)return b;b=d("WASmaxInUsernameDisplayNameMixin").parseDisplayNameMixin(a);return!b.success?b:b}g.parseChangeNotificationDeletedMixin=a}),98);
__d("WASmaxInUsernameChangeNotificationSetHashMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"set");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"hash");return!b.success?b:d("WAResultOrError").makeResult({hash:b.value})}g.parseChangeNotificationSetHashMixin=a}),98);
__d("WASmaxInUsernameChangeNotificationSetMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"set");if(!b.success)return b;b=d("WASmaxParseUtils").contentString(a);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}g.parseChangeNotificationSetMixin=a}),98);
__d("WASmaxInUsernameChangeNotificationSetOrChangeNotificationSetHashOrChangeNotificationDeletedMixinGroup",["WAResultOrError","WASmaxInUsernameChangeNotificationDeletedMixin","WASmaxInUsernameChangeNotificationSetHashMixin","WASmaxInUsernameChangeNotificationSetMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInUsernameChangeNotificationSetMixin").parseChangeNotificationSetMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"ChangeNotificationSet",value:b.value});var c=d("WASmaxInUsernameChangeNotificationSetHashMixin").parseChangeNotificationSetHashMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"ChangeNotificationSetHash",value:c.value});var e=d("WASmaxInUsernameChangeNotificationDeletedMixin").parseChangeNotificationDeletedMixin(a);return e.success?d("WAResultOrError").makeResult({name:"ChangeNotificationDeleted",value:e.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["Set","SetHash","Deleted"],[b,c,e])}g.parseChangeNotificationSetOrChangeNotificationSetHashOrChangeNotificationDeletedMixinGroup=a}),98);
__d("WASmaxInUsernameServerNotificationMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"t",0,void 0);if(!b.success)return b;var c=d("WASmaxParseUtils").attrStanzaId(a,"id");if(!c.success)return c;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,a,"offline",0,1024);return!a.success?a:d("WAResultOrError").makeResult({t:b.value,id:c.value,offline:a.value})}g.parseServerNotificationMixin=a}),98);
__d("WASmaxInUsernameChangeNotificationRequest",["WAResultOrError","WASmaxInUsernameChangeNotificationSetOrChangeNotificationSetHashOrChangeNotificationDeletedMixinGroup","WASmaxInUsernameServerNotificationMixin","WASmaxParseJid","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"notification");if(!b.success)return b;b=d("WASmaxParseUtils").flattenedChildWithTag(a,"set");if(!b.success)return b;var c=d("WASmaxParseJid").attrUserJid(a,"from");if(!c.success)return c;var e=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","username");if(!e.success)return e;a=d("WASmaxInUsernameServerNotificationMixin").parseServerNotificationMixin(a);if(!a.success)return a;b=d("WASmaxInUsernameChangeNotificationSetOrChangeNotificationSetHashOrChangeNotificationDeletedMixinGroup").parseChangeNotificationSetOrChangeNotificationSetHashOrChangeNotificationDeletedMixinGroup(b.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({from:c.value,type:e.value},a.value,{setChangeNotificationSetOrChangeNotificationSetHashOrChangeNotificationDeletedMixinGroup:b.value}))}g.parseChangeNotificationRequest=a}),98);
__d("WASmaxOutUsernameNotificationClientAckMixin",["WASmaxJsx","WASmaxMixins","WASmaxParseJid","WASmaxParseReference","WASmaxParseUtils","WASmaxParsingFailure","WAWap"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseReference").attrFromReference(d("WASmaxParseUtils").attrStanzaId,a,["id"]);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(b.error);var c=d("WASmaxParseReference").attrFromReference(d("WASmaxParseJid").attrUserJid,a,["from"]);if(!c.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(c.error);a=d("WASmaxParseReference").attrFromReference(d("WASmaxParseUtils").attrString,a,["type"]);if(!a.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(a.error);b=d("WASmaxJsx").smax("ack",{id:d("WAWap").STANZA_ID(b.value),to:d("WAWap").USER_JID(c.value),"class":"notification",type:d("WAWap").CUSTOM_STRING(a.value)});return b}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeNotificationClientAckMixin=a}),98);
__d("WASmaxOutUsernameChangeNotificationResponseAck",["WASmaxJsx","WASmaxOutUsernameNotificationClientAckMixin"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxOutUsernameNotificationClientAckMixin").mergeNotificationClientAckMixin(d("WASmaxJsx").smax("ack",null),a);return a}g.makeChangeNotificationResponseAck=a}),98);
__d("WASmaxUsernameChangeNotificationRPC",["WASmaxInUsernameChangeNotificationRequest","WASmaxOutUsernameChangeNotificationResponseAck","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInUsernameChangeNotificationRequest").parseChangeNotificationRequest(a);if(!b.success)throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("ChangeNotification",{Request:b}));return{parsedRequest:b.value,makeChangeNotificationResponseAck:function(){return d("WASmaxOutUsernameChangeNotificationResponseAck").makeChangeNotificationResponseAck(a)}}}g.receiveChangeNotificationRPC=a}),98);
__d("WAWebHandleUsernameChangeNotification",["WALogger","WASmaxUsernameChangeNotificationRPC","WAWebChatCollection","WAWebContactSystemMsg","WAWebHandleSingleMsg","WAWebQueryExistsJob","WAWebSchemaContact","WAWebSetUsernameJob","WAWebUsernameGatingUtils","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["could not find side contact hash for username change notification."]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleUsernameChangeNotification: received username change notification for ",""]);i=function(){return a};return a}function a(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=d("WASmaxUsernameChangeNotificationRPC").receiveChangeNotificationRPC(a);var b=a.makeChangeNotificationResponseAck;a=a.parsedRequest;var c=a.setChangeNotificationSetOrChangeNotificationSetHashOrChangeNotificationDeletedMixinGroup.value,e,f=c==null?void 0:c.hash,g;d("WALogger").LOG(i(),e);if(!d("WAWebUsernameGatingUtils").usernameDisplayedEnabled())return b();if(f!=null){f=(yield k(f));f!=null&&(g=f==null?void 0:f.newUsername,e=f.wid)}else e=d("WAWebWidFactory").createUserWid(a.from),g=c==null?void 0:c.elementValue,yield d("WAWebSetUsernameJob").setUsernamesJob([{userId:e,username:g}]);if(e!=null){f=d("WAWebChatCollection").ChatCollection.get(e);if(f!=null){a=d("WAWebContactSystemMsg").genUsernameChangeSystemMsg(e,g);yield d("WAWebHandleSingleMsg").handleSingleMsg(e,a,"username_change_notification")}}return b()});return j.apply(this,arguments)}function k(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("WAWebSchemaContact").getContactTable().equals(["contactHash"],a));if(a.length===0){d("WALogger").WARN(h());return}a=d("WAWebWidFactory").createUserWid((a=a[0])==null?void 0:a.id);var b=(yield d("WAWebQueryExistsJob").queryWidUsernameExists(a));return{newUsername:b==null?void 0:b.username,wid:a}});return l.apply(this,arguments)}g.handleUsernameChangeNotification=a}),98);
__d("WAWebIncomingOfferNoticeVoipHandlerAction",["WALogger","WATimeUtils","WAWebCallCollection","WAWebCmd","WAWebWidFactory"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["voip:handleIncomingCallOfferNotice: Ignoring stale offer_notice"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["voip:handleIncomingCallOfferNotice: callId ",""]);i=function(){return a};return a}var j=45;function a(a,b,e,f,g){d("WALogger").LOG(i(),b);if(d("WATimeUtils").unixTime()-e>j){d("WALogger").LOG(h());return}c("WAWebCallCollection").add({id:b,isVideo:f,isGroup:g,offerTime:e,canHandleLocally:!1,peerJid:a,isSilenced:!1},{merge:!0});d("WAWebCmd").Cmd.alertCall(d("WAWebWidFactory").toUserWid(a),b,f,g,!1,!1);self.setTimeout(function(){d("WAWebCmd").Cmd.cancelCall(a);var e=c("WAWebCallCollection").get(b);e&&c("WAWebCallCollection").remove(e)},j*1e3)}g["default"]=a}),98);
__d("WAWebHandleVoipOfferNotice",["Promise","WADeprecatedWapParser","WALogger","WAWap","WAWebCommsWapMd","WAWebIncomingOfferNoticeVoipHandlerAction","WAWebJidToWid"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Parsing Error: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["error while parsing: ",""]);j=function(){return a};return a}var k=new(c("WADeprecatedWapParser"))("callOfferNoticeParser",function(a){a.assertTag("call");var b=a.attrString("id"),c=d("WAWebJidToWid").jidWithTypeToWid(a.attrJidWithType("from")),e=a.child("offer_notice"),f=d("WAWebJidToWid").deviceJidToDeviceWid(e.attrDeviceJid("call-creator")),g=e.attrString("call-id"),h=e.attrString("type");e=e.attrString("media");a=a.attrTime("t");return{stanzaId:b,fromWid:c,callCreator:f,callId:g,isGroup:h==="group",isVideo:e==="video",t:a}});function a(a){var e=k.parse(a);if(e.error){d("WALogger").DEV(j(),a.toString());d("WALogger").ERROR(i(),e.error.toString());return(h||(h=b("Promise"))).resolve("NO_ACK")}a=e.success;e=a.stanzaId;var f=a.fromWid,g=a.callCreator,l=a.callId,m=a.isGroup,n=a.isVideo;a=a.t;c("WAWebIncomingOfferNoticeVoipHandlerAction")(g,l,a,n,m);return(h||(h=b("Promise"))).resolve(d("WAWap").wap("ack",{to:d("WAWebCommsWapMd").JID(f),id:d("WAWap").CUSTOM_STRING(e),"class":"call",type:d("WAWap").CUSTOM_STRING("offer_notice")}))}g["default"]=a}),98);
__d("WAWebVoipValidateAndDecryptEncJob",["invariant","WACryptoPkcs7","WAFilteredCatch","WAJids","WALogger","WANullthrows","WAWebAdvSignatureApi","WAWebBackendJobs.flow","WAWebHandleMsgTypes.flow","WAWebProtobufsE2E.pb","WAWebSignal","WAWebSignalCommonErrors","asyncToGeneratorRuntime","decodeProtobuf"],(function(a,b,c,d,e,f,g,h){function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["voip:validateAndDecryptEnc error"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["voip:validateAndDecryptEnc: successfully validated ADV device-identity"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["voip:validateAndDecryptEnc: expected device-identity with pkmsg enc"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["voip:decryptSignalProto failed with unexpected error; ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["voip:decryptSignalProto failed with decryption error; ",""]);m=function(){return a};return a}function a(a,b){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e,f=b.payload[2]&&b.payload[2].find(function(a){return a[0]==="enc"});a=a.peer_jid;if(!f||!a)return{result:d("WAWebHandleMsgTypes.flow").E2EProcessResult.SUCCESS};var g=0;((e=f[1])==null?void 0:e.count)&&(g=parseInt(f[1].count,10)||0);e={e2eType:f[1].type,ciphertext:new Uint8Array(f[2]),retryCount:g,encMediaType:null,hideFail:!1};try{b=b.payload[2].find(function(a){return a[0]==="device-identity"});if(a.device!=null&&a.device!==d("WAJids").DEFAULT_DEVICE_ID&&e.e2eType===d("WAWebBackendJobs.flow").CiphertextType.Pkmsg&&!b){d("WALogger").LOG(k());return{result:d("WAWebHandleMsgTypes.flow").E2EProcessResult.PARSE_ERROR}}if(b){b=new Uint8Array(b[2]);b=(yield d("WAWebAdvSignatureApi").validateADVwithEncs(a,b,[e]));if(!b)return{result:d("WAWebHandleMsgTypes.flow").E2EProcessResult.PARSE_ERROR};d("WALogger").LOG(j())}b=(yield o(e,a));e=b.result;a=b.decrypted;e===d("WAWebHandleMsgTypes.flow").E2EProcessResult.SUCCESS&&(f[2]=Array.prototype.slice.call(new Uint8Array(c("WANullthrows")(a))));return{result:e,retryCount:g}}catch(a){d("WALogger").WARN(i()).devConsole(a);return{result:d("WAWebHandleMsgTypes.flow").E2EProcessResult.PARSE_ERROR}}});return n.apply(this,arguments)}function o(a,b){a.e2eType!==d("WAWebBackendJobs.flow").CiphertextType.Skmsg||h(0,56543);return d("WAWebSignal").Cipher.decryptSignalProto(b,a.e2eType,a.ciphertext).then(function(a){var b;a=d("WACryptoPkcs7").unpadPkcs7(new Uint8Array(a));a=d("decodeProtobuf").decodeProtobuf(d("WAWebProtobufsE2E.pb").MessageSpec,a);return((b=a.call)==null?void 0:b.callKey)?{result:d("WAWebHandleMsgTypes.flow").E2EProcessResult.SUCCESS,decrypted:a.call.callKey}:{result:d("WAWebHandleMsgTypes.flow").E2EProcessResult.PARSE_ERROR}})["catch"](d("WAFilteredCatch").filteredCatch(d("WAWebSignalCommonErrors").SignalDecryptionError,function(a){d("WALogger").WARN(m(),a);return{result:d("WAWebHandleMsgTypes.flow").E2EProcessResult.RETRY}}))["catch"](function(a){d("WALogger").WARN(l(),a);return{result:d("WAWebHandleMsgTypes.flow").E2EProcessResult.PARSE_ERROR}})}g["default"]=a}),98);
__d("WAWebIncomingVoipHandlerAction",["Promise","WALogger","WAResolvable","WAWebCallCollection","WAWebHandleMsgTypes.flow","WAWebSignalStoreApi","WAWebVoip","WAWebVoipGkUtils","WAWebVoipSignalingEnums","WAWebVoipValidateAndDecryptEncJob","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["voip:rejectCallWithReasonEnc max retry reached, uploading fieldstats"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["voip:handleIncomingCallOffer ending call because of enc parse error"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["voip:handleIncomingCallOffer reject call because of enc retry"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["voip:incoming: Ignoring call offer since group calling is disabled"]);l=function(){return a};return a}function m(a,b,d){var e=a.call_id;c("WAWebCallCollection").processIncomingCall(e,a.peer_jid,{isVideo:a.isVideoCall,canHandleLocally:d!=null?d:!1,offerTime:a.t});d===!1&&c("WAWebCallCollection").cleanupPendingOffer(e);c("WAWebVoip").Voip.handleIncomingSignalingMessage(a,b)}function n(a,b){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e;b===void 0&&(b=0);var f=(yield d("WAWebSignalStoreApi").waSignalStore.getRegistrationInfo());if(!f)throw c("err")("No registration info found");f=f.registrationId;b=b+1;c("WAWebVoip").Voip.rejectCallWithoutCallCtx(a.call_id,(e=a.peer_jid)==null?void 0:e.toString({legacy:!0}),(e=a.call_creator)==null?void 0:e.toString({legacy:!0}),d("WAWebVoipSignalingEnums").ENC_RETRY_RECEIPT_ATTRS.SINGLE_PARTICIPANT,b,f);e=5;b===e&&(d("WALogger").LOG(i()),c("WAWebVoip").Voip.processMissedIncomingCallMaxRetry(a))});return o.apply(this,arguments)}function p(a){return a?c("WAWebVoipGkUtils").isVideoCallEnabled():c("WAWebVoipGkUtils").isVoiceCallEnabled()}function a(a,e){c("WAWebCallCollection").processIncomingCall(a.call_id,a.peer_jid,{isVideo:a.isVideoCall,canHandleLocally:a.isVideoCall?c("WAWebVoipGkUtils").isVideoCallEnabled():c("WAWebVoipGkUtils").isVoiceCallEnabled(),offerTime:a.t,isSilenced:a.isSilenced,offerReceivedWhileOffline:a.is_offline,groupWid:a.group_jid});if(!p(a.isVideoCall)){c("WAWebVoip").Voip.handleIncomingSignalingMessage(a,e);return}var f=a.call_id;c("WAWebCallCollection").pendingOffers[f]=new(d("WAResolvable").Resolvable)();c("WAWebCallCollection").pendingOffers[f].resolve((h||(h=b("Promise"))).all([c("WAWebVoipValidateAndDecryptEncJob")(a,e),c("WAWebVoip").Voip.getNumParticipantsFromCallOffer(e)]).then(function(b){var g=b[0],h=g.result;g=g.retryCount;b=b[1];var i=!0;b>0&&(d("WALogger").ERROR(l()),i=!1);a.isVideoCall?i=i&&c("WAWebVoipGkUtils").isVideoCallEnabled():i=i&&c("WAWebVoipGkUtils").isVoiceCallEnabled();switch(h){case d("WAWebHandleMsgTypes.flow").E2EProcessResult.SUCCESS:m(a,e,i);break;case d("WAWebHandleMsgTypes.flow").E2EProcessResult.RETRY:d("WALogger").LOG(k());n(a,g);break;case d("WAWebHandleMsgTypes.flow").E2EProcessResult.PARSE_ERROR:d("WALogger").LOG(j());c("WAWebVoip").Voip.endCall(f);break;default:throw c("err")("invalid e2e result type")}})["finally"](function(){delete c("WAWebCallCollection").pendingOffers[f]}))}function e(a,b){c("WAWebVoip").Voip.handleIncomingSignalingMessage(a,b)}function f(a,d){return(h||(h=b("Promise"))).reject(c("err")("incoming enc rekey is not expected in web"))}g.handleIncomingCallOffer=a;g.handleIncomingSignalingMsg=e;g.handleIncomingEncRekey=f}),98);
__d("WAWebNotificationState",["$InternalEnum","WALogger","gkx"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["getDoNotDisturb failed with error ",""]);h=function(){return a};return a}var i=b("$InternalEnum").Mirrored(["UNKNOWN","SESSION_SCREEN_IS_LOCKED","SESSION_ON_CONSOLE_KEY","QUNS_NOT_PRESENT","QUNS_BUSY","QUNS_RUNNING_D3D_FULL_SCREEN","QUNS_PRESENTATION_MODE","QUNS_ACCEPTS_NOTIFICATIONS","QUNS_QUIET_TIME","QUNS_APP","UNKNOWN_ERROR"]),j=b("$InternalEnum").Mirrored(["NOT_SUPPORTED","FAILED","OFF","PRIORITY_ONLY","ALARMS_ONLY"]);function a(){try{if(c("gkx")("26254"))return!1;if(process.platform==="darwin"){var a;return((a=window.Native.MacOSNotificationState)==null?void 0:a.getDoNotDisturb())||((a=window.Native.MacOSNotificationState)==null?void 0:a.getNotificationState())===i.SESSION_SCREEN_IS_LOCKED}if(process.platform==="win32"){var b;if(((a=window.Native.WindowsNotificationState)==null?void 0:a.getNotificationState())!==i.QUNS_ACCEPTS_NOTIFICATIONS)return!0;a=k();a=a&&((b=window.Native.WindowsFocusAssist)==null?void 0:(b=b.isPriority(a))==null?void 0:b.name)==="YES";b=(b=window.Native.WindowsFocusAssist)==null?void 0:b.getFocusAssist().name;return a&&b===j.ALARMS_ONLY||!a&&[j.PRIORITY_ONLY,j.ALARMS_ONLY].includes(b)?!0:!!((a=window.Native.WindowsQuiteHours)==null?void 0:a.getIsQuietHours())}}catch(a){d("WALogger").WARN(h(),a)}return!1}function k(){if(c("gkx")("26254"))return null;if(process.platform!=="win32")return null;return process.windowsStore?null:"com.squirrel.WhatsApp.WhatsApp"}g.getDoNotDisturb=a}),98);
__d("WAWebVoipMainWindowStateModel",["WAWebBaseModel","gkx"],(function(a,b,c,d,e,f,g){a=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,c;for(var e=arguments.length,f=new Array(e),g=0;g<e;g++)f[g]=arguments[g];return(b=c=a.call.apply(a,[this].concat(f))||this,c.isFocused=d("WAWebBaseModel").session(!0),b)||babelHelpers.assertThisInitialized(c)}var e=b.prototype;e.initialize=function(){a.prototype.initialize.call(this);this.$MainWindowState1=this.$MainWindowState1.bind(this);this.$MainWindowState2=this.$MainWindowState2.bind(this);if(c("gkx")("26255")){var b;(b=window.Native)==null?void 0:b.addListener("BrowserWindow:focus",this.$MainWindowState1);(b=window.Native)==null?void 0:b.addListener("BrowserWindow:blur",this.$MainWindowState2)}};e["delete"]=function(){if(c("gkx")("26255")){var b;(b=window.Native)==null?void 0:b.removeListener("BrowserWindow:focus",this.$MainWindowState1);(b=window.Native)==null?void 0:b.removeListener("BrowserWindow:blur",this.$MainWindowState2)}a.prototype["delete"].call(this)};e.$MainWindowState1=function(){this.isFocused=!0};e.$MainWindowState2=function(){this.isFocused=!1};return b}(d("WAWebBaseModel").BaseModel);a.Proxy="mainWindowState";b=d("WAWebBaseModel").defineModel(a);e=new b();g["default"]=e}),98);
__d("WAWebVoipSendGroupCallRekeyRetryReceiptJob",["WADeprecatedSendIq","WAWap","WAWebCommsWapMd","WAWebSignalStoreApi","WAWebVoipSignalingEnums","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){function a(a,b,c){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){e===void 0&&(e=0);var f=(yield d("WAWebSignalStoreApi").waSignalStore.getRegistrationInfo());if(!f)throw c("err")("No registration info found");a=d("WAWap").wap("receipt",{to:d("WAWebCommsWapMd").DEVICE_JID(b.peer_jid),id:d("WAWap").CUSTOM_STRING(a),type:d("WAWap").CUSTOM_STRING(d("WAWebVoipSignalingEnums").ENC_RETRY_RECEIPT_ATTRS.GROUP_CALL)},d("WAWap").wap("enc_rekey",{"call-creator":d("WAWebCommsWapMd").DEVICE_JID(b.call_creator),"call-id":d("WAWap").CUSTOM_STRING(b.call_id),count:d("WAWap").INT(e+1)}),d("WAWap").wap("registration",null,d("WAWap").BIG_ENDIAN_CONTENT(f.registrationId)));d("WADeprecatedSendIq").deprecatedCastStanza(a)});return h.apply(this,arguments)}g["default"]=a}),98);
__d("WAWebHandleVoipCall",["Promise","WADeprecatedSendIq","WADeprecatedWapParser","WALogger","WAWap","WAWebCommsWapMd","WAWebConstantsDeprecated","WAWebHandleVoipOfferNotice","WAWebIncomingVoipHandlerAction","WAWebJidToWid","WAWebNotificationState","WAWebUpdateLidMetadataJob","WAWebUserPrefsMeUser","WAWebVoipMainWindowStateModel","WAWebVoipSendGroupCallRekeyRetryReceiptJob","WAWebVoipSignalingEnums","WAWebWidFactory","asyncToGeneratorRuntime","cr:4266","err"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleCall: ignoring incoming call offer because one of audio devices not detected"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleCall: ignoring incoming call offer because do not disturb mode is enabled or screen is locked"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Parsing Error: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["error while parsing: ",""]);l=function(){return a};return a}function m(a){return d("WAWebVoipSignalingEnums").TYPE[a.tag().toUpperCase()]||d("WAWebVoipSignalingEnums").TYPE.NONE}var n=new(c("WADeprecatedWapParser"))("callParser",function(a){a.assertTag("call");var b=d("WAWebJidToWid").jidWithTypeToWid(a.attrJidWithType("from")),e=a.mapFirstChild(function(a){return a});if(e){var f=e.attrString("call-id"),g=d("WAWebJidToWid").jidWithTypeToWid(e.attrJidWithType("call-creator")),h=e.hasAttr("group-jid")?d("WAWebJidToWid").jidWithTypeToWid(e.attrJidWithType("group-jid")):null,i=e.hasAttr("caller_pn")?d("WAWebJidToWid").jidWithTypeToWid(e.attrJidWithType("caller_pn")):null;i={call_id:f,call_creator:g,caller_pn:i,peer_jid:b,peer_platform:a.hasAttr("platform")?a.attrString("platform"):void 0,peer_app_version:a.hasAttr("version")?a.attrString("version"):void 0,epoch_msec:a.hasAttr("t")?String(a.attrInt("t")*1e3):void 0,elapsed_msec:a.hasAttr("e")?String(a.attrInt("e")*1e3):void 0,is_offline:a.hasAttr("offline"),type:m(e),common:{call_id:f,peer_jid:b.toString(),type:String(m(e))},group_jid:h,isVideoCall:e.hasChild("video"),isSilenced:e.hasChild("silence"),t:a.attrTime("t")};return{from:d("WAWebJidToWid").jidWithTypeToWid(a.attrJidWithType("from")),stanzaId:a.attrString("id"),payloadTag:e.tag(),message:i,callCreator:g}}throw c("err")("Unrecognized call stanza")});function a(a){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=n.parse(a);if(e.error){d("WALogger").DEV(l(),a.toString());d("WALogger").ERROR(k(),e.error.toString());return(h||(h=b("Promise"))).resolve("NO_ACK")}e=e.success;var f=e.callCreator,g=e.from,m=e.message,o=e.payloadTag,r=e.stanzaId;e=d("WAWebCommsWapMd").wapNodeToVoipXml(a);e={elapsed_msec:m.elapsed_msec,epoch_msec:m.epoch_msec,is_offline:m.is_offline,payload:e[2][0],peer_app_version:m.peer_app_version,peer_platform:m.peer_platform,peer_jid:m.peer_jid?m.peer_jid.toString({legacy:!0}):void 0};var s=m.caller_pn;f.isLid()&&s!=null&&(yield d("WAWebUpdateLidMetadataJob").createLidPnMappingsJob([{lid:d("WAWebWidFactory").toUserWid(f),pn:d("WAWebWidFactory").toUserWid(s)}],!Boolean(e.is_offline)));var t=m.call_id;switch(m.type){case d("WAWebVoipSignalingEnums").TYPE.OFFER:p(g,r,t,f,m.type);d("WAWebNotificationState").getDoNotDisturb()&&!c("WAWebVoipMainWindowStateModel").isFocused?d("WALogger").LOG(j()).color(c("WAWebConstantsDeprecated").VOIP_LOG_COLOR):b("cr:4266")!=null&&(b("cr:4266").isMicrophoneAvailable!==!0||b("cr:4266").isSpeakerAvailable!==!0)?d("WALogger").LOG(i()).color(c("WAWebConstantsDeprecated").VOIP_LOG_COLOR):d("WAWebIncomingVoipHandlerAction").handleIncomingCallOffer(m,e);return(h||(h=b("Promise"))).resolve("NO_ACK");case d("WAWebVoipSignalingEnums").TYPE.ENC_REKEY:d("WAWebIncomingVoipHandlerAction").handleIncomingEncRekey(m,e).then(function(a){var b=a.shouldRetry;a=a.retryCount;b?c("WAWebVoipSendGroupCallRekeyRetryReceiptJob")(r,m,a):p(g,r,t,f,d("WAWebVoipSignalingEnums").TYPE.ENC_REKEY)});return(h||(h=b("Promise"))).resolve("NO_ACK");case d("WAWebVoipSignalingEnums").TYPE.ACCEPT:case d("WAWebVoipSignalingEnums").TYPE.REJECT:p(g,r,t,f,m.type);d("WAWebIncomingVoipHandlerAction").handleIncomingSignalingMsg(m,e);return(h||(h=b("Promise"))).resolve("NO_ACK");case d("WAWebVoipSignalingEnums").TYPE.OFFER_NOTICE:return c("WAWebHandleVoipOfferNotice")(a);default:d("WAWebIncomingVoipHandlerAction").handleIncomingSignalingMsg(m,e);return(h||(h=b("Promise"))).resolve(q(g,r,o))}});return o.apply(this,arguments)}function p(a,b,c,e,f){var g;switch(f){case d("WAWebVoipSignalingEnums").TYPE.OFFER:g=d("WAWap").wap("offer",{"call-id":d("WAWap").CUSTOM_STRING(c),"call-creator":d("WAWebCommsWapMd").JID(e)});break;case d("WAWebVoipSignalingEnums").TYPE.ENC_REKEY:g=d("WAWap").wap("enc_rekey",{"call-id":d("WAWap").CUSTOM_STRING(c),"call-creator":d("WAWebCommsWapMd").JID(e)});break;case d("WAWebVoipSignalingEnums").TYPE.ACCEPT:g=d("WAWap").wap("accept",{"call-id":d("WAWap").CUSTOM_STRING(c),"call-creator":d("WAWebCommsWapMd").JID(e)});break;case d("WAWebVoipSignalingEnums").TYPE.REJECT:g=d("WAWap").wap("reject",{"call-id":d("WAWap").CUSTOM_STRING(c),"call-creator":d("WAWebCommsWapMd").JID(e)});break}d("WADeprecatedSendIq").deprecatedCastStanza(d("WAWap").wap("receipt",{to:d("WAWebCommsWapMd").JID(a),id:d("WAWap").CUSTOM_STRING(b),from:a.isLid()?d("WAWebCommsWapMd").JID(d("WAWebUserPrefsMeUser").getMaybeMeLidUser()):d("WAWebCommsWapMd").JID(d("WAWebUserPrefsMeUser").getMaybeMeUser())},g))}function q(a,b,c){return d("WAWap").wap("ack",{to:d("WAWebCommsWapMd").JID(a),id:d("WAWap").CUSTOM_STRING(b),"class":"call",type:d("WAWap").MAYBE_CUSTOM_STRING(c)})}g.handleCall=a}),98);
__d("WAWebHandleVoipEncRekeyRetryRequest",["WADeprecatedWapParser","WALogger","WANullthrows","WAWap","WAWebCommsWapMd","WAWebHandleRetryRequest","WAWebJidToWid","WAWebVoip","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["voip:handle_enc_rekey_retry_receipt: error while attempting to send enc_rekey retry"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["voip:handle_enc_rekey_retry_receipt: not sending enc_rekey retry"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Parsing Error: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["error while parsing: ",""]);k=function(){return a};return a}var l=new(c("WADeprecatedWapParser"))("rekeyRetryReceiptParser",function(a){a.assertTag("receipt");a.assertAttr("type","enc_rekey_retry");var b=a.child("enc_rekey");return{from:d("WAWebJidToWid").jidWithTypeToWid(a.attrJidWithType("from")),originalMsgId:b.attrString("call-id"),stanzaId:a.attrString("id"),retryCount:b.hasAttr("count")?b.attrInt("count"):0,regId:a.child("registration").contentUint(4),ts:null,participant:null,recipient:null,keyBundle:null,offline:!1}});function a(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=l.parse(a);if(b.error){d("WALogger").DEV(k(),a.toString());d("WALogger").ERROR(j(),b.error.toString());throw b.error}a=b.success;b=d("WAWap").wap("ack",{id:d("WAWap").CUSTOM_STRING(c("WANullthrows")(a.stanzaId)),to:d("WAWebCommsWapMd").JID(a.from),"class":"receipt",type:"enc_rekey_retry"});try{var e=(yield d("WAWebHandleRetryRequest").handleVoipRetryRequest(a));e?c("WAWebVoip").Voip.resendEncRekeyRetry(a.from.toString({legacy:!0,formatFull:!0}),a.retryCount):(d("WALogger").WARN(i()),c("WAWebVoip").Voip.endCall(a.originalMsgId));return b}catch(a){d("WALogger").WARN(h());return b}});return m.apply(this,arguments)}g["default"]=a}),98);
__d("WAWebHandleWaChat",["Promise","WAByteArray","WADeprecatedWapParser","WAJids","WALogger","WAWap","WAWebBackendJobs.flow","WAWebCommsWapMd","WAWebDBMessageDelete","WAWebHandleMsgProcess","WAWebHandleMsgTypes.flow","WAWebMsgCollection","WAWebMsgKey","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Parsing Error: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["error while parsing: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["WA Chat notification received, node: ",""]);k=function(){return a};return a}var l=new(c("WADeprecatedWapParser"))("incomingWAChatNotificationParser",function(a){a.assertTag("notification");a.assertAttr("from",d("WAJids").PSA_JID);var b=a.attrString("id"),e=a.attrTime("t");if(a.hasChild("messages")){var f=a.child("messages"),g=f.attrString("campaign_id");f=f.mapChildrenWithTag("message",function(a){var b=a.attrString("id");if(a.hasAttr("type")){var c=a.attrString("type");c=c==="text"?a:a.child("media")}else c=a;a={id:b,body:d("WAByteArray").uint8ArrayToBuffer(c.contentBytes())};return a});return{type:"messages",stanzaId:b,ts:e,campaignId:g,messages:f}}g=a.child("revoke");g.attrString("campaign_id");f=g.mapChildrenWithTag("message",function(a){a=new(c("WAWebMsgKey"))({fromMe:!1,remote:d("WAWebWidFactory").createWid(d("WAJids").PSA_JID),id:a.attrString("id")});return a.toString()});return{type:"revoke",stanzaId:b,ts:e,revokeMessageIds:f}});function m(a,b){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=a.campaignId;a=a.ts;var e=b.id;b=b.body;var f=d("WAWebWidFactory").createWid(d("WAJids").PSA_JID);e={type:d("WAWebHandleMsgTypes.flow").MESSAGE_TYPE.OTHER_STATUS,externalId:e,ts:a,edit:-1,isHsm:!1,count:null,chat:f,author:f,pushname:null,isDirect:!1,campaignId:c};a={retryCount:0,e2eType:d("WAWebBackendJobs.flow").CiphertextType.Msg,encMediaType:d("WAWebBackendJobs.flow").EncMediaType.Image,hideFail:!1};f={nativeFlowName:null,verifiedNameSerial:null,verifiedLevel:null,verifiedNameCert:null,privacyMode:null,campaignId:null};yield d("WAWebHandleMsgProcess").processDecryptedMessageProto({decrypted:b,info:e,e2eInfo:a,bizInfo:f,hsmInfo:null,isPadded:!1})});return n.apply(this,arguments)}function a(a){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WALogger").DEV(k(),a);var c=l.parse(a);if(c.error){d("WALogger").LOG(j(),a.toString());d("WALogger").ERROR(i(),c.error.toString());throw c.error}var e=c.success;a=d("WAWap").wap("ack",{id:d("WAWap").CUSTOM_STRING(e.stanzaId),"class":"notification",type:"psa",to:d("WAWebCommsWapMd").JID(d("WAWebWidFactory").createWid(d("WAJids").PSA_JID))});switch(e.type){case"revoke":c=e.revokeMessageIds;c.length>0&&(yield d("WAWebDBMessageDelete").removeMessagesFromHistory(c),c.forEach(function(a){a=d("WAWebMsgCollection").MsgCollection.get(a);a&&a["delete"]()}));break;default:e.type;yield (h||(h=b("Promise"))).all(e.messages.map(function(a){return m(e,a)}));break}return a});return o.apply(this,arguments)}g["default"]=a}),98);
__d("WAWebPaymentNotificationHandler",["WALogger","WANullthrows","WAWap","WAWebCommonMsgSubtypeTypes","WAWebDBMsgUtils","WAWebHandleSingleMsg","WAWebMessageStore","WAWebMessagingGatingUtils","WAWebMsgCollection","WAWebMsgKey","WAWebMsgModel","WAWebMsgType","WAWebPaymentNotificationParser","WAWebPaymentStatusUtils","WAWebSchemaOrphanPaymentNotification","WAWebStateUtils","WAWebUserPrefsMeUser","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["getOrphanPaymentNotificationTable.bulkRemove: failed for: ",", error: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handlePaymentTransactionNotification: no msg found for id: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["handlePaymentNotification: failed: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["createPaymentNotificationAck: invalid notification, stanzaId:",", from:",""]);k=function(){return a};return a}function a(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=d("WAWebPaymentNotificationParser").paymentNotificationParser.parse(a);if(a.error!=null){d("WALogger").WARN(j(),a.error);throw a.error}var b=a.success,c=b.transaction;b=b.invite;b!=null?yield o(b):c!=null&&(yield m(c));if(d("WAWebMessagingGatingUtils").isPaymentNotificationAckKickFixEnabled())return x(a.success)});return l.apply(this,arguments)}function m(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=c("WANullthrows")(a.msgKey),e=d("WAWebMsgCollection").MsgCollection.get(b);e=e?d("WAWebStateUtils").unproxy(e):yield d("WAWebDBMsgUtils").getMsgByMsgKey(b);if(!e){d("WALogger").WARN(i(),b);b=babelHelpers["extends"]({},a,{msgKey:b.toString()});yield d("WAWebSchemaOrphanPaymentNotification").getTable().createOrReplace(b);return}yield q(e,a)});return n.apply(this,arguments)}function o(a){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.type!=="account-set-up")return;a=(yield v(a.from,a.timestamp));yield d("WAWebHandleSingleMsg").handleSingleMsg(a.from,a)});return p.apply(this,arguments)}function q(a,b){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=[];s(a,b);c.push(a.id.toString());b=[a instanceof d("WAWebMsgModel").Msg?a.toJSON():a];if(a.paymentRequestMessageKey!=null){var e=d("WAWebMsgCollection").MsgCollection.get(a.paymentRequestMessageKey);e=e?d("WAWebStateUtils").unproxy(e):yield d("WAWebDBMsgUtils").getMsgByMsgKey(a.paymentRequestMessageKey||"");e&&(e.paymentStatus=a.paymentStatus,e.paymentTxnStatus=d("WAWebPaymentStatusUtils").determinePaymentRequestFulfilledStatus(a.paymentTxnStatus),b.push(e instanceof d("WAWebMsgModel").Msg?e.toJSON():e))}d("WAWebSchemaOrphanPaymentNotification").getTable().bulkRemove(c)["catch"](function(a){d("WALogger").ERROR(h(),c,a)});yield d("WAWebMessageStore").updateExistingMessages(b)});return r.apply(this,arguments)}function s(a,b){b&&(b.status!=null&&(a.paymentStatus=d("WAWebPaymentStatusUtils").getPaymentWebStatus(b.status,b.type),a.paymentTxnStatus=d("WAWebPaymentStatusUtils").getPaymentTxnWebStatus(b.status)),a.paymentCurrency=b.currency||"",a.paymentAmount1000=c("WANullthrows")(b.amount1000),a.paymentMessageReceiverJid=b.receiver,a.paymentTransactionTimestamp=c("WANullthrows")(b.ts))}function e(a){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.map(function(a){return a.id.toString()});b=(yield d("WAWebSchemaOrphanPaymentNotification").getTable().bulkGet(b));var e=new Map();a.forEach(function(a){e.set(a.id.toString(),a)});b.forEach(function(a){if(a){var b=e.get(a.msgKey);if(!b)return;void q(b,{receiver:a.receiver,currency:a.currency,amount1000:a.amount1000,type:a.type,status:a.status,ts:a.ts,msgKey:c("WAWebMsgKey").fromString(a.msgKey)})}})});return t.apply(this,arguments)}function f(){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WAWebSchemaOrphanPaymentNotification").getTable().all()),b=new Map(),e=[];a.forEach(function(a){var f=d("WAWebMsgCollection").MsgCollection.get(a.msgKey);f?void q(f,{receiver:a.receiver,currency:a.currency,amount1000:a.amount1000,type:a.type,status:a.status,ts:a.ts,msgKey:c("WAWebMsgKey").fromString(a.msgKey)}):(b.set(a.msgKey,a),e.push(a.msgKey))});if(e.length>0){a=(yield d("WAWebDBMsgUtils").getMsgsByMsgKey(e,function(a){var e=b.get(a.id.toString());e&&(a.paymentTxnStatus=d("WAWebPaymentStatusUtils").getPaymentTxnWebStatus(e.status),a.paymentCurrency=e.currency||"",a.paymentAmount1000=c("WANullthrows")(e.amount1000),a.paymentMessageReceiverJid=e.receiver,a.paymentTransactionTimestamp=c("WANullthrows")(e.ts))}));return d("WAWebMessageStore").updateExistingMessages(a)}});return u.apply(this,arguments)}function v(a,b){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){return{id:new(c("WAWebMsgKey"))({remote:a,fromMe:!1,id:yield c("WAWebMsgKey").newId()}),type:d("WAWebMsgType").MSG_TYPE.NOTIFICATION_TEMPLATE,kind:d("WAWebMsgType").MsgKind.NotificationTemplate,subtype:d("WAWebCommonMsgSubtypeTypes").MsgSubtype.PaymentInviteAccountSetUp,from:a,to:d("WAWebUserPrefsMeUser").getMeUser(),recipients:[],t:b,templateParams:[a]}});return w.apply(this,arguments)}function x(a){var b=a.stanzaId;a=a.from;if(b==null||a==null){d("WALogger").WARN(k(),b,a).sendLogs("payment-notifications-missing-stanza-id-or-from");return null}return d("WAWap").wap("ack",{"class":"notification",type:"pay",id:d("WAWap").CUSTOM_STRING(b),to:a})}g.handlePaymentNotification=a;g.processOrphanPaymentNotifications=e;g.processAllOrphanPaymentNotifications=f}),98);
__d("WAWebCommsHandleStanza",["WABackendHandleError","WACreateHandleChatState","WAHandleDecisionTreeResult","WAJids","WALogger","WAParsableWapNode","WAWap","WAWebABProps","WAWebAltDeviceLinkingHandleNotification","WAWebCommsHandleWorkerCompatibleStanza","WAWebCreateNackFromStanza","WAWebHandleAboutNotification","WAWebHandleAccountSyncNotification","WAWebHandleAppdata","WAWebHandleBusinessNotification","WAWebHandleChatState","WAWebHandleContactNotification","WAWebHandleDeviceNotification","WAWebHandleDeviceSwitchingNotification","WAWebHandleDigestKey","WAWebHandleDisappearingModeNotification","WAWebHandleFailure","WAWebHandleGrowthNotification","WAWebHandleInfoBulletin","WAWebHandleMediaRetryNotification","WAWebHandleMexNotification","WAWebHandleNewsletterNotification","WAWebHandlePairDevice","WAWebHandlePairSuccess","WAWebHandlePreKeyLow","WAWebHandlePresence","WAWebHandlePrivacyTokensNotification","WAWebHandleProfilePicNotification","WAWebHandlePsa","WAWebHandleQPSurfacesNotification","WAWebHandleRetryRequest","WAWebHandleServerNotification","WAWebHandleServerSyncNotification","WAWebHandleStreamError","WAWebHandleSuccess","WAWebHandleUsernameChangeNotification","WAWebHandleVoipCall","WAWebHandleVoipEncRekeyRetryRequest","WAWebHandleWaChat","WAWebOfflineHandler","WAWebPaymentNotificationHandler","WAWebPostUnknownStanzaMetric","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms.handleStanza unrecognized stanza ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms.handleStanza received xmlstreamend, return NO_ACK"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Comms.handleStanza unrecognized notification stanza ",""]);j=function(){return a};return a}var k=d("WACreateHandleChatState").createHandleChatState({groupMessage:{handleGroupChatState:d("WAWebHandleChatState").handleGroupChatState},individualMessage:{handleIndividualChatState:d("WAWebHandleChatState").handleIndividualChatState}});function l(a,b,c){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){var f=a.attrs;if(f.offline){var g=parseInt(f.t,10),l=parseInt(f.offline,10);d("WAWebOfflineHandler").OfflineMessageHandler.newOfflineStanza(g,e,l)}g=d("WAWebCommsHandleWorkerCompatibleStanza").handleWorkerCompatibleStanza(a);if(g!=null)return g;switch(a.tag){case"iq":return o(a);case"receipt":try{if(f.type==="retry")return yield d("WAWebHandleRetryRequest").handleMessageRetryRequest(a);else if(f.type==="enc_rekey_retry")return yield c("WAWebHandleVoipEncRekeyRetryRequest")(a);break}catch(b){if(b instanceof d("WAParsableWapNode").XmppParsingFailure){d("WAWebPostUnknownStanzaMetric").postUnknownStanzaMetric(a);return d("WAWebCreateNackFromStanza").createNackFromStanza(a,d("WAWebCreateNackFromStanza").NackReason.ParsingError)}return d("WAWebCreateNackFromStanza").createNackFromStanza(a,d("WAWebCreateNackFromStanza").NackReason.UnhandledError)}case"notification":try{switch(f.type){case"server_sync":return yield d("WAWebHandleServerSyncNotification").handleServerSyncNotification(a);case"picture":return yield d("WAWebHandleProfilePicNotification").handleProfilePicNotificationJob(a);case"business":return yield d("WAWebHandleBusinessNotification").handleBusinessNotificationJob(a);case"contacts":e=a.content;if(!Array.isArray(e)||!e.length)break;l=e[0].tag;return l==="invite"?yield c("WAWebHandleGrowthNotification")(a):yield c("WAWebHandleContactNotification")(a);case"devices":return yield d("WAWebHandleDeviceNotification").handleDevicesNotification(a);case"disappearing_mode":return yield d("WAWebHandleDisappearingModeNotification").handleDisappearingModeNotificationJob(a);case"mediaretry":g=(yield c("WAWebHandleMediaRetryNotification")(a));return g;case"encrypt":e=a.content;if(!Array.isArray(e)||!e.length)break;l=e[0].tag;switch(l){case"count":return yield c("WAWebHandlePreKeyLow")(a,b);case"digest":return yield c("WAWebHandleDigestKey")(a)}break;case"server":return yield d("WAWebHandleServerNotification").handleServerNotification(a);case"status":return yield d("WAWebHandleAboutNotification").handleAboutNotification(a);case"account_sync":return yield d("WAWebHandleAccountSyncNotification").handleAccountSyncNotification(a);case"pay":return yield d("WAWebPaymentNotificationHandler").handlePaymentNotification(a);case"psa":if(f.from!=null&&f.from.toString()===d("WAJids").PSA_JID){g=a.content;if(!Array.isArray(g)||!g.length)break;e=g[0].tag;if(e==="surfaces")return yield d("WAWebHandleQPSurfacesNotification").handleQPSurfacesNotification(a);if(d("WAWebABProps").getABPropConfigValue("enable_client_chat_psa"))return yield c("WAWebHandleWaChat")(a);break}return yield c("WAWebHandlePsa")(a);case"privacy_token":return yield c("WAWebHandlePrivacyTokensNotification")(a);case"link_code_companion_reg":return yield d("WAWebAltDeviceLinkingHandleNotification").handleAltDeviceLinkingNotification(a);case"newsletter":return yield c("WAWebHandleNewsletterNotification")(a);case"w:growth":return yield c("WAWebHandleGrowthNotification")(a);case"registration":return yield c("WAWebHandleDeviceSwitchingNotification")(a);case"mex":return yield d("WAWebHandleMexNotification").handleMexNotification(a);case"username":return yield d("WAWebHandleUsernameChangeNotification").handleUsernameChangeNotification(a)}}catch(b){if(b instanceof d("WAParsableWapNode").XmppParsingFailure){d("WAWebPostUnknownStanzaMetric").postUnknownStanzaMetric(a);return d("WAWebCreateNackFromStanza").createNackFromStanza(a,d("WAWebCreateNackFromStanza").NackReason.ParsingError)}return d("WAWebCreateNackFromStanza").createNackFromStanza(a,d("WAWebCreateNackFromStanza").NackReason.UnhandledError)}d("WALogger").DEV_XMPP(j(),a);return d("WAWebCreateNackFromStanza").createNackFromStanza(a,d("WAWebCreateNackFromStanza").NackReason.UnrecognizedStanza);case"chatstate":return d("WAHandleDecisionTreeResult").handleDecisionTreeResult(a,k(a));case"presence":return c("WAWebHandlePresence")(a);case"ib":return c("WAWebHandleInfoBulletin")(a);case"stream:error":return c("WAWebHandleStreamError")(a);case"failure":return c("WAWebHandleFailure")(a);case"success":return c("WAWebHandleSuccess")(a);case"call":return d("WAWebHandleVoipCall").handleCall(a);case"appdata":if(d("WAWebABProps").getABPropConfigValue("use_appdata_stanza_on_receiver"))return c("WAWebHandleAppdata")(a);break;case"error":return d("WABackendHandleError").handleError(a);case"xmlstreamend":d("WALogger").LOG(i());return"NO_ACK"}d("WALogger").DEV_XMPP(h(),a);return d("WAWebCreateNackFromStanza").createNackFromStanza(a,d("WAWebCreateNackFromStanza").NackReason.UnrecognizedStanza)});return m.apply(this,arguments)}function a(a,b,c){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){c===void 0&&(c=0);a=(yield l(a,b,c));return a==null?"NO_ACK":a});return n.apply(this,arguments)}function o(a){var b=a.attrs,e=a.content;if(b.xmlns==="urn:xmpp:ping")return d("WAWap").wap("iq",{type:"result",to:b.from});else if(b.xmlns==="md"){if(!Array.isArray(e)||!e.length)return;b=e[0].tag;switch(b){case"pair-device":return c("WAWebHandlePairDevice")(a);case"pair-success":return c("WAWebHandlePairSuccess")(a)}}else throw c("err")("handleIq unrecognized "+a.toString())}g["default"]=a}),98);
__d("WAWebHandleStreamError",["Promise","WAComms","WADeprecatedWapParser","WALogger","WAWebCmd","WAWebCompanionRegUtils","WAWebJestE2ELogUtils","WAWebSocketModel","WAWebStartBackend","WAWebUserPrefsTabMutex","WAWebWamDeviceLinkReporter","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleStreamError: sent xml not well formed, closing the socket:"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleStreamError: sent xml not well formed, closing the socket"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleStreamError: session replaced while we have a mutex, closing the socket"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["stream error due to device removed, logging out"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Parsing Error: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["error while parsing: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unrecognized stream:error: ",""]);o=function(){return a};return a}var p=new(c("WADeprecatedWapParser"))("streamErrorParser",function(a){a.assertTag("stream:error");if(a.hasChild("conflict")){var b=a.child("conflict");b=b.attrString("type");switch(b){case"replaced":return{type:"replaced"};case"device_removed":default:return{type:"device_removed"}}}else if(a.hasAttr("code"))return{type:"code",code:a.attrInt("code")};else if(a.hasChild("ack"))return{type:"ack",id:a.child("ack").hasAttr("id")?a.child("ack").attrString("id"):null};else if(a.hasChild("xml-not-well-formed"))return{type:"xml-not-well-formed"};else{d("WALogger").WARN(o(),a.toString());return{type:"other"}}});function a(a){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=p.parse(a);if(e.error){d("WALogger").DEV(n(),a.toString());d("WALogger").ERROR(m(),e.error.toString());return(h||(h=b("Promise"))).reject(e.error)}e=e.success;if(e.type==="code"&&e.code>=500&&e.code<600){if(e.code===515){d("WAComms").stopComms();yield d("WAWebCompanionRegUtils").startLogin();void d("WAWebStartBackend").startBackend();return(h||(h=b("Promise"))).resolve("NO_ACK")}else if(e.code===516){d("WAComms").stopComms();yield d("WAWebWamDeviceLinkReporter").commitDeviceLinkEvent(516);yield d("WAWebCompanionRegUtils").startLogout();void d("WAWebStartBackend").startBackend();return(h||(h=b("Promise"))).resolve("NO_ACK")}d("WAComms").onStreamErrorReceived()}else if(e.type==="device_removed"){d("WAWebCmd").Cmd.onStartingLogout();d("WAComms").stopComms();yield d("WAWebSocketModel").Socket.clearCredentialsAndStoredData();d("WALogger").LOG(l());d("WAWebJestE2ELogUtils").maybeLogToJestE2eJSConsole("stream error due to device removed, logging out");d("WAWebCmd").Cmd.logout();return(h||(h=b("Promise"))).resolve("NO_ACK")}else if(e.type==="replaced"){d("WAWebUserPrefsTabMutex").currentTabHasMutex()&&d("WALogger").ERROR(k()).sendLogs("invalid-session-replacement",.1);d("WAComms").stopComms();return(h||(h=b("Promise"))).resolve("NO_ACK")}else e.type==="xml-not-well-formed"&&(c("gkx")("26258")?d("WALogger").WARN(j()):d("WALogger").WARN(i()).devConsole(a.toString()).sendLogs("sent-xml-not-well-formed"));return(h||(h=b("Promise"))).resolve("CLOSE_SOCKET")});return q.apply(this,arguments)}g["default"]=a}),98);
__d("WAWebExternalBetaApi",["Promise","WAComms","WALogger","WAWebAbPropsSyncJob","WAWebBackendApi","WAWebStartBackend","WAWebUserPrefsGeneral","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["WAWebExternalBetaApi: Syncing AB Props after changing Web Beta opt-in status"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["WAWebExternalBetaApi: Restarting backend"]);j=function(){return a};return a}function a(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=(yield d("WAWebUserPrefsGeneral").getWhatsAppWebExternalBetaJoinedIdb());c!==a&&(yield (h||(h=b("Promise"))).all([d("WAWebUserPrefsGeneral").setWhatsAppWebExternalBetaDirtyBitIdb(!0),d("WAWebUserPrefsGeneral").setWhatsAppWebExternalBetaJoinedIdb(a)]),yield l(),d("WAWebBackendApi").frontendFireAndForget("changeOptInStatusForExternalWebBeta",{}))});return k.apply(this,arguments)}function l(){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){d("WALogger").LOG(j()),d("WAComms").stopComms(),yield d("WAWebStartBackend").startWebComms(),yield d("WAComms").startHandlingRequests(),(yield d("WAWebUserPrefsGeneral").getWhatsAppWebExternalBetaDirtyBitIdb())&&(d("WALogger").LOG(i()),yield d("WAWebAbPropsSyncJob").syncABPropsTask(),yield d("WAWebUserPrefsGeneral").setWhatsAppWebExternalBetaDirtyBitIdb(!1))});return m.apply(this,arguments)}g.changeOptInStatusForExternalWebBeta=a}),98);
__d("WAWebWamEnumBootstrapAppStateDataStageCode",[],(function(a,b,c,d,e,f){a=Object.freeze({REQUEST_BUILT:1,RESPONSE_RECEIVED:2,RESPONSE_PARSED_VALID:3,MISSING_KEYS_REQUESTED:4,MISSING_KEYS_RECEIVED:5,MUTATIONS_DECRYPTED:6,ABOUT_TO_APPLY_MUTATIONS:7,APPLIED_MUTATIONS:8,PUSHNAME_APPLIED:9,PUSHNAME_INVALID:10,ENTERED_RETRY_MODE:11});f.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE=a}),66);
__d("WAWebMdBootstrapAppStateCriticalDataProcessingWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumBootstrapAppStateDataStageCode","WAWebWamEnumMdBootstrapPayloadType"],(function(a,b,c,d,e,f,g){b=(a=d("WAWebWamCodegenUtils")).defineEvents({MdBootstrapAppStateCriticalDataProcessing:[3164,{bootstrapAppStateDataStage:[1,d("WAWebWamEnumBootstrapAppStateDataStageCode").BOOTSTRAP_APP_STATE_DATA_STAGE_CODE],mdBootstrapPayloadType:[2,d("WAWebWamEnumMdBootstrapPayloadType").MD_BOOTSTRAP_PAYLOAD_TYPE],mdRegAttemptId:[3,a.TYPES.STRING],mdSessionId:[4,a.TYPES.STRING],mdTimestamp:[5,a.TYPES.INTEGER]},[1,1,1],"regular"]});g.MdBootstrapAppStateCriticalDataProcessingWamEvent=b}),98);
__d("WAWebSyncdCriticalBootstrapProcessingApi",["WATimeUtils","WAWebGetDefaultExport","WAWebMdBootstrapAppStateCriticalDataProcessingWamEvent","WAWebSyncBootstrap","WAWebSyncdMdSyncFieldstatMeta","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){c("WAWebGetDefaultExport")(b("WAWebSyncBootstrap")).isSyncDCriticalDataSyncInProcess()&&new(d("WAWebMdBootstrapAppStateCriticalDataProcessingWamEvent").MdBootstrapAppStateCriticalDataProcessingWamEvent)({bootstrapAppStateDataStage:a,mdSessionId:yield d("WAWebSyncdMdSyncFieldstatMeta").MdSyncFieldStatsMeta.getMdSessionId(),mdTimestamp:d("WATimeUtils").unixTimeMs()}).commit()});return h.apply(this,arguments)}g.logCriticalBootstrapStageIfNecessary=a}),98);
__d("WAWebSyncdFatalExceptionNotificationApi",["WATimeUtils","WAWebApiPeerMessageStore","WAWebMsgKey","WAWebSendAppStateSyncMsgJob","WAWebUserPrefsMeUser","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a={collectionNames:a,timestamp:d("WATimeUtils").unixTimeMs()};var b=new(c("WAWebMsgKey"))({fromMe:!0,remote:d("WAWebUserPrefsMeUser").getMeUser(),id:yield c("WAWebMsgKey").newId()});b={id:b,to:d("WAWebWidFactory").createDeviceWidFromUserAndDevice(d("WAWebUserPrefsMeUser").assertGetMe().user,d("WAWebUserPrefsMeUser").assertGetMe().server,0),type:"protocol",subtype:"app_state_fatal_exception_notification",appStateFatalExceptionNotification:a};yield d("WAWebApiPeerMessageStore").storePeerMessages([b]);return d("WAWebSendAppStateSyncMsgJob").encryptAndSendKeyMsg(b)});return h.apply(this,arguments)}g.sendAppStateFatalExceptionNotification=a}),98);
__d("WAWebPriorLogs",["$InternalEnum","Promise","WALogger","WATimeUtils","WAWebSchemaSyncdLogs","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["prior logs: error while writing to prior logs: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["prior logs: error while printing fatal logs: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["\r\n\r\nprior logs: category ",": \r\n\r\n"],["\\r\\n\\r\\nprior logs: category ",": \\r\\n\\r\\n"]);l=function(){return a};return a}c=b("$InternalEnum")({Empty:"",Regular:"regular",RegularLow:"regular_low",RegularHigh:"regular_high",CriticalBlock:"critical_block",CriticalUnblockLow:"critical_unblock_low"});var m=new Map(),n=90,o=80;function p(a){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b;b=(b=m.get(a))!=null?b:0;m.set(a,b+1);if(b%n===0){b=(yield d("WAWebSchemaSyncdLogs").getSyncdLogsTable().equals(["collection"],a));if(b.length<o)return;a=b.sort(function(a,b){return a.ts-b.ts}).slice(0,b.length-o).map(function(a){return a.id});yield d("WAWebSchemaSyncdLogs").getSyncdLogsTable().bulkRemove(a)}});return q.apply(this,arguments)}function a(a,b){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){try{yield p(a),yield d("WAWebSchemaSyncdLogs").getSyncdLogsTable().bulkCreate([{collection:a,log:b,ts:d("WATimeUtils").unixTimeMs()}])}catch(a){d("WALogger").ERROR(i(),a)}});return r.apply(this,arguments)}e=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){try{a=a.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield d("WAWebSchemaSyncdLogs").getSyncdLogsTable().equals(["collection"],a));b=b.filter(function(a){return d("WATimeUtils").happenedWithin(d("WATimeUtils").castMilliSecondsToUnixTime(a.ts),d("WATimeUtils").DAY_MILLISECONDS*60)});b=b.map(function(a){return d("WATimeUtils").toHttpHeaderDate(d("WATimeUtils").castMilliSecondsToUnixTime(a.ts))+": "+a.log+"\r\n"});d("WALogger").LOG(l(),a);a=20;for(var c=0;c<b.length;c+=a)d("WALogger").LOG(k(),b.slice(c,c+a))});return function(b){return a.apply(this,arguments)}}());yield (h||(h=b("Promise"))).all((a=a)!=null?a:[])}catch(a){d("WALogger").ERROR(j(),a)}});return function(b){return a.apply(this,arguments)}}();g.WAWebLogCategory=c;g.writePriorLog=a;g.printPriorLogs=e}),98);
__d("WAWebSyncdLogs",["WALogger","WASyncdConst","WAWebPriorLogs","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: cannot log unknown cagtegory ",""]);h=function(){return a};return a}a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=d("WAWebPriorLogs").WAWebLogCategory.cast(a);if(c!=null)return d("WAWebPriorLogs").writePriorLog(c,b);d("WALogger").WARN(h(),a)});return function(b,c){return a.apply(this,arguments)}}();c=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=[].concat(Array.from(d("WASyncdConst").CollectionName.members()),[""]).map(function(a){return d("WAWebPriorLogs").WAWebLogCategory.cast(a)}).filter(Boolean);return d("WAWebPriorLogs").printPriorLogs(a)});return function(){return a.apply(this,arguments)}}();g.writeSyncdLogImpl=a;g.printSyncdLogs=c}),98);
__d("WAWebSyncdFatal",["Promise","WAAsyncSleep","WABaseGlobals","WALogger","WATimeUtils","WAWebLogoutReasonConstants","WAWebSocketLogoutJob","WAWebSyncdFatalExceptionNotificationApi","WAWebSyncdLogs","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: Received fatal error and logged out"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: end notifying primary on fatal error. tsBeforeSleep: ",", tsBeforeSendToPrimary: ",", currTs: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: end notifying primary on fatal error"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: error when sending fatal message to primary: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: start notifying primary on fatal error"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: fatal flow: before sleep"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: starting fatal flow for ",""]);o=function(){return a};return a}var p=5e3;function a(a){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WALogger").LOG(o(),a);a?yield r(a,"handleFatalError for collection"):yield d("WABaseGlobals").getDbImpls().writeSyncdLog("","handleFatalError without collection");var b=[];a!=null&&(b=a.map(function(a){return String(a)}));var c=d("WATimeUtils").castMilliSecondsToUnixTime(d("WATimeUtils").unixTimeMs());d("WALogger").LOG(n());yield d("WAAsyncSleep").asyncSleep(p);yield r(a,"handleFatalError before notify primary");var e=d("WATimeUtils").castMilliSecondsToUnixTime(d("WATimeUtils").unixTimeMs());d("WALogger").LOG(m());try{yield d("WAWebSyncdFatalExceptionNotificationApi").sendAppStateFatalExceptionNotification(b)}catch(a){d("WALogger").ERROR(l(),a).sendLogs("syncd: could not send fatal to primary")}d("WALogger").LOG(k());yield r(a,"handleFatalError after notify primary");b=d("WATimeUtils").castMilliSecondsToUnixTime(d("WATimeUtils").unixTimeMs());d("WALogger").LOG(j(),d("WATimeUtils").toHttpHeaderDate(c),d("WATimeUtils").toHttpHeaderDate(e),d("WATimeUtils").toHttpHeaderDate(b));yield d("WAWebSyncdLogs").printSyncdLogs();d("WALogger").ERROR(i()).verbose().tags("syncd","logout").sendLogs("syncd: fatal error and logged out");yield d("WAWebSocketLogoutJob").socketLogout(d("WAWebLogoutReasonConstants").LogoutReason.SyncdFailure)});return q.apply(this,arguments)}function r(a,c){return(h||(h=b("Promise"))).all(((a=a)!=null?a:[""]).map(function(a){return d("WABaseGlobals").getDbImpls().writeSyncdLog(a,c)}))}g.handleFatalError=a}),98);
__d("WADeleteMessageForMeSyncBase",["WAServerSync.pb","WASyncdAction","WASyncdActionUtils","WASyncdConst"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}var c=b.prototype;c.getVersion=function(){return 3};c.getAction=function(){return d("WASyncdConst").Actions.DeleteMessageForMe};c.buildDeleteForMeMutation=function(a){var b=a.timestamp,c=a.deleteMedia,e=a.messageTimestamp;a=babelHelpers.objectWithoutPropertiesLoose(a,["timestamp","deleteMedia","messageTimestamp"]);c={deleteMessageForMeAction:{deleteMedia:c,messageTimestamp:e}};return d("WASyncdActionUtils").buildPendingMutation({collection:d("WASyncdConst").CollectionName.RegularHigh,indexArgs:d("WASyncdActionUtils").buildMessageKey(a),value:c,version:this.getVersion(),operation:d("WAServerSync.pb").SyncdMutation$SyncdOperation.SET,timestamp:b,action:this.getAction()})};return b}(d("WASyncdAction").SyncActionBase);g.DeleteMessageForMeSyncBase=a}),98);
__d("WAWebDeleteMessageForMeSync",["Promise","WADeleteMessageForMeSyncBase","WALogger","WANullthrows","WASyncAction.pb","WASyncdConst","WATimeUtils","WAWebAddonProcessDeleteForMe","WAWebBackendApi","WAWebChatLoadMessages","WAWebFrontendMsgGetters","WAWebLidMigrationUtils","WAWebMessageStore","WAWebMsgCollection","WAWebMsgGetters","WAWebMsgKey","WAWebPersistedJobDefinitions","WAWebPersistedJobManager","WAWebSchemaMessage","WAWebSyncdActionUtils","WAWebSyncdUtils","WAWebWamEnumMdSyncdCriticalEventCode","WAWebWid","WAWebWidToJid","asyncToGeneratorRuntime","decodeProtobuf"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["delete_message_for_me_sync: operation not supported"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: successfully deleted "," for me."]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["delete_message_for_me_sync: msg "," found in storage but not in collection"]);k=function(){return a};return a}a=function(a){babelHelpers.inheritsLoose(e,a);function e(){return a.apply(this,arguments)||this}var f=e.prototype;f.applyMutations=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=[],f=new Map();yield d("WAWebSchemaMessage").getMessageTable().bulkGet(a.map(function(a){a=a.indexParts;var b=a[1],e=a[2],f=a[3];a=a[4];if(!b||!e||!f||!a)return null;return!c("WAWebWid").isWid(b)?null:(b=d("WAWebSyncdActionUtils").syncKeyToMsgKey(b,e,f,a))==null?void 0:b.toString()}).filter(Boolean)).then(function(a){return a.forEach(function(a){a&&f.set(a.id,a)})});a=(yield (h||(h=b("Promise"))).all(a.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){try{if(a.operation==="set"){a=a.indexParts;var b=a[1],c=a[2],g=a[3];a=a[4];(!b||!c||!g||!a)&&d("WAWebSyncdActionUtils").throwInvalidActionIndex();b=d("WAWebSyncdActionUtils").syncKeyToMsgKey(b,c,g,a);if(!b){d("WAWebSyncdUtils").uploadCriticalEventMetric(d("WAWebWamEnumMdSyncdCriticalEventCode").MD_SYNCD_CRITICAL_EVENT_CODE.ACTION_INVALID_INDEX_DATA);return{actionState:d("WASyncdConst").SyncActionState.Malformed}}c=f.get(b.toString());if(!c){g=d("WAWebLidMigrationUtils").getAlternateMsgKey(b);if(g!=null){a=(yield d("WAWebAddonProcessDeleteForMe").hasDeleteAddonForMe(g));if(a!=null)return d("WAWebAddonProcessDeleteForMe").processDeleteForMe(g)}return{actionState:d("WASyncdConst").SyncActionState.Orphan,orphanModel:{modelId:b.toString(),modelType:d("WASyncdConst").SyncModelType.Msg}}}e.push(c.id);a=d("WAWebMsgCollection").MsgCollection.get(b);a?(d("WAWebFrontendMsgGetters").getChat(a).msgs.length===1&&(yield d("WAWebChatLoadMessages").loadEarlierMsgs(d("WAWebFrontendMsgGetters").getChat(a))),a["delete"]()):d("WALogger").WARN(k(),b);d("WALogger").DEV(j(),b);return{actionState:d("WASyncdConst").SyncActionState.Success}}d("WALogger").WARN(i());return{actionState:d("WASyncdConst").SyncActionState.Unsupported}}catch(a){return{actionState:d("WASyncdConst").SyncActionState.Failed}}});return function(b){return a.apply(this,arguments)}}())));if(e.length>0){yield d("WAWebMessageStore").removeMessagesFromHistory(e);var g=new Set();e.forEach(function(a){return g.add(c("WAWebMsgKey").fromString(a).remote.toString())});var l=Array.from(g.values()).join(",").toString();d("WAWebBackendApi").frontendFireAndForget("deleteModelsForLastAddOnPreview",{messagesIds:e});var m=b("WAWebPersistedJobManager").getJobManager;yield m().waitUntilPersisted(d("WAWebPersistedJobDefinitions").jobSerializers.deleteAddOns(l,e))}return a});function e(b){return a.apply(this,arguments)}return e}();f.resolveConflicts=function(a,e){a=d("decodeProtobuf").decodeProtobuf(d("WASyncAction.pb").SyncActionValueSpec,a.binarySyncAction);e=d("decodeProtobuf").decodeProtobuf(d("WASyncAction.pb").SyncActionDataSpec,e.binarySyncData).value;a=c("WANullthrows")((a=a.deleteMessageForMeAction)==null?void 0:a.deleteMedia);e=c("WANullthrows")(e==null?void 0:(e=e.deleteMessageForMeAction)==null?void 0:e.deleteMedia);return!e&&a?(h||(h=b("Promise"))).resolve(d("WASyncdConst").ConflictResolutionState.SkipRemote):(h||(h=b("Promise"))).resolve(d("WASyncdConst").ConflictResolutionState.SkipRemoteAndDropLocal)};f.getDeleteForMeMutations=function(a,b){var c=this,e=d("WATimeUtils").unixTimeMs();return a.map(function(a){return c.buildDeleteForMeMutation({timestamp:e,deleteMedia:b,messageTimestamp:a.t,remoteJid:d("WAWebWidToJid").widToChatJid(a.id.remote),id:a.id.id,fromMe:a.id.fromMe,participant:d("WAWebMsgGetters").getIsGroupMsg(a)&&!a.id.fromMe?d("WAWebWidToJid").widToUserJid(d("WAWebMsgGetters").getSender(a)):null})})};return e}(d("WADeleteMessageForMeSyncBase").DeleteMessageForMeSyncBase);e=new a();g["default"]=e}),98);
__d("WAWebExternalWebBetaSync",["Promise","WALogger","WASyncdAction","WASyncdConst","WAWebABProps","WAWebExternalBetaApi","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["external beta opt in sync: operation not supported"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: successfully set web external beta opt in to ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["beta setting sync: malformed mutation value"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["beta setting sync: malformed mutation"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: action not enabled"]);m=function(){return a};return a}a=function(a){babelHelpers.inheritsLoose(e,a);function e(){return a.apply(this,arguments)||this}var f=e.prototype;f.getVersion=function(){return 3};f.getAction=function(){return d("WASyncdConst").Actions.ExternalWebBeta};f.applyMutations=function(a){if(d("WAWebABProps").getABPropConfigValue("external_beta_can_join")!==!0){d("WALogger").LOG(m());return(h||(h=b("Promise"))).resolve(a.map(function(){return{actionState:d("WASyncdConst").SyncActionState.Unsupported}}))}return(h||(h=b("Promise"))).all(a.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){try{if(a.operation==="set"){a=a.value;a=a.externalWebBetaAction;if(!a){d("WALogger").WARN(l());return{actionState:d("WASyncdConst").SyncActionState.Malformed}}if(c("gkx")("26254")&&a.isOptIn!==void 0)yield d("WAWebExternalBetaApi").changeOptInStatusForExternalWebBeta(a.isOptIn);else{d("WALogger").WARN(k());return{actionState:d("WASyncdConst").SyncActionState.Malformed}}d("WALogger").DEV(j(),a.isOptIn);return{actionState:d("WASyncdConst").SyncActionState.Success}}d("WALogger").WARN(i());return{actionState:d("WASyncdConst").SyncActionState.Unsupported}}catch(a){return{actionState:d("WASyncdConst").SyncActionState.Failed}}});return function(b){return a.apply(this,arguments)}}()))};return e}(d("WASyncdAction").SyncActionBase);e=new a();g["default"]=e}),98);
__d("WAWebLabelSync",["Promise","WALogger","WAServerSync.pb","WASyncdAction","WASyncdActionUtils","WASyncdConst","WAWebBizGatingUtils","WAWebLabelCollection","WAWebModelStorageUtils","WAWebSchemaLabel","WAWebSyncdActionUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["label sync: operation not supported"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["labelEditAction.color is empty"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["labelEditAction.name is empty"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["label sync: malformed mutation"]);l=function(){return a};return a}a=function(a){babelHelpers.inheritsLoose(c,a);function c(){return a.apply(this,arguments)||this}var e=c.prototype;e.getVersion=function(){return 3};e.getAction=function(){return d("WASyncdConst").Actions.LabelEdit};e.applyMutations=function(a){var c=d("WAWebBizGatingUtils").isLabelReorderingSyncFromPrimaryEnabled();return(h||(h=b("Promise"))).all(a.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){try{if(a.operation==="set"){var e,f=a.indexParts;a=a.value;var g=f[1];g||d("WAWebSyncdActionUtils").throwInvalidActionIndex();f=a.labelEditAction;if(!f){d("WALogger").WARN(l());return{actionState:d("WASyncdConst").SyncActionState.Malformed}}if(f.deleted===!0){yield d("WAWebSchemaLabel").getLabelTable().remove(g);d("WAWebLabelCollection").LabelCollection.remove(g);return{actionState:d("WASyncdConst").SyncActionState.Success}}a=f.color;var h=f.predefinedId;e=(e=f.name)!=null?e:"";e===""&&d("WALogger").WARN(k());a==null&&d("WALogger").WARN(j());var m={id:g,name:e,colorIndex:a,predefinedId:h};c&&f.orderIndex!=null&&(m.orderIndex=f.orderIndex);e=(yield d("WAWebModelStorageUtils").getStorage().lock(["label","label-association"],function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a[0];a=a[1];yield b.createOrReplace(m);return a.anyOf(["labelId"],[g])});return function(b){return a.apply(this,arguments)}}()));d("WAWebLabelCollection").LabelCollection.add(babelHelpers["extends"]({},m),{merge:!0});a=d("WAWebLabelCollection").LabelCollection.get(g);if(a!=null&&e.length>0){var n=a.labelItemCollection.reduce(function(a,b){a.add(b.id);return a},new Set());h=e.filter(function(a){return!n.has(a.associationId)});h.length>0&&d("WAWebLabelCollection").LabelCollection.initializeAssociationsFromCache(h)}return{actionState:d("WASyncdConst").SyncActionState.Success}}d("WALogger").WARN(i());return{actionState:d("WASyncdConst").SyncActionState.Unsupported}}catch(a){return{actionState:d("WASyncdConst").SyncActionState.Failed}}});return function(b){return a.apply(this,arguments)}}()))};e.getLabelMutation=function(a,b,c,e,f,g){b={labelEditAction:{name:b,color:c,deleted:e,predefinedId:f}};return d("WASyncdActionUtils").buildPendingMutation({collection:d("WASyncdConst").CollectionName.RegularLow,indexArgs:[a],value:b,version:this.getVersion(),operation:d("WAServerSync.pb").SyncdMutation$SyncdOperation.SET,timestamp:g,action:this.getAction()})};return c}(d("WASyncdAction").SyncActionBase);c=new a();g["default"]=c}),98);
__d("WAWebSetPushnameLocallyConnAction",["WAWebConnModel","WAWebUserPrefsGeneral"],(function(a,b,c,d,e,f,g){function a(a){d("WAWebConnModel").Conn.pushname=a,d("WAWebUserPrefsGeneral").setPushname(a)}g.setPushnameLocally=a}),98);
__d("WAWebPushNameSync",["Promise","WALogger","WASendPresenceStatusProtocol","WAServerSync.pb","WASyncdAction","WASyncdActionUtils","WASyncdConst","WAWebGetDefaultExport","WAWebSetPushnameLocallyConnAction","WAWebSyncBootstrap","WAWebSyncdCriticalBootstrapProcessingApi","WAWebWamEnumBootstrapAppStateDataStageCode","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["push name sync: operation not supported"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: successfully set pushname to ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["push name sync: empty pushname"]);k=function(){return a};return a}a=function(a){babelHelpers.inheritsLoose(e,a);function e(){return a.apply(this,arguments)||this}var f=e.prototype;f.getVersion=function(){return 1};f.getAction=function(){return d("WASyncdConst").Actions.SettingPushName};f.applyMutations=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield (h||(h=b("Promise"))).all(a.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){try{if(a.operation==="set"){a=a.value;a=(a=a.pushNameSetting)==null?void 0:a.name;a||(d("WALogger").WARN(k()),d("WAWebSyncdCriticalBootstrapProcessingApi").logCriticalBootstrapStageIfNecessary(d("WAWebWamEnumBootstrapAppStateDataStageCode").BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.PUSHNAME_INVALID),a="");void d("WASendPresenceStatusProtocol").sendPresenceStatusProtocol({name:a});d("WAWebSetPushnameLocallyConnAction").setPushnameLocally(a);yield d("WAWebSyncdCriticalBootstrapProcessingApi").logCriticalBootstrapStageIfNecessary(d("WAWebWamEnumBootstrapAppStateDataStageCode").BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.PUSHNAME_APPLIED);var e=c("WAWebGetDefaultExport")(b("WAWebSyncBootstrap"));e.isSyncDCriticalDataSyncInProcess()&&(yield e.setSyncDCriticalSynced(),yield e.setSyncDCriticalDataSyncCompleted());d("WALogger").DEV(j(),a);return(h||(h=b("Promise"))).resolve({actionState:d("WASyncdConst").SyncActionState.Success})}d("WALogger").WARN(i());return(h||(h=b("Promise"))).resolve({actionState:d("WASyncdConst").SyncActionState.Unsupported})}catch(a){d("WAWebSyncdCriticalBootstrapProcessingApi").logCriticalBootstrapStageIfNecessary(d("WAWebWamEnumBootstrapAppStateDataStageCode").BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.PUSHNAME_INVALID);return{actionState:d("WASyncdConst").SyncActionState.Failed}}});return function(b){return a.apply(this,arguments)}}())));return a});function e(b){return a.apply(this,arguments)}return e}();f.getPushnameMutation=function(a,b){b={pushNameSetting:{name:b}};return d("WASyncdActionUtils").buildPendingMutation({collection:d("WASyncdConst").CollectionName.CriticalBlock,indexArgs:[],value:b,version:this.getVersion(),operation:d("WAServerSync.pb").SyncdMutation$SyncdOperation.SET,timestamp:a,action:this.getAction()})};return e}(d("WASyncdAction").SyncActionBase);e=new a();g["default"]=e}),98);
__d("WAWebKeyManagementUtils",["WALogger","WAWebApiDeviceList","WAWebUserPrefsMeUser","WAWebWidFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: getPeerDevices: error ",". Future key requests will only be sent to primary device."]);h=function(){return a};return a}function a(){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=[],b=d("WAWebUserPrefsMeUser").assertGetMe();try{var c=(yield d("WAWebApiDeviceList").getMyDeviceList());c.devices.forEach(function(c){c.id!==b.getDeviceId()&&a.push(d("WAWebWidFactory").createDeviceWidFromUserAndDevice(b.user,b.server,c.id))})}catch(a){d("WALogger").WARN(h(),a).sendLogs(a.toString());return[d("WAWebWidFactory").createDeviceWidFromUserAndDevice(b.user,b.server,0)]}return a});return i.apply(this,arguments)}g.getPeerDevices=a}),98);
__d("WAWebKeyManagementSendKeyShareApi",["Promise","WALogger","WASyncdCryptoUtils","WASyncdKeyTypes","WAWebApiPeerMessageStore","WAWebKeyManagementUtils","WAWebMsgKey","WAWebSendAppStateSyncMsgJob","WAWebUserPrefsMeUser","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncd: send key share key id "," to peer deviceIds "," due to ",""]);i=function(){return a};return a}function a(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e,f;a.type==="key_rotation"?(e=k(a.keys),f=(yield d("WAWebKeyManagementUtils").getPeerDevices())):a.type==="missing_key"&&(e=k(a.keys,a.orphanKeys),f=[a.peerDeviceId]);if(f==null)return(h||(h=b("Promise"))).resolve();var g=f,j=g.map(function(a){var b=new(c("WAWebMsgKey"))({fromMe:!0,remote:d("WAWebUserPrefsMeUser").assertGetMeUser(),id:c("WAWebMsgKey").newId_DEPRECATED()});return{id:b,to:a,type:"protocol",subtype:"app_state_sync_key_share",appStateSyncKeyShare:e}});g=g.map(function(a){return a.getDeviceId()});var l=a.keys.map(function(a){return d("WASyncdCryptoUtils").syncKeyIdToHex(a.keyId)});d("WALogger").LOG(i(),l,g,a.type);yield d("WAWebApiPeerMessageStore").storePeerMessages(j);yield (h||(h=b("Promise"))).all(j.map(function(a){return d("WAWebSendAppStateSyncMsgJob").encryptAndSendKeyMsg(a)}))});return j.apply(this,arguments)}function k(a,b){a=a.map(function(a){return{keyId:{keyId:d("WASyncdKeyTypes").fromSyncKeyId(a.keyId)},keyData:{keyData:d("WASyncdKeyTypes").fromSyncKeyData(a.keyData),fingerprint:{rawId:a.fingerprint.rawId,currentIndex:a.fingerprint.currentIndex,deviceIndexes:a.fingerprint.deviceIndexes},timestamp:a.timestamp}}});if(b){b=b.map(function(a){return{keyId:{keyId:d("WASyncdKeyTypes").fromSyncKeyId(a)},keyData:void 0}});a=a.concat(b)}return{keys:a}}g.sendAppStateSyncKeyShare=a}),98);
__d("WAWebQRScreenKillswitches",["Promise","WALogger","WAWebBuildConstants","asyncToGeneratorRuntime","cr:5142","cr:5151","err","gkx"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["killswitch: Unable to query killswitches"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unable to query killswitch ",""]);j=function(){return a};return a}var k=Object.freeze({DESKTOP_UPSELL_MAC_QR_BANNER:"wa_web/logged_out_killswitches:desktop_upsell_mac_qr_banner",DESKTOP_UPSELL_WINDOWS_QR_BANNER:"wa_web/logged_out_killswitches:desktop_upsell_windows_qr_banner",DESKTOP_UPSELL_WINDOWS_QR_BANNER_VARIATION_2:"wa_web/logged_out_killswitches:desktop_upsell_windows_qr_banner_variation_2",DEVICE_LINKING_RESTORE_SETTINGS_INSTRUCTIONS:"wa_web/logged_out_killswitches:device_linking_restore_settings_instructions",ELECTRON_MAC_DEPRECATION_APPSTORE_BANNER_ENABLED:"wa_web/logged_out_killswitches:electron_mac_deprecation_appstore_banner_enabled",ELECTRON_MAC_DEPRECATION_APPSTORE_BANNER_EXPIRY_ENABLED:"wa_web/logged_out_killswitches:electron_mac_deprecation_appstore_banner_expiry_enabled",ELECTRON_MAC_DEPRECATION_APPSTORE_BANNER_EXPIRY_OFFSET:"wa_web/logged_out_killswitches:electron_mac_deprecation_appstore_banner_expiry_offset",ELECTRON_MAC_DEPRECATION_BANNER_ENABLED:"wa_web/logged_out_killswitches:electron_mac_deprecation_banner_enabled",ELECTRON_MAC_DEPRECATION_BANNER_EXPIRY_ENABLED:"wa_web/logged_out_killswitches:electron_mac_deprecation_banner_expiry_enabled",ELECTRON_MAC_DEPRECATION_BANNER_EXPIRY_OFFSET:"wa_web/logged_out_killswitches:electron_mac_deprecation_banner_expiry_offset",ELECTRON_MAC_UNSUPPORTED_OS_DISABLE_AUTOUPDATE:"wa_web/logged_out_killswitches:electron_mac_unsupported_os_disable_autoupdate",SW_UNREGISTER_KILLSWITCH:"wa_web/sw_killswitches:sw_unregister_killswitch",SW_PUSH_UNSUBSCRIBE_KILLSWITCH:"wa_web/sw_killswitches:sw_push_unsubscribe_killswitch",SW_HEARTBEAT_KILLSWITCH:"wa_web/sw_killswitches:sw_heartbeat_killswitch",DB_ROLLOUT_VERSION_MODEL_STORAGE:"wa_web/db_rollout_version:model-storage",DB_ROLLOUT_VERSION_FTS_STORAGE:"wa_web/db_rollout_version:fts-storage",DB_ROLLOUT_VERSION_JOBS_STORAGE:"wa_web/db_rollout_version:jobs-storage",DB_ROLLOUT_VERSION_LRU_MEDIA_STORAGE:"wa_web/db_rollout_version:lru-media-storage-idb",DB_ROLLOUT_VERSION_OFFD_STORAGE:"wa_web/db_rollout_version:offd-storage",DB_ROLLOUT_VERSION_QPL_STORAGE:"wa_web/db_rollout_version:qpl-storage",DB_ROLLOUT_VERSION_SIGNAL_STORAGE:"wa_web/db_rollout_version:signal-storage",DB_ROLLOUT_VERSION_WORKER_STORAGE:"wa_web/db_rollout_version:worker-storage",DB_ROLLOUT_VERSION_SW:"wa_web/db_rollout_version_1_based:sw",DB_ROLLOUT_VERSION_WAWC:"wa_web/db_rollout_version_1_based:wawc",DB_ROLLOUT_VERSION_WAWC_DB_ENC:"wa_web/db_rollout_version_1_based:wawc_db_enc",DB_ROLLOUT_KILLSWITCH:"wa_web/db_rollout_version:db_rollout_killswitch"}),l=!1,m={},n=null;function o(){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield n;return l});return p.apply(this,arguments)}function a(a){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(!c("gkx")("26258")){var b=v();b=b==null?void 0:b.get(a);if(b!=null)return b}try{yield n;return(b=m[a])!=null?b:null}catch(b){d("WALogger").LOG(j(),a).devConsole(b);return null}});return q.apply(this,arguments)}function e(){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield o());if(a)return!0;yield s();return o()});return r.apply(this,arguments)}function s(){if(n)return n;n=new(h||(h=b("Promise")))(function(a){t().then(function(){a(),n=null})});return n}function t(){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{var a=(yield self.fetch(d("WAWebBuildConstants").DYN_ORIGIN+"killswitch/",{credentials:"include"}));a=(yield a.json());a&&typeof a==="object"&&(m=a,l=!0)}catch(a){d("WALogger").ERROR(i()).tags("non-sad").sendLogs("killswitch: Unable to query killswitches",.001)}});return u.apply(this,arguments)}function f(a,d){if(!c("gkx")("26258")){var e;if(Object.prototype.hasOwnProperty.call(k,a))e=k[a];else if(Object.values(k).includes(a))e=a;else throw c("err")("Invalid killswitch name: "+a);a=v();a==null?void 0:a.set(e,d);b("cr:5142")&&b("cr:5151")&&a&&b("cr:5142").set(b("cr:5151").QR_KILLSWITCH_OVERRIDE,Array.from(a.entries()))}}function v(){if(!c("gkx")("26258")&&b("cr:5142")&&b("cr:5151")){var a=b("cr:5142").get(b("cr:5151").QR_KILLSWITCH_OVERRIDE);return new Map(a)}return null}g.Killswitch=k;g.didSuccessfulyFetchKillSwitchValues=o;g.getKillswitchValue=a;g.fetchKillswitchValuesAtLeastOnce=e;g.fetchKillswitchValues=s;g.setKillswitchOverride=f;g.getKillswitchOverridesMap=v}),98);
__d("WAWebSimpleSearch",["WAWebL10N","WAWebL10NFbtTypeUtils"],(function(a,b,c,d,e,f,g){function a(a,b){if(a==null||a==="")return!1;a=h(a);var c=b.map(h).flat();return a.every(function(a){return c.some(function(b){return b==null?void 0:b.startsWith(a)})})}function h(a){if(a==null)return[];a=d("WAWebL10NFbtTypeUtils").toProductionString(c("WAWebL10N").accentFold((a=a.toLocaleLowerCase("en"))==null?void 0:a.normalize("NFKD")));return a.split(" ")}g.simpleSearch=a}),98);
__d("WAWebWamQrCodeCount",[],(function(a,b,c,d,e,f){a=function(){function a(){this.$1=!1,this.$2=0}var b=a.prototype;b.get=function(){return this.$2};b.$3=function(){this.$1&&(this.$1=!1,this.$2=0,this.initialDisplayDate=null)};b.inc=function(){this.$3();return this.set(this.$2+1)};b.set=function(a){this.$3();if(this.$2===a)return;a===1&&(this.initialDisplayDate=g());this.$2=a;return this.get()};b.reset=function(){this.$1=!0};return a}();b=new a();function g(){return Math.floor(window.performance.now())}f["default"]=b}),66);
__d("WAWebWamEnumWebcNativeUpsellCtaEventType",[],(function(a,b,c,d,e,f){a=Object.freeze({IMPRESSION:1,CTA_BTN_CLICK:2,CTA_DISMISS:3});f.WEBC_NATIVE_UPSELL_CTA_EVENT_TYPE=a}),66);
__d("WAWebWamEnumWebcNativeUpsellCtaSourceType",[],(function(a,b,c,d,e,f){a=Object.freeze({INTRO_PANEL:1,CHATLIST_DROPDOWN:2,BUTTERBAR:3,QR_BANNER:4,SEARCH_RESULTS:5,CALL_BTN_MODAL:6,CALL_BTN_MODAL_2:7,MISSED_CALL_MODAL:8,MISSED_CALL_MODAL_2:9,QR_BANNER_2:10});f.WEBC_NATIVE_UPSELL_CTA_SOURCE_TYPE=a}),66);
__d("WAWebWebcNativeUpsellCtaWamEvent",["WAWebWamCodegenUtils","WAWebWamEnumWebcNativeUpsellCtaEventType","WAWebWamEnumWebcNativeUpsellCtaSourceType"],(function(a,b,c,d,e,f,g){a=d("WAWebWamCodegenUtils").defineEvents({WebcNativeUpsellCta:[3934,{webcNativeUpsellCtaEventType:[2,d("WAWebWamEnumWebcNativeUpsellCtaEventType").WEBC_NATIVE_UPSELL_CTA_EVENT_TYPE],webcNativeUpsellCtaSource:[1,d("WAWebWamEnumWebcNativeUpsellCtaSourceType").WEBC_NATIVE_UPSELL_CTA_SOURCE_TYPE]},[1,1,1],"regular"]});g.WebcNativeUpsellCtaWamEvent=a}),98);
__d("WAWebDesktopUpsellUtils",["$InternalEnum","Promise","WAWebMiscBrowserUtils","gkx"],(function(a,b,c,d,e,f,g){var h,i=b("$InternalEnum").Mirrored(["WINDOWS","MACOS"]),j;function a(){if(j!==void 0)return j;j=k();return j}function k(){var a=c("WAWebMiscBrowserUtils").info();switch(a.os.toLowerCase()){case"windows":return i.WINDOWS;case"mac os":return i.MACOS}return null}var l="8.0.0",m=10,n="11.0.0",o=null,p=null;function d(){o==null&&q();return o}function q(){if(o!=null)return(h||(h=b("Promise"))).resolve(o);if(c("gkx")("26254")){var a;return(h||(h=b("Promise"))).resolve((a=self.navigator)==null?void 0:(a=a.userAgentData)==null?void 0:a.getHighEntropyValues(["platformVersion"])).then(function(a){var b;if((a==null?void 0:a.platformVersion)!=null&&((b=a.platform)==null?void 0:b.toLowerCase())==="windows"&&a.platformVersion!=null)o=s(l,a.platformVersion)<=0;else{b=c("WAWebMiscBrowserUtils").info();o=b.os==="Windows"&&parseInt(b.version,10)>=m}return o})}o=!1;return(h||(h=b("Promise"))).resolve(o)}function e(){p==null&&r();return p}function r(){if(p!=null)return(h||(h=b("Promise"))).resolve(p);if(c("gkx")("26254")){var a;return(h||(h=b("Promise"))).resolve((a=self.navigator)==null?void 0:(a=a.userAgentData)==null?void 0:a.getHighEntropyValues(["platformVersion"])).then(function(a){var b;(a==null?void 0:a.platformVersion)!=null&&((b=a.platform)==null?void 0:b.toLowerCase())==="macos"&&a.platformVersion!=null&&(p=s(n,a.platformVersion)<=0);return(b=p)!=null?b:!0})}p=!1;return(h||(h=b("Promise"))).resolve(p)}function s(a,b){return a.localeCompare(b,void 0,{numeric:!0,sensitivity:"base"})}g.UserDesktopOs=i;g.getUserDesktopOs=a;g.isWebUserOnSupportedWindowsOSForUWPSync=d;g.isWebUserOnSupportedWindowsOSForUWPAsync=q;g.isWebUserOnSupportedMacOSForCatalystSync=e;g.isWebUserOnSupportedMacOSForCatalystAsync=r;g.compareOSVersions=s}),98);
__d("WAWebDesktopUpsellCommonStrings",["fbt","WAWebDesktopUpsellUtils"],(function(a,b,c,d,e,f,g,h){function i(){return h._("__JHASH__GEHid_9pEVd__JHASH__")}function a(){var a=d("WAWebDesktopUpsellUtils").getUserDesktopOs();if(a==null)return i();switch(a){case d("WAWebDesktopUpsellUtils").UserDesktopOs.WINDOWS:return h._("__JHASH__rC2HRs59RmS__JHASH__");case d("WAWebDesktopUpsellUtils").UserDesktopOs.MACOS:return h._("__JHASH__d6p6HtM4eUU__JHASH__")}}function b(){var a=d("WAWebDesktopUpsellUtils").getUserDesktopOs();if(a==null)return null;switch(a){case d("WAWebDesktopUpsellUtils").UserDesktopOs.WINDOWS:return h._("__JHASH__n3o2fcEc9G8__JHASH__");case d("WAWebDesktopUpsellUtils").UserDesktopOs.MACOS:return h._("__JHASH__t2CGfHP81Kr__JHASH__")}}function c(){var a=d("WAWebDesktopUpsellUtils").getUserDesktopOs();if(a==null)return null;switch(a){case d("WAWebDesktopUpsellUtils").UserDesktopOs.WINDOWS:return h._("__JHASH__tHU5OBil2Oj__JHASH__");case d("WAWebDesktopUpsellUtils").UserDesktopOs.MACOS:return h._("__JHASH__B_eZI3rPVqn__JHASH__")}}function e(){var a=d("WAWebDesktopUpsellUtils").getUserDesktopOs();if(a==null)return null;switch(a){case d("WAWebDesktopUpsellUtils").UserDesktopOs.WINDOWS:return h._("__JHASH__z4K4p8lhv2M__JHASH__");case d("WAWebDesktopUpsellUtils").UserDesktopOs.MACOS:return h._("__JHASH__7MyvSxvKu6x__JHASH__")}}function f(){var a=d("WAWebDesktopUpsellUtils").getUserDesktopOs();if(a==null)return null;switch(a){case d("WAWebDesktopUpsellUtils").UserDesktopOs.WINDOWS:return h._("__JHASH__MZCxEzinlb4__JHASH__");case d("WAWebDesktopUpsellUtils").UserDesktopOs.MACOS:return h._("__JHASH__nC2Py9FY80M__JHASH__")}}g.getDesktopAppDownloadBtnLabel=i;g.getDesktopAppDownloadFromStoreBtnLabel=a;g.getChatlistDropdownBtnLabel=b;g.getDesktopUpsellToastbarLabel=c;g.getDesktopUpsellDownloadWhatsAppTitle=e;g.getDesktopUpsellIntroPanelText=f}),98);
__d("useWAWebABPropConfigValue",["WAWebABProps","WAWebCmd","useWAWebEventTargetValue"],(function(a,b,c,d,e,f,g){function a(a){var b=c("useWAWebEventTargetValue")(d("WAWebCmd").Cmd,"on_ab_props_update",function(){return d("WAWebABProps").getABPropConfigValue(a)},[a]);return b}g.useABPropConfigValue=a}),98);
__d("WAWebDesktopUpsellPlatformAwareHooks",["WAWebDesktopUpsellUtils","WAWebMobilePlatforms","gkx","useWAWebABPropConfigValue","useWAWebAsync"],(function(a,b,c,d,e,f,g){var h={chatlist_toastbar:"desktop_upsell_win_cta_chatlist_toastbar",chatlist_dropdown:"desktop_upsell_win_cta_chatlist_dropdown",intro_panel:"desktop_upsell_win_cta_intro_panel",call_btn:"desktop_upsell_win_cta_call_btn",search_results:"desktop_upsell_win_cta_search_results_toastbar",missed_call:"desktop_upsell_win_cta_missed_call_variation_2"},i={chatlist_toastbar:"desktop_upsell_mac_cta_chatlist_toastbar",chatlist_dropdown:"desktop_upsell_mac_cta_chatlist_dropdown",intro_panel:"desktop_upsell_mac_cta_intro_panel",call_btn:"desktop_upsell_mac_cta_call_btn",search_results:"desktop_upsell_mac_cta_search_results_toastbar",missed_call:"desktop_upsell_mac_cta_missed_call"};function a(a){var b=d("WAWebDesktopUpsellUtils").getUserDesktopOs();b=d("useWAWebABPropConfigValue").useABPropConfigValue(b===d("WAWebDesktopUpsellUtils").UserDesktopOs.WINDOWS?h[a]:i[a]);return b}function b(){var a=d("WAWebDesktopUpsellUtils").getUserDesktopOs();a=j(a);return!d("WAWebMobilePlatforms").isSMB()&&a}function e(){var a=d("WAWebDesktopUpsellUtils").getUserDesktopOs(),b=!1;if(a===d("WAWebDesktopUpsellUtils").UserDesktopOs.WINDOWS){var c;b=(c=d("WAWebDesktopUpsellUtils").isWebUserOnSupportedWindowsOSForUWPSync())!=null?c:!1}else if(a===d("WAWebDesktopUpsellUtils").UserDesktopOs.MACOS){b=(c=d("WAWebDesktopUpsellUtils").isWebUserOnSupportedMacOSForCatalystSync())!=null?c:!1}return!d("WAWebMobilePlatforms").isSMB()&&b}function j(a){var b=c("useWAWebAsync")(d("WAWebDesktopUpsellUtils").isWebUserOnSupportedWindowsOSForUWPAsync,[]),e=c("useWAWebAsync")(d("WAWebDesktopUpsellUtils").isWebUserOnSupportedMacOSForCatalystAsync,[]);if(!c("gkx")("26254")||a==null)return null;else if(a===d("WAWebDesktopUpsellUtils").UserDesktopOs.WINDOWS&&!b.loading&&!b.error)return b.value;else if(a===d("WAWebDesktopUpsellUtils").UserDesktopOs.MACOS&&!e.loading&&!e.error)return e.value;return!1}g.useWAWebDesktopUpsellAbPropCheck=a;g.useWAWebDesktopUpsellPlatformCheck=b;g.useWAWebDesktopUpsellPlatformAwareCTACheckSynchronous=e;g.useWAWebDesktopUpsellPlatformAwareOsVersionCheck=j}),98);
__d("WAWebDesktopUpsellStoreOpener",["WALogger","WAWebDesktopUpsellUtils","WAWebExternalLink.react","WAWebWamEnumWebcNativeUpsellCtaEventType","WAWebWamEnumWebcNativeUpsellCtaSourceType","WAWebWebcNativeUpsellCtaWamEvent","gkx"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["web-desktop-upsells: Failed to open Mac App Store app with error: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["web-desktop-upsells: Failed to open MS Store app with error: ",""]);i=function(){return a};return a}function a(a){var b=d("WAWebDesktopUpsellUtils").getUserDesktopOs();b===d("WAWebDesktopUpsellUtils").UserDesktopOs.WINDOWS?j(a):b===d("WAWebDesktopUpsellUtils").UserDesktopOs.MACOS&&l();void new(d("WAWebWebcNativeUpsellCtaWamEvent").WebcNativeUpsellCtaWamEvent)({webcNativeUpsellCtaEventType:d("WAWebWamEnumWebcNativeUpsellCtaEventType").WEBC_NATIVE_UPSELL_CTA_EVENT_TYPE.CTA_BTN_CLICK,webcNativeUpsellCtaSource:a}).commitAndWaitForFlush(!0)}function j(a){try{d("WAWebExternalLink.react").openExternalLink(k(a),{target:d("WAWebExternalLink.react").ExternalLinkTarget.DEEPLINK_IN_CURRENT_TAB})}catch(a){d("WALogger").ERROR(i(),a)}}function k(a){switch(a){case d("WAWebWamEnumWebcNativeUpsellCtaSourceType").WEBC_NATIVE_UPSELL_CTA_SOURCE_TYPE.QR_BANNER:return d("WAWebExternalLink.react").WINDOWS_STORE_URIS.link_device_banner;case d("WAWebWamEnumWebcNativeUpsellCtaSourceType").WEBC_NATIVE_UPSELL_CTA_SOURCE_TYPE.QR_BANNER_2:return d("WAWebExternalLink.react").WINDOWS_STORE_URIS.link_device_banner_2;case d("WAWebWamEnumWebcNativeUpsellCtaSourceType").WEBC_NATIVE_UPSELL_CTA_SOURCE_TYPE.INTRO_PANEL:return d("WAWebExternalLink.react").WINDOWS_STORE_URIS.intro_panel;case d("WAWebWamEnumWebcNativeUpsellCtaSourceType").WEBC_NATIVE_UPSELL_CTA_SOURCE_TYPE.BUTTERBAR:return d("WAWebExternalLink.react").WINDOWS_STORE_URIS.chatlist_toastbar;case d("WAWebWamEnumWebcNativeUpsellCtaSourceType").WEBC_NATIVE_UPSELL_CTA_SOURCE_TYPE.SEARCH_RESULTS:return d("WAWebExternalLink.react").WINDOWS_STORE_URIS.search_results_toastbar;case d("WAWebWamEnumWebcNativeUpsellCtaSourceType").WEBC_NATIVE_UPSELL_CTA_SOURCE_TYPE.CALL_BTN_MODAL:return d("WAWebExternalLink.react").WINDOWS_STORE_URIS.call_btn_modal;case d("WAWebWamEnumWebcNativeUpsellCtaSourceType").WEBC_NATIVE_UPSELL_CTA_SOURCE_TYPE.CALL_BTN_MODAL_2:return d("WAWebExternalLink.react").WINDOWS_STORE_URIS.call_btn_modal_2;case d("WAWebWamEnumWebcNativeUpsellCtaSourceType").WEBC_NATIVE_UPSELL_CTA_SOURCE_TYPE.CHATLIST_DROPDOWN:return d("WAWebExternalLink.react").WINDOWS_STORE_URIS.chatlist_dropdown_menu;case d("WAWebWamEnumWebcNativeUpsellCtaSourceType").WEBC_NATIVE_UPSELL_CTA_SOURCE_TYPE.MISSED_CALL_MODAL:return d("WAWebExternalLink.react").WINDOWS_STORE_URIS.missed_call_modal;case d("WAWebWamEnumWebcNativeUpsellCtaSourceType").WEBC_NATIVE_UPSELL_CTA_SOURCE_TYPE.MISSED_CALL_MODAL_2:return d("WAWebExternalLink.react").WINDOWS_STORE_URIS.missed_call_modal_2}a=new Error("Invalid CTA source: "+a);a.stack;throw a}function l(){try{d("WAWebExternalLink.react").openExternalLink(c("gkx")("26258")?d("WAWebExternalLink.react").MAC_EXTERNAL_APP_STORE_URI:d("WAWebExternalLink.react").MAC_INTERNAL_MSC_STORE_URI,{target:d("WAWebExternalLink.react").ExternalLinkTarget.DEEPLINK_IN_CURRENT_TAB})}catch(a){d("WALogger").ERROR(h(),a)}}g.openExternalWhatsAppDesktopDownloadUrl=a}),98);
__d("useWAWebDesktopUpsellWamImpression",["WAWebWamEnumWebcNativeUpsellCtaEventType","WAWebWebcNativeUpsellCtaWamEvent","react","useWAWebCallbackOnce"],(function(a,b,c,d,e,f,g){var h,i=(h||d("react")).useEffect;function a(a){var b=a.source,e=a.isCtaVisible,f=c("useWAWebCallbackOnce")(function(){new(d("WAWebWebcNativeUpsellCtaWamEvent").WebcNativeUpsellCtaWamEvent)({webcNativeUpsellCtaEventType:d("WAWebWamEnumWebcNativeUpsellCtaEventType").WEBC_NATIVE_UPSELL_CTA_EVENT_TYPE.IMPRESSION,webcNativeUpsellCtaSource:b}).commit()});i(function(){e&&f()},[f,e])}g.useWAWebDesktopUpsellWamImpression=a}),98);
__d("WAWebScreenLockErrorMessages",["fbt"],(function(a,b,c,d,e,f,g,h){function a(a){var b=a.onlyOneTryRemaining,c=a.emptyInputEntered,d=a.incorrectPasscode;a=a.triesExceeded;if(a)return h._("__JHASH__q4w-uv0JWqj__JHASH__");if(b){if(c==null)return h._("__JHASH__q7F26xYANt0__JHASH__");else if(c===!0)return h._("__JHASH__QmzqwUIikqb__JHASH__");if(d&&c===!1)return h._("__JHASH__atCNm2dlCEH__JHASH__")}if(c===!0)return h._("__JHASH__zY0EnLoQ16i__JHASH__");if(d)return h._("__JHASH__nGj64Jk-qZU__JHASH__")}g.getErrorMessage=a}),98);
__d("WAWeb-qrcode",[],(function(a,b,c,d,e,f){var g;(function(){function a(a){this.mode=c.MODE_8BIT_BYTE;this.data=a;this.parsedData=[];if(a instanceof ArrayBuffer){this.parsedData=new Int8Array(a);return}for(var a=0,b=this.data.length;a<b;a++){var d=[],e=this.data.charCodeAt(a);e>65536?(d[0]=240|(e&1835008)>>>18,d[1]=128|(e&258048)>>>12,d[2]=128|(e&4032)>>>6,d[3]=128|e&63):e>2048?(d[0]=224|(e&61440)>>>12,d[1]=128|(e&4032)>>>6,d[2]=128|e&63):e>128?(d[0]=192|(e&1984)>>>6,d[1]=128|e&63):d[0]=e;this.parsedData.push(d)}this.parsedData=Array.prototype.concat.apply([],this.parsedData);this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}a.prototype={getLength:function(a){return this.parsedData.length},write:function(b){for(var a=0,c=this.parsedData.length;a<c;a++)b.put(this.parsedData[a],8)}};function b(a,b){this.typeNumber=a,this.errorCorrectLevel=b,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}b.prototype={addData:function(b){b=new a(b);this.dataList.push(b);this.dataCache=null},isDark:function(a,b){if(a<0||this.moduleCount<=a||b<0||this.moduleCount<=b)throw new Error(a+","+b);return this.modules[a][b]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(a,c){this.moduleCount=this.typeNumber*4+17;this.modules=new Array(this.moduleCount);for(var d=0;d<this.moduleCount;d++){this.modules[d]=new Array(this.moduleCount);for(var e=0;e<this.moduleCount;e++)this.modules[d][e]=null}this.setupPositionProbePattern(0,0);this.setupPositionProbePattern(this.moduleCount-7,0);this.setupPositionProbePattern(0,this.moduleCount-7);this.setupPositionAdjustPattern();this.setupTimingPattern();this.setupTypeInfo(a,c);this.typeNumber>=7&&this.setupTypeNumber(a);this.dataCache==null&&(this.dataCache=b.createData(this.typeNumber,this.errorCorrectLevel,this.dataList));this.mapData(this.dataCache,c)},setupPositionProbePattern:function(a,b){for(var c=-1;c<=7;c++){if(a+c<=-1||this.moduleCount<=a+c)continue;for(var d=-1;d<=7;d++){if(b+d<=-1||this.moduleCount<=b+d)continue;0<=c&&c<=6&&(d==0||d==6)||0<=d&&d<=6&&(c==0||c==6)||2<=c&&c<=4&&2<=d&&d<=4?this.modules[a+c][b+d]=!0:this.modules[a+c][b+d]=!1}}},getBestMaskPattern:function(){var b=0,c=0;for(var a=0;a<8;a++){this.makeImpl(!0,a);var d=f.getLostPoint(this);(a==0||b>d)&&(b=d,c=a)}return c},createMovieClip:function(a,b,c){a=a.createEmptyMovieClip(b,c);b=1;this.make();for(c=0;c<this.modules.length;c++){var d=c*b;for(var e=0;e<this.modules[c].length;e++){var f=e*b,g=this.modules[c][e];g&&(a.beginFill(0,100),a.moveTo(f,d),a.lineTo(f+b,d),a.lineTo(f+b,d+b),a.lineTo(f,d+b),a.endFill())}}return a},setupTimingPattern:function(){for(var a=8;a<this.moduleCount-8;a++){if(this.modules[a][6]!=null)continue;this.modules[a][6]=a%2==0}for(a=8;a<this.moduleCount-8;a++){if(this.modules[6][a]!=null)continue;this.modules[6][a]=a%2==0}},setupPositionAdjustPattern:function(){var b=f.getPatternPosition(this.typeNumber);for(var a=0;a<b.length;a++)for(var c=0;c<b.length;c++){var d=b[a],e=b[c];if(this.modules[d][e]!=null)continue;for(var g=-2;g<=2;g++)for(var h=-2;h<=2;h++)g==-2||g==2||h==-2||h==2||g==0&&h==0?this.modules[d+g][e+h]=!0:this.modules[d+g][e+h]=!1}},setupTypeNumber:function(b){var c=f.getBCHTypeNumber(this.typeNumber);for(var a=0;a<18;a++){var d=!b&&(c>>a&1)==1;this.modules[Math.floor(a/3)][a%3+this.moduleCount-8-3]=d}for(var a=0;a<18;a++){var d=!b&&(c>>a&1)==1;this.modules[a%3+this.moduleCount-8-3][Math.floor(a/3)]=d}},setupTypeInfo:function(b,c){c=this.errorCorrectLevel<<3|c;c=f.getBCHTypeInfo(c);for(var a=0;a<15;a++){var d=!b&&(c>>a&1)==1;a<6?this.modules[a][8]=d:a<8?this.modules[a+1][8]=d:this.modules[this.moduleCount-15+a][8]=d}for(var a=0;a<15;a++){var d=!b&&(c>>a&1)==1;a<8?this.modules[8][this.moduleCount-a-1]=d:a<9?this.modules[8][15-a-1+1]=d:this.modules[8][15-a-1]=d}this.modules[this.moduleCount-8][8]=!b},mapData:function(a,b){var c=-1,d=this.moduleCount-1,e=7,g=0;for(var h=this.moduleCount-1;h>0;h-=2){h==6&&h--;while(!0){for(var i=0;i<2;i++)if(this.modules[d][h-i]==null){var j=!1;g<a.length&&(j=(a[g]>>>e&1)==1);var k=f.getMask(b,d,h-i);k&&(j=!j);this.modules[d][h-i]=j;e--;e==-1&&(g++,e=7)}d+=c;if(d<0||this.moduleCount<=d){d-=c;c=-c;break}}}}};b.PAD0=236;b.PAD1=17;b.createData=function(c,d,e){d=k.getRSBlocks(c,d);var g=new l();for(var a=0;a<e.length;a++){var h=e[a];g.put(h.mode,4);g.put(h.getLength(),f.getLengthInBits(h.mode,c));h.write(g)}h=0;for(var a=0;a<d.length;a++)h+=d[a].dataCount;if(g.getLengthInBits()>h*8)throw new Error("code length overflow. ("+g.getLengthInBits()+">"+h*8+")");g.getLengthInBits()+4<=h*8&&g.put(0,4);while(g.getLengthInBits()%8!=0)g.putBit(!1);while(!0){if(g.getLengthInBits()>=h*8)break;g.put(b.PAD0,8);if(g.getLengthInBits()>=h*8)break;g.put(b.PAD1,8)}return b.createBytes(g,d)};b.createBytes=function(b,c){var d=0,e=0,g=0,h=new Array(c.length),k=new Array(c.length);for(var l=0;l<c.length;l++){var m=c[l].dataCount,n=c[l].totalCount-m;e=Math.max(e,m);g=Math.max(g,n);h[l]=new Array(m);for(var a=0;a<h[l].length;a++)h[l][a]=255&b.buffer[a+d];d+=m;m=f.getErrorCorrectPolynomial(n);n=new j(h[l],m.getLength()-1);n=n.mod(m);k[l]=new Array(m.getLength()-1);for(var a=0;a<k[l].length;a++){m=a+n.getLength()-k[l].length;k[l][a]=m>=0?n.get(m):0}}m=0;for(var a=0;a<c.length;a++)m+=c[a].totalCount;n=new Array(m);b=0;for(var a=0;a<e;a++)for(var l=0;l<c.length;l++)a<h[l].length&&(n[b++]=h[l][a]);for(var a=0;a<g;a++)for(var l=0;l<c.length;l++)a<k[l].length&&(n[b++]=k[l][a]);return n};var c={MODE_NUMBER:1<<0,MODE_ALPHA_NUM:1<<1,MODE_8BIT_BYTE:1<<2,MODE_KANJI:1<<3},d={L:1,M:0,Q:3,H:2},e={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},f={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1<<10|1<<8|1<<5|1<<4|1<<2|1<<1|1<<0,G18:1<<12|1<<11|1<<10|1<<9|1<<8|1<<5|1<<2|1<<0,G15_MASK:1<<14|1<<12|1<<10|1<<4|1<<1,getBCHTypeInfo:function(a){var b=a<<10;while(f.getBCHDigit(b)-f.getBCHDigit(f.G15)>=0)b^=f.G15<<f.getBCHDigit(b)-f.getBCHDigit(f.G15);return(a<<10|b)^f.G15_MASK},getBCHTypeNumber:function(a){var b=a<<12;while(f.getBCHDigit(b)-f.getBCHDigit(f.G18)>=0)b^=f.G18<<f.getBCHDigit(b)-f.getBCHDigit(f.G18);return a<<12|b},getBCHDigit:function(a){var b=0;while(a!=0)b++,a>>>=1;return b},getPatternPosition:function(a){return f.PATTERN_POSITION_TABLE[a-1]},getMask:function(b,a,c){switch(b){case e.PATTERN000:return(a+c)%2==0;case e.PATTERN001:return a%2==0;case e.PATTERN010:return c%3==0;case e.PATTERN011:return(a+c)%3==0;case e.PATTERN100:return(Math.floor(a/2)+Math.floor(c/3))%2==0;case e.PATTERN101:return a*c%2+a*c%3==0;case e.PATTERN110:return(a*c%2+a*c%3)%2==0;case e.PATTERN111:return(a*c%3+(a+c)%2)%2==0;default:throw new Error("bad maskPattern:"+b)}},getErrorCorrectPolynomial:function(b){var c=new j([1],0);for(var a=0;a<b;a++)c=c.multiply(new j([1,h.gexp(a)],0));return c},getLengthInBits:function(a,b){if(1<=b&&b<10)switch(a){case c.MODE_NUMBER:return 10;case c.MODE_ALPHA_NUM:return 9;case c.MODE_8BIT_BYTE:return 8;case c.MODE_KANJI:return 8;default:throw new Error("mode:"+a)}else if(b<27)switch(a){case c.MODE_NUMBER:return 12;case c.MODE_ALPHA_NUM:return 11;case c.MODE_8BIT_BYTE:return 16;case c.MODE_KANJI:return 10;default:throw new Error("mode:"+a)}else if(b<41)switch(a){case c.MODE_NUMBER:return 14;case c.MODE_ALPHA_NUM:return 13;case c.MODE_8BIT_BYTE:return 16;case c.MODE_KANJI:return 12;default:throw new Error("mode:"+a)}else throw new Error("type:"+b)},getLostPoint:function(a){var b=a.getModuleCount(),c=0;for(var d=0;d<b;d++)for(var e=0;e<b;e++){var f=0,g=a.isDark(d,e);for(var h=-1;h<=1;h++){if(d+h<0||b<=d+h)continue;for(var i=-1;i<=1;i++){if(e+i<0||b<=e+i)continue;if(h==0&&i==0)continue;g==a.isDark(d+h,e+i)&&f++}}f>5&&(c+=3+f-5)}for(var d=0;d<b-1;d++)for(var e=0;e<b-1;e++){i=0;a.isDark(d,e)&&i++;a.isDark(d+1,e)&&i++;a.isDark(d,e+1)&&i++;a.isDark(d+1,e+1)&&i++;(i==0||i==4)&&(c+=3)}for(var d=0;d<b;d++)for(var e=0;e<b-6;e++)a.isDark(d,e)&&!a.isDark(d,e+1)&&a.isDark(d,e+2)&&a.isDark(d,e+3)&&a.isDark(d,e+4)&&!a.isDark(d,e+5)&&a.isDark(d,e+6)&&(c+=40);for(var e=0;e<b;e++)for(var d=0;d<b-6;d++)a.isDark(d,e)&&!a.isDark(d+1,e)&&a.isDark(d+2,e)&&a.isDark(d+3,e)&&a.isDark(d+4,e)&&!a.isDark(d+5,e)&&a.isDark(d+6,e)&&(c+=40);g=0;for(var e=0;e<b;e++)for(var d=0;d<b;d++)a.isDark(d,e)&&g++;h=Math.abs(100*g/b/b-50)/5;c+=h*10;return c}},h={glog:function(a){if(a<1)throw new Error("glog("+a+")");return h.LOG_TABLE[a]},gexp:function(a){while(a<0)a+=255;while(a>=256)a-=255;return h.EXP_TABLE[a]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)};for(var i=0;i<8;i++)h.EXP_TABLE[i]=1<<i;for(var i=8;i<256;i++)h.EXP_TABLE[i]=h.EXP_TABLE[i-4]^h.EXP_TABLE[i-5]^h.EXP_TABLE[i-6]^h.EXP_TABLE[i-8];for(var i=0;i<255;i++)h.LOG_TABLE[h.EXP_TABLE[i]]=i;function j(a,b){if(a.length==void 0)throw new Error(a.length+"/"+b);var c=0;while(c<a.length&&a[c]==0)c++;this.num=new Array(a.length-c+b);for(b=0;b<a.length-c;b++)this.num[b]=a[b+c]}j.prototype={get:function(a){return this.num[a]},getLength:function(){return this.num.length},multiply:function(b){var c=new Array(this.getLength()+b.getLength()-1);for(var a=0;a<this.getLength();a++)for(var d=0;d<b.getLength();d++)c[a+d]^=h.gexp(h.glog(this.get(a))+h.glog(b.get(d)));return new j(c,0)},mod:function(b){if(this.getLength()-b.getLength()<0)return this;var c=h.glog(this.get(0))-h.glog(b.get(0)),d=new Array(this.getLength());for(var a=0;a<this.getLength();a++)d[a]=this.get(a);for(var a=0;a<b.getLength();a++)d[a]^=h.gexp(h.glog(b.get(a))+c);return new j(d,0).mod(b)}};function k(a,b){this.totalCount=a,this.dataCount=b}k.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]];k.getRSBlocks=function(b,c){var d=k.getRsBlockTable(b,c);if(d==void 0)throw new Error("bad rs block @ typeNumber:"+b+"/errorCorrectLevel:"+c);b=d.length/3;c=[];for(var a=0;a<b;a++){var e=d[a*3+0],f=d[a*3+1],g=d[a*3+2];for(var h=0;h<e;h++)c.push(new k(f,g))}return c};k.getRsBlockTable=function(a,b){switch(b){case d.L:return k.RS_BLOCK_TABLE[(a-1)*4+0];case d.M:return k.RS_BLOCK_TABLE[(a-1)*4+1];case d.Q:return k.RS_BLOCK_TABLE[(a-1)*4+2];case d.H:return k.RS_BLOCK_TABLE[(a-1)*4+3];default:return void 0}};function l(){this.buffer=[],this.length=0}l.prototype={get:function(a){var b=Math.floor(a/8);return(this.buffer[b]>>>7-a%8&1)==1},put:function(b,c){for(var a=0;a<c;a++)this.putBit((b>>>c-a-1&1)==1)},getLengthInBits:function(){return this.length},putBit:function(a){var b=Math.floor(this.length/8);this.buffer.length<=b&&this.buffer.push(0);a&&(this.buffer[b]|=128>>>this.length%8);this.length++}};var m=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],n=function(a,b){this._bIsPainted=!1,this._htOption=b,this._elCanvas=document.createElement("canvas"),this._elCanvas.width=b.width,this._elCanvas.height=b.height,this._elCanvas.setAttribute("aria-label","Scan me!"),this._elCanvas.setAttribute("role","img"),a.appendChild(this._elCanvas),this._el=a,this._oContext=this._elCanvas.getContext("2d"),this._bIsPainted=!1,this._bSupportDataURI=null};n.prototype.draw=function(a){var b=this._oContext,c=this._htOption,d=a.getModuleCount(),e=c.width/d,f=c.height/d,g=Math.round(e),h=Math.round(f);this.clear();for(var i=0;i<d;i++)for(var j=0;j<d;j++){var k=a.isDark(i,j),l=j*e,m=i*f;b.strokeStyle=k?c.colorDark:c.colorLight;b.lineWidth=1;b.fillStyle=k?c.colorDark:c.colorLight;b.fillRect(l,m,e,f);b.strokeRect(Math.floor(l)+.5,Math.floor(m)+.5,g,h);b.strokeRect(Math.ceil(l)-.5,Math.ceil(m)-.5,g,h)}this._bIsPainted=!0};n.prototype.isPainted=function(){return this._bIsPainted};n.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1};n.prototype.round=function(a){return!a?a:Math.floor(a*1e3)/1e3};function o(b,c){var e=1;b=b instanceof ArrayBuffer?b.byteLength:p(b);for(var a=0,f=m.length;a<=f;a++){var g=0;switch(c){case d.L:g=m[a][0];break;case d.M:g=m[a][1];break;case d.Q:g=m[a][2];break;case d.H:g=m[a][3];break}if(b<=g)break;else e++}if(e>m.length)throw new Error("Too long data");return e}function p(a){var b=encodeURI(a).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return b.length+(b.length!=a.length?3:0)}g=function(b,c){this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:d.H};typeof c==="string"&&(c={text:c});if(c)for(var a in c)this._htOption[a]=c[a];typeof b=="string"&&(b=document.getElementById(b));this._el=b;this._oQRCode=null;this._oDrawing=new n(this._el,this._htOption);this._htOption.text&&this.makeCode(this._htOption.text)};g.prototype.makeCode=function(a){this._oQRCode=new b(o(a,this._htOption.correctLevel),this._htOption.correctLevel),this._oQRCode.addData(a),this._oQRCode.make(),this._el.title=a,this._oDrawing.draw(this._oQRCode)};g.prototype.clear=function(){this._oDrawing.clear()};g.CorrectLevel=d})();e.exports=g}),null);
__d("WAWebNotificationIcon",["WALogger","WAWebFbtCommon","WAWebL10N","gkx"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["WAWebNotificationIcon::setIcon"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["WAWebNotificationIcon::setTitleAndIcon"]);i=function(){return a};return a}var j;function a(a){d("WALogger").WARN(i());var b=[];a>0&&b.push("("+c("WAWebL10N").n(a)+")");!c("gkx")("26258")&&!c("gkx")("26257")&&b.push("WWW");b.push(c("WAWebFbtCommon")("WhatsApp").toString());var e=b.join(" ");window.clearTimeout(j);document.title=document.title+" ";j=window.setTimeout(function(){document.title=e},0)}function b(a){d("WALogger").WARN(h())}g.setTitleAndIcon=a;g.setIcon=b}),98);
__d("WAWebLinkDeviceEvents",["WAWebEventEmitter"],(function(a,b,c,d,e,f,g){a=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}var c=b.prototype;c.triggerRefreshAltLinkingCode=function(){this.trigger("link_device_events:refresh_alt_linking_code")};c.triggerErrorAltLinking=function(){this.trigger("link_device_events:error_alt_linking")};c.triggerPrimaryHelloReceived=function(){this.trigger("link_device_events:primary_hello_received")};return b}(c("WAWebEventEmitter"));b=new a();g.WAWebLinkDeviceEvents=b}),98);
__d("WAWebLinkDeviceAction",["WAWebAltDeviceLinkingApi","WAWebAltDeviceLinkingIq","WAWebCmd","WAWebLinkDeviceEvents","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(){return d("WAWebAltDeviceLinkingIq").genDoesServerEnableAltDeviceLinking()}function c(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WAWebCmd").Cmd.refreshQR(),a.linkDeviceMethod===d("WAWebAltDeviceLinkingApi").PairingType.ALT_DEVICE_LINKING?(yield d("WAWebAltDeviceLinkingApi").initializeAltDeviceLinking(),d("WAWebAltDeviceLinkingApi").setPairingType(d("WAWebAltDeviceLinkingApi").PairingType.ALT_DEVICE_LINKING)):(yield d("WAWebAltDeviceLinkingApi").initializeQRLinking(),d("WAWebAltDeviceLinkingApi").setPairingType(d("WAWebAltDeviceLinkingApi").PairingType.QR_CODE))});return h.apply(this,arguments)}function e(a,b){return d("WAWebAltDeviceLinkingApi").startAltLinkingFlow(a,b)}function f(a){d("WAWebLinkDeviceEvents").WAWebLinkDeviceEvents.trigger("link_device_events:refresh_alt_linking_code")}function i(a){d("WAWebLinkDeviceEvents").WAWebLinkDeviceEvents.trigger("link_device_events:force_manual_refresh")}function j(){d("WAWebLinkDeviceEvents").WAWebLinkDeviceEvents.trigger("link_device_events:error_alt_linking")}function k(){d("WAWebLinkDeviceEvents").WAWebLinkDeviceEvents.trigger("link_device_events:primary_hello_received")}g.LinkDeviceMethodType=d("WAWebAltDeviceLinkingApi").PairingType;g.getIsAltLinkingEnabledByServer=a;g.resetLinkDeviceState=c;g.genLinkDeviceCodeForPhoneNumber=e;g.refreshAltLinkingCode=f;g.forceManualRefresh=i;g.errorAltLinking=j;g.primaryHelloReceivedAltLinking=k}),98);
__d("WAWebProgressBar.scss",["cx"],(function(a,b,c,d,e,f,g,h){a={progress:"_ak0k"};b=a;g["default"]=b}),98);
__d("WAWebProgressBar.react",["WAWebClassnames","WAWebProgressBar.scss","react"],(function(a,b,c,d,e,f,g){var h,i=h||c("react");function a(a){var b=a.className,e=a.max;e=e===void 0?100:e;a=a.value;return i.jsx("progress",{value:a,max:e,className:d("WAWebClassnames").classnamesConvertMeToStylexPlease(c("WAWebProgressBar.scss").progress,b)})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("WAWebSmbLearnMore.react",["fbt","WAWebClickableLink.react","WAWebExternalLink.react","WAWebL10N","WAWebURLUtils","react"],(function(a,b,c,d,e,f,g,h){var i,j=i||c("react"),k="https://www.whatsapp.com/legal/small-business-terms/";function a(){var a=c("WAWebURLUtils").build(k,{lg:c("WAWebL10N").getNormalizedLocale()}),b=function(b){b.preventDefault(),self.setTimeout(function(){return d("WAWebExternalLink.react").openExternalLink(a)},10)};return j.jsx(c("WAWebClickableLink.react"),{href:a,onClick:b,children:h._("__JHASH__RR1bpeluTQm__JHASH__")})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("WAWebNavigatableList",["WAWebKeyboardHotKeys.react","react"],(function(a,b,c,d,e,f,g){var h,i;b=i||d("react");var j=h||(h=c("react")),k=b.useEffect,l=b.useImperativeHandle;function a(a){var b=a.children,c=a.items,e=a.onSelect,f=a.forceSelection,g=f===void 0?!1:f;f=a.rotate;var h=f===void 0?!1:f;f=a.handlers;var i=a.listControllerRef,m=a.initialActiveItem;a=babelHelpers.objectWithoutPropertiesLoose(a,["children","items","onSelect","forceSelection","rotate","handlers","listControllerRef","initialActiveItem"]);k(function(){m!=null&&c.setVal(m),g===!0&&c.index<0&&c.setFirst(!1)},[c,g,m]);var n=f||{},o=n.down,p=n.up,q=n.enter,r=function(){h&&c.index===c.list.length-1?c.setFirst(!1):c.setNext(!1)},s=function(){if(c.index===0)if(h){c.setLast(!1);return}else if(g)return;c.setPrev(!1)},t=function(){var a=c.getVal();a!=null&&e!=null&&(a==null?void 0:a.disabled)!==!0&&e(a)};n=babelHelpers["extends"]({},f,{down:function(a){if((o==null?void 0:o(a))===!1)return;r()},up:function(a){if((p==null?void 0:p(a))===!1)return;s();a.preventDefault()},enter:function(a){if((q==null?void 0:q(a))===!1)return;t()}});l(i,function(){return{goDown:r,goUp:s,selectItem:t}});return j.jsx(d("WAWebKeyboardHotKeys.react").HotKeys,babelHelpers["extends"]({handlers:n},a,{children:b}))}a.displayName=a.name+" [from "+f.id+"]";g.NavigatableList=a}),98);
__d("useWAWebNavigatableList",["WAWebNavigatableList","WAWebSingleSelection","react","useWAWebListener"],(function(a,b,c,d,e,f,g){var h;b=h||d("react");var i=b.useEffect,j=b.useState;function a(a){var b=j(null),e=b[0],f=b[1];b=j(new(c("WAWebSingleSelection"))(a));var g=b[0],h=b[1];i(function(){h(new(c("WAWebSingleSelection"))(a))},[a]);i(function(){f(g.getVal())},[a,g]);d("useWAWebListener").useListener(g,"change",function(a){a=a.current;f(a)});return{activeItem:e,listSelection:g,NavigatableList:d("WAWebNavigatableList").NavigatableList}}g.useNavigatableList=a}),98);
__d("WAWebKeyboardEventConstants",[],(function(a,b,c,d,e,f){a={Action:"keyboard_action",Event:"keyboard_event",Events:{LOGGED_IN:"logged_in",LOGGED_OUT:"logged_out",ARCHIVE:"archived",MUTE:"muted",PIN:"pinned",READ:"read",READ_ONLY:"read_only",CHAT_KIND:"chat_kind",ZOOM:"zoom",LAUNCH:"launch",AB_PROPS_UPDATE:"ab_props_update",BATCH_RENDER:"batch_render"}};f["default"]=a}),66);
__d("WAWebKeyboardRotateFocusModal.react",["WAWebKeyboardConstants","WAWebKeyboardTabUtils","react","stylex","useWAWebMergeRefs"],(function(a,b,c,d,e,f,g){var h,i,j;b=j||d("react");var k=h||(h=c("react"));b.forwardRef;var l=b.useRef,m={container:{position:"x10l6tqk",top:"x13vifvy",end:"xds687c",left:null,right:null,bottom:"x1ey2m1c",start:"x17qophe",$$css:!0}};e=k.forwardRef(a);function a(a,b){var e=a.children,f=a.onBlur;a=a.xstyle;var g=l(null);b=c("useWAWebMergeRefs")(b,g);var h=function(a){var b=g.current;if(!b)return;var c=a.shiftKey?d("WAWebKeyboardTabUtils").TabDirection.BACKWARD:d("WAWebKeyboardTabUtils").TabDirection.FORWARD;b=d("WAWebKeyboardTabUtils").getNextTabbableElement(b,c,d("WAWebKeyboardTabUtils").FocusType.TABBABLE);if(b==null)return;a.preventDefault();b.focus()},j=function(a){if(a.metaKey||a.ctrlKey)return;if(a.key===d("WAWebKeyboardConstants").KEYBOARD_EVENT_KEY_VALUE.TAB)return h(a)};return k.jsx("div",{ref:b,className:(i||(i=c("stylex")))(m.container,a),onKeyDown:j,tabIndex:"-1",onBlur:f,children:e})}a.displayName=a.name+" [from "+f.id+"]";b=e;g["default"]=b}),98);
__d("WAWebLinkDevicePhoneNumberEntryInput.react",["fbt","WAIsoToCc","WANullthrows","WAWebClassnames","WAWebFlex.react","WAWebFlexItem.react","WAWebLinkDevicePhoneNumberEntryInputFormatUtils","WAWebUA","WAWebUISpacing","react","stylex"],(function(a,b,c,d,e,f,g,h){var i,j,k;b=k||d("react");var l=i||(i=c("react"));e=b.forwardRef;var m=b.useEffect,n=b.useImperativeHandle,o=b.useRef,p=b.useState,q={inputContainer:{position:"x1n2onr6",color:"xy9n6vp",cursor:"x1ed109x",$$css:!0},inputWrapper:{position:"x1n2onr6",paddingTop:"xqv4dci",paddingBottom:"x1aazizy",paddingStart:"xbbxn1n",paddingLeft:null,paddingRight:null,paddingEnd:"x1iji9kk",minWidth:"x1vktgvc",height:"x1qx5ct2",backgroundColor:"xe7vic5",borderTop:"x1v7dy8y",borderEnd:"x1fooavg",borderBottom:"x1w7fho5",borderStart:"xdiwinc",borderTopStartRadius:"x1z11no5",borderTopEndRadius:"xjy5m1g",borderBottomEndRadius:"x1mnwbp6",borderBottomStartRadius:"x4pb5v6",$$css:!0},inputWrapperFocused:{borderTop:"xz9npiw",borderEnd:"x1ivczb0",borderBottom:"x1gknxwd",borderStart:"x1pdk2bw",$$css:!0},inputAndPlaceholderInnerWrapper:{position:"x1n2onr6",$$css:!0},phoneNumberText:{fontSize:"x1jchvi3",fontVariantNumeric:"xss6m8b",$$css:!0},placeholder:{position:"x10l6tqk",top:"xs7f9wi",left:"xu96u03",start:null,end:null,color:"xiqmkuo",whiteSpace:"x126k92a",userSelect:"x87ps6o",$$css:!0},placeholderTransparent:{color:"x19co3pv",$$css:!0},placeholderTextUnderscoresMacOS:{display:"x1rg5ohu",letterSpacing:"xtf6cww",transform:"xkivrog",$$css:!0},placeholderTextUnderscoresWindows:{display:"x1rg5ohu",letterSpacing:"x1qcr5yj",transform:"xahfe03",$$css:!0},input:{position:"x1n2onr6",color:"xy9n6vp",zIndex:"x1n327nk",width:"xh8yej3",borderTop:"x6umtig",borderEnd:"x1b1mbwd",borderBottom:"xaqea5y",borderStart:"xav7gou",backgroundColor:"xjbqb8w",":focus_outline":"x1uvtmcs",$$css:!0}};function a(a,b){var e,f=a.countryCodeIso,g=a.phoneNumberWithoutCountryPrefix,i=a.a11yErrorMessage,k=a.onChange,s=a.onEnter;a=i.errorShown;i=i.errorMessageDOMId;var t=p(!1),u=t[0],v=t[1];t=p(null);var w=t[0],x=t[1],y=o(null);t=p(!0);var z=t[0],A=t[1];t=f==null?null:c("WAIsoToCc")[f];e=d("WAWebLinkDevicePhoneNumberEntryInputFormatUtils").formatPhoneNumberInput({countryCodeIso:f,phoneNumberWithoutCountryCode:(e=g)!=null?e:""});e=c("WANullthrows")(e,"Unexpected null phone number format result, likely because of invalid country code");var B=e.formattedInputValue;e=e.placeholder;var C=d("WAWebLinkDevicePhoneNumberEntryInputFormatUtils").getFullFormattedInputValue(z,t,B);m(function(){var a=null;if(w!=null)if(w.shouldPositionNextToDigit){var b=Array.from(C.matchAll(/\d/g));b.length>w.selectionStart&&(a=b[w.selectionStart].index)}else a=w.selectionStart;if(a!=null){(b=y.current)==null?void 0:b.setSelectionRange(a,a)}x(null)},[w,C]);z=function(a){a=a.target;var b=a.value;a=a.selectionStart;var c=d("WAWebLinkDevicePhoneNumberEntryInputFormatUtils").cleanPhoneNumberInputValue(b),e=c.countryCodeIso;c=c.phoneNumberWithoutCountryCode;if(e===f&&c===g)x({selectionStart:a,shouldPositionNextToDigit:!1});else{a=d("WAWebLinkDevicePhoneNumberEntryInputFormatUtils").cleanPhoneNumberInputValue(b.substr(0,a));a=a.fullRawPhoneNumber;x({selectionStart:a.length,shouldPositionNextToDigit:!0})}e==null?A(b.includes("+")):A(!0);k(e,c)};n(b,function(){return{focus:function(){var a;(a=y.current)==null?void 0:a.focus()}}});return l.jsx("div",{className:"x1n2onr6 xy9n6vp x1ed109x",onClick:function(){var a;(a=y.current)==null?void 0:a.focus()},dir:"ltr",children:l.jsx(d("WAWebFlex.react").FlexRow,{className:(j||(j=c("stylex")))(q.inputWrapper,u&&q.inputWrapperFocused),children:l.jsx(c("WAWebFlexItem.react"),{xstyle:q.inputAndPlaceholderInnerWrapper,grow:1,children:l.jsxs("form",{onSubmit:function(a){a.preventDefault(),s==null?void 0:s()},children:[l.jsx(r,{formattedInputValue:C,placeholder:e}),l.jsx("input",{ref:y,"data-testid":void 0,"aria-label":h._("__JHASH__hHLmpo6tr0p__JHASH__"),"aria-describedby":a?i:"","aria-required":"true","aria-invalid":a?"true":"false",className:d("WAWebClassnames").classnamesConvertMeToStylexPlease("selectable-text",j(q.input,q.phoneNumberText,d("WAWebUISpacing").uiPadding.all0)),type:"text",value:C,onChange:z,onFocus:function(){v(!0),x({selectionStart:C.length,shouldPositionNextToDigit:!1})},onBlur:function(){return v(!1)}})]})})})})}a.displayName=a.name+" [from "+f.id+"]";function r(a){var b=a.formattedInputValue;a=a.placeholder;a=a.split(/(_+)/).map(function(a,b){var e=b%2===1;return l.jsx("span",{className:(j||(j=c("stylex")))(e&&d("WAWebUA").UA.os===d("WAWebUA").OS_TYPE.WINDOWS&&q.placeholderTextUnderscoresWindows,e&&d("WAWebUA").UA.os===d("WAWebUA").OS_TYPE.MAC&&q.placeholderTextUnderscoresMacOS),children:a},b+":"+a)});return l.jsxs("div",{className:"x10l6tqk xs7f9wi xu96u03 xiqmkuo x126k92a x87ps6o x1jchvi3 xss6m8b","aria-hidden":"true",children:[l.jsx("span",{className:"x19co3pv",children:b}),a]})}r.displayName=r.name+" [from "+f.id+"]";b=e(a);g.WAWebLinkDevicePhoneNumberEntryInput=b}),98);
__d("WAWebRegister.react",["WAWebEventEmitter","err","react","useWAWebListener","useWAWebPrevious"],(function(a,b,c,d,e,f,g){var h,i;b=i||d("react");var j=h||(h=c("react")),k=b.createContext,l=b.useCallback,m=b.useContext,n=b.useEffect,o=b.useImperativeHandle,p=b.useMemo,q=b.useRef;function r(a,b){return a.length!==b.length?!1:a.every(function(a,c){return a===b[c]})}function a(){var a=k();function b(b){return j.jsx(a.Provider,{value:b.registerRef,children:b.children})}b.displayName=b.name+" [from "+f.id+"]";function e(a){var b=p(function(){return new(c("WAWebEventEmitter"))()},[]),e=new Map(),f=q({items:e,events:b});f.current!=null&&(f.current.items=new Map());var g=c("useWAWebPrevious")((e=f.current)==null?void 0:e.items);n(function(){var b=f.current;if(b!=null){var c=Array.from((g==null?void 0:g.keys())||[]),d=Array.from(b==null?void 0:b.items.keys());c=!r(c,d);c&&(a==null?void 0:a.onOrderChange==null?void 0:a.onOrderChange(b==null?void 0:b.items))}});n(function(){f.current!=null&&(a==null?void 0:a.onRegister==null?void 0:a.onRegister(f.current.items))});var h=a==null?void 0:a.onChange;d("useWAWebListener").useListener(b,"change",l(function(){f.current!=null&&(h==null?void 0:h(f.current.items))},[h]));return f}function g(b,d){var e=m(a),f=e;if(e==null||f==null)throw c("err")("[Register] `useRegisterItem` must be used in a `Register` tree");var g=q(null);o(g,function(){return d});(e=f.current)==null?void 0:e.items.set(b,g);n(function(){var a=f.current;a==null?void 0:a.items.set(b,g);a==null?void 0:a.events.trigger("change");return function(){a==null?void 0:a.items["delete"](b),a==null?void 0:a.events.trigger("change")}},[b])}return{Register:b,useRegister:e,useRegisterItem:g}}g.createRegister=a}),98);
__d("WAWebWDSMenuController.react",["WALogger","WAWebDomScroll","WAWebEventEmitter","WAWebFlex.react","WAWebRegister.react","WAWebWDSGatingUtils","asyncToGeneratorRuntime","err","react","stylex","useWAWebNavigatableList"],(function(a,b,c,d,e,f,g){var h,i,j;function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Menu] Trying to handle onSelect without a valid option '","'"]);k=function(){return a};return a}e=j||d("react");var l=h||(h=c("react"));f=e.createContext;var m=e.forwardRef,n=e.useCallback,o=e.useContext,p=e.useEffect,q=e.useMemo,r=e.useRef,s=e.useState,t=f(null);e=d("WAWebRegister.react").createRegister();f=e.useRegisterItem;var u=e.useRegister;e=e.Register;function a(){var a=o(t);if(a==null)throw c("err")("[Menu] useMenu must be used in a child of a MenuList component");return a}var v={container:{display:"x78zum5",flexGrow:"x1iyjqo2",overflowX:"xw2csxc",overflowY:"x1odjw0f",$$css:!0},listContainer:{display:"x78zum5",flexDirection:"xdt5ytf",flexGrow:"x1iyjqo2",flexShrink:"x2lah0s",flexBasis:"xdl72j9",overflowY:"x1odjw0f",width:"xh8yej3",$$css:!0}};m=m(function(a,e){var f=a.data,g=a.children,h=a.onSelect,j=a.forceSelection,m=a.initialActiveOptionId,o=a.maxHeight,u=a.minWidth,w=a.colorScheme;w=w===void 0?"lighter":w;var x=a.size;x=x===void 0?"small":x;var y=a.menuControllerRef,z=a.focusOnMount,A=z===void 0?!1:z;z=a.material;z=z===void 0?!1:z;var B=a.allowTabNavigation;B=B===void 0?!1:B;var C=a.border,D=a.onActiveItemChange;a=a.autoScroll;var E=a===void 0?!0:a,F=f,G=r();a=s();var H=a[0],I=a[1],J=q(function(){return new(c("WAWebEventEmitter"))()},[]);f=q(function(){return H!=null?H:Array.from(F.keys())},[H,F]);a=d("useWAWebNavigatableList").useNavigatableList(f);var K=a.activeItem,L=a.listSelection;f=a.NavigatableList;a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield I(a)});return function(b){return a.apply(this,arguments)}}();var M=function(a){var b=F.get(a);if(b!=null&&b.current!=null){b=b.current;b.onSelect==null?void 0:b.onSelect();J.trigger("select",a,b,F);h==null?void 0:h(a,b,F)}else d("WALogger").WARN(k(),a)},N=function(a){a.stopPropagation(),a.preventDefault()},O=n(function(a){a=F.get(a);if(G.current!=null&&(a==null?void 0:a.current)!=null){a=a.current.ref.current;a!=null&&d("WAWebDomScroll").scrollIntoViewIfNeeded(a,!1,G.current)}},[F,G]);p(function(){E===!0&&K!=null&&O(K)},[K,O,E]);p(function(){D==null?void 0:D(K)},[K,D]);p(function(){A===!0&&G.current!=null&&G.current.focus()},[]);N={down:N,up:N,enter:N};var P=function(a){a!=null?L.setVal(a):L.set(-1,!1)};a={items:F,events:J,activeItemId:K,filteredItems:H!=null?new Set(H):null,filterItems:a,selectItem:M,activateItem:P,colorScheme:w,size:x,material:z,allowTabNavigation:B,border:C};return l.jsx(t.Provider,{value:a,children:l.jsx("div",{ref:e,role:"listbox","data-testid":void 0,className:(i||(i=c("stylex")))([v.container]),style:{maxHeight:o,minWidth:u},children:l.jsx(f,{listControllerRef:y,xstyle:v.listContainer,items:L,onSelect:M,handlers:N,forceSelection:j,initialActiveItem:m,rotate:!0,children:l.jsx(d("WAWebFlex.react").FlexColumn,{align:"stretch",tabIndex:0,"data-tab":0,ref:G,padding:z||d("WAWebWDSGatingUtils").materialRefreshEnabled()?8:0,children:g})})})})});g.useRegisterItem=f;g.Register=e;g.useRegister=u;g.useMenu=a;g.WDSMenuController=m}),98);
__d("WAWebWDSMenu.react",["WAWebWDSMenuController.react","asyncToGeneratorRuntime","react"],(function(a,b,c,d,e,f,g){var h,i;a=i||d("react");var j=h||(h=c("react"));e=a.forwardRef;var k=a.useState;f=e(function(a,c){var e=k(new Map()),f=e[0],g=e[1];e=d("WAWebWDSMenuController.react").useRegister({onChange:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield g(a)});function c(b){return a.apply(this,arguments)}return c}(),onOrderChange:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield g(a)});function c(b){return a.apply(this,arguments)}return c}()});return j.jsx(d("WAWebWDSMenuController.react").Register,{registerRef:e,children:j.jsx(d("WAWebWDSMenuController.react").WDSMenuController,babelHelpers["extends"]({data:f},a,{ref:c}))})});g.WDSMenu=f}),98);
__d("WAWebWDSPerformantMenu.react",["WAWebFlatList.react","WAWebFlatListContainer.react","WAWebFlatListController","WAWebWDSMenuController.react","react"],(function(a,b,c,d,e,f,g){var h,i;b=i||d("react");var j=h||(h=c("react")),k=b.useMemo,l=b.useRef;function a(a){var b=a.data,e=a.renderItem,f=a.colorScheme,g=a.menuControllerRef,h=a.material,i=a.onSelect,m=a.maxHeight,n=a.minWidth,o=a.initialActiveOptionId,p=a.reorderAnimationsEnabled;a=a.size;var q=new Map(),r=l(null),s=d("WAWebWDSMenuController.react").useRegister({onRegister:function(a){a.forEach(function(a,b){q.set(b,a)})},onChange:function(a){a.forEach(function(a,b){q.set(b,a)})}}),t=k(function(){return new(c("WAWebFlatListController"))()},[]),u=k(function(){return d("WAWebFlatList.react").FlatListFactory()},[]),v=function(a){var c=b.findIndex(function(b){return b.itemKey===a});if(c>-1){var d;(d=r.current)==null?void 0:d.scrollIntoViewIfNeeded(c)}};b.forEach(function(a){if(a["static"]===!0)return;var b=q.get(a.itemKey);q.set(a.itemKey,(a=b)!=null?a:{current:null})});return j.jsx(d("WAWebWDSMenuController.react").Register,{registerRef:s,children:j.jsx(d("WAWebWDSMenuController.react").WDSMenuController,{data:q,colorScheme:f,menuControllerRef:g,material:h,onSelect:i,maxHeight:m,minWidth:n,initialActiveOptionId:o,onActiveItemChange:v,autoScroll:!1,size:a,children:j.jsx(c("WAWebFlatListContainer.react"),{flatListControllers:[t],className:"x1rife3k x1plvlek",children:j.jsx(u,{ref:r,data:b,renderItem:e,direction:"vertical",flatListController:t,defaultItemHeight:56,disablePointerEventsOnScroll:!1,recycleKeys:!1,reorderAnimationsEnabled:p,initialActiveOptionId:o})})})})}a.displayName=a.name+" [from "+f.id+"]";g.WDSPerformantMenu=a}),98);
__d("useWAWebLexicalWDSMenuController",["Lexical","LexicalComposerContext","react","useWAWebLexicalEvent"],(function(a,b,c,d,e,f,g){var h,i=(h||d("react")).useRef;function a(){var a=d("LexicalComposerContext").useLexicalComposerContext();a=a[0];var b=i(null);d("useWAWebLexicalEvent").useLexicalCommandListener(a,d("Lexical").KEY_ARROW_UP_COMMAND,function(a){a.preventDefault();a.stopPropagation();(a=b.current)==null?void 0:a.goUp();return!1});d("useWAWebLexicalEvent").useLexicalCommandListener(a,d("Lexical").KEY_ARROW_DOWN_COMMAND,function(a){a.stopPropagation();(a=b.current)==null?void 0:a.goDown();return!1});d("useWAWebLexicalEvent").useLexicalCommandListener(a,d("Lexical").KEY_ENTER_COMMAND,function(){var a;(a=b.current)==null?void 0:a.selectItem();return!1});return b}g.useLexicalWDSMenuController=a}),98);
__d("WAWebLexicalWDSMenu.react",["WAWebWDSMenu.react","WAWebWDSPerformantMenu.react","react","useWAWebLexicalWDSMenuController"],(function(a,b,c,d,e,f,g){var h,i=h||c("react");function a(a){var b=d("useWAWebLexicalWDSMenuController").useLexicalWDSMenuController();return i.jsx(d("WAWebWDSMenu.react").WDSMenu,babelHelpers["extends"]({},a,{size:"medium",menuControllerRef:b}))}a.displayName=a.name+" [from "+f.id+"]";function b(a){var b=d("useWAWebLexicalWDSMenuController").useLexicalWDSMenuController();return i.jsx(d("WAWebWDSPerformantMenu.react").WDSPerformantMenu,babelHelpers["extends"]({},a,{menuControllerRef:b}))}b.displayName=b.name+" [from "+f.id+"]";g.LexicalWDSMenu=a;g.LexicalWDSPerformantMenu=b}),98);
__d("WAWebWDSDropdown.react",["WAWebFlex.react","WAWebPopover.react","WAWebUISpacing","WAWebWDSGatingUtils","WAWebWDSMenu.react","react"],(function(a,b,c,d,e,f,g){var h,i=h||c("react"),j={container:{borderTopStartRadius:"x1npaq5j",borderTopEndRadius:"x1c83p5e",borderBottomEndRadius:"x1enjb0b",borderBottomStartRadius:"x199158v",backgroundColor:"x1x0w6k2",boxShadow:"x1sr759z",color:"x6s6g2w",overflowX:"x6ikm8r",overflowY:"x10wlt62",$$css:!0},material:{borderTopStartRadius:"xfh8nwu",borderTopEndRadius:"xoqspk4",borderBottomEndRadius:"x12v9rci",borderBottomStartRadius:"x138vmkv",$$css:!0},arrow:{backgroundColor:"x1x0w6k2",$$css:!0}};function k(a){var b=a.children,c=a.initHandling,e=a.material,f=a.maxHeight,g=a.minWidth,h=a.xstyle;a=babelHelpers.objectWithoutPropertiesLoose(a,["children","initHandling","material","maxHeight","minWidth","xstyle"]);e=e===!0||d("WAWebWDSGatingUtils").materialRefreshEnabled();c=d("WAWebPopover.react").usePopoverElement(babelHelpers["extends"]({},a,{initHandling:(a=c)!=null?a:"click",dismissable:!0,arrowXStyle:j.arrow,element:i.jsx(d("WAWebFlex.react").FlexItem,{style:{maxHeight:f,minWidth:g},xstyle:[j.container,e&&j.material,!e&&d("WAWebUISpacing").uiPadding.vert8,h],children:b})}));return c}function l(a){var b=a.children,c=a.onSelect,e=a.menuRef,f=a.initialActiveOptionId,g=a.initHandling,h=a.material,j=a.xstyle;a=babelHelpers.objectWithoutPropertiesLoose(a,["children","onSelect","menuRef","initialActiveOptionId","initHandling","material","xstyle"]);var l=k(babelHelpers["extends"]({},a,{initHandling:(a=g)!=null?a:"click",dismissable:!0,material:h,children:i.jsx(d("WAWebWDSMenu.react").WDSMenu,{ref:e,material:h,initialActiveOptionId:f,onSelect:function(a,b){b=b.type;c==null?void 0:c(a);["multi-select","submenu","switch"].includes(b)===!1&&l.hidePopover()},children:b}),xstyle:j}));return l}function a(a){a=k(a);a=a.popover;return a}a.displayName=a.name+" [from "+f.id+"]";function b(a){a=l(a);a=a.popover;return a}b.displayName=b.name+" [from "+f.id+"]";function e(a){a=l(babelHelpers["extends"]({},a,{initHandling:"contextmenu"}));a=a.popover;return a}e.displayName=e.name+" [from "+f.id+"]";g.PopoverAlignment=d("WAWebPopover.react").PopoverAlignment;g.PopoverPosition=d("WAWebPopover.react").PopoverPosition;g.useWDSDropdown=k;g.useWDSDropdownMenu=l;g.WDSDropdown=a;g.WDSDropdownMenu=b;g.WDSContextDropdownMenu=e}),98);
__d("WAWebWDSMenuItem.react",["WAWebUnstyledButton.react","WAWebWDSMenuController.react","err","react","useWAWebMergeRefs","useWAWebPrevious"],(function(a,b,c,d,e,f,g){var h,i;e=i||d("react");var j=h||(h=c("react")),k=e.useEffect,l=e.useRef;function a(a){a=m(a);var b=a.colorScheme,c=a.size,d=a.material,e=a.border;a=a.isActive;return{colorScheme:b,size:c,material:d,border:e,active:a}}function m(a){var b=d("WAWebWDSMenuController.react").useMenu();if(b==null)throw c("err")("[Menu] MenuItem must be a child of a MenuItemList");return{menu:b,colorScheme:b.colorScheme,size:b.size,isActive:(b==null?void 0:b.activeItemId)===a,isFiltered:b.filteredItems!=null&&b.filteredItems.has(a)===!1,material:b.material,allowTabNavigation:b.allowTabNavigation,border:b.border}}function n(a,b){d("WAWebWDSMenuController.react").useRegisterItem(a,b);return m(a)}var o={container:{textAlign:"x1yc453h",overflowX:"x6ikm8r",overflowY:"x10wlt62",display:"x78zum5",flexGrow:"x1iyjqo2",flexShrink:"x2lah0s",flexBasis:"xdl72j9",alignSelf:"xkh2ocl",width:"xh8yej3",$$css:!0},disabled:{cursor:"x1h6gzvc",$$css:!0}};e=j.forwardRef(b);function b(a,b){a=babelHelpers["extends"]({},a);var d=a.optionId,e=a.primary,f=a.disabled,g=a.children,h=a.type,i=a.onSelect,m=a.searchCriteria,p=a.testid,q=a.onActive,r=a.onInactive;p=a.ariaLabel;a=l(null);b=c("useWAWebMergeRefs")(a,b);h=n(d,{id:d,type:h,label:e,searchCriteria:m,onSelect:f!==!0?i:function(){},ref:a});var s=h.menu,t=h.isActive;e=h.isFiltered;m=h.allowTabNavigation;var u=c("useWAWebPrevious")(t);k(function(){t===!0&&u!==!0?q==null?void 0:q():t===!1&&u===!0&&(r==null?void 0:r())},[t,u,q,r]);if(e===!0)return null;i=function(a){a.stopPropagation(),s.selectItem(d)};a=function(){s.activateItem(d)};h=function(){s.activateItem(null)};return j.jsx(c("WAWebUnstyledButton.react"),{ref:b,role:"listitem",xstyle:[o.container,f===!0&&o.disabled],onClick:f!==!0?i:null,tabIndex:m?0:-1,dataTab:m?0:-1,testid:void 0,onFocus:m?a:null,onBlur:m?h:null,"aria-label":p,children:g})}b.displayName=b.name+" [from "+f.id+"]";g.useMenuItemWDSCellProps=a;g.useMenuItem=m;g.useRegisterMenuItem=n;g.WDSMenuItem=e}),98);
__d("WAWebCellMenuItem.react",["WAWebText.react","WAWebWDSCell.react","WAWebWDSMenuItem.react","react"],(function(a,b,c,d,e,f,g){var h,i=h||c("react");b=i.forwardRef(a);function a(a,b){a=babelHelpers["extends"]({},a);var c=a.optionId,e=a.size,f=a.border,g=a.disabled,h=a.primary,j=a.primaryRight,k=a.secondary,l=a.secondaryRight,m=a.detailLeft,n=a.detailRight,o=a.dropdown,p=a.children;a=babelHelpers.objectWithoutPropertiesLoose(a,["optionId","size","border","disabled","primary","primaryRight","secondary","secondaryRight","detailLeft","detailRight","dropdown","children"]);var q=d("WAWebWDSMenuItem.react").useMenuItem(c),r=q.colorScheme,s=q.size,t=q.isActive,u=q.material;q=q.border;return i.jsxs(d("WAWebWDSMenuItem.react").WDSMenuItem,babelHelpers["extends"]({optionId:c,type:"action"},a,{ref:b,children:[i.jsx(d("WAWebWDSCell.react").WDSCell,{size:(c=e)!=null?c:s,colorScheme:r,material:u,disabled:g,primary:h!=null?i.jsx(d("WAWebText.react").WDSTextTitle,{children:h}):null,primaryRight:j,secondary:k!=null?i.jsx(d("WAWebText.react").WDSTextMuted,{textWrap:"ellipsis",children:k}):null,secondaryRight:l,detailLeft:m,detailRight:n,active:t,tabIndex:-1,border:f||q,dropdown:o}),p]}))}a.displayName=a.name+" [from "+f.id+"]";g.WDSCellMenuItem=b}),98);
__d("WAWebActionMenuItem.react",["WAWebCellMenuItem.react","react"],(function(a,b,c,d,e,f,g){var h,i=h||c("react");b=i.forwardRef(a);function a(a,b){a=babelHelpers["extends"]({},a);return i.jsx(d("WAWebCellMenuItem.react").WDSCellMenuItem,babelHelpers["extends"]({ref:b},a,{type:"action"}))}a.displayName=a.name+" [from "+f.id+"]";g.ActionMenuItem=b}),98);
__d("WAWebSearchUtils",["WAWebL10N"],(function(a,b,c,d,e,f,g){function a(a){return c("WAWebL10N").accentFold(a.trim().toLowerCase())}function b(a,b,c){if(c==null){var d=a.filter(b);return{results:d,pagination:{page:0,pageLength:d.length,hasMoreResults:!1}}}d=[];var e=null,f=c.page;f=f===void 0?0:f;c=c.pageLength;c=c===void 0?a.length:c;var g=(f+1)*c+1;for(var h=0;h<a.length;h++){if(d.length===g)break;var i=a[h];b(i)&&d.push(i)}d.length===g?e=!0:e=!1;return{results:d.slice(f*c,f*c+c),pagination:{page:f,pageLength:c,hasMoreResults:e}}}g.normalizeString=a;g.filterPaginate=b}),98);
__d("WAWebMenuSearch.react",["WAWebFlex.react","WAWebSearchInput","WAWebSearchUtils","WAWebSimpleSearch","WAWebWDSMenuController.react","asyncToGeneratorRuntime","react"],(function(a,b,c,d,e,f,g){var h,i=h||c("react");function a(){var a=d("WAWebWDSMenuController.react").useMenu(),c=function(a){a.stopPropagation(),a.preventDefault()},e=function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var c=a.items;if(b==="")return a.filterItems(null);c=Array.from(c.values()).map(function(a){return a.current}).filter(Boolean);c=d("WAWebSearchUtils").filterPaginate(c,function(a){return d("WAWebSimpleSearch").simpleSearch(b,[a.searchCriteria])},{pageLength:c.length}).results;yield a.filterItems(c.map(function(a){return a.id}))});return function(a){return c.apply(this,arguments)}}(),f=function(){a.activeItemId!=null&&a.selectItem(a.activeItemId)};return i.jsx(d("WAWebFlex.react").FlexRow,{padding:8,shrink:0,children:i.jsx(d("WAWebSearchInput").SearchInput,{focusOnMount:!0,colorScheme:"darker",onEnter:f,onClick:c,onFocus:c,onBlur:c,onSearch:e,placeholder:""})})}a.displayName=a.name+" [from "+f.id+"]";g.MenuSearchInput=a}),98);
__d("useWAWebSet",["Promise","react"],(function(a,b,c,d,e,f,g){var h,i;c=i||d("react");var j=c.useCallback,k=c.useState;function a(a){a=k(a?a():function(){return new Set()});var c=a[0],d=a[1];a=j(function(a){return new(h||(h=b("Promise")))(function(b){d(function(c){c=new Set(c);c.add(a);b(c);return c})})},[]);var e=j(function(a){return new(h||(h=b("Promise")))(function(b){d(function(c){c=new Set(c);c["delete"](a);b(c);return c})})},[]),f=j(function(a){return new(h||(h=b("Promise")))(function(b){d(function(c){c=new Set(c);c.has(a)?c["delete"](a):c.add(a);b(c);return c})})},[]),g=j(function(a){a===void 0&&(a=[]);return new(h||(h=b("Promise")))(function(b){d(function(){var c=new Set(a);b(c);return c})})},[]);return[c,{add:a,remove:e,toggle:f,clear:g}]}g.useSet=a}),98);
__d("WAWebSelectMenuItem.react",["WAWebCellMenuItem.react","WAWebCheckboxRoundCheckedIcon","WAWebCheckboxRoundUncheckedIcon","WAWebCheckmarkIcon","WAWebSvgComponentBase","WAWebWDSMenuController.react","asyncToGeneratorRuntime","err","react","useWAWebListener","useWAWebSet"],(function(a,b,c,d,e,f,g){var h,i,j=i||d("react"),k=h||(h=c("react")),l=j.Children,m=j.createContext,n=j.useContext,o=j.useEffect,p=m(null);function a(a){var c=a.multiselect,e=a.children,f=a.initialSelection,g=d("WAWebWDSMenuController.react").useMenu(),h=d("useWAWebSet").useSet(),i=h[0];h=h[1];var j=h.clear,m=h.toggle,n=l.map(e,function(a){return a.props.optionId}),q=function(){var d=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b,d){var e;c===!0?e=(yield m(b)):e=(yield j([b]));a.onSelect==null?void 0:a.onSelect(b,d,e)});return function(a,b){return d.apply(this,arguments)}}();d("useWAWebListener").useListener(g.events,"select",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){n.includes(a)&&(yield q(a,b))});return function(b,c){return a.apply(this,arguments)}}());o(function(){if(f!=null){var a=Array.isArray(f)?f:[f];j(a)}},[]);h={selection:i,isMultiselect:c===!0};return k.jsx(p.Provider,{value:h,children:e})}a.displayName=a.name+" [from "+f.id+"]";function e(a){var b=n(p);if(b==null)throw c("err")("[menu] `SelectMenuItem` must be used inside of a `SelectMenuItemGroup`");var e=b.selection.has(a.optionId),f;b.isMultiselect?(b="multi-select",f=e?k.jsx(d("WAWebCheckboxRoundCheckedIcon").CheckboxRoundCheckedIcon,{}):k.jsx(d("WAWebCheckboxRoundUncheckedIcon").CheckboxRoundUncheckedIcon,{})):(b="single-select",f=e?k.jsx(d("WAWebCheckmarkIcon").CheckmarkIcon,{color:d("WAWebSvgComponentBase").SvgColorProp.TEAL}):null);return k.jsx(d("WAWebCellMenuItem.react").WDSCellMenuItem,babelHelpers["extends"]({detailRight:f},a,{type:b}))}e.displayName=e.name+" [from "+f.id+"]";g.SelectMenuItemGroup=a;g.SelectMenuItem=e}),98);
__d("WAWebStaticMenuItem.react",["WAWebFlex.react","WAWebText.react","WAWebWDSMenuController.react","react","stylex"],(function(a,b,c,d,e,f,g){var h,i,j=h||c("react"),k={scroll:{overflowY:"x1odjw0f",$$css:!0},separator:{height:"xjm9jq1",backgroundColor:"x191ts1j",$$css:!0}};function a(a){var b=a.scroll;a=babelHelpers.objectWithoutPropertiesLoose(a,["scroll"]);return j.jsx(d("WAWebFlex.react").FlexColumn,babelHelpers["extends"]({},a,{className:(i||(i=c("stylex")))(b===!0&&k.scroll)}))}a.displayName=a.name+" [from "+f.id+"]";function b(a){a=a.children;var b=d("WAWebWDSMenuController.react").useMenu();b=b.size;return j.jsx(d("WAWebFlex.react").FlexItem,{padding:b==="small"?8:16,shrink:0,children:j.jsx(d("WAWebText.react").WDSTextSectionTitle,{children:a})})}b.displayName=b.name+" [from "+f.id+"]";function e(){return j.jsx(d("WAWebFlex.react").FlexItem,{xstyle:k.separator,margin:[8,16]})}e.displayName=e.name+" [from "+f.id+"]";g.MenuSection=a;g.MenuHeading=b;g.MenuSeparator=e}),98);
__d("WAWebSubMenuItem.react",["WAWebCellMenuItem.react","WAWebChevronRightIcon","WAWebPopoverContext.react","WAWebWDSDropdown.react","WAWebWDSMenuController.react","react"],(function(a,b,c,d,e,f,g){var h,i;b=i||d("react");var j=h||(h=c("react")),k=b.useEffect,l=b.useRef;function a(a){var b=a.children,c=babelHelpers.objectWithoutPropertiesLoose(a,["children"]),e=d("WAWebWDSMenuController.react").useMenu();e=e.activeItemId;var f=l(null),g=d("WAWebPopoverContext.react").useWDSPopoverControllerRef(),h=e===a.optionId;k(function(){g.current!=null&&(h?g.current.showPopover():g.current.hidePopover())},[h,g]);e=function(){g.current!=null&&(g.current.popoverIsVisible?g.current.hidePopover():g.current.showPopover())};return j.jsx(d("WAWebCellMenuItem.react").WDSCellMenuItem,babelHelpers["extends"]({ref:f},c,{type:"submenu",onSelect:e,detailRight:j.jsx(d("WAWebChevronRightIcon").ChevronRightIcon,{width:20}),children:j.jsx(d("WAWebWDSDropdown.react").WDSDropdownMenu,{controllerRef:g,buffer:-8,target:f,position:d("WAWebWDSDropdown.react").PopoverPosition.End,alignment:d("WAWebWDSDropdown.react").PopoverAlignment.Start,initHandling:"hover-popover",children:b})}))}a.displayName=a.name+" [from "+f.id+"]";g.SubMenuItem=a}),98);
__d("WAWebSwitchMenuItem.react",["WAWebCellMenuItem.react","WAWebSwitch.react","react"],(function(a,b,c,d,e,f,g){var h,i;b=i||d("react");var j=h||(h=c("react")),k=b.useEffect,l=b.useState;function a(a){var b=a.on,c=a.initialState;c=c===void 0?!1:c;var e=a.onSelect;a=babelHelpers.objectWithoutPropertiesLoose(a,["on","initialState","onSelect"]);c=l(c);var f=c[0],g=c[1];k(function(){b!=null&&g(b)},[b]);c=function(){g(!f),e==null?void 0:e(!f)};return j.jsx(d("WAWebCellMenuItem.react").WDSCellMenuItem,babelHelpers["extends"]({},a,{type:"switch",onSelect:c,primaryRight:j.jsx(d("WAWebSwitch.react").Switch,{checked:f,onChange:function(){},tabIndex:-1})}))}a.displayName=a.name+" [from "+f.id+"]";g.SwitchMenuItem=a}),98);
__d("WAWebWDSMenuItems.react",["WAWebActionMenuItem.react","WAWebMenuSearch.react","WAWebSelectMenuItem.react","WAWebStaticMenuItem.react","WAWebSubMenuItem.react","WAWebSwitchMenuItem.react"],(function(a,b,c,d,e,f,g){g.MenuSearchInput=d("WAWebMenuSearch.react").MenuSearchInput,g.ActionMenuItem=d("WAWebActionMenuItem.react").ActionMenuItem,g.SwitchMenuItem=d("WAWebSwitchMenuItem.react").SwitchMenuItem,g.SubMenuItem=d("WAWebSubMenuItem.react").SubMenuItem,g.SelectMenuItemGroup=d("WAWebSelectMenuItem.react").SelectMenuItemGroup,g.SelectMenuItem=d("WAWebSelectMenuItem.react").SelectMenuItem,g.MenuSection=d("WAWebStaticMenuItem.react").MenuSection,g.MenuHeading=d("WAWebStaticMenuItem.react").MenuHeading,g.MenuSeparator=d("WAWebStaticMenuItem.react").MenuSeparator}),98);
__d("WAWebWDSSelectButton.react",["WAWebCaretDownIcon","WAWebFlex.react","WAWebFlexItem.react","WAWebUISpacing","WAWebWDSButton","react"],(function(a,b,c,d,e,f,g){var h,i,j=i||c("react");a=(h||(h=d("react"))).forwardRef;var k={label:{overflowX:"x6ikm8r",overflowY:"x10wlt62",textOverflow:"xlyipyv",$$css:!0}};b=a(function(a,b){var e=a.children,f=a.label,g=a.width,h=a.ariaLabel,i=a.ariaRoleDescription;a=a.testid;return j.jsxs(d("WAWebWDSButton").WDSButtonSecondary,{onClick:function(a){return a.stopPropagation()},ref:b,width:g,ariaLabel:h,ariaRoleDescription:i,testid:void 0,children:[j.jsxs(d("WAWebFlex.react").FlexRow,{justify:"all",align:"center",grow:1,children:[j.jsx(c("WAWebFlexItem.react"),{justify:"start",align:"center",xstyle:k.label,children:f}),j.jsx(d("WAWebCaretDownIcon").CaretDownIcon,{xstyle:d("WAWebUISpacing").uiPadding.start8})]}),e]})});g.WDSSelectButton=b}),98);
__d("WAWebWDSPerformantSelect.react",["WAWebCheckmarkIcon","WAWebLexicalWDSMenu.react","WAWebSearchInput","WAWebSimpleSearch","WAWebSvgComponentBase","WAWebWDSDropdown.react","WAWebWDSMenuItems.react","WAWebWDSPerformantMenu.react","WAWebWDSSelectButton.react","react","useWAWebMergeRefs"],(function(a,b,c,d,e,f,g){var h,i;a=i||d("react");var j=h||(h=c("react"));b=a.forwardRef;var k=a.useEffect,l=a.useRef,m=a.useState;e=b(function(a,b){var e=a.items,f=a.defaultLabel,g=a.customLabel,h=a.popoverControllerRef,i=a.menuMinWidth,n=a.menuMaxHeight;n=n===void 0?350:n;var o=a.width,p=a.includeSearchInput,q=a.initialSelection,r=a.testid;r=m();var s=r[0];r=r[1];var t=e;s!=null&&s.length&&(t=e.filter(function(a){return d("WAWebSimpleSearch").simpleSearch(s,[a.menuItem.searchCriteria])}));var u=t,v=function(a){var b;g!=null&&(b=g(a));if(b==null&&a!=null){var c=u.find(function(b){return b.itemKey===a});c!=null&&(b=c.menuItem.primary)}return(c=(c=b)!=null?c:f)!=null?c:""},w=l(null);e=c("useWAWebMergeRefs")(b,w);t=l();var x=(b=h)!=null?b:t;h=m(q);var y=h[0],z=h[1];b=m(v(q));t=b[0];var A=b[1];h=function(b){var c=v(b);A(c);z(b);a.onChange==null?void 0:a.onChange(b);(c=x.current)==null?void 0:c.hidePopover()};q=function(a){return j.jsx(d("WAWebWDSMenuItems.react").ActionMenuItem,babelHelpers["extends"]({},a.menuItem,{detailRight:a.itemKey===y?j.jsx(d("WAWebCheckmarkIcon").CheckmarkIcon,{color:d("WAWebSvgComponentBase").SvgColorProp.TEAL}):a.menuItem.detailRight}))};b=m(i);var B=b[0],C=b[1];k(function(){if(i==null){var a;C((a=w.current)==null?void 0:a.clientWidth)}},[i]);b={data:u,material:!0,renderItem:q,initialActiveOptionId:y,onSelect:h,maxHeight:n,minWidth:B,reorderAnimationsEnabled:!1};q=p===!0?j.jsx(d("WAWebSearchInput").SearchInput,{padding:[16,16,8,16],onSearch:r,colorScheme:"darker",children:j.jsx(d("WAWebLexicalWDSMenu.react").LexicalWDSPerformantMenu,babelHelpers["extends"]({},b))}):j.jsx(d("WAWebWDSPerformantMenu.react").WDSPerformantMenu,babelHelpers["extends"]({},b));return j.jsx(d("WAWebWDSSelectButton.react").WDSSelectButton,{ref:e,label:t,width:(h=o)!=null?h:"100%",testid:void 0,children:j.jsx(d("WAWebWDSDropdown.react").WDSDropdown,{material:!0,target:w,controllerRef:x,position:d("WAWebWDSDropdown.react").PopoverPosition.Bottom,alignment:d("WAWebWDSDropdown.react").PopoverAlignment.Start,initHandling:"click",buffer:4,children:q})})});g.Select=e}),98);
__d("WAWebCountrySelect.react",["fbt","invariant","WAIsoToCc","WAWebCountriesNativeCountryNames","WAWebEmoji","WAWebEmoji.react","WAWebWDSPerformantSelect.react","WAWebWDSText.react","react"],(function(a,b,c,d,e,f,g,h,i){var j,k,l=k||c("react"),m=(j||(j=d("react"))).useMemo;function n(a){a=a.countries;return a.map(function(a){var b=a[0];a=a[1];var e;c("WAWebCountriesNativeCountryNames")[b]!=null&&a!==c("WAWebCountriesNativeCountryNames")[b]&&(e=c("WAWebCountriesNativeCountryNames")[b]);var f=b.toUpperCase().split("").map(function(a){return String.fromCodePoint(127462+a.charCodeAt(0)-"A".charCodeAt(0))}).join(""),g=d("WAWebEmoji").EmojiUtil.normalizeEmojiFromString(f),j=c("WAIsoToCc")[b];j!=null||i(0,75729,b);g={optionId:b,primary:a,secondary:e,ariaLabel:h._("__JHASH__eEI0iCd0JXH__JHASH__",[h._param("country",a)]),detailLeft:g!=null?l.jsx(c("WAWebEmoji.react"),{className:"x1603h9y",selectable:!1,emoji:g}):l.jsx("span",{}),detailRight:l.jsxs(d("WAWebWDSText.react").WDSTextMuted,{dir:"ltr",children:["+",j]}),searchCriteria:[a,e,b,j.toString(),f].join(" ")};return{itemKey:g.optionId,menuItem:g,height:g.secondary!=null?56:40}})}function a(a){var b,c=a.countries,e=a.initialActiveOptionId,f=a.onChange,g=a.testid;g=a.width;var i=m(function(){return n({countries:c})},[c]);a=function(a){var b=i.find(function(b){return b.itemKey===a});return b!=null?l.jsxs(d("WAWebWDSText.react").WDSTextMuted,{flex:!0,align:"center",gap:8,children:[b.menuItem.detailLeft," ",b.menuItem.primary]}):null};return l.jsx(d("WAWebWDSPerformantSelect.react").Select,{width:g,menuMaxHeight:400,menuMinWidth:300,testid:void 0,initialSelection:e,defaultLabel:h._("__JHASH__ggq0nb4Twfk__JHASH__"),onChange:f,includeSearchInput:!0,customLabel:a,items:i})}a.displayName=a.name+" [from "+f.id+"]";g.CountrySelect=a}),98);
__d("WAWebCountryPhoneNumberInput.react",["WAWebCountrySelect.react","WAWebFlex.react","WAWebFlexItem.react","WAWebLinkDevicePhoneNumberEntryInput.react","WAWebUISpacing","react"],(function(a,b,c,d,e,f,g){var h,i=h||c("react"),j="link-device-phone-number-entry-screen-error",k={countrySelectWrapper:{height:"xdd8jsf",$$css:!0}};b=i.forwardRef(a);function a(a,b){var e=a.countries,f=a.onChangePhoneNumber,g=a.onChangeSelectedCountry,h=a.onSubmit,l=a.phoneNumberWithoutCountryCode,m=a.selectedCountryId;a=a.shouldDisplayError;return i.jsxs(d("WAWebFlex.react").FlexColumn,{align:"stretch",children:[i.jsx(c("WAWebFlexItem.react"),{isFlexContainer:!0,xstyle:[k.countrySelectWrapper,d("WAWebUISpacing").uiMargin.bottom12],children:i.jsx(d("WAWebCountrySelect.react").CountrySelect,{width:"100%",countries:e,testid:void 0,onChange:g,initialActiveOptionId:m},m)}),i.jsx(c("WAWebFlexItem.react"),{xstyle:a?d("WAWebUISpacing").uiMargin.bottom8:d("WAWebUISpacing").uiMargin.bottom32,children:i.jsx(d("WAWebLinkDevicePhoneNumberEntryInput.react").WAWebLinkDevicePhoneNumberEntryInput,{ref:b,countryCodeIso:m,phoneNumberWithoutCountryPrefix:l,a11yErrorMessage:{errorShown:a,errorMessageDOMId:j},onChange:f,onEnter:h})})]})}a.displayName=a.name+" [from "+f.id+"]";g.CountryPhoneNumberInput=b}),98);
__d("useWAWebCountries",["WAWebCountriesUtils","WAWebL10N","useWAWebAsync","useWAWebEventTargetValue"],(function(a,b,c,d,e,f,g){function a(a){var b=a.filterType;a=c("useWAWebEventTargetValue")(c("WAWebL10N"),"locale_change",function(){return c("WAWebL10N").getNormalizedLocale()});return c("useWAWebAsync")(function(){return d("WAWebCountriesUtils").getCountries({filter:b})},[b,a])}g.useCountries=a}),98);
__d("useWAWebQRScreenKillswitchValue",["WAWebQRScreenKillswitches","react","useWAWebUnmountSignal"],(function(a,b,c,d,e,f,g){var h;b=h||d("react");var i=b.useEffect,j=b.useState;function a(a){var b=j(null),e=b[0],f=b[1],g=c("useWAWebUnmountSignal")();i(function(){d("WAWebQRScreenKillswitches").getKillswitchValue(a).then(function(a){g.aborted||f(a)})},[a,g]);return e}g.useQRScreenKillswitchValue=a}),98);
__d("WAWebLinkDevicePhoneNumberEntryScreen.react",["fbt","JSResource","Promise","WAIsoToCc","WALogger","WAWebAssetLoaderSingleton","WAWebButterbar.react","WAWebButton.react","WAWebClickable.react","WAWebCountriesUtils","WAWebCountryPhoneNumberInput.react","WAWebEmojiAssetLoaderCompletionTracker","WAWebEmojiConst","WAWebFbtCommon","WAWebFlex.react","WAWebFlexItem.react","WAWebGetDefaultExport","WAWebLazyLoadedMainRequires","WAWebLinkDevicePhoneNumberEntryInputFormatUtils","WAWebMobilePlatforms","WAWebQRScreenKillswitches","WAWebSpinner.react","WAWebText.react","WAWebUISpacing","asyncToGeneratorRuntime","react","stylex","useWAWebAsync","useWAWebCountries","useWAWebQRScreenKillswitchValue"],(function(a,b,c,d,e,f,g,h){var i,j,k,l;function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Alt Device Linking: Phone Number entry screen could not load countries: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Alt Device Linking: Phone Number entry screen could not load emojis: ",""]);n=function(){return a};return a}e=l||d("react");var o=j||(j=c("react")),p=e.useCallback,q=e.useRef,r=e.useState,s="link-device-phone-number-entry-screen-error",t={spinnerContainer:{height:"x1ym45yv",$$css:!0},spinnerContainerModal:{height:"x1fb2l0r",$$css:!0},newFeatureBanner:{marginTop:"xs9mwh0",$$css:!0},phoneNumberCodeDropdownItem:{color:"x16cd2qt",$$css:!0},flag:{fontSize:"x1603h9y",$$css:!0},error:{color:"xsg3037",fontSize:"x1nxh6w3",$$css:!0}};function a(a){var b=a.initialCountryId,e=a.onSubmitPhoneNumber,f=a.onClickLinkWithQr,g=a.initialPhoneNumber,i=a.showUpdatePrimaryAppBanner;a=a.isLinkingPageLoading;var j=r(function(){if(g!=null)return d("WAWebLinkDevicePhoneNumberEntryInputFormatUtils").getCountryCodeIso(g);var a=b==null?null:b.toUpperCase();return a!=null&&c("WAIsoToCc")[a]!=null?a:"US"}),k=j[0],l=j[1];j=r(function(){return g==null?"":d("WAWebLinkDevicePhoneNumberEntryInputFormatUtils").cleanPhoneNumberInputValue(g).phoneNumberWithoutCountryCode});var m=j[0],n=j[1],v=q(null);j=r(!1);var w=j[0],y=j[1];j=p(function(){if(k!=null&&d("WAWebLinkDevicePhoneNumberEntryInputFormatUtils").isPhoneNumberValid(c("WAIsoToCc")[k],m)){var a=""+c("WAIsoToCc")[k]+m;void e(a)}else{(a=v.current)==null?void 0:a.focus();y(!0)}},[e,m,k]);var z=p(function(a,b){y(!1),l(a),n(b)},[]);return o.jsxs(o.Fragment,{children:[o.jsx(x,{shouldShowUpdatePrimaryErrorBanner:i}),o.jsxs(d("WAWebFlex.react").FlexColumn,{testid:void 0,className:"light",align:"center",children:[o.jsx(c("WAWebFlexItem.react"),{xstyle:d("WAWebUISpacing").uiMargin.bottom16,children:o.jsx(d("WAWebText.react").Text,{as:"div",className:"landing-title",size:"28",weight:"light",children:h._("__JHASH__K4i1kJXIjHz__JHASH__")})}),o.jsx(c("WAWebFlexItem.react"),{xstyle:d("WAWebUISpacing").uiMargin.bottom32,children:o.jsx(d("WAWebText.react").Text,{as:"div",color:"secondary",size:"16",children:h._("__JHASH__ZoWhyCh8NKF__JHASH__")})}),o.jsx(u,{shouldDisplayError:w,phoneNumberWithoutCountryCode:m,selectedCountryId:k,onSubmit:j,onChangePhoneNumber:z,onChangeSelectedCountry:l,actionButtonText:c("WAWebFbtCommon")("Next"),isLinkingPageLoading:a}),w?o.jsx(c("WAWebFlexItem.react"),{xstyle:[t.error,d("WAWebUISpacing").uiMargin.bottom32],children:o.jsx("span",{id:s,children:h._("__JHASH__2Azb9_scq2C__JHASH__")})}):null,o.jsx(c("WAWebFlexItem.react"),{children:o.jsx(d("WAWebText.react").Text,{as:"div",size:"18",className:"landing-text-secondary",children:o.jsx(d("WAWebClickable.react").Clickable,{as:"span",onClick:f,children:o.jsx(d("WAWebText.react").Text,{as:"span",color:"accent",size:"18",children:h._("__JHASH__nWrz-ZkdZU7__JHASH__")})})})})]})]})}a.displayName=a.name+" [from "+f.id+"]";function u(a){var b=a.phoneNumberWithoutCountryCode,e=a.selectedCountryId,f=a.shouldDisplayError,g=a.onSubmit,h=a.onChangePhoneNumber,i=a.onChangeSelectedCountry,j=a.actionButtonText,l=a.isInsideModal;l=l===void 0?!1:l;a=a.isLinkingPageLoading;a=a===void 0?!1:a;var p=d("useWAWebCountries").useCountries({filterType:d("WAWebCountriesUtils").COUNTRY_FILTER_TYPE.WHATSAPP_REGISTRATION}),q=p.value;p=p.error;var r=c("useWAWebAsync")(v,[]);if(r.loading||r.error||a===!0||q==null){r.error?d("WALogger").ERROR(n(),r.error.message).sendLogs("alt-device-linking load error",.1):p&&d("WALogger").ERROR(m(),p.message).sendLogs("alt-device-linking load error",.1);return o.jsx(d("WAWebFlex.react").FlexColumn,{align:"center",justify:"around",className:(k||(k=c("stylex")))(l?t.spinnerContainerModal:t.spinnerContainer),children:o.jsx(c("WAWebFlexItem.react"),{children:o.jsx(d("WAWebSpinner.react").Spinner,{})})})}return o.jsxs(d("WAWebFlex.react").FlexColumn,{align:"stretch",children:[o.jsx(d("WAWebCountryPhoneNumberInput.react").CountryPhoneNumberInput,{countries:q,shouldDisplayError:f,phoneNumberWithoutCountryCode:b,selectedCountryId:e,onChangePhoneNumber:h,onChangeSelectedCountry:i,onSubmit:g}),j!=null&&o.jsx(c("WAWebFlexItem.react"),{xstyle:d("WAWebUISpacing").uiMargin.bottom24,align:"center",children:o.jsx(c("WAWebButton.react"),{type:"primary",onClick:g,testid:void 0,children:j})})]})}u.displayName=u.name+" [from "+f.id+"]";function v(){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield (i||(i=b("Promise"))).all([d("WAWebLazyLoadedMainRequires").requireEmojiAssetMapCreator(),d("WAWebLazyLoadedMainRequires").requireEmojiConfig(),c("JSResource")("WAWebEmojiSetup").__setRef("WAWebLinkDevicePhoneNumberEntryScreen.react").load()])),e=a[0],f=a[1];a=a[2];d("WAWebAssetLoaderSingleton").AssetLoader.setPlatform(d("WAWebMobilePlatforms").PLATFORMS.ANDROID);d("WAWebAssetLoaderSingleton").AssetLoader.initEmojiAsset(e(f));d("WAWebEmojiAssetLoaderCompletionTracker").emojiCompletionTracker.beginPreloadFallback();c("WAWebGetDefaultExport")(a)(d("WAWebEmojiConst").EMOJI_TYPE.WHATSAPP)});return w.apply(this,arguments)}function x(a){a=a.shouldShowUpdatePrimaryErrorBanner;var b=d("useWAWebQRScreenKillswitchValue").useQRScreenKillswitchValue(d("WAWebQRScreenKillswitches").Killswitch.DEVICE_LINKING_WITH_PHONE_NUMBER_NUX_NEW_FEATURE_BANNER);if(a===!0)return o.jsx("div",{className:"light",children:o.jsx("div",{className:(k||(k=c("stylex")))(t.newFeatureBanner,d("WAWebUISpacing").uiMargin.bottom25),children:o.jsx(c("WAWebButterbar.react"),{type:"updateWarning",title:h._("__JHASH__pwz-hkrco54__JHASH__"),text:h._("__JHASH__ggiPxBDE_uv__JHASH__")})})});return b===!0?o.jsx("div",{className:"light",children:o.jsx("div",{className:(k||(k=c("stylex")))(t.newFeatureBanner,d("WAWebUISpacing").uiMargin.bottom25),children:o.jsx(c("WAWebButterbar.react"),{type:"generalAlert",title:h._("__JHASH__VZwlYZiFIVQ__JHASH__"),text:h._("__JHASH__f_EDw-J_kfQ__JHASH__")})})}):null}x.displayName=x.name+" [from "+f.id+"]";g.LinkWithPhoneNumberEntryScreen=a;g.PhoneNumberSection=u}),98);
__d("WAWebQRCode.react",["WAWeb-qrcode","react","stylex"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;b=j||d("react");var k=h||(h=c("react")),l=b.useEffect,m=b.useRef,n=b.useState;function a(a){var b=a.data,d=a.size,e=a.colorDark,f=a.correctLevel,g=a.onChange,h=m(null),j=n(null),o=j[0],p=j[1];l(function(){if(b==null)o&&o.clear();else if(o)o.makeCode(b);else if(h.current){var a;p(new(c("WAWeb-qrcode"))(h.current,babelHelpers["extends"]({correctLevel:c("WAWeb-qrcode").CorrectLevel[(a=f)!=null?a:"L"],height:d,text:b,width:d},e!=null&&{colorDark:e})))}g==null?void 0:g(h.current)},[b,o,d,g,e,f]);return a.children?a.children(h):k.jsx("div",{className:(i||(i=c("stylex")))(a.xstyle),ref:h})}g.WAWebQRCode=a}),98);
__d("WAWebHistorySyncUIText",["fbt","WAWebL10N","react"],(function(a,b,c,d,e,f,g,h){var i,j=i||c("react");a=function(){return h._("__JHASH__Rvzc7BdERtu__JHASH__")};b=function(a){return h._("__JHASH__FlSA2SGpcxy__JHASH__",[h._implicitParam("=m2",j.jsx("button",{className:"x1a06ls3",onClick:a,children:h._("__JHASH__SxwEKW2c4EQ__JHASH__")}))])};d=function(){return h._("__JHASH__qpAmhuB53eu__JHASH__")};e=function(){return h._("__JHASH__UpOmAOPt6Nv__JHASH__")};f=function(){return h._("__JHASH__F3LeGnqMRSP__JHASH__")};var k=function(a){return h._("__JHASH__b-MH7Xzfiaw__JHASH__",[h._param("percentage",c("WAWebL10N").n(a))])},l=function(){return h._("__JHASH___PUy8vTodLc__JHASH__")},m=function(a){return h._("__JHASH__eS53uCdAqRi__JHASH__",[h._param("percentage",c("WAWebL10N").n(a))])},n=function(){return h._("__JHASH__3zMwBCY18-M__JHASH__")},o=function(){return h._("__JHASH__GsJLjbJZBz5__JHASH__")},p=function(){return h._("__JHASH__rxi8nJ5Birv__JHASH__")},q=function(){return h._("__JHASH__c-OJntHqL44__JHASH__")},r=function(){return h._("__JHASH__A05MT9t974___JHASH__")},s=function(){return h._("__JHASH__jXpG7qa6kWx__JHASH__")},t=function(){return h._("__JHASH__c_rSnQhnkYE__JHASH__")},u=function(){return h._("__JHASH__fqPNu_Q-2qw__JHASH__")};g.SYNC_LOADING=a;g.SYNC_IN_PROGRESS_CONTEXTUAL_DRAWER=b;g.SYNC_IN_PROGRESS_CONTEXTUAL_SYSTEM_MESSAGE_TEXT=d;g.SYNCING_OLDER_MESSAGES_MODAL_TITLE=e;g.SYNCING_OLDER_MESSAGES_MODAL_TEXT=f;g.SYNCING_OLDER_MESSAGES_MODAL_PERCENT=k;g.SYNCING_OLDER_MESSAGES_SETTINGS_TITLE=l;g.SYNCING_OLDER_MESSAGES_SETTINGS_PERCENT_COMPLETE=m;g.SYNCING_PAUSED_CONTEXTUAL_SYSTEM_MESSAGE_TEXT=n;g.SYNCING_PAUSED_CONTEXTUAL_TEXT=o;g.SYNCING_PAUSED_GLOBAL_SETTINGS_TITLE=p;g.SYNCING_PAUSED_GLOBAL_SETTINGS_SUBTITLE=q;g.SYNCING_PAUSED_POPUP_TITLE=r;g.SYNCING_PAUSED_POPUP_DESC=s;g.SYNCING_ON_DEMAND_ERROR_POPUP_TITLE=t;g.SYNCING_ON_DEMAND_ERROR_POPUP_DESC=u}),98);
__d("useWAWebPersistentCounterAsync",["WALogger","asyncToGeneratorRuntime","react","useWAWebAsync"],(function(a,b,c,d,e,f,g){var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["useWAWebPersistentCounterAsync: ",""]);i=function(){return a};return a}e=h||d("react");var j=e.useCallback,k=e.useEffect,l=e.useRef,m=e.useState;function a(a,e){a=c("useWAWebAsync")(a,[]);var f=a.value,g=a.loading;a=a.error;var h=m(0),n=h[0],o=h[1],p=l(null);k(function(){!g&&f!=null&&o(f)},[g,f]);var q=j(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b;(b=p.current)==null?void 0:b.abort();p.current=new AbortController();try{yield e(a,p.current.signal)}catch(a){d("WALogger").ERROR(i(),a)}p.current=null});return function(b){return a.apply(this,arguments)}}(),[e]);h=j(function(){o(function(a){a=a+1;void q(a);return a})},[q]);var r=j(function(){o(0),void q(0)},[q]);if(g)return[{loading:!0,error:null,count:null},h,r];return a?[{loading:!1,error:a,count:null},h,r]:[{loading:!1,error:null,count:n},h,r]}g["default"]=a}),98);
__d("WAWebFrontendL10nHelpers",["WALogger","WATimeUtils","WAWebAlarm","WAWebCookieDomain","WAWebCookieManager","WAWebL10nGetRenderedLocale","WAWebRuntimeEnvironmentUtils","WAWebURLUtils"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["l10n: renewing lang pref cookie TTL to: ",""]);h=function(){return a};return a}var i="wa_web_lang_pref",j=null,k="\ud83c\udf10",l="%F0%9F%8C%90";function m(a){if(d("WAWebRuntimeEnvironmentUtils").isWorker())return;j!=null&&c("WAWebAlarm").clearTimeout(j);var b=Date.now()+4*d("WATimeUtils").WEEK_MILLISECONDS;d("WAWebCookieManager").setCookie({name:i,value:a,path:"/",domain:d("WAWebCookieDomain").COOKIE_DOMAIN,secure:!0,expirationDate:b});j=c("WAWebAlarm").setLocalTimeout(function(){d("WALogger").LOG(h(),a),m(a)},d("WATimeUtils").castUnixTimeToMillisTime(d("WATimeUtils").futureUnixTime(2*d("WATimeUtils").WEEK_SECONDS)))}function a(){if(d("WAWebRuntimeEnvironmentUtils").isWorker())return;var a=d("WAWebCookieManager").getCookie(i);a==null?m(d("WAWebL10nGetRenderedLocale").WAWebL10nGetRenderedLocale()):m(a)}function b(){if(d("WAWebRuntimeEnvironmentUtils").isWorker()||!c("WAWebURLUtils").canMuckHistory())return;var a=self.location.href;(a.includes("/"+l+"/")||a.includes("/"+k+"/"))&&window.history.replaceState({},"","/");a=new URL(a);a.searchParams.get("locale")!=null&&(a.searchParams["delete"]("locale"),window.history.replaceState({},"",a.href))}g.setWAWebLocalePrefCookie=m;g.extendWAWebLocalePrefCookieTtl=a;g.mungeWAWebLocaleOverrideFromUrlIfNecessary=b}),98);
__d("WAWebModalSingleActionOpener",["WAWebConfirmPopup.react","WAWebModalManager","react"],(function(a,b,c,d,e,f,g){var h,i=h||c("react");function a(a){var b=a.ModalComponentProvider;b=b===void 0?d("WAWebConfirmPopup.react").ConfirmPopup:b;var c=a.shouldDismissWithoutButtonInteraction;c=c===void 0?!0:c;var e=function b(){a.onDismiss==null?void 0:a.onDismiss(),d("WAWebModalManager").ModalManager.off("close_modal",b),d("WAWebModalManager").ModalManager.close()};d("WAWebModalManager").ModalManager.open(i.jsx(b,{title:a.title,cover:a.cover,onOK:e,onOverlayClick:c?e:function(){},okText:a.buttonText,children:a.body}),{blockClose:!c});c&&d("WAWebModalManager").ModalManager.on("close_modal",e)}g.openSingleActionModal=a}),98);
__d("WAWebMaybeStrictMode",["gkx","react"],(function(a,b,c,d,e,f,g){var h,i,j=i||c("react"),k=(h||(h=d("react"))).StrictMode;function a(a){a=a.children;return c("gkx")("26270")?j.jsx(k,{children:a}):a}a.displayName=a.name+" [from "+f.id+"]";g.MaybeStrictMode=a}),98);