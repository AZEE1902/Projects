;/*FB_PKG_DELIM*/

__d("WAWebCtwa3pdConversionWamEvent",["WAWebWamCodegenUtils"],(function(a,b,c,d,e,f,g){b=(a=d("WAWebWamCodegenUtils")).defineEvents({Ctwa3pdConversion:[5138,{ctwa3pdConversionMetadata:[1,a.TYPES.STRING],ctwa3pdConversionSubtype:[2,a.TYPES.STRING],ctwa3pdConversionType:[3,a.TYPES.STRING],ctwa3pdSchemaVersion:[4,a.TYPES.INTEGER],ctwa3pdSurfaceType:[5,a.TYPES.STRING],ctwaTrackingPayload:[6,a.TYPES.STRING]},[1,1,1],"regular"]});g.Ctwa3pdConversionWamEvent=b}),98);
__d("WAWebSmb3pdConversionSignalAction",["WAWebBizGatingUtils","WAWebCTWAConstants","WAWebChatModel","WAWebCommonCTWADataSharing","WAWebCtwa3pdConversionWamEvent","WAWebFrontendMsgGetters","WAWebLabelCollection","WAWebMsgModel","WAWebOrderStatus"],(function(a,b,c,d,e,f,g){var h=function(a,b){if(b==="order_created"||a==null)return"processing";b;switch(a){case d("WAWebOrderStatus").OrderStatus.Shipped:return"shipped";case d("WAWebOrderStatus").OrderStatus.Complete:case d("WAWebOrderStatus").OrderStatus.Delivered:return"completed";case d("WAWebOrderStatus").OrderStatus.Canceled:return"canceled";case d("WAWebOrderStatus").OrderStatus.Processing:case d("WAWebOrderStatus").OrderStatus.Pending:case d("WAWebOrderStatus").OrderStatus.PartiallyShipped:case d("WAWebOrderStatus").OrderStatus.PreparingToShip:case d("WAWebOrderStatus").OrderStatus.PaymentRequested:return"processing"}},i=function(a){var b=a.chat,e=a.surface,f=a.type,g=a.subType,i=a.orderStatus;a=a.paidData;if(d("WAWebBizGatingUtils").is3pdConversionEnabled()===!1)return;i=g==null?h((i=i)!=null?i:null,f):g;g={ctwa3pdSchemaVersion:2,ctwa3pdSurfaceType:e,ctwa3pdConversionType:f,ctwa3pdConversionSubtype:i,ctwa3pdConversionMetadata:JSON.stringify(a)};e=c("WAWebCommonCTWADataSharing").getCTWAEligibilityFromChat(b);e&&e.data!=null&&(g.ctwaTrackingPayload=e.data);new(d("WAWebCtwa3pdConversionWamEvent").Ctwa3pdConversionWamEvent)(g).commit()},j=function(a,b,c){a=d("WAWebLabelCollection").LabelCollection.get(a);if(a==null)return;a=a.predefinedId;if(a==null)return;if(!d("WAWebCTWAConstants").ALLOWED_PREDEFINED_LABEL_IDS_SET.has(a))return;var e=a===d("WAWebCTWAConstants").ALLOWED_PREDEFINED_LABEL_IDS.NEW_ORDER?"order_created":"order_updated",f,g={paid:!1};switch(a){case d("WAWebCTWAConstants").ALLOWED_PREDEFINED_LABEL_IDS.ORDER_COMPLETE:f="order_complete";break;case d("WAWebCTWAConstants").ALLOWED_PREDEFINED_LABEL_IDS.NEW_ORDER:f="new_order";break;case d("WAWebCTWAConstants").ALLOWED_PREDEFINED_LABEL_IDS.PAID:f="paid";g.paid=!0;break;case d("WAWebCTWAConstants").ALLOWED_PREDEFINED_LABEL_IDS.PENDING_PAYMENT:f="pending_payment";break}i({paidData:g,chat:b,surface:c,type:e,subType:f})};a=function(a){var b=a.chat,c=a.type,e=a.orderStatus,f=a.paidData;a=a.isPaidStateChanged;if(!d("WAWebBizGatingUtils").smbDataSharingConsentEnabled())return;b={surface:"order",chat:b,type:c,orderStatus:e,paidData:f};a===!0&&(b.subType="paid_change");i(b)};var k=function(a,b){var c="label_chat";a.forEach(function(a){b.forEach(function(b){j(b,a,c)})})},l=function(a,b){var c="label_message";a.forEach(function(a){var e=d("WAWebFrontendMsgGetters").getChat(a);b.forEach(function(a){j(a,e,c)})})};b=function(a,b){if(a.length===0||b.length===0)return;if(d("WAWebBizGatingUtils").is3pdConversionEnabled()===!1)return;a=a.reduce(function(a,b){b instanceof d("WAWebChatModel").Chat?a.chats.push(b):b instanceof d("WAWebMsgModel").Msg&&a.messages.push(b);return a},{chats:[],messages:[]});var c=a.chats;a=a.messages;c.length>0&&d("WAWebBizGatingUtils").isSMBLabelsDataSharingEnabledForChats()&&k(c,b);a.length>0&&d("WAWebBizGatingUtils").isSMBLabelsDataSharingEnabledForMessages()&&l(a,b)};g.log3pdConversionSignalForOrders=a;g.log3pdConversionSignalForChatsOrMessages=b}),98);